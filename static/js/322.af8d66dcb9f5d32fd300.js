/*! For license information please see 322.af8d66dcb9f5d32fd300.js.LICENSE.txt */
(self.webpackChunkpromotion_web=self.webpackChunkpromotion_web||[]).push([[322],{81618:function(t){"use strict";t.exports=function(){function t(t){var r=[];return t.AMapUI&&r.push(e(t.AMapUI)),t.Loca&&r.push(n(t.Loca)),Promise.all(r)}function e(t){return new Promise((function(e,n){var i=[];if(t.plugins)for(var u=0;u<t.plugins.length;u+=1)-1==o.AMapUI.plugins.indexOf(t.plugins[u])&&i.push(t.plugins[u]);if(a.AMapUI===r.failed)n("前次请求 AMapUI 失败");else if(a.AMapUI===r.notload){a.AMapUI=r.loading,o.AMapUI.version=t.version||o.AMapUI.version,u=o.AMapUI.version;var l=document.body||document.head,c=document.createElement("script");c.type="text/javascript",c.src="https://webapi.amap.com/ui/"+u+"/main.js",c.onerror=function(t){a.AMapUI=r.failed,n("请求 AMapUI 失败")},c.onload=function(){if(a.AMapUI=r.loaded,i.length)window.AMapUI.loadUI(i,(function(){for(var t=0,n=i.length;t<n;t++){var r=i[t].split("/").slice(-1)[0];window.AMapUI[r]=arguments[t]}for(e();s.AMapUI.length;)s.AMapUI.splice(0,1)[0]()}));else for(e();s.AMapUI.length;)s.AMapUI.splice(0,1)[0]()},l.appendChild(c)}else a.AMapUI===r.loaded?t.version&&t.version!==o.AMapUI.version?n("不允许多个版本 AMapUI 混用"):i.length?window.AMapUI.loadUI(i,(function(){for(var t=0,n=i.length;t<n;t++){var r=i[t].split("/").slice(-1)[0];window.AMapUI[r]=arguments[t]}e()})):e():t.version&&t.version!==o.AMapUI.version?n("不允许多个版本 AMapUI 混用"):s.AMapUI.push((function(t){t?n(t):i.length?window.AMapUI.loadUI(i,(function(){for(var t=0,n=i.length;t<n;t++){var r=i[t].split("/").slice(-1)[0];window.AMapUI[r]=arguments[t]}e()})):e()}))}))}function n(t){return new Promise((function(e,n){if(o.AMap.version.startsWith("2.0"))n("Loca 暂不适配 JSAPI 2.0,请使用 1.4.15");else if(a.Loca===r.failed)n("前次请求 Loca 失败");else if(a.Loca===r.notload){a.Loca=r.loading,o.Loca.version=t.version||o.Loca.version;var i=o.Loca.version,u=o.key,l=document.body||document.head,c=document.createElement("script");c.type="text/javascript",c.src="https://webapi.amap.com/loca?v="+i+"&key="+u,c.onerror=function(t){a.Loca=r.failed,n("请求 AMapUI 失败")},c.onload=function(){for(a.Loca=r.loaded,e();s.Loca.length;)s.Loca.splice(0,1)[0]()},l.appendChild(c)}else a.Loca===r.loaded?t.version&&t.version!==o.Loca.version?n("不允许多个版本 Loca 混用"):e():t.version&&t.version!==o.Loca.version?n("不允许多个版本 Loca 混用"):s.Loca.push((function(t){t?n(t):n()}))}))}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var r,i;(i=r||(r={})).notload="notload",i.loading="loading",i.loaded="loaded",i.failed="failed";var o={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},a={AMap:r.notload,AMapUI:r.notload,Loca:r.notload},s={AMap:[],AMapUI:[],Loca:[]},u=[],l=function(t){"function"==typeof t&&(a.AMap===r.loaded?t(window.AMap):u.push(t))};return{load:function(e){return new Promise((function(n,i){if(a.AMap==r.failed)i("");else if(a.AMap==r.notload){var s=e.key,c=e.version,p=e.plugins;s?(window.AMap&&"lbs.amap.com"!==location.host&&i("禁止多种API加载方式混用"),o.key=s,o.AMap.version=c||o.AMap.version,o.AMap.plugins=p||o.AMap.plugins,a.AMap=r.loading,c=document.body||document.head,window.___onAPILoaded=function(o){if(delete window.___onAPILoaded,o)a.AMap=r.failed,i(o);else for(a.AMap=r.loaded,t(e).then((function(){n(window.AMap)})).catch(i);u.length;)u.splice(0,1)[0]()},(p=document.createElement("script")).type="text/javascript",p.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+o.AMap.version+"&key="+s+"&plugin="+o.AMap.plugins.join(","),p.onerror=function(t){a.AMap=r.failed,i(t)},c.appendChild(p)):i("请填写key")}else if(a.AMap==r.loaded)if(e.key&&e.key!==o.key)i("多个不一致的 key");else if(e.version&&e.version!==o.AMap.version)i("不允许多个版本 JSAPI 混用");else{if(s=[],e.plugins)for(c=0;c<e.plugins.length;c+=1)-1==o.AMap.plugins.indexOf(e.plugins[c])&&s.push(e.plugins[c]);s.length?window.AMap.plugin(s,(function(){t(e).then((function(){n(window.AMap)})).catch(i)})):t(e).then((function(){n(window.AMap)})).catch(i)}else if(e.key&&e.key!==o.key)i("多个不一致的 key");else if(e.version&&e.version!==o.AMap.version)i("不允许多个版本 JSAPI 混用");else{var h=[];if(e.plugins)for(c=0;c<e.plugins.length;c+=1)-1==o.AMap.plugins.indexOf(e.plugins[c])&&h.push(e.plugins[c]);l((function(){h.length?window.AMap.plugin(h,(function(){t(e).then((function(){n(window.AMap)})).catch(i)})):t(e).then((function(){n(window.AMap)})).catch(i)}))}}))},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,o={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},a={AMap:r.notload,AMapUI:r.notload,Loca:r.notload},s={AMap:[],AMapUI:[],Loca:[]}}}}()},46343:function(t,e,n){"use strict";n.d(e,{gg:function(){return L},ni:function(){return T},oI:function(){return I},zj:function(){return k}});var r=n(34155);function i(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))}function o(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function a(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function s(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function u(t,e){return t(e={exports:{}},e.exports),e.exports}var l=u((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return t&&"number"==typeof t.length&&t.length>=0&&t.length%1==0},t.exports=e.default}));s(l);var c=u((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];var r=e.pop();return t.call(this,e,r)}},t.exports=e.default}));s(c);var p=u((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.fallback=a,e.wrap=s;var n,i=e.hasSetImmediate="function"==typeof setImmediate&&setImmediate,o=e.hasNextTick="object"==typeof r&&"function"==typeof r.nextTick;function a(t){setTimeout(t,0)}function s(t){return function(e){for(var n=[],r=arguments.length-1;r-- >0;)n[r]=arguments[r+1];return t((function(){return e.apply(void 0,n)}))}}n=i?setImmediate:o?r.nextTick:a,e.default=s(n)}));s(p);p.fallback,p.wrap,p.hasSetImmediate,p.hasNextTick;var h=u((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){if((0,f.isAsync)(t))return function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];var r=e.pop(),i=t.apply(this,e);return o(i,r)};return(0,n.default)((function(e,n){var r;try{r=t.apply(this,e)}catch(t){return n(t)}if(r&&"function"==typeof r.then)return o(r,n);n(null,r)}))};var n=i(c),r=i(p);function i(t){return t&&t.__esModule?t:{default:t}}function o(t,e){return t.then((function(t){a(e,null,t)}),(function(t){a(e,t&&t.message?t:new Error(t))}))}function a(t,e,n){try{t(e,n)}catch(t){(0,r.default)((function(t){throw t}),t)}}t.exports=e.default}));s(h);var f=u((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.isAsyncIterable=e.isAsyncGenerator=e.isAsync=void 0;var n,r=(n=h)&&n.__esModule?n:{default:n};function i(t){return"AsyncFunction"===t[Symbol.toStringTag]}e.default=function(t){if("function"!=typeof t)throw new Error("expected a function");return i(t)?(0,r.default)(t):t},e.isAsync=i,e.isAsyncGenerator=function(t){return"AsyncGenerator"===t[Symbol.toStringTag]},e.isAsyncIterable=function(t){return"function"==typeof t[Symbol.asyncIterator]}}));s(f);f.isAsyncIterable,f.isAsyncGenerator,f.isAsync;var d=u((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){void 0===e&&(e=t.length);if(!e)throw new Error("arity is undefined");function n(){for(var n=this,r=[],i=arguments.length;i--;)r[i]=arguments[i];return"function"==typeof r[e-1]?t.apply(this,r):new Promise((function(i,o){r[e-1]=function(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];if(t)return o(t);i(e.length>1?e:e[0])},t.apply(n,r)}))}return Object.defineProperty(n,"name",{configurable:!0,value:"awaitable("+t.name+")"}),n},t.exports=e.default}));s(d);var v=u((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=o(l),r=o(f),i=o(d);function o(t){return t&&t.__esModule?t:{default:t}}e.default=(0,i.default)((function(t,e,i){var o=(0,n.default)(e)?[]:{};t(e,(function(t,e,n){(0,r.default)(t)((function(t){for(var r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];r.length<2&&(r=r[0]),o[e]=r,n(t)}))}),(function(t){return i(t,o)}))}),3),t.exports=e.default}));s(v);var m=u((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){function e(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];if(null!==t){var r=t;t=null,r.apply(this,e)}}return Object.assign(e,t),e},t.exports=e.default}));s(m);var y=u((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return t[Symbol.iterator]&&t[Symbol.iterator]()},t.exports=e.default}));s(y);var g=u((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){if((0,n.default)(t))return function(t){var e=-1,n=t.length;return function(){return++e<n?{value:t[e],key:e}:null}}(t);var e=(0,r.default)(t);return e?function(t){var e=-1;return function(){var n=t.next();return n.done?null:(e++,{value:n.value,key:e})}}(e):(i=t,o=i?Object.keys(i):[],a=-1,s=o.length,function(){var t=o[++a];return a<s?{value:i[t],key:t}:null});var i,o,a,s};var n=i(l),r=i(y);function i(t){return t&&t.__esModule?t:{default:t}}t.exports=e.default}));s(g);var _=u((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];if(null===t)throw new Error("Callback was already called.");var r=t;t=null,r.apply(this,e)}},t.exports=e.default}));s(_);var x=u((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});e.default={},t.exports=e.default}));s(x);var b=u((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,n,i){var o=!1,a=!1,s=!1,u=0,l=0;function c(){u>=e||s||o||(s=!0,t.next().then((function(t){var e=t.value,r=t.done;if(!a&&!o){if(s=!1,r)return o=!0,void(u<=0&&i(null));u++,n(e,l,p),l++,c()}})).catch(h))}function p(t,e){if(u-=1,!a)return t?h(t):!1===t?(o=!0,void(a=!0)):e===r.default||o&&u<=0?(o=!0,i(null)):void c()}function h(t){a||(s=!1,o=!0,i(t))}c()};var n,r=(n=x)&&n.__esModule?n:{default:n};t.exports=e.default}));s(b);var w=u((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=s(m),r=s(g),i=s(_),o=s(b),a=s(x);function s(t){return t&&t.__esModule?t:{default:t}}e.default=function(t){return function(e,s,u){if(u=(0,n.default)(u),t<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!e)return u(null);if((0,f.isAsyncGenerator)(e))return(0,o.default)(e,t,s,u);if((0,f.isAsyncIterable)(e))return(0,o.default)(e[Symbol.asyncIterator](),t,s,u);var l=(0,r.default)(e),c=!1,p=!1,h=0,d=!1;function v(t,e){if(!p)if(h-=1,t)c=!0,u(t);else if(!1===t)c=!0,p=!0;else{if(e===a.default||c&&h<=0)return c=!0,u(null);d||m()}}function m(){for(d=!0;h<t&&!c;){var e=l();if(null===e)return c=!0,void(h<=0&&u(null));h+=1,s(e.value,e.key,(0,i.default)(v))}d=!1}m()}},t.exports=e.default}));s(w);var S=u((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=o(w),r=o(f),i=o(d);function o(t){return t&&t.__esModule?t:{default:t}}e.default=(0,i.default)((function(t,e,i,o){return(0,n.default)(e)(t,(0,r.default)(i),o)}),4),t.exports=e.default}));s(S);var E=u((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=i(S),r=i(d);function i(t){return t&&t.__esModule?t:{default:t}}e.default=(0,r.default)((function(t,e,r){return(0,n.default)(t,1,e,r)}),3),t.exports=e.default}));s(E);var C=s(u((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){return(0,n.default)(r.default,t,e)};var n=i(v),r=i(E);function i(t){return t&&t.__esModule?t:{default:t}}t.exports=e.default}))),T=function(){function t(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];this.args=[],this.tasks=[]}return t.prototype.call=function(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];return this.args=e,C(this.tasks)},t.prototype.tap=function(t,e){var n=this;this.tasks.push((function(r){e.apply(void 0,function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(a(arguments[e]));return t}(n.args)),r(null,t)}))},t}(),A=u((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=c(l),r=c(x),i=c(S),o=c(m),a=c(_),s=c(f),u=c(d);function c(t){return t&&t.__esModule?t:{default:t}}function p(t,e,n){n=(0,o.default)(n);var i=0,s=0,u=t.length,l=!1;function c(t,e){!1===t&&(l=!0),!0!==l&&(t?n(t):++s!==u&&e!==r.default||n(null))}for(0===u&&n(null);i<u;i++)e(t[i],i,(0,a.default)(c))}function h(t,e,n){return(0,i.default)(t,1/0,e,n)}e.default=(0,u.default)((function(t,e,r){return((0,n.default)(t)?p:h)(t,(0,s.default)(e),r)}),3),t.exports=e.default}));s(A);var M=s(u((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){return(0,r.default)(n.default,t,e)};var n=i(A),r=i(v);function i(t){return t&&t.__esModule?t:{default:t}}t.exports=e.default}))),k=function(){function t(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];this.tasks=[]}return t.prototype.promise=function(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];return M(this.tasks)},t.prototype.tapPromise=function(t,e){var n=this;this.tasks.push((function(r){return i(n,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,e()];case 1:return n.sent(),r(null,t),[2]}}))}))}))},t}(),P=u((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=a(m),r=a(_),i=a(f),o=a(d);function a(t){return t&&t.__esModule?t:{default:t}}e.default=(0,o.default)((function(t,e){if(e=(0,n.default)(e),!Array.isArray(t))return e(new Error("First argument to waterfall must be an array of functions"));if(!t.length)return e();var o=0;function a(e){(0,i.default)(t[o++]).apply(void 0,e.concat([(0,r.default)(s)]))}function s(n){for(var r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];if(!1!==n)return n||o===t.length?e.apply(void 0,[n].concat(r)):void a(r)}a([])})),t.exports=e.default})),O=s(P),L=function(){function t(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];this.tasks=[]}return t.prototype.call=function(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];return O(this.tasks)},t.prototype.tap=function(t,e){0===this.tasks.length?this.tasks.push((function(t){var n=e();t(!!n&&null,n)})):this.tasks.push((function(n,r){r(!!e()&&null,t)}))},t}(),I=function(){function t(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];this.tasks=[]}return t.prototype.call=function(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];return C(this.tasks)},t.prototype.tap=function(t,e){this.tasks.push((function(n){n(e(),t)}))},t}()},90494:function(t,e,n){"use strict";n.r(e);var r=function(){function t(){this._events={}}return t.prototype.on=function(t,e,n){return this._events[t]||(this._events[t]=[]),this._events[t].push({callback:e,once:!!n}),this},t.prototype.once=function(t,e){return this.on(t,e,!0)},t.prototype.emit=function(t){for(var e=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=this._events[t]||[],o=this._events["*"]||[],a=function(r){for(var i=r.length,o=0;o<i;o++)if(r[o]){var a=r[o],s=a.callback;a.once&&(r.splice(o,1),0===r.length&&delete e._events[t],i--,o--),s.apply(e,n)}};a(i),a(o)},t.prototype.off=function(t,e){if(t)if(e){for(var n=this._events[t]||[],r=n.length,i=0;i<r;i++)n[i].callback===e&&(n.splice(i,1),r--,i--);0===n.length&&delete this._events[t]}else delete this._events[t];else this._events={};return this},t.prototype.getEvents=function(){return this._events},t}();e.default=r},30398:function(t,e,n){"use strict";n.r(e),n.d(e,{Control:function(){return y},Layers:function(){return _},Logo:function(){return b},Marker:function(){return k},MarkerLayer:function(){return Z},Popup:function(){return j},Scale:function(){return S},Zoom:function(){return C}});var r=n(15671),i=n(43144),o=n(97326),a=n(60136),s=n(82963),u=n(61120),l=n(4942),c=n(20832),p=n(35251),h=n(26729);function f(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function d(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?f(Object(n),!0).forEach((function(e){(0,l.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function v(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,u.Z)(t);if(e){var i=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,s.Z)(this,n)}}var m=0,y=function(t){(0,a.Z)(n,t);var e=v(n);function n(t){var i;return(0,r.Z)(this,n),i=e.call(this),(0,l.Z)((0,o.Z)(i),"controlOption",void 0),(0,l.Z)((0,o.Z)(i),"container",void 0),(0,l.Z)((0,o.Z)(i),"sceneContainer",void 0),(0,l.Z)((0,o.Z)(i),"mapsService",void 0),(0,l.Z)((0,o.Z)(i),"renderService",void 0),(0,l.Z)((0,o.Z)(i),"layerService",void 0),(0,l.Z)((0,o.Z)(i),"controlService",void 0),(0,l.Z)((0,o.Z)(i),"isShow",void 0),i.controlOption=d(d({},i.getDefault()),t||{}),i}return(0,i.Z)(n,[{key:"getDefault",value:function(){return{position:c.PositionType.TOPRIGHT,name:"".concat(m++)}}},{key:"setPosition",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c.PositionType.BOTTOMRIGHT,e=this.controlService;return e&&e.removeControl(this),this.controlOption.position=t,e&&e.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(t){this.mapsService=t.get(c.TYPES.IMapService),this.renderService=t.get(c.TYPES.IRendererService),this.layerService=t.get(c.TYPES.ILayerService),this.controlService=t.get(c.TYPES.IControlService),this.sceneContainer=t,this.isShow=!0,this.container=this.onAdd();var e=this.container,n=this.controlOption.position,r=this.controlService.controlCorners[n];return p.DOM.addClass(e,"l7-control"),-1!==n.indexOf("bottom")?r.insertBefore(e,r.firstChild):r.appendChild(e),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var t=this.container;p.DOM.addClass(t,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var t=this.container;p.DOM.removeClass(t,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;p.DOM.remove(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(t){if(this.mapsService&&t&&t.screenX>0&&t.screenY>0){var e=this.mapsService.getContainer();null!==e&&e.focus()}}}]),n}(h.EventEmitter);function g(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,u.Z)(t);if(e){var i=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,s.Z)(this,n)}}var _=function(t){(0,a.Z)(n,t);var e=g(n);function n(t){var i;return(0,r.Z)(this,n),i=e.call(this,t),(0,l.Z)((0,o.Z)(i),"layerControlInputs",void 0),(0,l.Z)((0,o.Z)(i),"layers",void 0),(0,l.Z)((0,o.Z)(i),"lastZIndex",void 0),(0,l.Z)((0,o.Z)(i),"handlingClick",void 0),(0,l.Z)((0,o.Z)(i),"layersLink",void 0),(0,l.Z)((0,o.Z)(i),"baseLayersList",void 0),(0,l.Z)((0,o.Z)(i),"separator",void 0),(0,l.Z)((0,o.Z)(i),"overlaysList",void 0),(0,l.Z)((0,o.Z)(i),"form",void 0),i.layerControlInputs=[],i.layers=[],i.lastZIndex=0,i.handlingClick=!1,i.initLayers(),(0,p.bindAll)(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,o.Z)(i)),i}return(0,i.Z)(n,[{key:"getDefault",value:function(){return{collapsed:!0,position:c.PositionType.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var t=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach((function(e){e.layer.on("remove",t.onLayerChange),e.layer.on("add",t.onLayerChange)})),this.container}},{key:"addVisualLayer",value:function(t,e){return this.addLayer(t,e,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var t=this.renderService.getViewportSize().height;p.DOM.addClass(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var e=t-(this.container.offsetTop+50);return e<this.form.clientHeight?(p.DOM.addClass(this.form,"l7-control-layers-scrollbar"),this.form.style.height=e+"px"):p.DOM.removeClass(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return p.DOM.removeClass(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var t=this;this.mapsService&&(this.mapsService.off("click",this.collapse),this.layers.forEach((function(e){e.layer.off("remove",t.onLayerChange),e.layer.off("add",t.onLayerChange)})))}},{key:"initLayout",value:function(){var t="l7-control-layers",e=this.container=p.DOM.create("div",t),n=this.controlOption.collapsed;e.setAttribute("aria-haspopup","true");var r=this.form=p.DOM.create("form",t+"-list");n&&(this.mapsService.on("click",this.collapse),e.addEventListener("mouseenter",this.expand),e.addEventListener("mouseleave",this.collapse)),this.layersLink=p.DOM.create("a",t+"-toggle",e),this.layersLink.title="Layers",n||this.expand(),this.baseLayersList=p.DOM.create("div",t+"-base",r),this.separator=p.DOM.create("div",t+"-separator",r),this.overlaysList=p.DOM.create("div",t+"-overlays",r),e.appendChild(r)}},{key:"initLayers",value:function(){var t=this,e=this.controlOption,n=e.baseLayers,r=void 0===n?{}:n,i=e.overlayers,o=void 0===i?{}:i;Object.keys(r).forEach((function(e,n){t.addLayer(r[e],e,!1)})),Object.keys(o).forEach((function(e,n){t.addLayer(o[e],e,!0)}))}},{key:"update",value:function(){if(!this.container)return this;var t,e,n,r;p.DOM.empty(this.baseLayersList),p.DOM.empty(this.overlaysList),this.layerControlInputs=[];var i=0;for(n=0;n<this.layers.length;n++)r=this.layers[n],this.addItem(r),e=e||r.overlay,t=t||!r.overlay,i+=r.overlay?0:1;return this.controlOption.hideSingleBase&&(t=t&&i>1,this.baseLayersList.style.display=t?"":"none"),this.separator.style.display=e&&t?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var t,e,n=this.layerControlInputs,r=this.mapsService.getZoom(),i=n.length-1;i>=0;i--)if(t=n[i],(e=this.layerService.getLayer(t.layerId))&&e.inited){var o=e.getMinZoom(),a=e.getMaxZoom();t.disabled=r<o||r>a}}},{key:"addLayer",value:function(t,e,n){this.mapsService&&(t.on("add",this.onLayerChange),t.on("remove",this.onLayerChange)),this.layers.push({layer:t,name:e,overlay:n});var r=this.controlOption,i=r.sortLayers,o=r.sortFunction,a=r.autoZIndex;i&&this.layers.sort((function(t,e){return o(t.layer,e.layer,t.name,e.name)})),a&&t.setZIndex&&(this.lastZIndex++,t.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(t){this.handlingClick||this.update();var e=this.layerService.getLayer(t.target.layerId),n=null!=e&&e.overlay?"add"===t.type?"overlayadd":"overlayremove":"add"===t.type?"baselayerchange":null;n&&this.emit(n,e)}},{key:"createRadioElement",value:function(t,e){var n='<input type="radio" class="l7-control-layers-selector" name="'+t+'"'+(e?' checked="checked"':"")+"/>",r=document.createElement("div");return r.innerHTML=n,r.firstChild}},{key:"addItem",value:function(t){var e,n=document.createElement("label"),r=this.layerService.getLayer(t.layer.id),i=r&&r.inited&&t.layer.isVisible();t.overlay?((e=document.createElement("input")).type="checkbox",e.className="l7-control-layers-selector",e.defaultChecked=i):e=this.createRadioElement("l7-base-layers",i),this.layerControlInputs.push(e),e.layerId=t.layer.id,e.addEventListener("click",this.onInputClick);var o=document.createElement("span");o.innerHTML=" "+t.name;var a=document.createElement("div");return n.appendChild(a),a.appendChild(e),a.appendChild(o),(t.overlay?this.overlaysList:this.baseLayersList).appendChild(n),this.checkDisabledLayers(),n}},{key:"onInputClick",value:function(){var t,e,n=this.layerControlInputs,r=[],i=[];this.handlingClick=!0;for(var o=n.length-1;o>=0;o--)t=n[o],e=this.layerService.getLayer(t.layerId),t.checked?r.push(e):t.checked||i.push(e);i.forEach((function(t){t.hide()})),r.forEach((function(t){t.show()})),this.handlingClick=!1}}]),n}(y);function x(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,u.Z)(t);if(e){var i=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,s.Z)(this,n)}}var b=function(t){(0,a.Z)(n,t);var e=x(n);function n(){return(0,r.Z)(this,n),e.apply(this,arguments)}return(0,i.Z)(n,[{key:"getDefault",value:function(){return{position:c.PositionType.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var t=p.DOM.create("div","l7-control-logo"),e=p.DOM.create("a","l7-ctrl-logo");return e.target="_blank",e.rel="noopener nofollow",e.href="https://antv.alipay.com/l7",e.setAttribute("aria-label","AntV logo"),e.setAttribute("rel","noopener nofollow"),t.appendChild(e),t}},{key:"onRemove",value:function(){return null}}]),n}(y);function w(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,u.Z)(t);if(e){var i=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,s.Z)(this,n)}}var S=function(t){(0,a.Z)(n,t);var e=w(n);function n(t){var i;return(0,r.Z)(this,n),i=e.call(this,t),(0,l.Z)((0,o.Z)(i),"mScale",void 0),(0,l.Z)((0,o.Z)(i),"iScale",void 0),(0,p.bindAll)(["update"],(0,o.Z)(i)),i}return(0,i.Z)(n,[{key:"getDefault",value:function(){return{position:c.PositionType.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var t="l7-control-scale",e=p.DOM.create("div",t);this.addScales(t+"-line",e);var n=this.controlOption.updateWhenIdle;return this.mapsService.on(n?"moveend":"mapmove",this.update),this.mapsService.on(n?"zoomend":"zoomchange",this.update),this.update(),e}},{key:"onRemove",value:function(){var t=this.controlOption.updateWhenIdle;this.mapsService.off(t?"zoomend":"zoomchange",this.update),this.mapsService.off(t?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var t=this.mapsService,e=this.controlOption.maxWidth,n=t.getSize()[1]/2,r=t.containerToLngLat([0,n]),i=t.containerToLngLat([e,n]),o=(0,p.lnglatDistance)([r.lng,r.lat],[i.lng,i.lat]);this.updateScales(o)}},{key:"updateScales",value:function(t){var e=this.controlOption,n=e.metric,r=e.imperial;n&&t&&this.updateMetric(t),r&&t&&this.updateImperial(t)}},{key:"updateMetric",value:function(t){var e=this.getRoundNum(t),n=e<1e3?e+" m":e/1e3+" km";this.updateScale(this.mScale,n,e/t)}},{key:"updateImperial",value:function(t){var e,n,r,i=3.2808399*t;i>5280?(e=i/5280,n=this.getRoundNum(e),this.updateScale(this.iScale,n+" mi",n/e)):(r=this.getRoundNum(i),this.updateScale(this.iScale,r+" ft",r/i))}},{key:"updateScale",value:function(t,e,n){var r=this.controlOption.maxWidth;t.style.width=Math.round(r*n)+"px",t.innerHTML=e}},{key:"getRoundNum",value:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),n=t/e;return e*(n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:1)}},{key:"addScales",value:function(t,e){var n=this.controlOption,r=n.metric,i=n.imperial;r&&(this.mScale=p.DOM.create("div",t,e)),i&&(this.iScale=p.DOM.create("div",t,e))}}]),n}(y);function E(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,u.Z)(t);if(e){var i=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,s.Z)(this,n)}}var C=function(t){(0,a.Z)(n,t);var e=E(n);function n(t){var i;return(0,r.Z)(this,n),i=e.call(this,t),(0,l.Z)((0,o.Z)(i),"disabled",void 0),(0,l.Z)((0,o.Z)(i),"zoomInButton",void 0),(0,l.Z)((0,o.Z)(i),"zoomOutButton",void 0),(0,p.bindAll)(["updateDisabled","zoomIn","zoomOut"],(0,o.Z)(i)),i}return(0,i.Z)(n,[{key:"getDefault",value:function(){return{position:c.PositionType.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var t="l7-control-zoom",e=p.DOM.create("div",t+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,t+"-in",e,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,t+"-out",e,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),e}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(t,e,n,r,i){var o=p.DOM.create("a",n,r);return o.innerHTML=t,o.title=e,o.href="javascript:void(0)",o.addEventListener("click",i),o}},{key:"updateDisabled",value:function(){var t=this.mapsService,e="l7-disabled";p.DOM.removeClass(this.zoomInButton,e),p.DOM.removeClass(this.zoomOutButton,e),(this.disabled||t.getZoom()<=t.getMinZoom())&&p.DOM.addClass(this.zoomOutButton,e),(this.disabled||t.getZoom()>=t.getMaxZoom())&&p.DOM.addClass(this.zoomInButton,e)}}]),n}(y);function T(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function A(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?T(Object(n),!0).forEach((function(e){(0,l.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function M(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,u.Z)(t);if(e){var i=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,s.Z)(this,n)}}var k=function(t){(0,a.Z)(n,t);var e=M(n);function n(t){var i;return(0,r.Z)(this,n),i=e.call(this),(0,l.Z)((0,o.Z)(i),"markerOption",void 0),(0,l.Z)((0,o.Z)(i),"defaultMarker",void 0),(0,l.Z)((0,o.Z)(i),"popup",void 0),(0,l.Z)((0,o.Z)(i),"mapsService",void 0),(0,l.Z)((0,o.Z)(i),"sceneSerive",void 0),(0,l.Z)((0,o.Z)(i),"lngLat",void 0),(0,l.Z)((0,o.Z)(i),"scene",void 0),(0,l.Z)((0,o.Z)(i),"added",!1),(0,l.Z)((0,o.Z)(i),"eventHandle",(function(t){i.emit(t.type,{target:t,data:i.markerOption.extData,lngLat:i.lngLat})})),i.markerOption=A(A({},i.getDefault()),t),(0,p.bindAll)(["update","onMove","onUp","addDragHandler","onMapClick"],(0,o.Z)(i)),i.init(),i}return(0,i.Z)(n,[{key:"getDefault",value:function(){return{element:void 0,anchor:p.anchorType.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(t){this.scene=t,this.mapsService=t.get(c.TYPES.IMapService),this.sceneSerive=t.get(c.TYPES.ISceneService);var e=this.markerOption,n=e.element;e.draggable;return this.mapsService.getMarkerContainer().appendChild(n),this.registerMarkerEvent(n),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var t=this.markerOption.element;return t&&p.DOM.remove(t),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(t){return this.lngLat=t,Array.isArray(t)&&(this.lngLat={lng:t[0],lat:t[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(t){var e=this;if(!this.added)return this.once("added",(function(){e.setElement(t)})),this;var n=this.markerOption.element;return n&&p.DOM.remove(n),this.markerOption.element=t,this.init(),this.mapsService.getMarkerContainer().appendChild(t),this.registerMarkerEvent(t),this.update(),this}},{key:"openPopup",value:function(){var t=this;if(!this.added)return this.once("added",(function(){t.openPopup()})),this;var e=this.popup;return e?(e.isOpen()||e.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var t=this;this.added||this.once("added",(function(){t.closePopup()}));var e=this.popup;return e&&e.remove(),this}},{key:"setPopup",value:function(t){return this.popup=t,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var t=this.popup;return t?(t.isOpen()?t.remove():t.addTo(this.scene),this):this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(t){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(t){this.markerOption.extData=t}},{key:"update",value:function(){if(this.mapsService){var t=this.markerOption,e=t.element,n=t.anchor;this.updatePosition(),p.DOM.setTransform(e,"".concat(p.anchorTranslate[n]))}}},{key:"onMapClick",value:function(t){var e=this.markerOption.element;this.popup&&e&&this.togglePopup()}},{key:"updatePosition",value:function(){if(this.mapsService){var t=this.markerOption,e=t.element,n=t.offsets,r=this.lngLat,i=r.lng,o=r.lat,a=this.mapsService.getBounds(),s=this.mapsService.lngLatToContainer([i,o]);if(e){e.style.display="block",e.style.whiteSpace="nowrap";var u=this.mapsService.getContainer(),l=0,c=0;if(u&&(l=u.scrollWidth,c=u.scrollHeight),Math.abs(a[0][0])>180||Math.abs(a[1][0])>180){if(s.x>l){var p=this.mapsService.lngLatToContainer([i-360,o]);s.x=p.x}if(s.x<0){var h=this.mapsService.lngLatToContainer([i+360,o]);s.x=h.x}}(s.x>l||s.x<0||s.y>c||s.y<0)&&(e.style.display="none"),e.style.left=s.x+n[0]+"px",e.style.top=s.y-n[1]+"px"}}}},{key:"init",value:function(){var t=this,e=this.markerOption.element,n=this.markerOption,r=n.color,i=n.anchor;if(!e){this.defaultMarker=!0,e=p.DOM.create("div"),this.markerOption.element=e;var o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height","48px"),o.setAttributeNS(null,"width","48px"),o.setAttributeNS(null,"viewBox","0 0 1024 1024");var a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),a.setAttributeNS(null,"fill",r),o.appendChild(a),e.appendChild(o)}p.DOM.addClass(e,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach((function(n){var r,i,o=(null===(r=t.markerOption)||void 0===r?void 0:r.style)&&(null===(i=t.markerOption)||void 0===i?void 0:i.style[n]);e&&(e.style[n]=o)})),e.addEventListener("click",(function(e){t.onMapClick(e)})),e.addEventListener("click",this.eventHandle),(0,p.applyAnchorClass)(e,i,"marker")}},{key:"registerMarkerEvent",value:function(t){t.addEventListener("mousemove",this.eventHandle),t.addEventListener("click",this.eventHandle),t.addEventListener("mousedown",this.eventHandle),t.addEventListener("mouseup",this.eventHandle),t.addEventListener("dblclick",this.eventHandle),t.addEventListener("contextmenu",this.eventHandle),t.addEventListener("mouseover",this.eventHandle),t.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var t=this.getElement();t.removeEventListener("mousemove",this.eventHandle),t.removeEventListener("click",this.eventHandle),t.removeEventListener("mousedown",this.eventHandle),t.removeEventListener("mouseup",this.eventHandle),t.removeEventListener("dblclick",this.eventHandle),t.removeEventListener("contextmenu",this.eventHandle),t.removeEventListener("mouseover",this.eventHandle),t.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(t){throw new Error("Method not implemented.")}},{key:"onUp",value:function(t){throw new Error("Method not implemented.")}}]),n}(h.EventEmitter),P=n(82492),O=n.n(P),L=n(69848),I=n.n(L);function R(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function D(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?R(Object(n),!0).forEach((function(e){(0,l.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function N(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,u.Z)(t);if(e){var i=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,s.Z)(this,n)}}var Z=function(t){(0,a.Z)(n,t);var e=N(n);function n(t){var i,a;return(0,r.Z)(this,n),a=e.call(this),(0,l.Z)((0,o.Z)(a),"markers",[]),(0,l.Z)((0,o.Z)(a),"markerLayerOption",void 0),(0,l.Z)((0,o.Z)(a),"clusterIndex",void 0),(0,l.Z)((0,o.Z)(a),"points",[]),(0,l.Z)((0,o.Z)(a),"clusterMarkers",[]),(0,l.Z)((0,o.Z)(a),"mapsService",void 0),(0,l.Z)((0,o.Z)(a),"scene",void 0),(0,l.Z)((0,o.Z)(a),"zoom",void 0),(0,l.Z)((0,o.Z)(a),"bbox",void 0),a.markerLayerOption=O()(a.getDefault(),t),(0,p.bindAll)(["update"],(0,o.Z)(a)),a.zoom=(null===(i=a.markerLayerOption.clusterOption)||void 0===i?void 0:i.zoom)||-99,a}return(0,i.Z)(n,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(t){return this.scene=t,this.mapsService=t.get(c.TYPES.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(t){if(this.markerLayerOption.cluster&&(this.addPoint(t,this.markers.length),this.mapsService)){var e=this.mapsService.getZoom(),n=this.mapsService.getBounds();this.bbox=(0,p.padBounds)(n,.5),this.zoom=Math.floor(e),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(t)}},{key:"removeMarker",value:function(t){this.markers.indexOf(t);var e=this.markers.indexOf(t);e>-1&&this.markers.splice(e,1)}},{key:"hide",value:function(){this.markers.map((function(t){t.getElement().style.opacity="0"})),this.clusterMarkers.map((function(t){t.getElement().style.opacity="0"}))}},{key:"show",value:function(){this.markers.map((function(t){t.getElement().style.opacity="1"})),this.clusterMarkers.map((function(t){t.getElement().style.opacity="1"}))}},{key:"getMarkers",value:function(){return this.markerLayerOption.cluster?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var t=this;this.getMarkers().forEach((function(e){e.addTo(t.scene)}))}},{key:"clear",value:function(){this.markers.forEach((function(t){t.remove()})),this.clusterMarkers.forEach((function(t){t.remove()})),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(t,e){var n=t.getLnglat(),r={geometry:{type:"Point",coordinates:[n.lng,n.lat]},properties:D(D({},t.getExtData()),{},{marker_id:e})};this.points.push(r),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(this.markerLayerOption.cluster){var t=this.markerLayerOption.clusterOption,e=t.radius,n=t.minZoom,r=void 0===n?0:n,i=t.maxZoom;this.clusterIndex=new(I())({radius:e,minZoom:r,maxZoom:i}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(t,e){var n=this,r=t[0].concat(t[1]),i=this.clusterIndex.getClusters(r,e);this.clusterMarkers.forEach((function(t){t.remove()})),this.clusterMarkers=[],i.forEach((function(t){var e,r=n.markerLayerOption.clusterOption,i=r.field,o=r.method;if(t.properties&&null!==(e=t.properties)&&void 0!==e&&e.cluster_id){var a,s=n.getLeaves(null===(a=t.properties)||void 0===a?void 0:a.cluster_id);if(t.properties.clusterData=s,i&&o){var u=null==s?void 0:s.map((function(t){return(0,l.Z)({},i,t.properties[i])})),c=p.Satistics.getColumn(u,i),h=p.Satistics.getSatByColumn(o,c),f="point_"+o;t.properties[f]=h.toFixed(2)}}var d=n.clusterMarker(t);n.clusterMarkers.push(d),d.addTo(n.scene)}))}},{key:"getLeaves",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return t?this.clusterIndex.getLeaves(t,e,n):null}},{key:"clusterMarker",value:function(t){var e=this.markerLayerOption.clusterOption.element,n=void 0===e?this.generateElement.bind(this):e;return new k({element:n(t)}).setLnglat({lng:t.geometry.coordinates[0],lat:t.geometry.coordinates[1]})}},{key:"normalMarker",value:function(t){var e=t.properties.marker_id;return this.markers[e]}},{key:"update",value:function(){if(this.mapsService){var t=this.mapsService.getZoom(),e=this.mapsService.getBounds();(!this.bbox||Math.abs(t-this.zoom)>=1||!(0,p.boundsContains)(this.bbox,e))&&(this.bbox=(0,p.padBounds)(e,.5),this.zoom=Math.floor(t),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(t){var e=p.DOM.create("div","l7-marker-cluster"),n=p.DOM.create("div","",e),r=p.DOM.create("span","",n),i=this.markerLayerOption.clusterOption,o=i.field,a=i.method;t.properties.point_count=t.properties.point_count||1;var s=o&&a?t.properties["point_"+a]||t.properties[o]:t.properties.point_count;return r.textContent=s,e}}]),n}(h.EventEmitter);function z(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function F(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?z(Object(n),!0).forEach((function(e){(0,l.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):z(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function B(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,u.Z)(t);if(e){var i=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,s.Z)(this,n)}}var j=function(t){(0,a.Z)(n,t);var e=B(n);function n(t){var i;return(0,r.Z)(this,n),i=e.call(this),(0,l.Z)((0,o.Z)(i),"popupOption",void 0),(0,l.Z)((0,o.Z)(i),"mapsService",void 0),(0,l.Z)((0,o.Z)(i),"sceneSerive",void 0),(0,l.Z)((0,o.Z)(i),"lngLat",void 0),(0,l.Z)((0,o.Z)(i),"content",void 0),(0,l.Z)((0,o.Z)(i),"closeButton",void 0),(0,l.Z)((0,o.Z)(i),"timeoutInstance",void 0),(0,l.Z)((0,o.Z)(i),"container",void 0),(0,l.Z)((0,o.Z)(i),"tip",void 0),(0,l.Z)((0,o.Z)(i),"scene",void 0),i.popupOption=F(F({},i.getdefault()),t),(0,p.bindAll)(["update","onClickClose","remove"],(0,o.Z)(i)),i}return(0,i.Z)(n,[{key:"addTo",value:function(t){var e=this;return this.mapsService=t.get(c.TYPES.IMapService),this.sceneSerive=t.get(c.TYPES.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=t,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout((function(){e.mapsService.on("click",e.onClickClose)}),30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(t){var e,n=window.document.createDocumentFragment(),r=window.document.createElement("body");for(r.innerHTML=t;e=r.firstChild;)n.appendChild(e);return this.setDOMContent(n)}},{key:"setLnglat",value:function(t){return this.lngLat=t,Array.isArray(t)&&(this.lngLat={lng:t[0],lat:t[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(t){return this.setDOMContent(window.document.createTextNode(t))}},{key:"setMaxWidth",value:function(t){return this.popupOption.maxWidth=t,this.update(),this}},{key:"setDOMContent",value:function(t){return this.createContent(),this.content.appendChild(t),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&p.DOM.remove(this.content),this.content=p.DOM.create("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=p.DOM.create("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(t,e,n){var r=window.document.createElement(t);return void 0!==e&&(r.className=e),n&&n.appendChild(r),r}},{key:"removeDom",value:function(t){t.parentNode&&t.parentNode.removeChild(t)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:p.anchorType.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(t){t.stopPropagation&&t.stopPropagation(),this.remove()}},{key:"update",value:function(){var t=this,e=this.lngLat,n=this.popupOption,r=n.className,i=n.maxWidth,o=n.anchor;if(this.mapsService&&e&&this.content){var a=this.mapsService.getMarkerContainer();if(!this.container&&a)this.container=this.creatDom("div","l7-popup",a),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),r&&r.split(" ").forEach((function(e){return t.container.classList.add(e)})),this.popupOption.stopPropagation&&["mousemove","mousedown","mouseup","click","dblclick"].forEach((function(e){t.container.addEventListener(e,(function(t){t.stopPropagation()}))})),this.container.style.whiteSpace="nowrap";i&&this.container.style.maxWidth!==i&&(this.container.style.maxWidth=i),this.updatePosition(),p.DOM.setTransform(this.container,"".concat(p.anchorTranslate[o])),(0,p.applyAnchorClass)(this.container,o,"popup")}}},{key:"updatePosition",value:function(){if(this.mapsService){var t=this.lngLat,e=t.lng,n=t.lat,r=this.popupOption.offsets,i=this.mapsService.lngLatToContainer([e,n]);this.container.style.left=i.x+r[0]+"px",this.container.style.top=i.y-r[1]+"px"}}}]),n}(h.EventEmitter);!function(t,e){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".l7-marker-container {\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  position: absolute;\n}\n\n.l7-marker {\n  position: absolute !important;\n  top: 0;\n  left: 0;\n  z-index: 5;\n  cursor: pointer;\n}\n\n.l7-marker-cluster {\n  background-clip: padding-box;\n  border-radius: 20px;\n  background-color: rgba(181, 226, 140, 0.6);\n  width: 40px;\n  height: 40px;\n}\n.l7-marker-cluster div {\n  width: 30px;\n  height: 30px;\n  margin-left: 5px;\n  margin-top: 5px;\n  text-align: center;\n  border-radius: 15px;\n  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;\n  background-color: rgba(110, 204, 57, 0.6);\n}\n.l7-marker-cluster span {\n  line-height: 30px;\n}\n\n.l7-popup-anchor-bottom,\n.l7-popup-anchor-bottom-left,\n.l7-popup-anchor-bottom-right {\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: reverse;\n      -ms-flex-direction: column-reverse;\n          flex-direction: column-reverse;\n}\n\n.l7-popup-close-button {\n  position: absolute;\n  right: 0;\n  top: 0;\n  border: 0;\n  border-radius: 0 3px 0 0;\n  cursor: pointer;\n  background-color: transparent;\n}\n\n.l7-popup-close-button:hover {\n  background-color: rgba(0, 0, 0, 0.05);\n}\n\n.l7-popup-content {\n  position: relative;\n  background: #fff;\n  border-radius: 3px;\n  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n  padding: 10px 10px 15px;\n  pointer-events: auto;\n}\n\n/* layers control */\n\n.l7-control-layers {\n  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);\n          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);\n  background: #fff;\n  border-radius: 5px;\n}\n.l7-popup-anchor-top,\n.l7-popup-anchor-top-left,\n.l7-popup-anchor-top-right {\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n\n.l7-popup-anchor-left {\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: row;\n          flex-direction: row;\n}\n\n.l7-popup-anchor-right {\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: reverse;\n      -ms-flex-direction: row-reverse;\n          flex-direction: row-reverse;\n}\n.l7-popup {\n  position: absolute;\n  top: 0;\n  left: 0;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  will-change: transform;\n  pointer-events: none;\n  z-index: 5;\n}\n.l7-popup-tip {\n  width: 0;\n  height: 0;\n  border: 10px solid transparent;\n  z-index: 1;\n}\n.l7-popup-anchor-top .l7-popup-tip {\n  -webkit-align-self: center;\n  -ms-flex-item-align: center;\n      align-self: center;\n  border-top: none;\n  border-bottom-color: #fff;\n}\n\n.l7-popup-anchor-top-left .l7-popup-tip {\n  -webkit-align-self: flex-start;\n  -ms-flex-item-align: start;\n      align-self: flex-start;\n  border-top: none;\n  border-left: none;\n  border-bottom-color: #fff;\n}\n\n.l7-popup-anchor-top-right .l7-popup-tip {\n  -webkit-align-self: flex-end;\n  -ms-flex-item-align: end;\n      align-self: flex-end;\n  border-top: none;\n  border-right: none;\n  border-bottom-color: #fff;\n}\n\n.l7-popup-anchor-bottom .l7-popup-tip {\n  -webkit-align-self: center;\n  -ms-flex-item-align: center;\n      align-self: center;\n  border-bottom: none;\n  border-top-color: #fff;\n}\n\n.l7-popup-anchor-bottom-left .l7-popup-tip {\n  -webkit-align-self: flex-start;\n  -ms-flex-item-align: start;\n      align-self: flex-start;\n  border-bottom: none;\n  border-left: none;\n  border-top-color: #fff;\n}\n\n.l7-popup-anchor-bottom-right .l7-popup-tip {\n  -webkit-align-self: flex-end;\n  -ms-flex-item-align: end;\n      align-self: flex-end;\n  border-bottom: none;\n  border-right: none;\n  border-top-color: #fff;\n}\n\n.l7-popup-anchor-left .l7-popup-tip {\n  -webkit-align-self: center;\n  -ms-flex-item-align: center;\n      align-self: center;\n  border-left: none;\n  border-right-color: #fff;\n}\n\n.l7-popup-anchor-right .l7-popup-tip {\n  -webkit-align-self: center;\n  -ms-flex-item-align: center;\n      align-self: center;\n  border-right: none;\n  border-left-color: #fff;\n}\n\n.l7-popup-close-button {\n  position: absolute;\n  right: 0;\n  top: 0;\n  border: 0;\n  padding: 0;\n  font-size: 25px;\n  line-height: 20px;\n  border-radius: 0 3px 0 0;\n  cursor: pointer;\n  background-color: transparent;\n}\n\n.l7-popup-close-button:hover {\n  background-color: rgba(0, 0, 0, 0.05);\n}\n\n.l7-popup-content {\n  position: relative;\n  background: #fff;\n  border-radius: 3px;\n  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n  padding: 10px 10px 15px;\n  pointer-events: auto;\n}\n\n.l7-popup-anchor-top-left .l7-popup-content {\n  border-top-left-radius: 0;\n}\n\n.l7-popup-anchor-top-right .l7-popup-content {\n  border-top-right-radius: 0;\n}\n\n.l7-popup-anchor-bottom-left .l7-popup-content {\n  border-bottom-left-radius: 0;\n}\n\n.l7-popup-anchor-bottom-right .l7-popup-content {\n  border-bottom-right-radius: 0;\n}\n\n.l7-popup-track-pointer {\n  display: none;\n}\n\n.l7-popup-track-pointer * {\n  pointer-events: none;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n}\n\n.l7-map:hover .l7-popup-track-pointer {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n}\n\n.l7-map:active .l7-popup-track-pointer {\n  display: none;\n}\n\n.l7-popup-close-button:hover {\n  background-color: rgba(0, 0, 0, 0.05);\n}\n\n.l7-popup-content {\n  position: relative;\n  background: #fff;\n  border-radius: 3px;\n  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n  padding: 10px 10px 15px;\n  pointer-events: auto;\n}\n\n/* general toolbar styles */\n\n.l7-bar {\n  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);\n          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);\n  border-radius: 4px;\n}\n.l7-bar a,\n.l7-bar a:hover {\n  background-color: #fff;\n  width: 30px;\n  height: 30px;\n  font-size: 20px;\n  display: block;\n  text-align: center;\n  text-decoration: none;\n  color: #8e9dab;\n}\n.l7-bar a,\n.l7-control-layers-toggle {\n  background-position: 50% 50%;\n  background-repeat: no-repeat;\n  display: block;\n}\n.l7-bar a:hover {\n  background-color: #f4f4f4;\n}\n.l7-bar a:first-child {\n  border-top-left-radius: 2px;\n  border-top-right-radius: 2px;\n}\n.l7-bar a:last-child {\n  border-bottom-left-radius: 2px;\n  border-bottom-right-radius: 2px;\n  border-bottom: none;\n}\n.l7-bar a.l7-disabled {\n  cursor: default;\n  background-color: #f4f4f4;\n  color: #bbb;\n}\n\n/* control positioning */\n\n.l7-control-container {\n  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;\n}\n.l7-control-hide {\n  display: none;\n}\n.l7-control {\n  position: relative;\n  z-index: 800;\n  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */\n  pointer-events: auto;\n}\n.l7-control {\n  float: left;\n  clear: both;\n}\n.l7-top,\n.l7-bottom {\n  position: absolute;\n  z-index: 1000;\n  pointer-events: none;\n}\n.l7-top {\n  top: 0;\n}\n.l7-right {\n  right: 0;\n}\n.l7-bottom {\n  bottom: 0;\n}\n.l7-left {\n  left: 0;\n}\n.l7-center {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  position: absolute;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n}\n.l7-bottom.l7-center,\n.l7-top.l7-center {\n  width: 100%;\n}\n.l7-right.l7-center,\n.l7-left.l7-center {\n  height: 100%;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n\n.l7-top.l7-center,\n.l7-left.l7-center {\n  -webkit-box-align: start;\n      -ms-flex-align: start;\n          align-items: flex-start;\n}\n\n.l7-bottom.l7-center,\n.l7-right.l7-center {\n  -webkit-box-align: end;\n      -ms-flex-align: end;\n          align-items: flex-end;\n}\n\n.l7-center .l7-control {\n  margin-right: 10px;\n  margin-bottom: 10px;\n}\n\n.l7-control {\n  float: left;\n  clear: both;\n}\n.l7-right .l7-control {\n  float: right;\n}\n.l7-top .l7-control {\n  margin-top: 10px;\n}\n.l7-bottom .l7-control {\n  margin-bottom: 10px;\n}\n.l7-left .l7-control {\n  margin-left: 10px;\n}\n.l7-right .l7-control {\n  margin-right: 10px;\n}\n\n/* attribution and scale controls */\n\n.l7-control-container .l7-control-attribution {\n  background: #fff;\n  background: rgba(59, 58, 58, 0.7);\n  margin: 0;\n}\n.l7-control-attribution,\n.l7-control-scale-line {\n  padding: 0 5px;\n  color: #333;\n}\n.l7-control-attribution a {\n  text-decoration: none;\n}\n.l7-control-attribution a:hover {\n  text-decoration: underline;\n}\n.l7-container .l7-control-attribution,\n.l7-container .l7-control-scale {\n  font-size: 11px;\n  padding: 5px 5px 2px 5px;\n  background: rgba(255, 255, 255, 0.7);\n}\n.l7-left .l7-control-scale {\n  margin-left: 5px;\n}\n.l7-bottom .l7-control-scale {\n  margin-bottom: 5px;\n}\n.l7-control-scale-line {\n  border: 2px solid #000;\n  border-top: none;\n  color: #000;\n  line-height: 1.1;\n  padding: 2px 5px 1px;\n  font-size: 11px;\n  white-space: nowrap;\n  overflow: hidden;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n\n  background: #fff;\n}\n.l7-control-scale-line:not(:first-child) {\n  border-top: 2px solid #777;\n  border-bottom: none;\n  margin-top: -2px;\n}\n.l7-control-scale-line:not(:first-child):not(:last-child) {\n  border-bottom: 2px solid #777;\n}\n\n.l7-touch .l7-control-attribution,\n.l7-touch .l7-control-layers,\n.l7-touch .l7-bar {\n  -webkit-box-shadow: none;\n          box-shadow: none;\n}\n.l7-touch .l7-control-layers,\n.l7-touch .l7-bar {\n  border: 2px solid rgba(0, 0, 0, 0.2);\n  background-clip: padding-box;\n}\n/*logo */\n\n.l7-ctrl-logo {\n  background-size: 100% 100%;\n  width: 89px;\n  height: 16px;\n  margin: 0 0 -3px -3px;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  background-repeat: no-repeat;\n  cursor: pointer;\n  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');\n}\n\n/* layers control */\n\n.l7-control-layers {\n  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);\n          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);\n  background: #fff;\n  border-radius: 2px;\n}\n.l7-control-layers-toggle {\n  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');\n  width: 30px;\n  height: 30px;\n  background-size: 20px 20px;\n}\n\n.l7-touch .l7-control-layers-toggle {\n  width: 44px;\n  height: 44px;\n}\n.l7-control-layers .l7-control-layers-list,\n.l7-control-layers-expanded .l7-control-layers-toggle {\n  display: none;\n}\n.l7-control-layers-expanded .l7-control-layers-list {\n  display: block;\n  position: relative;\n}\n.l7-control-layers-expanded {\n  padding: 6px 10px 6px 6px;\n  color: #59626b;\n  background: #fff;\n}\n.l7-control-layers-scrollbar {\n  overflow-y: scroll;\n  overflow-x: hidden;\n  padding-right: 5px;\n}\n.l7-control-layers-selector {\n  margin-top: 2px;\n  position: relative;\n  top: 1px;\n}\n.l7-control-layers label {\n  display: block;\n  padding: 8px;\n}\n.l7-control-layers label input[type='radio'],\n.l7-control-layers label input[type='checkbox'] {\n  width: 14px;\n  height: 14px;\n  margin: 0;\n}\n.l7-control-layers-separator {\n  height: 0;\n  border-top: 1px solid #d8d8d8;\n  margin: 5px -10px 5px -6px;\n}\n.mapboxgl-ctrl-logo {\n  display: none !important;\n}\n.amap-logo {\n  display: none !important;\n}\n")},20832:function(t,e,n){"use strict";n.r(e),n.d(e,{AttributeType:function(){return Ei},BasePostProcessingPass:function(){return nr},BlendType:function(){return bi},CameraUniform:function(){return Pi},CoordinateSystem:function(){return tt},CoordinateUniform:function(){return bt},InteractionEvent:function(){return vt},MapServiceEvent:function(){return ki},PassType:function(){return xn},PositionType:function(){return Mi},ScaleTypes:function(){return wi},SceneEventList:function(){return Oi},StyleScaleType:function(){return Si},TYPES:function(){return s},container:function(){return fi},createLayerContainer:function(){return mi},createSceneContainer:function(){return vi},gl:function(){return At},lazyInject:function(){return pi},lazyMultiInject:function(){return hi},packCircleVertex:function(){return Ai}});n(28660);var r=n(26729),i=n.n(r),o=n(86700),a=n(84879),s={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},u=n(15671),l=n(43144),c=n(4942),p=n(35251),h=n(31745),f=n.n(h);function d(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function v(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?d(Object(n),!0).forEach((function(e){(0,c.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function m(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return y(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return y(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var g;function _(t,e,n){var r,i=m(e);try{for(i.s();!(r=i.n()).done;){var o=r.value,a=o.icon,s=o.xOffset;t[a.id]=v(v({},a),{},{x:s,y:n,image:a.image,width:a.width,height:a.height})}}catch(t){i.e(t)}finally{i.f()}}function x(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function b(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return w(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return w(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function w(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function S(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function E(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?S(Object(n),!0).forEach((function(e){(0,c.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var C=function(){for(var t=[],e=32;e<128;e++)t.push(String.fromCharCode(e));return t}();function T(t,e,n,r){t.font="".concat(r," ").concat(n,"px ").concat(e),t.fillStyle="black",t.textBaseline="middle"}function A(t,e){for(var n=0;n<t.length;n++)e.data[4*n+3]=t[n]}var M,k=(0,o.b2)()(g=function(){function t(){(0,u.Z)(this,t),(0,c.Z)(this,"fontAtlas",void 0),(0,c.Z)(this,"iconFontMap",void 0),(0,c.Z)(this,"iconFontGlyphs",{}),(0,c.Z)(this,"fontOptions",void 0),(0,c.Z)(this,"key",void 0),(0,c.Z)(this,"cache",new p.LRUCache(3))}return(0,l.Z)(t,[{key:"scale",get:function(){return 1}},{key:"canvas",get:function(){var t=this.cache.get(this.key);return t&&t.data}},{key:"mapping",get:function(){var t=this.cache.get(this.key);return t&&t.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:"sans-serif",fontWeight:"normal",characterSet:C,fontSize:24,buffer:3,sdf:!0,cutoff:.25,radius:8,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(t){var e=this;t.forEach((function(t){e.iconFontGlyphs[t.name]=t.unicode}))}},{key:"addIconFont",value:function(t,e){this.iconFontMap.set(t,e)}},{key:"getIconFontKey",value:function(t){return this.iconFontMap.get(t)||t}},{key:"getGlyph",value:function(t){return this.iconFontGlyphs[t]?String.fromCharCode(parseInt(this.iconFontGlyphs[t],16)):""}},{key:"setFontOptions",value:function(t){this.fontOptions=E(E({},this.fontOptions),t),this.key=this.getKey();var e=this.getNewChars(this.key,this.fontOptions.characterSet),n=this.cache.get(this.key);if(!n||0!==e.length){var r=this.generateFontAtlas(this.key,e,n);this.fontAtlas=r,this.cache.set(this.key,r)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(t,e,n){var r=this.fontOptions,i=r.fontFamily,o=r.fontWeight,a=r.fontSize,s=r.buffer,u=r.sdf,l=r.radius,c=r.cutoff,h=r.iconfont,d=n&&n.data;d||((d=p.$window.document.createElement("canvas")).width=1024);var v=d.getContext("2d");T(v,i,a,o);var m=function(t){var e=t.characterSet,n=t.getFontWidth,r=t.fontHeight,i=t.buffer,o=t.maxCanvasWidth,a=t.mapping,s=void 0===a?{}:a,u=t.xOffset,l=void 0===u?0:u,c=t.yOffset,p=void 0===c?0:c,h=0,f=l;Array.from(e).forEach((function(t,e){if(!s[t]){var r=n(t,e);f+30>o&&(f=0,h++),s[t]={x:f,y:p+30*h,width:30,height:30,advance:r},f+=30}}));var d=r+2*i;return{mapping:s,xOffset:f,yOffset:p+h*d,canvasHeight:x(p+(h+1)*d)}}(E({getFontWidth:function(t){return v.measureText(t).width},fontHeight:1*a,buffer:s,characterSet:e,maxCanvasWidth:1024},n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset})),y=m.mapping,g=m.canvasHeight,_=m.xOffset,w=m.yOffset,S=v.getImageData(0,0,d.width,d.height);if(d.height=g,v.putImageData(S,0,0),T(v,i,a,o),u){var C,M=new(f())(a,s,l,c,i,o),k=v.getImageData(0,0,M.size,M.size),P=b(e);try{for(P.s();!(C=P.n()).done;){var O=C.value;if(h){var L=String.fromCharCode(parseInt(O.replace("&#x","").replace(";",""),16));A(M.draw(L),k)}else A(M.draw(O),k);v.putImageData(k,y[O].x,y[O].y)}}catch(t){P.e(t)}finally{P.f()}}else{var I,R=b(e);try{for(R.s();!(I=R.n()).done;){var D=I.value;v.fillText(D,y[D].x,y[D].y+1*a)}}catch(t){R.e(t)}finally{R.f()}}return{xOffset:_,yOffset:w,mapping:y,data:d,width:d.width,height:d.height}}},{key:"getKey",value:function(){return"key"}},{key:"getNewChars",value:function(t,e){var n=this.cache.get(t);if(!n)return e;var r=[],i=n.mapping,o=new Set(Object.keys(i));return new Set(e).forEach((function(t){o.has(t)||r.push(t)})),r}}]),t}())||g,P=n(97326),O=n(60136),L=n(82963),I=n(61120);function R(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,I.Z)(t);if(e){var i=(0,I.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,L.Z)(this,n)}}var D,N,Z=(0,o.b2)()(M=function(t){(0,O.Z)(n,t);var e=R(n);function n(){var t;(0,u.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,c.Z)((0,P.Z)(t),"canvasHeight",128),(0,c.Z)((0,P.Z)(t),"texture",void 0),(0,c.Z)((0,P.Z)(t),"canvas",void 0),(0,c.Z)((0,P.Z)(t),"iconData",void 0),(0,c.Z)((0,P.Z)(t),"iconMap",void 0),(0,c.Z)((0,P.Z)(t),"ctx",void 0),(0,c.Z)((0,P.Z)(t),"loadingImageCount",0),t}return(0,l.Z)(n,[{key:"isLoading",value:function(){return 0===this.loadingImageCount}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=p.$window.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(t,e){var n=this,r=new Image;if(this.loadingImageCount++,this.hasImage(t))throw new Error("Image Id already exists");this.iconData.push({id:t,size:64}),this.updateIconMap(),this.loadImage(e).then((function(e){r=e;var i=n.iconData.find((function(e){return e.id===t}));i&&(i.image=r,i.width=r.width,i.height=r.height),n.update()}))}},{key:"addImageMini",value:function(t,e,n){var r=this,i=n.getSceneConfig().canvas,o=i.createImage();if(this.loadingImageCount++,this.hasImage(t))throw new Error("Image Id already exists");this.iconData.push({id:t,size:64}),this.updateIconMap(),this.loadImageMini(e,i).then((function(e){o=e;var n=r.iconData.find((function(e){return e.id===t}));n&&(n.image=o,n.width=o.width,n.height=o.height),r.update()}))}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(t){return this.iconMap.hasOwnProperty(t)}},{key:"removeImage",value:function(t){this.hasImage(t)&&(this.iconData=this.iconData.filter((function(e){return e.id!==t})),delete this.iconMap[t],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(t){return new Promise((function(e,n){if(t instanceof HTMLImageElement)e(t);else{var r=new Image;r.crossOrigin="anonymous",r.onload=function(){e(r)},r.onerror=function(){n(new Error("Could not load image at "+t))},r.src=t instanceof File?URL.createObjectURL(t):t}}))}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,0===this.loadingImageCount&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var t=this;this.canvas.width=1024,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach((function(e){var n=t.iconMap[e],r=n.x,i=n.y,o=n.image,a=n.width,s=void 0===a?64:a,u=n.height,l=void 0===u?64:u,c=Math.max(s,l)/64,p=l/c,h=s/c;o&&t.ctx.drawImage(o,r+(64-h)/2,i+(64-p)/2,h,p)}))}},{key:"updateIconMap",value:function(){var t=function(t,e,n){var r,i=0,o=0,a=0,s=[],u={},l=m(t);try{for(l.s();!(r=l.n()).done;){var c=r.value;if(!u[c.id]){var p=c.size;i+p+e>n&&(_(u,s,o),i=0,o=a+o+e,a=0,s=[]),s.push({icon:c,xOffset:i}),i=i+p+e,a=Math.max(a,p)}}}catch(t){l.e(t)}finally{l.f()}return s.length>0&&_(u,s,o),{mapping:u,canvasHeight:x(a+o+e)}}(this.iconData,3,1024),e=t.mapping,n=t.canvasHeight;this.iconMap=e,this.canvasHeight=n}},{key:"loadImageMini",value:function(t,e){return new Promise((function(n,r){var i=e.createImage();i.crossOrigin="anonymous",i.onload=function(){n(i)},i.onerror=function(){r(new Error("Could not load image at "+t))},i.src=t}))}}]),n}(r.EventEmitter))||M,z=n(29439),F=n(85975),B=(0,o.b2)()(D=function(){function t(){(0,u.Z)(this,t),(0,c.Z)(this,"viewport",void 0),(0,c.Z)(this,"overridedViewProjectionMatrix",void 0),(0,c.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,c.Z)(this,"jitteredProjectionMatrix",void 0),(0,c.Z)(this,"viewMatrixInverse",void 0),(0,c.Z)(this,"cameraPosition",void 0)}return(0,l.Z)(t,[{key:"init",value:function(){}},{key:"update",value:function(t){this.viewport=t,this.viewMatrixInverse=F.create(),F.invert(this.viewMatrixInverse,t.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var t=this.viewport.getCenter(),e=(0,z.Z)(t,2);return[e[0],e[1]]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(t,e){return this.viewport.projectFlat(t,e)}},{key:"setViewProjectionMatrix",value:function(t){this.overridedViewProjectionMatrix=t}},{key:"jitterProjectionMatrix",value:function(t,e){var n=F.fromTranslation(F.create(),[t,e,0]);this.jitteredProjectionMatrix=F.multiply(F.create(),n,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=F.multiply(F.create(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),t}())||D;function j(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return U(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return U(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function U(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var V,G,H,W=(0,o.b2)()(N=function(){function t(){(0,u.Z)(this,t),(0,c.Z)(this,"container",void 0),(0,c.Z)(this,"controlCorners",void 0),(0,c.Z)(this,"controlContainer",void 0),(0,c.Z)(this,"scene",void 0),(0,c.Z)(this,"mapsService",void 0),(0,c.Z)(this,"controls",[]),(0,c.Z)(this,"unAddControls",[])}return(0,l.Z)(t,[{key:"init",value:function(t,e){this.container=t.container,this.scene=e,this.mapsService=e.get(s.IMapService),this.initControlPos()}},{key:"addControl",value:function(t,e){e.get(s.IMapService).map?(t.addTo(this.scene),this.controls.push(t)):this.unAddControls.push(t)}},{key:"getControlByName",value:function(t){return this.controls.find((function(e){return e.controlOption.name===t}))}},{key:"removeControl",value:function(t){var e=this.controls.indexOf(t);return e>-1&&this.controls.splice(e,1),t.remove(),this}},{key:"addControls",value:function(){var t=this;this.unAddControls.forEach((function(e){e.addTo(t.scene),t.controls.push(e)})),this.unAddControls=[]}},{key:"destroy",value:function(){var t,e=j(this.controls);try{for(e.s();!(t=e.n()).done;){t.value.remove()}}catch(t){e.e(t)}finally{e.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var t=this.controlCorners={},e="l7-",n=this.controlContainer=p.DOM.create("div",e+"control-container",this.container);function r(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=r.map((function(t){return e+t})).join(" ");t[r.join("")]=p.DOM.create("div",i,n)}r(["top","left"]),r(["top","right"]),r(["bottom","left"]),r(["bottom","right"]),r(["top","center"]),r(["right","center"]),r(["left","center"]),r(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var t in this.controlCorners)this.controlCorners[t]&&p.DOM.remove(this.controlCorners[t]);this.controlContainer&&p.DOM.remove(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),t}())||N,q=(0,o.b2)()(V=function(){function t(){(0,u.Z)(this,t),(0,c.Z)(this,"container",void 0),(0,c.Z)(this,"scene",void 0),(0,c.Z)(this,"mapsService",void 0),(0,c.Z)(this,"markers",[]),(0,c.Z)(this,"markerLayers",[]),(0,c.Z)(this,"unAddMarkers",[]),(0,c.Z)(this,"unAddMarkerLayers",[])}return(0,l.Z)(t,[{key:"addMarkerLayer",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(t),t.addTo(this.scene)):this.unAddMarkerLayers.push(t)}},{key:"removeMarkerLayer",value:function(t){t.destroy(),this.markerLayers.indexOf(t);var e=this.markerLayers.indexOf(t);e>-1&&this.markerLayers.splice(e,1)}},{key:"addMarker",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(t),t.addTo(this.scene)):this.unAddMarkers.push(t)}},{key:"addMarkers",value:function(){var t=this;this.unAddMarkers.forEach((function(e){e.addTo(t.scene),t.markers.push(e)})),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var t=this;this.unAddMarkerLayers.forEach((function(e){t.markerLayers.push(e),e.addTo(t.scene)})),this.unAddMarkers=[]}},{key:"removeMarker",value:function(t){t.remove(),this.markers.indexOf(t);var e=this.markers.indexOf(t);e>-1&&this.markers.splice(e,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(s.IMapService)}},{key:"destroy",value:function(){this.markers.forEach((function(t){t.remove()})),this.markers=[],this.markerLayers.forEach((function(t){t.destroy()})),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(t){t.destroy()}}]),t}())||V,X=(0,o.b2)()(G=function(){function t(){(0,u.Z)(this,t),(0,c.Z)(this,"scene",void 0),(0,c.Z)(this,"popup",void 0),(0,c.Z)(this,"mapsService",void 0),(0,c.Z)(this,"unAddPopup",void 0)}return(0,l.Z)(t,[{key:"removePopup",value:function(t){t.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(t){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(t.addTo(this.scene),this.popup=t):this.unAddPopup=t}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(s.IMapService)}}]),t}())||G,Y=n(82492),K=n.n(Y),Q={MapToken:"您正在使用 Demo测试地图token，如果生产环境中使用去对应地图请注册Token",SDK:"请确认引入了mapbox-gl api且在L7之前引入"};function J(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function $(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?J(Object(n),!0).forEach((function(e){(0,c.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):J(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var tt,et={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},nt={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},rt=(0,o.b2)()(H=function(){function t(){(0,u.Z)(this,t),(0,c.Z)(this,"sceneConfigCache",{}),(0,c.Z)(this,"layerConfigCache",{})}return(0,l.Z)(t,[{key:"getSceneConfig",value:function(t){return this.sceneConfigCache[t]}},{key:"getSceneWarninfo",value:function(t){return Q[t]}},{key:"setSceneConfig",value:function(t,e){this.sceneConfigCache[t]=$($({},et),e)}},{key:"getLayerConfig",value:function(t){return this.layerConfigCache[t]}},{key:"setLayerConfig",value:function(t,e,n){this.layerConfigCache[e]=$({},K()({},this.sceneConfigCache[t],nt,n))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),t}())||H,it=n(43269),ot=n(53229),at=n(98333),st=Math.PI/180,ut=4003e4;function lt(t){var e=t.latitude,n=void 0===e?0:e,r=t.zoom,i=void 0===r?0:r,o=t.scale,a=t.highPrecision,s=void 0!==a&&a,u=t.flipY,l=void 0!==u&&u,c={},p=512*(o=void 0!==o?o:Math.pow(2,i)),h=Math.cos(n*st),f=p/360,d=f/h,v=p/ut/h;if(c.pixelsPerMeter=[v,-v,v],c.metersPerPixel=[1/v,-1/v,1/v],c.pixelsPerDegree=[f,-d,v],c.degreesPerPixel=[1/f,-1/d,1/v],s){var m=st*Math.tan(n*st)/h,y=f*m/2,g=p/ut*m,_=g/d*v;c.pixelsPerDegree2=[0,-y,g],c.pixelsPerMeter2=[_,0,_],l&&(c.pixelsPerDegree2[1]=-c.pixelsPerDegree2[1],c.pixelsPerMeter2[1]=-c.pixelsPerMeter2[1])}return l&&(c.pixelsPerMeter[1]=-c.pixelsPerMeter[1],c.metersPerPixel[1]=-c.metersPerPixel[1],c.pixelsPerDegree[1]=-c.pixelsPerDegree[1],c.degreesPerPixel[1]=-c.degreesPerPixel[1]),c}!function(t){t[t.LNGLAT=1]="LNGLAT",t[t.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",t[t.VECTOR_TILE=3]="VECTOR_TILE",t[t.IDENTITY=4]="IDENTITY",t[t.P20=5]="P20",t[t.P20_OFFSET=6]="P20_OFFSET",t[t.METER_OFFSET=7]="METER_OFFSET",t[t.P20_2=8]="P20_2"}(tt||(tt={}));var ct,pt,ht,ft,dt,vt,mt,yt,gt,_t,xt,bt={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},wt=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],St=(ct=(0,o.b2)(),pt=(0,o.f3)(s.ICameraService),ct((ft=function(){function t(){(0,u.Z)(this,t),(0,c.Z)(this,"needRefresh",!0),(0,it.Z)(this,"cameraService",dt,this),(0,c.Z)(this,"coordinateSystem",void 0),(0,c.Z)(this,"viewportCenter",void 0),(0,c.Z)(this,"viewportCenterProjection",void 0),(0,c.Z)(this,"pixelsPerDegree",void 0),(0,c.Z)(this,"pixelsPerDegree2",void 0),(0,c.Z)(this,"pixelsPerMeter",void 0)}return(0,l.Z)(t,[{key:"refresh",value:function(){var t=this.cameraService.getZoom(),e=this.cameraService.getZoomScale(),n=this.cameraService.getCenter(),r=lt({latitude:n[1],zoom:t}),i=r.pixelsPerMeter,o=r.pixelsPerDegree;this.viewportCenter=n,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=i,this.pixelsPerDegree=o,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===tt.LNGLAT||this.coordinateSystem===tt.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===tt.LNGLAT_OFFSET?this.calculateLnglatOffset(n,t):this.coordinateSystem===tt.P20_OFFSET&&this.calculateLnglatOffset(n,t,e,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(t){this.coordinateSystem=t}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(t,e,n,r){var i=lt({latitude:t[1],zoom:e,scale:n,flipY:r,highPrecision:!0}),o=i.pixelsPerMeter,a=i.pixelsPerDegree,s=i.pixelsPerDegree2,u=this.cameraService.getViewMatrix(),l=this.cameraService.getProjectionMatrix(),c=F.multiply([],l,u),p=this.cameraService.projectFlat([Math.fround(t[0]),Math.fround(t[1])],Math.pow(2,e));this.viewportCenterProjection=at.fF([],[p[0],p[1],0,1],c),u=this.cameraService.getViewMatrixUncentered()||u,c=F.multiply([],l,u),c=F.multiply([],c,wt),this.cameraService.setViewProjectionMatrix(c),this.pixelsPerMeter=o,this.pixelsPerDegree=a,this.pixelsPerDegree2=s}}]),t}(),dt=(0,ot.Z)(ft.prototype,"cameraService",[pt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ht=ft))||ht),Et=n(20396),Ct=n.n(Et);function Tt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,I.Z)(t);if(e){var i=(0,I.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,L.Z)(this,n)}}!function(t){t.Hover="hover",t.Click="click",t.Select="select",t.Active="active",t.Drag="drag"}(vt||(vt={}));var At,Mt,kt,Pt,Ot,Lt,It,Rt,Dt,Nt,Zt,zt,Ft,Bt,jt={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},Ut=(mt=(0,o.b2)(),yt=(0,o.f3)(s.IMapService),mt((_t=function(t){(0,O.Z)(n,t);var e=Tt(n);function n(){var t;(0,u.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,c.Z)((0,P.Z)(t),"indragging",!1),(0,it.Z)((0,P.Z)(t),"mapService",xt,(0,P.Z)(t)),(0,c.Z)((0,P.Z)(t),"hammertime",void 0),(0,c.Z)((0,P.Z)(t),"lastClickTime",0),(0,c.Z)((0,P.Z)(t),"lastClickXY",[-1,-1]),(0,c.Z)((0,P.Z)(t),"clickTimer",void 0),(0,c.Z)((0,P.Z)(t),"$containter",void 0),(0,c.Z)((0,P.Z)(t),"onDrag",(function(e){var n=t.interactionEvent(e);n.type=jt[n.type],"dragging"===n.type?t.indragging=!0:t.indragging=!1,t.emit(vt.Drag,n)})),(0,c.Z)((0,P.Z)(t),"onHammer",(function(e){e.srcEvent.stopPropagation();var n=t.interactionEvent(e);t.emit(vt.Hover,n)})),(0,c.Z)((0,P.Z)(t),"onTouch",(function(e){var n=e.touches[0];t.onHover({x:n.pageX,y:n.pageY,type:"touch"})})),(0,c.Z)((0,P.Z)(t),"onHover",(function(e){var n=e.clientX,r=e.clientY,i=e.type,o=t.mapService.getMapContainer();if(o)if(p.isMini)n=n-o.left-0,r=r-o.top-0;else{var a=o.getBoundingClientRect(),s=a.top;n=n-a.left-o.clientLeft,r=r-s-o.clientTop}var u=t.mapService.containerToLngLat([n,r]);if("click"!==i)"touch"!==i?"click"!==i&&"dblclick"!==i&&t.emit(vt.Hover,{x:n,y:r,lngLat:u,type:i,target:e}):t.isDoubleTap(n,r,u);else{if(!p.isMini&&"ontouchstart"in document.documentElement==!0)return;t.isDoubleTap(n,r,u)}})),t}return(0,l.Z)(n,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(vt.Hover)}},{key:"triggerHover",value:function(t){var e=t.x,n=t.y;this.emit(vt.Hover,{x:e,y:n})}},{key:"triggerSelect",value:function(t){this.emit(vt.Select,{featureId:t})}},{key:"triggerActive",value:function(t){this.emit(vt.Active,{featureId:t})}},{key:"handleMiniEvent",value:function(t){this.onHover({clientX:t.touches[0].pageX,clientY:t.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var t=this.mapService.getMapContainer();if(t)if(p.isMini)p.$window.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var e=new(Ct().Manager)(t);e.add(new(Ct().Tap)({event:"dblclick",taps:2})),e.add(new(Ct().Tap)({event:"click"})),e.add(new(Ct().Pan)({threshold:0,pointers:0})),e.add(new(Ct().Press)({})),e.on("dblclick click",this.onHammer),e.on("panstart panmove panend pancancel",this.onDrag),t.addEventListener("mousemove",this.onHover),t.addEventListener("mousedown",this.onHover,!0),t.addEventListener("mouseup",this.onHover),t.addEventListener("contextmenu",this.onHover),this.hammertime=e}}},{key:"removeEventListenerOnMap",value:function(){if(p.isMini)p.$window.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var t=this.mapService.getMapContainer();t&&(t.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),t.removeEventListener("mousedown",this.onHover),t.removeEventListener("mouseup",this.onHover),t.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(t){var e,n,r=t.type;"touch"===t.pointerType?(n=Math.floor(t.pointers[0].clientY),e=Math.floor(t.pointers[0].clientX)):(n=Math.floor(t.srcEvent.y),e=Math.floor(t.srcEvent.x));var i=this.mapService.getMapContainer();if(i){var o=i.getBoundingClientRect(),a=o.top;e-=o.left,n-=a}return{x:e,y:n,lngLat:this.mapService.containerToLngLat([e,n]),type:r,target:t.srcEvent}}},{key:"isDoubleTap",value:function(t,e,n){var r=this,i=(new Date).getTime(),o="click";i-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-t)<10&&Math.abs(this.lastClickXY[1]-e)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),o="dblclick",this.emit(vt.Hover,{x:t,y:e,lngLat:n,type:o})):(this.lastClickTime=i,this.lastClickXY=[t,e],this.clickTimer=setTimeout((function(){o="click",r.emit(vt.Hover,{x:t,y:e,lngLat:n,type:o})}),400))}}]),n}(i()),xt=(0,ot.Z)(_t.prototype,"mapService",[yt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gt=_t))||gt),Vt=n(15861),Gt=n(87757),Ht=n.n(Gt),Wt=0;function qt(t){if(p.isMini)return null;var e=t;if("string"==typeof t&&(e=document.getElementById(t)),e){var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      z-index:2;\n      height: 100%;\n      width: 100%;\n      pointer-events: none;\n    ",n.id="l7-scene-".concat(Wt++),n.classList.add("l7-scene"),e.appendChild(n),n}return null}function Xt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Yt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Xt(Object(n),!0).forEach((function(e){(0,c.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Xt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}!function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.MAX_EXT=32776]="MAX_EXT",t[t.MIN_EXT=32775]="MIN_EXT",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.CULL_FACE=2884]="CULL_FACE",t[t.BLEND=3042]="BLEND",t[t.DITHER=3024]="DITHER",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.TEXTURE1=33985]="TEXTURE1",t[t.TEXTURE2=33986]="TEXTURE2",t[t.TEXTURE3=33987]="TEXTURE3",t[t.TEXTURE4=33988]="TEXTURE4",t[t.TEXTURE5=33989]="TEXTURE5",t[t.TEXTURE6=33990]="TEXTURE6",t[t.TEXTURE7=33991]="TEXTURE7",t[t.TEXTURE8=33992]="TEXTURE8",t[t.TEXTURE9=33993]="TEXTURE9",t[t.TEXTURE10=33994]="TEXTURE10",t[t.TEXTURE11=33995]="TEXTURE11",t[t.TEXTURE12=33996]="TEXTURE12",t[t.TEXTURE13=33997]="TEXTURE13",t[t.TEXTURE14=33998]="TEXTURE14",t[t.TEXTURE15=33999]="TEXTURE15",t[t.TEXTURE16=34e3]="TEXTURE16",t[t.TEXTURE17=34001]="TEXTURE17",t[t.TEXTURE18=34002]="TEXTURE18",t[t.TEXTURE19=34003]="TEXTURE19",t[t.TEXTURE20=34004]="TEXTURE20",t[t.TEXTURE21=34005]="TEXTURE21",t[t.TEXTURE22=34006]="TEXTURE22",t[t.TEXTURE23=34007]="TEXTURE23",t[t.TEXTURE24=34008]="TEXTURE24",t[t.TEXTURE25=34009]="TEXTURE25",t[t.TEXTURE26=34010]="TEXTURE26",t[t.TEXTURE27=34011]="TEXTURE27",t[t.TEXTURE28=34012]="TEXTURE28",t[t.TEXTURE29=34013]="TEXTURE29",t[t.TEXTURE30=34014]="TEXTURE30",t[t.TEXTURE31=34015]="TEXTURE31",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"}(At||(At={}));var Kt,Qt,Jt,$t,te,ee,ne,re,ie,oe=(Mt=(0,o.b2)(),kt=(0,o.f3)(s.IMapService),Pt=(0,o.f3)(s.IRendererService),Ot=(0,o.f3)(s.IGlobalConfigService),Lt=(0,o.f3)(s.IInteractionService),It=(0,o.f3)(s.ILayerService),Mt((Dt=function(){function t(){var e=this;(0,u.Z)(this,t),(0,it.Z)(this,"mapService",Nt,this),(0,it.Z)(this,"rendererService",Zt,this),(0,it.Z)(this,"configService",zt,this),(0,it.Z)(this,"interactionService",Ft,this),(0,it.Z)(this,"layerService",Bt,this),(0,c.Z)(this,"pickingFBO",void 0),(0,c.Z)(this,"width",0),(0,c.Z)(this,"height",0),(0,c.Z)(this,"alreadyInPicking",!1),(0,c.Z)(this,"pickBufferScale",1),(0,c.Z)(this,"lastPickTime",(new Date).getTime()),(0,c.Z)(this,"pickedLayers",[]),(0,c.Z)(this,"pickFromPickingFBO",(function(t,n){var r,i=n.x,o=n.y,a=n.lngLat,s=n.type,u=n.target,l=!1,c=e.rendererService,h=(c.getViewportSize,c.readPixels),f=c.getContainer,d=e.getContainerSize(f()),v=d.width,m=d.height;v*=p.DOM.DPR,m*=p.DOM.DPR;var y,g=t.getLayerConfig(),_=g.enableHighlight,x=g.enableSelect,b=i*p.DOM.DPR,w=o*p.DOM.DPR;if(b>v-1*p.DOM.DPR||b<0||w>m-1*p.DOM.DPR||w<0)return!1;if(0!==(y=h({x:Math.floor(b/e.pickBufferScale),y:Math.floor((m-(o+1)*p.DOM.DPR)/e.pickBufferScale),width:1,height:1,data:new Uint8Array(4),framebuffer:e.pickingFBO}))[0]||0!==y[1]||0!==y[2]){var S=(0,p.decodePickingColor)(y),E=t.getSource().getFeatureById(S);S!==t.getCurrentPickId()&&"mousemove"===s&&(s="mouseenter");var C={x:i,y:o,type:s,lngLat:a,featureId:S,feature:E,target:u};E&&(l=!0,t.setCurrentPickId(S),e.pickedLayers=[t],e.triggerHoverOnLayer(t,C))}else{var T={x:i,y:o,lngLat:a,type:null!==t.getCurrentPickId()&&"mousemove"===s?"mouseout":"un"+s,featureId:null,target:u,feature:null};e.triggerHoverOnLayer(t,Yt(Yt({},T),{},{type:"unpick"})),e.triggerHoverOnLayer(t,T),t.setCurrentPickId(null),e.pickedLayers=[]}if(_&&e.highlightPickedFeature(t,y),x&&"click"===s&&(null===(r=y)||void 0===r?void 0:r.toString())!==[0,0,0,0].toString()){var A=(0,p.decodePickingColor)(y);null===t.getCurrentSelectedId()||A!==t.getCurrentSelectedId()?(e.selectFeature(t,y),t.setCurrentSelectedId(A)):(e.selectFeature(t,new Uint8Array([0,0,0,0])),t.setCurrentSelectedId(null))}return l}))}var e,n,r;return(0,l.Z)(t,[{key:"init",value:function(t){var e=this.rendererService,n=e.createTexture2D,r=e.createFramebuffer,i=(e.getViewportSize,e.getContainer),o=this.getContainerSize(i()),a=o.width,s=o.height;a*=p.DOM.DPR,s*=p.DOM.DPR,this.pickBufferScale=this.configService.getSceneConfig(t).pickBufferScale||1,this.pickingFBO=r({color:n({width:Math.round(a/this.pickBufferScale),height:Math.round(s/this.pickBufferScale),wrapS:At.CLAMP_TO_EDGE,wrapT:At.CLAMP_TO_EDGE})}),this.interactionService.on(vt.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:(r=(0,Vt.Z)(Ht().mark((function t(e,n,r){var i,o,a,s=this;return Ht().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=this.rendererService,o=i.useFramebuffer,a=i.clear,i.getContainer,this.resizePickingFBO(),o(this.pickingFBO,(function(){a({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),e.hooks.beforePickingEncode.call(),e.renderModels(),e.hooks.afterPickingEncode.call();var t=s.pickBox(e,n);r(t)}));case 3:case"end":return t.stop()}}),t,this)}))),function(t,e,n){return r.apply(this,arguments)})},{key:"pickBox",value:function(t,e){var n,r=this,i=e.map((function(t){var e=t<0?0:t;return Math.floor(e*p.DOM.DPR/r.pickBufferScale)})),o=(0,z.Z)(i,4),a=o[0],s=o[1],u=o[2],l=o[3],c=this.rendererService,h=(c.getViewportSize,c.readPixels),f=c.getContainer,d=this.getContainerSize(f()),v=d.width,m=d.height;if(v*=p.DOM.DPR,m*=p.DOM.DPR,a>(v-1)*p.DOM.DPR/this.pickBufferScale||u<0||s>(m-1)*p.DOM.DPR/this.pickBufferScale||l<0)return[];var y=Math.min(v/this.pickBufferScale,u)-a,g=Math.min(m/this.pickBufferScale,l)-s;n=h({x:a,y:Math.floor(m/this.pickBufferScale-(l+1)),width:y,height:g,data:new Uint8Array(y*g*4),framebuffer:this.pickingFBO});for(var _=[],x={},b=0;b<n.length/4;b+=1){var w=n.slice(4*b,4*b+4),S=(0,p.decodePickingColor)(w);if(-1!==S&&!x[S]){var E=t.getSource().getFeatureById(S);_.push(Yt(Yt({},E),{},{pickedFeatureIdx:S})),x[S]=!0}}return _}},{key:"handleCursor",value:function(t,e){var n=t.getLayerConfig(),r=n.cursor,i=void 0===r?"":r;if(n.cursorEnabled){var o="GAODE2.x"===this.mapService.version?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),a=null==o?void 0:o.style.getPropertyValue("cursor");"unmousemove"===e&&""!==a?null==o||o.style.setProperty("cursor",""):"mousemove"===e&&(null==o||o.style.setProperty("cursor",i))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(t){return t.getContext?{width:t.width/p.DOM.DPR,height:t.height/p.DOM.DPR}:t.getBoundingClientRect()}},{key:"pickingAllLayer",value:(n=(0,Vt.Z)(Ht().mark((function t(e){var n;return Ht().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging)&&this.layerService.getShaderPickStat()){t.next=2;break}return t.abrupt("return");case 2:if(this.alreadyInPicking=!0,!((n=(new Date).getTime())-this.lastPickTime>10||["contextmenu","click","mouseup"].includes(e.type))){t.next=7;break}return t.next=7,this.pickingLayers(e);case 7:this.lastPickTime=n,this.layerService.renderLayers(),this.alreadyInPicking=!1;case 10:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"resizePickingFBO",value:function(){var t=this.rendererService.getContainer,e=this.getContainerSize(t()),n=e.width,r=e.height;n*=p.DOM.DPR,r*=p.DOM.DPR,this.width===n&&this.height===r||(this.pickingFBO.resize({width:Math.round(n/this.pickBufferScale),height:Math.round(r/this.pickBufferScale)}),this.width=n,this.height=r)}},{key:"pickingLayers",value:(e=(0,Vt.Z)(Ht().mark((function t(e){var n,r,i,o=this;return Ht().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(n=this.rendererService).getViewportSize,r=n.useFramebuffer,i=n.clear,n.getContainer,this.resizePickingFBO(),r(this.pickingFBO,(function(){o.layerService.getRenderList().filter((function(t){return t.needPick(e.type)})).reverse().some((function(t){i({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),t.hooks.beforePickingEncode.call(),t.masks.length>0&&t.masks.map((function(t){t.hooks.beforeRenderData.call(),t.hooks.beforeRender.call(),t.render(),t.hooks.afterRender.call()})),t.renderModels(!0),t.hooks.afterPickingEncode.call(),o.pickedLayers.map((function(t){o.selectFeature(t,new Uint8Array([0,0,0,0]))}));var n=o.pickFromPickingFBO(t,e);return o.layerService.pickedLayerId=n?+t.id:-1,n&&!t.getLayerConfig().enablePropagation}))}));case 3:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"triggerHoverOnLayer",value:function(t,e){var n,r,i,o;o=!0,null==(n=e)||null===(r=n.target)||void 0===r||null===(i=r.path)||void 0===i||i.map((function(t){var e;null!=t&&t.classList&&(null==t||null===(e=t.classList)||void 0===e||e.forEach((function(t){"l7-marker"!==t&&"l7-popup"!==t||(o=!1)})))})),o&&(this.handleCursor(t,e.type),t.emit(e.type,e))}},{key:"highlightPickedFeature",value:function(t,e){var n=(0,z.Z)(e,3),r=n[0],i=n[1],o=n[2];t.hooks.beforeHighlight.call([r,i,o])}},{key:"selectFeature",value:function(t,e){var n=(0,z.Z)(e,3),r=n[0],i=n[1],o=n[2];t.hooks.beforeSelect.call([r,i,o])}}]),t}(),Nt=(0,ot.Z)(Dt.prototype,"mapService",[kt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zt=(0,ot.Z)(Dt.prototype,"rendererService",[Pt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zt=(0,ot.Z)(Dt.prototype,"configService",[Ot],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ft=(0,ot.Z)(Dt.prototype,"interactionService",[Lt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bt=(0,ot.Z)(Dt.prototype,"layerService",[It],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rt=Dt))||Rt),ae=function(){function t(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,u.Z)(this,t),(0,c.Z)(this,"autoStart",void 0),(0,c.Z)(this,"startTime",0),(0,c.Z)(this,"oldTime",0),(0,c.Z)(this,"running",!1),(0,c.Z)(this,"elapsedTime",0),this.autoStart=e}return(0,l.Z)(t,[{key:"start",value:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var e=("undefined"==typeof performance?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}]),t}();function se(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return ue(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ue(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function ue(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var le,ce,pe,he,fe,de,ve=(Kt=(0,o.b2)(),Qt=(0,o.f3)(s.IRendererService),Jt=(0,o.f3)(s.IMapService),$t=(0,o.f3)(s.IGlobalConfigService),Kt((ee=function(){function t(){(0,u.Z)(this,t),(0,c.Z)(this,"pickedLayerId",-1),(0,c.Z)(this,"clock",new ae),(0,c.Z)(this,"alreadyInRendering",!1),(0,c.Z)(this,"layers",[]),(0,c.Z)(this,"layerList",[]),(0,c.Z)(this,"layerRenderID",void 0),(0,c.Z)(this,"sceneInited",!1),(0,c.Z)(this,"animateInstanceCount",0),(0,c.Z)(this,"shaderPicking",!0),(0,c.Z)(this,"enableRender",!0),(0,it.Z)(this,"renderService",ne,this),(0,it.Z)(this,"mapService",re,this),(0,it.Z)(this,"configService",ie,this)}var e;return(0,l.Z)(t,[{key:"add",value:function(t){this.sceneInited&&t.init(),this.layers.push(t),this.updateLayerRenderList()}},{key:"addMask",value:function(t){this.sceneInited&&t.init()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach((function(t){t.inited||t.init()})),this.updateLayerRenderList()}},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(t){return this.layers.find((function(e){return e.id===t}))}},{key:"getLayerByName",value:function(t){return this.layers.find((function(e){return e.name===t}))}},{key:"cleanRemove",value:function(t,e){if(e){var n=e.layerChildren.indexOf(t);n>-1&&e.layerChildren.splice(n,1)}else{var r=this.layers.indexOf(t);r>-1&&this.layers.splice(r,1)}this.updateLayerRenderList(),this.renderLayers()}},{key:"remove",value:function(t,e){if(e){var n=e.layerChildren.indexOf(t);n>-1&&e.layerChildren.splice(n,1)}else{var r=this.layers.indexOf(t);r>-1&&this.layers.splice(r,1)}this.updateLayerRenderList(),t.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(t){this.enableRender=t}},{key:"renderLayers",value:(e=(0,Vt.Z)(Ht().mark((function t(){var e,n,r;return Ht().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.alreadyInRendering&&this.enableRender){t.next=2;break}return t.abrupt("return");case 2:this.alreadyInRendering=!0,this.clear(),e=se(this.layerList),t.prev=5,e.s();case 7:if((n=e.n()).done){t.next=21;break}if((r=n.value).hooks.beforeRenderData.call(),r.hooks.beforeRender.call(),!r.isLayerGroup&&r.masks.length>0&&(this.renderService.clear({stencil:0,depth:1,framebuffer:null}),r.masks.map((function(t){t.hooks.beforeRenderData.call(),t.hooks.beforeRender.call(),t.render(),t.hooks.afterRender.call()}))),!r.getLayerConfig().enableMultiPassRenderer){t.next=17;break}return t.next=15,r.renderMultiPass();case 15:t.next=18;break;case 17:r.render();case 18:r.hooks.afterRender.call();case 19:t.next=7;break;case 21:t.next=26;break;case 23:t.prev=23,t.t0=t.catch(5),e.e(t.t0);case 26:return t.prev=26,e.f(),t.finish(26);case 29:this.alreadyInRendering=!1;case 30:case"end":return t.stop()}}),t,this,[[5,23,26,29]])}))),function(){return e.apply(this,arguments)})},{key:"updateLayerRenderList",value:function(){var t=this;this.layerList=[],this.layers.filter((function(t){return t.inited})).filter((function(t){return t.isVisible()})).sort((function(t,e){return t.zIndex-e.zIndex})).forEach((function(e){e.isLayerGroup?e.layerChildren.filter((function(t){return t.inited})).filter((function(t){return t.isVisible()})).sort((function(t,e){return t.zIndex-e.zIndex})).forEach((function(e){t.layerList.push(e)})):t.layerList.push(e)}))}},{key:"destroy",value:function(){this.layers.forEach((function(t){t.destroy()})),this.layers=[],this.layerList=[],this.renderLayers()}},{key:"startAnimate",value:function(){0==this.animateInstanceCount++&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){0==--this.animateInstanceCount&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var t=(0,p.rgb2arr)(this.mapService.bgColor);this.renderService.clear({color:t,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=p.$window.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){p.$window.cancelAnimationFrame(this.layerRenderID)}}]),t}(),ne=(0,ot.Z)(ee.prototype,"renderService",[Qt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),re=(0,ot.Z)(ee.prototype,"mapService",[Jt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ie=(0,ot.Z)(ee.prototype,"configService",[$t],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),te=ee))||te),me=n(45987),ye=n(93433),ge=n(14293),_e=n.n(ge),xe=function(){function t(e){var n=this;(0,u.Z)(this,t),(0,c.Z)(this,"name",void 0),(0,c.Z)(this,"type",void 0),(0,c.Z)(this,"scale",void 0),(0,c.Z)(this,"descriptor",void 0),(0,c.Z)(this,"featureBufferLayout",[]),(0,c.Z)(this,"needRescale",!1),(0,c.Z)(this,"needRemapping",!1),(0,c.Z)(this,"needRegenerateVertices",!1),(0,c.Z)(this,"featureRange",{startIndex:0,endIndex:1/0}),(0,c.Z)(this,"vertexAttribute",void 0),(0,c.Z)(this,"defaultCallback",(function(t){var e;return 0===t.length?(null===(e=n.scale)||void 0===e?void 0:e.defaultValues)||[]:t.map((function(t,e){var r;return(null===(r=n.scale)||void 0===r?void 0:r.scalers[e].func)(t)}))})),this.setProps(e)}return(0,l.Z)(t,[{key:"setProps",value:function(t){Object.assign(this,t)}},{key:"mapping",value:function(t){var e;if(null!==(e=this.scale)&&void 0!==e&&e.callback){var n,r=null===(n=this.scale)||void 0===n?void 0:n.callback.apply(n,(0,ye.Z)(t));if(!_e()(r))return[r]}return this.defaultCallback(t)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),t}(),be=["buffer","update","name"],we=["buffer","update","name"];function Se(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Ee(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Se(Object(n),!0).forEach((function(e){(0,c.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Se(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Ce,Te,Ae,Me,ke,Pe,Oe,Le,Ie,Re,De,Ne,Ze,ze,Fe,Be,je,Ue,Ve,Ge,He,We,qe,Xe,Ye,Ke,Qe,Je,$e,tn,en,nn,rn,on=(le={},(0,c.Z)(le,At.FLOAT,4),(0,c.Z)(le,At.UNSIGNED_BYTE,1),(0,c.Z)(le,At.UNSIGNED_SHORT,2),le),an=(ce=(0,o.b2)(),pe=(0,o.f3)(s.IRendererService),ce((fe=function(){function t(){(0,u.Z)(this,t),(0,c.Z)(this,"attributesAndIndices",void 0),(0,it.Z)(this,"rendererService",de,this),(0,c.Z)(this,"attributes",[]),(0,c.Z)(this,"triangulation",void 0),(0,c.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,l.Z)(t,[{key:"registerStyleAttribute",value:function(t){var e=this.getLayerStyleAttribute(t.name||"");return e?e.setProps(t):(e=new xe(t),this.attributes.push(e)),e}},{key:"updateStyleAttribute",value:function(t,e,n){var r=this.getLayerStyleAttribute(t);r||(r=this.registerStyleAttribute(Ee(Ee({},e),{},{name:t})));var i=e.scale;i&&r&&(r.scale=i,r.needRescale=!0,r.needRemapping=!0,r.needRegenerateVertices=!0,n&&n.featureRange&&(r.featureRange=n.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(t){return this.attributes.find((function(e){return e.name===t}))}},{key:"getLayerAttributeScale",value:function(t){var e,n=this.getLayerStyleAttribute(t),r=null==n||null===(e=n.scale)||void 0===e?void 0:e.scalers;return r&&r[0]?r[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0,i=this.attributes.find((function(e){return e.name===t}));if(i&&i.descriptor){var o=i.descriptor,a=o.update,s=o.buffer,u=o.size,l=void 0===u?0:u,c=on[s.type||At.FLOAT];if(a){var p=this.featureLayout,h=p.elements,f=p.sizePerElement,d=h.slice(n,r);if(!d.length)return;var v=d[0].offset,m=v*l*c,y=d.map((function(t,n){for(var r=t.featureIdx,i=t.vertices,o=t.normals,s=i.length/f,u=[],l=0;l<s;l++){var c=o?o.slice(3*l,3*l+3):[];u.push.apply(u,(0,ye.Z)(a(e[r],r,i.slice(l*f,l*f+f),n,c)))}return u})).reduce((function(t,e){return t.push.apply(t,(0,ye.Z)(e)),t}),[]);i.vertexAttribute.updateBuffer({data:y,offset:m})}}}},{key:"createAttributesAndIndices",value:function(t,e,n){var r=this;this.featureLayout={sizePerElement:0,elements:[]},e&&(this.triangulation=e);var i=this.attributes.map((function(t){return t.resetDescriptor(),t.descriptor})),o=0,a=[],s=3;t.forEach((function(t,e){var u=r.triangulation(t,n),l=u.indices,c=u.vertices,p=u.normals,h=u.size,f=u.indexes;l.forEach((function(t){a.push(t+o)})),s=h;var d=c.length/h;r.featureLayout.sizePerElement=s,r.featureLayout.elements.push({featureIdx:e,vertices:c,normals:p,offset:o}),o+=d;for(var v=function(n){var r=(null==p?void 0:p.slice(3*n,3*n+3))||[],o=c.slice(n*h,n*h+h),a=0;f&&void 0!==f[n]&&(a=f[n]),i.forEach((function(i,s){var u;i&&i.update&&(u=i.buffer.data).push.apply(u,(0,ye.Z)(i.update(t,e,o,n,r,a)))}))},m=0;m<d;m++)v(m)}));var u=this.rendererService,l=u.createAttribute,c=u.createBuffer,p=u.createElements,h={};i.forEach((function(t,e){if(t){var n=t.buffer,i=(t.update,t.name,(0,me.Z)(t,be)),o=l(Ee({buffer:c(n)},i));h[t.name||""]=o,r.attributes[e].vertexAttribute=o}}));var f=p({data:a,type:At.UNSIGNED_INT,count:a.length});return this.attributesAndIndices={attributes:h,elements:f},this.attributesAndIndices}},{key:"createAttributes",value:function(t,e){var n=this;this.featureLayout={sizePerElement:0,elements:[]},e&&(this.triangulation=e);var r=this.attributes.map((function(t){return t.resetDescriptor(),t.descriptor})),i=0,o=[],a=3;t.forEach((function(t,e){var s=n.triangulation(t),u=s.indices,l=s.vertices,c=s.normals,p=s.size,h=s.indexes;u.forEach((function(t){o.push(t+i)})),a=p;var f=l.length/p;n.featureLayout.sizePerElement=a,n.featureLayout.elements.push({featureIdx:e,vertices:l,normals:c,offset:i}),i+=f;for(var d=function(n){var i=(null==c?void 0:c.slice(3*n,3*n+3))||[],o=l.slice(n*p,n*p+p),a=0;h&&void 0!==h[n]&&(a=h[n]),r.forEach((function(r,s){var u;r&&r.update&&(u=r.buffer.data).push.apply(u,(0,ye.Z)(r.update(t,e,o,n,i,a)))}))},v=0;v<f;v++)d(v)}));var s=this.rendererService,u=s.createAttribute,l=s.createBuffer,c={};return r.forEach((function(t,e){if(t){var r=t.buffer,i=(t.update,t.name,(0,me.Z)(t,we)),o=u(Ee({buffer:l(r)},i));c[t.name||""]=o,n.attributes[e].vertexAttribute=o}})),{attributes:c}}},{key:"clearAllAttributes",value:function(){var t;this.attributes.forEach((function(t){t.vertexAttribute&&t.vertexAttribute.destroy()})),null===(t=this.attributesAndIndices)||void 0===t||t.elements.destroy(),this.attributes=[]}}]),t}(),de=(0,ot.Z)(fe.prototype,"rendererService",[pe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),he=fe))||he),sn=n(46343),un=n(67709),ln=n.n(un),cn=n(25108);function pn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,I.Z)(t);if(e){var i=(0,I.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,L.Z)(this,n)}}var hn=(Ce=(0,o.b2)(),Te=(0,o.f3)(s.SceneID),Ae=(0,o.f3)(s.IIconService),Me=(0,o.f3)(s.IFontService),ke=(0,o.f3)(s.IControlService),Pe=(0,o.f3)(s.IGlobalConfigService),Oe=(0,o.f3)(s.IMapService),Le=(0,o.f3)(s.ICoordinateSystemService),Ie=(0,o.f3)(s.IRendererService),Re=(0,o.f3)(s.ILayerService),De=(0,o.f3)(s.ICameraService),Ne=(0,o.f3)(s.IInteractionService),Ze=(0,o.f3)(s.IPickingService),ze=(0,o.f3)(s.IShaderModuleService),Fe=(0,o.f3)(s.IMarkerService),Be=(0,o.f3)(s.IPopupService),Ce((Ue=function(t){(0,O.Z)(r,t);var e,n=pn(r);function r(){var t;return(0,u.Z)(this,r),t=n.call(this),(0,c.Z)((0,P.Z)(t),"destroyed",!1),(0,c.Z)((0,P.Z)(t),"loaded",!1),(0,c.Z)((0,P.Z)(t),"loadFont",!1),(0,c.Z)((0,P.Z)(t),"fontFamily",""),(0,it.Z)((0,P.Z)(t),"id",Ve,(0,P.Z)(t)),(0,it.Z)((0,P.Z)(t),"iconService",Ge,(0,P.Z)(t)),(0,it.Z)((0,P.Z)(t),"fontService",He,(0,P.Z)(t)),(0,it.Z)((0,P.Z)(t),"controlService",We,(0,P.Z)(t)),(0,it.Z)((0,P.Z)(t),"configService",qe,(0,P.Z)(t)),(0,it.Z)((0,P.Z)(t),"map",Xe,(0,P.Z)(t)),(0,it.Z)((0,P.Z)(t),"coordinateSystemService",Ye,(0,P.Z)(t)),(0,it.Z)((0,P.Z)(t),"rendererService",Ke,(0,P.Z)(t)),(0,it.Z)((0,P.Z)(t),"layerService",Qe,(0,P.Z)(t)),(0,it.Z)((0,P.Z)(t),"cameraService",Je,(0,P.Z)(t)),(0,it.Z)((0,P.Z)(t),"interactionService",$e,(0,P.Z)(t)),(0,it.Z)((0,P.Z)(t),"pickingService",tn,(0,P.Z)(t)),(0,it.Z)((0,P.Z)(t),"shaderModuleService",en,(0,P.Z)(t)),(0,it.Z)((0,P.Z)(t),"markerService",nn,(0,P.Z)(t)),(0,it.Z)((0,P.Z)(t),"popupService",rn,(0,P.Z)(t)),(0,c.Z)((0,P.Z)(t),"inited",!1),(0,c.Z)((0,P.Z)(t),"initPromise",void 0),(0,c.Z)((0,P.Z)(t),"rendering",!1),(0,c.Z)((0,P.Z)(t),"$container",void 0),(0,c.Z)((0,P.Z)(t),"canvas",void 0),(0,c.Z)((0,P.Z)(t),"markerContainer",void 0),(0,c.Z)((0,P.Z)(t),"hooks",void 0),(0,c.Z)((0,P.Z)(t),"handleWindowResized",(function(){t.emit("resize"),t.$container&&(t.initContainer(),p.DOM.triggerResize(),t.coordinateSystemService.needRefresh=!0,t.render())})),(0,c.Z)((0,P.Z)(t),"handleMapCameraChanged",(function(e){t.cameraService.update(e),t.render()})),t.hooks={init:new sn.zj},t}return(0,l.Z)(r,[{key:"init",value:function(t){var e=this;this.configService.setSceneConfig(this.id,t),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",(function(){return e.render()})),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Vt.Z)(Ht().mark((function t(){return Ht().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(t){e.map.onCameraChanged((function(n){e.cameraService.init(),e.cameraService.update(n),"GAODE2.x"!==e.map.version&&t()})),"GAODE2.x"!==e.map.version?e.map.init():t()}));case 2:if("GAODE2.x"!==e.map.version||!e.map.initViewPort){t.next=6;break}return t.next=5,e.map.init();case 5:e.map.initViewPort();case 6:e.map.onCameraChanged(e.handleMapCameraChanged),e.map.addMarkerContainer(),e.markerService.addMarkers(),e.markerService.addMarkerLayers(),e.popupService.initPopup(),e.interactionService.init(),e.interactionService.on(vt.Drag,e.addSceneEvent.bind(e));case 13:case"end":return t.stop()}}),t)})))),this.hooks.init.tapPromise("initRenderer",(0,Vt.Z)(Ht().mark((function t(){var n,r;return Ht().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=qt(e.configService.getSceneConfig(e.id).id||""),e.$container=n,!n){t.next=11;break}return e.canvas=p.DOM.create("canvas","",n),e.setCanvas(),t.next=7,e.rendererService.init(e.canvas,e.configService.getSceneConfig(e.id));case 7:ln()(e.$container,e.handleWindowResized),p.$window.matchMedia&&(null===(r=p.$window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))||void 0===r||r.addListener(e.handleWindowResized)),t.next=12;break;case 11:cn.error("容器 id 不存在");case 12:e.pickingService.init(e.id);case 13:case"end":return t.stop()}}),t)})))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(t){var e=this;this.configService.setSceneConfig(this.id,t),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",(function(){return e.render()})),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Vt.Z)(Ht().mark((function t(){return Ht().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(t){e.map.onCameraChanged((function(n){e.cameraService.init(),e.cameraService.update(n),"GAODE2.x"!==e.map.version&&t()})),e.map.initMiniMap()}));case 2:e.map.onCameraChanged(e.handleMapCameraChanged),e.interactionService.init(),e.interactionService.on(vt.Drag,e.addSceneEvent.bind(e));case 5:case"end":return t.stop()}}),t)})))),this.hooks.init.tapPromise("initRenderer",(0,Vt.Z)(Ht().mark((function n(){var r;return Ht().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=t.canvas,e.$container=r||null,!e.$container){n.next=7;break}return n.next=5,e.rendererService.init(t.canvas,e.configService.getSceneConfig(e.id));case 5:n.next=8;break;case 7:cn.error("容器 id 不存在");case 8:e.pickingService.init(e.id);case 9:case"end":return n.stop()}}),n)})))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(t){this.layerService.sceneService=this,this.layerService.add(t),this.render()}},{key:"addMask",value:function(t){this.layerService.sceneService=this,this.layerService.addMask(t),this.render()}},{key:"render",value:(e=(0,Vt.Z)(Ht().mark((function t(){return Ht().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.rendering&&!this.destroyed){t.next=2;break}return t.abrupt("return");case 2:if(this.rendering=!0,this.inited){t.next=23;break}return t.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!this.loadFont||!document.fonts){t.next=18;break}return t.prev=8,t.next=11,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 11:t.next=18;break;case 13:t.prev=13,t.t0=t.catch(8),cn.warn("当前环境不支持 document.fonts !"),cn.warn("当前环境不支持 iconfont !"),cn.warn(t.t0);case 18:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 23:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 26:case"end":return t.stop()}}),t,this,[[8,13]])}))),function(){return e.apply(this,arguments)})},{key:"addFontFace",value:function(t,e){this.fontFamily=t;var n=document.createElement("style");n.type="text/css",n.innerText="\n        @font-face{\n            font-family: '".concat(t,"';\n            src: url('").concat(e,"') format('woff2'),\n            url('").concat(e,"') format('woff'),\n            url('").concat(e,"') format('truetype');\n        }"),document.getElementsByTagName("head")[0].appendChild(n),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(t){var e,n=null===(e=this.$container)||void 0===e?void 0:e.getElementsByTagName("canvas")[0];return this.render(),"jpg"===t?null==n?void 0:n.toDataURL("image/jpeg"):null==n?void 0:n.toDataURL("image/png")}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var t=this.$container.parentElement;null!==t&&(this.markerContainer=p.DOM.create("div","l7-marker-container",t))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var t,e,n,r=this;this.inited?(this.emit("destroy"),this.pickingService.destroy(),this.layerService.destroy(),setTimeout((function(){var t;null===(t=r.$container)||void 0===t||t.removeChild(r.canvas),r.canvas=null,r.rendererService.destroy()})),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),null===(t=this.$container)||void 0===t||null===(e=t.parentNode)||void 0===e||e.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,un.unbind)(this.$container,this.handleWindowResized),p.$window.matchMedia&&(null===(n=p.$window.matchMedia("screen and (min-resolution: 2dppx)"))||void 0===n||n.removeListener(this.handleWindowResized))):this.destroyed=!0}},{key:"initContainer",value:function(){var t,e,n=p.DOM.DPR,r=(null===(t=this.$container)||void 0===t?void 0:t.clientWidth)||400,i=(null===(e=this.$container)||void 0===e?void 0:e.clientHeight)||300,o=this.canvas;o&&(o.width=r*n,o.height=i*n),this.rendererService.viewport({x:0,y:0,width:n*r,height:n*i})}},{key:"setCanvas",value:function(){var t,e,n=p.DOM.DPR,r=(null===(t=this.$container)||void 0===t?void 0:t.clientWidth)||400,i=(null===(e=this.$container)||void 0===e?void 0:e.clientHeight)||300,o=this.canvas;o.width=r*n,o.height=i*n,o.style.width="100%",o.style.height="100%"}},{key:"addSceneEvent",value:function(t){this.emit(t.type,t)}}]),r}(r.EventEmitter),Ve=(0,ot.Z)(Ue.prototype,"id",[Te],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ge=(0,ot.Z)(Ue.prototype,"iconService",[Ae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),He=(0,ot.Z)(Ue.prototype,"fontService",[Me],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),We=(0,ot.Z)(Ue.prototype,"controlService",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qe=(0,ot.Z)(Ue.prototype,"configService",[Pe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xe=(0,ot.Z)(Ue.prototype,"map",[Oe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ye=(0,ot.Z)(Ue.prototype,"coordinateSystemService",[Le],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ke=(0,ot.Z)(Ue.prototype,"rendererService",[Ie],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qe=(0,ot.Z)(Ue.prototype,"layerService",[Re],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Je=(0,ot.Z)(Ue.prototype,"cameraService",[De],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$e=(0,ot.Z)(Ue.prototype,"interactionService",[Ne],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tn=(0,ot.Z)(Ue.prototype,"pickingService",[Ze],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),en=(0,ot.Z)(Ue.prototype,"shaderModuleService",[ze],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nn=(0,ot.Z)(Ue.prototype,"markerService",[Fe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rn=(0,ot.Z)(Ue.prototype,"popupService",[Be],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),je=Ue))||je),fn=n(44908),dn=n.n(fn);var vn,mn=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function yn(t){var e={};return{content:t=t.replace(mn,(function(t,n,r){var i=r.split(":"),o=i[0].trim(),a="";switch(i.length>1&&(a=i[1].trim()),n){case"bool":a="true"===a;break;case"float":case"int":a=Number(a);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":a=a?a.replace("[","").replace("]","").split(",").reduce((function(t,e){return t.push(Number(e.trim())),t}),[]):new Array(function(t){var e=0;switch(t){case"vec2":case"ivec2":e=2;break;case"vec3":case"ivec3":e=3;break;case"vec4":case"ivec4":case"mat2":e=4;break;case"mat3":e=9;break;case"mat4":e=16}return e}(n)).fill(0)}return e[o]=a,"uniform ".concat(n," ").concat(o,";\n")})),uniforms:e}}function gn(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function _n(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?gn(Object(n),!0).forEach((function(e){(0,c.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):gn(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var xn,bn,wn="#define PI 3.14159265359",Sn=/precision\s+(high|low|medium)p\s+float/,En=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,Cn=(0,o.b2)()(vn=function(){function t(){(0,u.Z)(this,t),(0,c.Z)(this,"moduleCache",{}),(0,c.Z)(this,"rawContentCache",{})}return(0,l.Z)(t,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:wn,fs:wn}),this.registerModule("decode",{vs:"#define SHIFT_RIGHT17 1.0 / 131072.0\n#define SHIFT_RIGHT18 1.0 / 262144.0\n#define SHIFT_RIGHT19 1.0 / 524288.0\n#define SHIFT_RIGHT20 1.0 / 1048576.0\n#define SHIFT_RIGHT21 1.0 / 2097152.0\n#define SHIFT_RIGHT22 1.0 / 4194304.0\n#define SHIFT_RIGHT23 1.0 / 8388608.0\n#define SHIFT_RIGHT24 1.0 / 16777216.0\n\n#define SHIFT_LEFT17 131072.0\n#define SHIFT_LEFT18 262144.0\n#define SHIFT_LEFT19 524288.0\n#define SHIFT_LEFT20 1048576.0\n#define SHIFT_LEFT21 2097152.0\n#define SHIFT_LEFT22 4194304.0\n#define SHIFT_LEFT23 8388608.0\n#define SHIFT_LEFT24 16777216.0\n\nvec2 unpack_float(float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\n\nvec4 decode_color(vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\n",fs:""}),this.registerModule("projection",{vs:"#define TILE_SIZE 512.0\n#define PI 3.1415926536\n#define WORLD_SCALE TILE_SIZE / (PI * 2.0)\n\n#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox\n#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset\n#define COORDINATE_SYSTEM_VECTOR_TILE 3.0\n#define COORDINATE_SYSTEM_IDENTITY 4.0\n#define COORDINATE_SYSTEM_P20 5.0           // amap\n#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset\n#define COORDINATE_SYSTEM_METER_OFFSET 7.0\n\n#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0\n\nuniform mat4 u_ViewMatrix;\nuniform mat4 u_ProjectionMatrix;\nuniform mat4 u_ViewProjectionMatrix;\nuniform float u_Zoom : 1;\nuniform float u_ZoomScale : 1;\n\nuniform float u_CoordinateSystem;\nuniform vec2 u_ViewportCenter;\nuniform vec4 u_ViewportCenterProjection;\nuniform vec3 u_PixelsPerDegree;\nuniform vec3 u_PixelsPerDegree2;\nuniform vec3 u_PixelsPerMeter;\n\nuniform vec2 u_ViewportSize;\nuniform float u_DevicePixelRatio;\nuniform float u_FocalDistance;\nuniform vec3 u_CameraPosition;\n\n// uniform mat4 u_Mvp;\n\n// web mercator coords -> world coords\nvec2 project_mercator(vec2 lnglat) {\n  float x = lnglat.x;\n  return vec2(\n    radians(x) + PI,\n    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))\n  );\n}\n\nfloat project_scale(float meters) {\n  return meters * u_PixelsPerMeter.z;\n}\n\n\n// offset coords -> world coords\nvec4 project_offset(vec4 offset) {\n  float dy = offset.y;\n  dy = clamp(dy, -1., 1.);\n  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;\n  return vec4(offset.xyz * pixels_per_unit, offset.w);\n}\n\nvec3 project_normal(vec3 normal) {\n  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);\n  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);\n}\n\nvec3 project_offset_normal(vec3 vector) {\n  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01\n    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    // normals generated by the polygon tesselator are in lnglat offsets instead of meters\n    return normalize(vector * u_PixelsPerDegree);\n  }\n  return project_normal(vector);\n}\n// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01\n// reverse Y\nvec3 reverse_offset_normal(vec3 vector) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {\n    return vector * vec3(1.0, -1.0, 1.0);\n  }\n\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0\n    return vector;\n  }\n  return vector;\n}\n\nvec4 project_position(vec4 position) {\n  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;\n  float b = COORDINATE_SYSTEM_P20_OFFSET;\n  float c = COORDINATE_SYSTEM_LNGLAT;\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    float X = position.x - u_ViewportCenter.x;\n    float Y = position.y - u_ViewportCenter.y;\n    return project_offset(vec4(X, Y, position.z, position.w));\n  }\n  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {\n    return vec4(\n      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,\n      project_scale(position.z),\n      position.w\n    );\n  }\n\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {\n    return vec4(\n      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),\n      project_scale(position.z),\n      position.w\n    );\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // return vec4(\n    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), \n    //   project_scale(position.z), \n    //   position.w);\n\n     return vec4(\n      position.xy, \n      project_scale(position.z), \n      position.w);\n  }\n  return position;\n\n  // TODO: 瓦片坐标系 & 常规世界坐标系\n}\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\n  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;\n  return offset * u_FocalDistance;\n}\n\nfloat project_pixel_allmap(float pixel) {\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n    return pixel * pow(2.0, u_Zoom);\n  }\n  return pixel;\n}\n\n// 适配纹理贴图的等像素大小\nfloat project_pixel_texture(float pixel) {\n  // mapbox zoom > 12\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    return pixel * pow(0.5, u_Zoom);\n  }\n\n  // amap2 zoom > 12\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));\n  }\n\n  // amap zoom > 12\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    return pixel * pow(0.5, u_Zoom);\n  }\n  \n  // amap zoom < 12\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {\n    return pixel * pow(2.0, (20.0 - u_Zoom));\n  }\n  return pixel * 2.0;\n}\n\n// 在不论什么底图下需要统一处理的时候使用\nfloat project_float_pixel(float pixel) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    // mapbox P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom));\n  }\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    // amap P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom));\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // amap2 P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));\n  }\n  return pixel;\n}\n\nfloat project_pixel(float pixel) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    // amap P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom));\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // amap2 P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));\n  }\n  return pixel;\n}\nvec2 project_pixel(vec2 pixel) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    // P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom));\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));\n  }\n  return pixel * -1.;\n}\nvec3 project_pixel(vec3 pixel) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    // P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom));\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));\n  }\n  return pixel * -1.;\n}\n\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    // Needs to be divided with project_uCommonUnitsPerMeter\n    position.w *= u_PixelsPerMeter.z;\n  }\n\n  return viewProjectionMatrix * position + center;\n}\n\n// Projects from common space coordinates to clip space\nvec4 project_common_position_to_clipspace(vec4 position) {\n  return project_common_position_to_clipspace(\n    position,\n    u_ViewProjectionMatrix,\n    u_ViewportCenterProjection\n  );\n}\n\nvec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {\n  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);\n\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    // Needs to be divided with project_uCommonUnitsPerMeter\n     pos.w = pos.w / u_PixelsPerMeter.z;\n  }\n  return pos;\n}\n\n\nbool isEqual( float a,  float b) {\n    return  a< b + 0.001 && a > b - 0.001;\n}",fs:""}),this.registerModule("project",{vs:"\n#define E 2.718281828459045\nvec2 ProjectFlat(vec2 lnglat){\n  float maxs=85.0511287798;\n  float lat=max(min(maxs,lnglat.y),-maxs);\n  float scale= 268435456.;\n  float d=PI/180.;\n  float x=lnglat.x*d;\n  float y=lat*d;\n  y=log(tan((PI/4.)+(y/2.)));\n\n  float a=.5/PI,\n  b=.5,\n  c=-.5/PI;\n  d=.5;\n  x=scale*(a*x+b);\n  y=scale*(c*y+d);\n  return vec2(x,y);\n}\n\nvec2 unProjectFlat(vec2 px){\n  float a=.5/PI;\n  float b=.5;\n  float c=-.5/PI;\n  float d=.5;\n  float scale = 268435456.;\n  float x=(px.x/scale-b)/a;\n  float y=(px.y/scale-d)/c;\n  y=(atan(pow(E,y))-(PI/4.))*2.;\n  d=PI/180.;\n  float lat=y/d;\n  float lng=x/d;\n  return vec2(lng,lat);\n}\n\nfloat pixelDistance(vec2 from, vec2 to) {\n vec2 a1 = ProjectFlat(from);\n vec2 b1 = ProjectFlat(to);\n return distance(a1, b1);\n}\n\n// gaode2.0\nvec2 customProject(vec2 lnglat) { // 经纬度 => 平面坐标\n  float t = lnglat.x;\n  float e = lnglat.y;\n  float Sm = 180.0 / PI;\n  float Tm = 6378137.0;\n  float Rm = PI / 180.0;\n  float r = 85.0511287798;\n  e = max(min(r, e), -r);\n  t *= Rm;\n  e *= Rm;\n  e = log(tan(PI / 4.0 + e / 2.0));\n  return vec2(t * Tm, e * Tm);\n}\n\nvec2 unProjCustomCoord(vec2 point) { // 平面坐标 => 经纬度\n  float Sm = 57.29577951308232; //180 / Math.PI\n  float Tm = 6378137.0;\n  float t = point.x;\n  float e = point.y;\n  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);\n}\n\n\nfloat customPixelDistance(vec2 from, vec2 to) {\n vec2 a1 = ProjectFlat(from);\n vec2 b1 = ProjectFlat(to);\n return distance(a1, b1);\n}",fs:""}),this.registerModule("sdf_2d",{vs:"",fs:"/**\n * 2D signed distance field functions\n * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm\n */\n\nfloat ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }\n\nfloat sdCircle(vec2 p, float r) {\n  return length(p) - r;\n}\n\nfloat sdEquilateralTriangle(vec2 p) {\n  float k = sqrt(3.0);\n  p.x = abs(p.x) - 1.0;\n  p.y = p.y + 1.0/k;\n  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;\n  p.x -= clamp( p.x, -2.0, 0.0 );\n  return -length(p)*sign(p.y);\n}\n\nfloat sdBox(vec2 p, vec2 b) {\n  vec2 d = abs(p)-b;\n  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);\n}\n\nfloat sdPentagon(vec2 p, float r) {\n  vec3 k = vec3(0.809016994,0.587785252,0.726542528);\n  p.x = abs(p.x);\n  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\n  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\n  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdHexagon(vec2 p, float r) {\n  vec3 k = vec3(-0.866025404,0.5,0.577350269);\n  p = abs(p);\n  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\n  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdOctogon(vec2 p, float r) {\n  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );\n  p = abs(p);\n  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\n  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\n  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdHexagram(vec2 p, float r) {\n  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);\n  p = abs(p);\n  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\n  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;\n  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdRhombus(vec2 p, vec2 b) {\n  vec2 q = abs(p);\n  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);\n  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );\n  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );\n}\n\nfloat sdVesica(vec2 p, float r, float d) {\n  p = abs(p);\n  float b = sqrt(r*r-d*d); // can delay this sqrt\n  return ((p.y-b)*d>p.x*b)\n          ? length(p-vec2(0.0,b))\n          : length(p-vec2(-d,0.0))-r;\n}\n"}),this.registerModule("lighting",{vs:"// Blinn-Phong model\n// apply lighting in vertex shader instead of fragment shader\n// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting\nuniform float u_Ambient : 1.0;\nuniform float u_Diffuse : 1.0;\nuniform float u_Specular : 1.0;\nuniform int u_NumOfDirectionalLights : 1;\nuniform int u_NumOfSpotLights : 0;\n\n#define SHININESS 32.0\n#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3\n#define MAX_NUM_OF_SPOT_LIGHTS 3\n\nstruct DirectionalLight {\n  vec3 direction;\n  vec3 ambient;\n  vec3 diffuse;\n  vec3 specular;\n};\n\nstruct SpotLight {\n  vec3 position;\n  vec3 direction;\n  vec3 ambient;\n  vec3 diffuse;\n  vec3 specular;\n  float constant;\n  float linear;\n  float quadratic;\n  float angle;\n  float blur;\n  float exponent;\n};\n\nuniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];\nuniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];\n\nvec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {\n  vec3 lightDir = normalize(light.direction);\n  // diffuse shading\n  float diff = max(dot(normal, lightDir), 0.0);\n  // Blinn-Phong specular shading\n  vec3 halfwayDir = normalize(lightDir + viewDir);\n  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);\n\n  vec3 ambient = light.ambient * u_Ambient;\n  vec3 diffuse = light.diffuse * diff * u_Diffuse;\n  vec3 specular = light.specular * spec * u_Specular;\n\n  return ambient + diffuse + specular;\n}\n\n// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {\n//   vec3 lightDir = normalize(light.position - fragPos);\n//   // diffuse shading\n//   float diff = max(dot(normal, lightDir), 0.0);\n//   // specular shading\n//   vec3 reflectDir = reflect(-lightDir, normal);\n//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);\n//   // attenuation\n//   float distance = length(light.position - fragPos);\n//   float attenuation = 1.0 / (light.constant + light.linear * distance +\n//           light.quadratic * (distance * distance));\n\n//   vec3 ambient = light.ambient * u_Ambient;\n//   vec3 diffuse = light.diffuse * diff * u_Diffuse;\n//   vec3 specular = light.specular * spec * u_Specular;\n\n//   float spotEffect = dot(normalize(light.direction), -lightDir);\n//   float spotCosCutoff = cos(light.angle / 180.0 * PI);\n//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);\n//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);\n//   if (spotEffect > spotCosCutoff) {\n//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);\n//   } else {\n//     spotEffect = 0.0;\n//   }\n\n//   return ambient + attenuation * (spotEffect * diffuse + specular);\n// }\n\nvec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {\n  vec3 weight = vec3(0.0);\n  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {\n    if (i >= u_NumOfDirectionalLights) {\n      break;\n    }\n    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);\n  }\n  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {\n  //   if (i >= u_NumOfSpotLights) {\n  //     break;\n  //   }\n  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);\n  // }\n  return weight;\n}\n",fs:""}),this.registerModule("light",{vs:"#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\n\nfloat calc_lighting(vec4 pos) {\n\n    vec3 worldPos = vec3(pos * u_ModelMatrix);\n\n    vec3 worldNormal = a_Normal;\n      // //cal light weight\n    vec3 viewDir = normalize(u_CameraPosition - worldPos);\n\n    vec3 lightDir = normalize(vec3(1, -10.5, 12));\n\n    vec3 halfDir = normalize(viewDir+lightDir);\n      // //lambert\n    float lambert = dot(worldNormal, lightDir);\n        //specular\n    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);\n        //sum to light weight\n    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;\n\n    return lightWeight;\n}\n",fs:""}),this.registerModule("picking",{vs:"attribute vec3 a_PickingColor;\nvarying vec4 v_PickingResult;\n\nuniform vec3 u_PickingColor : [0, 0, 0];\nuniform vec3 u_CurrentSelectedId : [0, 0, 0];\nuniform vec4 u_HighlightColor : [0, 0, 0, 0];\nuniform vec4 u_SelectColor : [0, 0, 0, 0];\nuniform float u_PickingStage : 0.0;\nuniform float u_PickingThreshold : 1.0;\nuniform float u_PickingBuffer: 0.0;\nuniform float u_shaderPick;\nuniform float u_EnableSelect: 0.0;\n\n#define PICKING_NONE 0.0\n#define PICKING_ENCODE 1.0\n#define PICKING_HIGHLIGHT 2.0\n#define COLOR_SCALE 1. / 255.\n\n#define NORMAL 0.0\n#define HIGHLIGHT 1.0\n#define SELECT 2.0\n\nbool isVertexPicked(vec3 vertexColor) {\n  return\n    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&\n    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&\n    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;\n}\n\n// 判断当前点是否已经被 select 选中\nbool isVertexSelected(vec3 vertexColor) {\n  return\n    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&\n    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&\n    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;\n}\n\nvoid setPickingColor(vec3 pickingColor) {\n  if(u_shaderPick < 0.5) {\n    return;\n  }\n  // compares only in highlight stage\n\n  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));\n\n  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {\n  //   // 选中态\n  //   v_PickingResult.a = SELECT;\n  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {\n  //   // 高亮态\n  //   v_PickingResult.a = HIGHLIGHT;\n  // } else {\n  //   v_PickingResult.a = NORMAL;\n  // }\n\n  // Stores the picking color so that the fragment shader can render it during picking\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nfloat setPickingSize(float x) {\n   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;\n}\n\nfloat setPickingOrder(float z) {\n   bool selected = bool(v_PickingResult.a);\n   return selected ? z + 1. : 0.;\n}\n",fs:"varying vec4 v_PickingResult;\nuniform vec4 u_HighlightColor : [0, 0, 0, 0];\nuniform vec4 u_SelectColor : [0, 0, 0, 0];\nuniform float u_PickingStage : 0.0;\nuniform float u_shaderPick;\n\nuniform float u_activeMix: 0;\n\n#define PICKING_NONE 0.0\n#define PICKING_ENCODE 1.0\n#define PICKING_HIGHLIGHT 2.0\n#define COLOR_SCALE 1. / 255.\n\n#define HIGHLIGHT 1.0\n#define SELECT 2.0\n\n/*\n * Returns highlight color if this item is selected.\n */\nvec4 filterHighlightColor(vec4 color, float weight) {\n  // float selected = v_PickingResult.a;\n  bool selected = bool(v_PickingResult.a);\n\n  // if (selected == SELECT) {\n  if (selected) {\n  //   // 点击选中状态\n  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;\n  //   return selectColor;\n  // } else if (selected == HIGHLIGHT) {\n  //   // hover 高亮状态\n    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;\n\n    float highLightAlpha = highLightColor.a;\n    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));\n\n    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);\n    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);\n  } else {\n    return color;\n  }\n}\n\n/*\n * Returns picking color if picking enabled else unmodified argument.\n */\nvec4 filterPickingColor(vec4 color) {\n  vec3 pickingColor = v_PickingResult.rgb;\n  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {\n    discard;\n  }\n  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;\n}\n\n/*\n * Returns picking color if picking is enabled if not\n * highlight color if this item is selected, otherwise unmodified argument.\n */\nvec4 filterColor(vec4 color) {\n  // TODO: 过滤多余的 shader 计算\n  // return color;\n  if(u_shaderPick < 0.5) {\n    return color; // 暂时去除 直接取消计算在选中时拖拽地图会有问题\n  } else {\n    return filterPickingColor(filterHighlightColor(color, 1.0));\n  }\n  \n}\n\nvec4 filterColorAlpha(vec4 color, float alpha) {\n  // TODO: 过滤多余的 shader 计算\n  // return color;\n  if(u_shaderPick < 0.5) {\n    return color; // 暂时去除 直接取消计算在选中时拖拽地图会有问题\n  } else {\n    return filterPickingColor(filterHighlightColor(color, alpha));\n  }\n}\n\n"}),this.registerModule("styleMapping",{vs:"attribute float a_vertexId;\n\nuniform mat4 u_cellTypeLayout;      // 描述数据纹理 cell 结构的矩阵\nuniform sampler2D u_dataTexture;    // 数据纹理\n\nbool hasOpacity() { // 判断 cell 中是否存在 opacity 的数据\n  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;\n}\n\nbool hasStrokeOpacity() { // 判断 cell 中是否存在 strokeOpacity 的数据\n  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;\n}\n\nbool hasStrokeWidth() { // 判断 cell 中是否存在 strokeWidth 的数据\n  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;\n}\n\nbool hasStroke() { // 判断 cell 中是否存在 stroke 的数据\n  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;\n}\n\nbool hasOffsets() { // 判断 cell 中是否存在 offsets 的数据\n  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;\n}\n\nbool hasThetaOffset() { // 判断 cell 中是否存在 thetaOffset 的数据\n  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;\n}\n\n// 根据坐标位置先是计算 uv ，然后根据 uv 从数据纹理中取值\nfloat pos2value(vec2 pos, float columnWidth, float rowHeight) {\n  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;\n  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);\n  return texture2D(u_dataTexture, vec2(u, v)).r;\n}\n\n/*\n  currentRow 当前行\n  currentColumn 当前列\n  columnCount 有多少列\n  nextStep 需要计算当前 cell 后的第几个 cell （当前 cell 则 nextStep = 0）\n*/\nvec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {\n  float nextColumn = currentColumn;\n  float nextRow = currentRow;\n  if(currentColumn + nextStep <= columnCount){\n    nextColumn = currentColumn + nextStep;\n  } else {\n    nextColumn = mod(currentColumn + nextStep, columnCount); // 不会出现跨两行\n    nextRow = currentRow + 1.0;\n  }\n  return vec2(nextColumn, nextRow);\n}\n\n// 计算当前单个 cell 的大小\nfloat calCellCount() { \n  //   u_cellTypeLayout\n  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - 几行几列\n  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 表示有数据映射、0.0 表示没有\n  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset\n  //   0.0, 0.0, 0.0, 0.0\n  \n  return  u_cellTypeLayout[1][0] +        // opacity\n          u_cellTypeLayout[1][1] +        // strokeOpacity\n          u_cellTypeLayout[1][2] +        // strokeWidth\n          u_cellTypeLayout[1][3] * 4.0 +  // stroke\n          u_cellTypeLayout[2][0] * 2.0 +  // offsets\n          u_cellTypeLayout[2][1];         // thetaOffset\n}",fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:"\n// 计算 thetaOffset 和标示在 cell 中取值位置的偏移量 textureOffset\nvec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {\n  if(!hasThetaOffset()) { // 数据纹理中不存在 thetaOffset 的时候取默认值（用户在 style 中传入的是常量）\n    return vec2(u_thetaOffset, textureOffset);\n  } else {\n    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);\n    return vec2(textureThetaOffset, textureOffset + 1.0);\n  }\n}\n",fs:""}),this.registerModule("styleMappingCalOpacity",{vs:"\n// 计算 opacity 和标示在 cell 中取值位置的偏移量 textureOffset\nvec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {\n  if(!hasOpacity()) { // 数据纹理中不存在 opacity 的时候取默认值（用户在 style 中传入的是常量）\n    return vec2(u_opacity, textureOffset);\n  } else {\n    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);\n    return vec2(textureOpacity, textureOffset + 1.0);\n  }\n}\n",fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:"\n// 计算 strokeOpaicty 和标示在 cell 中取值位置的偏移量 textureOffset\nvec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {\n  if(!hasStrokeOpacity()) {\n    return vec2(u_stroke_opacity, textureOffset);\n  } else {\n    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);\n    return vec2(textureStrokeOpacity, textureOffset + 1.0);\n  }\n}\n",fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:"\n// 计算 strokeWidth 和标示在 cell 中取值位置的偏移量 textureOffset\nvec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {\n  if(!hasStrokeWidth()) {\n    return vec2(u_stroke_width, textureOffset);\n  } else {\n    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);\n    return vec2(textureStrokeWidth, textureOffset + 1.0);\n  }\n}\n",fs:""})}},{key:"registerModule",value:function(t,e){if(!this.rawContentCache[t]){var n=e.vs,r=e.fs,i=e.uniforms,o=yn(n),a=o.content,s=o.uniforms,u=yn(r),l=u.content,c=u.uniforms;this.rawContentCache[t]={fs:l,uniforms:_n(_n(_n({},s),c),i),vs:a}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(t){var e=this;if(this.moduleCache[t])return this.moduleCache[t];var n=this.rawContentCache[t].vs,r=this.rawContentCache[t].fs,i=this.processModule(n,[],"vs"),o=i.content,a=i.includeList,s=this.processModule(r,[],"fs"),u=s.content,l=s.includeList,c=u,p=dn()(a.concat(l).concat(t)).reduce((function(t,n){return _n(_n({},t),e.rawContentCache[n].uniforms)}),{});return Sn.test(u)||(c="#ifdef GL_FRAGMENT_PRECISION_HIGH\n precision highp float;\n #else\n precision mediump float;\n#endif\n"+u),this.moduleCache[t]={fs:c.trim(),uniforms:p,vs:o.trim()},this.moduleCache[t]}},{key:"processModule",value:function(t,e,n){var r=this;return{content:t.replace(En,(function(t,i){var o=i.split(" ")[0].replace(/"/g,"");if(e.indexOf(o)>-1)return"";var a=r.rawContentCache[o][n];return e.push(o),r.processModule(a,e,n).content})),includeList:e}}}]),t}())||vn,Tn=n(11752);!function(t){t.Normal="normal",t.PostProcessing="post-processing"}(xn||(xn={}));var An,Mn=(0,o.b2)()(bn=function(){function t(){(0,u.Z)(this,t),(0,c.Z)(this,"shaderModuleService",void 0),(0,c.Z)(this,"rendererService",void 0),(0,c.Z)(this,"cameraService",void 0),(0,c.Z)(this,"mapService",void 0),(0,c.Z)(this,"interactionService",void 0),(0,c.Z)(this,"layerService",void 0),(0,c.Z)(this,"config",void 0)}return(0,l.Z)(t,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return xn.Normal}},{key:"init",value:function(t,e){this.config=e,this.rendererService=t.getContainer().get(s.IRendererService),this.cameraService=t.getContainer().get(s.ICameraService),this.mapService=t.getContainer().get(s.IMapService),this.interactionService=t.getContainer().get(s.IInteractionService),this.layerService=t.getContainer().get(s.ILayerService),this.shaderModuleService=t.getContainer().get(s.IShaderModuleService)}},{key:"render",value:function(t){}}]),t}())||bn;function kn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,I.Z)(t);if(e){var i=(0,I.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,L.Z)(this,n)}}var Pn,On,Ln,In,Rn,Dn=(0,o.b2)()(An=function(t){(0,O.Z)(n,t);var e=kn(n);function n(){return(0,u.Z)(this,n),e.apply(this,arguments)}return(0,l.Z)(n,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(t,e){(0,Tn.Z)((0,I.Z)(n.prototype),"init",this).call(this,t,e)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),n}(Mn))||An;function Nn(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return Zn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Zn(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Zn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var zn,Fn=(Pn=(0,o.b2)(),On=(0,o.f3)(s.IPostProcessor),Pn((In=function(){function t(){(0,u.Z)(this,t),(0,c.Z)(this,"passes",[]),(0,it.Z)(this,"postProcessor",Rn,this),(0,c.Z)(this,"layer",void 0),(0,c.Z)(this,"renderFlag",void 0),(0,c.Z)(this,"width",0),(0,c.Z)(this,"height",0)}var e;return(0,l.Z)(t,[{key:"setLayer",value:function(t){this.layer=t}},{key:"setRenderFlag",value:function(t){this.renderFlag=t}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:(e=(0,Vt.Z)(Ht().mark((function t(){var e,n,r;return Ht().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=Nn(this.passes),t.prev=1,e.s();case 3:if((n=e.n()).done){t.next=9;break}return r=n.value,t.next=7,r.render(this.layer);case 7:t.next=3;break;case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(1),e.e(t.t0);case 14:return t.prev=14,e.f(),t.finish(14);case 17:return t.next=19,this.postProcessor.render(this.layer);case 19:case"end":return t.stop()}}),t,this,[[1,11,14,17]])}))),function(){return e.apply(this,arguments)})},{key:"resize",value:function(t,e){this.width===t&&this.height===e||(this.postProcessor.resize(t,e),this.width=t,this.height=e)}},{key:"add",value:function(t,e){t.getType()===xn.PostProcessing?this.postProcessor.add(t,this.layer,e):(t.init(this.layer,e),this.passes.push(t))}},{key:"insert",value:function(t,e,n){t.init(this.layer,e),this.passes.splice(n,0,t)}},{key:"destroy",value:function(){this.passes.length=0}}]),t}(),Rn=(0,ot.Z)(In.prototype,"postProcessor",[On],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ln=In))||Ln);function Bn(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function jn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Bn(Object(n),!0).forEach((function(e){(0,c.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Bn(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Un(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,I.Z)(t);if(e){var i=(0,I.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,L.Z)(this,n)}}var Vn,Gn,Hn,Wn,qn,Xn=(0,o.b2)()(zn=function(t){(0,O.Z)(n,t);var e=Un(n);function n(){var t;(0,u.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,c.Z)((0,P.Z)(t),"pickingFBO",void 0),(0,c.Z)((0,P.Z)(t),"layer",void 0),(0,c.Z)((0,P.Z)(t),"width",0),(0,c.Z)((0,P.Z)(t),"height",0),(0,c.Z)((0,P.Z)(t),"alreadyInRendering",!1),(0,c.Z)((0,P.Z)(t),"pickFromPickingFBO",(function(e){var n=e.x,r=e.y,i=e.lngLat,o=e.type;if(t.layer.isVisible()&&t.layer.needPick(o)){var a,s=t.rendererService,u=s.getViewportSize,l=s.readPixels,c=s.useFramebuffer,h=u(),f=h.width,d=h.height,v=t.layer.getLayerConfig(),m=v.enableHighlight,y=v.enableSelect,g=n*p.DOM.DPR,_=r*p.DOM.DPR;if(!(g>f||g<0||_>d||_<0))c(t.pickingFBO,(function(){var e;if(0!==(a=l({x:Math.round(g),y:Math.round(d-(r+1)*p.DOM.DPR),width:1,height:1,data:new Uint8Array(4),framebuffer:t.pickingFBO}))[0]||0!==a[1]||0!==a[2]){var s=(0,p.decodePickingColor)(a),u=t.layer.getSource().getFeatureById(s),c={x:n,y:r,type:o,lngLat:i,featureId:s,feature:u};u&&(t.layer.setCurrentPickId(s),t.triggerHoverOnLayer(c))}else{var h={x:n,y:r,lngLat:i,type:null===t.layer.getCurrentPickId()?"un"+o:"mouseout",featureId:null,feature:null};t.triggerHoverOnLayer(jn(jn({},h),{},{type:"unpick"})),t.triggerHoverOnLayer(h),t.layer.setCurrentPickId(null)}m&&t.highlightPickedFeature(a),y&&"click"===o&&(null===(e=a)||void 0===e?void 0:e.toString())!==[0,0,0,0].toString()&&t.selectFeature(a)}))}})),t}return(0,l.Z)(n,[{key:"getType",value:function(){return xn.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(t,e){(0,Tn.Z)((0,I.Z)(n.prototype),"init",this).call(this,t,e),this.layer=t;var r=this.rendererService,i=r.createTexture2D,o=r.createFramebuffer,a=(0,r.getViewportSize)(),s=a.width,u=a.height;this.pickingFBO=o({color:i({width:s,height:u,wrapS:At.CLAMP_TO_EDGE,wrapT:At.CLAMP_TO_EDGE})}),this.interactionService.on(vt.Hover,this.pickFromPickingFBO),this.interactionService.on(vt.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(vt.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(t){var e=this;if(!this.alreadyInRendering){var n=this.rendererService,r=n.getViewportSize,i=n.useFramebuffer,o=n.clear,a=r(),s=a.width,u=a.height;this.alreadyInRendering=!0,this.width===s&&this.height===u||(this.pickingFBO.resize({width:s,height:u}),this.width=s,this.height=u),i(this.pickingFBO,(function(){o({framebuffer:e.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var n=e.layer.multiPassRenderer.getRenderFlag();e.layer.multiPassRenderer.setRenderFlag(!1),t.hooks.beforePickingEncode.call(),t.render(),t.hooks.afterPickingEncode.call(),e.layer.multiPassRenderer.setRenderFlag(n),e.alreadyInRendering=!1}))}}},{key:"triggerHoverOnLayer",value:function(t){this.layer.emit(t.type,t)}},{key:"highlightPickedFeature",value:function(t){var e=(0,z.Z)(t,3),n=e[0],r=e[1],i=e[2];this.layer.hooks.beforeHighlight.call([n,r,i]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(t){var e=(0,z.Z)(t,3),n=e[0],r=e[1],i=e[2];this.layer.hooks.beforeSelect.call([n,r,i]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(t){var e=t.featureId,n=(0,p.encodePickingColor)(e);this.selectFeature(new Uint8Array(n))}},{key:"highlightFeatureHandle",value:function(t){var e=t.featureId,n=(0,p.encodePickingColor)(e);this.highlightPickedFeature(new Uint8Array(n))}}]),n}(Mn))||zn,Yn=n(11700),Kn=n.n(Yn),Qn=n(68929),Jn=n.n(Qn);function $n(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function tr(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?$n(Object(n),!0).forEach((function(e){(0,c.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):$n(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var er,nr=(Vn=(0,o.b2)(),Gn=(0,o.f3)(s.IShaderModuleService),Vn((Wn=function(){function t(){(0,u.Z)(this,t),(0,it.Z)(this,"shaderModuleService",qn,this),(0,c.Z)(this,"rendererService",void 0),(0,c.Z)(this,"config",void 0),(0,c.Z)(this,"quad","attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}"),(0,c.Z)(this,"enabled",!0),(0,c.Z)(this,"renderToScreen",!1),(0,c.Z)(this,"model",void 0),(0,c.Z)(this,"name",void 0),(0,c.Z)(this,"optionsToUpdate",{})}return(0,l.Z)(t,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(t){this.name=t}},{key:"getType",value:function(){return xn.PostProcessing}},{key:"init",value:function(t,e){this.config=e,this.rendererService=t.getContainer().get(s.IRendererService),this.shaderModuleService=t.getContainer().get(s.IShaderModuleService);var n=this.rendererService,r=n.createAttribute,i=n.createBuffer,o=n.createModel,a=this.setupShaders(),u=a.vs,l=a.fs,c=a.uniforms;this.model=o({vs:u,fs:l,attributes:{a_Position:r({buffer:i({data:[-4,-4,4,-4,0,4],type:At.FLOAT}),size:2})},uniforms:tr(tr({u_Texture:null},c),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:"copy"===this.getName()}})}},{key:"render",value:function(t,e){var n=this,r=t.multiPassRenderer.getPostProcessor(),i=this.rendererService,o=i.useFramebuffer,a=i.getViewportSize,s=i.clear,u=a(),l=u.width,c=u.height;o(this.renderToScreen?null:r.getWriteFBO(),(function(){s({framebuffer:r.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var t=tr({u_BloomFinal:0,u_Texture:r.getReadFBO(),u_ViewportSize:[l,c]},n.convertOptionsToUniforms(n.optionsToUpdate));e&&(t.u_BloomFinal=1,t.u_Texture2=e),n.model.draw({uniforms:t})}))}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(t){this.enabled=t}},{key:"setRenderToScreen",value:function(t){this.renderToScreen=t}},{key:"updateOptions",value:function(t){this.optionsToUpdate=tr(tr({},this.optionsToUpdate),t)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(t){var e={};return Object.keys(t).forEach((function(n){_e()(t[n])||(e["u_".concat(Kn()(Jn()(n)))]=t[n])})),e}}]),t}(),qn=(0,ot.Z)(Wn.prototype,"shaderModuleService",[Gn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hn=Wn))||Hn);function rr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function ir(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?rr(Object(n),!0).forEach((function(e){(0,c.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):rr(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function or(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,I.Z)(t);if(e){var i=(0,I.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,L.Z)(this,n)}}var ar,sr=(0,o.b2)()(er=function(t){(0,O.Z)(n,t);var e=or(n);function n(){return(0,u.Z)(this,n),e.apply(this,arguments)}return(0,l.Z)(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform float u_BloomFinal: 0.0;\nuniform sampler2D u_Texture;\nuniform sampler2D u_Texture2;\n\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform float u_radius: 5.0;\nuniform float u_intensity: 0.3;\nuniform float u_baseRadio: 0.5;\n\n// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nfloat luminance(vec4 color) {\n  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;\n}\n\nvoid main() {\n  // vec4 baseColor = texture2D(u_Texture, v_UV);\n\n  float r = sqrt(u_radius);\n\n  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));\n  // c1 *= luminance(c1);\n  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));\n  // c2 *= luminance(c2);\n  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));\n  // c3 *= luminance(c3);\n  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));\n  // c4 *= luminance(c4);\n  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;\n\n  // float lum = luminance(inbloomColor);\n  // inbloomColor.rgb *= lum;\n\n  if(u_BloomFinal > 0.0) {\n    vec4 baseColor = texture2D(u_Texture2, v_UV);\n    float baselum = luminance(baseColor);\n    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);\n    if(baselum <= 0.2) {\n      gl_FragColor = inbloomColor * u_intensity;\n    }\n  } else {\n    gl_FragColor = inbloomColor;\n  }\n}"});var t=this.shaderModuleService.getModule("blur-pass"),e=t.vs,n=t.fs,r=t.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:e,fs:n,uniforms:ir(ir({},r),{},{u_ViewportSize:[o,a]})}}},{key:"convertOptionsToUniforms",value:function(t){var e={};return _e()(t.bloomRadius)||(e.u_radius=t.bloomRadius),_e()(t.bloomIntensity)||(e.u_intensity=t.bloomIntensity),_e()(t.bloomBaseRadio)||(e.u_baseRadio=t.bloomBaseRadio),e}}]),n}(nr))||er;function ur(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function lr(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ur(Object(n),!0).forEach((function(e){(0,c.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ur(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function cr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,I.Z)(t);if(e){var i=(0,I.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,L.Z)(this,n)}}var pr,hr=(0,o.b2)()(ar=function(t){(0,O.Z)(n,t);var e=cr(n);function n(){return(0,u.Z)(this,n),e.apply(this,arguments)}return(0,l.Z)(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_BlurDir: [1.0, 0.0];\n\n// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);\n}"});var t=this.shaderModuleService.getModule("blur-pass"),e=t.vs,n=t.fs,r=t.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:e,fs:n,uniforms:lr(lr({},r),{},{u_ViewportSize:[o,a]})}}},{key:"convertOptionsToUniforms",value:function(t){var e={};return _e()(t.blurRadius)||(e.u_BlurDir=[t.blurRadius,0]),e}}]),n}(nr))||ar;function fr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function dr(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?fr(Object(n),!0).forEach((function(e){(0,c.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):fr(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function vr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,I.Z)(t);if(e){var i=(0,I.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,L.Z)(this,n)}}var mr,yr=(0,o.b2)()(pr=function(t){(0,O.Z)(n,t);var e=vr(n);function n(){return(0,u.Z)(this,n),e.apply(this,arguments)}return(0,l.Z)(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_BlurDir: [1.0, 0.0];\n\n// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);\n}"});var t=this.shaderModuleService.getModule("blur-pass"),e=t.vs,n=t.fs,r=t.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:e,fs:n,uniforms:dr(dr({},r),{},{u_ViewportSize:[o,a]})}}},{key:"convertOptionsToUniforms",value:function(t){var e={};return _e()(t.blurRadius)||(e.u_BlurDir=[0,t.blurRadius]),e}}]),n}(nr))||pr;function gr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function _r(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?gr(Object(n),!0).forEach((function(e){(0,c.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):gr(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function xr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,I.Z)(t);if(e){var i=(0,I.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,L.Z)(this,n)}}var br,wr=(0,o.b2)()(mr=function(t){(0,O.Z)(n,t);var e=xr(n);function n(){return(0,u.Z)(this,n),e.apply(this,arguments)}return(0,l.Z)(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:'varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_Center : [0.5, 0.5];\nuniform float u_Angle : 0;\nuniform float u_Size : 8;\n\n#pragma include "common"\n\nfloat scale = PI / u_Size;\n\nfloat pattern(float u_Angle, vec2 texSize, vec2 texCoord) {\n  float s = sin(u_Angle), c = cos(u_Angle);\n  vec2 tex = texCoord * texSize - u_Center * texSize;\n  vec2 point = vec2(\n    c * tex.x - s * tex.y,\n    s * tex.x + c * tex.y\n  ) * scale;\n  return (sin(point.x) * sin(point.y)) * 4.0;\n}\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js\nvec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {\n  vec3 cmy = 1.0 - color.rgb;\n  float k = min(cmy.x, min(cmy.y, cmy.z));\n  cmy = (cmy - k) / (1.0 - k);\n  cmy = clamp(\n    cmy * 10.0 - 3.0 + vec3(\n      pattern(u_Angle + 0.26179, texSize, texCoord),\n      pattern(u_Angle + 1.30899, texSize, texCoord),\n      pattern(u_Angle, texSize, texCoord)\n    ),\n    0.0,\n    1.0\n  );\n  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);\n  return vec4(1.0 - cmy - k, color.a);\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);\n}'});var t=this.shaderModuleService.getModule("colorhalftone-pass"),e=t.vs,n=t.fs,r=t.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:e,fs:n,uniforms:_r(_r({},r),{},{u_ViewportSize:[o,a]})}}}]),n}(nr))||mr;function Sr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,I.Z)(t);if(e){var i=(0,I.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,L.Z)(this,n)}}var Er,Cr=(0,o.b2)()(br=function(t){(0,O.Z)(n,t);var e=Sr(n);function n(){return(0,u.Z)(this,n),e.apply(this,arguments)}return(0,l.Z)(n,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n}"}),this.shaderModuleService.getModule("copy-pass")}}]),n}(nr))||br;function Tr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Ar(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Tr(Object(n),!0).forEach((function(e){(0,c.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Tr(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Mr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,I.Z)(t);if(e){var i=(0,I.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,L.Z)(this,n)}}var kr,Pr=(0,o.b2)()(Er=function(t){(0,O.Z)(n,t);var e=Mr(n);function n(){return(0,u.Z)(this,n),e.apply(this,arguments)}return(0,l.Z)(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_Center : [0.5, 0.5];\nuniform float u_Scale : 10;\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js\nvec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\n  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;\n  tex.y /= 0.866025404;\n  tex.x -= tex.y * 0.5;\n  vec2 a;\n  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {\n    a = vec2(floor(tex.x), floor(tex.y));\n  }\n  else a = vec2(ceil(tex.x), ceil(tex.y));\n  vec2 b = vec2(ceil(tex.x), floor(tex.y));\n  vec2 c = vec2(floor(tex.x), ceil(tex.y));\n  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);\n  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);\n  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);\n  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);\n  float alen = length(TEX - A);\n  float blen = length(TEX - B);\n  float clen = length(TEX - C);\n  vec2 choice;\n  if (alen < blen) {\n    if (alen < clen) choice = a;\n    else choice = c;\n  } else {\n    if (blen < clen) choice = b;\n    else choice = c;\n  }\n  choice.x += choice.y * 0.5;\n  choice.y *= 0.866025404;\n  choice *= u_Scale / texSize;\n  return texture2D(texture, choice + u_Center);\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);\n}"});var t=this.shaderModuleService.getModule("hexagonalpixelate-pass"),e=t.vs,n=t.fs,r=t.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:e,fs:n,uniforms:Ar(Ar({},r),{},{u_ViewportSize:[o,a]})}}}]),n}(nr))||Er;function Or(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Lr(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Or(Object(n),!0).forEach((function(e){(0,c.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Or(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Ir(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,I.Z)(t);if(e){var i=(0,I.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,L.Z)(this,n)}}var Rr,Dr=(0,o.b2)()(kr=function(t){(0,O.Z)(n,t);var e=Ir(n);function n(){return(0,u.Z)(this,n),e.apply(this,arguments)}return(0,l.Z)(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform float u_Strength : 0.6;\n\nvec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\n  vec2 dx = vec2(1.0 / texSize.x, 0.0);\n  vec2 dy = vec2(0.0, 1.0 / texSize.y);\n  vec4 color = texture2D(texture, texCoord);\n  float bigTotal = 0.0;\n  float smallTotal = 0.0;\n  vec3 bigAverage = vec3(0.0);\n  vec3 smallAverage = vec3(0.0);\n  for (float x = -2.0; x <= 2.0; x += 1.0) {\n    for (float y = -2.0; y <= 2.0; y += 1.0) {\n      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;\n      bigAverage += sample;\n      bigTotal += 1.0;\n      if (abs(x) + abs(y) < 2.0) {\n        smallAverage += sample;\n        smallTotal += 1.0;\n      }\n    }\n  }\n  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);\n  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;\n  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);\n}"});var t=this.shaderModuleService.getModule("ink-pass"),e=t.vs,n=t.fs,r=t.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:e,fs:n,uniforms:Lr(Lr({},r),{},{u_ViewportSize:[o,a]})}}}]),n}(nr))||kr;function Nr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,I.Z)(t);if(e){var i=(0,I.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,L.Z)(this,n)}}var Zr,zr=(0,o.b2)()(Rr=function(t){(0,O.Z)(n,t);var e=Nr(n);function n(){return(0,u.Z)(this,n),e.apply(this,arguments)}return(0,l.Z)(n,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform float u_Amount : 0.5;\n\nfloat rand(vec2 co) {\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js\nvec4 noise_filterColor(vec4 color, vec2 texCoord) {\n  float diff = (rand(texCoord) - 0.5) * u_Amount;\n  color.r += diff;\n  color.g += diff;\n  color.b += diff;\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);\n}"}),this.shaderModuleService.getModule("noise-pass")}}]),n}(nr))||Rr;function Fr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,I.Z)(t);if(e){var i=(0,I.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,L.Z)(this,n)}}var Br,jr,Ur,Vr,Gr,Hr,Wr,qr=(0,o.b2)()(Zr=function(t){(0,O.Z)(n,t);var e=Fr(n);function n(){return(0,u.Z)(this,n),e.apply(this,arguments)}return(0,l.Z)(n,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nuniform float u_Amount : 0.5;\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js\nvec4 sepia_filterColor(vec4 color) {\n  float r = color.r;\n  float g = color.g;\n  float b = color.b;\n  color.r =\n    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));\n  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));\n  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = sepia_filterColor(gl_FragColor);\n}"}),this.shaderModuleService.getModule("sepia-pass")}}]),n}(nr))||Zr,Xr=(Br=(0,o.b2)(),jr=(0,o.f3)(s.IRendererService),Ur=(0,o.zY)(),Br((Gr=function(){function t(){(0,u.Z)(this,t),(0,it.Z)(this,"rendererService",Hr,this),(0,c.Z)(this,"passes",[]),(0,c.Z)(this,"readFBO",void 0),(0,c.Z)(this,"writeFBO",void 0)}var e,n;return(0,l.Z)(t,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var t=this.rendererService,e=t.getViewportSize,n=t.createTexture2D,r=e();return n({x:0,y:0,width:r.width,height:r.height,copy:!0})}},{key:"getReadFBOTex",value:function(){var t=this,e=this.rendererService.useFramebuffer;return new Promise((function(n,r){e(t.readFBO,(0,Vt.Z)(Ht().mark((function e(){return Ht().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n(t.getCurrentFBOTex());case 1:case"end":return e.stop()}}),e)}))))}))}},{key:"renderBloomPass",value:(n=(0,Vt.Z)(Ht().mark((function t(e,n){var r,i;return Ht().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getReadFBOTex();case 2:r=t.sent,i=0;case 4:if(!(i<4)){t.next=11;break}return t.next=7,n.render(e,r);case 7:this.swap(),i++,t.next=4;break;case 11:case"end":return t.stop()}}),t,this)}))),function(t,e){return n.apply(this,arguments)})},{key:"render",value:(e=(0,Vt.Z)(Ht().mark((function t(e){var n,r;return Ht().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=0;case 1:if(!(n<this.passes.length)){t.next=15;break}if((r=this.passes[n]).setRenderToScreen(this.isLastEnabledPass(n)),"bloom"!==r.getName()){t.next=9;break}return t.next=7,this.renderBloomPass(e,r);case 7:t.next=12;break;case 9:return t.next=11,r.render(e);case 11:n!==this.passes.length-1&&this.swap();case 12:n++,t.next=1;break;case 15:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"resize",value:function(t,e){this.readFBO.resize({width:t,height:e}),this.writeFBO.resize({width:t,height:e})}},{key:"add",value:function(t,e,n){t.init(e,n),this.passes.push(t)}},{key:"insert",value:function(t,e,n,r){t.init(n,r),this.passes.splice(e,0,t)}},{key:"getPostProcessingPassByName",value:function(t){return this.passes.find((function(e){return e.getName()===t}))}},{key:"init",value:function(){var t=this.rendererService,e=t.createFramebuffer,n=t.createTexture2D;this.readFBO=e({color:n({width:1,height:1,wrapS:At.CLAMP_TO_EDGE,wrapT:At.CLAMP_TO_EDGE})}),this.writeFBO=e({color:n({width:1,height:1,wrapS:At.CLAMP_TO_EDGE,wrapT:At.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(t){for(var e=t+1;e<this.passes.length;e++)if(this.passes[e].isEnabled())return!1;return!0}},{key:"swap",value:function(){var t=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=t}}]),t}(),Hr=(0,ot.Z)(Gr.prototype,"rendererService",[jr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,ot.Z)(Gr.prototype,"init",[Ur],Object.getOwnPropertyDescriptor(Gr.prototype,"init"),Gr.prototype),Vr=Gr))||Vr);function Yr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,I.Z)(t);if(e){var i=(0,I.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,L.Z)(this,n)}}var Kr,Qr,Jr,$r,ti,ei=(0,o.b2)()(Wr=function(t){(0,O.Z)(n,t);var e=Yr(n);function n(){return(0,u.Z)(this,n),e.apply(this,arguments)}return(0,l.Z)(n,[{key:"getType",value:function(){return xn.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(t,e){(0,Tn.Z)((0,I.Z)(n.prototype),"init",this).call(this,t,e)}},{key:"render",value:function(t){var e=this.rendererService,n=e.useFramebuffer,r=e.clear,i=t.multiPassRenderer.getPostProcessor().getReadFBO();n(i,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:i}),t.multiPassRenderer.setRenderFlag(!1),t.models.forEach((function(e){e.draw({uniforms:t.layerModel.getUninforms()})})),t.multiPassRenderer.setRenderFlag(!0)}))}}]),n}(Mn))||Wr;function ni(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function ri(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ni(Object(n),!0).forEach((function(e){(0,c.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ni(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function ii(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,I.Z)(t);if(e){var i=(0,I.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,L.Z)(this,n)}}var oi="varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n}";function ai(t,e){for(var n=0,r=1/e,i=t;i>0;)n+=r*(i%e),i=Math.floor(i/e),r/=e;return n}var si=1,ui=(Kr=(0,o.b2)(),Qr=(0,o.f3)(s.IShaderModuleService),Kr(($r=function(t){(0,O.Z)(n,t);var e=ii(n);function n(){var t;(0,u.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,it.Z)((0,P.Z)(t),"shaderModuleService",ti,(0,P.Z)(t)),(0,c.Z)((0,P.Z)(t),"haltonSequence",[]),(0,c.Z)((0,P.Z)(t),"accumulatingId",0),(0,c.Z)((0,P.Z)(t),"frame",0),(0,c.Z)((0,P.Z)(t),"timer",void 0),(0,c.Z)((0,P.Z)(t),"sampleRenderTarget",void 0),(0,c.Z)((0,P.Z)(t),"prevRenderTarget",void 0),(0,c.Z)((0,P.Z)(t),"outputRenderTarget",void 0),(0,c.Z)((0,P.Z)(t),"copyRenderTarget",void 0),(0,c.Z)((0,P.Z)(t),"blendModel",void 0),(0,c.Z)((0,P.Z)(t),"outputModel",void 0),(0,c.Z)((0,P.Z)(t),"copyModel",void 0),t}return(0,l.Z)(n,[{key:"getType",value:function(){return xn.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(t,e){(0,Tn.Z)((0,I.Z)(n.prototype),"init",this).call(this,t,e);var r=this.rendererService,i=r.createFramebuffer,o=r.createTexture2D;this.sampleRenderTarget=i({color:o({width:1,height:1,wrapS:At.CLAMP_TO_EDGE,wrapT:At.CLAMP_TO_EDGE})}),this.prevRenderTarget=i({color:o({width:1,height:1,wrapS:At.CLAMP_TO_EDGE,wrapT:At.CLAMP_TO_EDGE})}),this.outputRenderTarget=i({color:o({width:1,height:1,wrapS:At.CLAMP_TO_EDGE,wrapT:At.CLAMP_TO_EDGE})}),this.copyRenderTarget=i({color:o({width:1,height:1,wrapS:At.CLAMP_TO_EDGE,wrapT:At.CLAMP_TO_EDGE})});for(var a=0;a<30;a++)this.haltonSequence.push([ai(a,2),ai(a,3)]);this.blendModel=this.createTriangleModel("blend-pass","uniform float u_opacity : 1.0;\nuniform float u_MixRatio : 0.5;\n\nuniform sampler2D u_Diffuse1;\nuniform sampler2D u_Diffuse2;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  vec4 texel1 = texture2D(u_Diffuse1, v_UV);\n  vec4 texel2 = texture2D(u_Diffuse2, v_UV);\n  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);\n}\n"),this.outputModel=this.createTriangleModel("copy-pass",oi,{blend:{enable:!0,func:{srcRGB:At.ONE,dstRGB:At.ONE_MINUS_SRC_ALPHA,srcAlpha:At.ONE,dstAlpha:At.ONE_MINUS_SRC_ALPHA},equation:{rgb:At.FUNC_ADD,alpha:At.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",oi)}},{key:"render",value:function(t){var e=this,n=this.rendererService,r=n.clear,i=n.getViewportSize,o=n.useFramebuffer,a=i(),s=a.width,u=a.height;this.sampleRenderTarget.resize({width:s,height:u}),this.prevRenderTarget.resize({width:s,height:u}),this.outputRenderTarget.resize({width:s,height:u}),this.copyRenderTarget.resize({width:s,height:u}),this.resetFrame(),this.stopAccumulating();var l=t.multiPassRenderer.getPostProcessor().getReadFBO();o(l,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:l}),t.multiPassRenderer.setRenderFlag(!1),t.render(),t.multiPassRenderer.setRenderFlag(!0)}));var c=function n(r){e.accumulatingId&&r===e.accumulatingId&&(e.isFinished()||(e.doRender(t),p.$window.requestAnimationFrame((function(){n(r)}))))};this.accumulatingId=si++,this.timer=p.$window.setTimeout((function(){c(e.accumulatingId)}),50)}},{key:"doRender",value:function(t){var e=this,n=this.rendererService,r=n.clear,i=n.getViewportSize,o=n.useFramebuffer,a=i(),s=a.width,u=a.height,l=t.getLayerConfig().jitterScale,c=void 0===l?1:l,p=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((2*p[0]-1)/s*c,(2*p[1]-1)/u*c),t.multiPassRenderer.setRenderFlag(!1),t.hooks.beforeRender.call(),o(this.sampleRenderTarget,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:e.sampleRenderTarget}),t.render()})),t.hooks.afterRender.call(),t.multiPassRenderer.setRenderFlag(!0);var h=t.getLayerConfig();o(this.outputRenderTarget,(function(){e.blendModel.draw({uniforms:{u_opacity:h.opacity||1,u_MixRatio:0===e.frame?1:.9,u_Diffuse1:e.sampleRenderTarget,u_Diffuse2:0===e.frame?t.multiPassRenderer.getPostProcessor().getReadFBO():e.prevRenderTarget}})})),0===this.frame&&r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(o(this.copyRenderTarget,(function(){e.outputModel.draw({uniforms:{u_Texture:e.outputRenderTarget}})})),o(t.multiPassRenderer.getPostProcessor().getReadFBO(),(function(){e.copyModel.draw({uniforms:{u_Texture:e.copyRenderTarget}})})),t.multiPassRenderer.getPostProcessor().render(t));var f=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=f,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,p.$window.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(t,e,n){this.shaderModuleService.registerModule(t,{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:e});var r=this.shaderModuleService.getModule(t),i=r.vs,o=r.fs,a=r.uniforms,s=this.rendererService,u=s.createAttribute,l=s.createBuffer;return(0,s.createModel)(ri({vs:i,fs:o,attributes:{a_Position:u({buffer:l({data:[-4,-4,4,-4,0,4],type:At.FLOAT}),size:2})},uniforms:ri({},a),depth:{enable:!1},count:3},n))}}]),n}(Mn),ti=(0,ot.Z)($r.prototype,"shaderModuleService",[Qr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jr=$r))||Jr),li=new o.W2;li.bind(s.IGlobalConfigService).to(rt).inSingletonScope(),(0,o.GW)((0,o.b2)(),r.EventEmitter),li.bind(s.IEventEmitter).to(r.EventEmitter);var ci=(0,a.Z)(li,!1),pi=function(t){var e=ci.lazyInject(t);return function(t,n,r){e.call(this,t,n),r&&(r.initializer=function(){return t[n]})}},hi=function(t){var e=ci.lazyMultiInject(t);return function(t,n,r){e.call(this,t,n),r&&(r.initializer=function(){return t[n]})}},fi=li,di=0;function vi(){var t=new o.W2;return t.parent=li,t.bind(s.SceneID).toConstantValue("".concat(di++)),t.bind(s.IShaderModuleService).to(Cn).inSingletonScope(),t.bind(s.ILayerService).to(ve).inSingletonScope(),t.bind(s.ISceneService).to(hn).inSingletonScope(),t.bind(s.ICameraService).to(B).inSingletonScope(),t.bind(s.ICoordinateSystemService).to(St).inSingletonScope(),t.bind(s.IInteractionService).to(Ut).inSingletonScope(),t.bind(s.IPickingService).to(oe).inSingletonScope(),t.bind(s.IControlService).to(W).inSingletonScope(),t.bind(s.IMarkerService).to(q).inSingletonScope(),t.bind(s.IIconService).to(Z).inSingletonScope(),t.bind(s.IFontService).to(k).inSingletonScope(),t.bind(s.IPopupService).to(X).inSingletonScope(),t.bind(s.INormalPass).to(Dn).whenTargetNamed("clear"),t.bind(s.INormalPass).to(Xn).whenTargetNamed("pixelPicking"),t.bind(s.INormalPass).to(ei).whenTargetNamed("render"),t.bind(s.INormalPass).to(ui).whenTargetNamed("taa"),t.bind(s.IFactoryNormalPass).toFactory((function(t){return function(e){return t.container.getNamed(s.INormalPass,e)}})),t.bind(s.IPostProcessingPass).to(Cr).whenTargetNamed("copy"),t.bind(s.IPostProcessingPass).to(sr).whenTargetNamed("bloom"),t.bind(s.IPostProcessingPass).to(hr).whenTargetNamed("blurH"),t.bind(s.IPostProcessingPass).to(yr).whenTargetNamed("blurV"),t.bind(s.IPostProcessingPass).to(zr).whenTargetNamed("noise"),t.bind(s.IPostProcessingPass).to(qr).whenTargetNamed("sepia"),t.bind(s.IPostProcessingPass).to(wr).whenTargetNamed("colorHalftone"),t.bind(s.IPostProcessingPass).to(Pr).whenTargetNamed("hexagonalPixelate"),t.bind(s.IPostProcessingPass).to(Dr).whenTargetNamed("ink"),t.bind(s.IFactoryPostProcessingPass).toFactory((function(t){return function(e){var n=t.container.getNamed(s.IPostProcessingPass,e);return n.setName(e),n}})),t}function mi(t){var e=new o.W2;return e.parent=t,e.bind(s.IStyleAttributeService).to(an).inSingletonScope(),e.bind(s.IMultiPassRenderer).to(Fn).inSingletonScope(),e.bind(s.IPostProcessor).to(Xr).inSingletonScope(),e}var yi=n(74691),gi=n.n(yi),_i=["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"];function xi(t){return _i.indexOf(t)}var bi,wi,Si,Ei,Ci=131072;function Ti(t,e){return 256*(t=gi()(Math.floor(t),0,255))+(e=gi()(Math.floor(e),0,255))}function Ai(t){var e=t.color,n=t.radius,r=t.tileX,i=t.tileY,o=t.shape,a=t.opacity,s=t.stroke,u=t.strokeWidth,l=t.strokeOpacity,c=[],p=[],h=[],f=[Ti(e[0],e[1]),Ti(e[2],e[3])],d=[Ti(s[0],s[1]),Ti(s[2],s[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach((function(t){var e=(0,z.Z)(t,2),s=e[0],v=e[1];c.push([].concat(f,[8388608*(s+1)+2097152*(v+1)+xi(o)*Ci+n,524288*(r+512)+64*(i+512)])),p.push([].concat(d,[u,l])),h.push([a,0,0,0])})),{packedBuffer:c,packedBuffer2:p,packedBuffer3:h}}!function(t){t.normal="normal",t.additive="additive",t.subtractive="subtractive",t.min="min",t.max="max",t.none="none"}(bi||(bi={})),function(t){t.LINEAR="linear",t.SEQUENTIAL="sequential",t.POWER="power",t.LOG="log",t.IDENTITY="identity",t.TIME="time",t.QUANTILE="quantile",t.QUANTIZE="quantize",t.THRESHOLD="threshold",t.CAT="cat",t.DIVERGING="diverging"}(wi||(wi={})),function(t){t.CONSTANT="constant",t.VARIABLE="variable"}(Si||(Si={})),function(t){t[t.Attribute=0]="Attribute",t[t.InstancedAttribute=1]="InstancedAttribute",t[t.Uniform=2]="Uniform"}(Ei||(Ei={}));var Mi,ki=["mapload","mapchange","mapAfterFrameChange"],Pi={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},Oi=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"];!function(t){t.TOPRIGHT="topright",t.TOPLEFT="topleft",t.BOTTOMRIGHT="bottomright",t.BOTTOMLEFT="bottomleft",t.TOPCENTER="topcenter",t.BOTTOMCENTER="bottomcenter",t.LEFTCENTER="leftcenter",t.RIGHTCENTER="rightcenter"}(Mi||(Mi={}))},91011:function(t,e,n){"use strict";n.r(e),n.d(e,{BaseLayer:function(){return ot},CanvasLayer:function(){return _t},CanvasUpdateType:function(){return ft},CityBuildingLayer:function(){return ge},EarthLayer:function(){return Vr},GeometryLayer:function(){return Me},HeatmapLayer:function(){return Ge},ImageLayer:function(){return Ye},LineLayer:function(){return bn},MaskLayer:function(){return Xr},PointLayer:function(){return pr},PolygonLayer:function(){return Sr},RasterLayer:function(){return Lr},WindLayer:function(){return _i},lineStyleType:function(){return ht}});var r,i=n(20832),o=n(15671),a=n(43144),s=n(97326),u=n(60136),l=n(82963),c=n(61120),p=n(4942),h=n(15861),f=n(45987),d=n(43269),v=n(53229),m=n(52353),y=n.n(m),g=n(13218),_=n.n(g),x=n(23560),b=n.n(x),w=n(87757),S=n.n(w),E=n(46343),C=n(33591),T=n(35251),A=n(26729),M=(r={},(0,p.Z)(r,i.BlendType.additive,{enable:!0,func:{srcRGB:i.gl.ONE,dstRGB:i.gl.ONE,srcAlpha:1,dstAlpha:1}}),(0,p.Z)(r,i.BlendType.none,{enable:!1}),(0,p.Z)(r,i.BlendType.normal,{enable:!0,func:{srcRGB:i.gl.SRC_ALPHA,dstRGB:i.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,p.Z)(r,i.BlendType.subtractive,{enable:!0,func:{srcRGB:i.gl.ONE,dstRGB:i.gl.ONE,srcAlpha:i.gl.ZERO,dstAlpha:i.gl.ONE_MINUS_SRC_COLOR},equation:{rgb:i.gl.FUNC_SUBTRACT,alpha:i.gl.FUNC_SUBTRACT}}),(0,p.Z)(r,i.BlendType.max,{enable:!0,func:{srcRGB:i.gl.ONE,dstRGB:i.gl.ONE},equation:{rgb:i.gl.MAX_EXT}}),(0,p.Z)(r,i.BlendType.min,{enable:!0,func:{srcRGB:i.gl.ONE,dstRGB:i.gl.ONE},equation:{rgb:i.gl.MIN_EXT}}),r),k=n(47037),P=n.n(k),O=n(81763),L=n.n(O);function I(t,e,n,r,i){e.updateStyleAttribute(t,n,r,i)}function R(t,e){t.opacity&&D("opacity",e,t.opacity),t.strokeWidth&&D("strokeWidth",e,t.strokeWidth),t.strokeOpacity&&D("strokeOpacity",e,t.strokeOpacity),t.stroke&&function(t,e,n){P()(n)?I(t,e,n,void 0):Array.isArray(n)&&2===n.length&&(P()(n[0])&&b()(n[1])||P()(n[0])&&Array.isArray(n[1])&&n[1].length>0)?I(t,e,n[0],n[1]):I(t,e,"#fff",void 0)}("stroke",e,t.stroke),t.offsets&&N("offsets",e,t.offsets),t.textOffset&&N("textOffset",e,t.textOffset),t.thetaOffset&&D("thetaOffset",e,t.thetaOffset)}function D(t,e,n){P()(n)?I(t,e,n,(function(t){return t})):L()(n)?I(t,e,[n],void 0):Array.isArray(n)&&2===n.length&&(P()(n[0])&&b()(n[1])||P()(n[0])&&Array.isArray(n[1])&&L()(n[1][0])&&L()(n[1][1]))?I(t,e,n[0],n[1]):I(t,e,[1],void 0)}function N(t,e,n){P()(n)?I(t,e,n,(function(t){return t})):Array.isArray(n)&&2===n.length&&P()(n[0])&&b()(n[1])?I(t,e,n[0],n[1]):Array.isArray(n)&&2===n.length&&L()(n[0])&&L()(n[1])?I(t,e,n,void 0):I(t,e,[0,0],void 0)}var Z=n(84859);function z(t,e){t.length>0&&e.version===Z.G.SIMPLE&&t.map((function(t){t.simpleCoordinate||(t.coordinates=function(t,e){if("number"==typeof t[0])return e.simpleMapCoord.unproject(t);if(t[0]&&t[0][0]instanceof Array){var n=[];return t.map((function(t){var r=[];t.map((function(t){r.push(e.simpleMapCoord.unproject(t))})),n.push(r)})),n}var r=[];return t.map((function(t){r.push(e.simpleMapCoord.unproject(t))})),r}(t.coordinates,e),t.simpleCoordinate=!0)}))}function F(t,e,n,r,i,o){var a=(null==o?void 0:o.getLayerConfig()).arrow,s=void 0===a?{enable:!1}:a,u=e.map((function(e){var r,o,a,u,l={id:e._id,coordinates:e.coordinates};if(t.filter((function(t){return void 0!==t.scale})).forEach((function(t){var r=function(t,e,n){var r;if(!t.scale)return[];var i=(null==t||null===(r=t.scale)||void 0===r?void 0:r.scalers)||[],o=[];i.forEach((function(n){var r,i=n.field;(e.hasOwnProperty(i)||"variable"===(null===(r=t.scale)||void 0===r?void 0:r.type))&&o.push(e[i])}));var a=t.mapping?t.mapping(o):[];return"color"!==t.name||(0,T.isColor)(a[0])?a:[n]}(t,e,i);t.needRemapping=!1,"color"===t.name&&(r=r.map((function(t){return(0,T.rgb2arr)(t)}))),l[t.name]=Array.isArray(r)&&1===r.length?r[0]:r,"shape"===t.name&&(l.shape=n.getIconFontKey(l[t.name]))})),"line"===l.shape&&s.enable){var c=l.coordinates,p=(r=c[0],o=c[1],a=[o[0]-r[0],o[1]-r[1]],u=(0,T.normalize)(a),[r[0]+1e-4*u[0],r[1]+1e-4*u[1]]);l.coordinates.splice(1,0,p,p)}return l}));return function(t,e){var n=this;t.length>0&&e.version===Z.G["GAODE2.x"]&&("number"==typeof t[0].coordinates[0]?t.filter((function(t){return!t.originCoordinates})).map((function(t){t.version=Z.G["GAODE2.x"],t.originCoordinates=cloneDeep(t.coordinates),t.coordinates=n.mapService.lngLatToCoord(t.coordinates)})):t.filter((function(t){return!t.originCoordinates})).map((function(t){t.version=Z.G["GAODE2.x"],t.originCoordinates=cloneDeep(t.coordinates),t.coordinates=n.mapService.lngLatToCoords(t.coordinates)})))}(u,r),z(u,r),u}var B=n(29439);function j(t){return t.map((function(t){return"string"==typeof t&&(t=[t,{}]),t}))}function U(t,e,n,r){var i=t.multiPassRenderer,o=t.getLayerConfig();o.enablePicking;return o.enableTAA?i.add(r("taa")):i.add(r("render")),j(e).forEach((function(t){var e=(0,B.Z)(t,2),r=e[0],o=e[1];i.add(n(r),o)})),i.add(n("copy")),i}var V=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];var G,H,W,q=n(25108),X=["passes"],Y=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"];function K(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return Q(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Q(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Q(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function J(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function $(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?J(Object(n),!0).forEach((function(e){(0,p.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):J(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function tt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var et,nt,rt,it=0,ot=(G=(0,i.lazyInject)(i.TYPES.IGlobalConfigService),H=function(t){(0,u.Z)(l,t);var e,n,r=tt(l);function l(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.Z)(this,l),t=r.call(this),(0,p.Z)((0,s.Z)(t),"id","".concat(it++)),(0,p.Z)((0,s.Z)(t),"name","".concat(it)),(0,p.Z)((0,s.Z)(t),"type",void 0),(0,p.Z)((0,s.Z)(t),"visible",!0),(0,p.Z)((0,s.Z)(t),"zIndex",0),(0,p.Z)((0,s.Z)(t),"minZoom",void 0),(0,p.Z)((0,s.Z)(t),"maxZoom",void 0),(0,p.Z)((0,s.Z)(t),"inited",!1),(0,p.Z)((0,s.Z)(t),"layerModelNeedUpdate",!1),(0,p.Z)((0,s.Z)(t),"pickedFeatureID",null),(0,p.Z)((0,s.Z)(t),"selectedFeatureID",null),(0,p.Z)((0,s.Z)(t),"styleNeedUpdate",!1),(0,p.Z)((0,s.Z)(t),"rendering",void 0),(0,p.Z)((0,s.Z)(t),"clusterZoom",0),(0,p.Z)((0,s.Z)(t),"layerType",void 0),(0,p.Z)((0,s.Z)(t),"isLayerGroup",!1),(0,p.Z)((0,s.Z)(t),"triangulation",void 0),(0,p.Z)((0,s.Z)(t),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,p.Z)((0,s.Z)(t),"hooks",{init:new E.oI,afterInit:new E.oI,beforeRender:new E.oI,beforeRenderData:new E.gg,afterRender:new E.ni,beforePickingEncode:new E.ni,afterPickingEncode:new E.ni,beforeHighlight:new E.ni(["pickedColor"]),afterHighlight:new E.ni,beforeSelect:new E.ni(["pickedColor"]),afterSelect:new E.ni,beforeDestroy:new E.ni,afterDestroy:new E.ni}),(0,p.Z)((0,s.Z)(t),"models",[]),(0,p.Z)((0,s.Z)(t),"multiPassRenderer",void 0),(0,p.Z)((0,s.Z)(t),"plugins",void 0),(0,p.Z)((0,s.Z)(t),"sourceOption",void 0),(0,p.Z)((0,s.Z)(t),"layerModel",void 0),(0,p.Z)((0,s.Z)(t),"shapeOption",void 0),(0,p.Z)((0,s.Z)(t),"sceneContainer",void 0),(0,p.Z)((0,s.Z)(t),"layerChildren",[]),(0,p.Z)((0,s.Z)(t),"masks",[]),(0,d.Z)((0,s.Z)(t),"configService",W,(0,s.Z)(t)),(0,p.Z)((0,s.Z)(t),"shaderModuleService",void 0),(0,p.Z)((0,s.Z)(t),"cameraService",void 0),(0,p.Z)((0,s.Z)(t),"coordinateService",void 0),(0,p.Z)((0,s.Z)(t),"iconService",void 0),(0,p.Z)((0,s.Z)(t),"fontService",void 0),(0,p.Z)((0,s.Z)(t),"pickingService",void 0),(0,p.Z)((0,s.Z)(t),"rendererService",void 0),(0,p.Z)((0,s.Z)(t),"layerService",void 0),(0,p.Z)((0,s.Z)(t),"interactionService",void 0),(0,p.Z)((0,s.Z)(t),"mapService",void 0),(0,p.Z)((0,s.Z)(t),"styleAttributeService",void 0),(0,p.Z)((0,s.Z)(t),"layerSource",void 0),(0,p.Z)((0,s.Z)(t),"postProcessingPassFactory",void 0),(0,p.Z)((0,s.Z)(t),"normalPassFactory",void 0),(0,p.Z)((0,s.Z)(t),"animateOptions",{enable:!1}),(0,p.Z)((0,s.Z)(t),"container",void 0),(0,p.Z)((0,s.Z)(t),"encodedData",void 0),(0,p.Z)((0,s.Z)(t),"configSchema",void 0),(0,p.Z)((0,s.Z)(t),"currentPickId",null),(0,p.Z)((0,s.Z)(t),"rawConfig",void 0),(0,p.Z)((0,s.Z)(t),"needUpdateConfig",void 0),(0,p.Z)((0,s.Z)(t),"pendingStyleAttributes",[]),(0,p.Z)((0,s.Z)(t),"scaleOptions",{}),(0,p.Z)((0,s.Z)(t),"animateStartTime",void 0),(0,p.Z)((0,s.Z)(t),"aniamateStatus",!1),(0,p.Z)((0,s.Z)(t),"bottomColor","rgba(0, 0, 0, 0)"),(0,p.Z)((0,s.Z)(t),"isDestroied",!1),(0,p.Z)((0,s.Z)(t),"sourceEvent",(function(){t.dataState.dataSourceNeedUpdate=!0;var e=t.getLayerConfig(),n=e.autoFit,r=e.fitBoundsOptions;n&&t.fitBounds(r),t.reRender()})),t.name=e.name||t.id,t.zIndex=e.zIndex||0,t.rawConfig=e,t}return(0,a.Z)(l,[{key:"addMaskLayer",value:function(t){this.masks.push(t)}},{key:"removeMaskLayer",value:function(t){var e=this.masks.indexOf(t);e>-1&&this.masks.splice(e,1),t.destroy()}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(t){if(this.inited){var e=this.container.get(i.TYPES.SceneID);R(t,this),this.configService.setLayerConfig(e,this.id,$($($({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),t)),this.needUpdateConfig={}}else this.needUpdateConfig=$($({},this.needUpdateConfig),t)}},{key:"setContainer",value:function(t,e){this.container=t,this.sceneContainer=e}},{key:"getContainer",value:function(){return this.container}},{key:"setBottomColor",value:function(t){this.bottomColor=t}},{key:"getBottomColor",value:function(){return this.bottomColor}},{key:"addPlugin",value:function(t){return this.plugins.push(t),this}},{key:"init",value:function(){var t=this,e=this.container.get(i.TYPES.SceneID);this.configService.setLayerConfig(e,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(i.TYPES.IIconService),this.fontService=this.container.get(i.TYPES.IFontService),this.rendererService=this.container.get(i.TYPES.IRendererService),this.layerService=this.container.get(i.TYPES.ILayerService),this.interactionService=this.container.get(i.TYPES.IInteractionService),this.pickingService=this.container.get(i.TYPES.IPickingService),this.mapService=this.container.get(i.TYPES.IMapService);var n=this.getLayerConfig(),r=n.enableMultiPassRenderer,o=n.passes;r&&null!=o&&o.length&&o.length>0&&this.mapService.on("mapAfterFrameChange",(function(){t.renderLayers()})),this.cameraService=this.container.get(i.TYPES.ICameraService),this.coordinateService=this.container.get(i.TYPES.ICoordinateSystemService),this.shaderModuleService=this.container.get(i.TYPES.IShaderModuleService),this.postProcessingPassFactory=this.container.get(i.TYPES.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(i.TYPES.IFactoryNormalPass),this.styleAttributeService=this.container.get(i.TYPES.IStyleAttributeService),this.multiPassRenderer=this.container.get(i.TYPES.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach((function(e){var n=e.attributeName,r=e.attributeField,i=e.attributeValues,o=e.updateOptions;t.styleAttributeService.updateStyleAttribute(n,{scale:$({field:r},t.splitValuesAndCallbackInAttribute(i,t.getLayerConfig()[n]))},o)})),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(i.TYPES.ILayerPlugin);var a,s=K(this.plugins);try{for(s.s();!(a=s.n()).done;){a.value.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(t){s.e(t)}finally{s.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"updateModelData",value:function(t){t.attributes&&t.elements?this.models.map((function(e){e.updateAttributesAndElements(t.attributes,t.elements)})):q.warn("data error")}},{key:"createModelData",value:function(t,e){if(this.layerModel.createModelData)return this.layerModel.createModelData(e);var n=this.calculateEncodeData(t,e),r=this.triangulation;return n&&r?this.styleAttributeService.createAttributesAndIndices(n,r):{attributes:void 0,elements:void 0}}},{key:"calculateEncodeData",value:function(t,e){return this.inited?function(t,e,n,r,i,o){var a=new C.default(i,o),s=t.getBottomColor(),u=F(r.getLayerStyleAttributes()||[],a.data.dataArray,e,n,s,t);return a.destroy(),u}(this,this.fontService,this.mapService,this.styleAttributeService,t,e):(q.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig($($({},this.getDefaultConfig()),this.rawConfig));var t=this.getLayerConfig().animateOption;null!=t&&t.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(t,e,n){return this.updateStyleAttribute("color",t,e,n),this}},{key:"texture",value:function(t,e,n){return this.updateStyleAttribute("texture",t,e,n),this}},{key:"rotate",value:function(t,e,n){return this.updateStyleAttribute("rotate",t,e,n),this}},{key:"size",value:function(t,e,n){return this.updateStyleAttribute("size",t,e,n),this}},{key:"filter",value:function(t,e,n){return this.updateStyleAttribute("filter",t,e,n),this}},{key:"shape",value:function(t,e,n){var r,i,o,a=null===(r=this.styleAttributeService)||void 0===r||null===(i=r.getLayerStyleAttribute("shape"))||void 0===i||null===(o=i.scale)||void 0===o?void 0:o.field,s=t;return this.shapeOption={field:t,values:e},this.updateStyleAttribute("shape",t,e,n),function(t,e,n){if("string"==typeof e&&"string"==typeof n&&e!==n){if("PointLayer"===t.type)return void(t.dataState.dataSourceNeedUpdate=!0);V.map((function(r){r.includes(e)&&r.includes(n)&&(t.dataState.dataSourceNeedUpdate=!0)}))}}(this,a,s),this}},{key:"label",value:function(t,e,n){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:t,attributeValues:e,updateOptions:n}),this}},{key:"animate",value:function(t){var e={};return _()(t)?(e.enable=!0,e=$($({},e),t)):e.enable=t,this.updateLayerConfig({animateOption:e}),this}},{key:"source",value:function(t,e){return null!=t&&t.data?(this.setSource(t),this):(this.sourceOption={data:t,options:e},this.clusterZoom=0,this)}},{key:"setData",value:function(t,e){var n=this;return this.inited?this.layerSource.setData(t,e):this.on("inited",(function(){n.getSource()?n.layerSource.setData(t,e):(n.source(new C.default(t,e)),n.sourceEvent())})),this}},{key:"style",value:function(t){var e=this,n=this.getLayerConfig(),r=t.passes,i=(0,f.Z)(t,X);return r&&j(r).forEach((function(t){var n=e.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(t[0]);n&&n.updateOptions(t[1])})),this.rawConfig=$($({},this.rawConfig),i),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),n&&!0===n.mask&&!1===t.mask&&(this.clearModels(),this.models=this.layerModel.buildModels()),this}},{key:"scale",value:function(t,e){return _()(t)?this.scaleOptions=$($({},this.scaleOptions),t):this.scaleOptions[t]=e,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return 0!==this.getEncodedData().length&&this.renderModels(),this}},{key:"renderMultiPass",value:(n=(0,h.Z)(S().mark((function t(){return S().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0===this.getEncodedData().length){t.next=7;break}if(!this.multiPassRenderer||!this.multiPassRenderer.getRenderFlag()){t.next=6;break}return t.next=4,this.multiPassRenderer.render();case 4:t.next=7;break;case 6:this.multiPassRenderer,this.renderModels();case 7:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"active",value:function(t){var e={};return e.enableHighlight=!!_()(t)||t,_()(t)?(e.enableHighlight=!0,t.color&&(e.highlightColor=t.color),t.mix&&(e.activeMix=t.mix)):e.enableHighlight=!!t,this.updateLayerConfig(e),this}},{key:"setActive",value:function(t,e){var n=this;if(_()(t)){var r=t.x,i=void 0===r?0:r,o=t.y,a=void 0===o?0:o;this.updateLayerConfig({highlightColor:_()(e)?e.color:this.getLayerConfig().highlightColor,activeMix:_()(e)?e.mix:this.getLayerConfig().activeMix}),this.pick({x:i,y:a})}else this.updateLayerConfig({pickedFeatureID:t,highlightColor:_()(e)?e.color:this.getLayerConfig().highlightColor,activeMix:_()(e)?e.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call((0,T.encodePickingColor)(t)).then((function(){setTimeout((function(){n.reRender()}),1)}))}},{key:"select",value:function(t){var e={};return e.enableSelect=!!_()(t)||t,_()(t)?(e.enableSelect=!0,t.color&&(e.selectColor=t.color),t.mix&&(e.selectMix=t.mix)):e.enableSelect=!!t,this.updateLayerConfig(e),this}},{key:"setSelect",value:function(t,e){var n=this;if(_()(t)){var r=t.x,i=void 0===r?0:r,o=t.y,a=void 0===o?0:o;this.updateLayerConfig({selectColor:_()(e)?e.color:this.getLayerConfig().selectColor,selectMix:_()(e)?e.mix:this.getLayerConfig().selectMix}),this.pick({x:i,y:a})}else this.updateLayerConfig({pickedFeatureID:t,selectColor:_()(e)?e.color:this.getLayerConfig().selectColor,selectMix:_()(e)?e.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call((0,T.encodePickingColor)(t)).then((function(){setTimeout((function(){n.reRender()}),1)}))}},{key:"setBlend",value:function(t){return this.updateLayerConfig({blend:t}),this.layerModelNeedUpdate=!0,this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return"CanvasLayer"===this.type&&this.layerModel.clearCanvas&&this.layerModel.clearCanvas(),this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(t){return this.zIndex=t,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(t){this.currentPickId=t}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(t){this.selectedFeatureID=t}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var t=this.mapService.getZoom(),e=this.getLayerConfig(),n=e.visible,r=e.minZoom,i=void 0===r?-1/0:r,o=e.maxZoom;return!!n&&t>=i&&t<=(void 0===o?1/0:o)}},{key:"setMultiPass",value:function(t,e){if(this.updateLayerConfig({enableMultiPassRenderer:t}),e&&this.updateLayerConfig({passes:e}),t){var n=this.getLayerConfig().passes,r=void 0===n?[]:n;this.multiPassRenderer=U(this,r,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var i=this.rendererService.getViewportSize(),o=i.width,a=i.height;this.multiPassRenderer.resize(o,a)}return this}},{key:"setMinZoom",value:function(t){return this.updateLayerConfig({minZoom:t}),this}},{key:"getMinZoom",value:function(){return this.getLayerConfig().minZoom}},{key:"getMaxZoom",value:function(){return this.getLayerConfig().maxZoom}},{key:"get",value:function(t){return this.getLayerConfig()[t]}},{key:"setMaxZoom",value:function(t){return this.updateLayerConfig({maxZoom:t}),this}},{key:"setAutoFit",value:function(t){return this.updateLayerConfig({autoFit:t}),this}},{key:"fitBounds",value:function(t){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var e=this.getSource().extent;return e.some((function(t){return Math.abs(t)===1/0}))||this.mapService.fitBounds([[e[0],e[1]],[e[2],e[3]]],t),this}},{key:"destroy",value:function(){var t;this.isDestroied||(this.layerChildren.map((function(t){return t.destroy()})),this.layerChildren=[],this.masks.map((function(t){return t.destroy()})),this.masks=[],this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),null===(t=this.layerModel)||void 0===t||t.clearModels(),this.models=[],this.layerService.cleanRemove(this),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroied=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach((function(t){return t.destroy()})),this.layerModel.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter((function(t){return t.needRescale||t.needRemapping||t.needRegenerateVertices})).length}},{key:"setSource",value:function(t){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=t,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var e=this.mapService.getZoom();this.layerSource.updateClusterData(e)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(t){this.encodedData=t}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(t){return this.styleAttributeService.getLayerAttributeScale(t)}},{key:"getLegendItems",value:function(t){var e=this.styleAttributeService.getLayerAttributeScale(t);return e?e.invertExtent?e.range().map((function(n){return(0,p.Z)({value:e.invertExtent(n)},t,n)})):e.ticks?e.ticks().map((function(n){return(0,p.Z)({value:n},t,e(n))})):null!=e&&e.domain?e.domain().filter((function(t){return!y()(t)})).map((function(n){return(0,p.Z)({value:n},t,e(n))})):[]:[]}},{key:"pick",value:function(t){var e=t.x,n=t.y;this.interactionService.triggerHover({x:e,y:n})}},{key:"boxSelect",value:function(t,e){this.pickingService.boxPickLayer(this,t,e)}},{key:"buildLayerModel",value:function(t){var e=t.moduleName,n=t.vertexShader,r=t.fragmentShader,o=t.triangulation,a=t.segmentNumber,s=(0,f.Z)(t,Y);this.shaderModuleService.registerModule(e,{vs:n,fs:r});var u=this.shaderModuleService.getModule(e),l=u.vs,c=u.fs,p=u.uniforms,h=this.rendererService.createModel,d=this.styleAttributeService.createAttributesAndIndices(this.encodedData,o,a);return h($({attributes:d.attributes,uniforms:p,fs:c,vs:l,elements:d.elements,blend:M[i.BlendType.normal]},s))}},{key:"createAttrubutes",value:function(t){var e=t.triangulation;return this.styleAttributeService.createAttributes(this.encodedData,e).attributes}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(t){var e=this.getLayerConfig(),n=e.enableHighlight,r=void 0===n||n,i=e.enableSelect,o=void 0===i||i,a=-1!==this.eventNames().indexOf(t)||-1!==this.eventNames().indexOf("un"+t);return"click"!==t&&"dblclick"!==t||!o||(a=!0),"mousemove"!==t||!r&&-1===this.eventNames().indexOf("mouseenter")&&-1===this.eventNames().indexOf("unmousemove")&&-1===this.eventNames().indexOf("mouseout")||(a=!0),this.isVisible()&&a}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderMulPass",value:(e=(0,h.Z)(S().mark((function t(e){return S().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.render();case 2:case"end":return t.stop()}}),t)}))),function(t){return e.apply(this,arguments)})},{key:"renderModels",value:function(t){var e=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.layerModel.renderUpdate&&this.layerModel.renderUpdate(),this.models.forEach((function(n){n.draw({uniforms:e.layerModel.getUninforms()},t)}))),this}},{key:"updateStyleAttribute",value:function(t,e,n,r){this.inited?this.styleAttributeService.updateStyleAttribute(t,{scale:$({field:e},this.splitValuesAndCallbackInAttribute(n,this.getLayerConfig()[e]))},r):this.pendingStyleAttributes.push({attributeName:t,attributeField:e,attributeValues:n,updateOptions:r})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(t){q.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&(this.layerService.updateLayerRenderList(),this.layerService.renderLayers())}},{key:"splitValuesAndCallbackInAttribute",value:function(t,e){return{values:b()(t)?void 0:t||e,callback:b()(t)?t:void 0}}}]),l}(A.EventEmitter),W=(0,v.Z)(H.prototype,"configService",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H),at=n(93433),st=n(18446),ut=n.n(st),lt=n(2650);function ct(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return pt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return pt(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function pt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var ht,ft,dt=(et=(0,i.lazyInject)(i.TYPES.IGlobalConfigService),nt=function(){function t(e){(0,o.Z)(this,t),(0,p.Z)(this,"triangulation",void 0),(0,p.Z)(this,"createTexture2D",void 0),(0,p.Z)(this,"layer",void 0),(0,p.Z)(this,"dataTexture",void 0),(0,p.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,p.Z)(this,"rowCount",void 0),(0,p.Z)(this,"cacheStyleProperties",void 0),(0,p.Z)(this,"cellLength",void 0),(0,p.Z)(this,"cellProperties",void 0),(0,p.Z)(this,"cellTypeLayout",void 0),(0,p.Z)(this,"stylePropertyesExist",void 0),(0,p.Z)(this,"dataTextureTest",void 0),(0,d.Z)(this,"configService",rt,this),(0,p.Z)(this,"shaderModuleService",void 0),(0,p.Z)(this,"rendererService",void 0),(0,p.Z)(this,"iconService",void 0),(0,p.Z)(this,"fontService",void 0),(0,p.Z)(this,"styleAttributeService",void 0),(0,p.Z)(this,"mapService",void 0),(0,p.Z)(this,"cameraService",void 0),(0,p.Z)(this,"layerService",void 0),this.layer=e,this.rendererService=e.getContainer().get(i.TYPES.IRendererService),this.shaderModuleService=e.getContainer().get(i.TYPES.IShaderModuleService),this.styleAttributeService=e.getContainer().get(i.TYPES.IStyleAttributeService),this.mapService=e.getContainer().get(i.TYPES.IMapService),this.iconService=e.getContainer().get(i.TYPES.IIconService),this.fontService=e.getContainer().get(i.TYPES.IFontService),this.cameraService=e.getContainer().get(i.TYPES.ICameraService),this.layerService=e.getContainer().get(i.TYPES.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var n=this.rendererService.createTexture2D;this.createTexture2D=n,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8Array(4),mag:i.gl.NEAREST,min:i.gl.NEAREST,width:1,height:1}))}return(0,a.Z)(t,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,this.stylePropertyesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(t){var e=!1;return ut()(t.thetaOffset,this.cacheStyleProperties.thetaOffset)||(e=!0,this.cacheStyleProperties.thetaOffset=t.thetaOffset),ut()(t.opacity,this.cacheStyleProperties.opacity)||(e=!0,this.cacheStyleProperties.opacity=t.opacity),ut()(t.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(e=!0,this.cacheStyleProperties.strokeOpacity=t.strokeOpacity),ut()(t.strokeWidth,this.cacheStyleProperties.strokeWidth)||(e=!0,this.cacheStyleProperties.strokeWidth=t.strokeWidth),ut()(t.stroke,this.cacheStyleProperties.stroke)||(e=!0,this.cacheStyleProperties.stroke=t.stroke),ut()(t.offsets,this.cacheStyleProperties.offsets)||(e=!0,this.cacheStyleProperties.offsets=t.offsets),void 0===this.dataTexture&&(e=!0),e}},{key:"judgeStyleAttributes",value:function(t){this.clearLastCalRes(),void 0===t.opacity||L()(t.opacity)||(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),void 0===t.strokeOpacity||L()(t.strokeOpacity)||(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),void 0===t.strokeWidth||L()(t.strokeWidth)||(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),void 0===t.stroke||this.isStaticColor(t.stroke)||(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),void 0===t.offsets||this.isOffsetStatic(t.offsets)||(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2),void 0===t.thetaOffset||L()(t.thetaOffset)||(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertyesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(t){return!!P()(t)&&!!(0,lt.ZP)(t)}},{key:"getStrokeColor",value:function(t){if(this.isStaticColor(t)){var e=(0,T.rgb2arr)(t);return e[0]=e[0]?e[0]:0,e[1]=e[1]?e[1]:0,e[2]=e[2]?e[2]:0,e[3]=e[3]?e[3]:0,e}return[0,0,0,0]}},{key:"isOffsetStatic",value:function(t){return!!(Array.isArray(t)&&2===t.length&&L()(t[0])&&L()(t[1]))}},{key:"patchMod",value:function(t,e){for(var n=0;n<e;n++)t.push(-1)}},{key:"patchData",value:function(t,e,n){var r,i=ct(n);try{for(i.s();!(r=i.n()).done;){var o=r.value,a=o.attr,s=o.count,u=e[a];void 0!==u?"stroke"===a?t.push.apply(t,(0,at.Z)((0,T.rgb2arr)(u))):"offsets"===a?this.isOffsetStatic(u)?t.push(-u[0],u[1]):t.push(0,0):t.push(L()(u)?u:1):this.patchMod(t,s)}}catch(t){i.e(t)}finally{i.f()}}},{key:"calDataFrame",value:function(t,e,n){for(var r=e.length,i=Math.ceil(r*t/this.DATA_TEXTURE_WIDTH),o=i*this.DATA_TEXTURE_WIDTH,a=[],s=0;s<r;s++){var u=e[s];this.patchData(a,u,n)}for(var l=a.length;l<o;l++)a.push(-1);return{data:a,width:this.DATA_TEXTURE_WIDTH,height:i}}},{key:"getBlend",value:function(){var t=this.layer.getLayerConfig().blend,e=void 0===t?"normal":t;return M[i.BlendType[e]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.duration||4,t.interval||.2,t.trailLength||.1]}},{key:"startModelAnimate",value:function(){this.layer.getLayerConfig().animateOption.enable&&this.layer.setAnimateStartTime()}}]),t}(),rt=(0,v.Z)(nt.prototype,"configService",[et],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nt);function vt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}!function(t){t[t.solid=0]="solid",t[t.dash=1]="dash"}(ht||(ht={})),function(t){t.ALWAYS="always",t.DRAGEND="dragend"}(ft||(ft={}));var mt=function(t){(0,u.Z)(n,t);var e=vt(n);function n(){var t;(0,o.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i)),(0,p.Z)((0,s.Z)(t),"updateMode",ft.ALWAYS),(0,p.Z)((0,s.Z)(t),"canvas",void 0),(0,p.Z)((0,s.Z)(t),"ctx",void 0),(0,p.Z)((0,s.Z)(t),"prevSize",void 0),(0,p.Z)((0,s.Z)(t),"renderUpdate",(function(){var e=t.layer.getLayerConfig(),n=e.zIndex,r=void 0===n?10:n,i=e.update,o=void 0===i?ft.ALWAYS:i,a=e.animateOption,s=void 0===a?{enable:!1,duration:20}:a;+t.canvas.style.zIndex===r&&(t.canvas.style.zIndex=r+""),t.updateMode!==o&&(t.updateMode=o,t.unBindListener(),t.bindListener()),t.updateMode===ft.ALWAYS&&s.enable&&t.renderCanvas()})),(0,p.Z)((0,s.Z)(t),"unBindListener",(function(){t.mapService.off("mapchange",t.renderCanvas),t.mapService.off("zoomstart",t.clearCanvas),t.mapService.off("zoomend",t.renderCanvas),t.mapService.off("movestart",t.clearCanvas),t.mapService.off("moveend",t.renderCanvas)})),(0,p.Z)((0,s.Z)(t),"bindListener",(function(){t.updateMode===ft.ALWAYS?t.mapService.on("mapchange",t.renderCanvas):(t.mapService.on("zoomstart",t.clearCanvas),t.mapService.on("zoomend",t.renderCanvas),t.mapService.on("movestart",t.clearCanvas),t.mapService.on("moveend",t.renderCanvas))})),(0,p.Z)((0,s.Z)(t),"clearCanvas",(function(){if(t.ctx){var e=t.rendererService.getViewportSize(),n=e.width,r=e.height;t.ctx.clearRect(0,0,n,r)}})),(0,p.Z)((0,s.Z)(t),"renderCanvas",(function(){var e=t.rendererService.getViewportSize(),n=e.width,r=e.height;if(t.prevSize[0]!==n||t.prevSize[1]!==r){t.prevSize=[n,r];var i=t.mapService.getSize(),o=(0,B.Z)(i,2),a=o[0],s=o[1];t.canvas.width=n,t.canvas.height=r,t.canvas.style.width=a+"px",t.canvas.style.height=s+"px"}var u=t.layer.getLayerConfig().drawingOnCanvas;t.ctx&&u({canvas:t.canvas,ctx:t.ctx,mapService:t.mapService,size:[n,r]})})),t}return(0,a.Z)(n,[{key:"clearModels",value:function(){var t;this.canvas&&(null===(t=this.mapService.getContainer())||void 0===t||t.removeChild(this.canvas),this.canvas=null);this.unBindListener()}},{key:"initModels",value:function(){var t=this.layer.getLayerConfig().update,e=void 0===t?ft.ALWAYS:t;return this.updateMode=e,this.initCanvas(),this.renderCanvas(),this.bindListener(),this.mapService.getContainer(),[]}},{key:"initCanvas",value:function(){var t,e=this.layer.getLayerConfig().zIndex,n=this.mapService.getSize(),r=(0,B.Z)(n,2),i=r[0],o=r[1],a=this.rendererService.getViewportSize(),s=a.width,u=a.height;this.prevSize=[s,u];var l=document.createElement("canvas");this.canvas=l,l.width=s,l.height=u,l.style.pointerEvents="none",l.style.width=i+"px",l.style.height=o+"px",l.style.position="absolute",l.style.top="0",l.style.left="0",l.style.zIndex=e+"",null===(t=this.mapService.getContainer())||void 0===t||t.appendChild(l);var c=l.getContext("2d");this.ctx=c}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){}}]),n}(dt),yt={canvas:mt};function gt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var _t=function(t){(0,u.Z)(n,t);var e=gt(n);function n(){var t;(0,o.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i)),(0,p.Z)((0,s.Z)(t),"type","CanvasLayer"),t}return(0,a.Z)(n,[{key:"buildModels",value:function(){var t=this.getModelType();this.layerModel=new yt[t](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{canvas:{}}[this.getModelType()]}},{key:"getModelType",value:function(){return"canvas"}}]),n}(ot),xt=n(9187),bt=n.n(xt),wt=n(85975),St=n(77160),Et=100;function Ct(t){return t/180*Math.acos(-1)}function Tt(t){var e=Ct(t[0])+Math.PI/2,n=Ct(t[1]),r=Et+.4*Math.random(),i=r*Math.cos(n)*Math.cos(e);return[r*Math.cos(n)*Math.sin(e),r*Math.sin(n),i]}function At(t,e){var n=wt.create(),r=wt.create(),i=St.fromValues(0,1,0),o=St.fromValues(0,0,0);t=void 0!==t?t:1;for(var a=2+(void 0!==(e=e||{}).segments?e.segments:32),s=2*a,u=[],l=[],c=[],p=[],h=[],f=[],d=0;d<=a;d++){for(var v=d/a,m=v*Math.PI,y=0;y<=s;y++){var g=y/s,_=g*Math.PI*2;wt.identity(r),wt.rotateZ(r,r,-m),wt.identity(n),wt.rotateY(n,n,_),St.transformMat4(o,i,r),St.transformMat4(o,o,n),St.scale(o,o,-t),c.push(o.slice()),p.push.apply(p,(0,at.Z)(o.slice())),St.normalize(o,o),h.push.apply(h,(0,at.Z)(o.slice())),f.push([g,1-v]),p.push(g,1-v)}if(d>0)for(var x=c.length,b=x-2*(s+1);b+s+2<x;b++)u.push([b,b+1,b+s+1]),l.push(b,b+1,b+s+1),u.push([b+s+1,b+1,b+s+2]),l.push(b+s+1,b+1,b+s+2)}return{cells:u,positions:c,uvs:f,positionsArr:p,indicesArr:l,normalArr:h}}var Mt=n(31437),kt=Mt.Ue(),Pt=(Mt.Ue(),Mt.Ue()),Ot=Mt.Ue(),Lt=Mt.Ue();function It(t,e,n,r,i){Mt.IH(t,n,r),Mt.Fv(t,t),e=Mt.al(-t[1],t[0]);var o=Mt.al(-n[1],n[0]);return[i/Mt.AK(e,o),e]}function Rt(t,e){return Mt.t8(t,-e[1],e[0])}function Dt(t,e,n){return Mt.lu(t,e,n),Mt.Fv(t,t),t}function Nt(t,e){return t[0]===e[0]&&t[1]===e[1]}var Zt,zt,Ft,Bt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,o.Z)(this,t),(0,p.Z)(this,"complex",void 0),(0,p.Z)(this,"join",void 0),(0,p.Z)(this,"cap",void 0),(0,p.Z)(this,"miterLimit",void 0),(0,p.Z)(this,"thickness",void 0),(0,p.Z)(this,"normal",void 0),(0,p.Z)(this,"lastFlip",-1),(0,p.Z)(this,"miter",Mt.al(0,0)),(0,p.Z)(this,"started",!1),(0,p.Z)(this,"dash",!1),(0,p.Z)(this,"totalDistance",0),(0,p.Z)(this,"currentIndex",0),this.join=e.join||"miter",this.cap=e.cap||"butt",this.miterLimit=e.miterLimit||10,this.thickness=e.thickness||1,this.dash=e.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,a.Z)(t,[{key:"extrude_gaode2",value:function(t,e){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,i=n.startIndex,o=1;o<r;o++){var a,s,u,l=t[o-1];l.push(null!==(a=e[o-1][2])&&void 0!==a?a:0);var c=e[o-1],p=t[o];p.push(null!==(s=e[o][2])&&void 0!==s?s:0);var h=e[o],f=o<t.length-1?[].concat((0,at.Z)(t[o+1]),[null!==(u=e[o+1][2])&&void 0!==u?u:0]):null,d=o<e.length-1?e[o+1]:null;i+=this.segment_gaode2(n,i,l,p,f,c,h,d)}if(this.dash)for(var v=0;v<n.positions.length/6;v++)n.positions[6*v+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude_gaode2",value:function(t,e){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,i=n.startIndex,o=1;o<r;o++){var a,s,u,l=t[o-1];l.push(null!==(a=e[o-1][2])&&void 0!==a?a:0);var c=e[o-1],p=t[o];p.push(null!==(s=e[o][2])&&void 0!==s?s:0);var h=e[o],f=o<t.length-1?[].concat((0,at.Z)(t[o+1]),[null!==(u=e[o+1][2])&&void 0!==u?u:0]):null,d=o<e.length-1?e[o+1]:null;i+=this.simpleSegment(n,i,l,p,f,c,h,d)}if(this.dash)for(var v=0;v<n.positions.length/6;v++)n.positions[6*v+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"extrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,r=e.startIndex,i=1;i<n;i++){var o=t[i-1],a=t[i],s=i<t.length-1?t[i+1]:null;r+=this.segment(e,r,o,a,s)}if(this.dash)for(var u=0;u<e.positions.length/6;u++)e.positions[6*u+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"simpleExtrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,r=e.startIndex,i=1;i<n;i++){var o=t[i-1],a=t[i],s=i<t.length-1?t[i+1]:null;r+=this.simpleSegment(e,r,o,a,s)}if(this.dash)for(var u=0;u<e.positions.length/6;u++)e.positions[6*u+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"segment_gaode2",value:function(t,e,n,r,i,o,a,s){var u=0,l=t.indices,c=t.positions,p=t.normals,h="square"===this.cap,f="bevel"===this.join,d=(0,T.aProjectFlat)([a[0],a[1]]),v=(0,T.aProjectFlat)([o[0],o[1]]);Dt(Pt,r,n);var m=0;if(this.dash&&(m=this.lineSegmentDistance(d,v),this.totalDistance+=m),this.normal||(this.normal=Mt.Ue(),Rt(this.normal,Pt)),!this.started)if(this.started=!0,h){var y=Mt.Ue(),g=Mt.Ue();Mt.IH(y,this.normal,Pt),Mt.IH(g,this.normal,Pt),p.push(g[0],g[1],0),p.push(y[0],y[1],0),c.push(n[0],n[1],0|n[2],this.totalDistance-m,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),c.push(n[0],n[1],0|n[2],this.totalDistance-m,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(c,p,n,this.normal,this.thickness,this.totalDistance-m);if(l.push(e+0,e+1,e+2),i){Nt(r,i)&&Mt.IH(i,r,Mt.Fv(i,Mt.$X(i,r,n))),Dt(Ot,i,r);var _=It(Lt,Mt.Ue(),Pt,Ot,this.thickness),x=(0,B.Z)(_,2),b=x[0],w=x[1],S=Mt.AK(Lt,this.normal)<0?-1:1,E=f;if(!E&&"miter"===this.join)b>this.miterLimit&&(E=!0);E?(p.push(this.normal[0],this.normal[1],0),p.push(w[0],w[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*S,0|r[2]),this.complex.indexes.push(this.currentIndex),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*S,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l.push.apply(l,(0,at.Z)(this.lastFlip!==-S?[e,e+2,e+3]:[e+2,e+1,e+3])),l.push(e+2,e+3,e+4),Rt(kt,Ot),Mt.JG(this.normal,kt),p.push(this.normal[0],this.normal[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*S,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,u+=3):(this.extrusions(c,p,r,w,b,this.totalDistance),l.push.apply(l,(0,at.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),S=-1,Mt.JG(this.normal,w),u+=2),this.lastFlip=S}else{if(Rt(this.normal,Pt),h){var C=Mt.Ue(),A=Mt.Ue();Mt.lu(A,Pt,this.normal),Mt.IH(C,Pt,this.normal),p.push(A[0],A[1],0),p.push(C[0],C[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(c,p,r,this.normal,this.thickness,this.totalDistance);l.push.apply(l,(0,at.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),u+=2}return u}},{key:"simpleSegment",value:function(t,e,n,r,i){var o=0,a=t.indices,s=t.positions,u=t.normals,l=(0,T.aProjectFlat)([r[0],r[1]]),c=(0,T.aProjectFlat)([n[0],n[1]]);Dt(Pt,l,c);var p=0;if(this.dash&&(p=this.lineSegmentDistance(l,c),this.totalDistance+=p),this.normal||(this.normal=Mt.Ue(),Rt(this.normal,Pt)),this.started||(this.started=!0,this.extrusions(s,u,n,this.normal,this.thickness,this.totalDistance-p)),a.push(e+0,e+1,e+2),i){var h=(0,T.aProjectFlat)([i[0],i[1]]);Nt(l,h)&&Mt.IH(h,l,Mt.Fv(h,Mt.$X(h,l,c))),Dt(Ot,h,l);var f=It(Lt,Mt.Ue(),Pt,Ot,this.thickness),d=(0,B.Z)(f,2),v=d[0],m=d[1];Mt.AK(Lt,this.normal);this.extrusions(s,u,r,m,v,this.totalDistance),a.push.apply(a,(0,at.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),-1,Mt.JG(this.normal,m),o+=2,this.lastFlip=-1}else Rt(this.normal,Pt),this.extrusions(s,u,r,this.normal,this.thickness,this.totalDistance),a.push.apply(a,(0,at.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),o+=2;return o}},{key:"segment",value:function(t,e,n,r,i){var o=0,a=t.indices,s=t.positions,u=t.normals,l="square"===this.cap,c="bevel"===this.join,p=(0,T.aProjectFlat)([r[0],r[1]]),h=(0,T.aProjectFlat)([n[0],n[1]]);Dt(Pt,p,h);var f=0;if(this.dash&&(f=this.lineSegmentDistance(p,h),this.totalDistance+=f),this.normal||(this.normal=Mt.Ue(),Rt(this.normal,Pt)),!this.started)if(this.started=!0,l){var d=Mt.Ue(),v=Mt.Ue();Mt.IH(d,this.normal,Pt),Mt.IH(v,this.normal,Pt),u.push(v[0],v[1],0),u.push(d[0],d[1],0),s.push(n[0],n[1],0|n[2],this.totalDistance-f,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),s.push(n[0],n[1],0|n[2],this.totalDistance-f,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(s,u,n,this.normal,this.thickness,this.totalDistance-f);if(a.push(e+0,e+1,e+2),i){var m=(0,T.aProjectFlat)([i[0],i[1]]);Nt(p,m)&&Mt.IH(m,p,Mt.Fv(m,Mt.$X(m,p,h))),Dt(Ot,m,p);var y=It(Lt,Mt.Ue(),Pt,Ot,this.thickness),g=(0,B.Z)(y,2),_=g[0],x=g[1],b=Mt.AK(Lt,this.normal)<0?-1:1,w=c;if(!w&&"miter"===this.join)_>this.miterLimit&&(w=!0);w?(u.push(this.normal[0],this.normal[1],0),u.push(x[0],x[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*b,0|r[2]),this.complex.indexes.push(this.currentIndex),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*b,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,a.push.apply(a,(0,at.Z)(this.lastFlip!==-b?[e,e+2,e+3]:[e+2,e+1,e+3])),a.push(e+2,e+3,e+4),Rt(kt,Ot),Mt.JG(this.normal,kt),u.push(this.normal[0],this.normal[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*b,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,o+=3):(this.extrusions(s,u,r,x,_,this.totalDistance),a.push.apply(a,(0,at.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),b=-1,Mt.JG(this.normal,x),o+=2),this.lastFlip=b}else{if(Rt(this.normal,Pt),l){var S=Mt.Ue(),E=Mt.Ue();Mt.lu(E,Pt,this.normal),Mt.IH(S,Pt,this.normal),u.push(E[0],E[1],0),u.push(S[0],S[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(s,u,r,this.normal,this.thickness,this.totalDistance);a.push.apply(a,(0,at.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),o+=2}return o}},{key:"extrusions",value:function(t,e,n,r,i,o){e.push(r[0],r[1],0),e.push(r[0],r[1],0),t.push(n[0],n[1],0|n[2],o,-i,0|n[2]),this.complex.indexes.push(this.currentIndex),t.push(n[0],n[1],0|n[2],o,i,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(n*n+r*r)}}]),t}();function jt(t){if(L()(t[0]))return t;if(L()(t[0][0]))throw new Error("当前数据不支持标注");if(L()(t[0][0][0])){var e=0,n=0,r=0;return t.forEach((function(t){t.forEach((function(t){e+=t[0],n+=t[1],r++}))})),[e/r,n/r,0]}throw new Error("当前数据不支持标注")}function Ut(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t[0][0],r=t[0][t[0].length-1];n[0]===r[0]&&n[1]===r[1]&&(t[0]=t[0].slice(0,t[0].length-1));for(var i=t[0].length,o=bt().flatten(t),a=o.vertices,s=o.dimensions,u=[],l=[],c=[],p=0;p<a.length/s;p++)2===s?u.push(a[2*p],a[2*p+1],1,-1,-1):u.push(a[3*p],a[3*p+1],1,-1,-1),c.push(0,0,1);var h=bt()(o.vertices,o.holes,o.dimensions);l.push.apply(l,(0,at.Z)(h));for(var f=function(t){var n=o.vertices.slice(t*s,(t+1)*s),r=o.vertices.slice((t+1)*s,(t+2)*s);0===r.length&&(r=o.vertices.slice(0,s));var i=u.length/5;u.push(n[0],n[1],1,0,0,r[0],r[1],1,.1,0,n[0],n[1],0,0,.8,r[0],r[1],0,.1,.8);var a=Vt([r[0],r[1],1],[n[0],n[1],0],[n[0],n[1],1],e);c.push.apply(c,(0,at.Z)(a).concat((0,at.Z)(a),(0,at.Z)(a),(0,at.Z)(a))),l.push.apply(l,(0,at.Z)([1,2,0,3,2,1].map((function(t){return t+i}))))},d=0;d<i;d++)f(d);return{positions:u,index:l,normals:c}}function Vt(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=St.create(),o=St.create(),a=St.create();r&&(t=(0,T.lngLatToMeters)(t),e=(0,T.lngLatToMeters)(e),n=(0,T.lngLatToMeters)(n));var s=St.fromValues.apply(St,(0,at.Z)(t)),u=St.fromValues.apply(St,(0,at.Z)(e)),l=St.fromValues.apply(St,(0,at.Z)(n));St.sub(i,l,u),St.sub(o,s,u),St.cross(a,i,o);var c=St.create();return St.normalize(c,a),c}function Gt(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=2*Math.PI/t,r=[],i=0;i<t;i++)r.push(n*i+e*Math.PI/12);var o=r.map((function(t){return[Math.sin(t+Math.PI/4),Math.cos(t+Math.PI/4),0]}));return o}function Ht(){return Gt(30)}function Wt(){return Gt(4)}function qt(){return Gt(3)}function Xt(){return Gt(6,1)}function Yt(){return Gt(5)}!function(t){t.CYLINDER="cylinder",t.SQUARECOLUMN="squareColumn",t.TRIANGLECOLUMN="triangleColumn",t.HEXAGONCOLUMN="hexagonColumn",t.PENTAGONCOLUMN="pentagonColumn"}(zt||(zt={})),function(t){t.CIRCLE="circle",t.SQUARE="square",t.TRIANGLE="triangle",t.HEXAGON="hexagon",t.PENTAGON="pentagon"}(Ft||(Ft={}));var Kt=(Zt={},(0,p.Z)(Zt,Ft.CIRCLE,Ht),(0,p.Z)(Zt,Ft.HEXAGON,Xt),(0,p.Z)(Zt,Ft.TRIANGLE,qt),(0,p.Z)(Zt,Ft.SQUARE,Wt),(0,p.Z)(Zt,Ft.PENTAGON,Yt),(0,p.Z)(Zt,zt.CYLINDER,Ht),(0,p.Z)(Zt,zt.HEXAGONCOLUMN,Xt),(0,p.Z)(Zt,zt.TRIANGLECOLUMN,qt),(0,p.Z)(Zt,zt.SQUARECOLUMN,Wt),(0,p.Z)(Zt,zt.PENTAGONCOLUMN,Yt),Zt),Qt={};function Jt(t){var e=jt(t.coordinates);return{vertices:[].concat((0,at.Z)(e),(0,at.Z)(e),(0,at.Z)(e),(0,at.Z)(e)),indices:[0,1,2,2,3,0],size:e.length}}function $t(t){var e=Tt(jt(t.coordinates));return{vertices:[].concat((0,at.Z)(e),(0,at.Z)(e),(0,at.Z)(e),(0,at.Z)(e)),indices:[0,1,2,2,3,0],size:e.length}}function te(t){var e=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Qt&&Qt[t])return Qt[t];var n=Ut([Kt[t]?Kt[t]():Kt.cylinder()],e);return Qt[t]=n,n}(t.shape,!1);return{vertices:e.positions,indices:e.index,normals:e.normals,size:5}}function ee(t){var e=jt(t.coordinates);return{vertices:(0,at.Z)(e),indices:[0],size:e.length}}function ne(t){var e=t.coordinates,n=t.originCoordinates,r=t.version,i=new Bt({dash:!0,join:"bevel"});if("GAODE2.x"===r){var o=e;Array.isArray(o[0][0])||(o=[e]);var a=n;Array.isArray(a[0][0])||(a=[n]);for(var s=0;s<o.length;s++){var u=o[s],l=a[s];i.extrude_gaode2(u,l)}}else{var c=e;c[0]&&!Array.isArray(c[0][0])&&(c=[e]),c.forEach((function(t){i.extrude(t)}))}var p=i.complex;return{vertices:p.positions,indices:p.indices,normals:p.normals,indexes:p.indexes,size:6}}function re(t){var e=t.coordinates,n=t.originCoordinates,r=t.version,i=new Bt({dash:!0,join:"bevel"});if("GAODE2.x"===r){var o=e;Array.isArray(o[0][0])||(o=[e]);var a=n;Array.isArray(a[0][0])||(a=[n]);for(var s=0;s<o.length;s++){var u=o[s],l=a[s];i.simpleExtrude_gaode2(u,l)}}else{var c=e;c[0]&&!Array.isArray(c[0][0])&&(c=[e]),c.forEach((function(t){i.simpleExtrude(t)}))}var p=i.complex;return{vertices:p.positions,indices:p.indices,normals:p.normals,size:6}}function ie(t){var e=t.coordinates,n=bt().flatten(e),r=n.vertices,i=n.dimensions,o=n.holes;return{indices:bt()(r,o,i),vertices:r,size:i}}function oe(t){var e=t.coordinates,n=bt().flatten(e),r=n.vertices,i=n.dimensions,o=n.holes;return{indices:bt()(r,o,i),vertices:ae(r),size:i+4}}function ae(t){for(var e=[],n=function(t){for(var e=t[0],n=t[1],r=t[0],i=t[1],o=0,a=0,s=0,u=0;u<t.length;u+=2){var l=t[u],c=t[u+1];l&&c&&(e=Math.max(l,e),n=Math.max(c,n),r=Math.min(l,r),i=Math.min(c,i),o+=l,a+=c,s++)}return{center:[o/s,a/s],radius:Math.sqrt(Math.pow(e-r,2)+Math.pow(n-i,2))/2}}(t),r=n.center,i=n.radius,o=0;o<t.length;o+=2){var a=t[o],s=t[o+1];e.push.apply(e,[a,s,0].concat((0,at.Z)(r),[i]))}return e}function se(t){var e=Ut(t.coordinates,!0);return{vertices:e.positions,indices:e.index,normals:e.normals,size:5}}function ue(t){var e=function(t){var e=["cylinder","triangleColumn","hexagonColumn","squareColumn"],n=Kt[t]?Kt[t]():Kt.circle();return-1===e.indexOf(t)?(r=[n],i=bt().flatten(r),o=bt()(i.vertices,i.holes,i.dimensions),{positions:i.vertices,index:o}):function(t){var e=t[0][0],n=t[0][t[0].length-1];e[0]===n[0]&&e[1]===n[1]&&(t[0]=t[0].slice(0,t[0].length-1));for(var r=t[0].length,i=bt().flatten(t),o=i.vertices,a=i.dimensions,s=[],u=[],l=0;l<o.length/a;l++)2===a?s.push(o[2*l],o[2*l+1],1):s.push(o[3*l],o[3*l+1],1);var c=bt()(i.vertices,i.holes,i.dimensions);u.push.apply(u,(0,at.Z)(c));for(var p=function(t){var e=i.vertices.slice(t*a,(t+1)*a),n=i.vertices.slice((t+1)*a,(t+2)*a);0===n.length&&(n=i.vertices.slice(0,a));var r=s.length/3;s.push(e[0],e[1],1,n[0],n[1],1,e[0],e[1],0,n[0],n[1],0),u.push.apply(u,(0,at.Z)([0,2,1,2,3,1].map((function(t){return t+r}))))},h=0;h<r;h++)p(h);return{positions:s,index:u}}([n]);var r,i,o}(t.shape);return{vertices:e.positions,indices:e.index,size:3}}function le(t){var e=t.coordinates;return{vertices:[].concat((0,at.Z)(e[0]),[0,0,1,e[1][0],e[0][1],0,1,1],(0,at.Z)(e[1]),[0,1,0],(0,at.Z)(e[0]),[0,0,1],(0,at.Z)(e[1]),[0,1,0,e[0][0],e[1][1],0,0,0]),indices:[0,1,2,3,4,5],size:5}}function ce(t,e){for(var n=e||30,r=t.coordinates,i=[],o=[],a=function(t){i.push(t,1,t,r[0][0],r[0][1],r[1][0],r[1][1],t,-1,t,r[0][0],r[0][1],r[1][0],r[1][1]),t!==n-1&&o.push.apply(o,(0,at.Z)([0,1,2,1,3,2].map((function(e){return 2*t+e}))))},s=0;s<n;s++)a(s);return{vertices:i,indices:o,size:7}}function pe(t){var e=t.coordinates;2===e.length&&e.push(0);t.size;var n=he(-1,1),r=he(1,1),i=he(-1,-1),o=he(1,-1);return{vertices:[].concat((0,at.Z)(e),(0,at.Z)(n),(0,at.Z)(e),(0,at.Z)(i),(0,at.Z)(e),(0,at.Z)(o),(0,at.Z)(e),(0,at.Z)(r)),indices:[0,1,2,3,0,2],size:5}}function he(t,e){return[(t+1)/2,(e+1)/2]}function fe(){var t=At(Et,{segments:36});return{vertices:t.positionsArr,indices:t.indicesArr,size:5,normals:t.normalArr}}function de(){var t=At(140,{segments:36});return{vertices:t.positionsArr,indices:t.indicesArr,size:5,normals:t.normalArr}}function ve(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var me=function(t){(0,u.Z)(n,t);var e=ve(n);function n(){var t;(0,o.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i)),(0,p.Z)((0,s.Z)(t),"cityCenter",void 0),(0,p.Z)((0,s.Z)(t),"cityMinSize",void 0),t}return(0,a.Z)(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.baseColor,i=void 0===r?"rgb(16,16,16)":r,o=t.brightColor,a=void 0===o?"rgb(255,176,38)":o,s=t.windowColor,u=void 0===s?"rgb(30,60,89)":s,l=t.time,c=void 0===l?0:l,p=t.sweep,h=void 0===p?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:p;return{u_cityCenter:h.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*h.sweepRadius,u_circleSweep:h.enable?1:0,u_circleSweepColor:(0,T.rgb2arr)(h.sweepColor).slice(0,3),u_circleSweepSpeed:h.sweepSpeed,u_opacity:n,u_baseColor:(0,T.rgb2arr)(i),u_brightColor:(0,T.rgb2arr)(a),u_windowColor:(0,T.rgb2arr)(u),u_time:this.layer.getLayerAnimateTime()||c}}},{key:"calCityGeo",value:function(){var t=(0,B.Z)(this.layer.getSource().extent,4),e=t[0],n=t[1],r=t[2],i=t[3];if("GAODE2.x"===this.mapService.version){this.cityCenter=this.mapService.lngLatToCoord([(r+e)/2,(i+n)/2]);var o=this.mapService.lngLatToCoord([r,i]),a=this.mapService.lngLatToCoord([e,n]);this.cityMinSize=Math.sqrt(Math.pow(o[0]-a[0],2)+Math.pow(o[1]-a[1],2))/4}else{var s=r-e,u=i-n;this.cityCenter=[(r+e)/2,(i+n)/2],this.cityMinSize=Math.sqrt(Math.pow(s,2)+Math.pow(u,2))/4}}},{key:"initModels",value:function(){return this.calCityGeo(),this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:'precision highp float;\n\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\n\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n\nvarying vec4 v_Color;\nuniform mat4 u_Mvp;\n\nuniform float u_circleSweep;\nuniform vec2 u_cityCenter;\n\nvarying float v_worldDis;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\n\nvoid main() {\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  vec4 project_pos = project_position(pos);\n\n   v_texCoord = a_Uv;\n\n  if(u_circleSweep > 0.0) {\n     vec2 lnglatscale = vec2(0.0);\n    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {\n      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);\n    }\n    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);\n  }\n \n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  float lightWeight = calc_lighting(pos);\n  // v_Color = a_Color;\n  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'uniform float u_opacity: 1.0;\nuniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];\nuniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];\nuniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];\nuniform float u_near : 0;\nuniform float u_far : 1;\nvarying vec4 v_Color;\nvarying vec2 v_texCoord;\nuniform float u_Zoom : 1;\nuniform float u_time;\n\nuniform float u_circleSweep;\nuniform float u_cityMinSize;\nuniform vec3 u_circleSweepColor;\nuniform float u_circleSweepSpeed;\n\nvarying float v_worldDis;\n\n#pragma include "picking"\n\nvec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {\n    float s = step(hot, n);\n    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);\n\n    return mix(darkColor, color, s);\n}\nfloat random (vec2 st) {\n    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);\n}\n\nfloat LinearizeDepth()\n{\n    float z = gl_FragCoord.z * 2.0 - 1.0;\n    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));\n}\n\nvec3 fog(vec3 color, vec3 fogColor, float depth){\n    float fogFactor=clamp(depth,0.0,1.0);\n    vec3 output_color=mix(fogColor,color,fogFactor);\n    return output_color;\n}\n\nfloat sdRect(vec2 p, vec2 sz) {\n  vec2 d = abs(p) - sz;\n  float outside = length(max(d, 0.));\n  float inside = min(max(d.x, d.y), 0.);\n  return outside + inside;\n}\n\nvoid main() {\n  gl_FragColor = v_Color;\n  vec3 baseColor = u_baseColor.xyz;\n  vec3 brightColor = u_brightColor.xyz;\n  vec3 windowColor = u_windowColor.xyz;\n  float targetColId = 5.;\n  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;\n  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);\n  if(v_texCoord.x < 0.) { //顶部颜色\n       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);\n       gl_FragColor = vec4( foggedColor, v_Color.w);\n  }else { // 侧面颜色\n        vec2 st = v_texCoord;\n        vec2  UvScale = v_texCoord;\n        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));\n        float tStart = 0.25 * tStep;\n        float tEnd = 0.75 * tStep;\n        float u = mod(UvScale.x, tStep);\n        float v = mod(UvScale.y, tStep);\n        float ux = floor(UvScale.x/tStep);\n        float uy = floor(UvScale.y/tStep);\n        float n = random(vec2(ux,uy));\n        float lightP = u_time;\n        float head = 1.0- step(0.005,st.y);\n        /*step3*/\n        // 将窗户颜色和墙面颜色区别开来\n        float sU = step(tStart, u) - step(tEnd, u);\n        float sV = step(tStart, v) - step(tEnd, v);\n        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));\n        float dist = sdRect(vec2(u,v), windowSize);\n        float s = sU * sV;\n\n        float curColId = floor(UvScale.x / tStep);\n        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);\n\n        float mLightP = mod(lightP, 2.);\n        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);\n        if(ux == targetColId){\n            n =0.;\n        }\n        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );\n        float hot = smoothstep(1.0,0.0,timeP);\n        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);\n        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);\n        float sFinal = s * sCol * sRow;\n        color += mix(baseColor, brightColor, sFinal*n);\n        if (st.y<0.01){\n        color = baseColor;\n         }\n        if(head ==1.0) { // 顶部亮线\n            color = brightColor;\n        }\n        color = color * v_Color.rgb;\n\n        vec3 foggedColor = fog(color,fogColor,depth);\n\n        gl_FragColor = vec4(foggedColor,1.0);\n  }\n\n\n  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {\n    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);\n    gl_FragColor.rgb += r * r * u_circleSweepColor;\n  }\n   \n  gl_FragColor.a *= u_opacity;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:se,cull:{enable:!0,face:i.gl.BACK}})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:i.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e,n,r){var i=t.size,o=void 0===i?10:i;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,n,r){t.size;return[n[3],n[4]]}}})}}]),n}(dt);function ye(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var ge=function(t){(0,u.Z)(n,t);var e=ye(n);function n(){var t;(0,o.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i)),(0,p.Z)((0,s.Z)(t),"type","PolygonLayer"),t}return(0,a.Z)(n,[{key:"buildModels",value:function(){this.layerModel=new me(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(t){this.updateLayerConfig({time:t})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),n}(ot);function _e(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var xe=function(t){(0,u.Z)(n,t);var e=_e(n);function n(){var t;(0,o.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i)),(0,p.Z)((0,s.Z)(t),"texture",void 0),(0,p.Z)((0,s.Z)(t),"radian",0),(0,p.Z)((0,s.Z)(t),"planeGeometryTriangulation",(function(){var e=t.layer.getLayerConfig().center,n=void 0===e?[120,30]:e;return{size:4,indices:[0,1,2,2,3,0],vertices:[].concat((0,at.Z)(n),[1,1],(0,at.Z)(n),[0,1],(0,at.Z)(n),[0,0],(0,at.Z)(n),[1,0])}})),t}return(0,a.Z)(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=t.width,r=void 0===n?1:n,i=t.height,o=void 0===i?1:i,a=t.raisingHeight,s=void 0===a?0:a,u=1;return"GAODE2.x"!==this.mapService.version&&"GAODE1.x"!==this.mapService.version||(u=-1),this.radian=u*Math.PI*(this.mapService.getRotation()%360)/180,{u_raisingHeight:Number(s),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_opacity:e||1,u_texture:this.texture,u_size:[r,o]}}},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy()}},{key:"initModels",value:function(){var t=this.layer.getLayerConfig(),e=t.mask,n=void 0!==e&&e,r=t.maskInside,o=void 0===r||r,a=t.drawCanvas,s=this.rendererService.createTexture2D;return this.texture=s({height:0,width:0}),a&&this.updateTexture(a),[this.layer.buildLayerModel({moduleName:"geometry_billboard",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform float u_raisingHeight: 0.0;\nuniform mat4 u_Mvp;\nuniform float u_opacity;\nuniform vec2 u_size: [1.0, 1.0];\nuniform mat2 u_RotateMatrix;\n\nattribute vec3 a_Extrude;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nattribute vec3 a_Color;\n\nvarying vec3 v_Color;\nvarying vec2 v_uv;\n\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\n   vec3 extrude = a_Extrude;\n   v_Color = a_Color;\n   v_uv = a_Uv;\n\n   float raiseHeight = u_raisingHeight;\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      raiseHeight = u_raisingHeight * mapboxZoomScale;\n   }\n\n   // 计算经纬度点位坐标\n   vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\n\n   // 计算绕 z 轴旋转后的偏移\n   vec2 offsetXY = project_pixel(u_RotateMatrix * vec2(extrude.x * u_size.x, 0.0));\n   // 绕 z 轴旋转\n   float x = project_pos.x + offsetXY.x;\n   float y = project_pos.y + offsetXY.y;\n   // z 轴不参与旋转\n   float z = project_pixel(extrude.y * u_size.y + raiseHeight);\n\n\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      // gl_Position = u_Mvp * (vec4(project_pos.xy, a_Position.z, 1.0));\n      gl_Position = u_Mvp * (vec4(x, y, z, 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(x , y, z , 1.0));\n   }\n\n   setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nuniform sampler2D u_texture;\nuniform float u_opacity;\n\nvarying vec3 v_Color;\nvarying vec2 v_uv;\n\n#pragma include "picking"\nvoid main() {\n  gl_FragColor = texture2D(u_texture, vec2(v_uv.x, 1.0 - v_uv.y));\n  gl_FragColor.a *= u_opacity;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:this.planeGeometryTriangulation,primitive:i.gl.TRIANGLES,depth:{enable:!0},blend:this.getBlend(),stencil:(0,T.getMask)(n,o)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"updateTexture",value:function(t){var e=this.rendererService.createTexture2D,n=this.layer.getLayerConfig(),r=n.canvasWidth,o=void 0===r?1:r,a=n.canvasHeight,s=void 0===a?1:a,u=document.createElement("canvas");u.width=o,u.height=s,u.getContext("2d")&&(t(u),this.texture=e({data:u,width:u.width,height:u.height,wrapS:i.gl.CLAMP_TO_EDGE,wrapT:i.gl.CLAMP_TO_EDGE}),this.layerService.updateLayerRenderList(),this.layerService.renderLayers())}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:i.AttributeType.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,n,r){return[n[2],n[3]]}}})}}]),n}(dt);function be(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var we=function(t){(0,u.Z)(n,t);var e=be(n);function n(){var t;(0,o.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i)),(0,p.Z)((0,s.Z)(t),"texture",void 0),(0,p.Z)((0,s.Z)(t),"terrainImage",void 0),(0,p.Z)((0,s.Z)(t),"terrainImageLoaded",!1),(0,p.Z)((0,s.Z)(t),"mapTexture",void 0),(0,p.Z)((0,s.Z)(t),"planeGeometryTriangulation",(function(){var e,n=t.layer.getLayerConfig(),r=n.width,i=void 0===r?1:r,o=n.height,a=void 0===o?1:o,s=n.widthSegments,u=void 0===s?1:s,l=n.heightSegments,c=void 0===l?1:l,p=n.center,h=void 0===p?[120,30]:p,f=n.terrainTexture,d=(e=t).initPlane.apply(e,[i,a,u,c].concat((0,at.Z)(h))),v=d.indices,m=d.positions;return f&&t.loadTerrainTexture(m,v),{vertices:m,indices:v,size:5}})),t}return(0,a.Z)(n,[{key:"initPlane",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:120,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:30,a=t/2,s=e/2,u=Math.floor(n),l=Math.floor(r),c=u+1,p=l+1,h=t/u,f=e/l,d=[],v=[],m=0;m<p;m++)for(var y=m*f-s,g=0;g<c;g++){var _=g*h-a;if(this.mapService.version===Z.G["GAODE2.x"]){var x=this.mapService.lngLatToCoord([_+i,-y+o]),b=(0,B.Z)(x,2),w=b[0],S=b[1];v.push(w,S,0)}else v.push(_+i,-y+o,0);v.push(g/u),v.push(1-m/l)}for(var E=0;E<l;E++)for(var C=0;C<u;C++){var T=C+c*E,A=C+c*(E+1),M=C+1+c*(E+1),k=C+1+c*E;d.push(T,A,k),d.push(A,M,k)}return{indices:d,positions:v}}},{key:"getUninforms",value:function(){var t,e=this.layer.getLayerConfig(),n=e.opacity,r=e.mapTexture,i=e.terrainClipHeight,o=void 0===i?0:i,a=e.terrainTexture;this.mapTexture!==r&&(this.mapTexture=r,null===(t=this.texture)||void 0===t||t.destroy(),this.updateTexture(r));return{u_opacity:n||1,u_mapFlag:r?1:0,u_terrainClipHeight:a?o:-1,u_texture:this.texture}}},{key:"clearModels",value:function(){var t;this.terrainImage=null,null===(t=this.texture)||void 0===t||t.destroy()}},{key:"initModels",value:function(){var t=this.layer.getLayerConfig(),e=t.mask,n=void 0!==e&&e,r=t.maskInside,o=void 0===r||r,a=t.mapTexture;this.mapTexture=a;var s=this.rendererService.createTexture2D;return this.texture=s({height:0,width:0}),this.updateTexture(a),[this.layer.buildLayerModel({moduleName:"geometry_plane",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\n\nuniform mat4 u_Mvp;\nuniform float u_opacity;\nuniform float u_terrainClipHeight;\n\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nattribute vec3 a_Color;\n\nvarying vec3 v_Color;\nvarying vec2 v_uv;\nvarying float v_clip;\n\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\n   v_Color = a_Color;\n   v_uv = a_Uv;\n  \n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n   v_clip = 1.0;\n   if(a_Position.z < u_terrainClipHeight) {\n      v_clip = 0.0;\n   }\n  \n   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n\n   // float x = 1.0;\n   // float y = 0.0;\n   // float z = 0.0;\n   // mat3 translateMatrix = mat3(\n   //    1.0, 0.0, 0.0 \n   //    0.0, 1.0, 0.0\n   //    -project_pos.x,    -project_pos.y,  1.0\n   // );\n   //  mat4 translateMatrix = mat4(\n   //    1.0, 0.0, 0.0, 0.0 ,\n   //    0.0, 1.0, 0.0, 0.0,\n   //    0.0, 0.0, 1.0, 0.0,\n   //    1.0, 0.0, 0.0, 1.0\n   // );\n\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy, a_Position.z, 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, a_Position.z, 1.0));\n   }\n\n   setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nuniform sampler2D u_texture;\nuniform float u_mapFlag;\nuniform float u_opacity;\n\nvarying vec3 v_Color;\nvarying vec2 v_uv;\nvarying float v_clip;\n\n#pragma include "picking"\nvoid main() {\n  // gl_FragColor = vec4(v_Color, u_opacity);\n  if(u_mapFlag > 0.0) {\n    gl_FragColor = texture2D(u_texture, vec2(v_uv.x, 1.0 - v_uv.y));\n    gl_FragColor.a *= u_opacity;\n  } else {\n    // gl_FragColor = vec4(v_uv, 0.0, u_opacity);\n    gl_FragColor = vec4(v_Color, u_opacity);\n  }\n  gl_FragColor.a *= v_clip;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:this.planeGeometryTriangulation,primitive:i.gl.TRIANGLES,depth:{enable:!0},blend:this.getBlend(),stencil:(0,T.getMask)(n,o),cull:{enable:!0,face:i.gl.BACK}})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"createModelData",value:function(t){if(t){var e=this.layer.getLayerConfig(),n=e.widthSegments,r=e.heightSegments,i=e.width,o=e.height,a=t,s=a.widthSegments,u=a.heightSegments,l=a.width,c=a.height;this.layer.style({widthSegments:void 0!==s?s:n,heightSegments:void 0!==u?u:r,width:void 0!==l?l:i,height:void 0!==c?c:o})}var p=this.layer.getEncodedData();return this.styleAttributeService.createAttributesAndIndices(p,this.planeGeometryTriangulation)}},{key:"updateTexture",value:function(t){var e=this,n=this.rendererService.createTexture2D;if(t){var r=new Image;r.crossOrigin="anonymous",r.onload=function(){e.texture=n({data:r,width:r.width,height:r.height,wrapS:i.gl.CLAMP_TO_EDGE,wrapT:i.gl.CLAMP_TO_EDGE}),e.layerService.updateLayerRenderList(),e.layerService.renderLayers()},r.src=t}else this.texture=n({width:0,height:0})}},{key:"getImageData",value:function(t){var e=document.createElement("canvas"),n=e.getContext("2d"),r=t.width,i=t.height;return e.width=r,e.height=i,n.drawImage(t,0,0,r,i),n.getImageData(0,0,r,i)}},{key:"translateVertex",value:function(t,e,n,r,i,o){for(var a=n.width,s=n.height,u=this.getImageData(n).data,l=Math.floor(r),c=Math.floor(i),p=l+1,h=c+1,f=a/l,d=s/c,v=0;v<h;v++)for(var m=Math.floor(v*d)*a,y=0;y<p;y++){var g=4*(m+Math.floor(y*f)),_=u[g],x=u[g+1],b=u[g+2];t[5*(v*p+y)+2]=o(_,x,b)}var w=this.layer.getEncodedData(),S=this.styleAttributeService.createAttributesAndIndices(w,(function(){return{vertices:t,indices:e,size:5}}));this.layer.updateModelData(S),this.layerService.renderLayers()}},{key:"loadTerrainTexture",value:function(t,e){var n=this,r=this.layer.getLayerConfig(),i=r.widthSegments,o=void 0===i?1:i,a=r.heightSegments,s=void 0===a?1:a,u=r.terrainTexture,l=r.rgb2height,c=void 0===l?function(t,e,n){return t+e+n}:l;if(this.terrainImage)this.terrainImageLoaded?this.translateVertex(t,e,this.terrainImage,o,s,c):this.terrainImage.onload=function(){n.translateVertex(t,e,n.terrainImage,o,s,c)};else{var p=new Image;this.terrainImage=p,p.crossOrigin="anonymous",p.onload=function(){n.terrainImageLoaded=!0,setTimeout((function(){return n.layer.emit("terrainImageLoaded",null)})),n.translateVertex(t,e,p,o,s,c)},p.src=u}}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,n,r){return[n[3],n[4]]}}})}}]),n}(dt);function Se(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var Ee;!function(t){t.UP="up",t.DOWN="down"}(Ee||(Ee={}));var Ce=function(t){(0,u.Z)(n,t);var e=Se(n);function n(){var t;(0,o.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i)),(0,p.Z)((0,s.Z)(t),"texture",void 0),(0,p.Z)((0,s.Z)(t),"mapTexture",void 0),(0,p.Z)((0,s.Z)(t),"positions",void 0),(0,p.Z)((0,s.Z)(t),"indices",void 0),(0,p.Z)((0,s.Z)(t),"timer",void 0),(0,p.Z)((0,s.Z)(t),"spriteTop",void 0),(0,p.Z)((0,s.Z)(t),"spriteUpdate",void 0),(0,p.Z)((0,s.Z)(t),"spriteAnimate",void 0),(0,p.Z)((0,s.Z)(t),"planeGeometryUpdateTriangulation",(function(){for(var e=t.spriteUpdate,n=-1e5,r=t.spriteTop,i=0;i<t.positions.length;i+=5)t.spriteAnimate===Ee.UP?(t.positions[i+2]+=e,t.positions[i+2]>r&&(t.positions[i+2]=n)):(t.positions[i+2]-=e,t.positions[i+2]<n&&(t.positions[i+2]=r));return{vertices:t.positions,indices:t.indices,size:5}})),(0,p.Z)((0,s.Z)(t),"updateModel",(function(){var e=t.layer.createAttrubutes({triangulation:t.planeGeometryUpdateTriangulation});t.layer.models.map((function(t){t.updateAttributes(e)})),t.layer.renderLayers(),t.timer=requestAnimationFrame(t.updateModel)})),(0,p.Z)((0,s.Z)(t),"planeGeometryTriangulation",(function(){var e,n=t.layer.getLayerConfig(),r=n.center,i=void 0===r?[120,30]:r,o=n.spriteCount,a=void 0===o?100:o,s=n.spriteRadius,u=void 0===s?10:s,l=(e=t).initSprite.apply(e,[u,a].concat((0,at.Z)(i))),c=l.indices,p=l.positions;return t.positions=p,t.indices=c,{vertices:p,indices:c,size:5}})),t}return(0,a.Z)(n,[{key:"initSprite",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:120,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30,i=[],o=[],a=this.mapService,s=this.spriteAnimate===Ee.UP?-this.spriteTop:this.spriteTop,u=0;u<e;u++){var l=Math.random()*s;o.push.apply(o,(0,at.Z)(p(l)))}for(var c=0;c<e;c++)i.push(c);function p(e){var i=t*Math.random(),o=t*Math.random(),s=-t/2+i,u=-t/2+o;if(a.version===Z.G["GAODE2.x"]){var l=a.lngLatToCoord([s+n,-u+r]),c=(0,B.Z)(l,2);return[c[0],c[1],e,0,0]}return[s+n,-u+r,e,0,0]}return{indices:i,positions:o}}},{key:"getUninforms",value:function(){var t,e=this.layer.getLayerConfig(),n=e.opacity,r=e.mapTexture,i=e.spriteScale,o=void 0===i?1:i;this.mapTexture!==r&&(this.mapTexture=r,null===(t=this.texture)||void 0===t||t.destroy(),this.updateTexture(r));return{u_opacity:n||1,u_mapFlag:r?1:0,u_texture:this.texture,u_Scale:o}}},{key:"clearModels",value:function(){var t;cancelAnimationFrame(this.timer),null===(t=this.texture)||void 0===t||t.destroy()}},{key:"initModels",value:function(){var t=this,e=this.layer.getLayerConfig(),n=e.mapTexture,r=e.spriteTop,o=void 0===r?5e6:r,a=e.spriteUpdate,s=void 0===a?1e4:a,u=e.spriteAnimate,l=void 0===u?Ee.DOWN:u;this.mapTexture=n,this.spriteTop=o,this.spriteUpdate=s,this.spriteAnimate="up"===l?Ee.UP:Ee.DOWN;var c=this.rendererService.createTexture2D;return this.texture=c({height:0,width:0}),this.updateTexture(n),setTimeout((function(){t.updateModel()}),100),[this.layer.buildLayerModel({moduleName:"geometry_sprite",vertexShader:'precision highp float;\n\nattribute vec3 a_Position;\nattribute vec3 a_Color;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_opacity;\nuniform float u_Scale;\nvarying vec3 v_Color;\nvarying float v_d;\n\n#pragma include "projection"\nvoid main() {\n   v_Color = a_Color;\n  \n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n   v_d = a_Position.z;\n\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy, a_Position.z, 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, a_Position.z, 1.0));\n   }\n\n   gl_PointSize = pow((u_Zoom - 1.0), 2.0) * u_Scale;\n}\n',fragmentShader:"\nuniform sampler2D u_texture;\nuniform float u_mapFlag;\nuniform float u_opacity;\n\nvarying vec3 v_Color;\nvarying float v_d;\n\nvoid main() {\n\n  if(v_d < 0.0) {\n    discard;\n  }\n\n  if(u_mapFlag > 0.0) {\n    gl_FragColor = texture2D(u_texture, gl_PointCoord);\n    gl_FragColor.a *= u_opacity;\n  } else {\n    gl_FragColor = vec4(v_Color, u_opacity);\n  }\n}\n",triangulation:this.planeGeometryTriangulation,primitive:i.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"updateTexture",value:function(t){var e=this,n=this.rendererService.createTexture2D;if(t){var r=new Image;r.crossOrigin="anonymous",r.onload=function(){e.texture=n({data:r,width:r.width,height:r.height,wrapS:i.gl.CLAMP_TO_EDGE,wrapT:i.gl.CLAMP_TO_EDGE}),e.layerService.updateLayerRenderList(),e.layerService.renderLayers()},r.src=t}else this.texture=n({width:0,height:0})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){return""}}]),n}(dt),Te={plane:we,sprite:Ce,billboard:xe};function Ae(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var Me=function(t){(0,u.Z)(n,t);var e=Ae(n);function n(){var t;(0,o.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i)),(0,p.Z)((0,s.Z)(t),"type","GeometryLayer"),t}return(0,a.Z)(n,[{key:"buildModels",value:function(){var t=this.getModelType();this.layerModel=new Te[t](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{plane:{},sprite:{},billboard:{}}[this.getModelType()]}},{key:"getModelType",value:function(){var t,e=this.styleAttributeService.getLayerStyleAttribute("shape"),n=null==e||null===(t=e.scale)||void 0===t?void 0:t.field;return"plane"===n?"plane":"sprite"===n?"sprite":"billboard"===n?"billboard":"plane"}}]),n}(ot);function ke(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var Pe=function(t){(0,u.Z)(n,t);var e=ke(n);function n(){return(0,o.Z)(this,n),e.apply(this,arguments)}return(0,a.Z)(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig();return{u_opacity:t.opacity||1,u_coverage:t.coverage||.9,u_angle:t.angle||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var t=this.layer.getLayerConfig(),e=t.mask,n=void 0!==e&&e,r=t.maskInside,o=void 0===r||r;return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:'precision highp float;\r\n// 多边形顶点坐标\r\nattribute vec3 a_Position;\r\n// 多边形经纬度坐标\r\nattribute vec3 a_Pos;\r\nattribute float a_Size;\r\nattribute vec4 a_Color;\r\nuniform vec2 u_radius;\r\nuniform float u_coverage: 0.9;\r\nuniform float u_angle: 0;\r\nuniform mat4 u_ModelMatrix;\r\nuniform mat4 u_Mvp;\r\nvarying vec4 v_color;\r\n\r\nuniform vec2 u_SceneCenterMKT;\r\n\r\n#pragma include "projection"\r\n#pragma include "project"\r\n#pragma include "picking"\r\n\r\nvoid main() {\r\n  v_color = a_Color;\r\n\r\n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r\n  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r\n  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r\n  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r\n  // gl_Position = project_common_position_to_clipspace(project_pos);\r\n\r\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r\n    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r\n    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // 将经纬度转换为高德2.0需要的平面坐标\r\n    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r\n    gl_Position = u_Mvp * (project_pos);\r\n  } else {\r\n     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r\n    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r\n    gl_Position = project_common_position_to_clipspace(project_pos);\r\n  }\r\n\r\n  setPickingColor(a_PickingColor);\r\n}\r\n',fragmentShader:'precision highp float;\nvarying vec4 v_color;\nuniform float u_opacity: 1;\n\n#pragma include "picking"\n\nvoid main() {\n  gl_FragColor = v_color;\n  gl_FragColor.a *= u_opacity;\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:ue,depth:{enable:!1},primitive:i.gl.TRIANGLES,blend:this.getBlend(),stencil:(0,T.getMask)(n,o)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:i.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e){var n="GAODE2.x"===t.version?t.originCoordinates:t.coordinates;return[n[0],n[1],0]}}})}}]),n}(dt);function Oe(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var Le,Ie=function(t){(0,u.Z)(n,t);var e=Oe(n);function n(){return(0,o.Z)(this,n),e.apply(this,arguments)}return(0,a.Z)(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig();return{u_opacity:t.opacity||1,u_coverage:t.coverage||1,u_angle:t.angle||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var t=this.layer.getLayerConfig(),e=t.mask,n=void 0!==e&&e,r=t.maskInside,i=void 0===r||r;return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:'precision highp float;\n// 多边形顶点坐标\nattribute vec3 a_Position;\n// 多边形经纬度坐标\nattribute vec3 a_Pos;\n\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec4 a_Color;\nuniform vec2 u_radius;\nuniform float u_coverage: 0.9;\nuniform float u_angle: 0;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\n\nuniform vec2 u_SceneCenterMKT;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "light"\n#pragma include "picking"\n\n\nvoid main() {\n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\n  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));\n  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // 实际的经纬度\n  // vec2 lnglat = (a_Pos.xy + offset); \n  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));\n  // gl_Position = project_common_position_to_clipspace(project_pos);\n  // float lightWeight = calc_lighting(project_pos);\n  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // vec2 lnglat = (a_Pos.xy + offset); \n    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));\n\n    // float lightWeight = calc_lighting(project_pos);\n    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);\n  \n    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);\n    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // 经纬度\n    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // 将经纬度转换为高德2.0需要的平面坐标\n    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));\n\n    float lightWeight = calc_lighting(project_pos);\n    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);\n  \n    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);\n  } else {\n    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // 实际的经纬度\n    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));\n    \n    float lightWeight = calc_lighting(project_pos);\n    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);\n    \n    gl_Position = project_common_position_to_clipspace(project_pos);\n  }\n\n\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'precision highp float;\nvarying vec4 v_color;\nuniform float u_opacity: 1;\n\n#pragma include "picking"\n\nvoid main() {\n  gl_FragColor = v_color;\n  gl_FragColor.a *= u_opacity;\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:te,depth:{enable:!0},blend:this.getBlend(),stencil:(0,T.getMask)(n,i)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e,n,r){var i=t.size;return Array.isArray(i)?[i[0]]:[i]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:i.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:i.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e){var n="GAODE2.x"===t.version?t.originCoordinates:t.coordinates;return[n[0],n[1],0]}}})}}]),n}(dt),Re=n(86700);n(28660);function De(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Ne(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?De(Object(n),!0).forEach((function(e){(0,p.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):De(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Ze(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var ze=(0,Re.b2)()(Le=function(t){(0,u.Z)(n,t);var e=Ze(n);function n(){var t;(0,o.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i)),(0,p.Z)((0,s.Z)(t),"texture",void 0),(0,p.Z)((0,s.Z)(t),"colorTexture",void 0),(0,p.Z)((0,s.Z)(t),"heatmapFramerBuffer",void 0),(0,p.Z)((0,s.Z)(t),"intensityModel",void 0),(0,p.Z)((0,s.Z)(t),"colorModel",void 0),(0,p.Z)((0,s.Z)(t),"shapeType",void 0),t}return(0,a.Z)(n,[{key:"render",value:function(){var t=this,e=this.rendererService,n=e.clear;(0,e.useFramebuffer)(this.heatmapFramerBuffer,(function(){n({color:[0,0,0,0],depth:1,stencil:0,framebuffer:t.heatmapFramerBuffer}),t.drawIntensityMode()})),this.layer.styleNeedUpdate&&this.updateColorTexture(),"heatmap"===this.shapeType?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var t,e=this.rendererService,n=e.createFramebuffer,r=(e.clear,e.getViewportSize),o=e.createTexture2D,a=(e.useFramebuffer,this.styleAttributeService.getLayerStyleAttribute("shape")),s=(null==a||null===(t=a.scale)||void 0===t?void 0:t.field)||"heatmap";this.shapeType=s,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel="heatmap"===s?this.buildHeatmapColor():this.build3dHeatMap();var u=r(),l=u.width,c=u.height;return this.heatmapFramerBuffer=n({color:o({width:Math.floor(l/4),height:Math.floor(c/4),wrapS:i.gl.CLAMP_TO_EDGE,wrapT:i.gl.CLAMP_TO_EDGE,min:i.gl.LINEAR,mag:i.gl.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:i.AttributeType.Attribute,descriptor:{name:"a_Dir",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,n,r){return[n[3],n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e,n,r){var i=t.size;return[void 0===i?1:i]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.triangulation=pe,this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:'precision highp float;\nattribute vec3 a_Position;\nattribute float a_Size;\nattribute vec2 a_Dir;\nuniform float u_intensity;\nuniform float u_radius;\nvarying vec2 v_extrude;\nvarying float v_weight;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\n#define GAUSS_COEF  0.3989422804014327\n\n#pragma include "projection"\n\nvoid main(){\n    v_weight = a_Size;\n    float ZERO = 1.0 / 255.0 / 16.0;\n    float extrude_x = a_Dir.x * 2.0 -1.0;\n    float extrude_y = a_Dir.y * 2.0 -1.0;\n    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));\n    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;\n    v_extrude = extrude_dir * S;\n\n    vec2 offset = project_pixel(v_extrude * u_radius);\n    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\n\n    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));\n    } else {\n        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n    }\n}\n',fragmentShader:"precision highp float;\nuniform float u_intensity;\nvarying float v_weight;\nvarying vec2 v_extrude;\n#define GAUSS_COEF  0.3989422804014327\nvoid main(){\n    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);\n    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);\n    gl_FragColor = vec4(val, 1., 1., 1.);\n}\n",triangulation:pe,depth:{enable:!1},cull:{enable:!0,face:(0,T.getCullFace)(this.mapService.version)},blend:{enable:!0,func:{srcRGB:i.gl.ONE,srcAlpha:1,dstRGB:i.gl.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){var t=this.layer.getLayerConfig(),e=t.mask,n=void 0!==e&&e,r=t.maskInside,o=void 0===r||r;this.shaderModuleService.registerModule("heatmapColor",{vs:"precision highp float;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n\nvoid main() {\n  v_texCoord = a_Uv;\n\n  gl_Position = vec4(a_Position.xy, 0, 1.);\n}\n",fs:"uniform sampler2D u_texture;        // 热力强度图\nuniform sampler2D u_colorTexture;   // 根据强度分布的色带\nuniform float u_opacity;\nvarying vec2 v_texCoord;\n\nfloat getBlurIndusty() {\n    float h = 2.0/512.0;\n    vec2 vUv = v_texCoord;\n    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y + 1.0 * h) ).r;\n    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * h, vUv.y + 1.0 * h) ).r;\n    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y + 1.0 * h) ).r;\n\n    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y) ).r;\n    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;\n    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y) ).r;\n\n    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y-1.0*h) ).r;\n    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * h, vUv.y-1.0*h) ).r;\n    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y-1.0*h) ).r;\n\n    return(\n        i11 + \n        i12 + \n        i13 + \n        i21 + \n        i21 + \n        i22 + \n        i23 + \n        i31 + \n        i32 + \n        i33\n        )/9.0;\n}\n\n\nvoid main(){\n    // float intensity = texture2D(u_texture, v_texCoord).r;\n    float intensity = getBlurIndusty();\n    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));\n\n    gl_FragColor =color;\n    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;\n\n}\n"});var a=this.shaderModuleService.getModule("heatmapColor"),s=a.vs,u=a.fs,l=a.uniforms,c=this.rendererService,p=c.createAttribute,h=c.createElements,f=c.createBuffer;return(0,c.createModel)({vs:s,fs:u,attributes:{a_Position:p({buffer:f({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:i.gl.FLOAT}),size:3}),a_Uv:p({buffer:f({data:[0,1,1,1,0,0,1,0],type:i.gl.FLOAT}),size:2})},uniforms:Ne({},l),depth:{enable:!1},blend:this.getBlend(),count:6,elements:h({data:[0,2,1,2,3,1],type:i.gl.UNSIGNED_INT,count:6}),stencil:(0,T.getMask)(n,o)})}},{key:"drawIntensityMode",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=t.intensity,r=void 0===n?10:n,i=t.radius,o=void 0===i?5:i;this.intensityModel.draw({uniforms:{u_opacity:e||1,u_radius:o,u_intensity:r}})}},{key:"drawColorMode",value:function(){var t=this.layer.getLayerConfig().opacity;this.colorModel.draw({uniforms:{u_opacity:t||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var t=this.layer.getLayerConfig().opacity,e=wt.create();wt.invert(e,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:t||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,at.Z)(e)}})}},{key:"build3dHeatMap",value:function(){var t=this.layer.getLayerConfig(),e=t.mask,n=void 0!==e&&e,r=t.maskInside,o=void 0===r||r,a=(0,this.rendererService.getViewportSize)(),s=function(t,e){for(var n=[],r=[],i=[],o=t+1,a=e+1,s=t/2,u=e/2,l=0;l<a;l++)for(var c=l-u,p=0;p<o;p++){var h=p-s;r.push(h/s,-c/u,0),i.push(p/t),i.push(1-l/e)}for(var f=0;f<e;f++)for(var d=0;d<t;d++){var v=d+o*f,m=d+o*(f+1),y=d+1+o*(f+1),g=d+1+o*f;n.push(v,m,g),n.push(m,y,g)}return{vertices:r,indices:n,uvs:i}}(a.width/4,a.height/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:'precision highp float;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_InverseViewProjectionMatrix;\nuniform mat4 u_ViewProjectionMatrixUncentered;\nvarying float v_intensity;\n\n\nvec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {\n    float t2 = t * t;\n    float one_minus_t = 1.0 - t;\n    float one_minus_t2 = one_minus_t * one_minus_t;\n    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);\n}\nvec2 toBezier(float t, vec4 p){\n    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));\n}\n#pragma include "projection"\nvoid main() {\n  v_texCoord = a_Uv;\n\n  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // 将原本 0 -> 1 的 uv 转换为 -1 -> 1 的标准坐标空间（NDC）\n\n  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y 平面上的点（z == 0）可以认为是三维上的点被投影到平面后的点\n\tvec4 p2 = vec4(pos, 1.0, 1.0); // 平行于x/y平面、z==1 的平面上的点\n\n\tvec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // 根据视图投影矩阵的逆矩阵平面上的反算出三维空间中的点（p1平面上的点）\n\tvec4 inverseP2 = u_InverseViewProjectionMatrix * p2;\n\n  inverseP1 = inverseP1 / inverseP1.w; // 归一化操作（归一化后为世界坐标）\n\tinverseP2 = inverseP2 / inverseP2.w;\n\n\tfloat zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??\n\tvec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);\n\n  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);\n  float fh;\n\n  v_intensity = texture2D(u_texture, v_texCoord).r;\n  fh = toBezier(v_intensity, b).y;\n  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);\n \n}\n',fs:"uniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\nuniform float u_opacity;\nvarying vec2 v_texCoord;\nvarying float v_intensity;\n\nvoid main(){\n   \n     float intensity = texture2D(u_texture, v_texCoord).r;\n    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));\n    gl_FragColor = color;\n    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;\n     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;\n}\n"});var u=this.shaderModuleService.getModule("heatmap3dColor"),l=u.vs,c=u.fs,p=u.uniforms,h=this.rendererService,f=h.createAttribute,d=h.createElements,v=h.createBuffer;return(0,h.createModel)({vs:l,fs:c,attributes:{a_Position:f({buffer:v({data:s.vertices,type:i.gl.FLOAT}),size:3}),a_Uv:f({buffer:v({data:s.uvs,type:i.gl.FLOAT}),size:2})},primitive:i.gl.TRIANGLES,uniforms:Ne({},p),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:i.gl.SRC_ALPHA,srcAlpha:1,dstRGB:i.gl.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:d({data:s.indices,type:i.gl.UNSIGNED_INT,count:s.indices.length}),stencil:(0,T.getMask)(n,o)})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var t=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var e=this.layer.getLayerConfig().rampColors,n=(0,T.generateColorRamp)(e);this.colorTexture=t({data:new Uint8Array(n.data),width:n.width,height:n.height,wrapS:i.gl.CLAMP_TO_EDGE,wrapT:i.gl.CLAMP_TO_EDGE,min:i.gl.NEAREST,mag:i.gl.NEAREST,flipY:!1})}}]),n}(dt))||Le;function Fe(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var Be=function(t){(0,u.Z)(n,t);var e=Fe(n);function n(){return(0,o.Z)(this,n),e.apply(this,arguments)}return(0,a.Z)(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig();return{u_opacity:t.opacity||1,u_coverage:t.coverage||.9,u_angle:t.angle||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var t=this.layer.getLayerConfig(),e=t.mask,n=void 0!==e&&e,r=t.maskInside,o=void 0===r||r;return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:'precision highp float;\n// 多边形顶点坐标\nattribute vec3 a_Position;\n// 多边形经纬度坐标\nattribute vec3 a_Pos;\nattribute float a_Size;\nattribute vec4 a_Color;\nuniform vec2 u_radius;\nuniform float u_coverage: 0.9;\nuniform float u_angle: 0;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\n\nuniform vec2 u_SceneCenterMKT;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nvoid main() {\n  v_color = a_Color;\n    \n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\n  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));\n  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\n \n  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));\n    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));\n    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;\n    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\n    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);\n  } else {\n    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));\n  }\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'precision highp float;\nvarying vec4 v_color;\nuniform float u_opacity: 1;\n\n#pragma include "picking"\n\nvoid main() {\n  gl_FragColor = v_color;\n  gl_FragColor.a *= u_opacity;\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:ue,depth:{enable:!1},primitive:i.gl.TRIANGLES,blend:this.getBlend(),stencil:(0,T.getMask)(n,o)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:i.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e){var n="GAODE2.x"===t.version?t.originCoordinates:t.coordinates;return[n[0],n[1],0]}}})}}]),n}(dt),je={heatmap:ze,heatmap3d:ze,grid:Pe,grid3d:Ie,hexagon:Be},Ue=n(25108);function Ve(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var Ge=function(t){(0,u.Z)(n,t);var e=Ve(n);function n(){var t;(0,o.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i)),(0,p.Z)((0,s.Z)(t),"type","HeatMapLayer"),t}return(0,a.Z)(n,[{key:"buildModels",value:function(){var t=this.getModelType();this.layerModel=new je[t](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var t=this;return"heatmap"===this.getModelType()?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach((function(e){return e.draw({uniforms:t.layerModel.getUninforms()})})),this)}},{key:"updateModelData",value:function(t){t.attributes&&t.elements?this.models[0].updateAttributesAndElements(t.attributes,t.elements):Ue.warn("data error")}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var t,e=this.styleAttributeService.getLayerStyleAttribute("shape"),n=this.getLayerConfig().shape3d,r=this.getSource().data.type,i=(null==e||null===(t=e.scale)||void 0===t?void 0:t.field)||"heatmap";return"heatmap"===i||"heatmap3d"===i?"heatmap":"hexagon"===r?-1===(null==n?void 0:n.indexOf(i))?"hexagon":"grid3d":"grid"===r?-1===(null==n?void 0:n.indexOf(i))?"grid":"grid3d":"heatmap"}}]),n}(ot);function He(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var We=function(t){(0,u.Z)(n,t);var e=He(n);function n(){var t;(0,o.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i)),(0,p.Z)((0,s.Z)(t),"texture",void 0),t}return(0,a.Z)(n,[{key:"getUninforms",value:function(){return{u_opacity:this.layer.getLayerConfig().opacity||1,u_texture:this.texture}}},{key:"initModels",value:function(){var t=this,e=this.layer.getLayerConfig(),n=e.mask,r=void 0!==n&&n,o=e.maskInside,a=void 0===o||o,s=this.layer.getSource(),u=this.rendererService.createTexture2D;if(this.texture=u({height:0,width:0}),T.isMini){var l=this.layerService.sceneService.getSceneConfig().canvas.createImage();l.crossOrigin="anonymous",l.src=s.data.originData,l.onload=function(){t.texture=u({data:l,width:l.width,height:l.height}),t.layerService.updateLayerRenderList(),t.layerService.renderLayers()}}else s.data.images.then((function(e){t.texture=u({data:e[0],width:e[0].width,height:e[0].height}),t.layerService.updateLayerRenderList(),t.layerService.renderLayers()}));return[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   }\n}\n',fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nvoid main() {\n  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));\n  gl_FragColor = color;\n  gl_FragColor.a *= u_opacity;\n}\n",triangulation:le,primitive:i.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:(0,T.getMask)(r,a)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,n,r){return[n[3],n[4]]}}})}}]),n}(dt),qe={image:We};function Xe(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var Ye=function(t){(0,u.Z)(n,t);var e=Xe(n);function n(){var t;(0,o.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i)),(0,p.Z)((0,s.Z)(t),"type","ImageLayer"),t}return(0,a.Z)(n,[{key:"buildModels",value:function(){var t=this.getModelType();this.layerModel=new qe[t](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{image:{}}[this.getModelType()]}},{key:"getModelType",value:function(){return"image"}}]),n}(ot);function Ke(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var Qe={solid:0,dash:1},Je=function(t){(0,u.Z)(n,t);var e=Ke(n);function n(){var t;(0,o.Z)(this,n);for(var r=arguments.length,a=new Array(r),u=0;u<r;u++)a[u]=arguments[u];return t=e.call.apply(e,[this].concat(a)),(0,p.Z)((0,s.Z)(t),"texture",void 0),(0,p.Z)((0,s.Z)(t),"updateTexture",(function(){var e=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=e({data:t.iconService.getCanvas(),mag:i.gl.NEAREST,min:i.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return(0,a.Z)(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.sourceColor,o=t.targetColor,a=t.textureBlend,s=void 0===a?"normal":a,u=t.lineType,l=void 0===u?"solid":u,c=t.dashArray,p=void 0===c?[10,5]:c,h=t.forward,f=void 0===h||h,d=t.lineTexture,v=void 0!==d&&d,m=t.iconStep,y=void 0===m?100:m,g=t.segmentNumber,_=void 0===g?30:g,x=t.thetaOffset,b=void 0===x?.314:x;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n,thetaOffset:b})){this.judgeStyleAttributes({opacity:n,thetaOffset:b});var w=this.layer.getEncodedData(),S=this.calDataFrame(this.cellLength,w,this.cellProperties),E=S.data,C=S.width,A=S.height;this.rowCount=A,this.dataTexture=this.cellLength>0&&E.length>0?this.createTexture2D({flipY:!0,data:E,format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:C,height:A}):this.createTexture2D({flipY:!0,data:[1],format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:1,height:1})}2===p.length&&p.push(0,0);var M=0,k=[0,0,0,0],P=[0,0,0,0];return r&&o&&(k=(0,T.rgb2arr)(r),P=(0,T.rgb2arr)(o),M=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:Number(b),u_opacity:Number(n),u_textureBlend:"normal"===s?0:1,segmentNumber:_,u_line_type:Qe[l||"solid"],u_dash_array:p,u_blur:.9,u_lineDir:f?1:-1,u_texture:this.texture,u_line_texture:v?1:0,u_icon_step:y,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:M,u_sourceColor:k,u_targetColor:P}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig().animateOption;return{u_aimate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var t,e;null===(t=this.texture)||void 0===t||t.destroy(),null===(e=this.dataTexture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),e=t.sourceColor,n=t.targetColor;return"dash"===t.lineType?{frag:'\nuniform float u_opacity;\n\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\n\nuniform float segmentNumber;\n\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  float d_distance_ratio = styleMappingMat[3].b; // 当前顶点在弧线中所处的分段比例\n\n  gl_FragColor = v_color;\n  gl_FragColor.a *= opacity;\n\n  float flag = 0.;\n  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n    flag = 1.;\n  }\n  gl_FragColor.a *=flag;\n  \n  gl_FragColor = filterColor(gl_FragColor);\n}',vert:'\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nvarying vec4 v_color;\n\n\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nuniform float u_lineDir: 1.0;\nvarying vec4 v_dash_array;\n\nuniform float u_thetaOffset: 0.314;\n\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "styleMappingCalThetaOffset"\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1. - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = arcThetaOffset;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\n  if(u_lineDir == 1.0) { // 正向\n    return mid;\n  } else { // 逆向\n    // (mid + vmin)/2 = (s + t)/2\n    vec2 vmid = source + target - mid;\n    return vmid;\n  }\n  // return mid;\n}\nfloat getSegmentRatio(float index) {\n    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n}\nvec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  vec2 mid = midPoint(source, target, arcThetaOffset);\n  vec3 x = vec3(source.x, mid.x, target.x);\n  vec3 y = vec3(source.y, mid.y, target.y);\n  return vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nvoid main() {\n  v_color = a_Color;\n\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0  // dataset 数据集\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n\n  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][1] = thetaOffsetAndOffset.r;\n  textureOffset = thetaOffsetAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n  \n  vec2 source = a_Instance.rg;  // 起始点\n  vec2 target =  a_Instance.ba; // 终点\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n\n  vec2 s = source;\n  vec2 t = target;\n  \n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    s = unProjCustomCoord(source);\n    t = unProjCustomCoord(target);\n  }\n  float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n  \n  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n  \n\n   styleMappingMat[3].b = segmentIndex / segmentNumber;\n\n  // styleMappingMat[0][1] - arcThetaOffset\n  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));\n  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n  //unProjCustomCoord\n  \n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n  \n\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n  }\n  setPickingColor(a_PickingColor);\n}\n',type:"dash"}:e&&n?{frag:'#define Animate 0.0\n#define LineTexture 1.0\n\nuniform float u_opacity;\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\n// varying vec2 v_normal;\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\n\nuniform float u_time;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\n\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\n\nuniform float segmentNumber;\nvarying vec2 v_iconMapUV;\n\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  float d_segmentIndex = styleMappingMat[3].r;   // 当前顶点在弧线中所处的分段位置\n\n  // 设置弧线的底色\n  gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);\n  gl_FragColor.a *= opacity;\n  gl_FragColor = filterColor(gl_FragColor);\n}',vert:'\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nvarying vec4 v_color;\n\nuniform float u_lineDir: 1.0;\n\nuniform float u_thetaOffset: 0.314;\n\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "styleMappingCalThetaOffset"\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1. - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = arcThetaOffset;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\n  if(u_lineDir == 1.0) { // 正向\n    return mid;\n  } else { // 逆向\n    // (mid + vmin)/2 = (s + t)/2\n    vec2 vmid = source + target - mid;\n    return vmid;\n  }\n  // return mid;\n}\nfloat getSegmentRatio(float index) {\n    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n}\nvec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  vec2 mid = midPoint(source, target, arcThetaOffset);\n  vec3 x = vec3(source.x, mid.x, target.x);\n  vec3 y = vec3(source.y, mid.y, target.y);\n  return vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nvoid main() {\n  v_color = a_Color;\n\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0  // dataset 数据集\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n\n  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][1] = thetaOffsetAndOffset.r;\n  textureOffset = thetaOffsetAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n  \n  vec2 source = a_Instance.rg;  // 起始点\n  vec2 target =  a_Instance.ba; // 终点\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  float d_distance_ratio;\n\n   styleMappingMat[3].b = d_distance_ratio;\n\n  // styleMappingMat[0][1] - arcThetaOffset\n  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));\n  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n  //unProjCustomCoord\n  \n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n\n\n  float d_segmentIndex = a_Position.x + 1.0; // 当前顶点在弧线中所处的分段位置\n  styleMappingMat[3].r = d_segmentIndex;\n\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n  }\n  setPickingColor(a_PickingColor);\n}\n',type:"linear"}:{frag:'\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform float u_opacity;\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\n// varying vec2 v_normal;\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\n\nuniform float u_time;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\n\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\n\nuniform float segmentNumber;\nvarying vec2 v_iconMapUV;\n\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  float animateSpeed = 0.0; // 运动速度\n  float d_segmentIndex = styleMappingMat[3].r;   // 当前顶点在弧线中所处的分段位置\n  float d_distance_ratio = styleMappingMat[3].b; // 当前顶点在弧线中所处的分段比例\n\n  gl_FragColor = v_color;\n  \n  gl_FragColor.a *= opacity;\n\n  if(u_aimate.x == Animate && u_line_texture != LineTexture) {\n      animateSpeed = u_time / u_aimate.y;\n      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);\n      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      gl_FragColor.a *= alpha;\n  }\n\n  // 当存在贴图时在底色上贴上贴图\n  if(u_line_texture == LineTexture) { // while load texture\n    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));\n    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);\n\n    float count = styleMappingMat[3].g; // 贴图在弧线上重复的数量\n\n    float time = 0.0;\n    if(u_aimate.x == Animate) {\n      time = u_time / u_aimate.y;\n    }\n    float redioCount = arcRadio * count;\n\n    float u = fract(redioCount - time);\n    float v = styleMappingMat[3].a; // 横向 v\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n\n    vec4 pattern = texture2D(u_texture, uv);\n\n    if(u_aimate.x == Animate) {\n      float currentPlane = floor(redioCount - time);\n      float textureStep = floor(count * u_aimate.z);\n      float a = mod(currentPlane, textureStep);\n      if(a < textureStep - 1.0) {\n        pattern = vec4(0.0);\n      }\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        gl_FragColor = filterColor(pattern);\n    }\n    \n  } else {\n     gl_FragColor = filterColor(gl_FragColor);\n  }\n  // gl_FragColor = filterColor(gl_FragColor);\n}',vert:'#define Animate 0.0\n#define LineTexture 1.0\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nvarying vec4 v_color;\n\nuniform float u_lineDir: 1.0;\n\nuniform float u_thetaOffset: 0.314;\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\n\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "styleMappingCalThetaOffset"\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1. - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = arcThetaOffset;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\n  if(u_lineDir == 1.0) { // 正向\n    return mid;\n  } else { // 逆向\n    // (mid + vmin)/2 = (s + t)/2\n    vec2 vmid = source + target - mid;\n    return vmid;\n  }\n  // return mid;\n}\nfloat getSegmentRatio(float index) {\n    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n}\nvec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  vec2 mid = midPoint(source, target, arcThetaOffset);\n  vec3 x = vec3(source.x, mid.x, target.x);\n  vec3 y = vec3(source.y, mid.y, target.y);\n  return vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nvoid main() {\n  v_color = a_Color;\n\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0  // dataset 数据集\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n\n  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][1] = thetaOffsetAndOffset.r;\n  textureOffset = thetaOffsetAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n  \n  vec2 source = a_Instance.rg;  // 起始点\n  vec2 target =  a_Instance.ba; // 终点\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  float d_distance_ratio;\n  \n  if(u_aimate.x == Animate) {\n      d_distance_ratio = segmentIndex / segmentNumber;\n      if(u_lineDir != 1.0) {\n        d_distance_ratio = 1.0 - d_distance_ratio;\n      }\n  }\n\n   styleMappingMat[3].b = d_distance_ratio;\n\n  // styleMappingMat[0][1] - arcThetaOffset\n  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));\n  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n  //unProjCustomCoord\n  \n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n\n\n  float d_segmentIndex = a_Position.x + 1.0; // 当前顶点在弧线中所处的分段位置\n  styleMappingMat[3].r = d_segmentIndex;\n\n  if(LineTexture == u_line_texture) { // 开启贴图模式\n\n    float arcDistrance = length(source - target); // 起始点和终点的距离\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap\n      arcDistrance *= 1000000.0;\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox\n      // arcDistrance *= 8.0;\n      arcDistrance = project_pixel_allmap(arcDistrance);\n    }\n    v_iconMapUV = a_iconMapUV;\n\n    float pixelLen = project_pixel_texture(u_icon_step); // 贴图沿弧线方向的长度 - 随地图缩放改变\n    float texCount = floor(arcDistrance/pixelLen); // 贴图在弧线上重复的数量\n     styleMappingMat[3].g = texCount;\n\n    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size); // 定点位置偏移\n     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // 线图层贴图部分的 v 坐标值\n  }\n  \n\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n  }\n  setPickingColor(a_PickingColor);\n}\n',type:"normal"}}},{key:"buildModels",value:function(){var t=this.layer.getLayerConfig(),e=t.segmentNumber,n=void 0===e?30:e,r=t.mask,i=void 0!==r&&r,o=t.maskInside,a=void 0===o||o,s=this.getShaders(),u=s.frag,l=s.vert,c=s.type;return[this.layer.buildLayerModel({moduleName:"arc2dline"+c,vertexShader:l,fragmentShader:u,triangulation:ce,depth:{enable:!1},blend:this.getBlend(),segmentNumber:n,stencil:(0,T.getMask)(i,a)})]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e,n,r){var i=t.size,o=void 0===i?1:i;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:i.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:4,update:function(t,e,n,r){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(e,n,r,i){var o=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[o.x,o.y]}}})}}]),n}(dt);function $e(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var tn={solid:0,dash:1},en=function(t){(0,u.Z)(n,t);var e=$e(n);function n(){var t;(0,o.Z)(this,n);for(var r=arguments.length,a=new Array(r),u=0;u<r;u++)a[u]=arguments[u];return t=e.call.apply(e,[this].concat(a)),(0,p.Z)((0,s.Z)(t),"texture",void 0),(0,p.Z)((0,s.Z)(t),"updateTexture",(function(){var e=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=e({data:t.iconService.getCanvas(),mag:i.gl.NEAREST,min:i.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return(0,a.Z)(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.sourceColor,o=t.targetColor,a=t.textureBlend,s=void 0===a?"normal":a,u=t.lineType,l=void 0===u?"solid":u,c=t.dashArray,p=void 0===c?[10,5]:c,h=t.lineTexture,f=void 0!==h&&h,d=t.iconStep,v=void 0===d?100:d,m=t.segmentNumber,y=void 0===m?30:m,g=t.globalArcHeight,_=void 0===g?10:g;2===p.length&&p.push(0,0);var x=0,b=[0,0,0,0],w=[0,0,0,0];if(r&&o&&(b=(0,T.rgb2arr)(r),w=(0,T.rgb2arr)(o),x=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n})){this.judgeStyleAttributes({opacity:n});var S=this.layer.getEncodedData(),E=this.calDataFrame(this.cellLength,S,this.cellProperties),C=E.data,A=E.width,M=E.height;this.rowCount=M,this.dataTexture=this.cellLength>0&&C.length>0?this.createTexture2D({flipY:!0,data:C,format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:A,height:M}):this.createTexture2D({flipY:!0,data:[1],format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:1,height:1})}return{u_globel:"GLOBEL"===this.mapService.version?1:0,u_globel_radius:Et,u_global_height:_,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(n),u_textureBlend:"normal"===s?0:1,segmentNumber:y,u_line_type:tn[l]||0,u_dash_array:p,u_texture:this.texture,u_line_texture:f?1:0,u_icon_step:v,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:x,u_sourceColor:b,u_targetColor:w}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig().animateOption;return{u_aimate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var t,e;null===(t=this.texture)||void 0===t||t.destroy(),null===(e=this.dataTexture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),e=t.sourceColor,n=t.targetColor;return e&&n?{frag:'\n#define Animate 0.0\n\nuniform float u_opacity;\nuniform float u_blur : 0.9;\nvarying float v_segmentIndex;\nuniform float segmentNumber;\n\n\nuniform float u_time;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\n\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\nvarying mat4 styleMappingMat;\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = styleMappingMat[3].g; // 当前点位距离占线总长的比例\n\n  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);\n\n  gl_FragColor.a *= opacity;\n\n  if(u_aimate.x == Animate) {\n      animateSpeed = u_time / u_aimate.y;\n      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);\n\n      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      gl_FragColor.a *= alpha;\n\n      // u_aimate \n      // x enable\n      // y duration\n      // z interval\n      // w trailLength\n  }\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute vec4 a_Color;\nattribute float a_Size;\n\nuniform float u_globel;\nuniform float u_globel_radius;\nuniform float u_global_height: 10;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nvarying vec4 v_color;\n// varying vec2 v_normal;\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nvarying vec4 v_dash_array;\n\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nvarying float v_segmentIndex;\n\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\n\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertex_height = paraboloid(source, target, segmentRatio);\n\n  return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n  );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nfloat torad(float deg) {\n  return (deg / 180.0) * acos(-1.0);\n}\n\nvec3 lglt2xyz(vec2 lnglat) {\n  float pi = 3.1415926;\n  // TODO: + Math.PI/2 是为了对齐坐标\n  float lng = torad(lnglat.x) + pi / 2.0;\n  float lat = torad(lnglat.y);\n\n  // TODO: 手动增加一些偏移，减轻面的冲突\n  float radius = u_globel_radius;\n\n  float z = radius * cos(lat) * cos(lng);\n  float x = radius * cos(lat) * sin(lng);\n  float y = radius * sin(lat);\n  return vec3(x, y, z);\n}\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0  // dataset 数据集\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n  v_color = a_Color;\n  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;\n  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  float d_distance_ratio;\n   if(u_line_type == LineTypeDash) {\n    d_distance_ratio = segmentIndex / segmentNumber;\n    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n  }\n    if(u_aimate.x == Animate) {\n      d_distance_ratio = segmentIndex / segmentNumber;\n  }\n  styleMappingMat[3].g = d_distance_ratio; // 当前点位距离占线总长的比例\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  vec3 curr = getPos(source, target, segmentRatio);\n  vec3 next = getPos(source, target, nextSegmentRatio);\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n\n\n  v_segmentIndex = a_Position.x;\n  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // 开启贴图模式  \n\n    float arcDistrance = length(source - target);\n    float pixelLen =  project_pixel_texture(u_icon_step);\n    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // 贴图在弧线上重复的数量\n\n    vec2 projectOffset = project_pixel(offset);\n    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size);  // 定点位置偏移，按地图等级缩放后的距离\n    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // 线图层贴图部分的 v 坐标值\n\n    v_iconMapUV = a_iconMapUV;\n  }\n  \n\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  }\n\n  // 地球模式\n  if(u_globel > 0.0) {\n    vec3 startLngLat = lglt2xyz(a_Instance.rg);\n    vec3 endLngLat = lglt2xyz(a_Instance.ba);\n    float globalRadius = length(startLngLat);\n\n    vec3 lineDir = normalize(endLngLat - startLngLat);\n    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);\n\n    // 线的偏移\n    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;\n    // 计算起始点和终止点的距离\n    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;\n    // 计算飞线各个节点相应的高度\n    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;\n    // 地球点位\n    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;\n    \n    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);\n  }\n \n\n  setPickingColor(a_PickingColor);\n}\n',type:"linear"}:{frag:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform float u_opacity;\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\n// varying vec2 v_normal;\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\n\nuniform float u_line_texture: 0.0;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nvarying float v_segmentIndex;\nuniform float segmentNumber;\n\nvarying vec2 v_iconMapUV;\n\nuniform float u_time;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\n\nvarying mat4 styleMappingMat;\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = styleMappingMat[3].g; // 当前点位距离占线总长的比例\n  gl_FragColor = v_color;\n\n  gl_FragColor.a *= opacity;\n  if(u_line_type == LineTypeDash) {\n    float flag = 0.;\n    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n      flag = 1.;\n    }\n    gl_FragColor.a *=flag;\n  }\n\n  if(u_aimate.x == Animate && u_line_texture != LineTexture) {\n      animateSpeed = u_time / u_aimate.y;\n      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);\n\n      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      gl_FragColor.a *= alpha;\n\n      // u_aimate \n      // x enable\n      // y duration\n      // z interval\n      // w trailLength\n  }\n\n  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture\n    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));\n    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);\n    float count = styleMappingMat[3].b; // // 贴图在弧线上重复的数量\n\n    float time = 0.0;\n    if(u_aimate.x == Animate) {\n      time = u_time / u_aimate.y;\n    }\n    float redioCount = arcRadio * count;\n\n    float u = fract(redioCount - time);\n\n    float v = styleMappingMat[3].a;  // 线图层贴图部分的 v 坐标值\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture2D(u_texture, uv);\n\n    if(u_aimate.x == Animate) {\n      float currentPlane = floor(redioCount - time);\n      float textureStep = floor(count * u_aimate.z);\n      float a = mod(currentPlane, textureStep);\n      if(a < textureStep - 1.0) {\n        pattern = vec4(0.0);\n      }\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n          discard;\n        } else {\n          gl_FragColor = filterColor(pattern);\n        }\n    }\n\n  } else {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n',vert:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute vec4 a_Color;\nattribute float a_Size;\n\nuniform float u_globel;\nuniform float u_globel_radius;\nuniform float u_global_height: 10;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nvarying vec4 v_color;\n// varying vec2 v_normal;\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nvarying vec4 v_dash_array;\n\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nvarying float v_segmentIndex;\n\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\n\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertex_height = paraboloid(source, target, segmentRatio);\n\n  return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n  );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nfloat torad(float deg) {\n  return (deg / 180.0) * acos(-1.0);\n}\n\nvec3 lglt2xyz(vec2 lnglat) {\n  float pi = 3.1415926;\n  // TODO: + Math.PI/2 是为了对齐坐标\n  float lng = torad(lnglat.x) + pi / 2.0;\n  float lat = torad(lnglat.y);\n\n  // TODO: 手动增加一些偏移，减轻面的冲突\n  float radius = u_globel_radius;\n\n  float z = radius * cos(lat) * cos(lng);\n  float x = radius * cos(lat) * sin(lng);\n  float y = radius * sin(lat);\n  return vec3(x, y, z);\n}\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0  // dataset 数据集\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n  v_color = a_Color;\n  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;\n  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  float d_distance_ratio;\n   if(u_line_type == LineTypeDash) {\n    d_distance_ratio = segmentIndex / segmentNumber;\n    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n  }\n    if(u_aimate.x == Animate) {\n      d_distance_ratio = segmentIndex / segmentNumber;\n  }\n  styleMappingMat[3].g = d_distance_ratio; // 当前点位距离占线总长的比例\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  vec3 curr = getPos(source, target, segmentRatio);\n  vec3 next = getPos(source, target, nextSegmentRatio);\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n\n\n  v_segmentIndex = a_Position.x;\n  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // 开启贴图模式  \n\n    float arcDistrance = length(source - target);\n    float pixelLen =  project_pixel_texture(u_icon_step);\n    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // 贴图在弧线上重复的数量\n\n    vec2 projectOffset = project_pixel(offset);\n    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size);  // 定点位置偏移，按地图等级缩放后的距离\n    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // 线图层贴图部分的 v 坐标值\n\n    v_iconMapUV = a_iconMapUV;\n  }\n  \n\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  }\n\n  // 地球模式\n  if(u_globel > 0.0) {\n    vec3 startLngLat = lglt2xyz(a_Instance.rg);\n    vec3 endLngLat = lglt2xyz(a_Instance.ba);\n    float globalRadius = length(startLngLat);\n\n    vec3 lineDir = normalize(endLngLat - startLngLat);\n    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);\n\n    // 线的偏移\n    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;\n    // 计算起始点和终止点的距离\n    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;\n    // 计算飞线各个节点相应的高度\n    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;\n    // 地球点位\n    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;\n    \n    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);\n  }\n \n\n  setPickingColor(a_PickingColor);\n}\n',type:"normal"}}},{key:"buildModels",value:function(){var t=this.layer.getLayerConfig(),e=t.segmentNumber,n=void 0===e?30:e,r=t.mask,i=void 0!==r&&r,o=t.maskInside,a=void 0===o||o,s=this.getShaders(),u=s.frag,l=s.vert,c=s.type;return[this.layer.buildLayerModel({moduleName:"arc3Dline"+c,vertexShader:l,fragmentShader:u,triangulation:ce,blend:this.getBlend(),segmentNumber:n,stencil:(0,T.getMask)(i,a)})]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e,n,r){var i=t.size,o=void 0===i?1:i;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:i.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:4,update:function(t,e,n,r){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(e,n,r,i){var o=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[o.x,o.y]}}})}}]),n}(dt);function nn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var rn=function(t){(0,u.Z)(n,t);var e=nn(n);function n(){return(0,o.Z)(this,n),e.apply(this,arguments)}return(0,a.Z)(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.sourceColor,i=t.targetColor,o=t.forward,a=void 0===o||o,s=t.segmentNumber,u=void 0===s?30:s,l=t.thetaOffset,c=void 0===l?.314:l,p=0,h=[0,0,0,0],f=[0,0,0,0];return r&&i&&(h=(0,T.rgb2arr)(r),f=(0,T.rgb2arr)(i),p=1),{u_thetaOffset:c,u_opacity:Number(n),segmentNumber:u,u_blur:.9,u_lineDir:a?1:-1,u_linearColor:p,u_sourceColor:h,u_targetColor:f}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig().animateOption;return{u_aimate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var t=this.layer.getLayerConfig().segmentNumber,e=void 0===t?30:t;return[this.layer.buildLayerModel({moduleName:"arc2dminiline",vertexShader:'#define Animate 0.0\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nvarying vec4 v_color;\n\nuniform float u_lineDir: 1.0;\n\n// 偏移量\nuniform float u_thetaOffset: 0.314;\n\nuniform float u_opacity: 1.0;\nvarying float v_distance_ratio;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1. - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = u_thetaOffset;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\n  if(u_lineDir == 1.0) { // 正向\n    return mid;\n  } else { // 逆向\n    // (mid + vmin)/2 = (s + t)/2\n    vec2 vmid = source + target - mid;\n    return vmid;\n  }\n  // return mid;\n}\nfloat getSegmentRatio(float index) {\n    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n}\nvec2 interpolate (vec2 source, vec2 target, float t) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  vec2 mid = midPoint(source, target);\n  vec3 x = vec3(source.x, mid.x, target.x);\n  vec3 y = vec3(source.y, mid.y, target.y);\n  return vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nvoid main() {\n  v_color = a_Color;\n  \n  vec2 source = a_Instance.rg;  // 起始点\n  vec2 target =  a_Instance.ba; // 终点\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n\n  v_distance_ratio = segmentIndex / segmentNumber;\n  \n  if(u_aimate.x == Animate && u_lineDir != 1.0) {\n      v_distance_ratio = 1.0 - v_distance_ratio;\n  }\n\n  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));\n  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n  //unProjCustomCoord\n  \n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n  }\n}\n',fragmentShader:'#define Animate 0.0\n\nuniform float u_opacity;\nuniform float u_blur : 0.9;\n// varying vec2 v_normal;\nvarying vec4 v_color;\n\nuniform float u_time;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\n\nuniform float segmentNumber;\nvarying float v_distance_ratio;\n\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\n#pragma include "picking"\n\nvoid main() {\n\n  // 设置弧线的底色\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);\n  } else { // 使用 color 方法传入的颜色\n     gl_FragColor = v_color;\n  }\n  \n \n  gl_FragColor.a *= u_opacity;\n\n  if(u_aimate.x == Animate) {\n      float animateSpeed = u_time / u_aimate.y; // 运动速度\n      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);\n      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      gl_FragColor.a *= alpha;\n  }\n}',triangulation:ce,depth:{enable:!1},blend:this.getBlend(),segmentNumber:e})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e,n,r){var i=t.size,o=void 0===i?1:i;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:i.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:4,update:function(t,e,n,r){return[n[3],n[4],n[5],n[6]]}}})}}]),n}(dt);function on(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var an={solid:0,dash:1},sn=function(t){(0,u.Z)(n,t);var e=on(n);function n(){var t;(0,o.Z)(this,n);for(var r=arguments.length,a=new Array(r),u=0;u<r;u++)a[u]=arguments[u];return t=e.call.apply(e,[this].concat(a)),(0,p.Z)((0,s.Z)(t),"texture",void 0),(0,p.Z)((0,s.Z)(t),"updateTexture",(function(){var e=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=e({data:t.iconService.getCanvas(),mag:i.gl.NEAREST,min:i.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return(0,a.Z)(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.sourceColor,o=t.targetColor,a=t.textureBlend,s=void 0===a?"normal":a,u=t.lineType,l=void 0===u?"solid":u,c=t.dashArray,p=void 0===c?[10,5]:c,h=t.lineTexture,f=void 0!==h&&h,d=t.iconStep,v=void 0===d?100:d,m=t.segmentNumber,y=void 0===m?30:m;2===p.length&&p.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var g=0,_=[0,0,0,0],x=[0,0,0,0];if(r&&o&&(_=(0,T.rgb2arr)(r),x=(0,T.rgb2arr)(o),g=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n})){this.judgeStyleAttributes({opacity:n});var b=this.layer.getEncodedData(),w=this.calDataFrame(this.cellLength,b,this.cellProperties),S=w.data,E=w.width,C=w.height;this.rowCount=C,this.dataTexture=this.cellLength>0&&S.length>0?this.createTexture2D({flipY:!0,data:S,format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:E,height:C}):this.createTexture2D({flipY:!0,data:[1],format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(n),u_textureBlend:"normal"===s?0:1,segmentNumber:y,u_line_type:an[l]||0,u_dash_array:p,u_texture:this.texture,u_line_texture:f?1:0,u_icon_step:v,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:g,u_sourceColor:_,u_targetColor:x}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig().animateOption;return{u_aimate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var t,e;null===(t=this.texture)||void 0===t||t.destroy(),null===(e=this.dataTexture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var t=this.layer.getLayerConfig(),e=t.mask,n=void 0!==e&&e,r=t.maskInside,i=void 0===r||r;return[this.layer.buildLayerModel({moduleName:"greatcircleline",vertexShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nvarying vec4 v_color;\n// varying vec2 v_normal;\n\nvarying float v_distance_ratio;\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nvarying vec4 v_dash_array;\n\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\n\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\n\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n    vec2 x = mix(source, target, ratio);\n    vec2 center = mix(source, target, 0.5);\n    float dSourceCenter = distance(source, center);\n    float dXCenter = distance(x, center);\n    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n     float vertex_height = paraboloid(source, target, segmentRatio);\n\n    return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n    );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\nfloat getAngularDist (vec2 source, vec2 target) {\n  vec2 delta = source - target;\n  vec2 sin_half_delta = sin(delta / 2.0);\n  float a =\n    sin_half_delta.y * sin_half_delta.y +\n    cos(source.y) * cos(target.y) *\n    sin_half_delta.x * sin_half_delta.x;\n  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));\n}\n\nvec2 midPoint(vec2 source, vec2 target) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = 0.314;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\n  return mid;\n}\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1. - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\n\nvec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    vec2 mid = midPoint(source, target);\n    vec3 x = vec3(source.x, mid.x, target.x);\n    vec3 y = vec3(source.y, mid.y, target.y);\n    return vec2(bezier3(x ,t), bezier3(y,t));\n  }else {\n    if(abs(angularDist - PI) < 0.001) {\n      return (1.0 - t) * source + t * target;\n    }\n    float a = sin((1.0 - t) * angularDist) / sin(angularDist);\n    float b = sin(t * angularDist) / sin(angularDist);\n    vec2 sin_source = sin(source);\n    vec2 cos_source = cos(source);\n    vec2 sin_target = sin(target);\n    vec2 cos_target = cos(target);\n    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;\n    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;\n    float z = a * sin_source.y + b * sin_target.y;\n    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));\n  }\n}\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0  // dataset 数据集\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n  v_color = a_Color;\n  vec2 source = radians(a_Instance.rg);\n  vec2 target = radians(a_Instance.ba);\n  float angularDist = getAngularDist(source, target);\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  if(u_line_type == LineTypeDash) {\n    v_distance_ratio = segmentIndex / segmentNumber;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    total_Distance = total_Distance*8.0;\n    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n  }\n  if(u_aimate.x == Animate) {\n      v_distance_ratio = segmentIndex / segmentNumber;\n  }\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  v_distance_ratio = segmentIndex / segmentNumber;\n  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));\n  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));\n\n  styleMappingMat[3].g = a_Position.x; // 该顶点在弧线上的分段排序\n  if(LineTexture == u_line_texture) { // 开启贴图模式  \n    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;\n    float d_arcDistrance = length(source - target);\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap\n      d_arcDistrance = d_arcDistrance * 1000000.0;\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox\n      d_arcDistrance = project_pixel_allmap(d_arcDistrance);\n    }\n    float d_pixelLen = project_pixel(u_icon_step)/8.0;\n    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // 贴图在弧线上重复的数量\n\n    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size);  // 定点位置偏移，按地图等级缩放后的距离\n    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // 线图层贴图部分的 v 坐标值\n\n    v_iconMapUV = a_iconMapUV;\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));\n  }\n  setPickingColor(a_PickingColor);\n}\n\n',fragmentShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform float u_opacity;\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\n// varying vec2 v_normal;\nvarying vec4 v_dash_array;\nvarying float v_distance_ratio;\nvarying vec4 v_color;\n\nuniform float u_time;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\n\nuniform float u_line_texture: 0.0;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nuniform float segmentNumber;\n\nvarying vec2 v_iconMapUV;\n\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\nvarying mat4 styleMappingMat;\n\n#pragma include "picking"\n#pragma include "project"\n#pragma include "projection"\n\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  float animateSpeed = 0.0;\n  float d_segmentIndex = styleMappingMat[3].g;\n  \n  // 设置弧线的底色\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);\n  } else { // 使用 color 方法传入的颜色\n     gl_FragColor = v_color;\n  }\n\n  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));\n  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));\n  gl_FragColor.a *= opacity;\n  if(u_line_type == LineTypeDash) {\n   float flag = 0.;\n    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n      flag = 1.;\n    }\n    gl_FragColor.a *=flag;\n  }\n\n  // 设置弧线的动画模式\n  if(u_aimate.x == Animate) {\n      animateSpeed = u_time / u_aimate.y;\n      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);\n      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;\n      alpha = smoothstep(0., 1., alpha);\n      gl_FragColor.a *= alpha;\n  }\n\n  // 设置弧线的贴图\n  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { \n    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));\n    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);\n    float count = styleMappingMat[3].b; // 贴图在弧线上重复的数量\n    float u = fract(arcRadio * count - animateSpeed * count);\n    // float u = fract(arcRadio * count - animateSpeed);\n    if(u_aimate.x == Animate) {\n      u = gl_FragColor.a/opacity;\n    }\n\n    float v = styleMappingMat[3].a; // 线图层贴图部分的 v 坐标值\n\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture2D(u_texture, uv);\n    \n    // 设置贴图和底色的叠加模式\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        gl_FragColor = filterColor(pattern);\n    }\n  } else {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n\n  // gl_FragColor = filterColor(gl_FragColor);\n}',triangulation:ce,depth:{enable:!1},blend:this.getBlend(),stencil:(0,T.getMask)(n,i)})]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e,n,r){var i=t.size,o=void 0===i?1:i;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:i.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:4,update:function(t,e,n,r){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(e,n,r,i){var o=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[o.x,o.y]}}})}}]),n}(dt);function un(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var ln='\n#define Animate 0.0\n\nattribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\n\nattribute vec2 a_iconMapUV;\n\n// dash line\nattribute float a_Total_Distance;\nattribute vec2 a_DistanceAndIndex;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nuniform float u_icon_step: 100;\n\nuniform float u_heightfixed: 0.0;\nuniform float u_vertexScale: 1.0;\nuniform float u_raisingHeight: 0.0;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvarying vec4 v_color;\n\n// texV 线图层 - 贴图部分的 v 坐标（线的宽度方向）\nvarying vec2 v_iconMapUV;\n\n\nuniform float u_linearColor: 0;\nuniform float u_arrow: 0.0;\nuniform float u_arrowHeight: 3.0;\nuniform float u_arrowWidth: 2.0;\nuniform float u_tailWidth: 1.0;\n\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\nvec2 calculateArrow(vec2 offset) {\n  /*\n  * 在支持箭头的时候，第二、第三组顶点是额外插入用于构建顶点的\n  */\n  float arrowFlag = -1.0;\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // 高德 2.0 的旋转角度不同\n    arrowFlag = 1.0;\n  }\n  float pi = arrowFlag * 3.1415926/2.;\n  if(a_Miter < 0.) {\n    // 根据线的两侧偏移不同、旋转的方向相反\n    pi = -pi;\n  }\n  highp float angle_sin = sin(pi);\n  highp float angle_cos = cos(pi);\n  // 计算垂直与线方向的旋转矩阵\n  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n  float arrowWidth = u_arrowWidth;\n  float arrowHeight = u_arrowHeight;\n\n  vec2 arrowOffset = vec2(0.0);\n  /*\n  * a_DistanceAndIndex.y 用于标记当前顶点属于哪一组（两个顶点一组，构成线的其实是矩形，最简需要四个顶点、两组顶点构成）\n  */\n  if(a_DistanceAndIndex.y == 0.0) {\n    // 箭头尖部\n    offset = vec2(0.0);\n  } else if(a_DistanceAndIndex.y == 1.0) {\n    // 箭头两侧\n    arrowOffset = rotation_matrix*(offset * arrowHeight);\n    offset += arrowOffset; // 沿线偏移\n    offset = offset * arrowWidth; // 垂直线向外偏移（是构建箭头两侧的顶点）\n  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {\n    // 偏移其余的点位（将长度让位给箭头）\n    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;\n    offset += arrowOffset;// 沿线偏移\n  }\n\n  return offset;\n}\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n  float d_texPixelLen;    // 贴图的像素长度，根据地图层级缩放\n\n  v_iconMapUV = a_iconMapUV;\n  d_texPixelLen = project_float_pixel(u_icon_step);\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    d_texPixelLen *= 10.0;\n  }\n\n  v_color = a_Color;\n\n  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\n  \n  vec2 offset = project_pixel(size.xy);\n\n  float lineDistance = a_DistanceAndIndex.x;\n  float currentLinePointRatio = lineDistance / a_Total_Distance;\n \n  if(u_arrow > 0.0) {\n      //  计算箭头\n    offset = calculateArrow(offset);\n\n    if(a_DistanceAndIndex.y > 4.0) {\n      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);\n    }\n  }\n\n  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // 线横向偏移的距离（向两侧偏移的和）\n  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // 定点位置偏移，按地图等级缩放后的距离 单侧 * 2\n  float texV = lineOffsetWidth/linePixelSize; // 线图层贴图部分的 v 坐标值\n\n  // 设置数据集的参数\n  styleMappingMat[3][0] = currentLinePointRatio; // 当前点位距离占线总长的比例\n  styleMappingMat[3][1] = lineDistance;       // 当前顶点的距离\n  styleMappingMat[3][2] = d_texPixelLen;    // 贴图的像素长度，根据地图层级缩放\n  styleMappingMat[3][3] = texV;             // 线图层贴图部分的 v 坐标值\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));\n\n  float h = float(a_Position.z) * u_vertexScale; // 线顶点的高度 - 兼容不存在第三个数值的情况 vertex height\n  float lineHeight = a_Size.y; // size 第二个参数代表的高度 [linewidth, lineheight]\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    lineHeight *= 0.2; // 保持和 amap/mapbox 一致的效果\n    h *= 0.2;\n    if(u_heightfixed < 1.0) {\n      lineHeight = project_pixel(a_Size.y);\n    }\n    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));\n  } else {\n    // mapbox -  amap\n    \n    // 兼容 mapbox 在线高度上的效果表现基本一致\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      // mapbox\n      // 保持高度相对不变\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      h *= mapboxZoomScale;\n      h += u_raisingHeight * mapboxZoomScale;\n      if(u_heightfixed > 0.0) {\n        lineHeight *= mapboxZoomScale;\n      }\n      \n    } else {\n      // amap\n      h += u_raisingHeight;\n      // lineHeight 顶点偏移高度\n      if(u_heightfixed < 1.0) {\n        lineHeight *= pow(2.0, 20.0 - u_Zoom);\n      }\n    }\n\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',cn={solid:0,dash:1},pn=function(t){(0,u.Z)(n,t);var e=un(n);function n(){var t;(0,o.Z)(this,n);for(var r=arguments.length,a=new Array(r),u=0;u<r;u++)a[u]=arguments[u];return t=e.call.apply(e,[this].concat(a)),(0,p.Z)((0,s.Z)(t),"texture",void 0),(0,p.Z)((0,s.Z)(t),"updateTexture",(function(){var e=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=e({data:t.iconService.getCanvas(),mag:i.gl.NEAREST,min:i.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return(0,a.Z)(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.sourceColor,o=t.targetColor,a=t.textureBlend,s=void 0===a?"normal":a,u=t.lineType,l=void 0===u?"solid":u,c=t.dashArray,p=void 0===c?[10,5,0,0]:c,h=t.lineTexture,f=void 0!==h&&h,d=t.iconStep,v=void 0===d?100:d,m=t.vertexHeightScale,y=void 0===m?20:m,g=t.borderWidth,_=void 0===g?0:g,x=t.borderColor,b=void 0===x?"#ccc":x,w=t.raisingHeight,S=void 0===w?0:w,E=t.heightfixed,C=void 0!==E&&E,A=t.arrow,M=void 0===A?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:A;2===p.length&&p.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var k=0,P=[0,0,0,0],O=[0,0,0,0];if(r&&o&&(P=(0,T.rgb2arr)(r),O=(0,T.rgb2arr)(o),k=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n})){this.judgeStyleAttributes({opacity:n});var L=this.layer.getEncodedData(),I=this.calDataFrame(this.cellLength,L,this.cellProperties),R=I.data,D=I.width,N=I.height;this.rowCount=N,this.dataTexture=this.cellLength>0&&R.length>0?this.createTexture2D({flipY:!0,data:R,format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:D,height:N}):this.createTexture2D({flipY:!0,data:[1],format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(n),u_textureBlend:"normal"===s?0:1,u_line_type:cn[l],u_dash_array:p,u_texture:this.texture,u_line_texture:f?1:0,u_icon_step:v,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:_,u_borderColor:(0,T.rgb2arr)(b),u_linearColor:k,u_sourceColor:P,u_targetColor:O,u_heightfixed:Number(C),u_vertexScale:y,u_raisingHeight:Number(S),u_arrow:Number(M.enable),u_arrowHeight:M.arrowHeight||3,u_arrowWidth:M.arrowWidth||2,u_tailWidth:void 0===M.tailWidth?1:M.tailWidth}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig().animateOption;return{u_aimate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var t,e;null===(t=this.texture)||void 0===t||t.destroy(),null===(e=this.dataTexture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var t=this.layer.getLayerConfig(),e=t.mask,n=void 0!==e&&e,r=t.maskInside,o=void 0===r||r,a=t.depth,s=void 0!==a&&a,u=this.getShaders(),l=u.frag,c=u.vert,p=u.type;return this.layer.triangulation=ne,[this.layer.buildLayerModel({moduleName:"line_"+p,vertexShader:c,fragmentShader:l,triangulation:ne,primitive:i.gl.TRIANGLES,blend:this.getBlend(),depth:{enable:s},stencil:(0,T.getMask)(n,o)})]}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),e=t.sourceColor,n=t.targetColor;return"dash"===t.lineType?{frag:'#define LineTypeSolid 0.0\nuniform float u_opacity : 1.0;\n\nvarying vec4 v_color;\n\n// dash\nvarying vec4 v_dash_array;\n\n#pragma include "picking"\n\nuniform float u_time;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // 控制运动\n\nvarying mat4 styleMappingMat;\n// [animate, duration, interval, trailLength],\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  float d_distance_ratio = styleMappingMat[3].r; // 当前点位距离占线总长的比例\n  gl_FragColor = v_color;\n  gl_FragColor.a *= opacity; // 全局透明度\n // dash line\n \n  float flag = 0.;\n  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n    flag = 1.;\n  }\n  gl_FragColor.a *=flag;\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n\nattribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\n\nattribute vec2 a_iconMapUV;\n\n// dash line\nattribute float a_Total_Distance;\nattribute vec2 a_DistanceAndIndex;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\n\nuniform float u_vertexScale: 1.0;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvarying vec4 v_color;\nvarying vec4 v_dash_array;\n\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;\n  v_color = a_Color;\n\n  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\n  vec2 offset = project_pixel(size.xy);\n\n  // 设置数据集的参数\n  styleMappingMat[3][0] = a_DistanceAndIndex.x / a_Total_Distance; // 当前点位距离占线总长的比例\n  styleMappingMat[3][1] = a_DistanceAndIndex.x;       // 当前顶点的距离\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));\n  } else {\n    float lineHeight = a_Size.y;\n \n    // #define COORDINATE_SYSTEM_P20 5.0\n    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0\n    // amap1.x\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n      // 保持高度相对不变\n      lineHeight *= pow(2.0, 20.0 - u_Zoom);\n    }\n\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',type:"dash"}:e&&n?{frag:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nuniform float u_blur : 0.99;\nuniform float u_line_type: 0.0;\nuniform float u_opacity : 1.0;\n\nvarying vec4 v_color;\n\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\n#pragma include "picking"\n\n\nvarying mat4 styleMappingMat;\n// [animate, duration, interval, trailLength],\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  float d_distance_ratio = styleMappingMat[3].r; // 当前点位距离占线总长的比例\n\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);\n  } else { // 使用 color 方法传入的颜色\n     gl_FragColor = v_color;\n  }\n\n  gl_FragColor.a *= opacity; // 全局透明度\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:ln,type:"linear"}:{frag:'#define Animate 0.0\n#define LineTexture 1.0\nuniform float u_blur : 0.99;\nuniform float u_opacity : 1.0;\nuniform float u_textureBlend;\n\nuniform float u_borderWidth: 0.0;\nuniform vec4 u_borderColor;\nvarying vec4 v_color;\n\n// line texture\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\n\nvarying vec2 v_iconMapUV;\n\n#pragma include "picking"\n\nuniform float u_time;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // 控制运动\n\nvarying mat4 styleMappingMat;\n// [animate, duration, interval, trailLength],\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = styleMappingMat[3].r; // 当前点位距离占线总长的比例\n  gl_FragColor = v_color;\n  // anti-alias\n  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));\n  gl_FragColor.a *= opacity; // 全局透明度\n  if(u_aimate.x == Animate) {\n      animateSpeed = u_time / u_aimate.y;\n       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);\n      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;\n      alpha = smoothstep(0., 1., alpha);\n      gl_FragColor.a *= alpha;\n  }\n\n  if(u_line_texture == LineTexture) { // while load texture\n    float aDistance = styleMappingMat[3].g;      // 当前顶点的距离\n    float d_texPixelLen = styleMappingMat[3].b;  // 贴图的像素长度，根据地图层级缩放\n    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);\n    float v = styleMappingMat[3].a;  // 线图层贴图部分的 v 坐标值\n\n    // v = max(smoothstep(0.95, 1.0, v), v);\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    \n    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));\n    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));\n     vec4 pattern = texture2D(u_texture, uv);\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor += pattern;\n    } else { // replace\n        pattern.a *= opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        gl_FragColor = pattern;\n    }\n  } \n\n  float v = styleMappingMat[3].a;\n  float borderWidth = min(0.5, u_borderWidth);\n  // 绘制 border\n  if(borderWidth > 0.01) {\n    float borderOuterWidth = borderWidth/2.0;\n\n    if(v >= 1.0 - borderWidth || v <= borderWidth) {\n      if(v > borderWidth) {\n        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);\n        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);\n      } else if(v <= borderWidth) {\n        float linear = smoothstep(0.0, 1.0, v/borderWidth);\n        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);\n      }\n    }\n\n    if(v < borderOuterWidth) {\n      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);\n    } else if(v > 1.0 - borderOuterWidth) {\n      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);\n    }\n  }\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:ln,type:"normal"}}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:i.AttributeType.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,n,r,i,o){return void 0===o?[n[3],10]:[n[3],o]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:i.AttributeType.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e,n,r){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,n,r){var i=t.size,o=void 0===i?1:i;return Array.isArray(o)?[o[0],o[1]]:[o,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:i.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:i.AttributeType.Attribute,descriptor:{name:"a_Miter",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e,n,r){return[n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(e,n,r,i){var o=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[o.x,o.y]}}})}}]),n}(dt);function hn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var fn=function(t){(0,u.Z)(n,t);var e=hn(n);function n(){var t;(0,o.Z)(this,n);for(var r=arguments.length,a=new Array(r),u=0;u<r;u++)a[u]=arguments[u];return t=e.call.apply(e,[this].concat(a)),(0,p.Z)((0,s.Z)(t),"colorTexture",void 0),(0,p.Z)((0,s.Z)(t),"updateTexture",(function(){var e=t.rendererService.createTexture2D;t.colorTexture&&t.colorTexture.destroy();var n=t.layer.getLayerConfig().rampColors,r=(0,T.generateColorRamp)(n);t.colorTexture=e({data:new Uint8Array(r.data),width:r.width,height:r.height,wrapS:i.gl.CLAMP_TO_EDGE,wrapT:i.gl.CLAMP_TO_EDGE,min:i.gl.NEAREST,mag:i.gl.NEAREST,flipY:!1})})),t}return(0,a.Z)(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.vertexHeightScale,o=void 0===r?20:r,a=t.raisingHeight,s=void 0===a?0:a,u=t.heightfixed,l=void 0!==u&&u;if(this.rendererService.getDirty()&&this.colorTexture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n})){this.judgeStyleAttributes({opacity:n});var c=this.layer.getEncodedData(),p=this.calDataFrame(this.cellLength,c,this.cellProperties),h=p.data,f=p.width,d=p.height;this.rowCount=d,this.dataTexture=this.cellLength>0&&h.length>0?this.createTexture2D({flipY:!0,data:h,format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:f,height:d}):this.createTexture2D({flipY:!0,data:[1],format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(n),u_texture:this.colorTexture,u_heightfixed:Number(l),u_vertexScale:o,u_raisingHeight:Number(s)}}},{key:"initModels",value:function(){return this.updateTexture(),this.buildModels()}},{key:"clearModels",value:function(){var t,e;null===(t=this.colorTexture)||void 0===t||t.destroy(),null===(e=this.dataTexture)||void 0===e||e.destroy()}},{key:"buildModels",value:function(){var t=this.layer.getLayerConfig(),e=t.mask,n=void 0!==e&&e,r=t.maskInside,o=void 0===r||r,a=t.depth,s=void 0!==a&&a,u=this.getShaders(),l=u.frag,c=u.vert,p=u.type;return this.layer.triangulation=ne,[this.layer.buildLayerModel({moduleName:"line_"+p,vertexShader:c,fragmentShader:l,triangulation:ne,primitive:i.gl.TRIANGLES,blend:this.getBlend(),depth:{enable:s},stencil:(0,T.getMask)(n,o)})]}},{key:"getShaders",value:function(){return{frag:'uniform float u_opacity : 1.0;\nuniform sampler2D u_texture;\n\n#pragma include "picking"\n\nvarying mat4 styleMappingMat;\n\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  float d_distance_ratio = styleMappingMat[3].r; // 当前点位距离占线总长的比例\n\n  gl_FragColor = texture2D(u_texture, vec2(d_distance_ratio, 0.5));\n\n  gl_FragColor.a *= opacity; // 全局透明度\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'\nattribute float a_Miter;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\n\n// dash line\nattribute float a_Total_Distance;\nattribute vec2 a_DistanceAndIndex;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nuniform float u_heightfixed: 0.0;\nuniform float u_vertexScale: 1.0;\nuniform float u_raisingHeight: 0.0;\n\nuniform float u_opacity: 1.0;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\n  \n  vec2 offset = project_pixel(size.xy);\n\n  float lineDistance = a_DistanceAndIndex.x;\n  float currentLinePointRatio = lineDistance / a_Total_Distance;\n \n\n  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // 线横向偏移的距离（向两侧偏移的和）\n  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // 定点位置偏移，按地图等级缩放后的距离 单侧 * 2\n  float texV = lineOffsetWidth/linePixelSize; // 线图层贴图部分的 v 坐标值\n\n  // 设置数据集的参数\n  styleMappingMat[3][0] = currentLinePointRatio; // 当前点位距离占线总长的比例\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));\n\n  float h = float(a_Position.z) * u_vertexScale; // 线顶点的高度 - 兼容不存在第三个数值的情况 vertex height\n  float lineHeight = a_Size.y; // size 第二个参数代表的高度 [linewidth, lineheight]\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    lineHeight *= 0.2; // 保持和 amap/mapbox 一致的效果\n    h *= 0.2;\n    if(u_heightfixed < 1.0) {\n      lineHeight = project_pixel(a_Size.y);\n    }\n    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));\n  } else {\n    // mapbox -  amap\n    \n    // 兼容 mapbox 在线高度上的效果表现基本一致\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      // mapbox\n      // 保持高度相对不变\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      h *= mapboxZoomScale;\n      h += u_raisingHeight * mapboxZoomScale;\n      if(u_heightfixed > 0.0) {\n        lineHeight *= mapboxZoomScale;\n      }\n      \n    } else {\n      // amap\n      h += u_raisingHeight;\n      // lineHeight 顶点偏移高度\n      if(u_heightfixed < 1.0) {\n        lineHeight *= pow(2.0, 20.0 - u_Zoom);\n      }\n    }\n\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',type:"linear_rampColors"}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:i.AttributeType.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,n,r,i,o){return void 0===o?[n[3],10]:[n[3],o]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:i.AttributeType.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e,n,r){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,n,r){var i=t.size,o=void 0===i?1:i;return Array.isArray(o)?[o[0],o[1]]:[o,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:i.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:i.AttributeType.Attribute,descriptor:{name:"a_Miter",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e,n,r){return[n[4]]}}})}}]),n}(dt);function dn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var vn='attribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Position;\n\nattribute float a_Total_Distance;\nattribute float a_Distance;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nuniform float u_opacity: 1.0;\nuniform float u_vertexScale: 1.0;\n\n#pragma include "projection"\n\nvarying vec4 v_color;\n\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n  float d_distance_ratio; // 当前点位距离占线总长的比例\n  v_color = a_Color;  \n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  float h = float(a_Position.z) * u_vertexScale; // 线顶点的高度 - 兼容不存在第三个数值的情况\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));\n  } else {\n    float lineHeight = a_Size.y;\n    // 兼容 mapbox 在线高度上的效果表现基本一致\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      // 保持高度相对不变\n      h *= 2.0/pow(2.0, 20.0 - u_Zoom);\n    }\n\n    // #define COORDINATE_SYSTEM_P20 5.0\n    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0\n    // amap1.x\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n      // 保持高度相对不变\n      lineHeight *= pow(2.0, 20.0 - u_Zoom);\n    }\n\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));\n  }\n}\n',mn=function(t){(0,u.Z)(n,t);var e=dn(n);function n(){return(0,o.Z)(this,n),e.apply(this,arguments)}return(0,a.Z)(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.sourceColor,o=t.targetColor,a=t.vertexHeightScale,s=void 0===a?20:a,u=0,l=[0,0,0,0],c=[0,0,0,0];if(r&&o&&(l=(0,T.rgb2arr)(r),c=(0,T.rgb2arr)(o),u=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n})){this.judgeStyleAttributes({opacity:n});var p=this.layer.getEncodedData(),h=this.calDataFrame(this.cellLength,p,this.cellProperties),f=h.data,d=h.width,v=h.height;this.rowCount=v,this.dataTexture=this.cellLength>0&&f.length>0?this.createTexture2D({flipY:!0,data:f,format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:d,height:v}):this.createTexture2D({flipY:!0,data:[1],format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(n),u_linearColor:u,u_sourceColor:l,u_targetColor:c,u_vertexScale:s}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig().animateOption;return{u_aimate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"clearModels",value:function(){var t;null===(t=this.dataTexture)||void 0===t||t.destroy()}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),e=t.sourceColor,n=t.targetColor;return e&&n?{frag:"uniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\nvarying mat4 styleMappingMat;\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  float d_distance_ratio = styleMappingMat[3].r; // 当前点位距离占线总长的比例\n\n  gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);\n  gl_FragColor.a *= opacity; // 全局透明度\n}\n",vert:vn,type:"simple_linear"}:{frag:"\nvarying vec4 v_color;\nvarying mat4 styleMappingMat;\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  float d_distance_ratio = styleMappingMat[3].r; // 当前点位距离占线总长的比例\n\n  gl_FragColor = v_color;\n  gl_FragColor.a *= opacity; // 全局透明度\n}\n",vert:vn,type:"simple_normal"}}},{key:"buildModels",value:function(){var t=this.layer.getLayerConfig(),e=t.mask,n=void 0!==e&&e,r=t.maskInside,o=void 0===r||r,a=this.getShaders(),s=a.frag,u=a.vert,l=a.type;return[this.layer.buildLayerModel({moduleName:l,vertexShader:u,fragmentShader:s,triangulation:re,primitive:i.gl.LINES,blend:this.getBlend(),depth:{enable:!1},stencil:(0,T.getMask)(n,o)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:i.AttributeType.Attribute,descriptor:{name:"a_Distance",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e,n,r){return[n[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:i.AttributeType.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e,n,r){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,n,r){var i=t.size,o=void 0===i?1:i;return Array.isArray(o)?[o[0],o[1]]:[o,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:i.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:i.AttributeType.Attribute,descriptor:{name:"a_Miter",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e,n,r){return[n[4]]}}})}}]),n}(dt);function yn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var gn=function(t){(0,u.Z)(n,t);var e=yn(n);function n(){var t;(0,o.Z)(this,n);for(var r=arguments.length,a=new Array(r),u=0;u<r;u++)a[u]=arguments[u];return t=e.call.apply(e,[this].concat(a)),(0,p.Z)((0,s.Z)(t),"texture",void 0),(0,p.Z)((0,s.Z)(t),"updateTexture",(function(){var e=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=e({data:t.iconService.getCanvas(),mag:i.gl.NEAREST,min:i.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return(0,a.Z)(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.sourceColor,o=t.targetColor,a=t.textureBlend,s=void 0===a?"normal":a,u=t.heightfixed,l=void 0!==u&&u,c=t.lineTexture,p=void 0!==c&&c,h=t.iconStep,f=void 0===h?100:h,d=t.iconStepCount,v=void 0===d?1:d;this.rendererService.getDirty()&&this.texture.bind();var m=0,y=[0,0,0,0],g=[0,0,0,0];if(r&&o&&(y=(0,T.rgb2arr)(r),g=(0,T.rgb2arr)(o),m=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n})){this.judgeStyleAttributes({opacity:n});var _=this.layer.getEncodedData(),x=this.calDataFrame(this.cellLength,_,this.cellProperties),b=x.data,w=x.width,S=x.height;this.rowCount=S,this.dataTexture=this.cellLength>0&&b.length>0?this.createTexture2D({flipY:!0,data:b,format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:w,height:S}):this.createTexture2D({flipY:!0,data:[1],format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:1,height:1})}return{u_heightfixed:Number(l),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(n),u_textureBlend:"normal"===s?0:1,u_texture:this.texture,u_line_texture:p?1:0,u_iconStepCount:v,u_icon_step:f,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:m,u_sourceColor:y,u_targetColor:g}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig().animateOption;return{u_aimate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var t,e;null===(t=this.texture)||void 0===t||t.destroy(),null===(e=this.dataTexture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"linewall",vertexShader:'#define Animate 0.0\n\nattribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\nattribute vec2 a_iconMapUV;\n\nattribute float a_Total_Distance;\nattribute float a_Distance;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nuniform float u_icon_step: 100;\nuniform float u_heightfixed;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvarying vec4 v_color;\nvarying float v_blur;\n\n// texV 线图层 - 贴图部分的 v 坐标（线的宽度方向）\nvarying vec2 v_iconMapUV;\n\nuniform float u_linearColor: 0;\n\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "light"\n#pragma include "styleMappingCalOpacity"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n  float d_distance_ratio; // 当前点位距离占线总长的比例\n  float d_texPixelLen;    // 贴图的像素长度，根据地图层级缩放\n\n  v_iconMapUV = a_iconMapUV;\n  if(u_heightfixed < 1.0) {     // 高度随 zoom 调整\n    d_texPixelLen = project_pixel(u_icon_step);\n  } else {\n    d_texPixelLen = u_icon_step;\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    d_texPixelLen *= 10.0;\n  }\n\n  if(u_aimate.x == Animate || u_linearColor == 1.0) {\n      d_distance_ratio = a_Distance / a_Total_Distance;\n  }\n\n  float miter = (a_Miter + 1.0)/2.0;\n  // 设置数据集的参数\n  styleMappingMat[3][0] = d_distance_ratio; // 当前点位距离占线总长的比例\n  styleMappingMat[3][1] = a_Distance;       // 当前顶点的距离\n  styleMappingMat[3][2] = d_texPixelLen;    // 贴图的像素长度，根据地图层级缩放\n  styleMappingMat[3][3] = miter;          // 线图层贴图部分的 v 坐标值 0 - 1\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  float originSize = a_Size.x;  // 固定高度\n  if(u_heightfixed < 1.0) {     // 高度随 zoom 调整\n    originSize = project_float_pixel(a_Size.x);\n  }\n\n  float wallHeight = originSize * miter;\n  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));\n\n  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);\n\n  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);\n  // v_color = a_Color;\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'#define Animate 0.0\n#define LineTexture 1.0\n\nuniform float u_opacity : 1.0;\nuniform float u_textureBlend;\nuniform float u_iconStepCount;\n\nvarying vec4 v_color;\n\n// line texture\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\n\nvarying vec2 v_iconMapUV;\nvarying float v_blur;\n\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\n#pragma include "picking"\n\nuniform float u_time;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // 控制运动\n\nvarying mat4 styleMappingMat;\n// [animate, duration, interval, trailLength],\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = styleMappingMat[3].r; // 当前点位距离占线总长的比例\n  float v = styleMappingMat[3].a;\n\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    gl_FragColor = mix(u_sourceColor, u_targetColor, v);\n  } else { // 使用 color 方法传入的颜色\n     gl_FragColor = v_color;\n  }\n\n  gl_FragColor.a *= opacity; // 全局透明度\n  if(u_aimate.x == Animate) {\n      animateSpeed = u_time / u_aimate.y;\n       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);\n      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;\n      alpha = smoothstep(0., 1., alpha);\n      gl_FragColor.a *= alpha;\n  }\n\n  if(u_line_texture == LineTexture) { // while load texture\n    float aDistance = styleMappingMat[3].g;      // 当前顶点的距离\n    float d_texPixelLen = styleMappingMat[3].b;  // 贴图的像素长度，根据地图层级缩放\n    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);\n    float v = styleMappingMat[3].a;  // 线图层贴图部分的 v 坐标值\n\n    // 计算纹理间隔 start\n    float flag = 0.0;\n    if(u > 1.0/u_iconStepCount) {\n      flag = 1.0;\n    }\n    u = fract(u*u_iconStepCount);\n    // 计算纹理间隔 end\n\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture2D(u_texture, uv);\n\n    // Tip: 判断纹理间隔\n    if(flag > 0.0) {\n      pattern = vec4(0.0);\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        gl_FragColor = filterColor(pattern);\n    }\n  }\n  \n\n  // blur - AA\n  if(v < v_blur) {\n    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);\n  } else if(v > 1.0 - v_blur) {\n    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);\n  }\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:ne,primitive:i.gl.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:i.AttributeType.Attribute,descriptor:{name:"a_Distance",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e,n,r){return[n[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:i.AttributeType.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e,n,r){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,n,r){var i=t.size,o=void 0===i?1:i;return Array.isArray(o)?[o[0],o[1]]:[o,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:i.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:i.AttributeType.Attribute,descriptor:{name:"a_Miter",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e,n,r){return[n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(e,n,r,i){var o=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[o.x,o.y]}}})}}]),n}(dt),_n={arc:Je,arcmini:rn,arc3d:en,greatcircle:sn,wall:gn,line:pn,simple:mn,linearline:fn};function xn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var bn=function(t){(0,u.Z)(n,t);var e=xn(n);function n(){var t;(0,o.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i)),(0,p.Z)((0,s.Z)(t),"type","LineLayer"),t}return(0,a.Z)(n,[{key:"buildModels",value:function(){var t=this.getModelType();this.layerModel=new _n[t](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},arcmini:{blend:"additive"},greatcircle:{blend:"additive"}}[this.getModelType()]}},{key:"getModelType",value:function(){var t,e=this.styleAttributeService.getLayerStyleAttribute("shape");return(null==e||null===(t=e.scale)||void 0===t?void 0:t.field)||"line"}}]),n}(ot);function wn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var Sn=function(t){(0,u.Z)(n,t);var e=wn(n);function n(){var t;(0,o.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i)),(0,p.Z)((0,s.Z)(t),"raiseCount",0),(0,p.Z)((0,s.Z)(t),"raiserepeat",0),t}return(0,a.Z)(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.animateOption,n=void 0===e?{enable:!1,speed:.01,repeat:!1}:e,r=t.opacity,o=void 0===r?1:r,a=t.sourceColor,s=t.targetColor,u=t.pickLight,l=void 0!==u&&u,c=t.heightfixed,p=void 0!==c&&c,h=t.opacityLinear,f=void 0===h?{enable:!1,dir:"up"}:h,d=t.lightEnable,v=void 0===d||d;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var m=this.layer.getEncodedData(),y=this.calDataFrame(this.cellLength,m,this.cellProperties),g=y.data,_=y.width,x=y.height;this.rowCount=x,this.dataTexture=this.cellLength>0&&g.length>0?this.createTexture2D({flipY:!0,data:g,format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:_,height:x}):this.createTexture2D({flipY:!0,data:[1],format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:1,height:1})}var b=0,w=[0,0,0,0],S=[0,0,0,0];if(a&&s&&(w=(0,T.rgb2arr)(a),S=(0,T.rgb2arr)(s),b=1),this.raiseCount<1&&this.raiserepeat>0&&n.enable){var E=n.speed,C=void 0===E?.01:E;n.repeat;this.raiseCount+=C,this.raiseCount>=1&&(this.raiserepeat>1?(this.raiseCount=0,this.raiserepeat--):this.raiseCount=1)}return{u_pickLight:Number(l),u_heightfixed:Number(p),u_r:n.enable&&this.raiserepeat>0?this.raiseCount:1,u_globel:"GLOBEL"===this.mapService.version?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(o),u_linearColor:b,u_sourceColor:w,u_targetColor:S,u_opacitylinear:Number(f.enable),u_opacitylinear_dir:"up"===f.dir?1:0,u_lightEnable:Number(v)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var t=this.layer.getLayerConfig(),e=t.depth,n=void 0===e||e,r=t.animateOption.repeat,i=void 0===r?1:r;return this.raiserepeat=i,[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:'precision highp float;\n\n#define pi 3.1415926535\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec3 a_Position;\nattribute vec3 a_Pos;\nattribute vec4 a_Color;\nattribute vec3 a_Size;\nattribute vec3 a_Normal;\n\nuniform float u_heightfixed: 0.0; // 默认不固定\nuniform float u_globel;\nuniform float u_r;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\n\nuniform float u_opacity : 1;\nuniform float u_lightEnable: 1;\n\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nfloat getYRadian(float x, float z) {\n  if(x > 0.0 && z > 0.0) {\n    return atan(x/z);\n  } else if(x > 0.0 && z <= 0.0){\n    return atan(-z/x) + pi/2.0;\n  } else if(x <= 0.0 && z <= 0.0) {\n    return  pi + atan(x/z); //atan(x/z) + \n  } else {\n    return atan(z/-x) + pi*3.0/2.0;\n  }\n}\n\nfloat getXRadian(float y, float r) {\n  return atan(y/r);\n}\n\nvoid main() {\n\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA - lightWeight\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - linearZ(垂直方向 0 - 1 的值)\n    0.0, 0.0, 0.0, 0.0\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n  vec3 size = a_Size * a_Position;\n\n  // a_Position.z 是在构建网格的时候传入的标准值 0 - 1，在插值器插值可以获取 0～1 线性渐变的值\n  styleMappingMat[2][3] =  a_Position.z;\n\n  vec3 offset = size; // 控制圆柱体的大小 - 从标准单位圆柱体进行偏移\n  if(u_heightfixed < 1.0) { // 圆柱体不固定高度\n    \n    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n      // P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n      offset = offset * pow(2.0, (19.0 - u_Zoom));\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n      // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));\n    }\n  } else {// 圆柱体固定高度 （ 处理 mapbox ）\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);\n    }\n  }\n\n\n  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));\n\n  // u_r 控制圆柱的生长\n  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);\n\n  // 圆柱光照效果\n  float lightWeight = 1.0;\n  if(u_lightEnable > 0.0) { // 取消三元表达式，增强健壮性\n    lightWeight = calc_lighting(pos);\n  }\n  styleMappingMat[1][3] = lightWeight;\n\n  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);\n\n  // gl_Position = project_common_position_to_clipspace(pos);\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * pos;\n  } else {\n    gl_Position = project_common_position_to_clipspace(pos);\n  }\n  \n  if(u_globel > 0.0) {\n    // 在地球模式下，将原本垂直于 xy 平面的圆柱调整姿态到适应圆的角度\n    //旋转矩阵mx，创建绕x轴旋转矩阵\n    float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);\n    float xRadian = getXRadian(a_Pos.y, r);\n    float xcos = cos(xRadian);//求解旋转角度余弦值\n    float xsin = sin(xRadian);//求解旋转角度正弦值\n    mat4 mx = mat4(\n      1,0,0,0,  \n      0,xcos,-xsin,0,  \n      0,xsin,xcos,0,  \n      0,0,0,1);\n\n    //旋转矩阵my，创建绕y轴旋转矩阵\n    float yRadian = getYRadian(a_Pos.x, a_Pos.z);\n    float ycos = cos(yRadian);//求解旋转角度余弦值\n    float ysin = sin(yRadian);//求解旋转角度正弦值\n    mat4 my = mat4(\n      ycos,0,-ysin,0,  \n      0,1,0,0,  \n      ysin,0,ycos,0,  \n      0,0,0,1);\n\n    gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'varying vec4 v_color;\nuniform float u_opacity: 1.0;\n\nuniform float u_pickLight: 0.0;\n\n#pragma include "picking"\n\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\nuniform float u_opacitylinear: 0.0;\nuniform float u_opacitylinear_dir: 1.0;\n\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  float lightWeight = styleMappingMat[1][3];\n  float barLinearZ = styleMappingMat[2][3];\n\n  // 设置圆柱的底色\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    gl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);\n    gl_FragColor.rgb *= lightWeight;\n  } else { // 使用 color 方法传入的颜色\n     gl_FragColor = v_color;\n  }\n\n  // 应用透明度\n  gl_FragColor.a *= opacity;\n\n  // 开启透明度渐变\n  if(u_opacitylinear > 0.0) {\n    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;\n  }\n\n  // picking\n  if(u_pickLight > 0.0) {\n    gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);\n  } else {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n',triangulation:te,blend:this.getBlend(),cull:{enable:!0,face:(0,T.getCullFace)(this.mapService.version)},depth:{enable:n}})]}},{key:"clearModels",value:function(){var t;null===(t=this.dataTexture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t="GLOBEL"===this.mapService.version;this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e,n,r){var i=t.size;if(i){var o=[];return Array.isArray(i)&&(o=2===i.length?[i[0],i[0],i[1]]:i),Array.isArray(i)||(o=[i,i,i]),o}return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:i.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:i.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(e,n){var r=jt(e.coordinates);return t?Tt([r[0],r[1]]):[r[0],r[1],0]}}})}}]),n}(dt);function En(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var Cn="\nuniform float u_additive;\n\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nuniform float u_time;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\n\n#pragma include \"sdf_2d\"\n#pragma include \"picking\"\n\nvoid main() {\n\n  vec4 textrueStroke = vec4(\n    styleMappingMat[1][0],\n    styleMappingMat[1][1],\n    styleMappingMat[1][2],\n    styleMappingMat[1][3]\n  );\n\n  float opacity = styleMappingMat[0][0];\n\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'\n  \n  outer_df = sdCircle(v_data.xy, 1.0);\n  inner_df = sdCircle(v_data.xy, r);\n\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  float color_t = smoothstep(\n    antialiasblur,\n    0.0,\n    inner_df\n  );\n  float PI = 3.14159;\n  float N_RINGS = 3.0;\n  float FREQ = 1.0;\n\n gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);\n\n  float d = length(v_data.xy);\n  if(d > 0.5) {\n    discard;\n  }\n  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);\n  \n  // TODO: 根据叠加模式选择效果\n  if(u_additive > 0.0) {\n    gl_FragColor *= intensity;\n    // TODO: 优化水波点 blend additive 模式下有的拾取效果 \n    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);\n  } else {\n    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n",Tn='attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nattribute float a_Shape;\n\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\nuniform float u_globel;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_isMeter;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\n\nuniform float u_opacity : 1;\nuniform float u_stroke_opacity : 1;\nuniform float u_stroke_width : 2;\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\nuniform vec2 u_offsets;\n\nuniform float u_blur : 0.0;\nuniform float u_raisingHeight: 0.0;\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "styleMappingCalStrokeOpacity"\n#pragma include "styleMappingCalStrokeWidth"\n\n#pragma include "projection"\n#pragma include "picking"\n\n\nvoid main() {\n  vec3 extrude = a_Extrude;\n  float shape_type = a_Shape;\n  float newSize = setPickingSize(a_Size);\n\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n\n  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][1] = strokeOpacityAndOffset.r;\n  textureOffset = strokeOpacityAndOffset.g;\n\n  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][2] = strokeWidthAndOffset.r;\n  textureOffset = strokeWidthAndOffset.g;\n\n  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);\n  if(hasStroke()) {\n    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R\n    textureOffset += 1.0;\n\n    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G\n    textureOffset += 1.0;\n\n    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B\n    textureOffset += 1.0;\n\n    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A\n    textureOffset += 1.0;\n  } else {\n    if(u_stroke_color == vec4(0.0)) {\n      styleMappingMat[1][0] = v_color.r;\n      styleMappingMat[1][1] = v_color.g;\n      styleMappingMat[1][2] = v_color.b;\n      styleMappingMat[1][3] = v_color.a;\n    } else {\n      styleMappingMat[1][0] = u_stroke_color.r;\n      styleMappingMat[1][1] = u_stroke_color.g;\n      styleMappingMat[1][2] = u_stroke_color.b;\n      styleMappingMat[1][3] = u_stroke_color.a;\n    }\n  }\n\n  vec2 textrueOffsets = vec2(0.0, 0.0);\n  if(hasOffsets()) {\n    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x\n    textureOffset += 1.0;\n\n    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x\n    textureOffset += 1.0;\n  } else {\n    textrueOffsets = u_offsets;\n  }\n\n  // cal style mapping\n\n  // unpack color(vec2)\n  v_color = a_Color;\n\n  // radius(16-bit)\n  v_radius = newSize;\n\n  // TODO: billboard\n  // anti-alias\n  //  float antialiased_blur = -max(u_blur, antialiasblur);\n  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);\n\n  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);\n  vec3 aPosition = a_Position;\n  if(u_isMeter < 1.0) {\n    // 不以米为实际单位\n    offset = project_pixel(offset);\n  } else {\n    // 以米为实际单位\n    antialiasblur *= pow(19.0 - u_Zoom, 2.0);\n    antialiasblur = max(antialiasblur, -0.01);\n    // offset *= 0.5;\n\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      aPosition.xy += offset;\n      offset.x = 0.0;\n      offset.y = 0.0;\n    }\n  }\n\n  // TODP: /abs(extrude.x) 是为了兼容地球模式\n  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);\n\n\n  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\n  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));\n\n  float raiseHeight = u_raisingHeight;\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n    raiseHeight = u_raisingHeight * mapboxZoomScale;\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raiseHeight, 1.0);\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, u_raisingHeight, 1.0));\n  }\n\n  if(u_globel > 0.0) {\n    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);\n  }\n \n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',An=function(t){(0,u.Z)(n,t);var e=En(n);function n(){var t;(0,o.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i)),(0,p.Z)((0,s.Z)(t),"meter2coord",1),(0,p.Z)((0,s.Z)(t),"isMeter",!1),t}return(0,a.Z)(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.strokeOpacity,o=void 0===r?1:r,a=t.strokeWidth,s=void 0===a?0:a,u=t.stroke,l=void 0===u?"rgba(0,0,0,0)":u,c=t.offsets,p=void 0===c?[0,0]:c,h=t.blend,f=t.blur,d=void 0===f?0:f,v=t.raisingHeight,m=void 0===v?0:v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n,strokeOpacity:o,strokeWidth:s,stroke:l,offsets:p})){this.judgeStyleAttributes({opacity:n,strokeOpacity:o,strokeWidth:s,stroke:l,offsets:p});var y=this.layer.getEncodedData(),g=this.calDataFrame(this.cellLength,y,this.cellProperties),_=g.data,x=g.width,b=g.height;this.rowCount=b,this.dataTexture=this.cellLength>0&&_.length>0?this.createTexture2D({flipY:!0,data:_,format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:x,height:b}):this.createTexture2D({flipY:!0,data:[1],format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(m),u_isMeter:Number(this.isMeter),u_blur:d,u_additive:"additive"===h?1:0,u_globel:this.mapService.version===Z.G.GLOBEL?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(n),u_stroke_opacity:Number(o),u_stroke_width:Number(s),u_stroke_color:this.getStrokeColor(l),u_offsets:this.isOffsetStatic(p)?p:[0,0]}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig().animateOption,e=void 0===t?{enable:!1}:t;return{u_aimate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Jt)}},{key:"initModels",value:function(){var t=this.layer.getLayerConfig().unit,e=void 0===t?"l7size":t,n=this.mapService.version;return"meter"===e&&n!==Z.G.L7MAP&&n!==Z.G.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var t=(0,B.Z)(this.layer.getSource().extent,4),e=t[0],n=t[1],r=t[2],i=t[3],o=[(e+r)/2,(n+i)/2];if(this.mapService.version===Z.G.MAPBOX&&window.mapboxgl.MercatorCoordinate){var a=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:o[0],lat:o[1]},0),s=1*a.meterInMercatorCoordinateUnits(),u=new window.mapboxgl.MercatorCoordinate(a.x-s,a.y,a.z).toLngLat();this.meter2coord=o[0]-u.lng}else{var l=this.mapService.meterToCoord(o,[e,n]),c=this.mapService.meterToCoord(o,[r===e?r+.1:r,i===n?n+.1:i]);this.meter2coord=(l+c)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}}},{key:"buildModels",value:function(){var t=this.layer.getLayerConfig(),e=t.mask,n=void 0!==e&&e,r=t.maskInside,i=void 0===r||r,o=t.animateOption,a=void 0===o?{enable:!1}:o,s=this.getShaders(a),u=s.frag,l=s.vert,c=s.type,p="GLOBEL"===this.mapService.version;return this.layer.triangulation=p?$t:Jt,[this.layer.buildLayerModel({moduleName:"pointfill_"+c,vertexShader:l,fragmentShader:u,triangulation:p?$t:Jt,depth:{enable:p},blend:this.getBlend(),stencil:(0,T.getMask)(n,i),cull:{enable:!0,face:(0,T.getCullFace)(this.mapService.version)}})]}},{key:"getShaders",value:function(t){return t.enable?(t.type,{frag:Cn,vert:Tn,type:"wave"}):{frag:"\nuniform float u_globel;\nuniform float u_additive;\n\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\n\n#pragma include \"sdf_2d\"\n#pragma include \"picking\"\n\n\nvoid main() {\n  int shape = int(floor(v_data.w + 0.5));\n\n  vec4 textrueStroke = vec4(\n    styleMappingMat[1][0],\n    styleMappingMat[1][1],\n    styleMappingMat[1][2],\n    styleMappingMat[1][3]\n  );\n\n  float opacity = styleMappingMat[0][0];\n  float stroke_opacity = styleMappingMat[0][1];\n  float strokeWidth = styleMappingMat[0][2];\n  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;\n\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius + strokeWidth);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'\n  if (shape == 0) {\n    outer_df = sdCircle(v_data.xy, 1.0);\n    inner_df = sdCircle(v_data.xy, r);\n  } else if (shape == 1) {\n    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);\n    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);\n  } else if (shape == 2) {\n    outer_df = sdBox(v_data.xy, vec2(1.));\n    inner_df = sdBox(v_data.xy, vec2(r));\n  } else if (shape == 3) {\n    outer_df = sdPentagon(v_data.xy, 0.8);\n    inner_df = sdPentagon(v_data.xy, r * 0.8);\n  } else if (shape == 4) {\n    outer_df = sdHexagon(v_data.xy, 0.8);\n    inner_df = sdHexagon(v_data.xy, r * 0.8);\n  } else if (shape == 5) {\n    outer_df = sdOctogon(v_data.xy, 1.0);\n    inner_df = sdOctogon(v_data.xy, r);\n  } else if (shape == 6) {\n    outer_df = sdHexagram(v_data.xy, 0.52);\n    inner_df = sdHexagram(v_data.xy, r * 0.52);\n  } else if (shape == 7) {\n    outer_df = sdRhombus(v_data.xy, vec2(1.0));\n    inner_df = sdRhombus(v_data.xy, vec2(r));\n  } else if (shape == 8) {\n    outer_df = sdVesica(v_data.xy, 1.1, 0.8);\n    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);\n  }\n\n  if(u_globel > 0.0) {\n    // TODO: 地球模式下避免多余片元绘制，同时也能避免有用片元在透明且重叠的情况下无法写入\n    // 付出的代价是边缘会有一些锯齿\n    if(outer_df > antialiasblur + 0.018) discard;\n  }\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(\n    antialiasblur,\n    0.0,\n    inner_df\n  );\n\n  if(strokeWidth < 0.01) {\n    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);\n  } else {\n    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);\n  }\n\n  if(u_additive > 0.0) {\n    gl_FragColor *= opacity_t;\n    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);\n  } else {\n    gl_FragColor.a *= opacity_t;\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n",vert:Tn,type:"normal"}}},{key:"clearModels",value:function(){var t;null===(t=this.dataTexture)||void 0===t||t.destroy()}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var t=this,e="GLOBEL"===this.mapService.version;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:i.AttributeType.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,n,r,i){var o;if(e){var a=(0,B.Z)(r,3),s=a[0],u=a[1],l=a[2],c=St.fromValues(0,0,1),p=St.fromValues(s,0,l),h=s>=0?St.angle(c,p):2*Math.PI-St.angle(c,p),f=2*Math.PI-Math.asin(u/100),d=wt.create();wt.rotateY(d,d,h),wt.rotateX(d,d,f);var v=St.fromValues(1,1,0);St.transformMat4(v,v,d),St.normalize(v,v);var m=St.fromValues(-1,1,0);St.transformMat4(m,m,d),St.normalize(m,m);var y=St.fromValues(-1,-1,0);St.transformMat4(y,y,d),St.normalize(y,y);var g=St.fromValues(1,-1,0);St.transformMat4(g,g,d),St.normalize(g,g),o=[].concat((0,at.Z)(v),(0,at.Z)(m),(0,at.Z)(y),(0,at.Z)(g))}else o=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var _=i%4*3;return[o[_],o[_+1],o[_+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e,n,r,i){var o=e.size,a=void 0===o?5:o;return Array.isArray(a)?[a[0]*t.meter2coord]:[a*t.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:i.AttributeType.Attribute,descriptor:{name:"a_Shape",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e,n,r,i){var o=e.shape,a=void 0===o?2:o;return[t.layer.getLayerConfig().shape2d.indexOf(a)]}}})}}]),n}(dt);function Mn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var kn=function(t){(0,u.Z)(n,t);var e=Mn(n);function n(){var t;(0,o.Z)(this,n);for(var r=arguments.length,a=new Array(r),u=0;u<r;u++)a[u]=arguments[u];return t=e.call.apply(e,[this].concat(a)),(0,p.Z)((0,s.Z)(t),"meter2coord",1),(0,p.Z)((0,s.Z)(t),"texture",void 0),(0,p.Z)((0,s.Z)(t),"isMeter",!1),(0,p.Z)((0,s.Z)(t),"radian",0),(0,p.Z)((0,s.Z)(t),"updateTexture",(function(){var e=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),void t.layer.renderLayers();t.texture=e({data:t.iconService.getCanvas(),mag:i.gl.LINEAR,min:i.gl.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128,mipmap:!0})})),t}return(0,a.Z)(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.offsets,o=void 0===r?[0,0]:r,a=t.rotation;this.rendererService.getDirty()&&this.texture.bind();var s=1;if("GAODE2.x"!==this.mapService.version&&"GAODE1.x"!==this.mapService.version||(s=-1),this.radian=void 0!==a?s*Math.PI*a/180:s*Math.PI*(this.mapService.getRotation()%360)/180,this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n,offsets:o})){this.judgeStyleAttributes({opacity:n,offsets:o});var u=this.layer.getEncodedData(),l=this.calDataFrame(this.cellLength,u,this.cellProperties),c=l.data,p=l.width,h=l.height;this.rowCount=h,this.dataTexture=this.cellLength>0&&c.length>0?this.createTexture2D({flipY:!0,data:c,format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:p,height:h}):this.createTexture2D({flipY:!0,data:[1],format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:Number(n),u_offsets:this.isOffsetStatic(o)?o:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Jt)}},{key:"initModels",value:function(){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture);var t=this.layer.getLayerConfig().unit,e=void 0===t?"l7size":t,n=this.mapService.version;return"meter"===e&&n!==Z.G.L7MAP&&n!==Z.G.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var t=(0,B.Z)(this.layer.getSource().extent,4),e=t[0],n=t[1],r=t[2],i=t[3],o=[(e+r)/2,(n+i)/2];if(this.mapService.version===Z.G.MAPBOX&&window.mapboxgl.MercatorCoordinate){var a=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:o[0],lat:o[1]},0),s=1*a.meterInMercatorCoordinateUnits(),u=new window.mapboxgl.MercatorCoordinate(a.x-s,a.y,a.z).toLngLat();this.meter2coord=o[0]-u.lng}else{var l=this.mapService.meterToCoord(o,[e,n]),c=this.mapService.meterToCoord(o,[r===e?r+.1:r,i===n?n+.1:i]);this.meter2coord=(l+c)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}}},{key:"buildModels",value:function(){var t=this.layer.getLayerConfig(),e=t.mask,n=void 0!==e&&e,r=t.maskInside,i=void 0===r||r,o=this.getShaders(),a=o.frag,s=o.vert,u=o.type;return[this.layer.buildLayerModel({moduleName:u,vertexShader:s,fragmentShader:a,triangulation:Jt,depth:{enable:!1},blend:this.getBlend(),stencil:(0,T.getMask)(n,i),cull:{enable:!0,face:(0,T.getCullFace)(this.mapService.version)}})]}},{key:"getShaders",value:function(){return{frag:'uniform sampler2D u_texture;\nuniform vec2 u_textSize;\n\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n\n#pragma include "sdf_2d"\n#pragma include "picking"\nvarying vec2 v_uv; // 本身的 uv 坐标\nvarying vec2 v_Iconuv;\n\nvoid main() {\n\n  float opacity = styleMappingMat[0][0];\n\n  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;\n  gl_FragColor = texture2D(u_texture, pos);\n  gl_FragColor.a *= opacity;\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nattribute vec2 a_Uv;\nattribute float a_Rotate;\n\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform mat2 u_RotateMatrix;\nuniform float u_isMeter;\n\nvarying vec2 v_uv; // 本身的 uv 坐标\nvarying vec2 v_Iconuv; // icon 贴图的 uv 坐标\n\nuniform float u_opacity : 1;\nuniform vec2 u_offsets;\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  vec3 extrude = a_Extrude;\n\n  v_uv = (a_Extrude.xy + 1.0)/2.0;\n  v_uv.y = 1.0 - v_uv.y;\n  v_Iconuv = a_Uv;\n\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty\n    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n\n  vec2 textrueOffsets = vec2(0.0, 0.0);\n  if(hasOffsets()) {\n    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x\n    textureOffset += 1.0;\n\n    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x\n    textureOffset += 1.0;\n  } else {\n    textrueOffsets = u_offsets;\n  }\n\n  // cal style mapping\n\n  highp float angle_sin = sin(a_Rotate);\n  highp float angle_cos = cos(a_Rotate);\n  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n\n  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);\n  vec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);\n  vec3 aPosition = a_Position;\n  if(u_isMeter < 1.0) {\n    // 不以米为实际单位\n    offset = project_pixel(offset);\n  } else {\n    // 以米为实际单位\n\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      aPosition.xy += offset;\n      offset.x = 0.0;\n      offset.y = 0.0;\n    }\n  }\n\n\n  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\n  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));\n  }\n \n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',type:"point_fillImage"}}},{key:"clearModels",value:function(){var t,e;this.iconService.off("imageUpdate",this.updateTexture),null===(t=this.texture)||void 0===t||t.destroy(),null===(e=this.dataTexture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:i.AttributeType.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e,n,r){var i=t.rotate,o=void 0===i?0:i;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(e,n,r,i){var o=t.iconService.getIconMap()[e.shape]||{x:0,y:0};return[o.x,o.y]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:i.AttributeType.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e,n,r,i){var o=e.size,a=void 0===o?5:o;return Array.isArray(a)?[a[0]*t.meter2coord]:[a*t.meter2coord]}}})}}]),n}(dt);function Pn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var On=function(t){(0,u.Z)(n,t);var e=Pn(n);function n(){var t;(0,o.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i)),(0,p.Z)((0,s.Z)(t),"texture",void 0),t}return(0,a.Z)(n,[{key:"getUninforms",value:function(){return{u_opacity:this.layer.getLayerConfig().opacity||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var t=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",(function(){t.updateTexture(),t.layer.render()})),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:'precision highp float;\nattribute vec3 a_Position;\nattribute vec4 a_Color;\nattribute vec2 a_Uv;\nattribute float a_Size;\nvarying vec4 v_color;\nvarying vec2 v_uv;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec2 u_offsets;\n\nuniform float u_opacity : 1;\n\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n\n  styleMappingMat[1][0] = a_Size;\n\n  vec2 textrueOffsets = vec2(0.0, 0.0);\n  if(hasOffsets()) {\n    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x\n    textureOffset += 1.0;\n\n    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x\n    textureOffset += 1.0;\n  } else {\n    textrueOffsets = u_offsets;\n  }\n\n  // cal style mapping - 数据纹理映射部分的计算\n   v_color = a_Color;\n   v_uv = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   \n  //  vec2 offset = project_pixel(u_offsets);\n  vec2 offset = project_pixel(textrueOffsets);\n\n  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));\n  }\n  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nuniform sampler2D u_texture;\nvarying vec4 v_color;\nvarying vec2 v_uv;\nuniform vec2 u_textSize;\nuniform float u_opacity : 1;\n\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n\n#pragma include "picking"\n\nvoid main(){\n      float opacity = styleMappingMat[0][0];\n      float size = styleMappingMat[1][0];\n      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;\n      vec4 textureColor;\n\n      // Y = 0.299R + 0.587G + 0.114B // 亮度提取\n     \n      textureColor = texture2D(u_texture, pos);\n\n      // Tip: 去除边缘部分 mipmap 导致的混合变暗\n      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);\n      if(fragmengTocenter >= 0.5) {\n            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;\n            textureColor.a *= luma;\n      }\n      \n      \n\n      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){\n            gl_FragColor= textureColor;\n      }else {\n            gl_FragColor= step(0.01, textureColor.z) * v_color;\n      }\n\n      gl_FragColor.a = gl_FragColor.a * opacity;\n      gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:ee,primitive:i.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var t;null===(t=this.dataTexture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e,n,r){var i=t.size;return Array.isArray(i)?[i[0]]:[i]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(e,n,r,i){var o=t.fontService.mapping,a=e.shape,s=o[t.fontService.getGlyph(a)];return[s.x,s.y]}}})}},{key:"updateTexture",value:function(){var t=this.rendererService.createTexture2D,e=this.fontService.canvas;this.texture=t({data:e,mag:i.gl.LINEAR,min:i.gl.LINEAR,width:e.width,height:e.height})}},{key:"initIconFontGlyphs",value:function(){var t=this,e=this.layer.getLayerConfig(),n=e.fontWeight,r=void 0===n?"normal":n,i=e.fontFamily,o=void 0===i?"sans-serif":i,a=this.layer.getEncodedData(),s=[];a.forEach((function(e){var n=e.shape,r=void 0===n?"":n;r=r.toString();var i=t.fontService.getGlyph(r);-1===s.indexOf(i)&&s.push(i)})),this.fontService.setFontOptions({characterSet:s,fontWeight:r,fontFamily:o,fontSize:48})}}]),n}(dt);function Ln(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var In=function(t){(0,u.Z)(n,t);var e=Ln(n);function n(){var t;(0,o.Z)(this,n);for(var r=arguments.length,a=new Array(r),u=0;u<r;u++)a[u]=arguments[u];return t=e.call.apply(e,[this].concat(a)),(0,p.Z)((0,s.Z)(t),"texture",void 0),(0,p.Z)((0,s.Z)(t),"updateTexture",(function(){var e=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),void t.layer.renderLayers();t.texture=e({data:t.iconService.getCanvas(),mag:i.gl.LINEAR,min:i.gl.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128,mipmap:!0})})),t}return(0,a.Z)(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.offsets,o=void 0===r?[0,0]:r;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n,offsets:o})){this.judgeStyleAttributes({opacity:n,offsets:o});var a=this.layer.getEncodedData(),s=this.calDataFrame(this.cellLength,a,this.cellProperties),u=s.data,l=s.width,c=s.height;this.rowCount=c,this.dataTexture=this.cellLength>0&&u.length>0?this.createTexture2D({flipY:!0,data:u,format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:l,height:c}):this.createTexture2D({flipY:!0,data:[1],format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:Number(n),u_offsets:this.isOffsetStatic(o)?o:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var t,e;null===(t=this.texture)||void 0===t||t.destroy(),null===(e=this.dataTexture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var t=this.layer.getLayerConfig(),e=t.mask,n=void 0!==e&&e,r=t.maskInside,o=void 0===r||r;return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:'precision highp float;\nattribute vec3 a_Position;\nattribute vec4 a_Color;\nattribute vec2 a_Uv;\nattribute float a_Size;\nvarying vec4 v_color;\nvarying vec2 v_uv;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec2 u_offsets;\n\nuniform float u_opacity : 1;\n\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n\n  styleMappingMat[1][0] = a_Size;\n\n  vec2 textrueOffsets = vec2(0.0, 0.0);\n  if(hasOffsets()) {\n    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x\n    textureOffset += 1.0;\n\n    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x\n    textureOffset += 1.0;\n  } else {\n    textrueOffsets = u_offsets;\n  }\n\n  // cal style mapping - 数据纹理映射部分的计算\n   v_color = a_Color;\n   v_uv = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   \n  //  vec2 offset = project_pixel(u_offsets);\n  vec2 offset = project_pixel(textrueOffsets);\n\n  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));\n  }\n  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nuniform sampler2D u_texture;\nvarying vec4 v_color;\nvarying vec2 v_uv;\nuniform vec2 u_textSize;\nuniform float u_opacity : 1;\n\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n\n#pragma include "picking"\n\nvoid main(){\n      float opacity = styleMappingMat[0][0];\n      float size = styleMappingMat[1][0];\n      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;\n      vec4 textureColor;\n\n      // Y = 0.299R + 0.587G + 0.114B // 亮度提取\n     \n      textureColor = texture2D(u_texture, pos);\n\n      // Tip: 去除边缘部分 mipmap 导致的混合变暗\n      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);\n      if(fragmengTocenter >= 0.5) {\n            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;\n            textureColor.a *= luma;\n      }\n      \n      \n\n      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){\n            gl_FragColor= textureColor;\n      }else {\n            gl_FragColor= step(0.01, textureColor.z) * v_color;\n      }\n\n      gl_FragColor.a = gl_FragColor.a * opacity;\n      gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:ee,primitive:i.gl.POINTS,depth:{enable:!1},blend:this.getBlend(),stencil:(0,T.getMask)(n,o)})]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e,n,r){var i=t.size,o=void 0===i?5:i;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(e,n,r,i){var o=t.iconService.getIconMap()[e.shape]||{x:0,y:0};return[o.x,o.y]}}})}}]),n}(dt);function Rn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}function Dn(t){var e=t.coordinates;return{vertices:(0,at.Z)(e),indices:[0],size:e.length}}var Nn=function(t){(0,u.Z)(n,t);var e=Rn(n);function n(){return(0,o.Z)(this,n),e.apply(this,arguments)}return(0,a.Z)(n,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.offsets,o=void 0===r?[0,0]:r;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n,offsets:o})){this.judgeStyleAttributes({opacity:n,offsets:o});var a=this.layer.getEncodedData(),s=this.calDataFrame(this.cellLength,a,this.cellProperties),u=s.data,l=s.width,c=s.height;this.rowCount=c,this.dataTexture=this.cellLength>0&&u.length>0?this.createTexture2D({flipY:!0,data:u,format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:l,height:c}):this.createTexture2D({flipY:!0,data:[1],format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(n),u_offsets:this.isOffsetStatic(o)?o:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var t=this.layer.getLayerConfig(),e=t.mask,n=void 0!==e&&e,r=t.maskInside,o=void 0===r||r;return this.layer.triangulation=Dn,[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:'\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute float a_Size;\nattribute vec4 a_Color;\nvarying vec4 v_color;\n\nuniform float u_opacity : 1;\nuniform vec2 u_offsets;\n\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "picking"\n#pragma include "project"\nvoid main() {\n  v_color = a_Color;\n\n  // cal style mapping - 数据纹理映射部分的计算\nstyleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n\n  vec2 textrueOffsets = vec2(0.0, 0.0);\n  if(hasOffsets()) {\n    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x\n    textureOffset += 1.0;\n\n    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x\n    textureOffset += 1.0;\n  } else {\n    textrueOffsets = u_offsets;\n  }\n\n  // cal style mapping\n  \n  // vec2 offset = project_pixel(u_offsets);\n  vec2 offset = project_pixel(textrueOffsets);\n  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);\n  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\\n  // \n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // vec2 offset = project_pixel((u_offsets));\n    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);\n  } else { // else\n    // vec2 offset = project_pixel(u_offsets);\n    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);\n    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\n  }\n\n  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nuniform float u_opacity : 1;\nuniform vec2 u_offsets;\nvarying vec4 v_color;\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n\n#pragma include "picking"\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n\n  gl_FragColor = v_color;\n  // gl_FragColor.a =gl_FragColor.a * u_opacity;\n  gl_FragColor.a =gl_FragColor.a * opacity;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:Dn,depth:{enable:!1},primitive:i.gl.POINTS,blend:this.getBlend(),stencil:(0,T.getMask)(n,o)})]}},{key:"clearModels",value:function(){var t;null===(t=this.dataTexture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e,n,r){var i=t.size,o=void 0===i?1:i;return Array.isArray(o)?[o[0]]:[o]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:i.BlendType.additive}}}]),n}(dt);function Zn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var zn=function(t){(0,u.Z)(n,t);var e=Zn(n);function n(){var t;(0,o.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i)),(0,p.Z)((0,s.Z)(t),"meter2coord",1),(0,p.Z)((0,s.Z)(t),"isMeter",!1),t}return(0,a.Z)(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.offsets,o=void 0===r?[0,0]:r,a=t.blend,s=t.speed,u=void 0===s?1:s;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n,offsets:o})){this.judgeStyleAttributes({opacity:n,offsets:o});var l=this.layer.getEncodedData(),c=this.calDataFrame(this.cellLength,l,this.cellProperties),p=c.data,h=c.width,f=c.height;this.rowCount=f,this.dataTexture=this.cellLength>0&&p.length>0?this.createTexture2D({flipY:!0,data:p,format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:h,height:f}):this.createTexture2D({flipY:!0,data:[1],format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_speed:u,u_additive:"additive"===a?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(n),u_offsets:this.isOffsetStatic(o)?o:[0,0]}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig().animateOption,e=void 0===t?{enable:!1}:t;return{u_aimate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Jt)}},{key:"initModels",value:function(){var t=this.layer.getLayerConfig().unit,e=void 0===t?"l7size":t,n=this.mapService.version;return"meter"===e&&n!==Z.G.L7MAP&&n!==Z.G.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var t=(0,B.Z)(this.layer.getSource().extent,4),e=t[0],n=t[1],r=t[2],i=t[3],o=[(e+r)/2,(n+i)/2];if(this.mapService.version===Z.G.MAPBOX&&window.mapboxgl.MercatorCoordinate){var a=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:o[0],lat:o[1]},0),s=1*a.meterInMercatorCoordinateUnits(),u=new window.mapboxgl.MercatorCoordinate(a.x-s,a.y,a.z).toLngLat();this.meter2coord=o[0]-u.lng}else{var l=this.mapService.meterToCoord(o,[e,n]),c=this.mapService.meterToCoord(o,[r===e?r+.1:r,i===n?n+.1:i]);this.meter2coord=(l+c)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}}},{key:"buildModels",value:function(){var t=this.layer.getLayerConfig(),e=t.mask,n=void 0!==e&&e,r=t.maskInside,i=void 0===r||r,o=this.getShaders(),a=o.frag,s=o.vert,u=o.type;return[this.layer.buildLayerModel({moduleName:u,vertexShader:s,fragmentShader:a,triangulation:Jt,depth:{enable:!1},blend:this.getBlend(),stencil:(0,T.getMask)(n,i),cull:{enable:!0,face:(0,T.getCullFace)(this.mapService.version)}})]}},{key:"getShaders",value:function(){return{frag:'\nuniform float u_additive;\n\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\n\n#pragma include "sdf_2d"\n#pragma include "picking"\n\nvoid main() {\n  int shape = int(floor(v_data.w + 0.5));\n\n  vec4 textrueStroke = vec4(\n    styleMappingMat[1][0],\n    styleMappingMat[1][1],\n    styleMappingMat[1][2],\n    styleMappingMat[1][3]\n  );\n\n  float opacity = styleMappingMat[0][0];\n\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius);\n\n  float outer_df = sdCircle(v_data.xy, 1.0);\n  float inner_df = sdCircle(v_data.xy, r);\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);\n\n  if(u_additive > 0.0) {\n    gl_FragColor *= opacity_t;\n  } else {\n    gl_FragColor.a *= opacity_t;\n  }\n\n  if(gl_FragColor.a > 0.0) {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n\n  vec2 extrude =  styleMappingMat[2].ba;\n  vec2 dir = normalize(extrude);\n  vec2 baseDir = vec2(1.0, 0.0);\n  float pi = 3.14159265359;\n  // full circle\n  // float rades = dot(dir, baseDir);\n  // float flag = sign(dir.y);\n  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;\n  \n  // half circle\n  float flag = sign(dir.y);\n  float rades = dot(dir, baseDir);\n  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;\n  // simple AA\n  if(radar_v > 0.99) {\n    radar_v = 1.0 - (radar_v - 0.99)/0.01;\n  }\n\n  gl_FragColor.a *= radar_v;\n}\n',vert:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nattribute float a_Shape;\nuniform float u_speed: 1.0;\nuniform float u_time;\n\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_isMeter;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\n\nuniform float u_opacity : 1;\nuniform vec2 u_offsets;\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  vec3 extrude = a_Extrude;\n  float shape_type = a_Shape;\n  float newSize = setPickingSize(a_Size);\n\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty\n    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - a_Extrude.x - a_Extrude.y\n    0.0, 0.0, 0.0, 0.0  // \n  );\n\n  float time = u_time * u_speed;\n  mat2 rotateMatrix = mat2( \n    cos(time), sin(time), \n    -sin(time), cos(time)\n  );\n  styleMappingMat[2].ba = rotateMatrix * a_Extrude.xy;\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> empty -> empty ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n\n\n  vec2 textrueOffsets = vec2(0.0, 0.0);\n  if(hasOffsets()) {\n    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x\n    textureOffset += 1.0;\n\n    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x\n    textureOffset += 1.0;\n  } else {\n    textrueOffsets = u_offsets;\n  }\n\n  // cal style mapping\n\n  // unpack color(vec2)\n  v_color = a_Color;\n\n  // radius(16-bit)\n  v_radius = newSize;\n\n  // anti-alias\n  float blur = 0.0;\n  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);\n\n  vec2 offset = (extrude.xy * (newSize) + textrueOffsets);\n  vec3 aPosition = a_Position;\n  if(u_isMeter < 1.0) {\n    // 不以米为实际单位\n    offset = project_pixel(offset);\n  } else {\n    // 以米为实际单位\n    antialiasblur *= pow(19.0 - u_Zoom, 2.0);\n    antialiasblur = max(antialiasblur, -0.01);\n    // offset *= 0.5;\n\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      aPosition.xy += offset;\n      offset.x = 0.0;\n      offset.y = 0.0;\n    }\n  }\n\n  v_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);\n\n  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',type:"point_radar"}}},{key:"clearModels",value:function(){var t;null===(t=this.dataTexture)||void 0===t||t.destroy()}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:i.AttributeType.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e,n,r){var i,o=r%4*3;return[(i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0])[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e,n,r,i){var o=e.size,a=void 0===o?5:o;return Array.isArray(a)?[a[0]*t.meter2coord]:[a*t.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:i.AttributeType.Attribute,descriptor:{name:"a_Shape",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e,n,r,i){var o=e.shape,a=void 0===o?2:o;return[t.layer.getLayerConfig().shape2d.indexOf(a)]}}})}}]),n}(dt);function Fn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}function Bn(t){var e=t.coordinates;return{vertices:(0,at.Z)(e),indices:[0],size:e.length}}var jn=function(t){(0,u.Z)(n,t);var e=Fn(n);function n(){return(0,o.Z)(this,n),e.apply(this,arguments)}return(0,a.Z)(n,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.offsets,o=void 0===r?[0,0]:r,a=t.blend,s=t.strokeOpacity,u=void 0===s?1:s,l=t.strokeWidth,c=void 0===l?0:l,p=t.stroke,h=void 0===p?"#fff":p;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n,offsets:o})){this.judgeStyleAttributes({opacity:n,offsets:o});var f=this.layer.getEncodedData(),d=this.calDataFrame(this.cellLength,f,this.cellProperties),v=d.data,m=d.width,y=d.height;this.rowCount=y,this.dataTexture=this.cellLength>0&&v.length>0?this.createTexture2D({flipY:!0,data:v,format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:m,height:y}):this.createTexture2D({flipY:!0,data:[1],format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:1,height:1})}return{u_additive:"additive"===a?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(n),u_offsets:this.isOffsetStatic(o)?o:[0,0],u_stroke_opacity:Number(u),u_stroke_width:Number(c),u_stroke_color:this.getStrokeColor(h)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var t=this.layer.getLayerConfig(),e=t.mask,n=void 0!==e&&e,r=t.maskInside,o=void 0===r||r;return this.layer.triangulation=Bn,[this.layer.buildLayerModel({moduleName:"simplepoint",vertexShader:'\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute float a_Size;\nattribute vec4 a_Color;\nvarying vec4 v_color;\n\nuniform float u_opacity : 1;\nuniform vec2 u_offsets;\nuniform float u_stroke_width;\n\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\nvarying float v_blur;\nvarying float v_innerRadius;\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "picking"\n#pragma include "project"\nvoid main() {\n  v_color = a_Color;\n  v_blur = 1.0 - max(2.0/a_Size, 0.05);\n  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);\n\n  // cal style mapping - 数据纹理映射部分的计算\nstyleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n\n  vec2 textrueOffsets = vec2(0.0, 0.0);\n  if(hasOffsets()) {\n    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x\n    textureOffset += 1.0;\n\n    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x\n    textureOffset += 1.0;\n  } else {\n    textrueOffsets = u_offsets;\n  }\n\n  // cal style mapping\n  \n  vec2 offset = project_pixel(textrueOffsets);\n  \n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);\n  } else { // else\n    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);\n    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\n  }\n\n  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nuniform float u_opacity : 1;\nuniform vec2 u_offsets;\nuniform float u_additive;\n\nuniform float u_stroke_opacity : 1;\n\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\n\nvarying vec4 v_color;\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\nvarying float v_blur;\nvarying float v_innerRadius;\n\n#pragma include "picking"\nvoid main() {\n  vec2 center = vec2(0.5);\n\n  float opacity = styleMappingMat[0][0];\n  // Tip: 片元到中心点的距离 0 - 1\n  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;\n  // Tip: 片元的剪切成圆形\n  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);\n\n\n  if(v_innerRadius < 0.99) {\n    // 当存在 stroke 且 stroke > 0.01\n    float blurWidth = (1.0 - v_blur)/2.0;\n    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);\n    if(fragmengTocenter > v_innerRadius + blurWidth) {\n      gl_FragColor = stroke;\n    } else if(fragmengTocenter > v_innerRadius - blurWidth){\n      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);\n      gl_FragColor = mix(v_color, stroke, mixR);\n    } else {\n      gl_FragColor = v_color;\n    }\n  } else {\n    // 当不存在 stroke 或 stroke <= 0.01\n    gl_FragColor = v_color;\n  }\n\n  gl_FragColor.a *= opacity;\n\n  gl_FragColor = filterColor(gl_FragColor);\n  \n  if(u_additive > 0.0) {\n    gl_FragColor *= circleClipOpacity;\n  } else {\n    gl_FragColor.a *= circleClipOpacity;\n  }\n\n}\n',triangulation:Bn,depth:{enable:!1},primitive:i.gl.POINTS,blend:this.getBlend(),stencil:(0,T.getMask)(n,o)})]}},{key:"clearModels",value:function(){var t;null===(t=this.dataTexture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e,n,r){var i=t.size,o=void 0===i?1:i;return Array.isArray(o)?[o[0]]:[o]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:i.BlendType.additive}}}]),n}(dt),Un=n(98333);function Vn(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return Gn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Gn(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Gn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Hn=function(){function t(e,n,r){(0,o.Z)(this,t),(0,p.Z)(this,"boxCells",[]),(0,p.Z)(this,"xCellCount",void 0),(0,p.Z)(this,"yCellCount",void 0),(0,p.Z)(this,"boxKeys",void 0),(0,p.Z)(this,"bboxes",void 0),(0,p.Z)(this,"width",void 0),(0,p.Z)(this,"height",void 0),(0,p.Z)(this,"xScale",void 0),(0,p.Z)(this,"yScale",void 0),(0,p.Z)(this,"boxUid",void 0);var i=this.boxCells;this.xCellCount=Math.ceil(e/r),this.yCellCount=Math.ceil(n/r);for(var a=0;a<this.xCellCount*this.yCellCount;a++)i.push([]);this.boxKeys=[],this.bboxes=[],this.width=e,this.height=n,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/n,this.boxUid=0}return(0,a.Z)(t,[{key:"insert",value:function(t,e,n,r,i){this.forEachCell(e,n,r,i,this.insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)}},{key:"query",value:function(t,e,n,r,i){return this.queryHitTest(t,e,n,r,!1,i)}},{key:"hitTest",value:function(t,e,n,r,i){return this.queryHitTest(t,e,n,r,!0,i)}},{key:"insertBoxCell",value:function(t,e,n,r,i,o){this.boxCells[i].push(o)}},{key:"queryHitTest",value:function(t,e,n,r,i,o){if(n<0||t>this.width||r<0||e>this.height)return!i&&[];var a=[];if(t<=0&&e<=0&&this.width<=n&&this.height<=r){if(i)return!0;for(var s=0;s<this.boxKeys.length;s++)a.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});return o?a.filter(o):a}var u={hitTest:i,seenUids:{box:{},circle:{}}};return this.forEachCell(t,e,n,r,this.queryCell,a,u,o),i?a.length>0:a}},{key:"queryCell",value:function(t,e,n,r,i,o,a,s){var u=a.seenUids,l=this.boxCells[i];if(null!==l){var c,p=this.bboxes,h=Vn(l);try{for(h.s();!(c=h.n()).done;){var f=c.value;if(!u.box[f]){u.box[f]=!0;var d=4*f;if(t<=p[d+2]&&e<=p[d+3]&&n>=p[d+0]&&r>=p[d+1]&&(!s||s(this.boxKeys[f]))){if(a.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[f],x1:p[d],y1:p[d+1],x2:p[d+2],y2:p[d+3]})}}}}catch(t){h.e(t)}finally{h.f()}}return!1}},{key:"forEachCell",value:function(t,e,n,r,i,o,a,s){for(var u=this.convertToXCellCoord(t),l=this.convertToYCellCoord(e),c=this.convertToXCellCoord(n),p=this.convertToYCellCoord(r),h=u;h<=c;h++)for(var f=l;f<=p;f++){var d=this.xCellCount*f+h;if(i.call(this,t,e,n,r,d,o,a,s))return}}},{key:"convertToXCellCoord",value:function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}},{key:"convertToYCellCoord",value:function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}}]),t}(),Wn=function(){function t(e,n){(0,o.Z)(this,t),(0,p.Z)(this,"width",void 0),(0,p.Z)(this,"height",void 0),(0,p.Z)(this,"grid",void 0),(0,p.Z)(this,"viewportPadding",100),(0,p.Z)(this,"screenRightBoundary",void 0),(0,p.Z)(this,"screenBottomBoundary",void 0),(0,p.Z)(this,"gridRightBoundary",void 0),(0,p.Z)(this,"gridBottomBoundary",void 0),this.width=e,this.height=n,this.viewportPadding=Math.max(e,n),this.grid=new Hn(e+this.viewportPadding,n+this.viewportPadding,25),this.screenRightBoundary=e+this.viewportPadding,this.screenBottomBoundary=n+this.viewportPadding,this.gridRightBoundary=e+2*this.viewportPadding,this.gridBottomBoundary=n+2*this.viewportPadding}return(0,a.Z)(t,[{key:"placeCollisionBox",value:function(t){var e=t.x1+t.anchorPointX+this.viewportPadding,n=t.y1+t.anchorPointY+this.viewportPadding,r=t.x2+t.anchorPointX+this.viewportPadding,i=t.y2+t.anchorPointY+this.viewportPadding;return!this.isInsideGrid(e,n,r,i)||this.grid.hitTest(e,n,r,i)?{box:[]}:{box:[e,n,r,i]}}},{key:"insertCollisionBox",value:function(t,e){var n={featureIndex:e};this.grid.insert(n,t[0],t[1],t[2],t[3])}},{key:"project",value:function(t,e,n){var r=Un.al(e,n,0,1),i=Un.Ue(),o=wt.fromValues.apply(wt,(0,at.Z)(t));return Un.fF(i,r,o),{x:(i[0]/i[3]+1)/2*this.width+this.viewportPadding,y:(-i[1]/i[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(t,e,n,r){return n>=0&&t<this.gridRightBoundary&&r>=0&&e<this.gridBottomBoundary}}]),t}();function qn(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return Xn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Xn(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Xn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Yn(t){var e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0;break;default:e=.5}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0;break;default:n=.5}return{horizontalAlign:e,verticalAlign:n}}function Kn(t,e,n,r,i){if(i){var o=t[r],a=o.glyph;if(a)for(var s=e[a].advance*o.scale,u=(t[r].x+s)*i,l=n;l<=r;l++)t[l].x-=u}}function Qn(t,e,n,r,i,o,a){var s,u=(e-n)*i,l=(-r*a+.5)*o,c=qn(t);try{for(c.s();!(s=c.n()).done;){var p=s.value;p.x+=u,p.y+=l}}catch(t){c.e(t)}finally{c.f()}}function Jn(t,e,n,r,i,o,a){var s=0,u=-8,l=0,c=t.positionedGlyphs,p="right"===o?1:"left"===o?0:.5,h=c.length;n.forEach((function(t){if(t.split("").forEach((function(t){var n=e[t];n&&(c.push({glyph:t,x:s,y:u+0,vertical:!1,scale:1,metrics:n}),s+=n.advance+a)})),c.length!==h){var n=s-a;l=Math.max(n,l),Kn(c,e,h,c.length-1,p)}s=0,u-=r+5}));var f=Yn(i),d=f.horizontalAlign,v=f.verticalAlign;Qn(c,p,d,v,l,r,n.length);var m=u- -8;t.top+=-v*m,t.bottom=t.top-m,t.left+=-d*l,t.right=t.left+l}function $n(t,e,n,r,i,o,a){var s=0,u=-8,l=0,c=t.positionedGlyphs,p="right"===o?1:"left"===o?0:.5,h=c.length;n.forEach((function(t){var n=e[t];if(n&&(c.push({glyph:t,x:n.advance/2,y:u+0,vertical:!1,scale:1,metrics:n}),s+=n.advance+a),c.length!==h){var i=s-a;l=Math.max(i,l),Kn(c,e,h,c.length-1,p)}s=0,u-=r+5}));var f=Yn(i),d=f.horizontalAlign,v=f.verticalAlign;Qn(c,p,d,v,l,r,n.length);var m=u- -8;t.top+=-v*m,t.bottom=t.top-m,t.left+=-d*l,t.right=t.left+l}function tr(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return er(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return er(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function er(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function nr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var rr='#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 48.0\nuniform sampler2D u_sdf_map;\nuniform float u_gamma_scale : 0.5;\n// uniform float u_font_size : 24.0;\nuniform float u_opacity : 1.0;\nuniform vec4 u_stroke_color : [0, 0, 0, 1];\nuniform float u_stroke_width : 2.0;\nuniform float u_halo_blur : 0.5;\nuniform float u_DevicePixelRatio;\n\nvarying vec4 v_color;\nvarying vec2 v_uv;\nvarying float v_gamma_scale;\nvarying float v_fontScale;\n\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n\n#pragma include "picking"\nvoid main() {\n  // get style data mapping\n  float opacity = styleMappingMat[0][0];\n  float strokeWidth = styleMappingMat[0][2];\n  vec4 textrueStroke = vec4(\n    styleMappingMat[1][0],\n    styleMappingMat[1][1],\n    styleMappingMat[1][2],\n    styleMappingMat[1][3]\n  );\n\n  // get sdf from atlas\n  float dist = texture2D(u_sdf_map, v_uv).a;\n\n  // float fontScale = u_font_size / FONT_SIZE;\n\n  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;\n  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;\n  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;\n\n  highp float gamma_scaled = gamma * v_gamma_scale;\n\n  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\n  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));\n  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));\n  gl_FragColor.a= gl_FragColor.a * alpha;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',ir='#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 24.0\nattribute vec3 a_Position;\nattribute vec2 a_tex;\nattribute vec2 a_textOffsets;\nattribute vec4 a_Color;\nattribute float a_Size;\nattribute float a_Rotate;\n\nuniform vec2 u_sdf_map_size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_raisingHeight: 0.0;\n\nvarying vec2 v_uv;\nvarying float v_gamma_scale;\nvarying vec4 v_color;\nvarying float v_fontScale;\n\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\nuniform float u_opacity : 1;\nuniform float u_stroke_width : 2;\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "styleMappingCalStrokeWidth"\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n   styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n\n   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][2] = strokeWidthAndOffset.r;\n  textureOffset = strokeWidthAndOffset.g;\n\n  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);\n  if(hasStroke()) {\n    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R\n    textureOffset += 1.0;\n\n    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G\n    textureOffset += 1.0;\n\n    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B\n    textureOffset += 1.0;\n\n    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A\n    textureOffset += 1.0;\n  } else {\n    if(u_stroke_color == vec4(0.0)) {\n      styleMappingMat[1][0] = v_color.r;\n      styleMappingMat[1][1] = v_color.g;\n      styleMappingMat[1][2] = v_color.b;\n      styleMappingMat[1][3] = v_color.a;\n    } else {\n      styleMappingMat[1][0] = u_stroke_color.r;\n      styleMappingMat[1][1] = u_stroke_color.g;\n      styleMappingMat[1][2] = u_stroke_color.b;\n      styleMappingMat[1][3] = u_stroke_color.a;\n    }\n  }\n  \n  // cal style mapping - 数据纹理映射部分的计算\n\n  v_color = a_Color;\n  v_uv = a_tex / u_sdf_map_size;\n\n  // 文本缩放比例\n  float fontScale = a_Size / FONT_SIZE;\n  v_fontScale = fontScale;\n\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  highp float angle_sin = sin(a_Rotate);\n  highp float angle_cos = cos(a_Rotate);\n  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n  \n  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);\n\n  float raiseHeight = u_raisingHeight;\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n    raiseHeight = u_raisingHeight * mapboxZoomScale;\n  }\n\n  vec4 projected_position;\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n   projected_position  = u_Mvp * (vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));\n  } else { // else\n   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));\n  }\n\n  gl_Position = vec4(\n    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);\n  v_gamma_scale = gl_Position.w;\n  setPickingColor(a_PickingColor);\n\n}\n';function or(t){var e=this,n=t.id,r=[],i=[];if(!e.glyphInfoMap||!e.glyphInfoMap[n])return{vertices:[],indices:[],size:7};var o=e.glyphInfoMap[n].centroid,a=2===o.length?[o[0],o[1],0]:o;return e.glyphInfoMap[n].glyphQuads.forEach((function(t,e){r.push.apply(r,(0,at.Z)(a).concat([t.tex.x,t.tex.y+t.tex.height,t.tl.x,t.tl.y],(0,at.Z)(a),[t.tex.x+t.tex.width,t.tex.y+t.tex.height,t.tr.x,t.tr.y],(0,at.Z)(a),[t.tex.x+t.tex.width,t.tex.y,t.br.x,t.br.y],(0,at.Z)(a),[t.tex.x,t.tex.y,t.bl.x,t.bl.y])),i.push(0+4*e,1+4*e,2+4*e,2+4*e,3+4*e,0+4*e)})),{vertices:r,indices:i,size:7}}var ar=function(t){(0,u.Z)(n,t);var e=nr(n);function n(){var t;(0,o.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i)),(0,p.Z)((0,s.Z)(t),"glyphInfo",void 0),(0,p.Z)((0,s.Z)(t),"glyphInfoMap",{}),(0,p.Z)((0,s.Z)(t),"texture",void 0),(0,p.Z)((0,s.Z)(t),"currentZoom",-1),(0,p.Z)((0,s.Z)(t),"extent",void 0),(0,p.Z)((0,s.Z)(t),"textureHeight",0),(0,p.Z)((0,s.Z)(t),"textCount",0),(0,p.Z)((0,s.Z)(t),"preTextStyle",{}),(0,p.Z)((0,s.Z)(t),"buildModels",(function(){var e=t.layer.getLayerConfig(),n=e.mask,r=void 0!==n&&n,i=e.maskInside,o=void 0===i||i;return t.initGlyph(),t.updateTexture(),t.filterGlyphs(),t.reBuildModel(),[t.layer.buildLayerModel({moduleName:"pointText",vertexShader:ir,fragmentShader:rr,triangulation:or.bind((0,s.Z)(t)),depth:{enable:!1},blend:t.getBlend(),stencil:(0,T.getMask)(r,o)})]})),t}return(0,a.Z)(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.stroke,o=void 0===r?"#fff":r,a=t.strokeWidth,s=void 0===a?0:a,u=t.textAnchor,l=void 0===u?"center":u,c=t.textAllowOverlap,p=void 0!==c&&c,h=t.halo,f=void 0===h?.5:h,d=t.gamma,v=void 0===d?2:d,m=t.raisingHeight,y=void 0===m?0:m,g=this.fontService,_=g.canvas,x=g.mapping;if(Object.keys(x).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(x).length),this.preTextStyle={textAnchor:l,textAllowOverlap:p},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n,strokeWidth:s,stroke:o})){this.judgeStyleAttributes({opacity:n,strokeWidth:s,stroke:o});var b=this.layer.getEncodedData(),w=this.calDataFrame(this.cellLength,b,this.cellProperties),S=w.data,E=w.width,C=w.height;this.rowCount=C,this.dataTexture=this.cellLength>0&&S.length>0?this.createTexture2D({flipY:!0,data:S,format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:E,height:C}):this.createTexture2D({flipY:!0,data:[1],format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(y),u_opacity:Number(n),u_stroke_width:Number(s),u_stroke_color:this.getStrokeColor(o),u_sdf_map:this.texture,u_halo_blur:f,u_gamma_scale:v,u_sdf_map_size:[_.width,_.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var t=this.layer.getLayerConfig(),e=t.textAnchor,n=void 0===e?"center":e,r=t.textAllowOverlap,i=void 0===r||r;return this.preTextStyle={textAnchor:n,textAllowOverlap:i},this.buildModels()}},{key:"needUpdate",value:function(){var t=this.layer.getLayerConfig().textAllowOverlap,e=void 0!==t&&t,n=this.mapService.getZoom(),r=this.mapService.getBounds(),i=(0,T.boundsContains)(this.extent,r);return(!e&&(Math.abs(this.currentZoom-n)>1||!i)||e!==this.preTextStyle.textAllowOverlap)&&(this.reBuildModel(),!0)}},{key:"clearModels",value:function(){var t,e;null===(t=this.texture)||void 0===t||t.destroy(),null===(e=this.dataTexture)||void 0===e||e.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:i.AttributeType.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e,n,r){var i=t.rotate,o=void 0===i?0:i;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:i.AttributeType.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,n,r){return[n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e,n,r){var i=t.size,o=void 0===i?12:i;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:i.AttributeType.Attribute,descriptor:{name:"a_tex",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,n,r){return[n[3],n[4]]}}})}},{key:"textExtent",value:function(){var t=this.mapService.getBounds();return(0,T.padBounds)(t,.5)}},{key:"initTextFont",value:function(){var t=this.layer.getLayerConfig(),e=t.fontWeight,n=void 0===e?"400":e,r=t.fontFamily,i=void 0===r?"sans-serif":r,o=this.layer.getEncodedData(),a=[];o.forEach((function(t){var e,n=t.shape,r=void 0===n?"":n,i=tr(r=r.toString());try{for(i.s();!(e=i.n()).done;){var o=e.value;-1===a.indexOf(o)&&a.push(o)}}catch(t){i.e(t)}finally{i.f()}})),this.fontService.setFontOptions({characterSet:a,fontWeight:n,fontFamily:i,iconfont:!1})}},{key:"initIconFontTex",value:function(){var t=this.layer.getLayerConfig(),e=t.fontWeight,n=void 0===e?"400":e,r=t.fontFamily,i=void 0===r?"sans-serif":r,o=this.layer.getEncodedData(),a=[];o.forEach((function(t){var e=t.shape,n=void 0===e?"":e;n="".concat(n),-1===a.indexOf(n)&&a.push(n)})),this.fontService.setFontOptions({characterSet:a,fontWeight:n,fontFamily:i,iconfont:!0})}},{key:"generateGlyphLayout",value:function(t){var e=this,n=this.fontService.mapping,r=this.layer.getLayerConfig(),i=r.spacing,o=void 0===i?2:i,a=r.textAnchor,s=void 0===a?"center":a,u=this.layer.getEncodedData();this.glyphInfo=u.map((function(r){var i=r.shape,a=void 0===i?"":i,u=r.id,l=r.size,c=void 0===l?1:l,p=r.textOffset,h=void 0===p?[0,0]:p,f=function(t,e,n,r,i,o){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[0,0],s=arguments.length>7?arguments[7]:void 0,u=t.split("\n"),l=[],c={positionedGlyphs:l,top:a[1],bottom:a[1],left:a[0],right:a[0],lineCount:u.length,text:t};return s?$n(c,e,u,n,r,i,o):Jn(c,e,u,n,r,i,o),!!l.length&&c}(a.toString(),n,c,s,"left",o,h,t),d=function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,i=t.positionedGlyphs,o=[],a=qn(void 0===i?[]:i);try{for(a.s();!(e=a.n()).done;){var s=e.value,u=s.metrics,l=4,c=u.advance*s.scale/2,p=r?[s.x+c,s.y]:[0,0],h=r?[0,0]:[s.x+c+n[0],s.y+n[1]],f=(0-l)*s.scale-c+h[0],d=(0-l)*s.scale+h[1],v=f+u.width*s.scale,m=d+u.height*s.scale,y={x:f,y:d},g={x:v,y:d},_={x:f,y:m},x={x:v,y:m};o.push({tl:y,tr:g,bl:_,br:x,tex:u,glyphOffset:p})}}catch(t){a.e(t)}finally{a.f()}return o}(f,h,!1);return r.shaping=f,r.glyphQuads=d,r.centroid=jt(r.coordinates),r.originCentroid="GAODE2.x"===r.version?jt(r.originCoordinates):r.originCentroid=r.centroid,e.glyphInfoMap[u]={shaping:f,glyphQuads:d,centroid:jt(r.coordinates)},r}))}},{key:"filterGlyphs",value:function(){var t=this,e=this.layer.getLayerConfig(),n=e.padding,r=void 0===n?[4,4]:n,i=e.textAllowOverlap;if(!(void 0!==i&&i)){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var o=this.rendererService.getViewportSize(),a=o.width,s=o.height,u=new Wn(a,s);this.glyphInfo.filter((function(e){var n=e.shaping,i=e.id,o=void 0===i?0:i,a="GAODE2.x"===e.version?e.originCentroid:e.centroid,s=e.size/24,l=t.mapService.lngLatToContainer(a),c=u.placeCollisionBox({x1:n.left*s-r[0],x2:n.right*s+r[0],y1:n.top*s-r[1],y2:n.bottom*s+r[1],anchorPointX:l.x,anchorPointY:l.y}).box;return!(!c||!c.length)&&(u.insertCollisionBox(c,o),!0)})).forEach((function(e){t.glyphInfoMap[e.id]=e}))}}},{key:"initGlyph",value:function(){var t=this.layer.getLayerConfig().iconfont,e=void 0!==t&&t;e?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(e)}},{key:"updateTexture",value:function(){var t=this.rendererService.createTexture2D,e=this.fontService.canvas;this.textureHeight=e.height,this.texture&&this.texture.destroy(),this.texture=t({data:e,mag:i.gl.LINEAR,min:i.gl.LINEAR,width:e.width,height:e.height})}},{key:"reBuildModel",value:function(){var t=this.layer.getLayerConfig(),e=t.mask,n=void 0!==e&&e,r=t.maskInside,i=void 0===r||r;this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:ir,fragmentShader:rr,triangulation:or.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:(0,T.getMask)(n,i)})]}}]),n}(dt),sr={fillImage:kn,fill:An,radar:zn,image:In,normal:Nn,simplePoint:jn,extrude:Sn,text:ar,icon:On};function ur(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return lr(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return lr(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function lr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function cr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var pr=function(t){(0,u.Z)(n,t);var e=cr(n);function n(){var t;(0,o.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i)),(0,p.Z)((0,s.Z)(t),"type","PointLayer"),t}return(0,a.Z)(n,[{key:"buildModels",value:function(){var t=this.getModelType();this.layerModel=new sr[t](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var t=this.shapeOption,e=t.field,n=t.values,r=this.getLayerConfig(),i=r.shape2d,o=(r.shape3d,this.iconService.getIconMap());if(e&&-1!==(null==i?void 0:i.indexOf(e)))return"fill";if(n&&n instanceof Array){var a,s=ur(n);try{for(s.s();!(a=s.n()).done;){var u=a.value;if("string"==typeof u&&o.hasOwnProperty(u))return"image"}}catch(t){s.e(t)}finally{s.f()}}}return"normal"}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}}[this.getModelType()]}},{key:"getModelType",value:function(){if(this.layerType&&["fillImage","fill","radar","image","normal","simplePoint","extrude","text","icon"].includes(this.layerType))return this.layerType;var t=this.getEncodedData(),e=this.getLayerConfig(),n=e.shape2d,r=e.shape3d,i=this.iconService.getIconMap(),o=t.find((function(t){return t.hasOwnProperty("shape")}));if(o){var a=o.shape;return"dot"===a?"normal":"simple"===a?"simplePoint":"radar"===a?"radar":"fillImage"===a?"fillImage":-1!==(null==n?void 0:n.indexOf(a))?"fill":-1!==(null==r?void 0:r.indexOf(a))?"extrude":i.hasOwnProperty(a)?"image":""!==this.fontService.getGlyph(a)?"icon":"text"}return this.getModelTypeWillEmptyData()}}]),n}(ot);function hr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var fr=function(t){(0,u.Z)(n,t);var e=hr(n);function n(){var t;(0,o.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i)),(0,p.Z)((0,s.Z)(t),"texture",void 0),t}return(0,a.Z)(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.heightfixed,o=void 0!==r&&r,a=t.raisingHeight,s=void 0===a?0:a,u=t.topsurface,l=void 0===u||u,c=t.sidesurface,p=void 0===c||c,h=t.sourceColor,f=t.targetColor;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n})){this.judgeStyleAttributes({opacity:n});var d=this.layer.getEncodedData(),v=this.calDataFrame(this.cellLength,d,this.cellProperties),m=v.data,y=v.width,g=v.height;this.rowCount=g,this.dataTexture=this.cellLength>0&&m.length>0?this.createTexture2D({flipY:!0,data:m,format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:y,height:g}):this.createTexture2D({flipY:!0,data:[1],format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:1,height:1})}var _=0,x=[1,1,1,1],b=[1,1,1,1];return h&&f&&(x=(0,T.rgb2arr)(h),b=(0,T.rgb2arr)(f),_=1),{u_topsurface:Number(l),u_sidesurface:Number(p),u_heightfixed:Number(o),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(s),u_opacity:Number(n),u_linearColor:_,u_sourceColor:x,u_targetColor:b,u_texture:this.texture}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var t=this.layer.getLayerConfig(),e=t.mask,n=void 0!==e&&e,r=t.maskInside,o=void 0===r||r,a=this.getShaders(),s=a.frag,u=a.vert,l=a.type;return[this.layer.buildLayerModel({moduleName:l,vertexShader:u,fragmentShader:s,triangulation:se,stencil:(0,T.getMask)(n,o),cull:{enable:!0,face:i.gl.BACK}})]}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),e=t.pickLight;return t.mapTexture?{frag:'uniform sampler2D u_texture;\nuniform float u_opacity: 1.0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_linearColor: 0;\n\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\n\nvarying vec4 v_Color;\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n#pragma include "picking"\n\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  float isSide = styleMappingMat[0][3];\n  float lightWeight = styleMappingMat[3][1];\n  float topU = styleMappingMat[2][2];\n  float topV = styleMappingMat[2][3];\n\n  float sidey = styleMappingMat[3][0];\n  if(isSide < 1.0) {\n    // side face\n    if(u_sidesurface < 1.0) {\n      discard;\n    }\n\n    if(u_linearColor == 1.0) {\n      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\n      linearColor.rgb *= lightWeight;\n      gl_FragColor = linearColor;\n    } else {\n      gl_FragColor = v_Color;\n    }\n  } else {\n\n     // top face\n    if(u_topsurface < 1.0) {\n      discard;\n    }\n\n    gl_FragColor = texture2D(u_texture, vec2(topU, topV));\n  }\n  \n\n  gl_FragColor.a *= opacity;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'precision highp float;\n\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec3 a_uvs;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nvarying vec4 v_Color;\nuniform float u_heightfixed: 0.0; // 默认不固定\nuniform float u_raisingHeight: 0.0;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n  v_Color = a_Color;\n\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - a_Position.z(judge side by a_Position.z)\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - u - v\n    0.0, 0.0, 0.0, 0.0  // sidey\n  );\n  \n  styleMappingMat[0][3] = a_Position.z;\n  styleMappingMat[2][2] = a_uvs[0];\n  styleMappingMat[2][3] = 1.0 - a_uvs[1];\n  styleMappingMat[3][0] = a_uvs[2];\n\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  vec4 project_pos = project_position(pos);\n\n  if(u_heightfixed > 0.0) { // 判断几何体是否固定高度\n    project_pos.z = a_Position.z * a_Size;\n    project_pos.z += u_raisingHeight;\n\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      project_pos.z *= mapboxZoomScale;\n      project_pos.z += u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n  // project_pos.z += 500000.0; // amap1\n\n  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  float lightWeight = calc_lighting(pos);\n  styleMappingMat[3][1] = lightWeight;\n\n  setPickingColor(a_PickingColor);\n}\n',type:"polygonExtrudeTexture"}:e?{frag:'uniform float u_opacity: 1.0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_linearColor: 0;\n\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\n\nvarying vec4 v_Color;\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n#pragma include "picking"\n\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  float isSide = styleMappingMat[0][3];\n  float sidey = styleMappingMat[3][0];\n  float lightWeight = styleMappingMat[3][1];\n\n  if(isSide < 1.0) {\n    // side face\n    if(u_sidesurface < 1.0) {\n      discard;\n    }\n    \n    if( u_linearColor == 1.0) {\n      // side use linear\n      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\n      linearColor.rgb *= lightWeight;\n      gl_FragColor = linearColor;\n    } else {\n      // side notuse linear\n       gl_FragColor = v_Color;\n    }\n  } else {\n    // top face\n    if(u_topsurface < 1.0) {\n      discard;\n    }\n    gl_FragColor = v_Color;\n  }\n\n  gl_FragColor.a *= opacity;\n  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);\n}\n',vert:'precision highp float;\n\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec3 a_uvs;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nvarying vec4 v_Color;\nuniform float u_heightfixed: 0.0; // 默认不固定\nuniform float u_raisingHeight: 0.0;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0  // sidey\n  );\n  styleMappingMat[0][3] = a_Position.z;\n  styleMappingMat[3][0] = a_uvs[2];\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  vec4 project_pos = project_position(pos);\n\n  if(u_heightfixed > 0.0) { // 判断几何体是否固定高度\n    project_pos.z = a_Position.z * a_Size;\n    project_pos.z += u_raisingHeight;\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      project_pos.z *= mapboxZoomScale;\n      project_pos.z += u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  float lightWeight = calc_lighting(pos);\n  // v_Color = a_Color;\n  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);\n\n  styleMappingMat[3][1] = lightWeight;\n\n  setPickingColor(a_PickingColor);\n}\n',type:"polygonExtrudePickLight"}:{frag:'uniform float u_opacity: 1.0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_linearColor: 0;\n\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\n\nvarying vec4 v_Color;\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n#pragma include "picking"\n\nvoid main() {\n  float opacity = styleMappingMat[0][0];  \n  float isSide = styleMappingMat[0][3];\n  float sidey = styleMappingMat[3][0];\n  float lightWeight = styleMappingMat[3][1];\n\n  if(isSide < 1.0) {\n    // side face\n    if(u_sidesurface < 1.0) {\n      discard;\n    }\n\n    if(u_linearColor == 1.0) {\n      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\n      linearColor.rgb *= lightWeight;\n      gl_FragColor = linearColor;\n    } else {\n      gl_FragColor = v_Color;\n    }\n\n  } else {\n     // top face\n    if(u_topsurface < 1.0) {\n      discard;\n    }\n\n    gl_FragColor = v_Color;\n  }\n\n  gl_FragColor.a *= opacity;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'precision highp float;\n\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec3 a_uvs;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nvarying vec4 v_Color;\nuniform float u_heightfixed: 0.0; // 默认不固定\nuniform float u_raisingHeight: 0.0;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0  // sidey\n  );\n  styleMappingMat[0][3] = a_Position.z;\n  styleMappingMat[3][0] = a_uvs[2];\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  vec4 project_pos = project_position(pos);\n\n  if(u_heightfixed > 0.0) { // 判断几何体是否固定高度\n    project_pos.z = a_Position.z * a_Size;\n    project_pos.z += u_raisingHeight;\n\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      project_pos.z *= mapboxZoomScale;\n      project_pos.z += u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n  // project_pos.z += 500000.0; // amap1\n\n  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  float lightWeight = calc_lighting(pos);\n  // v_Color = a_Color;\n  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);\n\n  styleMappingMat[3][1] = lightWeight;\n\n  setPickingColor(a_PickingColor);\n}\n',type:"polygonExtrude"}}},{key:"clearModels",value:function(){var t,e;null===(t=this.dataTexture)||void 0===t||t.destroy(),null===(e=this.texture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getSource().extent,e=(0,B.Z)(t,4),n=e[0],r=e[1],o=e[2],a=e[3],s=o-n,u=a-r;this.styleAttributeService.registerStyleAttribute({name:"uvs",type:i.AttributeType.Attribute,descriptor:{name:"a_uvs",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e,i,o,a){var l=i[0],c=i[1];return[(l-n)/s,(c-r)/u,i[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:i.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e,n,r){var i=t.size,o=void 0===i?10:i;return Array.isArray(o)?[o[0]]:[o]}}})}},{key:"loadTexture",value:function(){var t=this,e=this.layer.getLayerConfig().mapTexture,n=this.rendererService.createTexture2D;if(this.texture=n({height:0,width:0}),e){var r=new Image;r.crossOrigin="",r.src=e,r.onload=function(){t.texture=n({data:r,width:r.width,height:r.height,wrapS:i.gl.CLAMP_TO_EDGE,wrapT:i.gl.CLAMP_TO_EDGE,min:i.gl.LINEAR,mag:i.gl.LINEAR}),t.layerService.updateLayerRenderList(),t.layerService.renderLayers()}}}}]),n}(dt);function dr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var vr=function(t){(0,u.Z)(n,t);var e=dr(n);function n(){return(0,o.Z)(this,n),e.apply(this,arguments)}return(0,a.Z)(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.raisingHeight,n=void 0===e?0:e,r=t.opacity,o=void 0===r?1:r,a=t.opacityLinear,s=void 0===a?{enable:!1,dir:"in"}:a;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var u=this.layer.getEncodedData(),l=this.calDataFrame(this.cellLength,u,this.cellProperties),c=l.data,p=l.width,h=l.height;this.rowCount=h,this.dataTexture=this.cellLength>0&&c.length>0?this.createTexture2D({flipY:!0,data:c,format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:p,height:h}):this.createTexture2D({flipY:!0,data:[1],format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(n),u_opacity:o,u_opacitylinear:Number(s.enable),u_dir:"in"===s.dir?1:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var t=this.getModelParams(),e=t.frag,n=t.vert,r=t.triangulation,o=t.type,a=this.layer.getLayerConfig(),s=a.mask,u=void 0!==s&&s,l=a.maskInside,c=void 0===l||l;return this.layer.triangulation=r,[this.layer.buildLayerModel({moduleName:o,vertexShader:n,fragmentShader:e,triangulation:r,blend:this.getBlend(),depth:{enable:!1},cull:{enable:!0,face:i.gl.BACK},stencil:(0,T.getMask)(u,c)})]}},{key:"clearModels",value:function(){var t;null===(t=this.dataTexture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getLayerConfig().opacityLinear;(void 0===t?{enable:!1,dir:"in"}:t).enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:i.AttributeType.Attribute,descriptor:{name:"a_linear",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e,n,r,i){return[n[3],n[4],n[5]]}}})}},{key:"getModelParams",value:function(){var t=this.layer.getLayerConfig().opacityLinear;return(void 0===t?{enable:!1}:t).enable?{frag:'uniform float u_opacity: 1.0;\nvarying vec4 v_Color;\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n\n#pragma include "picking"\nuniform float u_opacitylinear: 0.0;\nuniform float u_dir: 1.0;\nvarying vec3 v_linear;\nvarying vec2 v_pos;\n\n\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  gl_FragColor = v_Color;\n  \n  if(u_opacitylinear > 0.0) {\n    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;\n  }\n\n  gl_FragColor.a *= opacity;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'attribute vec4 a_Color;\nattribute vec3 a_Position;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_opacity: 1.0;\nuniform float u_raisingHeight: 0.0;\n\nvarying vec4 v_Color;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "picking"\n\nuniform float u_opacitylinear: 0.0;\n\nattribute vec3 a_linear;\nvarying vec3 v_linear;\nvarying vec2 v_pos;\n\nvoid main() {\n  if(u_opacitylinear > 0.0) {\n    v_linear = a_linear;\n    v_pos = a_Position.xy;\n  }\n  \n  // cal style mapping - 数据纹理映射部分的计算\nstyleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n  v_Color = a_Color;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  project_pos.z += u_raisingHeight;\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n    project_pos.z *= mapboxZoomScale;\n    project_pos.z += u_raisingHeight * mapboxZoomScale;\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}',type:"polygon_linear",triangulation:oe}:{frag:'uniform float u_opacity: 1.0;\nvarying vec4 v_Color;\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  gl_FragColor = v_Color;\n  gl_FragColor.a *= opacity;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'attribute vec4 a_Color;\nattribute vec3 a_Position;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nuniform float u_opacity: 1.0;\nuniform float u_raisingHeight: 0.0;\n\nvarying vec4 v_Color;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\nstyleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n  v_Color = a_Color;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  project_pos.z += u_raisingHeight;\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n    project_pos.z *= mapboxZoomScale;\n    project_pos.z += u_raisingHeight * mapboxZoomScale;\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n\n',type:"polygon_fill",triangulation:ie}}}]),n}(dt);function mr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var yr=function(t){(0,u.Z)(n,t);var e=mr(n);function n(){var t;(0,o.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i)),(0,p.Z)((0,s.Z)(t),"texture1",void 0),(0,p.Z)((0,s.Z)(t),"texture2",void 0),(0,p.Z)((0,s.Z)(t),"texture3",void 0),t}return(0,a.Z)(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.watercolor,o=void 0===r?"#6D99A8":r,a=t.watercolor2,s=void 0===a?"#0F121C":a;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n})){this.judgeStyleAttributes({opacity:n});var u=this.layer.getEncodedData(),l=this.calDataFrame(this.cellLength,u,this.cellProperties),c=l.data,p=l.width,h=l.height;this.rowCount=h,this.dataTexture=this.cellLength>0&&c.length>0?this.createTexture2D({flipY:!0,data:c,format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:p,height:h}):this.createTexture2D({flipY:!0,data:[1],format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:1,height:1})}return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:(0,T.rgb2arr)(o),u_watercolor2:(0,T.rgb2arr)(s),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:n}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var t=this.layer.getLayerConfig(),e=t.mask,n=void 0!==e&&e,r=t.maskInside,i=void 0===r||r;return[this.layer.buildLayerModel({moduleName:"polygon_ocean",vertexShader:'attribute vec2 a_uv;\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nvarying vec2 v_uv;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n\nvoid main() {\n  v_uv = a_uv;\n  // cal style mapping - 数据纹理映射部分的计算\nstyleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n}\n\n',fragmentShader:"\nuniform float u_time: 0.0;\nuniform float u_opacity: 1.0;\n\nvarying vec2 v_uv;\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n\nfloat coast2water_fadedepth = 0.10;\nfloat large_waveheight      = .750; // change to adjust the \"heavy\" waves\nfloat large_wavesize        = 3.4;  // factor to adjust the large wave size\nfloat small_waveheight      = 0.6;  // change to adjust the small random waves\nfloat small_wavesize        = 0.5;   // factor to ajust the small wave size\nfloat water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)\nfloat water_glossylight_fact= 120.; // range [1..200]\nfloat particle_amount       = 70.;\n// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)\n// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)\nuniform vec4 u_watercolor;\nuniform vec4 u_watercolor2;\nvec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights\n#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun\n\nuniform sampler2D u_texture1;\nuniform sampler2D u_texture2;\nuniform sampler2D u_texture3;\n\n  \n\nfloat hash( float n ) {\n    return fract(sin(n)*43758.5453123);\n}\n\n// 2d noise function\nfloat noise1( in vec2 x ) {\n  vec2 p  = floor(x);\n  vec2 f  = smoothstep(0.0, 1.0, fract(x));\n  float n = p.x + p.y*57.0;\n  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),\n    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);\n}\n\nfloat noise(vec2 p) {\n    return texture2D(u_texture2,p*vec2(1./256.)).x;\n}\n\nvec4 highness(vec2 p) {\n    vec4 t = texture2D(u_texture1,fract(p));\n    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;\n    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);\n}\n\nfloat height_map( vec2 p ) {\n    vec4 height=highness(p);\n    /*\n    height = -0.5+\n        0.5*smoothstep(-100.,0.,-height)+\n        2.75*smoothstep(0.,2.,height)+\n        1.75*smoothstep(2.,4.,height)+\n        2.75*smoothstep(4.,16.,height)+\n        1.5*smoothstep(16.,1000.,height);\n    */\n\n    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );\n    //p = p*6.;\n    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;\n    f += 0.2500*noise( p ); p = m*p*1.32;\n    f += 0.1666*noise( p ); p = m*p*1.11;\n    f += 0.0834*noise( p ); p = m*p*1.12;\n    f += 0.0634*noise( p ); p = m*p*1.13;\n    f += 0.0444*noise( p ); p = m*p*1.14;\n    f += 0.0274*noise( p ); p = m*p*1.15;\n    f += 0.0134*noise( p ); p = m*p*1.16;\n    f += 0.0104*noise( p ); p = m*p*1.17;\n    f += 0.0084*noise( p );\n    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;\n        const float FLAT_LEVEL = 0.92525;\n        //f = f*0.25+height*0.75;\n    if (f<FLAT_LEVEL)\n        f = f;\n    else\n        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase\n    return clamp(f, 0., 10.);\n}\n\nvec3 plasma_quintic( float x ) {\n    x = clamp( x, 0.0, 1.0);\n    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3\n    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7\n    return vec3(\n        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),\n        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),\n        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );\n}\n\nvec4 color(vec2 p){\n    vec4 c1 = vec4(1.7,1.6,.9,1);\n    vec4 c2 = vec4(.2,.94,.1,1);\n    vec4 c3 = vec4(.3,.2,.0,1);\n    vec4 c4 = vec4(.99,.99,1.6,1);\n    vec4 v = highness(p);\n    float los = smoothstep(0.1,1.1,v.b);\n    float his = smoothstep(3.5,6.5,v.b);\n    float ces = smoothstep(1.,5.,v.a);\n    vec4 lo = mix(c1,c2,los);\n    vec4 hi = mix(c3,c4,his);\n    vec4 ce = mix(lo,hi,ces);\n\n    return vec4(plasma_quintic(ces),1).ragb;\n}\n\nvec3 terrain_map( vec2 p )\n{\n  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'\n}\n\nconst mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );\n\nfloat water_map( vec2 p, float height ) {\n    vec2 p2 = p*large_wavesize;\n    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );\n    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );\n\n    // coarse crossing 'ocean' waves...\n    float f = 0.6000*noise( p );\n    f += 0.2500*noise( p*m );\n    f += 0.1666*noise( p*m*m );\n    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;\n\n    p *= small_wavesize;\n    f = 0.;\n    float amp = 1.0, s = .5;\n    for (int i=0; i<9; i++)\n    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }\n    \n    return wave+f*small_waveheight;\n}\n\nfloat nautic(vec2 p) {\n    p *= 18.;\n    float f = 0.;\n    float amp = 1.0, s = .5;\n    for (int i=0; i<3; i++)\n    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }\n    return pow(1.-f, 5.);\n}\n\nfloat particles(vec2 p) {\n    p *= 200.;\n    float f = 0.;\n    float amp = 1.0, s = 1.5;\n    for (int i=0; i<3; i++)\n    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }\n    return pow(f*.35, 7.)*particle_amount;\n}\n\nfloat test_shadow( vec2 xy, float height) {\n    vec3 r0 = vec3(xy, height);\n    vec3 rd = normalize( light - r0 );\n    \n    float hit = 1.0;\n    float t   = 0.001;\n    for (int j=1; j<25; j++)\n    {\n        vec3 p = r0 + t*rd;\n        float h = height_map( p.xy );\n        float height_diff = p.z - h;\n        if (height_diff<0.0)\n        {\n            return 0.0;\n        }\n        t += 0.01+height_diff*.02;\n        hit = min(hit, 2.*height_diff/t); // soft shaddow   \n    }\n    return hit;\n}\n\nvec3 CalcTerrain(vec2 uv, float height) {\n    vec3 col = terrain_map( uv );\n    vec2 iResolution = vec2(512.);\n    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);\n    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);\n    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);\n    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);\n    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));\n    vec3 r0 = vec3(uv, height);\n    vec3 rd = normalize( light - r0 );\n    float grad = dot(norm, rd);\n    col *= grad+pow(grad, 8.);\n    float terrainshade = test_shadow( uv, height );\n    col = mix(col*.25, col, terrainshade);\n    return col;\n}\n\n\nvoid main() {\n  vec3 watercolor = u_watercolor.rgb;\n  vec3 watercolor2 = u_watercolor2.rgb;\n  vec2 uv = v_uv;\n  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)\n  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;\n  float height = height_map( uv );\n  vec3 col;\n\n    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);\n    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);\n    if (height > level)\n    {\n        col = CalcTerrain(uv, height);\n    }\n    if (height <= level)\n    {\n        vec2 dif = vec2(.0, .01);\n        vec2 pos = uv*15. + vec2(u_time*.01);\n        float h1 = water_map(pos-dif,waveheight);\n        float h2 = water_map(pos+dif,waveheight);\n        float h3 = water_map(pos-dif.yx,waveheight);\n        float h4 = water_map(pos+dif.yx,waveheight);\n        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane\n        uv += normwater.xy*.002*(level-height);\n        \n        col = CalcTerrain(uv, height);\n\n        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);\n        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);\n        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;\n        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));\n\n        vec3 r0 = vec3(uv, WATER_LEVEL);\n        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position\n        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction\n        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          \n        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights\n        float gradpos  = dot(vec3(0., 0., 1.), rd);\n        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          \n        float watershade  = test_shadow( uv, level );\n        watercolor *= 2.2+watershade;\n        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;\n        watercolor /= (1.+specular1*1.25);\n        watercolor += watershade*specular2*water_specularcolor;\n        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));\n        \n        col = mix(col, watercolor, coastfade);\n    }\n    \n\n  float opacity = styleMappingMat[0][0];\n  gl_FragColor = vec4(col, opacity);  \n}\n",triangulation:ie,depth:{enable:!1},stencil:(0,T.getMask)(n,i)})]}},{key:"clearModels",value:function(){var t,e,n,r;null===(t=this.texture1)||void 0===t||t.destroy(),null===(e=this.texture2)||void 0===e||e.destroy(),null===(n=this.texture3)||void 0===n||n.destroy(),null===(r=this.dataTexture)||void 0===r||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getSource().extent,e=(0,B.Z)(t,4),n=e[0],r=e[1],o=e[2],a=e[3],s=o-n,u=a-r;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:i.AttributeType.Attribute,descriptor:{name:"a_uv",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,i,o,a){var l=(0,B.Z)(i,2),c=l[0],p=l[1];return[(c-n)/s,(p-r)/u]}}})}},{key:"loadTexture",value:function(){var t,e,n,r=this,o=this.rendererService.createTexture2D,a={height:0,width:0};function s(t){return o({data:t,width:t.width,height:t.height,wrapS:i.gl.MIRRORED_REPEAT,wrapT:i.gl.MIRRORED_REPEAT,min:i.gl.LINEAR,mag:i.gl.LINEAR})}this.texture1=o(a),this.texture2=o(a),this.texture3=o(a),t=function(t){r.texture1=s(t[0]),r.texture2=s(t[1]),r.texture3=s(t[2]),r.layerService.updateLayerRenderList(),r.layerService.renderLayers()},e=0,n=[],["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"].map((function(r){var i=new Image;i.crossOrigin="",i.src=r,n.push(i),i.onload=function(){3==++e&&t(n)}}))}}]),n}(dt),gr=n(25108);function _r(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var xr=function(t){(0,u.Z)(n,t);var e=_r(n);function n(){var t;(0,o.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i)),(0,p.Z)((0,s.Z)(t),"texture",void 0),t}return(0,a.Z)(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.speed,o=void 0===r?.5:r;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n})){this.judgeStyleAttributes({opacity:n});var a=this.layer.getEncodedData(),s=this.calDataFrame(this.cellLength,a,this.cellProperties),u=s.data,l=s.width,c=s.height;this.rowCount=c,this.dataTexture=this.cellLength>0&&u.length>0?this.createTexture2D({flipY:!0,data:u,format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:l,height:c}):this.createTexture2D({flipY:!0,data:[1],format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:1,height:1})}return{u_texture:this.texture,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_speed:o,u_opacity:n}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var t=this.layer.getLayerConfig(),e=t.mask,n=void 0!==e&&e,r=t.maskInside,i=void 0===r||r;return[this.layer.buildLayerModel({moduleName:"polygon_water",vertexShader:'attribute vec4 a_Color;\nattribute vec2 a_uv;\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nvarying vec4 v_Color;\nvarying vec2 v_uv;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n\nvoid main() {\n  v_uv = a_uv;\n  // cal style mapping - 数据纹理映射部分的计算\nstyleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n  v_Color = a_Color;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n}\n\n',fragmentShader:"uniform sampler2D u_texture;\nuniform float u_time: 0.0;\nuniform float u_speed: 1.0;\nuniform float u_opacity: 1.0;\n\nvarying vec4 v_Color;\nvarying vec2 v_uv;\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n\n\nfloat rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }\n\nfloat water(vec3 p) {\n  float t = u_time * u_speed;\n  p.z += t * 2.; p.x += t * 2.;\n  vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;\n  p.z += t * 3.; p.x += t * 0.52;\n  vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;\n  p.z += t * 4.; p.x += t * 0.8;\n  vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;\n  c1 += c2 - c3;\n  float z = (c1.x + c1.y + c1.z) / 3.;\n  return p.y + z / 4.;\n}\n\nfloat map(vec3 p) {\n  float d = 100.0;\n  d = water(p);\n  return d;\n}\n\nfloat intersect(vec3 ro, vec3 rd) {\n  float d = 0.0;\n  for (int i = 0; i <= 100; i++) {\n    float h = map(ro + rd * d);\n    if (h < 0.1) return  d;\n    d += h;\n  }\n  return 0.0;\n}\n\nvec3 norm(vec3 p) {\n  float eps = .1;\n  return normalize(vec3(\n    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),\n    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),\n    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))\n  ));\n} \n\nfloat calSpc() {\n  vec3 l1 = normalize(vec3(1, 1, 1));\n  vec3 ro = vec3(-3, 20, -8);\n  vec3 rc = vec3(0, 0, 0);\n  vec3 ww = normalize(rc - ro);\n  vec3 uu = normalize(cross(vec3(0,1,0), ww));\n  vec3 vv = normalize(cross(rc - ro, uu));\n  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);\n  float d = intersect(ro, rd);\n  vec3 p = ro + rd * d;\n  vec3 n = norm(p);\n  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);\n  return spc;\n}\n\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  gl_FragColor = v_Color;\n  gl_FragColor.a *= opacity;\n\n  float spc = calSpc();\n  gl_FragColor += spc * 0.4;\n}\n",triangulation:ie,depth:{enable:!1},stencil:(0,T.getMask)(n,i)})]}},{key:"clearModels",value:function(){var t,e;null===(t=this.texture)||void 0===t||t.destroy(),null===(e=this.dataTexture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getSource().extent,e=(0,B.Z)(t,4),n=e[0],r=e[1],o=e[2],a=e[3],s=o-n,u=a-r;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:i.AttributeType.Attribute,descriptor:{name:"a_uv",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,i,o,a){var l=(0,B.Z)(i,2),c=l[0],p=l[1];return[(c-n)/s,(p-r)/u]}}})}},{key:"loadTexture",value:function(){var t=this,e=this.layer.getLayerConfig().waterTexture,n=this.rendererService.createTexture2D;this.texture=n({height:0,width:0});var r=new Image;r.crossOrigin="",e?(gr.warn("L7 recommend：https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),r.src=e):r.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",r.onload=function(){t.texture=n({data:r,width:r.width,height:r.height,wrapS:i.gl.MIRRORED_REPEAT,wrapT:i.gl.MIRRORED_REPEAT,min:i.gl.LINEAR,mag:i.gl.LINEAR}),t.layerService.updateLayerRenderList(),t.layerService.renderLayers()}}}]),n}(dt),br={fill:vr,line:pn,extrude:fr,text:ar,point_fill:An,point_image:In,point_normal:Nn,point_extrude:Sn,water:xr,ocean:yr};function wr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var Sr=function(t){(0,u.Z)(n,t);var e=wr(n);function n(){var t;(0,o.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i)),(0,p.Z)((0,s.Z)(t),"type","PolygonLayer"),t}return(0,a.Z)(n,[{key:"buildModels",value:function(){var t=this.getModelType();this.layerModel=new br[t](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var t,e=this.styleAttributeService.getLayerStyleAttribute("shape"),n=null==e||null===(t=e.scale)||void 0===t?void 0:t.field;return"fill"===n?"fill":"extrude"===n?"extrude":"water"===n?"water":"ocean"===n?"ocean":"line"===n?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var t=this.getEncodedData(),e=this.getLayerConfig(),n=e.shape2d,r=e.shape3d,i=this.iconService.getIconMap(),o=t.find((function(t){return t.hasOwnProperty("shape")}));if(o){var a=o.shape;return"dot"===a?"point_normal":-1!==(null==n?void 0:n.indexOf(a))?"point_fill":-1!==(null==r?void 0:r.indexOf(a))?"point_extrude":i.hasOwnProperty(a)?"point_image":"text"}return"fill"}}]),n}(ot);function Er(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var Cr=function(t){(0,u.Z)(n,t);var e=Er(n);function n(){var t;(0,o.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i)),(0,p.Z)((0,s.Z)(t),"isLayerGroup",!0),t}return(0,a.Z)(n,[{key:"addChild",value:function(t){this.layerChildren.push(t)}},{key:"removeChild",value:function(t){var e=this.layerChildren.indexOf(t);e>-1&&this.layerChildren.splice(e,1),t.destroy()}},{key:"clearChild",value:function(){this.layerChildren.forEach((function(t){t.destroy()})),this.layerChildren=[]}},{key:"hasChild",value:function(t){return this.layerChildren.includes(t)}}]),n}(ot);function Tr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var Ar=function(t){(0,u.Z)(n,t);var e=Tr(n);function n(){var t;(0,o.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i)),(0,p.Z)((0,s.Z)(t),"initedTileset",!1),(0,p.Z)((0,s.Z)(t),"tilesetManager",void 0),(0,p.Z)((0,s.Z)(t),"showGrid",!1),(0,p.Z)((0,s.Z)(t),"subGridLayer",void 0),(0,p.Z)((0,s.Z)(t),"subTextLayer",void 0),(0,p.Z)((0,s.Z)(t),"lastViewStates",void 0),(0,p.Z)((0,s.Z)(t),"timer",void 0),(0,p.Z)((0,s.Z)(t),"renderSubLayers",(function(){if(t.tilesetManager){var e=t.layer;t.tilesetManager.tiles.filter((function(t){return t.isLoaded})).map((function(n){return n.layer?n.layer.updateLayerConfig({visible:n.isVisible}):(n.layer=t.creatSubLayer(n),e.addChild(n.layer)),n.layer})),t.showGrid&&(e.hasChild(t.subGridLayer)||e.addChild(t.subGridLayer),e.hasChild(t.subTextLayer)||e.addChild(t.subTextLayer)),t.layerService.renderLayers(),t.tilesetManager.isLoaded&&e.emit("tiles-loaded",t.tilesetManager.currentTiles)}})),t}return(0,a.Z)(n,[{key:"getUninforms",value:function(){return{}}},{key:"initModels",value:function(){var t,e=this.layer.getSource();this.tilesetManager=e.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0);var n=this.getCurrentView(),r=n.latLonBounds,i=n.zoom;return null===(t=this.tilesetManager)||void 0===t||t.update(i,r),this.showGrid&&this.renderSubGridLayer(),this.buildModels()}},{key:"buildModels",value:function(){return[]}},{key:"clearModels",value:function(){}},{key:"renderSubGridLayer",value:function(){if(this.tilesetManager){var t={type:"FeatureCollection",features:this.tilesetManager.currentTiles.map((function(t){return t.bboxPolygon}))};if(this.subGridLayer)return this.subGridLayer.setData(t),void this.subTextLayer.setData(t);this.subGridLayer=new bn({autoFit:!1}).source(t).size(1).color("red").shape("simple").style({lineType:"dash",dashArray:[1,2]}),this.subTextLayer=new pr({autoFit:!1}).source(t).size(14).color("red").shape("meta","text").style({opacity:1,strokeWidth:1,stroke:"#fff"}),this.subGridLayer.setContainer((0,i.createLayerContainer)(this.layer.sceneContainer),this.layer.sceneContainer),this.subTextLayer.setContainer((0,i.createLayerContainer)(this.layer.sceneContainer),this.layer.sceneContainer),this.subGridLayer.init(),this.subTextLayer.init()}}},{key:"registerBuiltinAttributes",value:function(){}},{key:"bindTilesetEvent",value:function(){var t=this;this.tilesetManager&&(this.tilesetManager.on("tile-loaded",(function(t){})),this.tilesetManager.on("tile-unload",(function(e){t.destroySubLayer(e)})),this.tilesetManager.on("tile-error",(function(t,e){})),this.tilesetManager.on("tile-update",this.renderSubLayers),this.mapService.on("mapchange",(function(e){var n=t.getCurrentView(),r=n.latLonBounds,i=n.zoom;if("GAODE1.x"===t.mapService.version){var o=t.layer.getLayerConfig().visible;i<3&&o?(t.layer.updateLayerConfig({visible:!1}),t.layerService.updateLayerRenderList()):i>=3&&!o&&(t.layer.updateLayerConfig({visible:!0}),t.layerService.updateLayerRenderList())}t.lastViewStates&&t.lastViewStates.zoom===i&&t.lastViewStates.latLonBounds.toString()===r.toString()||(t.lastViewStates={zoom:i,latLonBounds:r},t.timer&&(clearTimeout(t.timer),t.timer=null),t.timer=setTimeout((function(){var e;null===(e=t.tilesetManager)||void 0===e||e.update(i,r),t.showGrid&&t.renderSubGridLayer()}),250))})))}},{key:"creatSubLayer",value:function(t){var e=this.layer.getLayerConfig(),n=e.opacity,r=void 0===n?1:n,o=e.zIndex,a=void 0===o?0:o,s=new Ye({visible:t.isVisible,zIndex:a}).source(t.data,{parser:{type:"image",extent:t.bounds}}).style({opacity:r}),u=(0,i.createLayerContainer)(this.layer.sceneContainer);return s.setContainer(u,this.layer.sceneContainer),s.init(),s}},{key:"destroySubLayer",value:function(t){t.layer&&this.layer.removeChild(t.layer)}},{key:"getCurrentView",value:function(){var t=this.mapService.getBounds();return{latLonBounds:[t[0][0],t[0][1],t[1][0],t[1][1]],zoom:this.mapService.getZoom()}}}]),n}(dt);function Mr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var kr=function(t){(0,u.Z)(n,t);var e=Mr(n);function n(){var t;(0,o.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i)),(0,p.Z)((0,s.Z)(t),"texture",void 0),(0,p.Z)((0,s.Z)(t),"colorTexture",void 0),t}return(0,a.Z)(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.clampLow,i=void 0===r||r,o=t.clampHigh,a=void 0===o||o,s=t.noDataValue,u=void 0===s?-9999999:s,l=t.domain,c=void 0===l?[0,1]:l;return this.updateColorTexure(),{u_opacity:n||1,u_texture:this.texture,u_domain:c,u_clampLow:i,u_clampHigh:void 0!==a?a:i,u_noDataValue:u,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){this.layer.isLayerGroup=!1;var t=this.layer.getLayerConfig(),e=t.mask,n=void 0!==e&&e,r=t.maskInside,o=void 0===r||r,a=this.layer.getSource(),s=this.rendererService.createTexture2D,u=a.data.dataArray[0];this.texture=s({data:u.data,width:u.width,height:u.height,format:i.gl.LUMINANCE,type:i.gl.FLOAT});var l=this.layer.getLayerConfig().rampColors,c=(0,T.generateColorRamp)(l);return this.colorTexture=s({data:c.data,width:c.width,height:c.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   }\n}\n',fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\nuniform float u_min;\nuniform float u_max;\nuniform vec2 u_domain;\nuniform float u_noDataValue;\nuniform bool u_clampLow: true;\nuniform bool u_clampHigh: true;\nvarying vec2 v_texCoord;\n\nvoid main() {\n\n  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;\n  if (value == u_noDataValue)\n    gl_FragColor = vec4(0.0, 0, 0, 0.0);\n  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))\n    gl_FragColor = vec4(0, 0, 0, 0);\n  else {\n    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);\n    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));\n    gl_FragColor = color;\n    gl_FragColor.a =  gl_FragColor.a * u_opacity ;\n  }\n\n\n}\n",triangulation:le,primitive:i.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:(0,T.getMask)(n,o)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,n,r){return[n[3],n[4]]}}})}},{key:"updateColorTexure",value:function(){var t=this.rendererService.createTexture2D,e=this.layer.getLayerConfig().rampColors,n=(0,T.generateColorRamp)(e);this.colorTexture=t({data:n.data,width:n.width,height:n.height,flipY:!1})}}]),n}(dt),Pr={raster:kr,raster3d:kr,rasterTile:Ar};function Or(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var Lr=function(t){(0,u.Z)(n,t);var e=Or(n);function n(){var t;(0,o.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i)),(0,p.Z)((0,s.Z)(t),"type","RasterLayer"),t}return(0,a.Z)(n,[{key:"buildModels",value:function(){var t=this.getModelType();this.layerModel=new Pr[t](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{raster:{},raster3d:{},rasterTile:{}}[this.getModelType()]}},{key:"getModelType",value:function(){switch(this.layerSource.parser.type){case"raster":default:return"raster";case"rasterTile":return"rasterTile"}}}]),n}(Cr);function Ir(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var Rr=function(t){(0,u.Z)(n,t);var e=Ir(n);function n(){return(0,o.Z)(this,n),e.apply(this,arguments)}return(0,a.Z)(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig().opacity,e=void 0===t?1:t;return{u_opacity:L()(e)?e:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:function(){return this.layer.zIndex=-997,[this.layer.buildLayerModel({moduleName:"earthAtmoSphere",vertexShader:"\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute vec2 a_Uv;\nattribute vec4 a_Color;\nuniform vec3 u_CameraPosition;\nvarying float v_CamreaDistance;\n\nuniform mat4 u_ViewProjectionMatrix;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_ViewMatrix;\n\nvarying vec3 vVertexNormal;\nvarying vec4 v_Color;\nvarying float v_offset;\n\nvoid main() {\n    float EARTH_RADIUS = 100.0;\n    \n    v_Color = a_Color;\n\n    v_offset = min(((length(u_CameraPosition) - EARTH_RADIUS)/600.0) * 0.5 + 0.4, 1.0);\n    vVertexNormal = a_Normal;\n\n    gl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\n}\n",fragmentShader:"\nuniform float u_opacity;\nuniform vec3 u_CameraPosition;\n\nvarying vec3 vVertexNormal;\nvarying float v_offset;\nvarying vec4 v_Color;\nvoid main() {\n    \n    \n    // float intensity = pow(0.5 + dot(normalize(vVertexNormal), normalize(u_CameraPosition)), 3.0);\n    float intensity = pow(v_offset + dot(normalize(vVertexNormal), normalize(u_CameraPosition)), 3.0);\n    // TODO: 去除背面\n    if(intensity > 1.0) intensity = 0.0;\n\n    gl_FragColor = vec4(v_Color.rgb, v_Color.a * intensity * u_opacity);\n}\n",triangulation:fe,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e,n,r){var i=t.size,o=void 0===i?1:i;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:i.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,n,r){return[n[3],n[4]]}}})}}]),n}(dt);function Dr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var Nr=function(t){(0,u.Z)(n,t);var e=Dr(n);function n(){var t;(0,o.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i)),(0,p.Z)((0,s.Z)(t),"texture",void 0),(0,p.Z)((0,s.Z)(t),"earthTime",3.4),(0,p.Z)((0,s.Z)(t),"sunX",1e3),(0,p.Z)((0,s.Z)(t),"sunY",1e3),(0,p.Z)((0,s.Z)(t),"sunZ",1e3),(0,p.Z)((0,s.Z)(t),"sunRadius",Math.sqrt(t.sunX*t.sunX+t.sunY*t.sunY+t.sunZ*t.sunZ)),t}return(0,a.Z)(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.animateOption,n=t.globelOtions;return null!=e&&e.enable&&(this.mapService.rotateY({reg:.002}),this.earthTime+=.02,this.sunY=10,this.sunX=Math.cos(this.earthTime)*(this.sunRadius-this.sunY),this.sunZ=Math.sin(this.earthTime)*(this.sunRadius-this.sunY)),{u_ambientRatio:(null==n?void 0:n.ambientRatio)||.6,u_diffuseRatio:(null==n?void 0:n.diffuseRatio)||.4,u_specularRatio:(null==n?void 0:n.specularRatio)||.1,u_sunLight:[this.sunX,this.sunY,this.sunZ],u_texture:this.texture}}},{key:"setEarthTime",value:function(t){this.earthTime=t,this.sunY=10,this.sunX=Math.cos(this.earthTime)*(this.sunRadius-this.sunY),this.sunZ=Math.sin(this.earthTime)*(this.sunRadius-this.sunY),this.layerService.renderLayers()}},{key:"initModels",value:function(){var t=this,e=this.layer.getLayerConfig().globelOtions;void 0!==(null==e?void 0:e.earthTime)&&this.setEarthTime(e.earthTime);var n=this.layer.getSource(),r=this.rendererService.createTexture2D;return this.texture=r({height:0,width:0}),n.data.images.then((function(e){t.texture=r({data:e[0],width:e[0].width,height:e[0].height}),t.layerService.updateLayerRenderList(),t.layerService.renderLayers()})),this.buildModels()}},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:function(){return this.layer.zIndex=-998,[this.layer.buildLayerModel({moduleName:"baseEarth",vertexShader:"// attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n\n// attribute vec2 a_Extrude;\n// attribute float a_Size;\n// attribute float a_Shape;\n\nuniform vec3 u_CameraPosition;\nuniform mat4 u_ViewProjectionMatrix;\nuniform mat4 u_ModelMatrix;\nuniform float u_ambientRatio : 0.5;\nuniform float u_diffuseRatio : 0.3;\nuniform float u_specularRatio : 0.2;\nuniform vec3 u_sunLight: [1.0, -10.5, 12.0];\n\n\n\nfloat calc_lighting(vec4 pos) {\n\n    vec3 worldPos = vec3(pos * u_ModelMatrix);\n\n    vec3 worldNormal = a_Normal;\n\n    // cal light weight\n    vec3 viewDir = normalize(u_CameraPosition - worldPos);\n\n    vec3 lightDir = normalize(u_sunLight);\n\n    vec3 halfDir = normalize(viewDir+lightDir);\n    // lambert\n    float lambert = dot(worldNormal, lightDir);\n    // specular\n    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);\n    //sum to light weight\n    float lightWeight = u_ambientRatio + u_diffuseRatio * lambert + u_specularRatio * specular;\n\n    return lightWeight;\n}\n\nvarying float v_lightWeight;\nvoid main() {\n\n    v_texCoord = a_Uv;\n\n    float lightWeight = calc_lighting(vec4(a_Position, 1.0));\n    v_lightWeight = lightWeight;\n\n    gl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\n}\n",fragmentShader:"\nuniform sampler2D u_texture;\n\nvarying vec2 v_texCoord;\nvarying float v_lightWeight;\n\n\nvoid main() {\n\n    vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));\n    color.xyz = color.xyz * v_lightWeight;\n    gl_FragColor = color;\n}\n",triangulation:fe,depth:{enable:!0},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e,n,r){var i=t.size,o=void 0===i?1:i;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:i.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,n,r){return[n[3],n[4]]}}})}}]),n}(dt);function Zr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var zr=function(t){(0,u.Z)(n,t);var e=Zr(n);function n(){return(0,o.Z)(this,n),e.apply(this,arguments)}return(0,a.Z)(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig().opacity,e=void 0===t?1:t;return{u_opacity:L()(e)?e:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:function(){return this.layer.zIndex=-999,[this.layer.buildLayerModel({moduleName:"earthBloomSphere",vertexShader:"\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute vec2 a_Uv;\nattribute vec4 a_Color;\nuniform vec3 u_CameraPosition;\nuniform mat4 u_ViewProjectionMatrix;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_ViewMatrix;\n\nvarying vec3 vVertexNormal;\nvarying vec4 v_Color;\n\nvoid main() {\n    v_Color = a_Color;\n\n    vVertexNormal = a_Normal;\n\n    gl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\n}\n",fragmentShader:"\nuniform float u_opacity;\nuniform vec3 u_CameraPosition;\nvarying vec3 vVertexNormal;\n\nvarying vec4 v_Color;\nvoid main() {\n\n\n    float intensity =  - dot(normalize(vVertexNormal), normalize(u_CameraPosition));\n    // TODO: 去除背面\n    if(intensity > 1.0) intensity = 0.0;\n\n    gl_FragColor = vec4(v_Color.rgb, v_Color.a * intensity * u_opacity);\n}\n",triangulation:de,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e,n,r){var i=t.size,o=void 0===i?1:i;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:i.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,n,r){return[n[3],n[4]]}}})}}]),n}(dt),Fr=n(25108);function Br(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var jr={base:Nr,atomSphere:Rr,bloomSphere:zr},Ur=["base","atomSphere","bloomSphere"],Vr=function(t){(0,u.Z)(n,t);var e=Br(n);function n(){var t;(0,o.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i)),(0,p.Z)((0,s.Z)(t),"type","EarthLayer"),t}return(0,a.Z)(n,[{key:"buildModels",value:function(){var t=this.getModelType();this.layerModel=new jr[t](this),this.models=this.layerModel.initModels()}},{key:"setEarthTime",value:function(t){this.layerModel&&this.layerModel.setEarthTime?this.layerModel.setEarthTime(t):Fr.error("请在 scene loaded 之后执行该方法！")}},{key:"getModelType",value:function(){var t,e=this.styleAttributeService.getLayerStyleAttribute("shape"),n=(null==e||null===(t=e.scale)||void 0===t?void 0:t.field)||"base";return Ur.indexOf(n)<0&&(n="base"),n}}]),n}(ot);function Gr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var Hr=function(t){(0,u.Z)(n,t);var e=Gr(n);function n(){return(0,o.Z)(this,n),e.apply(this,arguments)}return(0,a.Z)(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig().opacity,e=void 0===t?0:t;return{u_opacity:L()(e)?e:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"mask",vertexShader:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nvarying vec4 v_Color;\n\n#pragma include "projection"\n\nvoid main() {\n\n  v_Color = a_Color;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n}\n\n',fragmentShader:"uniform float u_opacity;\nvarying vec4 v_Color;\n\nvoid main() {\n  gl_FragColor = v_Color;\n  gl_FragColor.a *= u_opacity;\n}\n",triangulation:ie,blend:this.getBlend(),depth:{enable:!1},stencil:{enable:!0,mask:255,func:{cmp:i.gl.ALWAYS,ref:1,mask:255},opFront:{fail:i.gl.REPLACE,zfail:i.gl.REPLACE,zpass:i.gl.REPLACE}}})]}},{key:"clearModels",value:function(){var t;null===(t=this.dataTexture)||void 0===t||t.destroy(),this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),n}(dt),Wr={fill:Hr};function qr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var Xr=function(t){(0,u.Z)(n,t);var e=qr(n);function n(){var t;(0,o.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i)),(0,p.Z)((0,s.Z)(t),"type","MaskLayer"),t}return(0,a.Z)(n,[{key:"buildModels",value:function(){var t=this.getModelType();this.layerModel=new Wr[t](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"fill"}}]),n}(ot),Yr=n(25108);function Kr(t,e,n){var r=Qr(t,t.VERTEX_SHADER,e),i=Qr(t,t.FRAGMENT_SHADER,n);if(!r||!i)return null;var o=t.createProgram();if(!o)return null;if(t.attachShader(o,r),t.attachShader(o,i),t.linkProgram(o),!t.getProgramParameter(o,t.LINK_STATUS)){var a=t.getProgramInfoLog(o);return Yr.warn("Failed to link program: "+a),t.deleteProgram(o),t.deleteShader(i),t.deleteShader(r),null}for(var s=t.getProgramParameter(o,t.ACTIVE_ATTRIBUTES),u=0;u<s;u++){var l=t.getActiveAttrib(o,u);o[l.name]=t.getAttribLocation(o,l.name)}for(var c=t.getProgramParameter(o,t.ACTIVE_UNIFORMS),p=0;p<c;p++){var h=t.getActiveUniform(o,p);o[h.name]=t.getUniformLocation(o,h.name)}return o.vertexShader=r,o.fragmentShader=i,o}function Qr(t,e,n){var r=t.createShader(e);if(null==r)return Yr.warn("unable to create shader"),null;if(t.shaderSource(r,n),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS)){var i=t.getShaderInfoLog(r);return Yr.warn("Failed to compile shader: "+i),t.deleteShader(r),null}return r}function Jr(t,e,n,r,i){var o=t.createTexture();return t.bindTexture(t.TEXTURE_2D,o),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,r,i,0,t.RGBA,t.UNSIGNED_BYTE,n),t.bindTexture(t.TEXTURE_2D,null),o}function $r(t,e,n){t.activeTexture(t.TEXTURE0+n),t.bindTexture(t.TEXTURE_2D,e)}function ti(t,e){var n=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),n}function ei(t){var e=document.createElement("canvas"),n=e.getContext("2d");e.width=256,e.height=1;for(var r=n.createLinearGradient(0,0,256,0),i=0,o=Object.keys(t);i<o.length;i++){var a=o[i];r.addColorStop(+a,t[+a])}return n.fillStyle=r,n.fillRect(0,0,256,1),e=null,new Uint8Array(n.getImageData(0,0,256,1).data)}function ni(t,e,n,r){t.bindBuffer(t.ARRAY_BUFFER,e),t.enableVertexAttribArray(n),t.vertexAttribPointer(n,r,t.FLOAT,!1,0,0)}function ri(t,e,n){t.bindFramebuffer(t.FRAMEBUFFER,e),n&&t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0)}var ii=function(){function t(e){(0,o.Z)(this,t),(0,p.Z)(this,"width",512),(0,p.Z)(this,"height",512),(0,p.Z)(this,"pixels",void 0),(0,p.Z)(this,"fadeOpacity",void 0),(0,p.Z)(this,"speedFactor",void 0),(0,p.Z)(this,"dropRate",void 0),(0,p.Z)(this,"dropRateBump",void 0),(0,p.Z)(this,"gl",void 0),(0,p.Z)(this,"drawProgram",void 0),(0,p.Z)(this,"fullScreenProgram",void 0),(0,p.Z)(this,"updateProgram",void 0),(0,p.Z)(this,"rampColors",void 0),(0,p.Z)(this,"numParticles",65536),(0,p.Z)(this,"numParticlesSize",void 0),(0,p.Z)(this,"particleStateResolution",void 0),(0,p.Z)(this,"quadBuffer",void 0),(0,p.Z)(this,"particleIndexBuffer",void 0),(0,p.Z)(this,"framebuffer",void 0),(0,p.Z)(this,"colorRampTexture",void 0),(0,p.Z)(this,"backgroundTexture",void 0),(0,p.Z)(this,"screenTexture",void 0),(0,p.Z)(this,"particleStateTexture0",void 0),(0,p.Z)(this,"particleStateTexture1",void 0),(0,p.Z)(this,"windTexture",void 0),(0,p.Z)(this,"windData",void 0),this.gl=e.glContext,this.width=e.imageWidth,this.height=e.imageHeight,this.fadeOpacity=e.fadeOpacity,this.speedFactor=e.speedFactor,this.dropRate=e.dropRate,this.dropRateBump=e.dropRateBump,this.rampColors=e.rampColors,this.init()}return(0,a.Z)(t,[{key:"init",value:function(){var t=this.gl;this.fadeOpacity=.996,this.speedFactor=.25,this.dropRate=.003,this.dropRateBump=.01,this.drawProgram=Kr(t,"\n precision mediump float;\n \n attribute float a_index;\n \n uniform sampler2D u_particles;\n uniform float u_particles_res;\n \n varying vec2 v_particle_pos;\n \n void main() {\n     vec4 color = texture2D(u_particles, vec2(\n         fract(a_index / u_particles_res),\n         floor(a_index / u_particles_res) / u_particles_res)\n     );\n                \n     // decode current particle position from the pixel's RGBA value\n     v_particle_pos = vec2( color.r / 255.0 + color.b, color.g / 255.0 + color.a);\n                         \n     gl_PointSize = 1.0;\n     gl_Position = vec4(2.0 * v_particle_pos.x - 1.0, 1.0 - 2.0 * v_particle_pos.y, 0, 1);\n }","\n precision mediump float;\n \n uniform sampler2D u_wind;\n uniform vec2 u_wind_min;\n uniform vec2 u_wind_max;\n uniform sampler2D u_color_ramp;\n \n varying vec2 v_particle_pos;\n \n void main() {\n     vec2 velocity = mix(u_wind_min, u_wind_max, texture2D(u_wind, v_particle_pos).rg);\n     float speed_t = length(velocity) / length(u_wind_max);\n     \n     // color ramp is encoded in a 16x16 texture    \n     vec2 ramp_pos = vec2( fract(16.0 * speed_t), floor(16.0 * speed_t) / 16.0);  \n \n     gl_FragColor = texture2D(u_color_ramp, ramp_pos);\n }"),this.fullScreenProgram=Kr(t,"\n     precision mediump float;\n     \n     attribute vec2 a_pos;\n     \n     varying vec2 v_tex_pos;\n     \n     void main() {\n         v_tex_pos = a_pos;\n         gl_Position = vec4(1.0 - 2.0 * a_pos, 0.0, 1.0);\n         gl_PointSize = 100.0;\n }","\n precision mediump float;\n \n uniform sampler2D u_screen;\n uniform float u_opacity;\n varying vec2 v_tex_pos;\n \n void main() {\n     vec4 color = texture2D(u_screen, 1.0 - v_tex_pos);\n     \n     // a hack to guarantee opacity fade out even with a value close to 1.0\n     gl_FragColor = vec4(floor(255.0 * color * u_opacity) / 255.0);\n }"),this.updateProgram=Kr(t,"\n precision mediump float;\n \n attribute vec2 a_pos;\n \n varying vec2 v_tex_pos;\n \n void main() {\n     v_tex_pos = a_pos;\n     gl_Position = vec4(1.0 - 2.0 * a_pos, 0, 1);\n     // framebuffer 始终用铺满屏幕的 texture\n }","\n precision highp float;\n \n uniform sampler2D u_particles;\n uniform sampler2D u_wind;\n uniform vec2 u_wind_res;\n uniform vec2 u_wind_min;\n uniform vec2 u_wind_max;\n uniform float u_rand_seed;\n uniform float u_speed_factor;\n uniform float u_drop_rate;\n uniform float u_drop_rate_bump;\n \n varying vec2 v_tex_pos;\n \n // pseudo-random generator\n const vec3 rand_constants = vec3(12.9898, 78.233, 4375.85453);\n float rand(const vec2 co) {\n float t = dot(rand_constants.xy, co);\n     return fract(sin(t) * (rand_constants.z + t));\n }\n     \n // wind speed lookup; use manual bilinear filtering based on 4 adjacent pixels for smooth interpolation\n vec2 lookup_wind(const vec2 uv) {\n     // return texture2D(u_wind, uv).rg; // lower-res hardware filtering\n     vec2 px = 1.0 / u_wind_res;\n     vec2 vc = (floor(uv * u_wind_res)) * px;\n     vec2 f = fract(uv * u_wind_res);\n     vec2 tl = texture2D(u_wind, vc).rg;\n     vec2 tr = texture2D(u_wind, vc + vec2(px.x, 0)).rg;\n     vec2 bl = texture2D(u_wind, vc + vec2(0, px.y)).rg;\n     vec2 br = texture2D(u_wind, vc + px).rg;\n     return mix(mix(tl, tr, f.x), mix(bl, br, f.x), f.y);\n }\n \n void main() {\n     vec4 color = texture2D(u_particles, v_tex_pos);\n     vec2 pos = vec2(\n         color.r / 255.0 + color.b,\n         color.g / 255.0 + color.a); // decode particle position from pixel RGBA\n     vec2 velocity = mix(u_wind_min, u_wind_max, lookup_wind(pos));\n     float speed_t = length(velocity) / length(u_wind_max);\n                 \n     // take EPSG:4236 distortion into account for calculating where the particle moved\n     float distortion = cos(radians(pos.y * 180.0 - 90.0));\n     vec2 offset = vec2(velocity.x / distortion, -velocity.y) * 0.0001 * u_speed_factor;\n \n     // update particle position, wrapping around the date line\n     pos = fract(1.0 + pos + offset);\n     \n     // a random seed to use for the particle drop\n     vec2 seed = (pos + v_tex_pos) * u_rand_seed;\n     \n     // drop rate is a chance a particle will restart at random position, to avoid degeneration\n     float drop_rate = u_drop_rate + speed_t * u_drop_rate_bump;\n     float drop = step(1.0 - drop_rate, rand(seed));\n     \n     vec2 random_pos = vec2(\n         rand(seed + 1.3),\n         rand(seed + 2.1));\n         pos = mix(pos, random_pos, drop);\n         \n     // encode the new particle position back into RGBA\n     gl_FragColor = vec4(\n         fract(pos * 255.0),\n         floor(pos * 255.0) / 255.0);\n }"),this.quadBuffer=ti(t,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1])),this.framebuffer=t.createFramebuffer(),this.colorRampTexture=Jr(this.gl,this.gl.LINEAR,ei(this.rampColors),16,16);var e=new Uint8Array(this.width*this.height*4);this.backgroundTexture=Jr(t,t.NEAREST,e,this.width,this.height),this.screenTexture=Jr(t,t.NEAREST,e,this.width,this.height);var n=this.particleStateResolution=Math.ceil(Math.sqrt(this.numParticles));this.numParticlesSize=n*n;for(var r=new Uint8Array(4*this.numParticlesSize),i=0;i<r.length;i++)r[i]=Math.floor(256*Math.random());this.particleStateTexture0=Jr(t,t.NEAREST,r,n,n),this.particleStateTexture1=Jr(t,t.NEAREST,r,n,n);for(var o=new Float32Array(this.numParticlesSize),a=0;a<this.numParticlesSize;a++)o[a]=a;this.particleIndexBuffer=ti(t,o)}},{key:"setWind",value:function(t){var e,n,r,i;this.windData=t,this.windTexture=(e=this.gl,n=this.gl.LINEAR,r=t.image,i=e.createTexture(),e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,n),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r),e.bindTexture(e.TEXTURE_2D,null),i)}},{key:"updateParticelNum",value:function(t){var e=this.gl;if(t!==this.numParticles){this.numParticles=t;var n=this.particleStateResolution=Math.ceil(Math.sqrt(this.numParticles));this.numParticlesSize=n*n;for(var r=new Uint8Array(4*this.numParticlesSize),i=0;i<r.length;i++)r[i]=Math.floor(256*Math.random());this.particleStateTexture0=Jr(e,e.NEAREST,r,n,n),this.particleStateTexture1=Jr(e,e.NEAREST,r,n,n);for(var o=new Float32Array(this.numParticlesSize),a=0;a<this.numParticlesSize;a++)o[a]=a;this.particleIndexBuffer=ti(e,o)}}},{key:"updateWindDir",value:function(t,e,n,r){this.windData.uMin=t,this.windData.uMax=e,this.windData.vMin=n,this.windData.vMax=r}},{key:"updateColorRampTexture",value:function(t){if(this.isColorChanged(t)){this.rampColors=t;var e=this.gl;e.deleteTexture(this.colorRampTexture),this.colorRampTexture=Jr(e,e.LINEAR,ei(t),16,16)}}},{key:"isColorChanged",value:function(t){for(var e=0,n=Object.keys(t);e<n.length;e++){var r=n[e],i=Number(r);if(!this.rampColors[i])return!0;if(this.rampColors[i]&&this.rampColors[i]!==t[i])return!0}return!1}},{key:"reSize",value:function(t,e){if(t!==this.width||e!==this.height){var n=this.gl;n.deleteTexture(this.backgroundTexture),n.deleteTexture(this.screenTexture),this.width=t,this.height=e;var r=new Uint8Array(t*e*4);this.backgroundTexture=Jr(n,n.NEAREST,r,t,e),this.screenTexture=Jr(n,n.NEAREST,r,t,e)}}},{key:"draw",value:function(){var t;if(null!==(t=this.windData)&&void 0!==t&&t.image){var e=this.gl;return $r(e,this.windTexture,0),$r(e,this.particleStateTexture0,1),this.drawScreen(),this.updateParticles(),{d:this.pixels,w:this.width,h:this.height}}return{d:new Uint8Array([0,0,0,0]),w:1,h:1}}},{key:"drawScreen",value:function(){var t=this.gl;ri(t,this.framebuffer,this.screenTexture),t.viewport(0,0,this.width,this.height),this.drawFullTexture(this.backgroundTexture,this.fadeOpacity),this.drawParticles(),t.disable(t.BLEND),this.pixels=new Uint8Array(4*this.width*this.height),t.readPixels(0,0,this.width,this.height,t.RGBA,t.UNSIGNED_BYTE,this.pixels),ri(t,null,null),t.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height);var e=this.backgroundTexture;this.backgroundTexture=this.screenTexture,this.screenTexture=e}},{key:"drawFullTexture",value:function(t,e){var n=this.gl,r=this.fullScreenProgram;n.useProgram(r),n.bindBuffer(n.ARRAY_BUFFER,this.quadBuffer),n.vertexAttribPointer(r.a_pos,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(r.a_pos),n.bindBuffer(n.ARRAY_BUFFER,null),$r(n,t,2),n.uniform1i(r.u_screen,2),n.uniform1f(r.u_opacity,e),n.drawArrays(n.TRIANGLES,0,6)}},{key:"drawParticles",value:function(){var t=this.gl,e=this.drawProgram;t.useProgram(e),ni(t,this.particleIndexBuffer,e.a_index,1),$r(t,this.colorRampTexture,2),t.uniform1i(e.u_wind,0),t.uniform1i(e.u_particles,1),t.uniform1i(e.u_color_ramp,2),t.uniform1f(e.u_particles_res,this.particleStateResolution),t.uniform2f(e.u_wind_min,this.windData.uMin,this.windData.vMin),t.uniform2f(e.u_wind_max,this.windData.uMax,this.windData.vMax),t.drawArrays(t.POINTS,0,this.numParticlesSize)}},{key:"updateParticles",value:function(){var t=this.gl;ri(t,this.framebuffer,this.particleStateTexture1),t.viewport(0,0,this.particleStateResolution,this.particleStateResolution);var e=this.updateProgram;t.useProgram(e),ni(t,this.quadBuffer,e.a_pos,2),t.uniform1i(e.u_wind,0),t.uniform1i(e.u_particles,1),t.uniform1f(e.u_rand_seed,Math.random()),t.uniform2f(e.u_wind_res,2*this.windData.image.width,2*this.windData.image.height),t.uniform2f(e.u_wind_min,this.windData.uMin,this.windData.vMin),t.uniform2f(e.u_wind_max,this.windData.uMax,this.windData.vMax),t.uniform1f(e.u_speed_factor,this.speedFactor),t.uniform1f(e.u_drop_rate,this.dropRate),t.uniform1f(e.u_drop_rate_bump,this.dropRateBump),t.drawArrays(t.TRIANGLES,0,6);var n=this.particleStateTexture0;this.particleStateTexture0=this.particleStateTexture1,this.particleStateTexture1=n,ri(t,null,null)}},{key:"destroy",value:function(){this.gl.deleteBuffer(this.quadBuffer),this.gl.deleteBuffer(this.particleIndexBuffer),this.gl.deleteFramebuffer(this.framebuffer),this.gl.deleteShader(this.drawProgram.vertexShader),this.gl.deleteShader(this.drawProgram.fragmentShader),this.gl.deleteProgram(this.drawProgram),this.gl.deleteShader(this.fullScreenProgram.vertexShader),this.gl.deleteShader(this.fullScreenProgram.fragmentShader),this.gl.deleteProgram(this.fullScreenProgram),this.gl.deleteShader(this.updateProgram.vertexShader),this.gl.deleteShader(this.updateProgram.fragmentShader),this.gl.deleteProgram(this.updateProgram),this.gl.deleteTexture(this.colorRampTexture),this.gl.deleteTexture(this.backgroundTexture),this.gl.deleteTexture(this.screenTexture),this.gl.deleteTexture(this.particleStateTexture0),this.gl.deleteTexture(this.particleStateTexture1),this.gl.deleteTexture(this.windTexture)}}]),t}();function oi(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var ai={0:"#3288bd",.1:"#66c2a5",.2:"#abdda4",.3:"#e6f598",.4:"#fee08b",.5:"#fdae61",.6:"#f46d43",1:"#d53e4f"},si=function(t){(0,u.Z)(n,t);var e=oi(n);function n(){var t;(0,o.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i)),(0,p.Z)((0,s.Z)(t),"texture",void 0),(0,p.Z)((0,s.Z)(t),"colorModel",void 0),(0,p.Z)((0,s.Z)(t),"wind",void 0),(0,p.Z)((0,s.Z)(t),"imageCoords",void 0),(0,p.Z)((0,s.Z)(t),"sizeScale",.5),(0,p.Z)((0,s.Z)(t),"frequency",new T.FrequencyController(7.2)),t}return(0,a.Z)(n,[{key:"render",value:function(){var t=this;this.frequency.run((function(){t.drawWind()})),this.drawColorMode()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var t=this,e=this.rendererService.createTexture2D,n=this.layer.getSource();this.texture=e({height:0,width:0});var r=this.rendererService.getGLContext();return this.imageCoords=n.data.dataArray[0].coordinates,n.data.images.then((function(n){var i=t.layer.getLayerConfig(),o=i.uMin,a=void 0===o?-21.32:o,s=i.uMax,u=void 0===s?26.8:s,l=i.vMin,c=void 0===l?-21.57:l,p=i.vMax,h=void 0===p?21.42:p,f=i.fadeOpacity,d=void 0===f?.996:f,v=i.speedFactor,m=void 0===v?.25:v,y=i.dropRate,g=void 0===y?.003:y,_=i.dropRateBump,x=void 0===_?.01:_,b=i.rampColors,w=void 0===b?ai:b,S=i.sizeScale,E=void 0===S?.5:S;t.sizeScale=E;var C=t.getWindSize(),T=C.imageWidth,A=C.imageHeight,M={glContext:r,imageWidth:T,imageHeight:A,fadeOpacity:d,speedFactor:m,dropRate:g,dropRateBump:x,rampColors:w};t.wind=new ii(M),t.wind.setWind({uMin:a,uMax:u,vMin:c,vMax:h,image:n[0]}),t.texture=e({data:n[0],width:n[0].width,height:n[0].height}),t.layerService.updateLayerRenderList(),t.layerService.renderLayers()})),this.colorModel=this.layer.buildLayerModel({moduleName:"WindLayer",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   }\n}\n',fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nvoid main() {\n  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));\n  gl_FragColor = color;\n  gl_FragColor.a *= u_opacity;\n}\n",triangulation:le,primitive:i.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()}),[this.colorModel]}},{key:"getWindSize",value:function(){var t=this.mapService.lngLatToPixel(this.imageCoords[0]),e=this.mapService.lngLatToPixel(this.imageCoords[1]);return{imageWidth:Math.floor((e.x-t.x)*this.sizeScale),imageHeight:Math.floor((t.y-e.y)*this.sizeScale)}}},{key:"buildModels",value:function(){return this.initModels()}},{key:"clearModels",value:function(){var t,e;null===(t=this.texture)||void 0===t||t.destroy(),null===(e=this.wind)||void 0===e||e.destroy()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,n,r){return[n[3],n[4]]}}})}},{key:"drawWind",value:function(){if(this.wind){var t=this.layer.getLayerConfig(),e=t.uMin,n=void 0===e?-21.32:e,r=t.uMax,i=void 0===r?26.8:r,o=t.vMin,a=void 0===o?-21.57:o,s=t.vMax,u=void 0===s?21.42:s,l=t.numParticles,c=void 0===l?65535:l,p=t.fadeOpacity,h=void 0===p?.996:p,f=t.speedFactor,d=void 0===f?.25:f,v=t.dropRate,m=void 0===v?.003:v,y=t.dropRateBump,g=void 0===y?.01:y,_=t.rampColors,x=void 0===_?ai:_,b=t.sizeScale,w=void 0===b?.5:b;if("number"==typeof w&&w!==this.sizeScale){this.sizeScale=w;var S=this.getWindSize(),E=S.imageWidth,C=S.imageHeight;this.wind.reSize(E,C)}this.wind.updateWindDir(n,i,a,u),this.wind.updateParticelNum(c),this.wind.updateColorRampTexture(x),this.wind.fadeOpacity=h,this.wind.speedFactor=d,this.wind.dropRate=m,this.wind.dropRateBump=g;var T=this.wind.draw(),A=T.d,M=T.w,k=T.h;this.rendererService.setBaseState(),this.texture.update({data:A,width:M,height:k})}}},{key:"drawColorMode",value:function(){var t=this.layer.getLayerConfig().opacity;this.colorModel.draw({uniforms:{u_opacity:t||1,u_texture:this.texture}})}}]),n}(dt),ui={wind:si};function li(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var ci,pi,hi,fi,di,vi,mi,yi,gi,_i=function(t){(0,u.Z)(n,t);var e=li(n);function n(){var t;(0,o.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i)),(0,p.Z)((0,s.Z)(t),"type","WindLayer"),t}return(0,a.Z)(n,[{key:"buildModels",value:function(){var t=this.getModelType();this.layerModel=new ui[t](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){return this.layerModel&&this.layerModel.render(),this}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{wind:{}}[this.getModelType()]}},{key:"getModelType",value:function(){return"wind"}}]),n}(ot),xi=n(50361),bi=n.n(xi);function wi(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}var Si,Ei=(ci=(0,Re.b2)(),pi=(0,Re.f3)(i.TYPES.IGlobalConfigService),hi=(0,Re.f3)(i.TYPES.IMapService),fi=(0,Re.f3)(i.TYPES.IFontService),ci((vi=function(){function t(){(0,o.Z)(this,t),(0,d.Z)(this,"configService",mi,this),(0,d.Z)(this,"mapService",yi,this),(0,d.Z)(this,"fontService",gi,this)}return(0,a.Z)(t,[{key:"apply",value:function(t,e){var n=this,r=e.styleAttributeService;t.hooks.init.tap("DataMappingPlugin",(function(){n.generateMaping(t,{styleAttributeService:r})})),t.hooks.beforeRenderData.tap("DataMappingPlugin",(function(){return t.dataState.dataMappingNeedUpdate=!1,n.generateMaping(t,{styleAttributeService:r}),!0})),t.hooks.beforeRender.tap("DataMappingPlugin",(function(){if(!t.layerModelNeedUpdate){var e=t.getBottomColor(),i=r.getLayerStyleAttributes()||[],o=r.getLayerStyleAttribute("filter"),a=t.getSource().data.dataArray,s=i.filter((function(t){return t.needRemapping})),u=a;null!=o&&o.needRemapping&&null!=o&&o.scale&&(u=a.filter((function(t){return n.applyAttributeMapping(o,t,e)[0]}))),s.length&&(null!=o&&o.needRemapping?(t.setEncodedData(n.mapping(t,i,u,void 0,e)),o.needRemapping=!1):t.setEncodedData(n.mapping(t,s,u,t.getEncodedData(),e)),t.emit("remapping",null))}}))}},{key:"generateMaping",value:function(t,e){var n=this,r=e.styleAttributeService,i=t.getBottomColor(),o=r.getLayerStyleAttributes()||[],a=r.getLayerStyleAttribute("filter"),s=t.getSource().data.dataArray,u=s;null!=a&&a.scale&&(u=s.filter((function(t){return n.applyAttributeMapping(a,t,i)[0]}))),t.setEncodedData(this.mapping(t,o,u,void 0,i)),t.emit("dataUpdate",null)}},{key:"getArrowPoints",value:function(t,e){var n=[e[0]-t[0],e[1]-t[1]],r=(0,T.normalize)(n);return[t[0]+1e-4*r[0],t[1]+1e-4*r[1]]}},{key:"mapping",value:function(t,e,n,r,i){var o=this,a=t.getLayerConfig().arrow,s=void 0===a?{enable:!1}:a,u=n.map((function(t,n){var a=r?r[n]:{},u=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?wi(Object(n),!0).forEach((function(e){(0,p.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):wi(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({id:t._id,coordinates:t.coordinates},a);if(e.filter((function(t){return void 0!==t.scale})).forEach((function(e){var n=o.applyAttributeMapping(e,t,i);e.needRemapping=!1,"color"===e.name&&(n=n.map((function(t){return(0,T.rgb2arr)(t)}))),u[e.name]=Array.isArray(n)&&1===n.length?n[0]:n,"shape"===e.name&&(u.shape=o.fontService.getIconFontKey(u[e.name]))})),"line"===u.shape&&s.enable){var l=u.coordinates,c=o.getArrowPoints(l[0],l[1]);u.coordinates.splice(1,0,c,c)}return u}));return this.adjustData2Amap2Coordinates(u,t),this.adjustData2SimpleCoordinates(u),u}},{key:"adjustData2Amap2Coordinates",value:function(t,e){var n=this;if(t.length>0&&this.mapService.version===Z.G["GAODE2.x"]){var r=this.getLayerCenter(e);"number"==typeof t[0].coordinates[0]?t.filter((function(t){return!t.originCoordinates})).map((function(t){t.version=Z.G["GAODE2.x"],t.originCoordinates=bi()(t.coordinates),t.coordinates=n.mapService.lngLatToCoordByLayer(t.coordinates,r)})):t.filter((function(t){return!t.originCoordinates})).map((function(t){t.version=Z.G["GAODE2.x"],t.originCoordinates=bi()(t.coordinates),t.coordinates=n.mapService.lngLatToCoordsByLayer(t.coordinates,r)}))}}},{key:"getLayerCenter",value:function(t){return t.getSource().center}},{key:"adjustData2SimpleCoordinates",value:function(t){var e=this;t.length>0&&this.mapService.version===Z.G.SIMPLE&&t.map((function(t){t.simpleCoordinate||(t.coordinates=e.unProjectCoordinates(t.coordinates),t.simpleCoordinate=!0)}))}},{key:"unProjectCoordinates",value:function(t){var e=this;if("number"==typeof t[0])return this.mapService.simpleMapCoord.unproject(t);if(t[0]&&t[0][0]instanceof Array){var n=[];return t.map((function(t){var r=[];t.map((function(t){r.push(e.mapService.simpleMapCoord.unproject(t))})),n.push(r)})),n}var r=[];return t.map((function(t){r.push(e.mapService.simpleMapCoord.unproject(t))})),r}},{key:"applyAttributeMapping",value:function(t,e,n){var r;if(!t.scale)return[];var i=(null==t||null===(r=t.scale)||void 0===r?void 0:r.scalers)||[],o=[];i.forEach((function(n){var r,i=n.field;(e.hasOwnProperty(i)||"variable"===(null===(r=t.scale)||void 0===r?void 0:r.type))&&o.push(e[i])}));var a=t.mapping?t.mapping(o):[];return"color"!==t.name||(0,T.isColor)(a[0])?a:[n]}}]),t}(),mi=(0,v.Z)(vi.prototype,"configService",[pi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yi=(0,v.Z)(vi.prototype,"mapService",[hi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gi=(0,v.Z)(vi.prototype,"fontService",[fi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),di=vi))||di),Ci=(0,Re.b2)()(Si=function(){function t(){(0,o.Z)(this,t),(0,p.Z)(this,"mapService",void 0)}return(0,a.Z)(t,[{key:"apply",value:function(t){var e=this;this.mapService=t.getContainer().get(i.TYPES.IMapService),t.hooks.init.tap("DataSourcePlugin",(function(){if(!t.getSource()){var n=t.sourceOption||{data:C.DEFAULT_DATA,options:C.DEFAULT_PARSER},r=n.data,i=n.options;t.setSource(new C.default(r,i))}e.updateClusterData(t)})),t.hooks.beforeRenderData.tap("DataSourcePlugin",(function(){var n=e.updateClusterData(t),r=t.dataState.dataSourceNeedUpdate;return t.dataState.dataSourceNeedUpdate=!1,n||r}))}},{key:"updateClusterData",value:function(t){var e=t.getSource(),n=e.cluster,r=e.clusterOptions,i=r.zoom,o=void 0===i?0:i,a=(r.maxZoom,this.mapService.getZoom()-1),s=t.dataState.dataSourceNeedUpdate;return!(!n||!(s||Math.abs(t.clusterZoom-a)>=1))&&(o!==Math.floor(a)&&e.updateClusterData(Math.floor(a)),t.clusterZoom=a,!0)}}]),t}())||Si,Ti=n(44908),Ai=n.n(Ti),Mi=n(14293),ki=n.n(Mi);function Pi(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Oi(t){var e;return 1===t.length&&(e=t,t=function(t,n){return Pi(e(t),n)}),{left:function(e,n,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){var o=r+i>>>1;t(e[o],n)<0?r=o+1:i=o}return r},right:function(e,n,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){var o=r+i>>>1;t(e[o],n)>0?i=o:r=o+1}return r}}}var Li=Oi(Pi),Ii=Li.right,Ri=(Li.left,Ii);function Di(t,e){var n,r,i,o=t.length,a=-1;if(null==e){for(;++a<o;)if(null!=(n=t[a])&&n>=n)for(r=i=n;++a<o;)null!=(n=t[a])&&(r>n&&(r=n),i<n&&(i=n))}else for(;++a<o;)if(null!=(n=e(t[a],a,t))&&n>=n)for(r=i=n;++a<o;)null!=(n=e(t[a],a,t))&&(r>n&&(r=n),i<n&&(i=n));return[r,i]}var Ni=Array.prototype,Zi=(Ni.slice,Ni.map,Math.sqrt(50)),zi=Math.sqrt(10),Fi=Math.sqrt(2);function Bi(t,e,n){var r,i,o,a,s=-1;if(n=+n,(t=+t)===(e=+e)&&n>0)return[t];if((r=e<t)&&(i=t,t=e,e=i),0===(a=ji(t,e,n))||!isFinite(a))return[];if(a>0)for(t=Math.ceil(t/a),e=Math.floor(e/a),o=new Array(i=Math.ceil(e-t+1));++s<i;)o[s]=(t+s)*a;else for(t=Math.floor(t*a),e=Math.ceil(e*a),o=new Array(i=Math.ceil(t-e+1));++s<i;)o[s]=(t-s)/a;return r&&o.reverse(),o}function ji(t,e,n){var r=(e-t)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),o=r/Math.pow(10,i);return i>=0?(o>=Zi?10:o>=zi?5:o>=Fi?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(o>=Zi?10:o>=zi?5:o>=Fi?2:1)}function Ui(t,e,n){var r=Math.abs(e-t)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),o=r/i;return o>=Zi?i*=10:o>=zi?i*=5:o>=Fi&&(i*=2),e<t?-i:i}function Vi(t){return null===t?NaN:+t}function Gi(t,e,n){if(null==n&&(n=Vi),r=t.length){if((e=+e)<=0||r<2)return+n(t[0],0,t);if(e>=1)return+n(t[r-1],r-1,t);var r,i=(r-1)*e,o=Math.floor(i),a=+n(t[o],o,t);return a+(+n(t[o+1],o+1,t)-a)*(i-o)}}function Hi(t,e,n,r,i){var o=t*t,a=o*t;return((1-3*t+3*o-a)*e+(4-6*o+3*a)*n+(1+3*t+3*o-3*a)*r+a*i)/6}function Wi(t){return function(){return t}}function qi(t,e){return function(n){return t+n*e}}function Xi(t){return 1==(t=+t)?Yi:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}(e,n,t):Wi(isNaN(e)?n:e)}}function Yi(t,e){var n=e-t;return n?qi(t,n):Wi(isNaN(t)?e:t)}var Ki=function t(e){var n=Xi(e);function r(t,e){var r=n((t=(0,lt.B8)(t)).r,(e=(0,lt.B8)(e)).r),i=n(t.g,e.g),o=n(t.b,e.b),a=Yi(t.opacity,e.opacity);return function(e){return t.r=r(e),t.g=i(e),t.b=o(e),t.opacity=a(e),t+""}}return r.gamma=t,r}(1);function Qi(t){return function(e){var n,r,i=e.length,o=new Array(i),a=new Array(i),s=new Array(i);for(n=0;n<i;++n)r=(0,lt.B8)(e[n]),o[n]=r.r||0,a[n]=r.g||0,s[n]=r.b||0;return o=t(o),a=t(a),s=t(s),r.opacity=1,function(t){return r.r=o(t),r.g=a(t),r.b=s(t),r+""}}}var Ji=Qi((function(t){var e=t.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),i=t[r],o=t[r+1],a=r>0?t[r-1]:2*i-o,s=r<e-1?t[r+2]:2*o-i;return Hi((n-r/e)*e,a,i,o,s)}})),$i=(Qi((function(t){var e=t.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*e),i=t[(r+e-1)%e],o=t[r%e],a=t[(r+1)%e],s=t[(r+2)%e];return Hi((n-r/e)*e,i,o,a,s)}})),"$");function to(){}function eo(t,e){var n=new to;if(t instanceof to)t.each((function(t,e){n.set(e,t)}));else if(Array.isArray(t)){var r,i=-1,o=t.length;if(null==e)for(;++i<o;)n.set(i,t[i]);else for(;++i<o;)n.set(e(r=t[i],i,t),r)}else if(t)for(var a in t)n.set(a,t[a]);return n}to.prototype=eo.prototype={constructor:to,has:function(t){return $i+t in this},get:function(t){return this[$i+t]},set:function(t,e){return this[$i+t]=e,this},remove:function(t){var e=$i+t;return e in this&&delete this[e]},clear:function(){for(var t in this)t[0]===$i&&delete this[t]},keys:function(){var t=[];for(var e in this)e[0]===$i&&t.push(e.slice(1));return t},values:function(){var t=[];for(var e in this)e[0]===$i&&t.push(this[e]);return t},entries:function(){var t=[];for(var e in this)e[0]===$i&&t.push({key:e.slice(1),value:this[e]});return t},size:function(){var t=0;for(var e in this)e[0]===$i&&++t;return t},empty:function(){for(var t in this)if(t[0]===$i)return!1;return!0},each:function(t){for(var e in this)e[0]===$i&&t(this[e],e.slice(1),this)}};var no=eo;function ro(){}var io=no.prototype;function oo(t,e){var n=new ro;if(t instanceof ro)t.each((function(t){n.add(t)}));else if(t){var r=-1,i=t.length;if(null==e)for(;++r<i;)n.add(t[r]);else for(;++r<i;)n.add(e(t[r],r,t))}return n}ro.prototype=oo.prototype={constructor:ro,has:io.has,add:function(t){return this[$i+(t+="")]=t,this},remove:io.remove,clear:io.clear,values:io.keys,size:io.size,empty:io.empty,each:io.each};var ao=Array.prototype,so=ao.map,uo=ao.slice;function lo(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}function co(t,e){switch(arguments.length){case 0:break;case 1:this.interpolator(t);break;default:this.interpolator(e).domain(t)}return this}var po={name:"implicit"};function ho(){var t=no(),e=[],n=[],r=po;function i(i){var o=i+"",a=t.get(o);if(!a){if(r!==po)return r;t.set(o,a=e.push(i))}return n[(a-1)%n.length]}return i.domain=function(n){if(!arguments.length)return e.slice();e=[],t=no();for(var r,o,a=-1,s=n.length;++a<s;)t.has(o=(r=n[a])+"")||t.set(o,e.push(r));return i},i.range=function(t){return arguments.length?(n=uo.call(t),i):n.slice()},i.unknown=function(t){return arguments.length?(r=t,i):r},i.copy=function(){return ho(e,n).unknown(r)},lo.apply(i,arguments),i}function fo(t,e){var n,r=e?e.length:0,i=t?Math.min(r,t.length):0,o=new Array(i),a=new Array(r);for(n=0;n<i;++n)o[n]=wo(t[n],e[n]);for(;n<r;++n)a[n]=e[n];return function(t){for(n=0;n<i;++n)a[n]=o[n](t);return a}}function vo(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function mo(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function yo(t,e){var n,r={},i={};for(n in null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={}),e)n in t?r[n]=wo(t[n],e[n]):i[n]=e[n];return function(t){for(n in r)i[n]=r[n](t);return i}}var go=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,_o=new RegExp(go.source,"g");function xo(t,e){var n,r,i,o=go.lastIndex=_o.lastIndex=0,a=-1,s=[],u=[];for(t+="",e+="";(n=go.exec(t))&&(r=_o.exec(e));)(i=r.index)>o&&(i=e.slice(o,i),s[a]?s[a]+=i:s[++a]=i),(n=n[0])===(r=r[0])?s[a]?s[a]+=r:s[++a]=r:(s[++a]=null,u.push({i:a,x:mo(n,r)})),o=_o.lastIndex;return o<e.length&&(i=e.slice(o),s[a]?s[a]+=i:s[++a]=i),s.length<2?u[0]?function(t){return function(e){return t(e)+""}}(u[0].x):function(t){return function(){return t}}(e):(e=u.length,function(t){for(var n,r=0;r<e;++r)s[(n=u[r]).i]=n.x(t);return s.join("")})}function bo(t,e){e||(e=[]);var n,r=t?Math.min(e.length,t.length):0,i=e.slice();return function(o){for(n=0;n<r;++n)i[n]=t[n]*(1-o)+e[n]*o;return i}}function wo(t,e){var n,r,i=typeof e;return null==e||"boolean"===i?Wi(e):("number"===i?mo:"string"===i?(n=(0,lt.ZP)(e))?(e=n,Ki):xo:e instanceof lt.ZP?Ki:e instanceof Date?vo:(r=e,!ArrayBuffer.isView(r)||r instanceof DataView?Array.isArray(e)?fo:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?yo:mo:bo))(t,e)}function So(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}function Eo(t){return+t}var Co=[0,1];function To(t){return t}function Ao(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:(n=isNaN(e)?NaN:.5,function(){return n});var n}function Mo(t){var e,n=t[0],r=t[t.length-1];return n>r&&(e=n,n=r,r=e),function(t){return Math.max(n,Math.min(r,t))}}function ko(t,e,n){var r=t[0],i=t[1],o=e[0],a=e[1];return i<r?(r=Ao(i,r),o=n(a,o)):(r=Ao(r,i),o=n(o,a)),function(t){return o(r(t))}}function Po(t,e,n){var r=Math.min(t.length,e.length)-1,i=new Array(r),o=new Array(r),a=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++a<r;)i[a]=Ao(t[a],t[a+1]),o[a]=n(e[a],e[a+1]);return function(e){var n=Ri(t,e,1,r)-1;return o[n](i[n](e))}}function Oo(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Lo(){var t,e,n,r,i,o,a=Co,s=Co,u=wo,l=To;function c(){return r=Math.min(a.length,s.length)>2?Po:ko,i=o=null,p}function p(e){return isNaN(e=+e)?n:(i||(i=r(a.map(t),s,u)))(t(l(e)))}return p.invert=function(n){return l(e((o||(o=r(s,a.map(t),mo)))(n)))},p.domain=function(t){return arguments.length?(a=so.call(t,Eo),l===To||(l=Mo(a)),c()):a.slice()},p.range=function(t){return arguments.length?(s=uo.call(t),c()):s.slice()},p.rangeRound=function(t){return s=uo.call(t),u=So,c()},p.clamp=function(t){return arguments.length?(l=t?Mo(a):To,p):l!==To},p.interpolate=function(t){return arguments.length?(u=t,c()):u},p.unknown=function(t){return arguments.length?(n=t,p):n},function(n,r){return t=n,e=r,c()}}function Io(t,e){return Lo()(t,e)}var Ro,Do=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function No(t){if(!(e=Do.exec(t)))throw new Error("invalid format: "+t);var e;return new Zo({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function Zo(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function zo(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function Fo(t){return(t=zo(Math.abs(t)))?t[1]:NaN}function Bo(t,e){var n=zo(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}No.prototype=Zo.prototype,Zo.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var jo={"%":function(t,e){return(100*t).toFixed(e)},b:function(t){return Math.round(t).toString(2)},c:function(t){return t+""},d:function(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)},e:function(t,e){return t.toExponential(e)},f:function(t,e){return t.toFixed(e)},g:function(t,e){return t.toPrecision(e)},o:function(t){return Math.round(t).toString(8)},p:function(t,e){return Bo(100*t,e)},r:Bo,s:function(t,e){var n=zo(t,e);if(!n)return t+"";var r=n[0],i=n[1],o=i-(Ro=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,a=r.length;return o===a?r:o>a?r+new Array(o-a+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+zo(t,Math.max(0,e+o-1))[0]},X:function(t){return Math.round(t).toString(16).toUpperCase()},x:function(t){return Math.round(t).toString(16)}};function Uo(t){return t}var Vo,Go,Ho,Wo=Array.prototype.map,qo=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Xo(t){var e,n,r=void 0===t.grouping||void 0===t.thousands?Uo:(e=Wo.call(t.grouping,Number),n=t.thousands+"",function(t,r){for(var i=t.length,o=[],a=0,s=e[0],u=0;i>0&&s>0&&(u+s+1>r&&(s=Math.max(1,r-u)),o.push(t.substring(i-=s,i+s)),!((u+=s+1)>r));)s=e[a=(a+1)%e.length];return o.reverse().join(n)}),i=void 0===t.currency?"":t.currency[0]+"",o=void 0===t.currency?"":t.currency[1]+"",a=void 0===t.decimal?".":t.decimal+"",s=void 0===t.numerals?Uo:function(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}(Wo.call(t.numerals,String)),u=void 0===t.percent?"%":t.percent+"",l=void 0===t.minus?"-":t.minus+"",c=void 0===t.nan?"NaN":t.nan+"";function p(t){var e=(t=No(t)).fill,n=t.align,p=t.sign,h=t.symbol,f=t.zero,d=t.width,v=t.comma,m=t.precision,y=t.trim,g=t.type;"n"===g?(v=!0,g="g"):jo[g]||(void 0===m&&(m=12),y=!0,g="g"),(f||"0"===e&&"="===n)&&(f=!0,e="0",n="=");var _="$"===h?i:"#"===h&&/[boxX]/.test(g)?"0"+g.toLowerCase():"",x="$"===h?o:/[%p]/.test(g)?u:"",b=jo[g],w=/[defgprs%]/.test(g);function S(t){var i,o,u,h=_,S=x;if("c"===g)S=b(t)+S,t="";else{var E=(t=+t)<0||1/t<0;if(t=isNaN(t)?c:b(Math.abs(t),m),y&&(t=function(t){t:for(var e,n=t.length,r=1,i=-1;r<n;++r)switch(t[r]){case".":i=e=r;break;case"0":0===i&&(i=r),e=r;break;default:if(!+t[r])break t;i>0&&(i=0)}return i>0?t.slice(0,i)+t.slice(e+1):t}(t)),E&&0==+t&&"+"!==p&&(E=!1),h=(E?"("===p?p:l:"-"===p||"("===p?"":p)+h,S=("s"===g?qo[8+Ro/3]:"")+S+(E&&"("===p?")":""),w)for(i=-1,o=t.length;++i<o;)if(48>(u=t.charCodeAt(i))||u>57){S=(46===u?a+t.slice(i+1):t.slice(i))+S,t=t.slice(0,i);break}}v&&!f&&(t=r(t,1/0));var C=h.length+t.length+S.length,T=C<d?new Array(d-C+1).join(e):"";switch(v&&f&&(t=r(T+t,T.length?d-S.length:1/0),T=""),n){case"<":t=h+t+S+T;break;case"=":t=h+T+t+S;break;case"^":t=T.slice(0,C=T.length>>1)+h+t+S+T.slice(C);break;default:t=T+h+t+S}return s(t)}return m=void 0===m?6:/[gprs]/.test(g)?Math.max(1,Math.min(21,m)):Math.max(0,Math.min(20,m)),S.toString=function(){return t+""},S}return{format:p,formatPrefix:function(t,e){var n=p(((t=No(t)).type="f",t)),r=3*Math.max(-8,Math.min(8,Math.floor(Fo(e)/3))),i=Math.pow(10,-r),o=qo[8+r/3];return function(t){return n(i*t)+o}}}}function Yo(t,e,n,r){var i,o=Ui(t,e,n);switch((r=No(null==r?",f":r)).type){case"s":var a=Math.max(Math.abs(t),Math.abs(e));return null!=r.precision||isNaN(i=function(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Fo(e)/3)))-Fo(Math.abs(t)))}(o,a))||(r.precision=i),Ho(r,a);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=function(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Fo(e)-Fo(t))+1}(o,Math.max(Math.abs(t),Math.abs(e))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=function(t){return Math.max(0,-Fo(Math.abs(t)))}(o))||(r.precision=i-2*("%"===r.type))}return Go(r)}function Ko(t){var e=t.domain;return t.ticks=function(t){var n=e();return Bi(n[0],n[n.length-1],null==t?10:t)},t.tickFormat=function(t,n){var r=e();return Yo(r[0],r[r.length-1],null==t?10:t,n)},t.nice=function(n){null==n&&(n=10);var r,i=e(),o=0,a=i.length-1,s=i[o],u=i[a];return u<s&&(r=s,s=u,u=r,r=o,o=a,a=r),(r=ji(s,u,n))>0?r=ji(s=Math.floor(s/r)*r,u=Math.ceil(u/r)*r,n):r<0&&(r=ji(s=Math.ceil(s*r)/r,u=Math.floor(u*r)/r,n)),r>0?(i[o]=Math.floor(s/r)*r,i[a]=Math.ceil(u/r)*r,e(i)):r<0&&(i[o]=Math.ceil(s*r)/r,i[a]=Math.floor(u*r)/r,e(i)),t},t}function Qo(t,e){var n,r=0,i=(t=t.slice()).length-1,o=t[r],a=t[i];return a<o&&(n=r,r=i,i=n,n=o,o=a,a=n),t[r]=e.floor(o),t[i]=e.ceil(a),t}function Jo(t){return Math.log(t)}function $o(t){return Math.exp(t)}function ta(t){return-Math.log(-t)}function ea(t){return-Math.exp(-t)}function na(t){return isFinite(t)?+("1e"+t):t<0?0:t}function ra(t){return function(e){return-t(-e)}}function ia(t){var e,n,r=t(Jo,$o),i=r.domain,o=10;function a(){return e=function(t){return t===Math.E?Math.log:10===t&&Math.log10||2===t&&Math.log2||(t=Math.log(t),function(e){return Math.log(e)/t})}(o),n=function(t){return 10===t?na:t===Math.E?Math.exp:function(e){return Math.pow(t,e)}}(o),i()[0]<0?(e=ra(e),n=ra(n),t(ta,ea)):t(Jo,$o),r}return r.base=function(t){return arguments.length?(o=+t,a()):o},r.domain=function(t){return arguments.length?(i(t),a()):i()},r.ticks=function(t){var r,a=i(),s=a[0],u=a[a.length-1];(r=u<s)&&(h=s,s=u,u=h);var l,c,p,h=e(s),f=e(u),d=null==t?10:+t,v=[];if(!(o%1)&&f-h<d){if(h=Math.round(h)-1,f=Math.round(f)+1,s>0){for(;h<f;++h)for(c=1,l=n(h);c<o;++c)if(!((p=l*c)<s)){if(p>u)break;v.push(p)}}else for(;h<f;++h)for(c=o-1,l=n(h);c>=1;--c)if(!((p=l*c)<s)){if(p>u)break;v.push(p)}}else v=Bi(h,f,Math.min(f-h,d)).map(n);return r?v.reverse():v},r.tickFormat=function(t,i){if(null==i&&(i=10===o?".0e":","),"function"!=typeof i&&(i=Go(i)),t===1/0)return i;null==t&&(t=10);var a=Math.max(1,o*t/r.ticks().length);return function(t){var r=t/n(Math.round(e(t)));return r*o<o-.5&&(r*=o),r<=a?i(t):""}},r.nice=function(){return i(Qo(i(),{floor:function(t){return n(Math.floor(e(t)))},ceil:function(t){return n(Math.ceil(e(t)))}}))},r}function oa(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function aa(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function sa(t){return t<0?-t*t:t*t}function ua(t){var e=t(To,To),n=1;function r(){return 1===n?t(To,To):.5===n?t(aa,sa):t(oa(n),oa(1/n))}return e.exponent=function(t){return arguments.length?(n=+t,r()):n},Ko(e)}function la(){var t=ua(Lo());return t.copy=function(){return Oo(t,la()).exponent(t.exponent())},lo.apply(t,arguments),t}Vo=Xo({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"}),Go=Vo.format,Ho=Vo.formatPrefix;var ca=new Date,pa=new Date;function ha(t,e,n,r){function i(e){return t(e=0===arguments.length?new Date:new Date(+e)),e}return i.floor=function(e){return t(e=new Date(+e)),e},i.ceil=function(n){return t(n=new Date(n-1)),e(n,1),t(n),n},i.round=function(t){var e=i(t),n=i.ceil(t);return t-e<n-t?e:n},i.offset=function(t,n){return e(t=new Date(+t),null==n?1:Math.floor(n)),t},i.range=function(n,r,o){var a,s=[];if(n=i.ceil(n),o=null==o?1:Math.floor(o),!(n<r&&o>0))return s;do{s.push(a=new Date(+n)),e(n,o),t(n)}while(a<n&&n<r);return s},i.filter=function(n){return ha((function(e){if(e>=e)for(;t(e),!n(e);)e.setTime(e-1)}),(function(t,r){if(t>=t)if(r<0)for(;++r<=0;)for(;e(t,-1),!n(t););else for(;--r>=0;)for(;e(t,1),!n(t););}))},n&&(i.count=function(e,r){return ca.setTime(+e),pa.setTime(+r),t(ca),t(pa),Math.floor(n(ca,pa))},i.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?i.filter(r?function(e){return r(e)%t==0}:function(e){return i.count(0,e)%t==0}):i:null}),i}var fa=ha((function(t){t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,e){t.setFullYear(t.getFullYear()+e)}),(function(t,e){return e.getFullYear()-t.getFullYear()}),(function(t){return t.getFullYear()}));fa.every=function(t){return isFinite(t=Math.floor(t))&&t>0?ha((function(e){e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,n){e.setFullYear(e.getFullYear()+n*t)})):null};var da=fa,va=(fa.range,ha((function(t){t.setDate(1),t.setHours(0,0,0,0)}),(function(t,e){t.setMonth(t.getMonth()+e)}),(function(t,e){return e.getMonth()-t.getMonth()+12*(e.getFullYear()-t.getFullYear())}),(function(t){return t.getMonth()}))),ma=va,ya=(va.range,1e3),ga=6e4,_a=36e5,xa=864e5,ba=6048e5;function wa(t){return ha((function(e){e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)}),(function(t,e){t.setDate(t.getDate()+7*e)}),(function(t,e){return(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*ga)/ba}))}var Sa=wa(0),Ea=wa(1),Ca=wa(2),Ta=wa(3),Aa=wa(4),Ma=wa(5),ka=wa(6),Pa=(Sa.range,Ea.range,Ca.range,Ta.range,Aa.range,Ma.range,ka.range,ha((function(t){t.setHours(0,0,0,0)}),(function(t,e){t.setDate(t.getDate()+e)}),(function(t,e){return(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*ga)/xa}),(function(t){return t.getDate()-1}))),Oa=Pa,La=(Pa.range,ha((function(t){t.setTime(t-t.getMilliseconds()-t.getSeconds()*ya-t.getMinutes()*ga)}),(function(t,e){t.setTime(+t+e*_a)}),(function(t,e){return(e-t)/_a}),(function(t){return t.getHours()}))),Ia=La,Ra=(La.range,ha((function(t){t.setTime(t-t.getMilliseconds()-t.getSeconds()*ya)}),(function(t,e){t.setTime(+t+e*ga)}),(function(t,e){return(e-t)/ga}),(function(t){return t.getMinutes()}))),Da=Ra,Na=(Ra.range,ha((function(t){t.setTime(t-t.getMilliseconds())}),(function(t,e){t.setTime(+t+e*ya)}),(function(t,e){return(e-t)/ya}),(function(t){return t.getUTCSeconds()}))),Za=Na,za=(Na.range,ha((function(){}),(function(t,e){t.setTime(+t+e)}),(function(t,e){return e-t})));za.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?ha((function(e){e.setTime(Math.floor(e/t)*t)}),(function(e,n){e.setTime(+e+n*t)}),(function(e,n){return(n-e)/t})):za:null};var Fa=za;za.range;function Ba(t){return ha((function(e){e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+7*e)}),(function(t,e){return(e-t)/ba}))}var ja=Ba(0),Ua=Ba(1),Va=Ba(2),Ga=Ba(3),Ha=Ba(4),Wa=Ba(5),qa=Ba(6),Xa=(ja.range,Ua.range,Va.range,Ga.range,Ha.range,Wa.range,qa.range,ha((function(t){t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+e)}),(function(t,e){return(e-t)/xa}),(function(t){return t.getUTCDate()-1}))),Ya=Xa,Ka=(Xa.range,ha((function(t){t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCFullYear(t.getUTCFullYear()+e)}),(function(t,e){return e.getUTCFullYear()-t.getUTCFullYear()}),(function(t){return t.getUTCFullYear()})));Ka.every=function(t){return isFinite(t=Math.floor(t))&&t>0?ha((function(e){e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,n){e.setUTCFullYear(e.getUTCFullYear()+n*t)})):null};var Qa=Ka;Ka.range;function Ja(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function $a(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function ts(t,e,n){return{y:t,m:e,d:n,H:0,M:0,S:0,L:0}}var es,ns,rs={"-":"",_:" ",0:"0"},is=/^\s*\d+/,os=/^%/,as=/[\\^$*+?|[\]().{}]/g;function ss(t,e,n){var r=t<0?"-":"",i=(r?-t:t)+"",o=i.length;return r+(o<n?new Array(n-o+1).join(e)+i:i)}function us(t){return t.replace(as,"\\$&")}function ls(t){return new RegExp("^(?:"+t.map(us).join("|")+")","i")}function cs(t){for(var e={},n=-1,r=t.length;++n<r;)e[t[n].toLowerCase()]=n;return e}function ps(t,e,n){var r=is.exec(e.slice(n,n+1));return r?(t.w=+r[0],n+r[0].length):-1}function hs(t,e,n){var r=is.exec(e.slice(n,n+1));return r?(t.u=+r[0],n+r[0].length):-1}function fs(t,e,n){var r=is.exec(e.slice(n,n+2));return r?(t.U=+r[0],n+r[0].length):-1}function ds(t,e,n){var r=is.exec(e.slice(n,n+2));return r?(t.V=+r[0],n+r[0].length):-1}function vs(t,e,n){var r=is.exec(e.slice(n,n+2));return r?(t.W=+r[0],n+r[0].length):-1}function ms(t,e,n){var r=is.exec(e.slice(n,n+4));return r?(t.y=+r[0],n+r[0].length):-1}function ys(t,e,n){var r=is.exec(e.slice(n,n+2));return r?(t.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function gs(t,e,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(n,n+6));return r?(t.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function _s(t,e,n){var r=is.exec(e.slice(n,n+1));return r?(t.q=3*r[0]-3,n+r[0].length):-1}function xs(t,e,n){var r=is.exec(e.slice(n,n+2));return r?(t.m=r[0]-1,n+r[0].length):-1}function bs(t,e,n){var r=is.exec(e.slice(n,n+2));return r?(t.d=+r[0],n+r[0].length):-1}function ws(t,e,n){var r=is.exec(e.slice(n,n+3));return r?(t.m=0,t.d=+r[0],n+r[0].length):-1}function Ss(t,e,n){var r=is.exec(e.slice(n,n+2));return r?(t.H=+r[0],n+r[0].length):-1}function Es(t,e,n){var r=is.exec(e.slice(n,n+2));return r?(t.M=+r[0],n+r[0].length):-1}function Cs(t,e,n){var r=is.exec(e.slice(n,n+2));return r?(t.S=+r[0],n+r[0].length):-1}function Ts(t,e,n){var r=is.exec(e.slice(n,n+3));return r?(t.L=+r[0],n+r[0].length):-1}function As(t,e,n){var r=is.exec(e.slice(n,n+6));return r?(t.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function Ms(t,e,n){var r=os.exec(e.slice(n,n+1));return r?n+r[0].length:-1}function ks(t,e,n){var r=is.exec(e.slice(n));return r?(t.Q=+r[0],n+r[0].length):-1}function Ps(t,e,n){var r=is.exec(e.slice(n));return r?(t.s=+r[0],n+r[0].length):-1}function Os(t,e){return ss(t.getDate(),e,2)}function Ls(t,e){return ss(t.getHours(),e,2)}function Is(t,e){return ss(t.getHours()%12||12,e,2)}function Rs(t,e){return ss(1+Oa.count(da(t),t),e,3)}function Ds(t,e){return ss(t.getMilliseconds(),e,3)}function Ns(t,e){return Ds(t,e)+"000"}function Zs(t,e){return ss(t.getMonth()+1,e,2)}function zs(t,e){return ss(t.getMinutes(),e,2)}function Fs(t,e){return ss(t.getSeconds(),e,2)}function Bs(t){var e=t.getDay();return 0===e?7:e}function js(t,e){return ss(Sa.count(da(t)-1,t),e,2)}function Us(t){var e=t.getDay();return e>=4||0===e?Aa(t):Aa.ceil(t)}function Vs(t,e){return t=Us(t),ss(Aa.count(da(t),t)+(4===da(t).getDay()),e,2)}function Gs(t){return t.getDay()}function Hs(t,e){return ss(Ea.count(da(t)-1,t),e,2)}function Ws(t,e){return ss(t.getFullYear()%100,e,2)}function qs(t,e){return ss((t=Us(t)).getFullYear()%100,e,2)}function Xs(t,e){return ss(t.getFullYear()%1e4,e,4)}function Ys(t,e){var n=t.getDay();return ss((t=n>=4||0===n?Aa(t):Aa.ceil(t)).getFullYear()%1e4,e,4)}function Ks(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+ss(e/60|0,"0",2)+ss(e%60,"0",2)}function Qs(t,e){return ss(t.getUTCDate(),e,2)}function Js(t,e){return ss(t.getUTCHours(),e,2)}function $s(t,e){return ss(t.getUTCHours()%12||12,e,2)}function tu(t,e){return ss(1+Ya.count(Qa(t),t),e,3)}function eu(t,e){return ss(t.getUTCMilliseconds(),e,3)}function nu(t,e){return eu(t,e)+"000"}function ru(t,e){return ss(t.getUTCMonth()+1,e,2)}function iu(t,e){return ss(t.getUTCMinutes(),e,2)}function ou(t,e){return ss(t.getUTCSeconds(),e,2)}function au(t){var e=t.getUTCDay();return 0===e?7:e}function su(t,e){return ss(ja.count(Qa(t)-1,t),e,2)}function uu(t){var e=t.getUTCDay();return e>=4||0===e?Ha(t):Ha.ceil(t)}function lu(t,e){return t=uu(t),ss(Ha.count(Qa(t),t)+(4===Qa(t).getUTCDay()),e,2)}function cu(t){return t.getUTCDay()}function pu(t,e){return ss(Ua.count(Qa(t)-1,t),e,2)}function hu(t,e){return ss(t.getUTCFullYear()%100,e,2)}function fu(t,e){return ss((t=uu(t)).getUTCFullYear()%100,e,2)}function du(t,e){return ss(t.getUTCFullYear()%1e4,e,4)}function vu(t,e){var n=t.getUTCDay();return ss((t=n>=4||0===n?Ha(t):Ha.ceil(t)).getUTCFullYear()%1e4,e,4)}function mu(){return"+0000"}function yu(){return"%"}function gu(t){return+t}function _u(t){return Math.floor(+t/1e3)}!function(t){es=function(t){var e=t.dateTime,n=t.date,r=t.time,i=t.periods,o=t.days,a=t.shortDays,s=t.months,u=t.shortMonths,l=ls(i),c=cs(i),p=ls(o),h=cs(o),f=ls(a),d=cs(a),v=ls(s),m=cs(s),y=ls(u),g=cs(u),_={a:function(t){return a[t.getDay()]},A:function(t){return o[t.getDay()]},b:function(t){return u[t.getMonth()]},B:function(t){return s[t.getMonth()]},c:null,d:Os,e:Os,f:Ns,g:qs,G:Ys,H:Ls,I:Is,j:Rs,L:Ds,m:Zs,M:zs,p:function(t){return i[+(t.getHours()>=12)]},q:function(t){return 1+~~(t.getMonth()/3)},Q:gu,s:_u,S:Fs,u:Bs,U:js,V:Vs,w:Gs,W:Hs,x:null,X:null,y:Ws,Y:Xs,Z:Ks,"%":yu},x={a:function(t){return a[t.getUTCDay()]},A:function(t){return o[t.getUTCDay()]},b:function(t){return u[t.getUTCMonth()]},B:function(t){return s[t.getUTCMonth()]},c:null,d:Qs,e:Qs,f:nu,g:fu,G:vu,H:Js,I:$s,j:tu,L:eu,m:ru,M:iu,p:function(t){return i[+(t.getUTCHours()>=12)]},q:function(t){return 1+~~(t.getUTCMonth()/3)},Q:gu,s:_u,S:ou,u:au,U:su,V:lu,w:cu,W:pu,x:null,X:null,y:hu,Y:du,Z:mu,"%":yu},b={a:function(t,e,n){var r=f.exec(e.slice(n));return r?(t.w=d[r[0].toLowerCase()],n+r[0].length):-1},A:function(t,e,n){var r=p.exec(e.slice(n));return r?(t.w=h[r[0].toLowerCase()],n+r[0].length):-1},b:function(t,e,n){var r=y.exec(e.slice(n));return r?(t.m=g[r[0].toLowerCase()],n+r[0].length):-1},B:function(t,e,n){var r=v.exec(e.slice(n));return r?(t.m=m[r[0].toLowerCase()],n+r[0].length):-1},c:function(t,n,r){return E(t,e,n,r)},d:bs,e:bs,f:As,g:ys,G:ms,H:Ss,I:Ss,j:ws,L:Ts,m:xs,M:Es,p:function(t,e,n){var r=l.exec(e.slice(n));return r?(t.p=c[r[0].toLowerCase()],n+r[0].length):-1},q:_s,Q:ks,s:Ps,S:Cs,u:hs,U:fs,V:ds,w:ps,W:vs,x:function(t,e,r){return E(t,n,e,r)},X:function(t,e,n){return E(t,r,e,n)},y:ys,Y:ms,Z:gs,"%":Ms};function w(t,e){return function(n){var r,i,o,a=[],s=-1,u=0,l=t.length;for(n instanceof Date||(n=new Date(+n));++s<l;)37===t.charCodeAt(s)&&(a.push(t.slice(u,s)),null!=(i=rs[r=t.charAt(++s)])?r=t.charAt(++s):i="e"===r?" ":"0",(o=e[r])&&(r=o(n,i)),a.push(r),u=s+1);return a.push(t.slice(u,s)),a.join("")}}function S(t,e){return function(n){var r,i,o=ts(1900,void 0,1);if(E(o,t,n+="",0)!=n.length)return null;if("Q"in o)return new Date(o.Q);if("s"in o)return new Date(1e3*o.s+("L"in o?o.L:0));if(e&&!("Z"in o)&&(o.Z=0),"p"in o&&(o.H=o.H%12+12*o.p),void 0===o.m&&(o.m="q"in o?o.q:0),"V"in o){if(o.V<1||o.V>53)return null;"w"in o||(o.w=1),"Z"in o?(i=(r=$a(ts(o.y,0,1))).getUTCDay(),r=i>4||0===i?Ua.ceil(r):Ua(r),r=Ya.offset(r,7*(o.V-1)),o.y=r.getUTCFullYear(),o.m=r.getUTCMonth(),o.d=r.getUTCDate()+(o.w+6)%7):(i=(r=Ja(ts(o.y,0,1))).getDay(),r=i>4||0===i?Ea.ceil(r):Ea(r),r=Oa.offset(r,7*(o.V-1)),o.y=r.getFullYear(),o.m=r.getMonth(),o.d=r.getDate()+(o.w+6)%7)}else("W"in o||"U"in o)&&("w"in o||(o.w="u"in o?o.u%7:"W"in o?1:0),i="Z"in o?$a(ts(o.y,0,1)).getUTCDay():Ja(ts(o.y,0,1)).getDay(),o.m=0,o.d="W"in o?(o.w+6)%7+7*o.W-(i+5)%7:o.w+7*o.U-(i+6)%7);return"Z"in o?(o.H+=o.Z/100|0,o.M+=o.Z%100,$a(o)):Ja(o)}}function E(t,e,n,r){for(var i,o,a=0,s=e.length,u=n.length;a<s;){if(r>=u)return-1;if(37===(i=e.charCodeAt(a++))){if(i=e.charAt(a++),!(o=b[i in rs?e.charAt(a++):i])||(r=o(t,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return _.x=w(n,_),_.X=w(r,_),_.c=w(e,_),x.x=w(n,x),x.X=w(r,x),x.c=w(e,x),{format:function(t){var e=w(t+="",_);return e.toString=function(){return t},e},parse:function(t){var e=S(t+="",!1);return e.toString=function(){return t},e},utcFormat:function(t){var e=w(t+="",x);return e.toString=function(){return t},e},utcParse:function(t){var e=S(t+="",!0);return e.toString=function(){return t},e}}}(t),ns=es.format,es.parse,es.utcFormat,es.utcParse}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});var xu,bu,wu,Su,Eu,Cu,Tu=1e3,Au=6e4,Mu=36e5,ku=864e5,Pu=2592e6,Ou=31536e6;function Lu(t){return new Date(t)}function Iu(t){return t instanceof Date?+t:+new Date(+t)}function Ru(t,e,n,r,i,o,a,s,u){var l=Io(To,To),c=l.invert,p=l.domain,h=u(".%L"),f=u(":%S"),d=u("%I:%M"),v=u("%I %p"),m=u("%a %d"),y=u("%b %d"),g=u("%B"),_=u("%Y"),x=[[a,1,Tu],[a,5,5e3],[a,15,15e3],[a,30,3e4],[o,1,Au],[o,5,3e5],[o,15,9e5],[o,30,18e5],[i,1,Mu],[i,3,108e5],[i,6,216e5],[i,12,432e5],[r,1,ku],[r,2,1728e5],[n,1,6048e5],[e,1,Pu],[e,3,7776e6],[t,1,Ou]];function b(s){return(a(s)<s?h:o(s)<s?f:i(s)<s?d:r(s)<s?v:e(s)<s?n(s)<s?m:y:t(s)<s?g:_)(s)}function w(e,n,r,i){if(null==e&&(e=10),"number"==typeof e){var o=Math.abs(r-n)/e,a=Oi((function(t){return t[2]})).right(x,o);a===x.length?(i=Ui(n/Ou,r/Ou,e),e=t):a?(i=(a=x[o/x[a-1][2]<x[a][2]/o?a-1:a])[1],e=a[0]):(i=Math.max(Ui(n,r,e),1),e=s)}return null==i?e:e.every(i)}return l.invert=function(t){return new Date(c(t))},l.domain=function(t){return arguments.length?p(so.call(t,Iu)):p().map(Lu)},l.ticks=function(t,e){var n,r=p(),i=r[0],o=r[r.length-1],a=o<i;return a&&(n=i,i=o,o=n),n=(n=w(t,i,o,e))?n.range(i,o+1):[],a?n.reverse():n},l.tickFormat=function(t,e){return null==e?b:u(e)},l.nice=function(t,e){var n=p();return(t=w(t,n[0],n[n.length-1],e))?p(Qo(n,t)):l},l.copy=function(){return Oo(l,Ru(t,e,n,r,i,o,a,s,u))},l}function Du(){var t,e,n,r,i,o=0,a=1,s=To,u=!1;function l(e){return isNaN(e=+e)?i:s(0===n?.5:(e=(r(e)-t)*n,u?Math.max(0,Math.min(1,e)):e))}return l.domain=function(i){return arguments.length?(t=r(o=+i[0]),e=r(a=+i[1]),n=t===e?0:1/(e-t),l):[o,a]},l.clamp=function(t){return arguments.length?(u=!!t,l):u},l.interpolator=function(t){return arguments.length?(s=t,l):s},l.unknown=function(t){return arguments.length?(i=t,l):i},function(i){return r=i,t=i(o),e=i(a),n=t===e?0:1/(e-t),l}}function Nu(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function Zu(){var t,e,n,r,i,o,a,s=0,u=.5,l=1,c=To,p=!1;function h(t){return isNaN(t=+t)?a:(t=.5+((t=+o(t))-e)*(t<e?r:i),c(p?Math.max(0,Math.min(1,t)):t))}return h.domain=function(a){return arguments.length?(t=o(s=+a[0]),e=o(u=+a[1]),n=o(l=+a[2]),r=t===e?0:.5/(e-t),i=e===n?0:.5/(n-e),h):[s,u,l]},h.clamp=function(t){return arguments.length?(p=!!t,h):p},h.interpolator=function(t){return arguments.length?(c=t,h):c},h.unknown=function(t){return arguments.length?(a=t,h):a},function(a){return o=a,t=a(s),e=a(u),n=a(l),r=t===e?0:.5/(e-t),i=e===n?0:.5/(n-e),h}}function zu(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Fu(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?zu(Object(n),!0).forEach((function(e){(0,p.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):zu(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Bu,ju,Uu,Vu,Gu,Hu,Wu,qu=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,Xu=(xu={},(0,p.Z)(xu,i.ScaleTypes.LINEAR,(function t(){var e=Io(To,To);return e.copy=function(){return Oo(e,t())},lo.apply(e,arguments),Ko(e)})),(0,p.Z)(xu,i.ScaleTypes.POWER,la),(0,p.Z)(xu,i.ScaleTypes.LOG,(function t(){var e=ia(Lo()).domain([1,10]);return e.copy=function(){return Oo(e,t()).base(e.base())},lo.apply(e,arguments),e})),(0,p.Z)(xu,i.ScaleTypes.IDENTITY,(function t(e){var n;function r(t){return isNaN(t=+t)?n:t}return r.invert=r,r.domain=r.range=function(t){return arguments.length?(e=so.call(t,Eo),r):e.slice()},r.unknown=function(t){return arguments.length?(n=t,r):n},r.copy=function(){return t(e).unknown(n)},e=arguments.length?so.call(e,Eo):[0,1],Ko(r)})),(0,p.Z)(xu,i.ScaleTypes.SEQUENTIAL,(function t(){var e=Ko(Du()(To));return e.copy=function(){return Nu(e,t())},co.apply(e,arguments)})),(0,p.Z)(xu,i.ScaleTypes.TIME,(function(){return lo.apply(Ru(da,ma,Sa,Oa,Ia,Da,Za,Fa,ns).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)})),(0,p.Z)(xu,i.ScaleTypes.QUANTILE,(function t(){var e,n=[],r=[],i=[];function o(){var t=0,e=Math.max(1,r.length);for(i=new Array(e-1);++t<e;)i[t-1]=Gi(n,t/e);return a}function a(t){return isNaN(t=+t)?e:r[Ri(i,t)]}return a.invertExtent=function(t){var e=r.indexOf(t);return e<0?[NaN,NaN]:[e>0?i[e-1]:n[0],e<i.length?i[e]:n[n.length-1]]},a.domain=function(t){if(!arguments.length)return n.slice();n=[];for(var e,r=0,i=t.length;r<i;++r)null==(e=t[r])||isNaN(e=+e)||n.push(e);return n.sort(Pi),o()},a.range=function(t){return arguments.length?(r=uo.call(t),o()):r.slice()},a.unknown=function(t){return arguments.length?(e=t,a):e},a.quantiles=function(){return i.slice()},a.copy=function(){return t().domain(n).range(r).unknown(e)},lo.apply(a,arguments)})),(0,p.Z)(xu,i.ScaleTypes.QUANTIZE,(function t(){var e,n=0,r=1,i=1,o=[.5],a=[0,1];function s(t){return t<=t?a[Ri(o,t,0,i)]:e}function u(){var t=-1;for(o=new Array(i);++t<i;)o[t]=((t+1)*r-(t-i)*n)/(i+1);return s}return s.domain=function(t){return arguments.length?(n=+t[0],r=+t[1],u()):[n,r]},s.range=function(t){return arguments.length?(i=(a=uo.call(t)).length-1,u()):a.slice()},s.invertExtent=function(t){var e=a.indexOf(t);return e<0?[NaN,NaN]:e<1?[n,o[0]]:e>=i?[o[i-1],r]:[o[e-1],o[e]]},s.unknown=function(t){return arguments.length?(e=t,s):s},s.thresholds=function(){return o.slice()},s.copy=function(){return t().domain([n,r]).range(a).unknown(e)},lo.apply(Ko(s),arguments)})),(0,p.Z)(xu,i.ScaleTypes.THRESHOLD,(function t(){var e,n=[.5],r=[0,1],i=1;function o(t){return t<=t?r[Ri(n,t,0,i)]:e}return o.domain=function(t){return arguments.length?(n=uo.call(t),i=Math.min(n.length,r.length-1),o):n.slice()},o.range=function(t){return arguments.length?(r=uo.call(t),i=Math.min(n.length,r.length-1),o):r.slice()},o.invertExtent=function(t){var e=r.indexOf(t);return[n[e-1],n[e]]},o.unknown=function(t){return arguments.length?(e=t,o):e},o.copy=function(){return t().domain(n).range(r).unknown(e)},lo.apply(o,arguments)})),(0,p.Z)(xu,i.ScaleTypes.CAT,ho),(0,p.Z)(xu,i.ScaleTypes.DIVERGING,(function t(){var e=Ko(Zu()(To));return e.copy=function(){return Nu(e,t())},co.apply(e,arguments)})),xu),Yu=(bu=(0,Re.b2)(),wu=(0,Re.f3)(i.TYPES.IGlobalConfigService),bu((Eu=function(){function t(){(0,o.Z)(this,t),(0,d.Z)(this,"configService",Cu,this),(0,p.Z)(this,"scaleCache",{}),(0,p.Z)(this,"scaleOptions",{})}return(0,a.Z)(t,[{key:"apply",value:function(t,e){var n=this,r=e.styleAttributeService;t.hooks.init.tap("FeatureScalePlugin",(function(){n.scaleOptions=t.getScaleOptions();var e=r.getLayerStyleAttributes(),i=t.getSource().data.dataArray;0!==i.length&&n.caculateScalesForAttributes(e||[],i)})),t.hooks.beforeRenderData.tap("FeatureScalePlugin",(function(){n.scaleOptions=t.getScaleOptions();var e=r.getLayerStyleAttributes(),i=t.getSource().data.dataArray;return n.caculateScalesForAttributes(e||[],i),t.layerModelNeedUpdate=!0,!0})),t.hooks.beforeRender.tap("FeatureScalePlugin",(function(){if(!t.layerModelNeedUpdate){n.scaleOptions=t.getScaleOptions();var e=r.getLayerStyleAttributes();if(e){var i=t.getSource().data.dataArray;if(0===i.length)return;var o=e.filter((function(t){return t.needRescale}));o.length&&n.caculateScalesForAttributes(o,i)}}}))}},{key:"isNumber",value:function(t){return!isNaN(parseFloat(t))&&isFinite(t)}},{key:"caculateScalesForAttributes",value:function(t,e){var n=this;this.scaleCache={},t.forEach((function(t){if(t.scale){var r=t.scale;t.name;r.names=n.parseFields(t.scale.field||[]);var o=[];r.names.forEach((function(r){var i;o.push(n.createScale(r,t.name,null===(i=t.scale)||void 0===i?void 0:i.values,e))})),o.some((function(t){return t.type===i.StyleScaleType.VARIABLE}))?(r.type=i.StyleScaleType.VARIABLE,o.forEach((function(t){var e,n,o,a,s;r.callback||(r.values&&"text"!==r.values&&(null===(e=t.option)||void 0===e?void 0:e.type)!==i.ScaleTypes.DIVERGING&&(null===(n=t.option)||void 0===n?void 0:n.type)!==i.ScaleTypes.SEQUENTIAL?t.scale.range(r.values):(null===(o=t.option)||void 0===o?void 0:o.type)===i.ScaleTypes.CAT?t.scale.range(t.option.domain):(null===(a=t.option)||void 0===a?void 0:a.type)!==i.ScaleTypes.DIVERGING&&(null===(s=t.option)||void 0===s?void 0:s.type)!==i.ScaleTypes.SEQUENTIAL||t.scale.interpolator(Ji(r.values)))}))):(r.type=i.StyleScaleType.CONSTANT,r.defaultValues=o.map((function(t,e){return t.scale(r.names[e])}))),r.scalers=o.map((function(t){return{field:t.field,func:t.scale,option:t.option}})),t.needRescale=!1}}))}},{key:"parseFields",value:function(t){return Array.isArray(t)?t:P()(t)?t.split("*"):[t]}},{key:"createScale",value:function(t,e,n,r){var o,a,s=this.scaleOptions[e]&&(null===(o=this.scaleOptions[e])||void 0===o?void 0:o.field)===t?this.scaleOptions[e]:this.scaleOptions[t],u={field:t,scale:void 0,type:i.StyleScaleType.VARIABLE,option:s};if(!r||!r.length)return s&&s.type?u.scale=this.createDefaultScale(s):(u.scale=ho([t]),u.type=i.StyleScaleType.CONSTANT),u;var l=null===(a=r.find((function(e){return!ki()(e[t])})))||void 0===a?void 0:a[t];if(this.isNumber(t)||ki()(l)&&!s)u.scale=ho([t]),u.type=i.StyleScaleType.CONSTANT;else{var c=s&&s.type||this.getDefaultType(l);"text"===n&&(c=i.ScaleTypes.CAT);var p=this.createScaleConfig(c,t,s,r);u.scale=this.createDefaultScale(p),u.option=p}return u}},{key:"getDefaultType",value:function(t){var e=i.ScaleTypes.LINEAR;return"string"==typeof t&&(e=qu.test(t)?i.ScaleTypes.TIME:i.ScaleTypes.CAT),e}},{key:"createScaleConfig",value:function(t,e,n,r){var o={type:t},a=(null==r?void 0:r.map((function(t){return t[e]})))||[];if(null!=n&&n.domain)o.domain=null==n?void 0:n.domain;else if(t!==i.ScaleTypes.CAT&&t!==i.ScaleTypes.QUANTILE&&t!==i.ScaleTypes.DIVERGING)o.domain=Di(a);else if(t===i.ScaleTypes.CAT)o.domain=Ai()(a);else if(t===i.ScaleTypes.QUANTILE)o.domain=a;else if(t===i.ScaleTypes.DIVERGING){var s=Di(a),u=void 0!==(null==n?void 0:n.neutral)?null==n?void 0:n.neutral:(s[0]+s[1])/2;o.domain=[s[0],u,s[1]]}return Fu(Fu({},o),n)}},{key:"createDefaultScale",value:function(t){var e=t.type,n=t.domain,r=t.unknown,i=t.clamp,o=t.nice,a=Xu[e]();return n&&a.domain&&a.domain(n),r&&a.unknown(r),void 0!==i&&a.clamp&&a.clamp(i),void 0!==o&&a.nice&&a.nice(o),a}}]),t}(),Cu=(0,v.Z)(Eu.prototype,"configService",[wu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Su=Eu))||Su);function Ku(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}var Qu,Ju,$u,tl=(Bu=(0,Re.b2)(),ju=(0,Re.f3)(i.TYPES.ICameraService),Uu=(0,Re.f3)(i.TYPES.IRendererService),Bu((Gu=function(){function t(){(0,o.Z)(this,t),(0,d.Z)(this,"cameraService",Hu,this),(0,d.Z)(this,"rendererService",Wu,this)}return(0,a.Z)(t,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LayerAnimateStylePlugin",(function(){t.models.forEach((function(e){e.addUniforms(function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ku(Object(n),!0).forEach((function(e){(0,p.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ku(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},t.layerModel.getAnimateUniforms()))}))}))}}]),t}(),Hu=(0,v.Z)(Gu.prototype,"cameraService",[ju],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wu=(0,v.Z)(Gu.prototype,"rendererService",[Uu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vu=Gu))||Vu),el=(0,Re.b2)()(Qu=function(){function t(){(0,o.Z)(this,t)}return(0,a.Z)(t,[{key:"apply",value:function(t){t.hooks.init.tap("LayerModelPlugin",(function(){t.prepareBuildModel(),t.buildModels(),t.styleNeedUpdate=!1})),t.hooks.beforeRenderData.tap("DataSourcePlugin",(function(){return t.prepareBuildModel(),t.clearModels(),t.buildModels(),t.layerModelNeedUpdate=!1,!1}))}}]),t}())||Qu,nl=(0,Re.b2)()(Ju=function(){function t(){(0,o.Z)(this,t)}return(0,a.Z)(t,[{key:"apply",value:function(t){t.hooks.afterInit.tap("LayerStylePlugin",(function(){t.updateLayerConfig({});var e=t.getLayerConfig(),n=e.autoFit,r=e.fitBoundsOptions;n&&setTimeout((function(){t.fitBounds(r)}),100)}))}}]),t}())||Ju,rl=["type"];function il(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function ol(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?il(Object(n),!0).forEach((function(e){(0,p.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):il(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var al={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},sl={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},ul={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},ll={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};var cl,pl,hl,fl,dl,vl,ml,yl,gl,_l,xl,bl,wl,Sl,El,Cl,Tl,Al,Ml,kl,Pl=(0,Re.b2)()($u=function(){function t(){(0,o.Z)(this,t)}return(0,a.Z)(t,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LightingPlugin",(function(){t.getLayerConfig().enableLighting&&t.models.forEach((function(t){return t.addUniforms(ol({},(n={u_DirectionalLights:new Array(3).fill(ol({},ul)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(ol({},ll)),u_NumOfSpotLights:0},e&&e.length||(e=[sl]),e.forEach((function(t,e){var r=t.type,i=void 0===r?"directional":r,o=(0,f.Z)(t,rl),a=al[i].lights,s=al[i].num,u=n[s];n[a][u]=ol(ol({},n[a][u]),o),n[s]++})),n)));var e,n}))}))}}]),t}())||$u,Ol=(cl=(0,Re.b2)(),pl=(0,Re.f3)(i.TYPES.IGlobalConfigService),cl((fl=function(){function t(){(0,o.Z)(this,t),(0,d.Z)(this,"configService",dl,this),(0,p.Z)(this,"enabled",void 0)}return(0,a.Z)(t,[{key:"apply",value:function(t,e){var n=this,r=e.rendererService,i=e.postProcessingPassFactory,o=e.normalPassFactory;t.hooks.init.tap("MultiPassRendererPlugin",(function(){var e=t.getLayerConfig(),r=e.enableMultiPassRenderer,a=e.passes,s=void 0===a?[]:a;n.enabled=!!r&&!1!==t.getLayerConfig().enableMultiPassRenderer,n.enabled&&(t.multiPassRenderer=U(t,s,i,o),t.multiPassRenderer.setRenderFlag(!0))})),t.hooks.beforeRender.tap("MultiPassRendererPlugin",(function(){if(n.enabled){var e=r.getViewportSize(),i=e.width,o=e.height;t.multiPassRenderer.resize(i,o)}}))}}]),t}(),dl=(0,v.Z)(fl.prototype,"configService",[pl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hl=fl))||hl),Ll=1,Il=2,Rl=(0,Re.b2)()(vl=function(){function t(){(0,o.Z)(this,t)}return(0,a.Z)(t,[{key:"apply",value:function(t,e){e.rendererService;var n=e.styleAttributeService;t.hooks.init.tap("PixelPickingPlugin",(function(){n.registerStyleAttribute({name:"pickingColor",type:i.AttributeType.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:i.gl.FLOAT},size:3,update:function(t,e){var n=t.id;return(0,T.encodePickingColor)(n)}}})})),t.hooks.beforePickingEncode.tap("PixelPickingPlugin",(function(){t.getLayerConfig().enablePicking&&t.isVisible()&&t.models.forEach((function(t){return t.addUniforms({u_PickingStage:Ll})}))})),t.hooks.afterPickingEncode.tap("PixelPickingPlugin",(function(){t.getLayerConfig().enablePicking&&t.isVisible()&&t.models.forEach((function(t){return t.addUniforms({u_PickingStage:Il})}))})),t.hooks.beforeHighlight.tap("PixelPickingPlugin",(function(e){var n=t.getLayerConfig(),r=n.highlightColor,i=n.activeMix,o=void 0===i?0:i,a="string"==typeof r?(0,T.rgb2arr)(r):r||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:(0,T.decodePickingColor)(new Uint8Array(e))}),t.models.forEach((function(t){return t.addUniforms({u_PickingStage:Il,u_PickingColor:e,u_HighlightColor:a.map((function(t){return 255*t})),u_activeMix:o})}))})),t.hooks.beforeSelect.tap("PixelPickingPlugin",(function(e){var n=t.getLayerConfig(),r=n.selectColor,i=n.selectMix,o=void 0===i?0:i,a="string"==typeof r?(0,T.rgb2arr)(r):r||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:(0,T.decodePickingColor)(new Uint8Array(e))}),t.models.forEach((function(t){return t.addUniforms({u_PickingStage:Il,u_PickingColor:e,u_HighlightColor:a.map((function(t){return 255*t})),u_activeMix:o,u_CurrentSelectedId:e,u_SelectColor:a.map((function(t){return 255*t})),u_EnableSelect:1})}))}))}}]),t}())||vl,Dl=(0,Re.b2)()(ml=function(){function t(){(0,o.Z)(this,t)}return(0,a.Z)(t,[{key:"apply",value:function(t,e){var n=this,r=e.styleAttributeService;t.hooks.init.tap("RegisterStyleAttributePlugin",(function(){n.registerBuiltinAttributes(r)}))}},{key:"registerBuiltinAttributes",value:function(t){t.registerStyleAttribute({name:"position",type:i.AttributeType.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:i.gl.FLOAT},size:3,update:function(t,e,n){return 2===n.length?[n[0],n[1],0]:[n[0],n[1],n[2]]}}}),t.registerStyleAttribute({name:"filter",type:i.AttributeType.Attribute,descriptor:{name:"filter",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e){return t.filter?[1]:[0]}}}),t.registerStyleAttribute({name:"color",type:i.AttributeType.Attribute,descriptor:{name:"a_Color",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:4,update:function(t,e){var n=t.color;return n&&n.length?n:[1,1,1,1]}}}),t.registerStyleAttribute({name:"vertexId",type:i.AttributeType.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e,n,r){return[e]}}})}}]),t}())||ml,Nl=(yl=(0,Re.b2)(),gl=(0,Re.f3)(i.TYPES.ICameraService),_l=(0,Re.f3)(i.TYPES.ICoordinateSystemService),xl=(0,Re.f3)(i.TYPES.IRendererService),bl=(0,Re.f3)(i.TYPES.IMapService),yl((Sl=function(){function t(){(0,o.Z)(this,t),(0,d.Z)(this,"cameraService",El,this),(0,d.Z)(this,"coordinateSystemService",Cl,this),(0,d.Z)(this,"rendererService",Tl,this),(0,d.Z)(this,"mapService",Al,this)}return(0,a.Z)(t,[{key:"apply",value:function(t){var e=this,n=this.mapService.version,r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],o=[0,0];t.hooks.beforeRender.tap("ShaderUniformPlugin",(function(){if(e.coordinateSystemService.refresh(),"GAODE2.x"===n){var a=e.getLayerCenter(t);e.mapService.map.customCoords.setCenter(a),e.mapService.setCustomCoordCenter(a),r=e.mapService.map.customCoords.getMVPMatrix(),o=e.mapService.getCustomCoordCenter()}var s=e.rendererService.getViewportSize(),u=s.width,l=s.height;t.models.forEach((function(n){var a;n.addUniforms((a={},(0,p.Z)(a,i.CameraUniform.ProjectionMatrix,e.cameraService.getProjectionMatrix()),(0,p.Z)(a,i.CameraUniform.ViewMatrix,e.cameraService.getViewMatrix()),(0,p.Z)(a,i.CameraUniform.ViewProjectionMatrix,e.cameraService.getViewProjectionMatrix()),(0,p.Z)(a,i.CameraUniform.Zoom,e.cameraService.getZoom()),(0,p.Z)(a,i.CameraUniform.ZoomScale,e.cameraService.getZoomScale()),(0,p.Z)(a,i.CameraUniform.FocalDistance,e.cameraService.getFocalDistance()),(0,p.Z)(a,i.CameraUniform.CameraPosition,e.cameraService.getCameraPosition()),(0,p.Z)(a,i.CoordinateUniform.CoordinateSystem,e.coordinateSystemService.getCoordinateSystem()),(0,p.Z)(a,i.CoordinateUniform.ViewportCenter,e.coordinateSystemService.getViewportCenter()),(0,p.Z)(a,i.CoordinateUniform.ViewportCenterProjection,e.coordinateSystemService.getViewportCenterProjection()),(0,p.Z)(a,i.CoordinateUniform.PixelsPerDegree,e.coordinateSystemService.getPixelsPerDegree()),(0,p.Z)(a,i.CoordinateUniform.PixelsPerDegree2,e.coordinateSystemService.getPixelsPerDegree2()),(0,p.Z)(a,i.CoordinateUniform.PixelsPerMeter,e.coordinateSystemService.getPixelsPerMeter()),(0,p.Z)(a,i.CoordinateUniform.Mvp,r),(0,p.Z)(a,"u_SceneCenterMKT",o),(0,p.Z)(a,"u_ViewportSize",[u,l]),(0,p.Z)(a,"u_ModelMatrix",e.cameraService.getModelMatrix()),(0,p.Z)(a,"u_DevicePixelRatio",T.$window.devicePixelRatio),(0,p.Z)(a,"u_PickingBuffer",t.getLayerConfig().pickingBuffer||0),(0,p.Z)(a,"u_shaderPick",Number(t.getShaderPickStat())),a))}))}))}},{key:"getLayerCenter",value:function(t){return t.getSource().center}}]),t}(),El=(0,v.Z)(Sl.prototype,"cameraService",[gl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cl=(0,v.Z)(Sl.prototype,"coordinateSystemService",[_l],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tl=(0,v.Z)(Sl.prototype,"rendererService",[xl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Al=(0,v.Z)(Sl.prototype,"mapService",[bl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wl=Sl))||wl),Zl=(0,Re.b2)()(Ml=function(){function t(){(0,o.Z)(this,t)}return(0,a.Z)(t,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("UpdateModelPlugin",(function(){t.layerModel&&t.layerModel.needUpdate()}))}}]),t}())||Ml,zl=(0,Re.b2)()(kl=function(){function t(){(0,o.Z)(this,t)}return(0,a.Z)(t,[{key:"apply",value:function(t,e){var n=this,r=e.styleAttributeService;t.hooks.init.tap("UpdateStyleAttributePlugin",(function(){n.initStyleAttribute(t,{styleAttributeService:r})})),t.hooks.beforeRender.tap("UpdateStyleAttributePlugin",(function(){t.layerModelNeedUpdate||n.updateStyleAtrribute(t,{styleAttributeService:r})}))}},{key:"updateStyleAtrribute",value:function(t,e){var n=e.styleAttributeService,r=n.getLayerStyleAttributes()||[],i=n.getLayerStyleAttribute("filter");n.getLayerStyleAttribute("shape");if(i&&i.needRegenerateVertices)return t.layerModelNeedUpdate=!0,void r.forEach((function(t){return t.needRegenerateVertices=!1}));r.filter((function(t){return t.needRegenerateVertices})).forEach((function(e){n.updateAttributeByFeatureRange(e.name,t.getEncodedData(),e.featureRange.startIndex,e.featureRange.endIndex),e.needRegenerateVertices=!1}))}},{key:"initStyleAttribute",value:function(t,e){var n=e.styleAttributeService;(n.getLayerStyleAttributes()||[]).filter((function(t){return t.needRegenerateVertices})).forEach((function(e){n.updateAttributeByFeatureRange(e.name,t.getEncodedData(),e.featureRange.startIndex,e.featureRange.endIndex),e.needRegenerateVertices=!1}))}}]),t}())||kl;i.container.bind(i.TYPES.ILayerPlugin).to(Ci).inRequestScope(),i.container.bind(i.TYPES.ILayerPlugin).to(Dl).inRequestScope(),i.container.bind(i.TYPES.ILayerPlugin).to(Yu).inRequestScope(),i.container.bind(i.TYPES.ILayerPlugin).to(Ei).inRequestScope(),i.container.bind(i.TYPES.ILayerPlugin).to(nl).inRequestScope(),i.container.bind(i.TYPES.ILayerPlugin).to(zl).inRequestScope(),i.container.bind(i.TYPES.ILayerPlugin).to(Zl).inRequestScope(),i.container.bind(i.TYPES.ILayerPlugin).to(Ol).inRequestScope(),i.container.bind(i.TYPES.ILayerPlugin).to(Nl).inRequestScope(),i.container.bind(i.TYPES.ILayerPlugin).to(tl).inRequestScope(),i.container.bind(i.TYPES.ILayerPlugin).to(Pl).inRequestScope(),i.container.bind(i.TYPES.ILayerPlugin).to(Rl).inRequestScope(),i.container.bind(i.TYPES.ILayerPlugin).to(el).inRequestScope()},72888:function(t,e,n){"use strict";n.r(e),n.d(e,{Earth:function(){return Ar},GaodeMap:function(){return yt},GaodeMapV2:function(){return Ot},Map:function(){return Ci},Mapbox:function(){return Fi},Version:function(){return W.G}});var r,i,o,a=n(15671),s=n(43144),u=n(60136),l=n(82963),c=n(61120),p=n(43269),h=n(4942),f=n(53229),d=n(20832);function v(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function m(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?v(Object(n),!0).forEach((function(e){(0,h.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var y=(r=(0,d.lazyInject)(d.TYPES.IGlobalConfigService),i=function(){function t(e){(0,a.Z)(this,t),(0,p.Z)(this,"configService",o,this),(0,h.Z)(this,"config",void 0),this.config=e}return(0,s.Z)(t,[{key:"setContainer",value:function(t,e,n,r){t.bind(d.TYPES.MapConfig).toConstantValue(m(m({},this.config),{},{id:e,canvas:n,hasBaseMap:r})),t.bind(d.TYPES.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),t}(),o=(0,f.Z)(i.prototype,"configService",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i),g=n(5647),_=n(93433),x=n(45987),b=n(15861),w=n(29439),S=n(87757),E=n.n(S),C=n(81618),T=n.n(C),A=n(35251),M=n(85975),k=n(77160),P=n(86700),O=(n(28660),function(){function t(e){(0,a.Z)(this,t),(0,h.Z)(this,"size",1e4),this.size=e||1e4}return(0,s.Z)(t,[{key:"setSize",value:function(t){this.size=t}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(t){return(180+t)/360*this.size}},{key:"mercatorYfromLat",value:function(t){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(t){return t/this.size*360-180}},{key:"latFromMercatorY",value:function(t){var e=180-360*(1-t/this.size);return 360/Math.PI*Math.atan(Math.exp(e*Math.PI/180))-90}},{key:"project",value:function(t){return[this.mercatorXfromLng(t[0]),this.mercatorYfromLat(t[1])]}},{key:"unproject",value:function(t){return[this.lngFromMercatorX(t[0]),this.latFromMercatorY(t[1])]}}]),t}());function L(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function I(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?L(Object(n),!0).forEach((function(e){(0,h.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function R(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={top:0,right:0,bottom:0,left:0};if("number"==typeof t)return{top:t,right:t,bottom:t,left:t};if(Array.isArray(t)){if(4===t.length)return{top:t[0],right:t[1],bottom:t[2],left:t[3]};if(2===t.length)return{top:t[0],right:t[1],bottom:t[0],left:t[1]}}return I(I({},e),t)}var D,N,Z,z,F,B,j,U,V,G,H,W=n(84859),q={dark:"amap://styles/c9f1d10cae34f8ab05e425462c5a58d7?isPublic=true",light:"amap://styles/c422f5c0cfced5be9fe3a83f05f28a68?isPublic=true",normal:"amap://styles/normal",blank:"amap://styles/07c17002b38775b32a7a76c66cf90e99?isPublic=true"},X=Math.PI/180,Y=function(){function t(){(0,a.Z)(this,t),(0,h.Z)(this,"projectionMatrix",M.create()),(0,h.Z)(this,"viewMatrix",M.create()),(0,h.Z)(this,"viewProjectionMatrix",M.create()),(0,h.Z)(this,"ViewProjectionMatrixUncentered",M.create()),(0,h.Z)(this,"viewUncenteredMatrix",M.create()),(0,h.Z)(this,"zoom",void 0),(0,h.Z)(this,"center",void 0)}return(0,s.Z)(t,[{key:"syncWithMapCamera",value:function(t){var e=t.zoom,n=void 0===e?1:e,r=t.pitch,i=void 0===r?0:r,o=t.bearing,a=void 0===o?0:o,s=t.center,u=void 0===s?[0,0]:s,l=t.offsetOrigin,c=void 0===l?[0,0]:l,p=t.cameraHeight,h=void 0===p?1:p,f=t.aspect,d=void 0===f?1:f,v=t.near,m=void 0===v?.1:v,y=t.far,g=void 0===y?1e3:y,_=t.fov,x=void 0===_?0:_;this.zoom=n,this.center=u;var b=i*X,w=(360-a)*X;M.perspective(this.projectionMatrix,x,d,m,g);var S=k.fromValues(h*Math.sin(b)*Math.sin(w),-h*Math.sin(b)*Math.cos(w),h*Math.cos(b)),E=k.fromValues(-Math.cos(b)*Math.sin(w),Math.cos(b)*Math.cos(w),Math.sin(b));M.lookAt(this.viewMatrix,S,k.fromValues(0,0,0),E),this.viewUncenteredMatrix=M.clone(this.viewMatrix),M.translate(this.viewMatrix,this.viewMatrix,k.fromValues(-c[0],c[1],0)),M.multiply(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),M.multiply(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 524288}},{key:"getCenter",value:function(){var t=(0,w.Z)(this.center,2);return[t[0],t[1]]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,e){var n=85.0511287798,r=Math.max(Math.min(n,t[1]),-n),i=256<<20,o=Math.PI/180,a=t[0]*o,s=r*o;s=Math.log(Math.tan(Math.PI/4+s/2));return[a=i*(.5/Math.PI*a+.5)-215440491,s=-(i*(-.5/Math.PI*s+(o=.5))-106744817)]}}]),t}(),K=n(25108),Q=["id","style","minZoom","maxZoom","token","mapInstance","plugin"];function J(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function $(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?J(Object(n),!0).forEach((function(e){(0,h.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):J(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}!function(t,e){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".amap-logo{\n display: none !important;\n}\n");var tt=0;window.forceWebGL=!0;var et="15cd8a57710d40c9b7c0e3cc120f1200",nt=!1,rt=[],it=(D=(0,P.b2)(),N=(0,P.f3)(d.TYPES.IGlobalConfigService),Z=(0,P.f3)(d.TYPES.MapConfig),z=(0,P.f3)(d.TYPES.ICoordinateSystemService),F=(0,P.f3)(d.TYPES.IEventEmitter),D((j=function(){function t(){var e=this;(0,a.Z)(this,t),(0,h.Z)(this,"version",W.G["GAODE1.x"]),(0,h.Z)(this,"simpleMapCoord",new O),(0,h.Z)(this,"map",void 0),(0,h.Z)(this,"bgColor","rgba(0, 0, 0, 0)"),(0,p.Z)(this,"configService",U,this),(0,p.Z)(this,"config",V,this),(0,p.Z)(this,"coordinateSystemService",G,this),(0,p.Z)(this,"eventEmitter",H,this),(0,h.Z)(this,"markerContainer",void 0),(0,h.Z)(this,"$mapContainer",void 0),(0,h.Z)(this,"viewport",void 0),(0,h.Z)(this,"cameraChangedCallback",void 0),(0,h.Z)(this,"handleCameraChanged",(function(t){var n=t.camera,r=n.fov,i=n.near,o=n.far,a=n.height,s=n.pitch,u=n.rotation,l=n.aspect,c=n.position,p=e.getCenter(),h=p.lng,f=p.lat;if(e.emit("mapchange"),e.cameraChangedCallback){e.viewport.syncWithMapCamera({aspect:l,bearing:360-u,far:o,fov:r,cameraHeight:a,near:i,pitch:s,zoom:e.map.getZoom()-1,center:[h,f],offsetOrigin:[c.x,c.y]});var v=e.config.offsetZoom,m=void 0===v?12:v;e.viewport.getZoom()>m?e.coordinateSystemService.setCoordinateSystem(d.CoordinateSystem.P20_OFFSET):e.coordinateSystemService.setCoordinateSystem(d.CoordinateSystem.P20),e.cameraChangedCallback(e.viewport)}}))}var e;return(0,s.Z)(t,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getContainer();if(null!==t){var e=t.getElementsByClassName("amap-maps")[0];this.markerContainer=A.DOM.create("div","l7-marker-container",e)}}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(t,e){-1!==d.MapServiceEvent.indexOf(t)?this.eventEmitter.on(t,e):this.map.on(t,e)}},{key:"off",value:function(t,e){-1!==d.MapServiceEvent.indexOf(t)?this.eventEmitter.off(t,e):this.map.off(t,e)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){var t;return null===(t=this.map.getContainer())||void 0===t?void 0:t.getElementsByClassName("amap-maps")[0]}},{key:"getSize",value:function(){var t=this.map.getSize();return[t.getWidth(),t.getHeight()]}},{key:"getType",value:function(){return"amap"}},{key:"getZoom",value:function(){return this.map.getZoom()-1}},{key:"setZoom",value:function(t){return this.map.setZoom(t+1)}},{key:"getCenter",value:function(t){if(null!=t&&t.padding){var e=this.getCenter(),n=this.getSize(),r=(0,w.Z)(n,2),i=(r[0],r[1],R(t.padding)),o=this.lngLatToPixel([e.lng,e.lat]),a=[(i.right-i.left)/2,(i.bottom-i.top)/2];return this.pixelToLngLat([o.x-a[0],o.y-a[1]])}var s=this.map.getCenter();return{lng:s.getLng(),lat:s.getLat()}}},{key:"setCenter",value:function(t,e){if(null!=e&&e.padding){var n=R(e.padding),r=this.lngLatToPixel(t),i=[(n.right-n.left)/2,(n.bottom-n.top)/2],o=this.pixelToLngLat([r.x+i[0],r.y+i[1]]);this.map.setCenter([o.lng,o.lat])}else this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return 360-this.map.getRotation()}},{key:"getBounds",value:function(){var t=this.map.getBounds().toBounds(),e=t.getNorthEast(),n=t.getSouthWest(),r=this.getCenter(),i=r.lng>e.getLng()||r.lng<n.getLng()?180-e.getLng():e.getLng();return[[r.lng<n.getLng()?n.getLng()-180:n.getLng(),n.getLat()],[i,e.getLat()]]}},{key:"getMinZoom",value:function(){return this.map.get("zooms")[0]-1}},{key:"getMaxZoom",value:function(){return this.map.get("zooms")[1]-1}},{key:"setRotation",value:function(t){return this.map.setRotation(t)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"zoomIn",value:function(){this.map.zoomIn()}},{key:"zoomOut",value:function(){this.map.zoomOut()}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.map.panBy(t,e)}},{key:"fitBounds",value:function(t){this.map.setBounds(new AMap.Bounds([t[0][0],t[0][1],t[1][0],t[1][1]]))}},{key:"setZoomAndCenter",value:function(t,e){this.map.setZoomAndCenter(t+1,e)}},{key:"setMapStyle",value:function(t){this.map.setMapStyle(this.getMapStyle(t))}},{key:"setMapStatus",value:function(t){this.map.setStatus(t)}},{key:"pixelToLngLat",value:function(t){var e=this.map.pixelToLngLat(new AMap.Pixel(t[0],t[1]));return{lng:e.getLng(),lat:e.getLat()}}},{key:"lngLatToPixel",value:function(t){var e=this.map.lnglatToPixel(new AMap.LngLat(t[0],t[1]));return{x:e.getX(),y:e.getY()}}},{key:"containerToLngLat",value:function(t){var e=new AMap.Pixel(t[0],t[1]),n=this.map.containerToLngLat(e);return{lng:null==n?void 0:n.getLng(),lat:null==n?void 0:n.getLat()}}},{key:"lngLatToContainer",value:function(t){var e=new AMap.LngLat(t[0],t[1]),n=this.map.lngLatToContainer(e);return{x:n.getX(),y:n.getY()}}},{key:"lngLatToCoord",value:function(t){var e=this.map.lngLatToGeodeticCoord(t);return[e.x,-e.y]}},{key:"lngLatToMercator",value:function(t,e){return{x:0,y:0,z:0}}},{key:"getModelMatrix",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.viewport.projectFlat(t),o=M.create();return M.translate(o,o,k.fromValues(i[0],i[1],e)),M.scale(o,o,k.fromValues(r[0],r[1],r[2])),M.rotateX(o,o,n[0]),M.rotateY(o,o,n[1]),M.rotateZ(o,o,n[2]),o}},{key:"init",value:(e=(0,b.Z)(E().mark((function t(){var e,n,r,i,o,a,s,u,l,c,p,h,f,d,v=this;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.config,n=e.id,r=e.style,i=void 0===r?"light":r,o=e.minZoom,a=void 0===o?0:o,s=e.maxZoom,u=void 0===s?18:s,l=e.token,c=void 0===l?et:l,p=e.mapInstance,h=e.plugin,f=void 0===h?[]:h,d=(0,x.Z)(e,Q),t.next=3,new Promise((function(t){var e=function(){if(p)v.map=p,v.$mapContainer=v.map.getContainer(),setTimeout((function(){v.map.on("camerachange",v.handleCameraChanged),t()}),30);else{v.$mapContainer=v.creatAmapContainer(n);var e=$({mapStyle:v.getMapStyle(i),zooms:[a,u],viewMode:"3D"},d);e.zoom&&(e.zoom+=1);var r=new AMap.Map(v.$mapContainer,e);r.on("camerachange",v.handleCameraChanged),r.on("camerachange",(function(){setTimeout((function(){return v.handleAfterMapChange()}))})),v.map=r,setTimeout((function(){t()}),10)}};nt||p?nt&&window.AMap||p?e():rt.push(e):(c===et&&K.warn(v.configService.getSceneWarninfo("MapToken")),nt=!0,f.push("Map3D"),T().load({key:c,version:"1.4.15",plugins:f}).then((function(t){e(),rt.length&&(rt.forEach((function(t){return t()})),rt=[])})).catch((function(t){throw new Error(t)})))}));case 3:this.viewport=new Y;case 4:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"meterToCoord",value:function(t,e){var n=AMap.GeometryUtil.distance((0,g.Z)(AMap.LngLat,(0,_.Z)(t)),(0,g.Z)(AMap.LngLat,(0,_.Z)(e))),r=this.lngLatToCoord(t),i=(0,w.Z)(r,2),o=i[0],a=i[1],s=this.lngLatToCoord(e),u=(0,w.Z)(s,2),l=u[0],c=u[1];return Math.sqrt(Math.pow(o-l,2)+Math.pow(a-c,2))/n}},{key:"exportMap",value:function(t){var e,n=null===(e=this.getContainer())||void 0===e?void 0:e.getElementsByClassName("amap-layer")[0];return"jpg"===t?null==n?void 0:n.toDataURL("image/jpeg"):null==n?void 0:n.toDataURL("image/png")}},{key:"emit",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).emit.apply(e,[t].concat(r))}},{key:"once",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).once.apply(e,[t].concat(r))}},{key:"destroy",value:function(){var t,e;this.map.destroy(),null===(t=this.$mapContainer)||void 0===t||null===(e=t.parentNode)||void 0===e||e.removeChild(this.$mapContainer),delete window.initAMap;var n=document.getElementById("amap-script");n&&document.head.removeChild(n)}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"handleAfterMapChange",value:function(){this.emit("mapAfterFrameChange")}},{key:"getMapStyle",value:function(t){return q[t]?q[t]:t}},{key:"creatAmapContainer",value:function(t){var e=t;"string"==typeof t&&(e=document.getElementById(t));var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      top: 0;\n      height: 100%;\n      width: 100%;\n    ",n.id="l7_amap_div"+tt++,e.appendChild(n),n}}]),t}(),U=(0,f.Z)(j.prototype,"configService",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),V=(0,f.Z)(j.prototype,"config",[Z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G=(0,f.Z)(j.prototype,"coordinateSystemService",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H=(0,f.Z)(j.prototype,"eventEmitter",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B=j))||B);function ot(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var at,st,ut,lt,ct,pt,ht,ft,dt,vt,mt,yt=function(t){(0,u.Z)(n,t);var e=ot(n);function n(){return(0,a.Z)(this,n),e.apply(this,arguments)}return(0,s.Z)(n,[{key:"getServiceConstructor",value:function(){return it}}]),n}(y),gt={dark:"amap://styles/c9f1d10cae34f8ab05e425462c5a58d7?isPublic=true",light:"amap://styles/c422f5c0cfced5be9fe3a83f05f28a68?isPublic=true",normal:"amap://styles/normal",blank:"amap://styles/07c17002b38775b32a7a76c66cf90e99?isPublic=true"},_t=function(){function t(){(0,a.Z)(this,t),(0,h.Z)(this,"projectionMatrix",M.create()),(0,h.Z)(this,"viewMatrix",M.create()),(0,h.Z)(this,"viewProjectionMatrix",M.create()),(0,h.Z)(this,"ViewProjectionMatrixUncentered",M.create()),(0,h.Z)(this,"viewUncenteredMatrix",M.create()),(0,h.Z)(this,"zoom",void 0),(0,h.Z)(this,"center",void 0)}return(0,s.Z)(t,[{key:"syncWithMapCamera",value:function(t){var e=t.zoom,n=void 0===e?1:e,r=t.center,i=void 0===r?[0,0]:r,o=t.offsetOrigin,a=void 0===o?[0,0]:o,s=t.cameraPosition,u=void 0===s?[0,0,0]:s,l=t.up,c=void 0===l?[0,1,0]:l,p=t.lookAt,h=void 0===p?[0,0,0]:p,f=t.aspect,d=void 0===f?1:f,v=t.near,m=void 0===v?.1:v,y=t.far,g=void 0===y?1e3:y,x=t.fov,b=void 0===x?45:x;this.zoom=n,this.center=i,M.perspective(this.projectionMatrix,b/180*Math.PI,d,m,g);var w=k.fromValues.apply(k,(0,_.Z)(u)),S=k.fromValues.apply(k,(0,_.Z)(h)),E=k.fromValues.apply(k,(0,_.Z)(c));M.lookAt(this.viewMatrix,w,S,E),this.viewUncenteredMatrix=M.clone(this.viewMatrix),M.translate(this.viewMatrix,this.viewMatrix,k.fromValues(-a[0],a[1],0)),M.multiply(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),M.multiply(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 1048576}},{key:"getCenter",value:function(){var t=(0,w.Z)(this.center,2);return[t[0],t[1]]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,e){var n=85.0511287798,r=Math.max(Math.min(n,t[1]),-n),i=256<<20,o=Math.PI/180,a=t[0]*o,s=r*o;s=Math.log(Math.tan(Math.PI/4+s/2));return[a=i*(.5/Math.PI*a+.5)-215440491,s=-(i*(-.5/Math.PI*s+(o=.5))-106744817)]}}]),t}(),xt=n(25108),bt=["id","style","minZoom","maxZoom","token","mapInstance","plugin","version"];function wt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function St(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?wt(Object(n),!0).forEach((function(e){(0,h.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):wt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}!function(t,e){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".amap-logo{\n display: none !important;\n}\n");var Et=0;window.forceWebGL=!0;var Ct="ff533602d57df6f8ab3b0fea226ae52f",Tt=!1,At=[],Mt=(at=(0,P.b2)(),st=(0,P.f3)(d.TYPES.IGlobalConfigService),ut=(0,P.f3)(d.TYPES.MapConfig),lt=(0,P.f3)(d.TYPES.ICoordinateSystemService),ct=(0,P.f3)(d.TYPES.IEventEmitter),at((ht=function(){function t(){var e=this;(0,a.Z)(this,t),(0,h.Z)(this,"version",W.G["GAODE2.x"]),(0,h.Z)(this,"simpleMapCoord",new O),(0,h.Z)(this,"map",void 0),(0,h.Z)(this,"sceneCenter",void 0),(0,h.Z)(this,"sceneCenterMKT",void 0),(0,h.Z)(this,"bgColor","rgba(0, 0, 0, 0)"),(0,p.Z)(this,"configService",ft,this),(0,p.Z)(this,"config",dt,this),(0,p.Z)(this,"coordinateSystemService",vt,this),(0,p.Z)(this,"eventEmitter",mt,this),(0,h.Z)(this,"markerContainer",void 0),(0,h.Z)(this,"$mapContainer",void 0),(0,h.Z)(this,"viewport",void 0),(0,h.Z)(this,"cameraChangedCallback",void 0),(0,h.Z)(this,"handleViewChanged",(function(t){var n=e.map.customCoords.getCameraParams(),r=n.fov,i=n.near,o=n.far,a=n.aspect,s=n.position,u=n.lookAt,l=n.up;e.emit("mapchange");var c=t.zoom,p=e.map.customCoords.getCenter();e.cameraChangedCallback&&(e.viewport.syncWithMapCamera({aspect:a,far:o,fov:r,cameraPosition:s,lookAt:u,up:l,near:i,zoom:c-1,center:p,offsetOrigin:[s[0],s[1]]}),e.coordinateSystemService.setCoordinateSystem(d.CoordinateSystem.P20_2),e.cameraChangedCallback(e.viewport))}))}var e;return(0,s.Z)(t,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"setCustomCoordCenter",value:function(t){this.sceneCenter=t,this.sceneCenterMKT=A.amap2Project.apply(void 0,(0,_.Z)(t))}},{key:"getCustomCoordCenter",value:function(){return this.sceneCenterMKT}},{key:"lngLatToCoordByLayer",value:function(t,e){var n=A.amap2Project.apply(void 0,(0,_.Z)(e));return this._sub((0,A.amap2Project)(t[0],t[1]),n)}},{key:"lngLatToCoordsByLayer",value:function(t,e){var n=this;return t.map((function(t){return"number"==typeof t[0]?n.lngLatToCoordByLayer(t,e):t.map((function(t){return n.lngLatToCoordByLayer(t,e)}))}))}},{key:"lngLatToCoord",value:function(t){return this.sceneCenter||(this.map.customCoords.setCenter(t),this.setCustomCoordCenter(t)),this._sub((0,A.amap2Project)(t[0],t[1]),this.sceneCenterMKT)}},{key:"lngLatToCoords",value:function(t){var e=this;return t.map((function(t){return"number"==typeof t[0]?e.lngLatToCoord(t):t.map((function(t){return e.lngLatToCoord(t)}))}))}},{key:"addMarkerContainer",value:function(){if(this.map){var t=this.map.getContainer();if(null!==t){var e=t.getElementsByClassName("amap-maps")[0];e.style.zIndex="auto",this.markerContainer=A.DOM.create("div","l7-marker-container2",e)}}}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(t,e){-1!==d.MapServiceEvent.indexOf(t)?this.eventEmitter.on(t,e):this.map.on(t,e)}},{key:"off",value:function(t,e){-1!==d.MapServiceEvent.indexOf(t)?this.eventEmitter.off(t,e):this.map.off(t,e)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){var t;return null===(t=this.map.getContainer())||void 0===t?void 0:t.getElementsByClassName("amap-maps")[0]}},{key:"getSize",value:function(){var t=this.map.getSize();return[t.getWidth(),t.getHeight()]}},{key:"getType",value:function(){return"amap2"}},{key:"getZoom",value:function(){return this.map.getZoom()-1}},{key:"setZoom",value:function(t){return this.map.setZoom(t+1)}},{key:"getCenter",value:function(t){if(null!=t&&t.padding){var e=this.getCenter(),n=this.getSize(),r=(0,w.Z)(n,2),i=(r[0],r[1],R(t.padding)),o=this.lngLatToPixel([e.lng,e.lat]),a=[(i.right-i.left)/2,(i.bottom-i.top)/2];return this.pixelToLngLat([o.x-a[0],o.y-a[1]])}var s=this.map.getCenter();return{lng:s.getLng(),lat:s.getLat()}}},{key:"setCenter",value:function(t,e){if(null!=e&&e.padding){var n=R(e.padding),r=this.lngLatToPixel(t),i=[(n.right-n.left)/2,(n.bottom-n.top)/2],o=this.pixelToLngLat([r.x+i[0],r.y+i[1]]);this.map.setCenter([o.lng,o.lat])}else this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return 360-this.map.getRotation()}},{key:"getBounds",value:function(){var t=this.map.getBounds(),e=t.getNorthEast(),n=t.getSouthWest(),r=this.getCenter(),i=r.lng>e.getLng()||r.lng<n.getLng()?180-e.getLng():e.getLng();return[[r.lng<n.getLng()?n.getLng()-180:n.getLng(),n.getLat()],[i,e.getLat()]]}},{key:"getMinZoom",value:function(){return this.map.getZooms()[0]-1}},{key:"getMaxZoom",value:function(){return this.map.getZooms()[1]-1}},{key:"setRotation",value:function(t){return this.map.setRotation(t)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"zoomIn",value:function(){this.map.zoomIn()}},{key:"zoomOut",value:function(){this.map.zoomOut()}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.map.panBy(t,e)}},{key:"fitBounds",value:function(t){this.map.setBounds(new AMap.Bounds([t[0][0],t[0][1],t[1][0],t[1][1]]))}},{key:"setZoomAndCenter",value:function(t,e){this.map.setZoomAndCenter(t+1,e)}},{key:"setMapStyle",value:function(t){this.map.setMapStyle(this.getMapStyle(t))}},{key:"setMapStatus",value:function(t){this.map.setStatus(t)}},{key:"pixelToLngLat",value:function(t){var e=this.map.pixelToLngLat(new AMap.Pixel(t[0],t[1]));return{lng:e.getLng(),lat:e.getLat()}}},{key:"lngLatToPixel",value:function(t){var e=this.map.lnglatToPixel(new AMap.LngLat(t[0],t[1]));return{x:e.getX(),y:e.getY()}}},{key:"containerToLngLat",value:function(t){var e=new AMap.Pixel(t[0],t[1]),n=this.map.containerToLngLat(e);return{lng:null==n?void 0:n.getLng(),lat:null==n?void 0:n.getLat()}}},{key:"lngLatToContainer",value:function(t){var e=new AMap.LngLat(t[0],t[1]),n=this.map.lngLatToContainer(e);return{x:n.getX(),y:n.getY()}}},{key:"lngLatToMercator",value:function(t,e){return{x:0,y:0,z:0}}},{key:"getModelMatrix",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.map.customCoords.lngLatToCoord(t),o=M.create();return M.translate(o,o,k.fromValues(i[0],i[1],e)),M.scale(o,o,k.fromValues(r[0],r[1],r[2])),M.rotateX(o,o,n[0]),M.rotateY(o,o,n[1]),M.rotateZ(o,o,n[2]),o}},{key:"init",value:(e=(0,b.Z)(E().mark((function t(){var e,n,r,i,o,a,s,u,l,c,p,h,f,d,v,m,y=this;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.config,n=e.id,r=e.style,i=void 0===r?"light":r,o=e.minZoom,a=void 0===o?0:o,s=e.maxZoom,u=void 0===s?18:s,l=e.token,c=void 0===l?Ct:l,p=e.mapInstance,h=e.plugin,f=void 0===h?[]:h,d=e.version,v=void 0===d?"2.0":d,m=(0,x.Z)(e,bt),t.next=3,new Promise((function(t){var e=function(){if(p){var e;y.map=p,y.$mapContainer=y.map.getContainer();var r=y.map.getCenter();null===(e=y.map.customCoords)||void 0===e||e.setCenter([r.lng,r.lat]),y.setCustomCoordCenter([r.lng,r.lat]),setTimeout((function(){y.map.on("viewchange",y.handleViewChanged),t()}),30)}else{y.$mapContainer=y.creatAmapContainer(n);var o=St({mapStyle:y.getMapStyle(i),zooms:[a,u],viewMode:"3D"},m);o.zoom&&(o.zoom+=1);var s=new AMap.Map(y.$mapContainer,o);y.map=s;var l=s.getCenter();s.customCoords.setCenter([l.lng,l.lat]),y.setCustomCoordCenter([l.lng,l.lat]),s.on("viewchange",y.handleViewChanged),setTimeout((function(){t()}),10)}};y.viewport=new _t,Tt||p?Tt&&window.AMap||p?e():At.push(e):(c===Ct&&xt.warn(y.configService.getSceneWarninfo("MapToken")),Tt=!0,f.push("Map3D"),T().load({key:c,version:v,plugins:f}).then((function(t){e(),At.length&&(At.forEach((function(t){return t()})),At=[])})).catch((function(t){throw new Error(t)})))}));case 3:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"meterToCoord",value:function(t,e){var n=AMap.GeometryUtil.distance((0,g.Z)(AMap.LngLat,(0,_.Z)(t)),(0,g.Z)(AMap.LngLat,(0,_.Z)(e))),r=this.lngLatToCoord(t),i=(0,w.Z)(r,2),o=i[0],a=i[1],s=this.lngLatToCoord(e),u=(0,w.Z)(s,2),l=u[0],c=u[1];return Math.sqrt(Math.pow(o-l,2)+Math.pow(a-c,2))/n}},{key:"exportMap",value:function(t){var e,n=null===(e=this.getContainer())||void 0===e?void 0:e.getElementsByClassName("amap-layer")[0];return"jpg"===t?null==n?void 0:n.toDataURL("image/jpeg"):null==n?void 0:n.toDataURL("image/png")}},{key:"emit",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).emit.apply(e,[t].concat(r))}},{key:"once",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).once.apply(e,[t].concat(r))}},{key:"destroy",value:function(){var t,e;this.map.destroy(),null===(t=this.$mapContainer)||void 0===t||null===(e=t.parentNode)||void 0===e||e.removeChild(this.$mapContainer),delete window.initAMap;var n=document.getElementById("amap-script");n&&document.head.removeChild(n)}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"initViewPort",value:function(){var t,e=null===(t=this.map.customCoords)||void 0===t?void 0:t.getCameraParams(),n=e.fov,r=e.near,i=e.far,o=e.aspect,a=e.position,s=e.lookAt,u=e.up;this.emit("mapchange");var l=this.map.customCoords.getCenter(),c=this.map.getZoom();this.cameraChangedCallback&&(this.viewport.syncWithMapCamera({aspect:o,far:i,fov:n,cameraPosition:a,lookAt:s,near:r,up:u,zoom:c-1,center:l,offsetOrigin:[a[0],a[1]]}),this.coordinateSystemService.setCoordinateSystem(d.CoordinateSystem.P20_2),this.cameraChangedCallback(this.viewport))}},{key:"_sub",value:function(t,e){var n=[0,0];return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n}},{key:"getMapStyle",value:function(t){return gt[t]?gt[t]:t}},{key:"creatAmapContainer",value:function(t){var e=t;"string"==typeof t&&(e=document.getElementById(t));var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      top: 0;\n      height: 100%;\n      width: 100%;\n    ",n.id="l7_amap_div"+Et++,e.appendChild(n),n}}]),t}(),ft=(0,f.Z)(ht.prototype,"configService",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dt=(0,f.Z)(ht.prototype,"config",[ut],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vt=(0,f.Z)(ht.prototype,"coordinateSystemService",[lt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mt=(0,f.Z)(ht.prototype,"eventEmitter",[ct],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pt=ht))||pt);function kt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var Pt,Ot=function(t){(0,u.Z)(n,t);var e=kt(n);function n(){return(0,a.Z)(this,n),e.apply(this,arguments)}return(0,s.Z)(n,[{key:"getServiceConstructor",value:function(){return Mt}}]),n}(y),Lt=n(97326),It=n(82492),Rt=n.n(It),Dt=n(26729),Nt=n(71002),Zt=n(99874),zt=n.n(Zt);function Ft(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return Bt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Bt(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Bt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function jt(t,e,n){var r=n-e,i=((t-e)%r+r)%r+e;return i===e?n:i}function Ut(t,e,n){return Math.min(n,Math.max(e,t))}function Vt(t,e,n){return t*(1-n)+e*n}function Gt(t,e,n,r){var i=new(zt())(t,e,n,r);return function(t){return i.solve(t)}}var Ht=Gt(.25,.1,.25,1);function Wt(){return!(A.isMini||!A.$window.matchMedia)&&(null==Pt&&(Pt=A.$window.matchMedia("(prefers-reduced-motion: reduce)")),Pt.matches)}function qt(t,e){var n,r={},i=Ft(e);try{for(i.s();!(n=i.n()).done;){var o=n.value;o in t&&(r[o]=t[o])}}catch(t){i.e(t)}finally{i.f()}return r}var Xt=A.isMini?Date.now.bind(Date):A.$window.performance&&A.$window.performance.now?A.$window.performance.now.bind(A.$window.performance):Date.now.bind(Date),Yt=A.$window.requestAnimationFrame||A.$window.mozRequestAnimationFrame||A.$window.webkitRequestAnimationFrame||A.$window.msRequestAnimationFrame,Kt=A.$window.cancelAnimationFrame||A.$window.mozCancelAnimationFrame||A.$window.webkitCancelAnimationFrame||A.$window.msCancelAnimationFrame;function Qt(t){var e=Yt(t);return{cancel:function(){return Kt(e)}}}var Jt=6371008.8,$t=function(){function t(e,n){if((0,a.Z)(this,t),(0,h.Z)(this,"lng",void 0),(0,h.Z)(this,"lat",void 0),isNaN(e)||isNaN(n))throw new Error("Invalid LngLat object: (".concat(e,", ").concat(n,")"));if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}return(0,s.Z)(t,[{key:"wrap",value:function(){return new t(jt(this.lng,-180,180),this.lat)}},{key:"toArray",value:function(){return[this.lng,this.lat]}},{key:"toString",value:function(){return"LngLat(".concat(this.lng,", ").concat(this.lat,")")}},{key:"distanceTo",value:function(t){var e=Math.PI/180,n=this.lat*e,r=t.lat*e,i=Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos((t.lng-this.lng)*e);return Jt*Math.acos(Math.min(i,1))}}],[{key:"convert",value:function(e){if(e instanceof t)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new t(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"===(0,Nt.Z)(e)&&null!==e){var n="lng"in e?e.lng:e.lon;return new t(Number(n),Number(e.lat))}throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}]),t}(),te=function(){function t(e,n){(0,a.Z)(this,t),(0,h.Z)(this,"ne",void 0),(0,h.Z)(this,"sw",void 0),e&&(n?this.setSouthWest(e).setNorthEast(n):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}return(0,s.Z)(t,[{key:"setNorthEast",value:function(t){return this.ne=t instanceof $t?new $t(t.lng,t.lat):$t.convert(t),this}},{key:"setSouthWest",value:function(t){return this.sw=t instanceof $t?new $t(t.lng,t.lat):$t.convert(t),this}},{key:"extend",value:function(e){var n,r,i=this.sw,o=this.ne;if(e instanceof $t)n=e,r=e;else{if(!(e instanceof t)){if(Array.isArray(e)){if(4===e.length||e.every(Array.isArray)){var a=e;return this.extend(t.convert(a))}var s=e;return this.extend($t.convert(s))}return this}if(n=e.sw,r=e.ne,!n||!r)return this}return i||o?(i.lng=Math.min(n.lng,i.lng),i.lat=Math.min(n.lat,i.lat),o.lng=Math.max(r.lng,o.lng),o.lat=Math.max(r.lat,o.lat)):(this.sw=new $t(n.lng,n.lat),this.ne=new $t(r.lng,r.lat)),this}},{key:"getCenter",value:function(){return new $t((this.sw.lng+this.ne.lng)/2,(this.sw.lat+this.ne.lat)/2)}},{key:"getSouthWest",value:function(){return this.sw}},{key:"getNorthEast",value:function(){return this.ne}},{key:"getNorthWest",value:function(){return new $t(this.getWest(),this.getNorth())}},{key:"getSouthEast",value:function(){return new $t(this.getEast(),this.getSouth())}},{key:"getWest",value:function(){return this.sw.lng}},{key:"getSouth",value:function(){return this.sw.lat}},{key:"getEast",value:function(){return this.ne.lng}},{key:"getNorth",value:function(){return this.ne.lat}},{key:"toArray",value:function(){return[this.sw.toArray(),this.ne.toArray()]}},{key:"toString",value:function(){return"LngLatBounds(".concat(this.sw.toString(),", ").concat(this.ne.toString(),")")}},{key:"isEmpty",value:function(){return!(this.sw&&this.ne)}},{key:"contains",value:function(t){var e=$t.convert(t),n=e.lng,r=e.lat,i=this.sw.lat<=r&&r<=this.ne.lat,o=this.sw.lng<=n&&n<=this.ne.lng;return this.sw.lng>this.ne.lng&&(o=this.sw.lng>=n&&n>=this.ne.lng),i&&o}}],[{key:"convert",value:function(e){return e instanceof t?e:new t(e)}}]),t}(),ee=function(){function t(e,n){(0,a.Z)(this,t),(0,h.Z)(this,"x",void 0),(0,h.Z)(this,"y",void 0),this.x=e,this.y=n}return(0,s.Z)(t,[{key:"clone",value:function(){return new t(this.x,this.y)}},{key:"_add",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"add",value:function(t){return this.clone()._add(t)}},{key:"_sub",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"sub",value:function(t){return this.clone()._sub(t)}},{key:"_multByPoint",value:function(t){return this.x*=t.x,this.y*=t.y,this}},{key:"multByPoint",value:function(t){return this.clone()._multByPoint(t)}},{key:"_divByPoint",value:function(t){return this.x/=t.x,this.y/=t.y,this}},{key:"divByPoint",value:function(t){return this.clone()._divByPoint(t)}},{key:"_mult",value:function(t){return this.x*=t,this.y*=t,this}},{key:"mult",value:function(t){return this.clone()._mult(t)}},{key:"_div",value:function(t){return this.x/=t,this.y/=t,this}},{key:"div",value:function(t){return this.clone()._div(t)}},{key:"_rotate",value:function(t){var e=Math.cos(t),n=Math.sin(t),r=e*this.x-n*this.y,i=n*this.x+e*this.y;return this.x=r,this.y=i,this}},{key:"rotate",value:function(t){return this.clone()._rotate(t)}},{key:"_rotateAround",value:function(t,e){var n=Math.cos(t),r=Math.sin(t),i=e.x+n*(this.x-e.x)-r*(this.y-e.y),o=e.y+r*(this.x-e.x)+n*(this.y-e.y);return this.x=i,this.y=o,this}},{key:"roateAround",value:function(t,e){return this.clone()._rotateAround(t,e)}},{key:"_matMult",value:function(t){var e=t[0]*this.x+t[1]*this.y,n=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=n,this}},{key:"matMult",value:function(t){return this.clone()._matMult(t)}},{key:"_unit",value:function(){return this.div(this.mag()),this}},{key:"unit",value:function(){return this.clone()._unit()}},{key:"_perp",value:function(){var t=this.y;return this.y=this.x,this.x=-t,this}},{key:"perp",value:function(){return this.clone()._perp()}},{key:"_round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"round",value:function(){return this.clone()._round()}},{key:"mag",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"equals",value:function(t){return this.x===t.x&&this.y===t.y}},{key:"dist",value:function(t){return Math.sqrt(this.distSqr(t))}},{key:"distSqr",value:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n}},{key:"angle",value:function(){return Math.atan2(this.y,this.x)}},{key:"angleTo",value:function(t){return Math.atan2(this.y-t.y,this.x-t.x)}},{key:"angleWith",value:function(t){return this.angleWithSep(t.x,t.y)}},{key:"angleWithSep",value:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)}}],[{key:"convert",value:function(e){return e instanceof t?e:Array.isArray(e)?new t(e[0],e[1]):e}}]),t}(),ne=n(49685);var re=n(98333),ie=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if((0,a.Z)(this,t),(0,h.Z)(this,"top",void 0),(0,h.Z)(this,"bottom",void 0),(0,h.Z)(this,"left",void 0),(0,h.Z)(this,"right",void 0),isNaN(e)||e<0||isNaN(n)||n<0||isNaN(r)||r<0||isNaN(i)||i<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=n,this.left=r,this.right=i}return(0,s.Z)(t,[{key:"interpolate",value:function(t,e,n){return null!=e.top&&null!=t.top&&(this.top=Vt(t.top,e.top,n)),null!=e.bottom&&null!=t.bottom&&(this.bottom=Vt(t.bottom,e.bottom,n)),null!=e.left&&null!=t.left&&(this.left=Vt(t.left,e.left,n)),null!=e.right&&null!=t.right&&(this.right=Vt(t.right,e.right,n)),this}},{key:"getCenter",value:function(t,e){var n=Ut((this.left+t-this.right)/2,0,t),r=Ut((this.top+e-this.bottom)/2,0,e);return new ee(n,r)}},{key:"equals",value:function(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}},{key:"clone",value:function(){return new t(this.top,this.bottom,this.left,this.right)}},{key:"toJSON",value:function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}]),t}(),oe=2*Math.PI*Jt;function ae(t){return oe*Math.cos(t*Math.PI/180)}function se(t){return(180+t)/360}function ue(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function le(t,e){return t/ae(e)}function ce(t){var e=180-360*t;return 360/Math.PI*Math.atan(Math.exp(e*Math.PI/180))-90}var pe=function(){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,a.Z)(this,t),(0,h.Z)(this,"x",void 0),(0,h.Z)(this,"y",void 0),(0,h.Z)(this,"z",void 0),this.x=+e,this.y=+n,this.z=+r}return(0,s.Z)(t,[{key:"toLngLat",value:function(){return new $t(360*this.x-180,ce(this.y))}},{key:"toAltitude",value:function(){return t=this.z,e=this.y,t*ae(ce(e));var t,e}},{key:"meterInMercatorCoordinateUnits",value:function(){return 1/oe*(t=ce(this.y),1/Math.cos(t*Math.PI/180));var t}}],[{key:"fromLngLat",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=$t.convert(e);return new t(se(r.lng),ue(r.lat),le(n,r.lat))}}]),t}();function he(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return fe(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return fe(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function fe(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var de=function(){function t(e,n,r,i,o){(0,a.Z)(this,t),(0,h.Z)(this,"tileSize",void 0),(0,h.Z)(this,"tileZoom",void 0),(0,h.Z)(this,"lngRange",void 0),(0,h.Z)(this,"latRange",void 0),(0,h.Z)(this,"maxValidLatitude",void 0),(0,h.Z)(this,"scale",void 0),(0,h.Z)(this,"width",void 0),(0,h.Z)(this,"height",void 0),(0,h.Z)(this,"angle",void 0),(0,h.Z)(this,"rotationMatrix",void 0),(0,h.Z)(this,"pixelsToGLUnits",void 0),(0,h.Z)(this,"cameraToCenterDistance",void 0),(0,h.Z)(this,"mercatorMatrix",void 0),(0,h.Z)(this,"projMatrix",void 0),(0,h.Z)(this,"invProjMatrix",void 0),(0,h.Z)(this,"alignedProjMatrix",void 0),(0,h.Z)(this,"pixelMatrix",void 0),(0,h.Z)(this,"pixelMatrixInverse",void 0),(0,h.Z)(this,"glCoordMatrix",void 0),(0,h.Z)(this,"labelPlaneMatrix",void 0),(0,h.Z)(this,"_fov",void 0),(0,h.Z)(this,"_pitch",void 0),(0,h.Z)(this,"_zoom",void 0),(0,h.Z)(this,"_renderWorldCopies",void 0),(0,h.Z)(this,"_minZoom",void 0),(0,h.Z)(this,"_maxZoom",void 0),(0,h.Z)(this,"_minPitch",void 0),(0,h.Z)(this,"_maxPitch",void 0),(0,h.Z)(this,"_center",void 0),(0,h.Z)(this,"zoomFraction",void 0),(0,h.Z)(this,"unmodified",void 0),(0,h.Z)(this,"edgeInsets",void 0),(0,h.Z)(this,"constraining",void 0),(0,h.Z)(this,"posMatrixCache",void 0),(0,h.Z)(this,"alignedPosMatrixCache",void 0),this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===o||o,this._minZoom=e||0,this._maxZoom=n||22,this._minPitch=null==r?0:r,this._maxPitch=null==i?60:i,this.setMaxBounds(),this.width=0,this.height=0,this._center=new $t(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this.unmodified=!0,this.edgeInsets=new ie,this.posMatrixCache={},this.alignedPosMatrixCache={}}return(0,s.Z)(t,[{key:"minZoom",get:function(){return this._minZoom},set:function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}},{key:"maxZoom",get:function(){return this._maxZoom},set:function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}},{key:"minPitch",get:function(){return this._minPitch},set:function(t){this._minPitch!==t&&(this._minPitch=t,this._pitch=Math.max(this._pitch,t))}},{key:"maxPitch",get:function(){return this._maxPitch},set:function(t){this._maxPitch!==t&&(this._maxPitch=t,this._pitch=Math.min(this._pitch,t))}},{key:"renderWorldCopies",get:function(){return this._renderWorldCopies},set:function(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t}},{key:"worldSize",get:function(){return this.tileSize*this.scale}},{key:"centerOffset",get:function(){return this.centerPoint._sub(this.size._div(2))}},{key:"size",get:function(){return new ee(this.width,this.height)}},{key:"bearing",get:function(){return-this.angle/Math.PI*180},set:function(t){var e,n=-jt(t,-180,180)*Math.PI/180;this.angle!==n&&(this.unmodified=!1,this.angle=n,this.calcMatrices(),this.rotationMatrix=(e=new ne.WT(4),ne.WT!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e),function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);t[0]=r*u+o*s,t[1]=i*u+a*s,t[2]=r*-s+o*u,t[3]=i*-s+a*u}(this.rotationMatrix,this.rotationMatrix,this.angle))}},{key:"pitch",get:function(){return this._pitch/Math.PI*180},set:function(t){var e=Ut(t,this._minPitch,this._maxPitch)/180*Math.PI;this._pitch!==e&&(this.unmodified=!1,this._pitch=e,this.calcMatrices())}},{key:"fov",get:function(){return this._fov/Math.PI*180},set:function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this.unmodified=!1,this._fov=t/180*Math.PI,this.calcMatrices())}},{key:"zoom",get:function(){return this._zoom},set:function(t){var e=Math.min(Math.max(t,this._minZoom),this._maxZoom);this._zoom!==e&&(this.unmodified=!1,this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom,this.constrain(),this.calcMatrices())}},{key:"center",get:function(){return this._center},set:function(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this.unmodified=!1,this._center=t,this.constrain(),this.calcMatrices())}},{key:"padding",get:function(){return this.edgeInsets.toJSON()},set:function(t){this.edgeInsets.equals(t)||(this.unmodified=!1,this.edgeInsets.interpolate(this.edgeInsets,t,1),this.calcMatrices())}},{key:"centerPoint",get:function(){return this.edgeInsets.getCenter(this.width,this.height)}},{key:"point",get:function(){return this.project(this.center)}},{key:"clone",value:function(){var e=new t(this._minZoom,this._maxZoom,this._minPitch,this._maxPitch,this._renderWorldCopies);return e.tileSize=this.tileSize,e.latRange=this.latRange,e.width=this.width,e.height=this.height,e.center=this._center,e.zoom=this.zoom,e.angle=this.angle,e.fov=this._fov,e.pitch=this._pitch,e.unmodified=this.unmodified,e.edgeInsets=this.edgeInsets.clone(),e.calcMatrices(),e}},{key:"isPaddingEqual",value:function(t){return this.edgeInsets.equals(t)}},{key:"interpolatePadding",value:function(t,e,n){this.unmodified=!1,this.edgeInsets.interpolate(t,e,n),this.constrain(),this.calcMatrices()}},{key:"coveringZoomLevel",value:function(t){var e=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,e)}},{key:"resize",value:function(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this.constrain(),this.calcMatrices()}},{key:"zoomScale",value:function(t){return Math.pow(2,t)}},{key:"scaleZoom",value:function(t){return Math.log(t)/Math.LN2}},{key:"project",value:function(t){var e=Ut(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new ee(se(t.lng)*this.worldSize,ue(e)*this.worldSize)}},{key:"unproject",value:function(t){return new pe(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}},{key:"setLocationAtPoint",value:function(t,e){var n=this.pointCoordinate(e),r=this.pointCoordinate(this.centerPoint),i=this.locationCoordinate(t),o=new pe(i.x-(n.x-r.x),i.y-(n.y-r.y));this.center=this.coordinateLocation(o),this._renderWorldCopies&&(this.center=this.center.wrap())}},{key:"pointCoordinate",value:function(t){var e=new Float64Array([t.x,t.y,0,1]),n=new Float64Array([t.x,t.y,1,1]);re.fF(e,e,this.pixelMatrixInverse),re.fF(n,n,this.pixelMatrixInverse);var r=e[3],i=n[3],o=e[0]/r,a=n[0]/i,s=e[1]/r,u=n[1]/i,l=e[2]/r,c=n[2]/i,p=l===c?0:(0-l)/(c-l);return new pe(Vt(o,a,p)/this.worldSize,Vt(s,u,p)/this.worldSize)}},{key:"getBounds",value:function(){return(new te).extend(this.pointLocation(new ee(0,0))).extend(this.pointLocation(new ee(this.width,0))).extend(this.pointLocation(new ee(this.width,this.height))).extend(this.pointLocation(new ee(0,this.height)))}},{key:"getMaxBounds",value:function(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new te([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}},{key:"setMaxBounds",value:function(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this.constrain()):(this.lngRange=void 0,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}},{key:"customLayerMatrix",value:function(){return this.mercatorMatrix.slice()}},{key:"maxPitchScaleFactor",value:function(){if(!this.pixelMatrixInverse)return 1;var t=this.pointCoordinate(new ee(0,0)),e=new Float32Array([t.x*this.worldSize,t.y*this.worldSize,0,1]);return re.fF(e,e,this.pixelMatrix)[3]/this.cameraToCenterDistance}},{key:"getCameraPoint",value:function(){var t=this._pitch,e=Math.tan(t)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new ee(0,e))}},{key:"getCameraQueryGeometry",value:function(t){var e=this.getCameraPoint();if(1===t.length)return[t[0],e];var n,r=e.x,i=e.y,o=e.x,a=e.y,s=he(t);try{for(s.s();!(n=s.n()).done;){var u=n.value;r=Math.min(r,u.x),i=Math.min(i,u.y),o=Math.max(o,u.x),a=Math.max(a,u.y)}}catch(t){s.e(t)}finally{s.f()}return[new ee(r,i),new ee(o,i),new ee(o,a),new ee(r,a),new ee(r,i)]}},{key:"coordinatePoint",value:function(t){var e=re.al(t.x*this.worldSize,t.y*this.worldSize,0,1);return re.fF(e,e,this.pixelMatrix),new ee(e[0]/e[3],e[1]/e[3])}},{key:"locationPoint",value:function(t){return this.coordinatePoint(this.locationCoordinate(t))}},{key:"pointLocation",value:function(t){return this.coordinateLocation(this.pointCoordinate(t))}},{key:"locationCoordinate",value:function(t){return pe.fromLngLat(t)}},{key:"coordinateLocation",value:function(t){return t.toLngLat()}},{key:"getProjectionMatrix",value:function(){return this.projMatrix}},{key:"constrain",value:function(){if(this.center&&this.width&&this.height&&!this.constraining){this.constraining=!0;var t,e,n,r,i=-90,o=90,a=-180,s=180,u=this.size,l=this.unmodified;if(this.latRange){var c=this.latRange;i=ue(c[1])*this.worldSize,t=(o=ue(c[0])*this.worldSize)-i<u.y?u.y/(o-i):0}if(this.lngRange){var p=this.lngRange;a=se(p[0])*this.worldSize,e=(s=se(p[1])*this.worldSize)-a<u.x?u.x/(s-a):0}var h=this.point,f=Math.max(e||0,t||0);if(f)return this.center=this.unproject(new ee(e?(s+a)/2:h.x,t?(o+i)/2:h.y)),A.isMini?this.zoom=Math.max(this.zoom,Math.max(-1,this.minZoom)):this.zoom+=this.scaleZoom(f),this.unmodified=l,void(this.constraining=!1);if(this.latRange){var d=h.y,v=u.y/2;d-v<i&&(r=i+v),d+v>o&&(r=o-v)}if(this.lngRange){var m=h.x,y=u.x/2;m-y<a&&(n=a+y),m+y>s&&(n=s-y)}void 0===n&&void 0===r||(this.center=this.unproject(new ee(void 0!==n?n:h.x,void 0!==r?r:h.y))),this.unmodified=l,this.constraining=!1}}},{key:"calcMatrices",value:function(){if(this.height){var t=this._fov/2,e=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(t)*this.height;var n=Math.PI/2+this._pitch,r=this._fov*(.5+e.y/this.height),i=Math.sin(r)*this.cameraToCenterDistance/Math.sin(Ut(Math.PI-n-r,.01,Math.PI-.01)),o=this.point,a=o.x,s=o.y,u=1.01*(Math.cos(Math.PI/2-this._pitch)*i+this.cameraToCenterDistance),l=this.height/50,c=new Float64Array(16);M.perspective(c,this._fov,this.width/this.height,l,u),c[8]=2*-e.x/this.width,c[9]=2*e.y/this.height,M.scale(c,c,[1,-1,1]),M.translate(c,c,[0,0,-this.cameraToCenterDistance]),M.rotateX(c,c,this._pitch),M.rotateZ(c,c,this.angle),M.translate(c,c,[-a,-s,0]),this.mercatorMatrix=M.scale([],c,[this.worldSize,this.worldSize,this.worldSize]),M.scale(c,c,[1,1,le(1,this.center.lat)*this.worldSize,1]),this.projMatrix=c,this.invProjMatrix=M.invert([],this.projMatrix);var p=this.width%2/2,h=this.height%2/2,f=Math.cos(this.angle),d=Math.sin(this.angle),v=a-Math.round(a)+f*p+d*h,m=s-Math.round(s)+f*h+d*p,y=new Float64Array(c);if(M.translate(y,y,[v>.5?v-1:v,m>.5?m-1:m,0]),this.alignedProjMatrix=y,c=M.create(),M.scale(c,c,[this.width/2,-this.height/2,1]),M.translate(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=M.create(),M.scale(c,c,[1,-1,1]),M.translate(c,c,[-1,-1,0]),M.scale(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c,this.pixelMatrix=M.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(c=M.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=c,this.posMatrixCache={},this.alignedPosMatrixCache={}}}}]),t}(),ve=(0,s.Z)((function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,a.Z)(this,t),(0,h.Z)(this,"type",void 0),Rt()(this,n),this.type=e}));function me(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var ye=function(t){(0,u.Z)(n,t);var e=me(n);function n(t){var r;(0,a.Z)(this,n),r=e.call(this),(0,h.Z)((0,Lt.Z)(r),"transform",void 0),(0,h.Z)((0,Lt.Z)(r),"options",void 0),(0,h.Z)((0,Lt.Z)(r),"moving",void 0),(0,h.Z)((0,Lt.Z)(r),"zooming",void 0),(0,h.Z)((0,Lt.Z)(r),"rotating",void 0),(0,h.Z)((0,Lt.Z)(r),"pitching",void 0),(0,h.Z)((0,Lt.Z)(r),"padding",void 0),(0,h.Z)((0,Lt.Z)(r),"bearingSnap",void 0),(0,h.Z)((0,Lt.Z)(r),"easeEndTimeoutID",void 0),(0,h.Z)((0,Lt.Z)(r),"easeStart",void 0),(0,h.Z)((0,Lt.Z)(r),"easeOptions",void 0),(0,h.Z)((0,Lt.Z)(r),"easeId",void 0),(0,h.Z)((0,Lt.Z)(r),"onEaseFrame",void 0),(0,h.Z)((0,Lt.Z)(r),"onEaseEnd",void 0),(0,h.Z)((0,Lt.Z)(r),"easeFrameId",void 0),(0,h.Z)((0,Lt.Z)(r),"pitchEnabled",void 0),(0,h.Z)((0,Lt.Z)(r),"rotateEnabled",void 0),(0,h.Z)((0,Lt.Z)(r),"renderFrameCallback",(function(){var t=Math.min((Xt()-r.easeStart)/r.easeOptions.duration,1);r.onEaseFrame(r.easeOptions.easing(t)),t<1?r.easeFrameId=r.requestRenderFrame(r.renderFrameCallback):r.stop()})),r.options=t;var i=t.minZoom,o=t.maxZoom,s=t.minPitch,u=t.maxPitch,l=t.renderWorldCopies;return r.moving=!1,r.zooming=!1,r.bearingSnap=t.bearingSnap,r.pitchEnabled=t.pitchEnabled,r.rotateEnabled=t.rotateEnabled,r.transform=new de(i,o,s,u,l),r}return(0,s.Z)(n,[{key:"requestRenderFrame",value:function(t){return 0}},{key:"cancelRenderFrame",value:function(t){}},{key:"getCenter",value:function(){var t=this.transform.center,e=t.lng,n=t.lat;return new $t(e,n)}},{key:"getZoom",value:function(){return this.transform.zoom}},{key:"getPitch",value:function(){return this.transform.pitch}},{key:"setCenter",value:function(t,e){return this.jumpTo({center:t},e)}},{key:"setPitch",value:function(t,e){return this.jumpTo({pitch:t},e),this}},{key:"getBearing",value:function(){return this.transform.bearing}},{key:"panTo",value:function(t,e,n){return this.easeTo(Rt()({center:t},e),n)}},{key:"zoomOut",value:function(t,e){return this.zoomTo(this.getZoom()-1,t,e),this}},{key:"setBearing",value:function(t,e){return this.jumpTo({bearing:t},e),this}},{key:"setZoom",value:function(t,e){return this.jumpTo({zoom:t},e),this}},{key:"zoomIn",value:function(t,e){return this.zoomTo(this.getZoom()+1,t,e),this}},{key:"zoomTo",value:function(t,e,n){return this.easeTo(Rt()({zoom:t},e),n)}},{key:"getPadding",value:function(){return this.transform.padding}},{key:"setPadding",value:function(t,e){return this.jumpTo({padding:t},e),this}},{key:"rotateTo",value:function(t,e,n){return this.easeTo(Rt()({bearing:t},e),n)}},{key:"resetNorth",value:function(t,e){return this.rotateTo(0,Rt()({duration:1e3},t),e),this}},{key:"resetNorthPitch",value:function(t,e){return this.easeTo(Rt()({bearing:0,pitch:0,duration:1e3},t),e),this}},{key:"fitBounds",value:function(t,e,n){return this.fitInternal(this.cameraForBounds(t,e),e,n)}},{key:"cameraForBounds",value:function(t,e){return t=te.convert(t),this.cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),0,e)}},{key:"snapToNorth",value:function(t,e){return Math.abs(this.getBearing())<this.bearingSnap?this.resetNorth(t,e):this}},{key:"jumpTo",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;this.stop();var n=this.transform,r=!1,i=!1,o=!1;return t.zoom&&n.zoom!==+t.zoom&&(r=!0,n.zoom=+t.zoom),void 0!==t.center&&(n.center=$t.convert(t.center)),t.bearing&&n.bearing!==+t.bearing&&(i=!0,n.bearing=+t.bearing),t.pitch&&n.pitch!==+t.pitch&&(o=!0,n.pitch=+t.pitch),null==t.padding||n.isPaddingEqual(t.padding)||(n.padding=t.padding),this.emit("movestart",new ve("movestart",e)),this.emit("move",new ve("move",e)),r&&(this.emit("zoomstart",new ve("zoomstart",e)),this.emit("zoom",new ve("zoom",e)),this.emit("zoomend",new ve("zoomend",e))),i&&(this.emit("rotatestart",new ve("rotatestart",e)),this.emit("rotate",new ve("rotate",e)),this.emit("rotateend",new ve("rotateend",e))),o&&(this.emit("pitchstart",new ve("pitchstart",e)),this.emit("pitch",new ve("pitch",e)),this.emit("pitchend",new ve("pitchend",e))),this.emit("moveend",new ve("moveend",e))}},{key:"easeTo",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;(!1===(e=Rt()({offset:[0,0],duration:500,easing:Ht},e)).animate||!e.essential&&Wt())&&(e.duration=0);var r=this.transform,i=this.getZoom(),o=this.getBearing(),a=this.getPitch(),s=this.getPadding(),u=e.zoom?+e.zoom:i,l=e.bearing?this.normalizeBearing(e.bearing,o):o,c=e.pitch?+e.pitch:a,p=e.padding?e.padding:r.padding,h=ee.convert(e.offset),f=r.centerPoint.add(h),d=r.pointLocation(f),v=$t.convert(e.center||d);this.normalizeCenter(v);var m,y,g=r.project(d),_=r.project(v).sub(g),x=r.zoomScale(u-i);e.around&&(m=$t.convert(e.around),y=r.locationPoint(m));var b={moving:this.moving,zooming:this.zooming,rotating:this.rotating,pitching:this.pitching};return this.zooming=this.zooming||u!==i,this.rotating=this.rotating||o!==l,this.pitching=this.pitching||c!==a,this.padding=!r.isPaddingEqual(p),this.easeId=e.easeId,this.prepareEase(n,e.noMoveStart,b),clearTimeout(this.easeEndTimeoutID),this.ease((function(e){if(t.zooming&&(r.zoom=Vt(i,u,e)),t.rotating&&t.rotateEnabled&&(r.bearing=Vt(o,l,e)),t.pitching&&t.pitchEnabled&&(r.pitch=Vt(a,c,e)),t.padding&&(r.interpolatePadding(s,p,e),f=r.centerPoint.add(h)),m)r.setLocationAtPoint(m,y);else{var d=r.zoomScale(r.zoom-i),v=u>i?Math.min(2,x):Math.max(.5,x),b=Math.pow(v,1-e),w=r.unproject(g.add(_.mult(e*b)).mult(d));r.setLocationAtPoint(r.renderWorldCopies?w.wrap():w,f)}t.fireMoveEvents(n)}),(function(e){t.afterEase(n,e)}),e),this}},{key:"flyTo",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;if(!e.essential&&Wt()){var r=qt(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(r,n)}this.stop(),e=Rt()({offset:[0,0],speed:1.2,curve:1.42,easing:Ht},e);var i=this.transform,o=this.getZoom(),a=this.getBearing(),s=this.getPitch(),u=this.getPadding(),l=e.zoom?Ut(+e.zoom,i.minZoom,i.maxZoom):o,c=e.bearing?this.normalizeBearing(e.bearing,a):a,p=e.pitch?+e.pitch:s,h="padding"in e?e.padding:i.padding,f=i.zoomScale(l-o),d=ee.convert(e.offset),v=i.centerPoint.add(d),m=i.pointLocation(v),y=$t.convert(e.center||m);this.normalizeCenter(y);var g=i.project(m),_=i.project(y).sub(g),x=e.curve,b=Math.max(i.width,i.height),w=b/f,S=_.mag();if("minZoom"in e){var E=Ut(Math.min(e.minZoom,o,l),i.minZoom,i.maxZoom),C=b/i.zoomScale(E-o);x=Math.sqrt(C/S*2)}var T=x*x;function A(t){var e=(w*w-b*b+(t?-1:1)*T*T*S*S)/(2*(t?w:b)*T*S);return Math.log(Math.sqrt(e*e+1)-e)}function M(t){return(Math.exp(t)-Math.exp(-t))/2}function k(t){return(Math.exp(t)+Math.exp(-t))/2}function P(t){return M(t)/k(t)}var O=A(0),L=function(t){return k(O)/k(O+x*t)},I=function(t){return b*((k(O)*P(O+x*t)-M(O))/T)/S},R=(A(1)-O)/x;if(Math.abs(S)<1e-6||!isFinite(R)){if(Math.abs(b-w)<1e-6)return this.easeTo(e,n);var D=w<b?-1:1;R=Math.abs(Math.log(w/b))/x,I=function(){return 0},L=function(t){return Math.exp(D*x*t)}}if("duration"in e)e.duration=+e.duration;else{var N="screenSpeed"in e?+e.screenSpeed/x:+e.speed;e.duration=1e3*R/N}return e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this.zooming=!0,this.rotating=a!==c,this.pitching=p!==s,this.padding=!i.isPaddingEqual(h),this.prepareEase(n,!1),this.ease((function(e){var r=e*R,f=1/L(r);i.zoom=1===e?l:o+i.scaleZoom(f),t.rotating&&(i.bearing=Vt(a,c,e)),t.pitching&&(i.pitch=Vt(s,p,e)),t.padding&&(i.interpolatePadding(u,h,e),v=i.centerPoint.add(d));var m=1===e?y:i.unproject(g.add(_.mult(I(r))).mult(f));i.setLocationAtPoint(i.renderWorldCopies?m.wrap():m,v),t.fireMoveEvents(n)}),(function(){return t.afterEase(n)}),e),this}},{key:"fitScreenCoordinates",value:function(t,e,n,r,i){return this.fitInternal(this.cameraForBoxAndBearing(this.transform.pointLocation(ee.convert(t)),this.transform.pointLocation(ee.convert(e)),n,r),r,i)}},{key:"stop",value:function(t,e){if(this.easeFrameId&&(this.cancelRenderFrame(this.easeFrameId),delete this.easeFrameId,delete this.onEaseFrame),this.onEaseEnd){var n=this.onEaseEnd;delete this.onEaseEnd,n.call(this,e)}return this}},{key:"normalizeBearing",value:function(t,e){t=jt(t,-180,180);var n=Math.abs(t-e);return Math.abs(t-360-e)<n&&(t-=360),Math.abs(t+360-e)<n&&(t+=360),t}},{key:"normalizeCenter",value:function(t){var e=this.transform;if(e.renderWorldCopies&&!e.lngRange){var n=t.lng-e.center.lng;t.lng+=n>180?-360:n<-180?360:0}}},{key:"fireMoveEvents",value:function(t){this.emit("move",new ve("move",t)),this.zooming&&this.emit("zoom",new ve("zoom",t)),this.rotating&&this.emit("rotate",new ve("rotate",t)),this.pitching&&this.emit("rotate",new ve("pitch",t))}},{key:"prepareEase",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.moving=!0,e||n.moving||this.emit("movestart",new ve("movestart",t)),this.zooming&&!n.zooming&&this.emit("zoomstart",new ve("zoomstart",t)),this.rotating&&!n.rotating&&this.emit("rotatestart",new ve("rotatestart",t)),this.pitching&&!n.pitching&&this.emit("pitchstart",new ve("pitchstart",t))}},{key:"afterEase",value:function(t,e){if(!this.easeId||!e||this.easeId!==e){delete this.easeId;var n=this.zooming,r=this.rotating,i=this.pitching;this.moving=!1,this.zooming=!1,this.rotating=!1,this.pitching=!1,this.padding=!1,n&&this.emit("zoomend",new ve("zoomend",t)),r&&this.emit("rotateend",new ve("rotateend",t)),i&&this.emit("pitchend",new ve("pitchend",t)),this.emit("moveend",new ve("moveend",t))}}},{key:"ease",value:function(t,e,n){!1===n.animate||0===n.duration?(t(1),e()):(this.easeStart=Xt(),this.easeOptions=n,this.onEaseFrame=t,this.onEaseEnd=e,this.easeFrameId=this.requestRenderFrame(this.renderFrameCallback))}},{key:"cameraForBoxAndBearing",value:function(t,e,n,r){var i={top:0,bottom:0,right:0,left:0};if("number"==typeof(r=Rt()({padding:i,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){var o=r.padding;r.padding={top:o,bottom:o,right:o,left:o}}r.padding=Rt()(i,r.padding);var a=this.transform,s=a.padding,u=a.project($t.convert(t)),l=a.project($t.convert(e)),c=u.rotate(-n*Math.PI/180),p=l.rotate(-n*Math.PI/180),h=new ee(Math.max(c.x,p.x),Math.max(c.y,p.y)),f=new ee(Math.min(c.x,p.x),Math.min(c.y,p.y)),d=h.sub(f),v=(a.width-(s.left+s.right+r.padding.left+r.padding.right))/d.x,m=(a.height-(s.top+s.bottom+r.padding.top+r.padding.bottom))/d.y;if(!(m<0||v<0)){var y=Math.min(a.scaleZoom(a.scale*Math.min(v,m)),r.maxZoom),g=ee.convert(r.offset),_=(r.padding.left-r.padding.right)/2,x=(r.padding.top-r.padding.bottom)/2,b=new ee(g.x+_,g.y+x).mult(a.scale/a.zoomScale(y));return{center:a.unproject(u.add(l).div(2).sub(b)),zoom:y,bearing:n}}}},{key:"fitInternal",value:function(t,e,n){return t?(delete(e=Rt()(t,e)).padding,e.linear?this.easeTo(e,n):this.flyTo(e,n)):this}}]),n}(Dt.EventEmitter);function ge(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return _e(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _e(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function _e(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var xe={},be=xe;xe.create=function(t,e,n){var r=A.$window.document.createElement(t);return void 0!==e&&(r.className=e),n&&n.appendChild(r),r},xe.createNS=function(t,e){return A.$window.document.createElementNS(t,e)};var we=A.$window.document&&A.$window.document.documentElement.style;function Se(t){if(!we)return t[0];var e,n=ge(t);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(r in we)return r}}catch(t){n.e(t)}finally{n.f()}return t[0]}var Ee,Ce=Se(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);xe.disableDrag=function(){we&&Ce&&(Ee=we[Ce],we[Ce]="none")},xe.enableDrag=function(){we&&Ce&&(we[Ce]=Ee)};var Te=Se(["transform","WebkitTransform"]);xe.setTransform=function(t,e){t.style[Te]=e};var Ae=!1;try{var Me=Object.defineProperty({},"passive",{get:function(){Ae=!0}});A.$window.addEventListener("test",Me,Me),A.$window.removeEventListener("test",Me,Me)}catch(t){Ae=!1}xe.addEventListener=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};"passive"in r&&Ae?t.addEventListener(e,n,r):t.addEventListener(e,n,r.capture)},xe.removeEventListener=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};"passive"in r&&Ae?t.removeEventListener(e,n,r):t.removeEventListener(e,n,r.capture)};var ke=function t(e){e.preventDefault(),e.stopPropagation(),A.$window.removeEventListener("click",t,!0)};function Pe(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}xe.suppressClick=function(){A.isMini||(A.$window.addEventListener("click",ke,!0),setTimeout((function(){A.$window.removeEventListener("click",ke,!0)}),0))},xe.mousePos=function(t,e){if(A.isMini)return new ee(e.clientX-t.left-0,e.clientY-t.top-0);var n=t.getBoundingClientRect();return new ee(e.clientX-n.left-t.clientLeft,e.clientY-n.top-t.clientTop)},xe.touchPos=function(t,e){if(A.isMini){var n,r=[],i=ge(e);try{for(i.s();!(n=i.n()).done;){var o=n.value;r.push(new ee(o.clientX-t.left,o.clientY-t.top))}}catch(t){i.e(t)}finally{i.f()}return r}var a,s=t.getBoundingClientRect(),u=[],l=ge(e);try{for(l.s();!(a=l.n()).done;){var c=a.value;u.push(new ee(c.clientX-s.left-t.clientLeft,c.clientY-s.top-t.clientTop))}}catch(t){l.e(t)}finally{l.f()}return u},xe.mouseButton=function(t){return A.isMini&&void 0!==A.$window.InstallTrigger&&2===t.button&&t.ctrlKey&&A.$window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:t.button},xe.remove=function(t){t.parentNode&&t.parentNode.removeChild(t)};var Oe=function(t){(0,u.Z)(n,t);var e=Pe(n);function n(t,r,i){var o,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};(0,a.Z)(this,n);var u=be.mousePos(r.getCanvasContainer(),i),l=r.unproject(u);return o=e.call(this,t,Rt()({point:u,lngLat:l,originalEvent:i},s)),(0,h.Z)((0,Lt.Z)(o),"type",void 0),(0,h.Z)((0,Lt.Z)(o),"target",void 0),(0,h.Z)((0,Lt.Z)(o),"originalEvent",void 0),(0,h.Z)((0,Lt.Z)(o),"point",void 0),(0,h.Z)((0,Lt.Z)(o),"lngLat",void 0),(0,h.Z)((0,Lt.Z)(o),"defaultPrevented",void 0),o.defaultPrevented=!1,o.target=r,o}return(0,s.Z)(n,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),n}(ve);function Le(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var Ie=function(t){(0,u.Z)(n,t);var e=Le(n);function n(t,r,i){var o;(0,a.Z)(this,n);var s="touchend"===t?i.changedTouches:i.touches,u=be.touchPos(r.getCanvasContainer(),s),l=u.map((function(t){return r.unproject(t)})),c=u.reduce((function(t,e,n,r){return t.add(e.div(r.length))}),new ee(0,0)),p=r.unproject(c);return o=e.call(this,t,{points:u,point:c,lngLats:l,lngLat:p,originalEvent:i}),(0,h.Z)((0,Lt.Z)(o),"type",void 0),(0,h.Z)((0,Lt.Z)(o),"target",void 0),(0,h.Z)((0,Lt.Z)(o),"originalEvent",void 0),(0,h.Z)((0,Lt.Z)(o),"lngLat",void 0),(0,h.Z)((0,Lt.Z)(o),"point",void 0),(0,h.Z)((0,Lt.Z)(o),"points",void 0),(0,h.Z)((0,Lt.Z)(o),"lngLats",void 0),(0,h.Z)((0,Lt.Z)(o),"defaultPrevented",void 0),o.defaultPrevented=!1,o}return(0,s.Z)(n,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),n}(ve);function Re(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var De=function(t){(0,u.Z)(n,t);var e=Re(n);function n(t,r,i){var o;return(0,a.Z)(this,n),o=e.call(this,t,{originalEvent:i}),(0,h.Z)((0,Lt.Z)(o),"type",void 0),(0,h.Z)((0,Lt.Z)(o),"originalEvent",void 0),(0,h.Z)((0,Lt.Z)(o),"defaultPrevented",void 0),(0,h.Z)((0,Lt.Z)(o),"target",void 0),o.defaultPrevented=!1,o}return(0,s.Z)(n,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),n}(ve),Ne=function(){function t(e){(0,a.Z)(this,t),(0,h.Z)(this,"map",void 0),(0,h.Z)(this,"delayContextMenu",void 0),(0,h.Z)(this,"contextMenuEvent",void 0),this.map=e}return(0,s.Z)(t,[{key:"reset",value:function(){this.delayContextMenu=!1,delete this.contextMenuEvent}},{key:"mousemove",value:function(t){this.map.emit(t.type,new Oe(t.type,this.map,t))}},{key:"mousedown",value:function(){this.delayContextMenu=!0}},{key:"mouseup",value:function(){this.delayContextMenu=!1,this.contextMenuEvent&&(this.map.emit("contextmenu",new Oe("contextmenu",this.map,this.contextMenuEvent)),delete this.contextMenuEvent)}},{key:"contextmenu",value:function(t){this.delayContextMenu?this.contextMenuEvent=t:this.map.emit(t.type,new Oe(t.type,this.map,t)),this.map.listeners("contextmenu")&&t.preventDefault()}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){return!0}},{key:"disable",value:function(){return!1}}]),t}(),Ze=function(){function t(e,n){(0,a.Z)(this,t),(0,h.Z)(this,"map",void 0),(0,h.Z)(this,"el",void 0),(0,h.Z)(this,"container",void 0),(0,h.Z)(this,"enabled",void 0),(0,h.Z)(this,"active",void 0),(0,h.Z)(this,"startPos",void 0),(0,h.Z)(this,"lastPos",void 0),(0,h.Z)(this,"box",void 0),(0,h.Z)(this,"clickTolerance",void 0),this.map=e,this.el=e.getCanvasContainer(),this.container=e.getContainer(),this.clickTolerance=n.clickTolerance||1}return(0,s.Z)(t,[{key:"isEnabled",value:function(){return!!this.enabled}},{key:"isActive",value:function(){return!!this.active}},{key:"enable",value:function(){this.isEnabled()||(this.enabled=!0)}},{key:"disable",value:function(){this.isEnabled()&&(this.enabled=!1)}},{key:"mousedown",value:function(t,e){this.isEnabled()&&t.shiftKey&&0===t.button&&(be.disableDrag(),this.startPos=this.lastPos=e,this.active=!0)}},{key:"mousemoveWindow",value:function(t,e){if(this.active){var n=e;if(!(this.lastPos.equals(n)||!this.box&&n.dist(this.startPos)<this.clickTolerance)){var r=this.startPos;this.lastPos=n,this.box||(this.box=be.create("div","l7-boxzoom",this.container),this.container.classList.add("l7-crosshair"),this.fireEvent("boxzoomstart",t));var i=Math.min(r.x,n.x),o=Math.max(r.x,n.x),a=Math.min(r.y,n.y),s=Math.max(r.y,n.y);be.setTransform(this.box,"translate(".concat(i,"px,").concat(a,"px)")),this.box&&(this.box.style.width="".concat(o-i,"px"),this.box.style.height="".concat(s-a,"px"))}}}},{key:"mouseupWindow",value:function(t,e){var n=this;if(this.active&&0===t.button){var r=this.startPos,i=e;if(this.reset(),be.suppressClick(),r.x!==i.x||r.y!==i.y)return this.map.emit("boxzoomend",new ve("boxzoomend",{originalEvent:t})),{cameraAnimation:function(t){return t.fitScreenCoordinates(r,i,n.map.getBearing(),{linear:!0})}};this.fireEvent("boxzoomcancel",t)}}},{key:"keydown",value:function(t){this.active&&27===t.keyCode&&(this.reset(),this.fireEvent("boxzoomcancel",t))}},{key:"reset",value:function(){this.active=!1,this.container.classList.remove("l7-crosshair"),this.box&&(be.remove(this.box),this.box=null),be.enableDrag(),delete this.startPos,delete this.lastPos}},{key:"fireEvent",value:function(t,e){return this.map.emit(t,new ve(t,{originalEvent:e}))}}]),t}(),ze=Ze,Fe=function(){function t(){(0,a.Z)(this,t),(0,h.Z)(this,"enabled",void 0),(0,h.Z)(this,"active",void 0),this.reset()}return(0,s.Z)(t,[{key:"reset",value:function(){this.active=!1}},{key:"dblclick",value:function(t,e){return t.preventDefault(),{cameraAnimation:function(n){n.easeTo({duration:300,zoom:n.getZoom()+(t.shiftKey?-1:1),around:n.unproject(e)},{originalEvent:t})}}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),t}();function Be(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var je=function(t){(0,u.Z)(n,t);var e=Be(n);function n(){var t;(0,a.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,h.Z)((0,Lt.Z)(t),"type","renderFrame"),(0,h.Z)((0,Lt.Z)(t),"timeStamp",void 0),t}return(0,s.Z)(n)}(ve);function Ue(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return Ve(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ve(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Ve(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Ge={linearity:.3,easing:Gt(0,0,.3,1)},He=Rt()({deceleration:2500,maxSpeed:1400},Ge),We=Rt()({deceleration:20,maxSpeed:1400},Ge),qe=Rt()({deceleration:1e3,maxSpeed:360},Ge),Xe=Rt()({deceleration:1e3,maxSpeed:90},Ge),Ye=function(){function t(e){(0,a.Z)(this,t),(0,h.Z)(this,"map",void 0),(0,h.Z)(this,"inertiaBuffer",void 0),this.map=e,this.clear()}return(0,s.Z)(t,[{key:"clear",value:function(){this.inertiaBuffer=[]}},{key:"record",value:function(t){this.drainInertiaBuffer(),this.inertiaBuffer.push({time:Xt(),settings:t})}},{key:"drainInertiaBuffer",value:function(){for(var t=this.inertiaBuffer,e=Xt();t.length>0&&e-t[0].time>160;)t.shift()}},{key:"onMoveEnd",value:function(t){if(this.drainInertiaBuffer(),!(this.inertiaBuffer.length<2)){var e,n={zoom:0,bearing:0,pitch:0,pan:new ee(0,0),pinchAround:void 0,around:void 0},r=Ue(this.inertiaBuffer);try{for(r.s();!(e=r.n()).done;){var i=e.value.settings;n.zoom+=i.zoomDelta||0,n.bearing+=i.bearingDelta||0,n.pitch+=i.pitchDelta||0,i.panDelta&&n.pan._add(i.panDelta),i.around&&(n.around=i.around),i.pinchAround&&(n.pinchAround=i.pinchAround)}}catch(t){r.e(t)}finally{r.f()}var o=this.inertiaBuffer[this.inertiaBuffer.length-1].time-this.inertiaBuffer[0].time,a={};if(n.pan.mag()){var s=Qe(n.pan.mag(),o,Rt()({},He,t||{}));a.offset=n.pan.mult(s.amount/n.pan.mag()),a.center=this.map.transform.center,Ke(a,s)}if(n.zoom){var u=Qe(n.zoom,o,We);a.zoom=this.map.transform.zoom+u.amount,Ke(a,u)}if(n.bearing){var l=Qe(n.bearing,o,qe);a.bearing=this.map.transform.bearing+Ut(l.amount,-179,179),Ke(a,l)}if(n.pitch){var c=Qe(n.pitch,o,Xe);a.pitch=this.map.transform.pitch+c.amount,Ke(a,c)}if(a.zoom||a.bearing){var p=void 0===n.pinchAround?n.around:n.pinchAround;a.around=p?this.map.unproject(p):this.map.getCenter()}return this.clear(),Rt()(a,{noMoveStart:!0})}}}]),t}();function Ke(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function Qe(t,e,n){var r=n.maxSpeed,i=n.linearity,o=n.deceleration,a=Ut(t*i/(e/1e3),-r,r),s=Math.abs(a)/(o*i);return{easing:n.easing,duration:1e3*s,amount:a*(s/2)}}var Je={panStep:100,bearingStep:15,pitchStep:10};function $e(t){return t*(2-t)}var tn,en=function(){function t(){(0,a.Z)(this,t),(0,h.Z)(this,"enabled",void 0),(0,h.Z)(this,"active",void 0),(0,h.Z)(this,"panStep",void 0),(0,h.Z)(this,"bearingStep",void 0),(0,h.Z)(this,"pitchStep",void 0);var e=Je;this.panStep=e.panStep,this.bearingStep=e.bearingStep,this.pitchStep=e.pitchStep}return(0,s.Z)(t,[{key:"reset",value:function(){this.active=!1}},{key:"keydown",value:function(t){var e=this;if(!(t.altKey||t.ctrlKey||t.metaKey)){var n=0,r=0,i=0,o=0,a=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?r=-1:(t.preventDefault(),o=-1);break;case 39:t.shiftKey?r=1:(t.preventDefault(),o=1);break;case 38:t.shiftKey?i=1:(t.preventDefault(),a=-1);break;case 40:t.shiftKey?i=-1:(t.preventDefault(),a=1);break;default:return}return{cameraAnimation:function(s){var u=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:$e,zoom:n?Math.round(u)+n*(t.shiftKey?2:1):u,bearing:s.getBearing()+r*e.bearingStep,pitch:s.getPitch()+i*e.pitchStep,offset:[-o*e.panStep,-a*e.panStep],center:s.getCenter()},{originalEvent:t})}}}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),t}(),nn=function(){function t(e,n){(0,a.Z)(this,t),(0,h.Z)(this,"mousedownPos",void 0),(0,h.Z)(this,"clickTolerance",void 0),(0,h.Z)(this,"map",void 0),this.map=e,this.clickTolerance=n.clickTolerance}return(0,s.Z)(t,[{key:"reset",value:function(){delete this.mousedownPos}},{key:"wheel",value:function(t){return this.firePreventable(new De(t.type,this.map,t))}},{key:"mousedown",value:function(t,e){return this.mousedownPos=e,this.firePreventable(new Oe(t.type,this.map,t))}},{key:"mouseup",value:function(t){this.map.emit(t.type,new Oe(t.type,this.map,t))}},{key:"click",value:function(t,e){this.mousedownPos&&this.mousedownPos.dist(e)>=this.clickTolerance||this.map.emit(t.type,new Oe(t.type,this.map,t))}},{key:"dblclick",value:function(t){return this.firePreventable(new Oe(t.type,this.map,t))}},{key:"mouseover",value:function(t){this.map.emit(t.type,new Oe(t.type,this.map,t))}},{key:"mouseout",value:function(t){this.map.emit(t.type,new Oe(t.type,this.map,t))}},{key:"touchstart",value:function(t){return this.firePreventable(new Ie(t.type,this.map,t))}},{key:"touchmove",value:function(t){this.map.emit(t.type,new Ie(t.type,this.map,t))}},{key:"touchend",value:function(t){this.map.emit(t.type,new Ie(t.type,this.map,t))}},{key:"touchcancel",value:function(t){this.map.emit(t.type,new Ie(t.type,this.map,t))}},{key:"firePreventable",value:function(t){if(this.map.emit(t.type,t),t.defaultPrevented)return{}}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){return!1}},{key:"disable",value:function(){return!1}}]),t}(),rn=n(11752),on=(tn={},(0,h.Z)(tn,0,1),(0,h.Z)(tn,2,2),tn);var an=function(){function t(e){(0,a.Z)(this,t),(0,h.Z)(this,"enabled",void 0),(0,h.Z)(this,"active",void 0),(0,h.Z)(this,"lastPoint",void 0),(0,h.Z)(this,"eventButton",void 0),(0,h.Z)(this,"moved",void 0),(0,h.Z)(this,"clickTolerance",void 0),this.reset(),this.clickTolerance=e.clickTolerance||1}return(0,s.Z)(t,[{key:"reset",value:function(){this.active=!1,this.moved=!1,delete this.lastPoint,delete this.eventButton}},{key:"mousedown",value:function(t,e){if(!this.lastPoint){var n=be.mouseButton(t);this.correctButton(t,n)&&(this.lastPoint=e,this.eventButton=n)}}},{key:"mousemoveWindow",value:function(t,e){var n=this.lastPoint;if(n)if(t.preventDefault(),function(t,e){var n=on[e];return void 0===t.buttons||(t.buttons&n)!==n}(t,this.eventButton))this.reset();else if(this.moved||!(e.dist(n)<this.clickTolerance))return this.moved=!0,this.lastPoint=e,this.move(n,e)}},{key:"mouseupWindow",value:function(t){this.lastPoint&&(be.mouseButton(t)===this.eventButton&&(this.moved&&be.suppressClick(),this.reset()))}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}},{key:"correctButton",value:function(t,e){return!1}},{key:"move",value:function(t,e){}}]),t}();function sn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var un=function(t){(0,u.Z)(n,t);var e=sn(n);function n(){return(0,a.Z)(this,n),e.apply(this,arguments)}return(0,s.Z)(n,[{key:"mousedown",value:function(t,e){(0,rn.Z)((0,c.Z)(n.prototype),"mousedown",this).call(this,t,e),this.lastPoint&&(this.active=!0)}},{key:"move",value:function(t,e){return{around:e,panDelta:e.sub(t)}}},{key:"correctButton",value:function(t,e){return 0===e&&!t.ctrlKey}}]),n}(an);function ln(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var cn=function(t){(0,u.Z)(n,t);var e=ln(n);function n(){return(0,a.Z)(this,n),e.apply(this,arguments)}return(0,s.Z)(n,[{key:"correctButton",value:function(t,e){return 0===e&&t.ctrlKey||2===e}},{key:"move",value:function(t,e){var n=-.5*(e.y-t.y);if(n)return this.active=!0,{pitchDelta:n}}},{key:"contextmenu",value:function(t){t.preventDefault()}}]),n}(an);function pn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var hn=function(t){(0,u.Z)(n,t);var e=pn(n);function n(){return(0,a.Z)(this,n),e.apply(this,arguments)}return(0,s.Z)(n,[{key:"contextmenu",value:function(t){t.preventDefault()}},{key:"correctButton",value:function(t,e){return 0===e&&t.ctrlKey||2===e}},{key:"move",value:function(t,e){var n=.8*(e.x-t.x);if(n)return this.active=!0,{bearingDelta:n}}}]),n}(an),fn=4.000244140625,dn=function(){function t(e,n){var r=this;(0,a.Z)(this,t),(0,h.Z)(this,"map",void 0),(0,h.Z)(this,"el",void 0),(0,h.Z)(this,"enabled",void 0),(0,h.Z)(this,"active",void 0),(0,h.Z)(this,"zooming",void 0),(0,h.Z)(this,"aroundCenter",void 0),(0,h.Z)(this,"around",void 0),(0,h.Z)(this,"aroundPoint",void 0),(0,h.Z)(this,"type",void 0),(0,h.Z)(this,"lastValue",void 0),(0,h.Z)(this,"timeout",void 0),(0,h.Z)(this,"finishTimeout",void 0),(0,h.Z)(this,"lastWheelEvent",void 0),(0,h.Z)(this,"lastWheelEventTime",void 0),(0,h.Z)(this,"startZoom",void 0),(0,h.Z)(this,"targetZoom",void 0),(0,h.Z)(this,"delta",void 0),(0,h.Z)(this,"easing",void 0),(0,h.Z)(this,"prevEase",void 0),(0,h.Z)(this,"frameId",void 0),(0,h.Z)(this,"handler",void 0),(0,h.Z)(this,"defaultZoomRate",void 0),(0,h.Z)(this,"wheelZoomRate",void 0),(0,h.Z)(this,"onScrollFrame",(function(){if(r.frameId&&(r.frameId=null,r.isActive())){var t=r.map.transform;if(0!==r.delta){var e="wheel"===r.type&&Math.abs(r.delta)>fn?r.wheelZoomRate:r.defaultZoomRate,n=2/(1+Math.exp(-Math.abs(r.delta*e)));r.delta<0&&0!==n&&(n=1/n);var i="number"==typeof r.targetZoom?t.zoomScale(r.targetZoom):t.scale;r.targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(i*n))),"wheel"===r.type&&(r.startZoom=t.zoom,r.easing=r.smoothOutEasing(200)),r.delta=0}var o,a="number"==typeof r.targetZoom?r.targetZoom:t.zoom,s=r.startZoom,u=r.easing,l=!1;if("wheel"===r.type&&s&&u){var c=Math.min((Xt()-r.lastWheelEventTime)/200,1);o=Vt(s,a,u(c)),c<1?r.frameId||(r.frameId=!0):l=!0}else o=a,l=!0;return r.active=!0,l&&(r.active=!1,r.finishTimeout=setTimeout((function(){r.zooming=!1,r.handler.triggerRenderFrame(),delete r.targetZoom,delete r.finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!l,zoomDelta:o-t.zoom,around:r.aroundPoint,originalEvent:r.lastWheelEvent}}})),this.map=e,this.el=e.getCanvasContainer(),this.handler=n,this.delta=0,this.defaultZoomRate=.01,this.wheelZoomRate=.0022222222222222222}return(0,s.Z)(t,[{key:"setZoomRate",value:function(t){this.defaultZoomRate=t}},{key:"setWheelZoomRate",value:function(t){this.wheelZoomRate=t}},{key:"isEnabled",value:function(){return!!this.enabled}},{key:"isActive",value:function(){return!!this.active||void 0!==this.finishTimeout}},{key:"isZooming",value:function(){return!!this.zooming}},{key:"enable",value:function(t){this.isEnabled()||(this.enabled=!0,this.aroundCenter=t&&"center"===t.around)}},{key:"disable",value:function(){this.isEnabled()&&(this.enabled=!1)}},{key:"wheel",value:function(t){if(this.isEnabled()){var e=t.deltaMode===window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY,n=Xt(),r=n-(this.lastWheelEventTime||0);this.lastWheelEventTime=n,0!==e&&e%fn==0?this.type="wheel":0!==e&&Math.abs(e)<4?this.type="trackpad":r>400?(this.type=null,this.lastValue=e,this.timeout=setTimeout(this.onTimeout,40,t)):this.type||(this.type=Math.abs(r*e)<200?"trackpad":"wheel",this.timeout&&(clearTimeout(this.timeout),this.timeout=null,e+=this.lastValue)),t.shiftKey&&e&&(e/=4),this.type&&(this.lastWheelEvent=t,this.delta-=e,this.active||this.start(t)),t.preventDefault()}}},{key:"renderFrame",value:function(){return this.onScrollFrame()}},{key:"reset",value:function(){this.active=!1}},{key:"onTimeout",value:function(t){this.type="wheel",this.delta-=this.lastValue,!this.active&&this.start&&this.start(t)}},{key:"start",value:function(t){if(this.delta){this.frameId&&(this.frameId=null),this.active=!0,this.isZooming()||(this.zooming=!0),this.finishTimeout&&(clearTimeout(this.finishTimeout),delete this.finishTimeout);var e=be.mousePos(this.el,t);this.around=$t.convert(this.aroundCenter?this.map.getCenter():this.map.unproject(e)),this.aroundPoint=this.map.transform.locationPoint(this.around),this.frameId||(this.frameId=!0,this.handler.triggerRenderFrame())}}},{key:"smoothOutEasing",value:function(t){var e=Ht;if(this.prevEase){var n=this.prevEase,r=(Xt()-n.start)/n.duration,i=n.easing(r+.01)-n.easing(r),o=.27/Math.sqrt(i*i+1e-4)*.01;e=Gt(o,Math.sqrt(.0729-o*o),.25,1)}return this.prevEase={start:Xt(),duration:t,easing:e},e}}]),t}(),vn=dn,mn=function(){function t(e,n){(0,a.Z)(this,t),(0,h.Z)(this,"clickZoom",void 0),(0,h.Z)(this,"tapZoom",void 0),this.clickZoom=e,this.tapZoom=n}return(0,s.Z)(t,[{key:"enable",value:function(){this.clickZoom.enable(),this.tapZoom.enable()}},{key:"disable",value:function(){this.clickZoom.disable(),this.tapZoom.disable()}},{key:"isEnabled",value:function(){return this.clickZoom.isEnabled()&&this.tapZoom.isEnabled()}},{key:"isActive",value:function(){return this.clickZoom.isActive()||this.tapZoom.isActive()}}]),t}(),yn=function(){function t(e,n,r){(0,a.Z)(this,t),(0,h.Z)(this,"inertiaOptions",void 0),(0,h.Z)(this,"el",void 0),(0,h.Z)(this,"mousePan",void 0),(0,h.Z)(this,"touchPan",void 0),this.el=e,this.mousePan=n,this.touchPan=r}return(0,s.Z)(t,[{key:"enable",value:function(t){this.inertiaOptions=t||{},this.mousePan.enable(),this.touchPan.enable(),A.isMini||this.el.classList.add("l7-touch-drag-pan")}},{key:"disable",value:function(){this.mousePan.disable(),this.touchPan.disable(),A.isMini||this.el.classList.remove("l7-touch-drag-pan")}},{key:"isEnabled",value:function(){return this.mousePan.isEnabled()&&this.touchPan.isEnabled()}},{key:"isActive",value:function(){return this.mousePan.isActive()||this.touchPan.isActive()}}]),t}(),gn=function(){function t(e,n,r){(0,a.Z)(this,t),(0,h.Z)(this,"mouseRotate",void 0),(0,h.Z)(this,"mousePitch",void 0),(0,h.Z)(this,"pitchWithRotate",void 0),this.pitchWithRotate=e.pitchWithRotate,this.mouseRotate=n,this.mousePitch=r}return(0,s.Z)(t,[{key:"enable",value:function(){this.mouseRotate.enable(),this.pitchWithRotate&&this.mousePitch.enable()}},{key:"disable",value:function(){this.mouseRotate.disable(),this.mousePitch.disable()}},{key:"isEnabled",value:function(){return this.mouseRotate.isEnabled()&&(!this.pitchWithRotate||this.mousePitch.isEnabled())}},{key:"isActive",value:function(){return this.mouseRotate.isActive()||this.mousePitch.isActive()}}]),t}(),_n=function(){function t(e,n,r,i){(0,a.Z)(this,t),(0,h.Z)(this,"el",void 0),(0,h.Z)(this,"touchZoom",void 0),(0,h.Z)(this,"touchRotate",void 0),(0,h.Z)(this,"tapDragZoom",void 0),(0,h.Z)(this,"rotationDisabled",void 0),(0,h.Z)(this,"enabled",void 0),this.el=e,this.touchZoom=n,this.touchRotate=r,this.tapDragZoom=i,this.rotationDisabled=!1,this.enabled=!0}return(0,s.Z)(t,[{key:"enable",value:function(t){this.touchZoom.enable(t),this.rotationDisabled||this.touchRotate.enable(t),this.tapDragZoom.enable(),A.isMini||this.el.classList.add("l7-touch-zoom-rotate")}},{key:"disable",value:function(){this.touchZoom.disable(),this.touchRotate.disable(),this.tapDragZoom.disable(),A.isMini||this.el.classList.remove("l7-touch-zoom-rotate")}},{key:"isEnabled",value:function(){return this.touchZoom.isEnabled()&&(this.rotationDisabled||this.touchRotate.isEnabled())&&this.tapDragZoom.isEnabled()}},{key:"isActive",value:function(){return this.touchZoom.isActive()||this.touchRotate.isActive()||this.tapDragZoom.isActive()}},{key:"disableRotation",value:function(){this.rotationDisabled=!0,this.touchRotate.disable()}},{key:"enableRotation",value:function(){this.rotationDisabled=!1,this.touchZoom.isEnabled()&&this.touchRotate.enable()}}]),t}();function xn(t,e){for(var n={},r=0;r<t.length;r++)n[t[r].identifier]=e[r];return n}function bn(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return wn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return wn(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function wn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Sn=function(){function t(e){(0,a.Z)(this,t),(0,h.Z)(this,"numTouches",void 0),(0,h.Z)(this,"centroid",void 0),(0,h.Z)(this,"startTime",void 0),(0,h.Z)(this,"aborted",void 0),(0,h.Z)(this,"touches",void 0),this.reset(),this.numTouches=e.numTouches}return(0,s.Z)(t,[{key:"reset",value:function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}},{key:"touchstart",value:function(t,e,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=t.timeStamp),n.length===this.numTouches&&(this.centroid=function(t){var e,n=new ee(0,0),r=bn(t);try{for(r.s();!(e=r.n()).done;){var i=e.value;n._add(i)}}catch(t){r.e(t)}finally{r.f()}return n.div(t.length)}(e),this.touches=xn(n,e)))}},{key:"touchmove",value:function(t,e,n){if(!this.aborted&&this.centroid){var r=xn(n,e);for(var i in this.touches)if(this.touches[i]){var o=this.touches[i],a=r[i];(!a||a.dist(o)>30)&&(this.aborted=!0)}}}},{key:"touchend",value:function(t,e,n){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){var r=!this.aborted&&this.centroid;if(this.reset(),r)return r}}}]),t}(),En=function(){function t(e){(0,a.Z)(this,t),(0,h.Z)(this,"singleTap",void 0),(0,h.Z)(this,"numTaps",void 0),(0,h.Z)(this,"lastTime",void 0),(0,h.Z)(this,"lastTap",void 0),(0,h.Z)(this,"count",void 0),this.singleTap=new Sn(e),this.numTaps=e.numTaps,this.reset()}return(0,s.Z)(t,[{key:"reset",value:function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}},{key:"touchstart",value:function(t,e,n){this.singleTap.touchstart(t,e,n)}},{key:"touchmove",value:function(t,e,n){this.singleTap.touchmove(t,e,n)}},{key:"touchend",value:function(t,e,n){var r=this.singleTap.touchend(t,e,n);if(r){var i=t.timeStamp-this.lastTime<500,o=!this.lastTap||this.lastTap.dist(r)<30;if(i&&o||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}]),t}(),Cn=function(){function t(){(0,a.Z)(this,t),(0,h.Z)(this,"enabled",void 0),(0,h.Z)(this,"active",void 0),(0,h.Z)(this,"swipePoint",void 0),(0,h.Z)(this,"swipeTouch",void 0),(0,h.Z)(this,"tapTime",void 0),(0,h.Z)(this,"tap",void 0),this.tap=new En({numTouches:1,numTaps:1}),this.reset()}return(0,s.Z)(t,[{key:"reset",value:function(){this.active=!1,delete this.swipePoint,delete this.swipeTouch,delete this.tapTime,this.tap.reset()}},{key:"touchstart",value:function(t,e,n){this.swipePoint||(this.tapTime&&t.timeStamp-this.tapTime>500&&this.reset(),this.tapTime?n.length>0&&(this.swipePoint=e[0],this.swipeTouch=n[0].identifier):this.tap.touchstart(t,e,n))}},{key:"touchmove",value:function(t,e,n){if(this.tapTime){if(this.swipePoint){if(n[0].identifier!==this.swipeTouch)return;var r=e[0],i=r.y-this.swipePoint.y;return this.swipePoint=r,t.preventDefault(),this.active=!0,{zoomDelta:i/128}}}else this.tap.touchmove(t,e,n)}},{key:"touchend",value:function(t,e,n){this.tapTime?this.swipePoint&&0===n.length&&this.reset():this.tap.touchend(t,e,n)&&(this.tapTime=t.timeStamp)}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),t}(),Tn=function(){function t(){(0,a.Z)(this,t),(0,h.Z)(this,"enabled",void 0),(0,h.Z)(this,"active",void 0),(0,h.Z)(this,"zoomIn",void 0),(0,h.Z)(this,"zoomOut",void 0),this.zoomIn=new En({numTouches:1,numTaps:2}),this.zoomOut=new En({numTouches:2,numTaps:1}),this.reset()}return(0,s.Z)(t,[{key:"reset",value:function(){this.active=!1,this.zoomIn.reset(),this.zoomOut.reset()}},{key:"touchstart",value:function(t,e,n){this.zoomIn.touchstart(t,e,n),this.zoomOut.touchstart(t,e,n)}},{key:"touchmove",value:function(t,e,n){this.zoomIn.touchmove(t,e,n),this.zoomOut.touchmove(t,e,n)}},{key:"touchend",value:function(t,e,n){var r=this,i=this.zoomIn.touchend(t,e,n),o=this.zoomOut.touchend(t,e,n);return i?(this.active=!0,t.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(e){return e.easeTo({duration:300,zoom:e.getZoom()+1,around:e.unproject(i)},{originalEvent:t})}}):o?(this.active=!0,t.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(e){return e.easeTo({duration:300,zoom:e.getZoom()-1,around:e.unproject(o)},{originalEvent:t})}}):void 0}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),t}(),An=function(){function t(e){(0,a.Z)(this,t),(0,h.Z)(this,"enabled",void 0),(0,h.Z)(this,"active",void 0),(0,h.Z)(this,"touches",void 0),(0,h.Z)(this,"minTouches",void 0),(0,h.Z)(this,"clickTolerance",void 0),(0,h.Z)(this,"sum",void 0),this.minTouches=1,this.clickTolerance=e.clickTolerance||1,this.reset()}return(0,s.Z)(t,[{key:"reset",value:function(){this.active=!1,this.touches={},this.sum=new ee(0,0)}},{key:"touchstart",value:function(t,e,n){return this.calculateTransform(t,e,n)}},{key:"touchmove",value:function(t,e,n){if(this.active)return t.preventDefault(),this.calculateTransform(t,e,n)}},{key:"touchend",value:function(t,e,n){this.calculateTransform(t,e,n),this.active&&n.length<this.minTouches&&this.reset()}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}},{key:"calculateTransform",value:function(t,e,n){n.length>0&&(this.active=!0);var r=xn(n,e),i=new ee(0,0),o=new ee(0,0),a=0;for(var s in r)if(r[s]){var u=r[s],l=this.touches[s];l&&(i._add(u),o._add(u.sub(l)),a++,r[s]=u)}if(this.touches=r,!(a<this.minTouches)&&o.mag()){var c=o.div(a);if(this.sum._add(c),!(this.sum.mag()<this.clickTolerance))return{around:i.div(a),panDelta:c}}}}]),t}(),Mn=function(){function t(){(0,a.Z)(this,t),(0,h.Z)(this,"enabled",void 0),(0,h.Z)(this,"active",void 0),(0,h.Z)(this,"firstTwoTouches",void 0),(0,h.Z)(this,"vector",void 0),(0,h.Z)(this,"startVector",void 0),(0,h.Z)(this,"aroundCenter",void 0),this.reset()}return(0,s.Z)(t,[{key:"reset",value:function(){this.active=!1,delete this.firstTwoTouches}},{key:"start",value:function(t){}},{key:"move",value:function(t,e,n){}},{key:"touchstart",value:function(t,e,n){this.firstTwoTouches||n.length<2||(this.firstTwoTouches=[n[0].identifier,n[1].identifier],this.start([e[0],e[1]]))}},{key:"touchmove",value:function(t,e,n){if(this.firstTwoTouches){t.preventDefault();var r=(0,w.Z)(this.firstTwoTouches,2),i=r[0],o=r[1],a=kn(n,e,i),s=kn(n,e,o);if(a&&s){var u=this.aroundCenter?null:a.add(s).div(2);return this.move([a,s],u,t)}}}},{key:"touchend",value:function(t,e,n){if(this.firstTwoTouches){var r=(0,w.Z)(this.firstTwoTouches,2),i=r[0],o=r[1],a=kn(n,e,i),s=kn(n,e,o);a&&s||(this.active&&be.suppressClick(),this.reset())}}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(t){this.enabled=!0,this.aroundCenter=!!t&&"center"===t.around}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),t}();function kn(t,e,n){for(var r=0;r<t.length;r++)if(t[r].identifier===n)return e[r]}function Pn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}function On(t){return Math.abs(t.y)>Math.abs(t.x)}var Ln=function(t){(0,u.Z)(n,t);var e=Pn(n);function n(){var t;(0,a.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,h.Z)((0,Lt.Z)(t),"valid",void 0),(0,h.Z)((0,Lt.Z)(t),"firstMove",void 0),(0,h.Z)((0,Lt.Z)(t),"lastPoints",void 0),t}return(0,s.Z)(n,[{key:"reset",value:function(){(0,rn.Z)((0,c.Z)(n.prototype),"reset",this).call(this),this.valid=void 0,delete this.firstMove,delete this.lastPoints}},{key:"start",value:function(t){this.lastPoints=t,On(t[0].sub(t[1]))&&(this.valid=!1)}},{key:"move",value:function(t,e,n){var r=t[0].sub(this.lastPoints[0]),i=t[1].sub(this.lastPoints[1]);if(this.valid=this.gestureBeginsVertically(r,i,n.timeStamp),this.valid){this.lastPoints=t,this.active=!0;return{pitchDelta:-.5*((r.y+i.y)/2)}}}},{key:"gestureBeginsVertically",value:function(t,e,n){if(void 0!==this.valid)return this.valid;var r=t.mag()>=2,i=e.mag()>=2;if(r||i){if(!r||!i)return void 0===this.firstMove&&(this.firstMove=n),n-this.firstMove<100&&void 0;var o=t.y>0==e.y>0;return On(t)&&On(e)&&o}}}]),n}(Mn);function In(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}function Rn(t,e){return 180*t.angleWith(e)/Math.PI}var Dn=function(t){(0,u.Z)(n,t);var e=In(n);function n(){var t;(0,a.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,h.Z)((0,Lt.Z)(t),"minDiameter",void 0),t}return(0,s.Z)(n,[{key:"reset",value:function(){(0,rn.Z)((0,c.Z)(n.prototype),"reset",this).call(this),delete this.minDiameter,delete this.startVector,delete this.vector}},{key:"start",value:function(t){this.startVector=this.vector=t[0].sub(t[1]),this.minDiameter=t[0].dist(t[1])}},{key:"move",value:function(t,e){var n=this.vector;if(this.vector=t[0].sub(t[1]),this.active||!this.isBelowThreshold(this.vector))return this.active=!0,{bearingDelta:Rn(this.vector,n),pinchAround:e}}},{key:"isBelowThreshold",value:function(t){this.minDiameter=Math.min(this.minDiameter,t.mag());var e=25/(Math.PI*this.minDiameter)*360,n=Rn(t,this.startVector);return Math.abs(n)<e}}]),n}(Mn);function Nn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}function Zn(t,e){return Math.log(t/e)/Math.LN2}var zn=function(t){(0,u.Z)(n,t);var e=Nn(n);function n(){var t;(0,a.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,h.Z)((0,Lt.Z)(t),"distance",void 0),(0,h.Z)((0,Lt.Z)(t),"startDistance",void 0),t}return(0,s.Z)(n,[{key:"reset",value:function(){(0,rn.Z)((0,c.Z)(n.prototype),"reset",this).call(this),delete this.distance,delete this.startDistance}},{key:"start",value:function(t){this.startDistance=this.distance=t[0].dist(t[1])}},{key:"move",value:function(t,e){var n=this.distance;if(this.distance=t[0].dist(t[1]),this.active||!(Math.abs(Zn(this.distance,this.startDistance))<.1))return this.active=!0,{zoomDelta:Zn(this.distance,n),pinchAround:e}}}]),n}(Mn);function Fn(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return Bn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Bn(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Bn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var jn=function(t){return t.zoom||t.drag||t.pitch||t.rotate};function Un(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}var Vn=function(){function t(e,n){var r=this;(0,a.Z)(this,t),(0,h.Z)(this,"map",void 0),(0,h.Z)(this,"el",void 0),(0,h.Z)(this,"handlers",void 0),(0,h.Z)(this,"eventsInProgress",void 0),(0,h.Z)(this,"frameId",void 0),(0,h.Z)(this,"inertia",void 0),(0,h.Z)(this,"bearingSnap",void 0),(0,h.Z)(this,"handlersById",void 0),(0,h.Z)(this,"updatingCamera",void 0),(0,h.Z)(this,"changes",void 0),(0,h.Z)(this,"previousActiveHandlers",void 0),(0,h.Z)(this,"bearingChanged",void 0),(0,h.Z)(this,"rotateEnabled",void 0),(0,h.Z)(this,"pitchEnabled",void 0),(0,h.Z)(this,"listeners",void 0),(0,h.Z)(this,"handleWindowEvent",(function(t){r.handleEvent(t,"".concat(t.type,"Window"))})),(0,h.Z)(this,"handleEvent",(function(t,e){if("blur"!==t.type){r.updatingCamera=!0;var n,i="renderFrame"===t.type?void 0:t,o={needsRenderFrame:!1},a={},s={},u=t.touches?r.getMapTouches(t.touches):void 0,l=u?be.touchPos(r.el,u):be.mousePos(r.el,t),c=Fn(r.handlers);try{for(c.s();!(n=c.n()).done;){var p=n.value,h=p.handlerName,f=p.handler,d=p.allowed;if(f.isEnabled()){var v=void 0;if(r.blockedByActive(s,d,h))f.reset();else{var m=e||t.type;f&&f[m]&&(v=f[m](t,l,u),r.mergeIHandlerResult(o,a,v,h,i),v&&v.needsRenderFrame&&r.triggerRenderFrame())}(v||f.isActive())&&(s[h]=f)}}}catch(t){c.e(t)}finally{c.f()}var y={};for(var g in r.previousActiveHandlers)s[g]||(y[g]=i);r.previousActiveHandlers=s,(Object.keys(y).length||Un(o))&&(r.changes.push([o,a,y]),r.triggerRenderFrame()),(Object.keys(s).length||Un(o))&&r.map.stop(!0),r.updatingCamera=!1;var _=o.cameraAnimation;_&&(r.inertia.clear(),r.fireEvents({},{}),r.changes=[],_(r.map))}else r.stop()})),this.map=e,this.el=this.map.getCanvasContainer(),this.handlers=[],this.handlersById={},this.changes=[],this.inertia=new Ye(e),this.bearingSnap=n.bearingSnap,this.rotateEnabled=n.rotateEnabled,this.pitchEnabled=n.pitchEnabled,this.previousActiveHandlers={},this.eventsInProgress={},this.addDefaultHandlers(n);var i=this.el;if(this.listeners=[],A.isMini)A.$window.document.addEventListener("touchstart",(function(t){r.handleEvent(t)}),{}),A.$window.document.addEventListener("touchmove",(function(t){r.handleEvent(t)}),{}),A.$window.document.addEventListener("touchend",(function(t){r.handleEvent(t)}),{}),A.$window.document.addEventListener("touchcancel",(function(t){r.handleEvent(t)}),{});else{this.listeners=[[i,"touchstart",{passive:!1}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[window.document,"mousemove",{capture:!0}],[window.document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[window,"blur",void 0]];var o,s=Fn(this.listeners);try{for(s.s();!(o=s.n()).done;){var u=(0,w.Z)(o.value,3),l=u[0],c=u[1],p=u[2];be.addEventListener(l,c,l===window.document?this.handleWindowEvent:this.handleEvent,p)}}catch(t){s.e(t)}finally{s.f()}}}return(0,s.Z)(t,[{key:"destroy",value:function(){var t,e=Fn(this.listeners);try{for(e.s();!(t=e.n()).done;){var n=(0,w.Z)(t.value,3),r=n[0],i=n[1],o=n[2];be.removeEventListener(r,i,r===window.document?this.handleWindowEvent:this.handleEvent,o)}}catch(t){e.e(t)}finally{e.f()}}},{key:"stop",value:function(){if(!this.updatingCamera){var t,e=Fn(this.handlers);try{for(e.s();!(t=e.n()).done;){t.value.handler.reset()}}catch(t){e.e(t)}finally{e.f()}this.inertia.clear(),this.fireEvents({},{}),this.changes=[]}}},{key:"isActive",value:function(){var t,e=Fn(this.handlers);try{for(e.s();!(t=e.n()).done;){if(t.value.handler.isActive())return!0}}catch(t){e.e(t)}finally{e.f()}return!1}},{key:"isZooming",value:function(){return!!this.eventsInProgress.zoom||this.map.scrollZoom.isZooming()}},{key:"isRotating",value:function(){return!!this.eventsInProgress.rotate}},{key:"isMoving",value:function(){return Boolean(jn(this.eventsInProgress))||this.isZooming()}},{key:"mergeIHandlerResult",value:function(t,e,n,r,i){if(n){Rt()(t,n);var o={handlerName:r,originalEvent:n.originalEvent||i};void 0!==n.zoomDelta&&(e.zoom=o),void 0!==n.panDelta&&(e.drag=o),void 0!==n.pitchDelta&&(e.pitch=o),void 0!==n.bearingDelta&&(e.rotate=o)}}},{key:"triggerRenderFrame",value:function(){var t=this;void 0===this.frameId&&(this.frameId=this.map.requestRenderFrame((function(e){delete t.frameId,t.handleEvent(new je("renderFrame",{timeStamp:e})),t.applyChanges()})))}},{key:"addDefaultHandlers",value:function(t){var e=this.map,n=e.getCanvasContainer();this.add("mapEvent",new nn(e,t));var r=e.boxZoom=new ze(e,t);this.add("boxZoom",r);var i=new Tn,o=new Fe;e.doubleClickZoom=new mn(o,i),this.add("tapZoom",i),this.add("clickZoom",o);var a=new Cn;this.add("tapDragZoom",a);var s=e.touchPitch=new Ln;this.add("touchPitch",s);var u=new cn(t),l=new hn(t);e.dragRotate=new gn(t,u,l),this.add("mouseRotate",u,["mousePitch"]),this.add("mousePitch",l,["mouseRotate"]);var c=new un(t),p=new An(t);e.dragPan=new yn(n,c,p),this.add("mousePan",c),this.add("touchPan",p,["touchZoom","touchRotate"]);var h=new Dn,f=new zn;e.touchZoomRotate=new _n(n,f,h,a),this.add("touchRotate",h,["touchPan","touchZoom"]),this.add("touchZoom",f,["touchPan","touchRotate"]);var d=e.scrollZoom=new vn(e,this);this.add("scrollZoom",d,["mousePan"]);var v=e.keyboard=new en;this.add("keyboard",v),this.add("blockableMapEvent",new Ne(e));for(var m=0,y=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];m<y.length;m++){var g=y[m];t.interactive&&t[g]&&e[g].enable(t[g])}}},{key:"add",value:function(t,e,n){this.handlers.push({handlerName:t,handler:e,allowed:n}),this.handlersById[t]=e}},{key:"blockedByActive",value:function(t,e,n){for(var r in t)if(r!==n&&(!e||e.indexOf(r)<0))return!0;return!1}},{key:"getMapTouches",value:function(t){var e,n=[],r=Fn(t);try{for(r.s();!(e=r.n()).done;){var i=e.value,o=i.target;(A.isMini||this.el.contains(o))&&n.push(i)}}catch(t){r.e(t)}finally{r.f()}return n}},{key:"applyChanges",value:function(){var t,e={},n={},r={},i=Fn(this.changes);try{for(i.s();!(t=i.n()).done;){var o=(0,w.Z)(t.value,3),a=o[0],s=o[1],u=o[2];a.panDelta&&(e.panDelta=(e.panDelta||new ee(0,0))._add(a.panDelta)),a.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+a.zoomDelta),a.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+a.bearingDelta),a.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+a.pitchDelta),void 0!==a.around&&(e.around=a.around),void 0!==a.pinchAround&&(e.pinchAround=a.pinchAround),a.noInertia&&(e.noInertia=a.noInertia),Rt()(n,s),Rt()(r,u)}}catch(t){i.e(t)}finally{i.f()}this.updateMapTransform(e,n,r),this.changes=[]}},{key:"updateMapTransform",value:function(t,e,n){var r=this.map,i=r.transform;if(!Un(t))return this.fireEvents(e,n);var o=t.panDelta,a=t.zoomDelta,s=t.bearingDelta,u=t.pitchDelta,l=t.pinchAround,c=t.around;void 0!==l&&(c=l),r.stop(!0),c=c||r.transform.centerPoint;var p=i.pointLocation(o?c.sub(o):c);s&&this.rotateEnabled&&(i.bearing+=s),u&&this.pitchEnabled&&(i.pitch+=u),a&&(i.zoom+=a),i.setLocationAtPoint(p,c),this.map.update(),t.noInertia||this.inertia.record(t),this.fireEvents(e,n)}},{key:"fireEvents",value:function(t,e){var n=this,r=jn(this.eventsInProgress),i=jn(t),o={};for(var a in t)if(t[a]){var s=t[a].originalEvent;this.eventsInProgress[a]||(o["".concat(a,"start")]=s),this.eventsInProgress[a]=t[a]}for(var u in!r&&i&&this.fireEvent("movestart",i.originalEvent),o)o[u]&&this.fireEvent(u,o[u]);for(var l in t.rotate&&(this.bearingChanged=!0),i&&this.fireEvent("move",i.originalEvent),t)if(t[l]){var c=t[l].originalEvent;this.fireEvent(l,c)}var p,h={};for(var f in this.eventsInProgress)if(this.eventsInProgress[f]){var d=this.eventsInProgress[f],v=d.handlerName,m=d.originalEvent;this.handlersById[v].isActive()||(delete this.eventsInProgress[f],p=e[v]||m,h["".concat(f,"end")]=p)}for(var y in h)h[y]&&this.fireEvent(y,h[y]);var g=jn(this.eventsInProgress);if((r||i)&&!g){this.updatingCamera=!0;var _=this.inertia.onMoveEnd(this.map.dragPan.inertiaOptions),x=function(t){return 0!==t&&-n.bearingSnap<t&&t<n.bearingSnap};_?(x(_.bearing||this.map.getBearing())&&(_.bearing=0),this.map.easeTo(_,{originalEvent:p})):(this.map.emit("moveend",new ve("moveend",{originalEvent:p})),x(this.map.getBearing())&&this.map.resetNorth()),this.bearingChanged=!1,this.updatingCamera=!1}}},{key:"fireEvent",value:function(t,e){this.map.emit(t,new ve(t,e?{originalEvent:e}:{}))}}]),t}(),Gn=Vn,Hn=n(23493),Wn=n.n(Hn),qn=function(){function t(e){var n=this;(0,a.Z)(this,t),(0,h.Z)(this,"map",void 0),(0,h.Z)(this,"updateHash",void 0),(0,h.Z)(this,"hashName",void 0),(0,h.Z)(this,"onHashChange",(function(){var t=n.getCurrentHash();if(t.length>=3&&!t.some((function(t){return isNaN(+t)}))){var e=n.map.dragRotate.isEnabled()&&n.map.touchZoomRotate.isEnabled()?+(t[3]||0):n.map.getBearing();return n.map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:e,pitch:+(t[4]||0)}),!0}return!1})),(0,h.Z)(this,"getCurrentHash",(function(){var t,e=window.location.hash.replace("#","");return n.hashName?(e.split("&").map((function(t){return t.split("=")})).forEach((function(e){e[0]===n.hashName&&(t=e)})),(t&&t[1]||"").split("/")):e.split("/")})),(0,h.Z)(this,"updateHashUnthrottled",(function(){var t=n.getHashString();try{window.history.replaceState(window.history.state,"",t)}catch(t){}})),this.hashName=e&&encodeURIComponent(e),this.updateHash=Wn()(this.updateHashUnthrottled,300)}return(0,s.Z)(t,[{key:"addTo",value:function(t){return this.map=t,A.$window.addEventListener("hashchange",this.onHashChange,!1),this.map.on("moveend",this.updateHash),this}},{key:"remove",value:function(){return A.$window.removeEventListener("hashchange",this.onHashChange,!1),this.map.off("moveend",this.updateHash),delete this.map,this}},{key:"getHashString",value:function(t){var e=this.map.getCenter(),n=Math.round(100*this.map.getZoom())/100,r=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),i=Math.pow(10,r),o=Math.round(e.lng*i)/i,a=Math.round(e.lat*i)/i,s=this.map.getBearing(),u=this.map.getPitch(),l="";if(l+=t?"/".concat(o,"/").concat(a,"/").concat(n):"".concat(n,"/").concat(a,"/").concat(o),(s||u)&&(l+="/".concat(Math.round(10*s)/10)),u&&(l+="/".concat(Math.round(u))),this.hashName){var c=this.hashName,p=!1,h=window.location.hash.slice(1).split("&").map((function(t){var e=t.split("=")[0];return e===c?(p=!0,"".concat(e,"=").concat(l)):t})).filter((function(t){return t}));return p||h.push("".concat(c,"=").concat(l)),"#".concat(h.join("&"))}return"#".concat(l)}}]),t}(),Xn=qn,Yn=null,Kn=[],Qn=(A.$window.performance,function(t){var e=t;if(null!=Yn){var n=e-Yn;Kn.push(n)}Yn=e});function Jn(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return $n(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return $n(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function $n(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var tr=function(){function t(){(0,a.Z)(this,t),(0,h.Z)(this,"queue",void 0),(0,h.Z)(this,"id",void 0),(0,h.Z)(this,"cleared",void 0),(0,h.Z)(this,"currentlyRunning",void 0),this.queue=[],this.id=0,this.cleared=!1,this.currentlyRunning=!1}return(0,s.Z)(t,[{key:"add",value:function(t){var e=++this.id;return this.queue.push({callback:t,id:e,cancelled:!1}),e}},{key:"remove",value:function(t){var e,n=this.currentlyRunning,r=Jn(n?this.queue.concat(n):this.queue);try{for(r.s();!(e=r.n()).done;){var i=e.value;if(i.id===t)return void(i.cancelled=!0)}}catch(t){r.e(t)}finally{r.f()}}},{key:"run",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=this.currentlyRunning=this.queue;this.queue=[];var n,r=Jn(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!i.cancelled&&(i.callback(t),this.cleared))break}}catch(t){r.e(t)}finally{r.f()}this.cleared=!1,this.currentlyRunning=!1}},{key:"clear",value:function(){this.currentlyRunning&&(this.cleared=!0),this.queue=[]}}]),t}(),er=tr;function nr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}!function(t,e){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".l7-map {\n  font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;\n  overflow: hidden;\n  position: relative;\n  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n}\n\n.l7-canvas {\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n\n.l7-map:-webkit-full-screen {\n  width: 100%;\n  height: 100%;\n}\n\n.l7-canary {\n  background-color: salmon;\n}\n\n.l7-canvas-container.l7-interactive,\n.l7-ctrl-group button.l7-ctrl-compass {\n  cursor: -webkit-grab;\n  cursor: grab;\n  -moz-user-select: none;\n  -webkit-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n}\n\n.l7-canvas-container.l7-interactive.l7-track-pointer {\n  cursor: pointer;\n}\n\n.l7-canvas-container.l7-interactive:active,\n.l7-ctrl-group button.l7-ctrl-compass:active {\n  cursor: -webkit-grabbing;\n  cursor: grabbing;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate,\n.l7-canvas-container.l7-touch-zoom-rotate .l7-canvas {\n  -ms-touch-action: pan-x pan-y;\n      touch-action: pan-x pan-y;\n}\n\n.l7-canvas-container.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-drag-pan .l7-canvas {\n  -ms-touch-action: pinch-zoom;\n      touch-action: pinch-zoom;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan .l7-canvas {\n  -ms-touch-action: none;\n      touch-action: none;\n}\n\n.l7-ctrl-top-left,\n.l7-ctrl-top-right,\n.l7-ctrl-bottom-left,\n.l7-ctrl-bottom-right { position: absolute; pointer-events: none; z-index: 2; }\n.l7-ctrl-top-left     { top: 0; left: 0; }\n.l7-ctrl-top-right    { top: 0; right: 0; }\n.l7-ctrl-bottom-left  { bottom: 0; left: 0; }\n.l7-ctrl-bottom-right { right: 0; bottom: 0; }\n\n.l7-ctrl {\n  clear: both;\n  pointer-events: auto;\n\n  /* workaround for a Safari bug https://github.com/mapbox/mapbox-gl-js/issues/8185 */\n  -webkit-transform: translate(0, 0);\n          transform: translate(0, 0);\n}\n.l7-ctrl-top-left .l7-ctrl     { margin: 10px 0 0 10px; float: left; }\n.l7-ctrl-top-right .l7-ctrl    { margin: 10px 10px 0 0; float: right; }\n.l7-ctrl-bottom-left .l7-ctrl  { margin: 0 0 10px 10px; float: left; }\n.l7-ctrl-bottom-right .l7-ctrl { margin: 0 10px 10px 0; float: right; }\n\n\n.l7-crosshair,\n.l7-crosshair .l7-interactive,\n.l7-crosshair .l7-interactive:active {\n    cursor: crosshair;\n}\n\n.l7-boxzoom {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 0;\n    height: 0;\n    background: #fff;\n    border: 2px dotted #202020;\n    opacity: 0.5;\n    z-index: 10;\n}\n");var rr={hash:!1,zoom:-1,center:[112,32],pitch:0,bearing:0,interactive:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,trackResize:!0,renderWorldCopies:!0,pitchEnabled:!0,rotateEnabled:!0},ir=function(t){(0,u.Z)(n,t);var e=nr(n);function n(t){var r;if((0,a.Z)(this,n),r=e.call(this,Rt()({},rr,t)),(0,h.Z)((0,Lt.Z)(r),"doubleClickZoom",void 0),(0,h.Z)((0,Lt.Z)(r),"dragRotate",void 0),(0,h.Z)((0,Lt.Z)(r),"dragPan",void 0),(0,h.Z)((0,Lt.Z)(r),"touchZoomRotate",void 0),(0,h.Z)((0,Lt.Z)(r),"scrollZoom",void 0),(0,h.Z)((0,Lt.Z)(r),"keyboard",void 0),(0,h.Z)((0,Lt.Z)(r),"touchPitch",void 0),(0,h.Z)((0,Lt.Z)(r),"boxZoom",void 0),(0,h.Z)((0,Lt.Z)(r),"handlers",void 0),(0,h.Z)((0,Lt.Z)(r),"container",void 0),(0,h.Z)((0,Lt.Z)(r),"canvas",void 0),(0,h.Z)((0,Lt.Z)(r),"canvasContainer",void 0),(0,h.Z)((0,Lt.Z)(r),"renderTaskQueue",new er),(0,h.Z)((0,Lt.Z)(r),"frame",void 0),(0,h.Z)((0,Lt.Z)(r),"trackResize",!0),(0,h.Z)((0,Lt.Z)(r),"hash",void 0),(0,h.Z)((0,Lt.Z)(r),"onWindowOnline",(function(){r.update()})),(0,h.Z)((0,Lt.Z)(r),"onWindowResize",(function(t){r.trackResize&&r.resize({originalEvent:t}).update()})),A.isMini?r.initMiniContainer():r.initContainer(),r.resize(),r.handlers=new Gn((0,Lt.Z)(r),r.options),"undefined"!=typeof window&&(window.addEventListener("online",r.onWindowOnline,!1),window.addEventListener("resize",r.onWindowResize,!1),window.addEventListener("orientationchange",r.onWindowResize,!1)),!A.isMini){var i="string"==typeof t.hash&&t.hash||void 0;t.hash&&(r.hash=new Xn(i).addTo((0,Lt.Z)(r)))}return r.hash&&r.hash.onHashChange()||(r.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}),t.bounds&&(r.resize(),r.fitBounds(t.bounds,Rt()({},t.fitBoundsOptions,{duration:0})))),r}return(0,s.Z)(n,[{key:"resize",value:function(t){var e=this.containerDimensions(),n=e[0],r=e[1];if(this.transform.resize(n,r),A.isMini)return this;var i=!this.moving;return i&&(this.stop(),this.emit("movestart",new A.$window.Event("movestart",t)),this.emit("move",new A.$window.Event("move",t))),this.emit("resize",new A.$window.Event("resize",t)),i&&this.emit("moveend",new A.$window.Event("moveend",t)),this}},{key:"getContainer",value:function(){return this.container}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getCanvasContainer",value:function(){return this.canvasContainer}},{key:"project",value:function(t){return this.transform.locationPoint($t.convert(t))}},{key:"unproject",value:function(t){return this.transform.pointLocation(ee.convert(t))}},{key:"getBounds",value:function(){return this.transform.getBounds()}},{key:"getMaxBounds",value:function(){return this.transform.getMaxBounds()}},{key:"setMaxBounds",value:function(t){this.transform.setMaxBounds(te.convert(t))}},{key:"setStyle",value:function(t){}},{key:"setMinZoom",value:function(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between ".concat(-2," and the current maxZoom, inclusive"))}},{key:"getMinZoom",value:function(){return this.transform.minZoom}},{key:"setMaxZoom",value:function(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")}},{key:"getMaxZoom",value:function(){return this.transform.maxZoom}},{key:"setMinPitch",value:function(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to ".concat(0));if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this.getPitch()<t&&this.setPitch(t),this;throw new Error("minPitch must be between ".concat(0," and the current maxPitch, inclusive"))}},{key:"getMinPitch",value:function(){return this.transform.minPitch}},{key:"setMaxPitch",value:function(t){if((t=null==t?60:t)>60)throw new Error("maxPitch must be less than or equal to ".concat(60));if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")}},{key:"getMaxPitch",value:function(){return this.transform.maxPitch}},{key:"getRenderWorldCopies",value:function(){return this.transform.renderWorldCopies}},{key:"setRenderWorldCopies",value:function(t){this.transform.renderWorldCopies=!!t}},{key:"remove",value:function(){this.container.removeChild(this.canvasContainer),this.canvasContainer=null,this.frame&&(this.frame.cancel(),this.frame=null),this.renderTaskQueue.clear()}},{key:"requestRenderFrame",value:function(t){return this.update(),this.renderTaskQueue.add(t)}},{key:"cancelRenderFrame",value:function(t){return this.renderTaskQueue.remove(t)}},{key:"triggerRepaint",value:function(){var t=this;this.frame||(this.frame=Qt((function(e){Qn(e),t.frame=null,t.update(e)})))}},{key:"update",value:function(t){var e=this;this.frame||(this.frame=Qt((function(n){Qn(n),e.frame=null,e.renderTaskQueue.run(t)})))}},{key:"initContainer",value:function(){if("string"==typeof this.options.container){if(this.container=window.document.getElementById(this.options.container),!this.container)throw new Error("Container '".concat(this.options.container,"' not found."))}else{if(!(this.options.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this.container=this.options.container}var t=this.container;t.classList.add("l7-map");var e=this.canvasContainer=A.DOM.create("div","l7-canvas-container",t);this.options.interactive&&e.classList.add("l7-interactive")}},{key:"initMiniContainer",value:function(){this.container=this.options.canvas,this.canvasContainer=this.container}},{key:"containerDimensions",value:function(){var t=0,e=0;return this.container&&(A.isMini?(t=this.container.width/A.$window.devicePixelRatio,e=this.container.height/A.$window.devicePixelRatio):(t=this.container.clientWidth,e=this.container.clientHeight)),[t,e]}}]),n}(ye);function or(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}!function(t,e){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".l7-map {\n  font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;\n  overflow: hidden;\n  position: relative;\n  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n}\n\n.l7-canvas {\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n\n.l7-map:-webkit-full-screen {\n  width: 100%;\n  height: 100%;\n}\n\n.l7-canary {\n  background-color: salmon;\n}\n\n.l7-canvas-container.l7-interactive,\n.l7-ctrl-group button.l7-ctrl-compass {\n  cursor: -webkit-grab;\n  cursor: grab;\n  -moz-user-select: none;\n  -webkit-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n}\n\n.l7-canvas-container.l7-interactive.l7-track-pointer {\n  cursor: pointer;\n}\n\n.l7-canvas-container.l7-interactive:active,\n.l7-ctrl-group button.l7-ctrl-compass:active {\n  cursor: -webkit-grabbing;\n  cursor: grabbing;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate,\n.l7-canvas-container.l7-touch-zoom-rotate .l7-canvas {\n  -ms-touch-action: pan-x pan-y;\n      touch-action: pan-x pan-y;\n}\n\n.l7-canvas-container.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-drag-pan .l7-canvas {\n  -ms-touch-action: pinch-zoom;\n      touch-action: pinch-zoom;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan .l7-canvas {\n  -ms-touch-action: none;\n      touch-action: none;\n}\n\n.l7-ctrl-top-left,\n.l7-ctrl-top-right,\n.l7-ctrl-bottom-left,\n.l7-ctrl-bottom-right { position: absolute; pointer-events: none; z-index: 2; }\n.l7-ctrl-top-left     { top: 0; left: 0; }\n.l7-ctrl-top-right    { top: 0; right: 0; }\n.l7-ctrl-bottom-left  { bottom: 0; left: 0; }\n.l7-ctrl-bottom-right { right: 0; bottom: 0; }\n\n.l7-ctrl {\n  clear: both;\n  pointer-events: auto;\n\n  /* workaround for a Safari bug https://github.com/mapbox/mapbox-gl-js/issues/8185 */\n  -webkit-transform: translate(0, 0);\n          transform: translate(0, 0);\n}\n.l7-ctrl-top-left .l7-ctrl     { margin: 10px 0 0 10px; float: left; }\n.l7-ctrl-top-right .l7-ctrl    { margin: 10px 10px 0 0; float: right; }\n.l7-ctrl-bottom-left .l7-ctrl  { margin: 0 0 10px 10px; float: left; }\n.l7-ctrl-bottom-right .l7-ctrl { margin: 0 10px 10px 0; float: right; }\n\n\n.l7-crosshair,\n.l7-crosshair .l7-interactive,\n.l7-crosshair .l7-interactive:active {\n    cursor: crosshair;\n}\n\n.l7-boxzoom {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 0;\n    height: 0;\n    background: #fff;\n    border: 2px dotted #202020;\n    opacity: 0.5;\n    z-index: 10;\n}\n");var ar,sr,ur,lr,cr,pr,hr,fr,dr,vr,mr,yr={hash:!1,zoom:-1,center:[112,32],pitch:0,bearing:0,interactive:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,trackResize:!0,renderWorldCopies:!0,pitchEnabled:!0,rotateEnabled:!0},gr=function(t){(0,u.Z)(n,t);var e=or(n);function n(t){var r;return(0,a.Z)(this,n),r=e.call(this,Rt()({},yr,t)),(0,h.Z)((0,Lt.Z)(r),"doubleClickZoom",void 0),(0,h.Z)((0,Lt.Z)(r),"dragRotate",void 0),(0,h.Z)((0,Lt.Z)(r),"dragPan",void 0),(0,h.Z)((0,Lt.Z)(r),"touchZoomRotate",void 0),(0,h.Z)((0,Lt.Z)(r),"scrollZoom",void 0),(0,h.Z)((0,Lt.Z)(r),"keyboard",void 0),(0,h.Z)((0,Lt.Z)(r),"touchPitch",void 0),(0,h.Z)((0,Lt.Z)(r),"boxZoom",void 0),(0,h.Z)((0,Lt.Z)(r),"handlers",void 0),(0,h.Z)((0,Lt.Z)(r),"container",void 0),(0,h.Z)((0,Lt.Z)(r),"canvas",void 0),(0,h.Z)((0,Lt.Z)(r),"canvasContainer",void 0),(0,h.Z)((0,Lt.Z)(r),"renderTaskQueue",new er),(0,h.Z)((0,Lt.Z)(r),"frame",void 0),(0,h.Z)((0,Lt.Z)(r),"trackResize",!0),(0,h.Z)((0,Lt.Z)(r),"onWindowOnline",(function(){r.update()})),(0,h.Z)((0,Lt.Z)(r),"onWindowResize",(function(t){r.trackResize&&r.resize({originalEvent:t}).update()})),r.initContainer(),r.resize(),r.handlers=new Gn((0,Lt.Z)(r),r.options),"undefined"!=typeof window&&(window.addEventListener("online",r.onWindowOnline,!1),window.addEventListener("resize",r.onWindowResize,!1),window.addEventListener("orientationchange",r.onWindowResize,!1)),r}return(0,s.Z)(n,[{key:"resize",value:function(t){var e=this.containerDimensions(),n=e[0],r=e[1];this.transform.resize(n,r);var i=!this.moving;return i&&(this.stop(),this.emit("movestart",new Event("movestart",t)),this.emit("move",new Event("move",t))),this.emit("resize",new Event("resize",t)),i&&this.emit("moveend",new Event("moveend",t)),this}},{key:"getContainer",value:function(){return this.container}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getCanvasContainer",value:function(){return this.canvasContainer}},{key:"project",value:function(t){return this.transform.locationPoint($t.convert(t))}},{key:"unproject",value:function(t){return this.transform.pointLocation(ee.convert(t))}},{key:"getBounds",value:function(){return this.transform.getBounds()}},{key:"getMaxBounds",value:function(){return this.transform.getMaxBounds()}},{key:"setMaxBounds",value:function(t){this.transform.setMaxBounds(te.convert(t))}},{key:"setStyle",value:function(t){}},{key:"setMinZoom",value:function(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between ".concat(-2," and the current maxZoom, inclusive"))}},{key:"getMinZoom",value:function(){return this.transform.minZoom}},{key:"setMaxZoom",value:function(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")}},{key:"getMaxZoom",value:function(){return this.transform.maxZoom}},{key:"setMinPitch",value:function(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to ".concat(0));if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this.getPitch()<t&&this.setPitch(t),this;throw new Error("minPitch must be between ".concat(0," and the current maxPitch, inclusive"))}},{key:"getMinPitch",value:function(){return this.transform.minPitch}},{key:"setMaxPitch",value:function(t){if((t=null==t?60:t)>60)throw new Error("maxPitch must be less than or equal to ".concat(60));if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")}},{key:"getMaxPitch",value:function(){return this.transform.maxPitch}},{key:"getRenderWorldCopies",value:function(){return this.transform.renderWorldCopies}},{key:"setRenderWorldCopies",value:function(t){this.transform.renderWorldCopies=!!t}},{key:"remove",value:function(){this.frame&&(this.frame.cancel(),this.frame=null),this.renderTaskQueue.clear()}},{key:"requestRenderFrame",value:function(t){return this.update(),this.renderTaskQueue.add(t)}},{key:"cancelRenderFrame",value:function(t){return this.renderTaskQueue.remove(t)}},{key:"triggerRepaint",value:function(){var t=this;this.frame||(this.frame=Qt((function(e){Qn(e),t.frame=null,t.update(e)})))}},{key:"update",value:function(t){var e=this;this.frame||(this.frame=Qt((function(n){Qn(n),e.frame=null,e.renderTaskQueue.run(t)})))}},{key:"initContainer",value:function(){if("string"==typeof this.options.container){if(this.container=window.document.getElementById(this.options.container),!this.container)throw new Error("Container '".concat(this.options.container,"' not found."))}else{if(!(this.options.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this.container=this.options.container}var t=this.container;t.classList.add("l7-map");var e=this.canvasContainer=A.DOM.create("div","l7-canvas-container",t);this.options.interactive&&e.classList.add("l7-interactive")}},{key:"containerDimensions",value:function(){var t=0,e=0;return this.container&&(t=this.container.clientWidth||400,e=this.container.clientHeight||300),[t,e]}},{key:"resizeCanvas",value:function(t,e){var n=A.DOM.DPR||1;this.canvas.width=n*t,this.canvas.height=n*e,this.canvas.style.width="".concat(t,"px"),this.canvas.style.height="".concat(e,"px")}}]),n}(ye),_r=function(){function t(){(0,a.Z)(this,t),(0,h.Z)(this,"xzReg",.6*-Math.PI),(0,h.Z)(this,"yReg",.2*Math.PI),(0,h.Z)(this,"earthCameraRadius",200),(0,h.Z)(this,"earthCameraZoom",1),(0,h.Z)(this,"cameraPosition",k.create()),(0,h.Z)(this,"viewport",void 0),(0,h.Z)(this,"projectionMatrix",M.create()),(0,h.Z)(this,"modelMatrix",M.create()),(0,h.Z)(this,"viewMatrix",M.create()),(0,h.Z)(this,"viewProjectionMatrix",M.create()),(0,h.Z)(this,"ViewProjectionMatrixUncentered",M.create()),(0,h.Z)(this,"viewUncenteredMatrix",M.create())}return(0,s.Z)(t,[{key:"syncWithMapCamera",value:function(t){var e=t.viewportHeight,n=void 0===e?1:e,r=t.viewportWidth,i=(void 0===r?1:r)/n;M.perspective(this.projectionMatrix,20,i,.1,1e4);var o=this.earthCameraRadius*Math.cos(this.xzReg),a=this.earthCameraRadius*Math.sin(this.xzReg),s=this.earthCameraRadius*Math.sin(this.yReg);this.cameraPosition=k.fromValues(o,s,a),k.normalize(this.cameraPosition,this.cameraPosition),k.multiply(this.cameraPosition,this.cameraPosition,k.fromValues(this.earthCameraRadius,this.earthCameraRadius,this.earthCameraRadius)),k.scale(this.cameraPosition,this.cameraPosition,this.earthCameraZoom);var u=k.create();k.cross(u,this.cameraPosition,k.fromValues(0,1,0));var l=k.fromValues(0,1,0);k.cross(l,u,this.cameraPosition);var c=k.fromValues(0,0,0);M.lookAt(this.viewMatrix,this.cameraPosition,c,l),this.viewUncenteredMatrix=M.clone(this.viewMatrix),M.multiply(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),M.multiply(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"rotateY",value:function(t){this.xzReg+=t*Math.min(this.earthCameraZoom*this.earthCameraZoom,1)}},{key:"rotateX",value:function(t){this.yReg+=t*Math.min(this.earthCameraZoom*this.earthCameraZoom,1)}},{key:"scaleZoom",value:function(t){this.earthCameraZoom+=t,this.earthCameraZoom=Math.max(this.earthCameraZoom,.6)}},{key:"getZoom",value:function(){return 4}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[0,0]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return this.modelMatrix}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,e){return this.viewport.projectFlat(t,e)}}]),t}(),xr={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},br=["id","attributionControl","style","rotation","mapInstance"];function wr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Sr(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?wr(Object(n),!0).forEach((function(e){(0,h.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):wr(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Er={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},Cr=(ar=(0,P.b2)(),sr=(0,P.f3)(d.TYPES.MapConfig),ur=(0,P.f3)(d.TYPES.IGlobalConfigService),lr=(0,P.f3)(d.TYPES.ICoordinateSystemService),cr=(0,P.f3)(d.TYPES.IEventEmitter),ar((hr=function(){function t(){var e=this;(0,a.Z)(this,t),(0,h.Z)(this,"version",W.G.GLOBEL),(0,h.Z)(this,"map",void 0),(0,h.Z)(this,"simpleMapCoord",new O),(0,h.Z)(this,"dragging",!1),(0,h.Z)(this,"bgColor","#000"),(0,p.Z)(this,"config",fr,this),(0,p.Z)(this,"configService",dr,this),(0,p.Z)(this,"coordinateSystemService",vr,this),(0,p.Z)(this,"eventEmitter",mr,this),(0,h.Z)(this,"viewport",void 0),(0,h.Z)(this,"markerContainer",void 0),(0,h.Z)(this,"cameraChangedCallback",void 0),(0,h.Z)(this,"$mapContainer",void 0),(0,h.Z)(this,"handleCameraChanging",void 0),(0,h.Z)(this,"handleCameraTimer",void 0),(0,h.Z)(this,"handleCameraChanged",(function(t){e.emit("mapchange");e.handleCameraChanging=!0,e.handleCameraTimer&&clearTimeout(e.handleCameraTimer),e.handleCameraTimer=setTimeout((function(){e.handleCameraChanging=!1}),2e3);var n=.02;t.type&&t.originalEvent&&("wheel"===t.originalEvent.type&&e.viewport.scaleZoom(.01*Math.sign(t.originalEvent.wheelDelta)*-1),Math.abs(t.originalEvent.movementX)>Math.abs(t.originalEvent.movementY)?t.originalEvent.movementX>0?e.viewport.rotateY(n):t.originalEvent.movementX<0&&e.viewport.rotateY(-.02):t.originalEvent.movementY>0?e.viewport.rotateX(n):t.originalEvent.movementY<0&&e.viewport.rotateX(-.02));var r=e.config.offsetCoordinate,i=void 0===r||r;e.viewport.syncWithMapCamera({viewportHeight:e.map.transform.height,viewportWidth:e.map.transform.width}),e.viewport.getZoom()>12&&i?e.coordinateSystemService.setCoordinateSystem(d.CoordinateSystem.LNGLAT_OFFSET):e.coordinateSystemService.setCoordinateSystem(d.CoordinateSystem.LNGLAT),e.cameraChangedCallback(e.viewport)}))}var e;return(0,s.Z)(t,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getCanvasContainer();this.markerContainer=A.DOM.create("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(t,e){-1!==d.MapServiceEvent.indexOf(t)?this.eventEmitter.on(t,e):this.map.on(Er[t]||t,e)}},{key:"off",value:function(t,e){this.map.off(Er[t]||t,e),this.eventEmitter.off(t,e)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var t=this.map.transform;return[t.width,t.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(t){return this.map.setZoom(t)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(t){this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(t){this.map.setBearing(t)}},{key:"zoomIn",value:function(t,e){this.map.zoomIn(t,e)}},{key:"zoomOut",value:function(t,e){this.map.zoomOut(t,e)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.panTo([t,e])}},{key:"fitBounds",value:function(t,e){this.map.fitBounds(t,e)}},{key:"setMaxZoom",value:function(t){this.map.setMaxZoom(t)}},{key:"setMinZoom",value:function(t){this.map.setMinZoom(t)}},{key:"setMapStatus",value:function(t){!0===t.doubleClickZoom&&this.map.doubleClickZoom.enable(),!1===t.doubleClickZoom&&this.map.doubleClickZoom.disable(),!1===t.dragEnable&&this.map.dragPan.disable(),!0===t.dragEnable&&this.map.dragPan.enable(),!1===t.rotateEnable&&this.map.dragRotate.disable(),!0===t.dragEnable&&this.map.dragRotate.enable(),!1===t.keyboardEnable&&this.map.keyboard.disable(),!0===t.keyboardEnable&&this.map.keyboard.enable(),!1===t.zoomEnable&&this.map.scrollZoom.disable(),!0===t.zoomEnable&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(t,e){this.map.flyTo({zoom:t,center:e})}},{key:"setMapStyle",value:function(t){this.map.setStyle(this.getMapStyle(t))}},{key:"pixelToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToPixel",value:function(t){return this.map.project(t)}},{key:"containerToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToContainer",value:function(t){return this.map.project(t)}},{key:"lngLatToMercator",value:function(t,e){throw new Error("not implement")}},{key:"getModelMatrix",value:function(t,e,n){throw new Error("not implement")}},{key:"init",value:(e=(0,b.Z)(E().mark((function t(){var e,n,r,i,o,a,s,u;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=this.config,n=e.id,r=void 0===n?"map":n,e.attributionControl,i=e.style,o=void 0===i?"light":i,a=e.rotation,s=void 0===a?0:a,e.mapInstance,u=(0,x.Z)(e,br),this.viewport=new _r,this.$mapContainer=this.creatAmapContainer(r),this.map=new gr(Sr({container:this.$mapContainer,style:this.getMapStyle(o),bearing:s},u)),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged({});case 7:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"destroy",value:function(){var t,e;null===(t=this.$mapContainer)||void 0===t||null===(e=t.parentNode)||void 0===e||e.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).emit.apply(e,[t].concat(r))}},{key:"once",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).once.apply(e,[t].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(t){var e=this.map.getCanvas();return"jpg"===t?null==e?void 0:e.toDataURL("image/jpeg"):null==e?void 0:e.toDataURL("image/png")}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"rotateY",value:function(t){var e=t||{},n=e.force,r=void 0!==n&&n,i=e.reg,o=void 0===i?.01:i;this.handleCameraChanging&&!r||this.viewport&&(this.viewport.rotateY(o),this.viewport.syncWithMapCamera({viewportHeight:this.map.transform.height,viewportWidth:this.map.transform.width}),this.cameraChangedCallback(this.viewport))}},{key:"creatAmapContainer",value:function(t){var e=t;return"string"==typeof t&&(e=document.getElementById(t)),e}},{key:"getMapStyle",value:function(t){return"string"!=typeof t?t:xr[t]?xr[t]:t}}]),t}(),fr=(0,f.Z)(hr.prototype,"config",[sr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dr=(0,f.Z)(hr.prototype,"configService",[ur],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vr=(0,f.Z)(hr.prototype,"coordinateSystemService",[lr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mr=(0,f.Z)(hr.prototype,"eventEmitter",[cr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pr=hr))||pr);function Tr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var Ar=function(t){(0,u.Z)(n,t);var e=Tr(n);function n(){return(0,a.Z)(this,n),e.apply(this,arguments)}return(0,s.Z)(n,[{key:"getServiceConstructor",value:function(){return Cr}}]),n}(y);function Mr(t,e){var n=re.fF([],e,t);return re.bA(n,n,1/n[3]),n}var kr=n(31437);function Pr(t,e){if(!t)throw new Error(e||"viewport-mercator-project: assertion failed.")}var Or=Math.PI,Lr=Or/4,Ir=Or/180,Rr=180/Or,Dr=4003e4;function Nr(t){return Math.pow(2,t)}function Zr(t,e){var n=(0,w.Z)(t,2),r=n[0],i=n[1];Pr(Number.isFinite(r)&&Number.isFinite(e)),Pr(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");var o=i*Ir;return[(e*=512)*(r*Ir+Or)/(2*Or),e*(Or-Math.log(Math.tan(Lr+.5*o)))/(2*Or)]}function zr(t,e){var n=(0,w.Z)(t,2),r=n[0],i=n[1],o=r/(e*=512)*(2*Or)-Or,a=2*(Math.atan(Math.exp(Or-i/e*(2*Or)))-Lr);return[o*Rr,a*Rr]}function Fr(t){var e=t.latitude,n=t.longitude,r=t.zoom,i=t.scale,o=t.highPrecision,a=void 0!==o&&o;i=void 0!==i?i:Nr(r),Pr(Number.isFinite(e)&&Number.isFinite(n)&&Number.isFinite(i));var s={},u=512*i,l=Math.cos(e*Ir),c=u/360,p=c/l,h=u/Dr/l;if(s.pixelsPerMeter=[h,-h,h],s.metersPerPixel=[1/h,-1/h,1/h],s.pixelsPerDegree=[c,-p,h],s.degreesPerPixel=[1/c,-1/p,1/h],a){var f=Ir*Math.tan(e*Ir)/l,d=c*f/2,v=u/Dr*f,m=v/p*h;s.pixelsPerDegree2=[0,-d,v],s.pixelsPerMeter2=[m,0,m]}return s}function Br(t){var e=t.height,n=t.pitch,r=t.bearing,i=t.altitude,o=t.center,a=void 0===o?null:o,s=t.flipY,u=void 0!==s&&s,l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return M.translate(l,l,[0,0,-i]),M.scale(l,l,[1,1,1/e]),M.rotateX(l,l,-n*Ir),M.rotateZ(l,l,r*Ir),u&&M.scale(l,l,[1,-1,1]),a&&M.translate(l,l,k.negate([],a)),l}function jr(t){var e=t.width,n=t.height,r=t.pitch,i=function(t){var e=t.width,n=t.height,r=t.altitude,i=void 0===r?1.5:r,o=t.pitch,a=void 0===o?0:o,s=t.nearZMultiplier,u=void 0===s?1:s,l=t.farZMultiplier,c=void 0===l?1:l,p=a*Ir,h=Math.atan(.5/i),f=Math.sin(h)*i/Math.sin(Math.PI/2-p-h),d=Math.cos(Math.PI/2-p)*f+i;return{fov:2*Math.atan(n/2/i),aspect:e/n,focalDistance:i,near:u,far:d*c}}({width:e,height:n,altitude:t.altitude,pitch:r,nearZMultiplier:t.nearZMultiplier,farZMultiplier:t.farZMultiplier}),o=i.fov,a=i.aspect,s=i.near,u=i.far;return M.perspective([],o,a,s,u)}function Ur(t,e){var n=(0,w.Z)(t,3),r=n[0],i=n[1],o=n[2],a=void 0===o?0:o;return Pr(Number.isFinite(r)&&Number.isFinite(i)&&Number.isFinite(a)),Mr(e,[r,i,a,1])}function Vr(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=(0,w.Z)(t,3),i=r[0],o=r[1],a=r[2];if(Pr(Number.isFinite(i)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(a)){var s=Mr(e,[i,o,a,1]);return s}var u=Mr(e,[i,o,0,1]),l=Mr(e,[i,o,1,1]),c=u[2],p=l[2],h=c===p?0:((n||0)-c)/(p-c);return kr.t7([],u,l,h)}var Gr=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Hr=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.width,r=e.height,i=e.viewMatrix,o=void 0===i?Gr:i,s=e.projectionMatrix,u=void 0===s?Gr:s;(0,a.Z)(this,t),this.width=n||1,this.height=r||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=o,this.projectionMatrix=u;var l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];M.multiply(l,l,this.projectionMatrix),M.multiply(l,l,this.viewMatrix),this.viewProjectionMatrix=l;var c=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];M.scale(c,c,[this.width/2,-this.height/2,1]),M.translate(c,c,[1,-1,0]),M.multiply(c,c,this.viewProjectionMatrix);var p=M.invert([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],c);if(!p)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=c,this.pixelUnprojectionMatrix=p,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,s.Z)(t,[{key:"equals",value:function(e){return e instanceof t&&(e.width===this.width&&e.height===this.height&&M.equals(e.projectionMatrix,this.projectionMatrix)&&M.equals(e.viewMatrix,this.viewMatrix))}},{key:"project",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.topLeft,r=void 0===n||n,i=this.projectPosition(t),o=Ur(i,this.pixelProjectionMatrix),a=(0,w.Z)(o,2),s=a[0],u=a[1],l=r?u:this.height-u;return 2===t.length?[s,l]:[s,l,o[2]]}},{key:"unproject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.topLeft,r=void 0===n||n,i=e.targetZ,o=(0,w.Z)(t,3),a=o[0],s=o[1],u=o[2],l=r?s:this.height-s,c=i&&i*this.pixelsPerMeter,p=Vr([a,l,u],this.pixelUnprojectionMatrix,c),h=this.unprojectPosition(p),f=(0,w.Z)(h,3),d=f[0],v=f[1],m=f[2];return Number.isFinite(u)?[d,v,m]:Number.isFinite(i)?[d,v,i]:[d,v]}},{key:"projectPosition",value:function(t){var e=this.projectFlat(t),n=(0,w.Z)(e,2);return[n[0],n[1],(t[2]||0)*this.pixelsPerMeter]}},{key:"unprojectPosition",value:function(t){var e=this.unprojectFlat(t),n=(0,w.Z)(e,2);return[n[0],n[1],(t[2]||0)/this.pixelsPerMeter]}},{key:"projectFlat",value:function(t){arguments.length>1&&void 0!==arguments[1]||this.scale;return t}},{key:"unprojectFlat",value:function(t){arguments.length>1&&void 0!==arguments[1]||this.scale;return t}}]),t}();function Wr(t){var e=t.width,n=t.height,r=t.bounds,i=t.minExtent,o=void 0===i?0:i,a=t.maxZoom,s=void 0===a?24:a,u=t.padding,l=void 0===u?0:u,c=t.offset,p=void 0===c?[0,0]:c,h=(0,w.Z)(r,2),f=(0,w.Z)(h[0],2),d=f[0],v=f[1],m=(0,w.Z)(h[1],2),y=m[0],g=m[1];if(Number.isFinite(l)){l={top:l,bottom:l,left:l,right:l}}else Pr(Number.isFinite(l.top)&&Number.isFinite(l.bottom)&&Number.isFinite(l.left)&&Number.isFinite(l.right));var _=new ii({width:e,height:n,longitude:0,latitude:0,zoom:0}),x=_.project([d,g]),b=_.project([y,v]),S=[Math.max(Math.abs(b[0]-x[0]),o),Math.max(Math.abs(b[1]-x[1]),o)],E=[e-l.left-l.right-2*Math.abs(p[0]),n-l.top-l.bottom-2*Math.abs(p[1])];Pr(E[0]>0&&E[1]>0);var C=E[0]/S[0],T=E[1]/S[1],A=(l.right-l.left)/2/C,M=(l.bottom-l.top)/2/T,k=[(b[0]+x[0])/2+A,(b[1]+x[1])/2+M],P=_.unproject(k),O=_.zoom+Math.log2(Math.abs(Math.min(C,T)));return{longitude:P[0],latitude:P[1],zoom:Math.min(O,s)}}var qr,Xr,Yr,Kr,Qr,Jr,$r,ti,ei,ni,ri,ii=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.width,i=n.height,o=n.latitude,s=void 0===o?0:o,u=n.longitude,p=void 0===u?0:u,h=n.zoom,f=void 0===h?0:h,d=n.pitch,v=void 0===d?0:d,m=n.bearing,y=void 0===m?0:m,g=n.altitude,_=void 0===g?1.5:g,x=n.nearZMultiplier,b=n.farZMultiplier;(0,a.Z)(this,e),r=r||1,i=i||1;var w=Nr(f);_=Math.max(.75,_);var S=Zr([p,s],w);S[2]=0;var E=jr({width:r,height:i,pitch:v,bearing:y,altitude:_,nearZMultiplier:x||1/i,farZMultiplier:b||1.01}),C=Br({height:i,center:S,pitch:v,bearing:y,altitude:_,flipY:!0});return(t=(0,l.Z)(this,(0,c.Z)(e).call(this,{width:r,height:i,viewMatrix:C,projectionMatrix:E}))).latitude=s,t.longitude=p,t.zoom=f,t.pitch=v,t.bearing=y,t.altitude=_,t.scale=w,t.center=S,t.pixelsPerMeter=Fr((0,Lt.Z)((0,Lt.Z)(t))).pixelsPerMeter[2],Object.freeze((0,Lt.Z)((0,Lt.Z)(t))),t}return(0,u.Z)(e,t),(0,s.Z)(e,[{key:"projectFlat",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return Zr(t,e)}},{key:"unprojectFlat",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return zr(t,e)}},{key:"getMapCenterByLngLatPosition",value:function(t){var e=t.lngLat,n=Vr(t.pos,this.pixelUnprojectionMatrix),r=Zr(e,this.scale),i=kr.IH([],r,kr.tk([],n));return zr(kr.IH([],this.center,i),this.scale)}},{key:"getLocationAtPoint",value:function(t){var e=t.lngLat,n=t.pos;return this.getMapCenterByLngLatPosition({lngLat:e,pos:n})}},{key:"fitBounds",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.width,i=this.height,o=Wr(Object.assign({width:r,height:i,bounds:t},n)),a=o.longitude,s=o.latitude,u=o.zoom;return new e({width:r,height:i,longitude:a,latitude:s,zoom:u})}}]),e}(Hr),oi=function(){function t(){(0,a.Z)(this,t),(0,h.Z)(this,"viewport",void 0)}return(0,s.Z)(t,[{key:"syncWithMapCamera",value:function(t){var e=t.center,n=t.zoom,r=t.pitch,i=t.bearing,o=t.viewportHeight,a=t.viewportWidth;this.viewport=new ii({width:a,height:o,longitude:e&&e[0],latitude:e&&e[1],zoom:n,pitch:r,bearing:i})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,e){return this.viewport.projectFlat(t,e)}}]),t}(),ai={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},si=["id","attributionControl","style","rotation","mapInstance","version","mapSize"],ui=["id","attributionControl","style","rotation","mapInstance","canvas","hasBaseMap"];function li(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function ci(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?li(Object(n),!0).forEach((function(e){(0,h.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):li(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var pi={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},hi=(qr=(0,P.b2)(),Xr=(0,P.f3)(d.TYPES.MapConfig),Yr=(0,P.f3)(d.TYPES.IGlobalConfigService),Kr=(0,P.f3)(d.TYPES.ICoordinateSystemService),Qr=(0,P.f3)(d.TYPES.IEventEmitter),qr(($r=function(){function t(){var e=this;(0,a.Z)(this,t),(0,h.Z)(this,"version",W.G.L7MAP),(0,h.Z)(this,"map",void 0),(0,h.Z)(this,"simpleMapCoord",new O),(0,h.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),(0,p.Z)(this,"config",ti,this),(0,p.Z)(this,"configService",ei,this),(0,p.Z)(this,"coordinateSystemService",ni,this),(0,p.Z)(this,"eventEmitter",ri,this),(0,h.Z)(this,"viewport",void 0),(0,h.Z)(this,"markerContainer",void 0),(0,h.Z)(this,"cameraChangedCallback",void 0),(0,h.Z)(this,"$mapContainer",void 0),(0,h.Z)(this,"handleMiniCameraChanged",(function(t,n,r,i,o){var a=e.config.offsetCoordinate,s=void 0===a||a;e.viewport.syncWithMapCamera({bearing:i,center:[t,n],viewportHeight:e.map.transform.height,pitch:o,viewportWidth:e.map.transform.width,zoom:r,cameraHeight:0}),e.viewport.getZoom()>12&&s?e.coordinateSystemService.setCoordinateSystem(d.CoordinateSystem.LNGLAT_OFFSET):e.coordinateSystemService.setCoordinateSystem(d.CoordinateSystem.LNGLAT),e.cameraChangedCallback(e.viewport)})),(0,h.Z)(this,"handleCameraChanged",(function(){var t=e.map.getCenter(),n=t.lat,r=t.lng,i=e.config.offsetCoordinate,o=void 0===i||i;e.emit("mapchange"),e.viewport.syncWithMapCamera({bearing:e.map.getBearing(),center:[r,n],viewportHeight:e.map.transform.height,pitch:e.map.getPitch(),viewportWidth:e.map.transform.width,zoom:e.map.getZoom(),cameraHeight:0}),e.viewport.getZoom()>12&&o?e.coordinateSystemService.setCoordinateSystem(d.CoordinateSystem.LNGLAT_OFFSET):e.coordinateSystemService.setCoordinateSystem(d.CoordinateSystem.LNGLAT),e.cameraChangedCallback(e.viewport)}))}var e,n;return(0,s.Z)(t,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getCanvasContainer();this.markerContainer=A.DOM.create("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(t,e){-1!==d.MapServiceEvent.indexOf(t)?this.eventEmitter.on(t,e):this.map.on(pi[t]||t,e)}},{key:"off",value:function(t,e){this.map.off(pi[t]||t,e),this.eventEmitter.off(t,e)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){if(this.version===W.G.SIMPLE)return this.simpleMapCoord.getSize();var t=this.map.transform;return[t.width,t.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(t){return this.map.setZoom(t)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(t){this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(t){this.map.setBearing(t)}},{key:"zoomIn",value:function(t,e){this.map.zoomIn(t,e)}},{key:"zoomOut",value:function(t,e){this.map.zoomOut(t,e)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.panTo([t,e])}},{key:"fitBounds",value:function(t,e){this.map.fitBounds(t,e)}},{key:"setMaxZoom",value:function(t){this.map.setMaxZoom(t)}},{key:"setMinZoom",value:function(t){this.map.setMinZoom(t)}},{key:"setMapStatus",value:function(t){!0===t.doubleClickZoom&&this.map.doubleClickZoom.enable(),!1===t.doubleClickZoom&&this.map.doubleClickZoom.disable(),!1===t.dragEnable&&this.map.dragPan.disable(),!0===t.dragEnable&&this.map.dragPan.enable(),!1===t.rotateEnable&&this.map.dragRotate.disable(),!0===t.dragEnable&&this.map.dragRotate.enable(),!1===t.keyboardEnable&&this.map.keyboard.disable(),!0===t.keyboardEnable&&this.map.keyboard.enable(),!1===t.zoomEnable&&this.map.scrollZoom.disable(),!0===t.zoomEnable&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(t,e){this.map.flyTo({zoom:t,center:e})}},{key:"setMapStyle",value:function(t){this.map.setStyle(this.getMapStyle(t))}},{key:"pixelToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToPixel",value:function(t){return this.map.project(t)}},{key:"containerToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToContainer",value:function(t){return this.map.project(t)}},{key:"lngLatToMercator",value:function(t,e){throw new Error("not implement")}},{key:"getModelMatrix",value:function(t,e,n){throw new Error("not implement")}},{key:"init",value:(n=(0,b.Z)(E().mark((function t(){var e,n,r,i,o,a,s,u,l,c,p,h,f;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=this.config,n=e.id,r=void 0===n?"map":n,e.attributionControl,i=e.style,o=void 0===i?"light":i,a=e.rotation,s=void 0===a?0:a,u=e.mapInstance,l=e.version,c=void 0===l?"L7MAP":l,p=e.mapSize,h=void 0===p?1e4:p,f=(0,x.Z)(e,si),this.viewport=new oi,this.version=c,this.simpleMapCoord.setSize(h),c===W.G.SIMPLE&&f.center&&(f.center=this.simpleMapCoord.unproject(f.center)),u?(this.map=u,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(r),this.map=new ir(ci({container:this.$mapContainer,style:this.getMapStyle(o),bearing:s},f))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"initMiniMap",value:(e=(0,b.Z)(E().mark((function t(){var e,n,r,i,o,a,s,u,l,c,p,h=this;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=this.config,e.id,e.attributionControl,n=e.style,r=void 0===n?"light":n,i=e.rotation,o=void 0===i?0:i,e.mapInstance,a=e.canvas,s=void 0===a?null:a,u=e.hasBaseMap,l=void 0!==u&&u,c=(0,x.Z)(e,ui),this.viewport=new oi,this.$mapContainer=s,this.map=new ir(ci({container:this.$mapContainer,style:this.getMapStyle(r),bearing:o,canvas:s},c)),l?(p=this.map.getCenter(),this.handleMiniCameraChanged(p.lng,p.lat,this.map.getZoom(),this.map.getBearing(),this.map.getPitch()),A.$window.document.addEventListener("mapCameaParams",(function(t){var e=t.e,n=e.longitude,r=e.latitude,i=e.scale,o=e.bearing,a=e.pitch;h.handleMiniCameraChanged(n,r,i-1.25,o,a)}))):(this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged());case 5:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).emit.apply(e,[t].concat(r))}},{key:"once",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).once.apply(e,[t].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(t){var e=this.map.getCanvas();return"jpg"===t?null==e?void 0:e.toDataURL("image/jpeg"):null==e?void 0:e.toDataURL("image/png")}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"creatAmapContainer",value:function(t){var e=t;return"string"==typeof t&&(e=document.getElementById(t)),e}},{key:"getMapStyle",value:function(t){return"string"!=typeof t?t:ai[t]?ai[t]:t}}]),t}(),ti=(0,f.Z)($r.prototype,"config",[Xr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ei=(0,f.Z)($r.prototype,"configService",[Yr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ni=(0,f.Z)($r.prototype,"coordinateSystemService",[Kr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ri=(0,f.Z)($r.prototype,"eventEmitter",[Qr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jr=$r))||Jr);function fi(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var di,vi,mi,yi,gi,_i,xi,bi,wi,Si,Ei,Ci=function(t){(0,u.Z)(n,t);var e=fi(n);function n(){return(0,a.Z)(this,n),e.apply(this,arguments)}return(0,s.Z)(n,[{key:"getServiceConstructor",value:function(){return hi}}]),n}(y),Ti=n(6158),Ai=n.n(Ti),Mi=function(){function t(){(0,a.Z)(this,t),(0,h.Z)(this,"viewport",void 0)}return(0,s.Z)(t,[{key:"syncWithMapCamera",value:function(t){var e=t.center,n=t.zoom,r=t.pitch,i=t.bearing,o=t.viewportHeight,a=t.viewportWidth;this.viewport=new ii({width:a,height:o,longitude:e&&e[0],latitude:e&&e[1],zoom:n,pitch:r,bearing:i})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,e){return this.viewport.projectFlat(t,e)}}]),t}(),ki={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},Pi=n(25108),Oi=["id","attributionControl","style","token","rotation","mapInstance"];function Li(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Ii(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Li(Object(n),!0).forEach((function(e){(0,h.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Li(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}!function(t,e){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E\")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:\"\";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:\"\";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}"),window.mapboxgl=Ai();var Ri={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},Di=0,Ni="pk.eyJ1IjoiMTg5Njk5NDg2MTkiLCJhIjoiY2s5OXVzdHlzMDVneDNscDVjdzVmeXl0dyJ9.81SQ5qaJS0xExYLbDZAGpQ",Zi=(di=(0,P.b2)(),vi=(0,P.f3)(d.TYPES.MapConfig),mi=(0,P.f3)(d.TYPES.IGlobalConfigService),yi=(0,P.f3)(d.TYPES.ICoordinateSystemService),gi=(0,P.f3)(d.TYPES.IEventEmitter),di((xi=function(){function t(){var e=this;(0,a.Z)(this,t),(0,h.Z)(this,"version",W.G.MAPBOX),(0,h.Z)(this,"map",void 0),(0,h.Z)(this,"simpleMapCoord",new O),(0,h.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),(0,p.Z)(this,"config",bi,this),(0,p.Z)(this,"configService",wi,this),(0,p.Z)(this,"coordinateSystemService",Si,this),(0,p.Z)(this,"eventEmitter",Ei,this),(0,h.Z)(this,"viewport",void 0),(0,h.Z)(this,"markerContainer",void 0),(0,h.Z)(this,"cameraChangedCallback",void 0),(0,h.Z)(this,"$mapContainer",void 0),(0,h.Z)(this,"handleCameraChanged",(function(){var t=e.map.getCenter().wrap(),n=t.lat,r=t.lng;e.emit("mapchange"),e.viewport.syncWithMapCamera({bearing:e.map.getBearing(),center:[r,n],viewportHeight:e.map.transform.height,pitch:e.map.getPitch(),viewportWidth:e.map.transform.width,zoom:e.map.getZoom(),cameraHeight:0});var i=e.config.offsetZoom,o=void 0===i?12:i;e.viewport.getZoom()>o?e.coordinateSystemService.setCoordinateSystem(d.CoordinateSystem.LNGLAT_OFFSET):e.coordinateSystemService.setCoordinateSystem(d.CoordinateSystem.LNGLAT),e.cameraChangedCallback(e.viewport)}))}var e;return(0,s.Z)(t,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getCanvasContainer();this.markerContainer=A.DOM.create("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(t,e){-1!==d.MapServiceEvent.indexOf(t)?this.eventEmitter.on(t,e):this.map.on(Ri[t]||t,e)}},{key:"off",value:function(t,e){this.map.off(Ri[t]||t,e),this.eventEmitter.off(t,e)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var t=this.map.transform;return[t.width,t.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(t){return this.map.setZoom(t)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(t){this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(t){this.map.setBearing(t)}},{key:"zoomIn",value:function(t,e){this.map.zoomIn(t,e)}},{key:"zoomOut",value:function(t,e){this.map.zoomOut(t,e)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(t,e){this.panTo([t,e])}},{key:"fitBounds",value:function(t,e){this.map.fitBounds(t,e)}},{key:"setMaxZoom",value:function(t){this.map.setMaxZoom(t)}},{key:"setMinZoom",value:function(t){this.map.setMinZoom(t)}},{key:"setMapStatus",value:function(t){!0===t.doubleClickZoom&&this.map.doubleClickZoom.enable(),!1===t.doubleClickZoom&&this.map.doubleClickZoom.disable(),!1===t.dragEnable&&this.map.dragPan.disable(),!0===t.dragEnable&&this.map.dragPan.enable(),!1===t.rotateEnable&&this.map.dragRotate.disable(),!0===t.rotateEnable&&this.map.dragRotate.enable(),!1===t.keyboardEnable&&this.map.keyboard.disable(),!0===t.keyboardEnable&&this.map.keyboard.enable(),!1===t.zoomEnable&&this.map.scrollZoom.disable(),!0===t.zoomEnable&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(t,e){this.map.flyTo({zoom:t,center:e})}},{key:"setMapStyle",value:function(t){this.map.setStyle(this.getMapStyle(t))}},{key:"pixelToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToPixel",value:function(t){return this.map.project(t)}},{key:"containerToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToContainer",value:function(t){return this.map.project(t)}},{key:"lngLatToCoord",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0,z:0},n=this.lngLatToMercator(t,0),r=n.x,i=n.y;return[r-e.x,i-e.y]}},{key:"lngLatToMercator",value:function(t,e){var n=window.mapboxgl.MercatorCoordinate.fromLngLat(t,e),r=n.x,i=void 0===r?0:r,o=n.y,a=void 0===o?0:o,s=n.z;return{x:i,y:a,z:void 0===s?0:s}}},{key:"getModelMatrix",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{x:0,y:0,z:0},o=window.mapboxgl.MercatorCoordinate.fromLngLat(t,e),a=o.meterInMercatorCoordinateUnits(),s=M.create();return M.translate(s,s,k.fromValues(o.x-i.x,o.y-i.y,o.z||0-i.z)),M.scale(s,s,k.fromValues(a*r[0],-a*r[1],a*r[2])),M.rotateX(s,s,n[0]),M.rotateY(s,s,n[1]),M.rotateZ(s,s,n[2]),s}},{key:"init",value:(e=(0,b.Z)(E().mark((function t(){var e,n,r,i,o,a,s,u,l,c,p,h,f;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=this.config,n=e.id,r=void 0===n?"map":n,i=e.attributionControl,o=void 0!==i&&i,a=e.style,s=void 0===a?"light":a,u=e.token,l=void 0===u?Ni:u,c=e.rotation,p=void 0===c?0:c,h=e.mapInstance,f=(0,x.Z)(e,Oi),this.viewport=new Mi,h||window.mapboxgl||Pi.error(this.configService.getSceneWarninfo("SDK")),l!==Ni||"blank"===s||window.mapboxgl.accessToken||h||Pi.warn(this.configService.getSceneWarninfo("MapToken")),h||window.mapboxgl.accessToken||(window.mapboxgl.accessToken=l),h?(this.map=h,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(r),this.map=new window.mapboxgl.Map(Ii({container:this.$mapContainer,style:this.getMapStyle(s),attributionControl:o,bearing:p},f))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"destroy",value:function(){var t,e;null===(t=this.$mapContainer)||void 0===t||null===(e=t.parentNode)||void 0===e||e.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).emit.apply(e,[t].concat(r))}},{key:"once",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).once.apply(e,[t].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(t,e){var n=new(Ai().LngLat)(t[0],t[1]),r=new(Ai().LngLat)(e[0],e[1]),i=n.distanceTo(r),o=Ai().MercatorCoordinate.fromLngLat({lng:t[0],lat:t[1]}),a=Ai().MercatorCoordinate.fromLngLat({lng:e[0],lat:e[1]}),s=o.x,u=o.y,l=a.x,c=a.y;return 4194304*Math.sqrt(Math.pow(s-l,2)+Math.pow(u-c,2))*2/i}},{key:"exportMap",value:function(t){var e=this.map.getCanvas();return"jpg"===t?null==e?void 0:e.toDataURL("image/jpeg"):null==e?void 0:e.toDataURL("image/png")}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"creatAmapContainer",value:function(t){var e=t;"string"==typeof t&&(e=document.getElementById(t));var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      top: 0;\n      height: 100%;\n      width: 100%;\n    ",n.id="l7_mapbox_div"+Di++,e.appendChild(n),n}},{key:"getMapStyle",value:function(t){return"string"!=typeof t?t:ki[t]?ki[t]:t}}]),t}(),bi=(0,f.Z)(xi.prototype,"config",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wi=(0,f.Z)(xi.prototype,"configService",[mi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Si=(0,f.Z)(xi.prototype,"coordinateSystemService",[yi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ei=(0,f.Z)(xi.prototype,"eventEmitter",[gi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_i=xi))||_i);function zi(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}!function(t,e){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".mapboxgl-ctrl-logo {\n display: none !important;\n}\n");var Fi=function(t){(0,u.Z)(n,t);var e=zi(n);function n(){return(0,a.Z)(this,n),e.apply(this,arguments)}return(0,s.Z)(n,[{key:"getServiceConstructor",value:function(){return Zi}}]),n}(y)},84859:function(t,e,n){"use strict";var r;n.d(e,{G:function(){return r}}),function(t){t["GAODE1.x"]="GAODE1.x",t["GAODE2.x"]="GAODE2.x",t.MAPBOX="MAPBOX",t.L7MAP="L7MAP",t.SIMPLE="SIMPLE",t.GLOBEL="GLOBEL"}(r||(r={}))},37728:function(t,e,n){"use strict";n.r(e),n.d(e,{Scene:function(){return pt}});var r,i,o,a,s,u,l,c,p,h,f,d,v,m,y=n(29439),g=n(15671),_=n(43144),x=n(4942),b=n(30398),w=n(20832),S=n(91011),E=n(15861),C=n(87757),T=n.n(C),A=n(35251),M=n(86700),k=n(88307),P=n.n(k),O=(n(28660),function(){function t(e,n){(0,g.Z)(this,t),(0,x.Z)(this,"attribute",void 0),(0,x.Z)(this,"buffer",void 0);var r=n.buffer,i=n.offset,o=n.stride,a=n.normalized,s=n.size,u=n.divisor;this.buffer=r,this.attribute={buffer:r.get(),offset:i||0,stride:o||0,normalized:a||!1,divisor:u||0},s&&(this.attribute.size=s)}return(0,_.Z)(t,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(t){this.buffer.subData(t)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),t}()),L=(r={},(0,x.Z)(r,w.gl.POINTS,"points"),(0,x.Z)(r,w.gl.LINES,"lines"),(0,x.Z)(r,w.gl.LINE_LOOP,"line loop"),(0,x.Z)(r,w.gl.LINE_STRIP,"line strip"),(0,x.Z)(r,w.gl.TRIANGLES,"triangles"),(0,x.Z)(r,w.gl.TRIANGLE_FAN,"triangle fan"),(0,x.Z)(r,w.gl.TRIANGLE_STRIP,"triangle strip"),r),I=(i={},(0,x.Z)(i,w.gl.STATIC_DRAW,"static"),(0,x.Z)(i,w.gl.DYNAMIC_DRAW,"dynamic"),(0,x.Z)(i,w.gl.STREAM_DRAW,"stream"),i),R=(o={},(0,x.Z)(o,w.gl.BYTE,"int8"),(0,x.Z)(o,w.gl.UNSIGNED_INT,"int16"),(0,x.Z)(o,w.gl.INT,"int32"),(0,x.Z)(o,w.gl.UNSIGNED_BYTE,"uint8"),(0,x.Z)(o,w.gl.UNSIGNED_SHORT,"uint16"),(0,x.Z)(o,w.gl.UNSIGNED_INT,"uint32"),(0,x.Z)(o,w.gl.FLOAT,"float"),o),D=(a={},(0,x.Z)(a,w.gl.ALPHA,"alpha"),(0,x.Z)(a,w.gl.LUMINANCE,"luminance"),(0,x.Z)(a,w.gl.LUMINANCE_ALPHA,"luminance alpha"),(0,x.Z)(a,w.gl.RGB,"rgb"),(0,x.Z)(a,w.gl.RGBA,"rgba"),(0,x.Z)(a,w.gl.RGBA4,"rgba4"),(0,x.Z)(a,w.gl.RGB5_A1,"rgb5 a1"),(0,x.Z)(a,w.gl.RGB565,"rgb565"),(0,x.Z)(a,w.gl.DEPTH_COMPONENT,"depth"),(0,x.Z)(a,w.gl.DEPTH_STENCIL,"depth stencil"),a),N=(s={},(0,x.Z)(s,w.gl.DONT_CARE,"dont care"),(0,x.Z)(s,w.gl.NICEST,"nice"),(0,x.Z)(s,w.gl.FASTEST,"fast"),s),Z=(u={},(0,x.Z)(u,w.gl.NEAREST,"nearest"),(0,x.Z)(u,w.gl.LINEAR,"linear"),(0,x.Z)(u,w.gl.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,x.Z)(u,w.gl.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,x.Z)(u,w.gl.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,x.Z)(u,w.gl.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),u),z=(l={},(0,x.Z)(l,w.gl.REPEAT,"repeat"),(0,x.Z)(l,w.gl.CLAMP_TO_EDGE,"clamp"),(0,x.Z)(l,w.gl.MIRRORED_REPEAT,"mirror"),l),F=(c={},(0,x.Z)(c,w.gl.NONE,"none"),(0,x.Z)(c,w.gl.BROWSER_DEFAULT_WEBGL,"browser"),c),B=(p={},(0,x.Z)(p,w.gl.NEVER,"never"),(0,x.Z)(p,w.gl.ALWAYS,"always"),(0,x.Z)(p,w.gl.LESS,"less"),(0,x.Z)(p,w.gl.LEQUAL,"lequal"),(0,x.Z)(p,w.gl.GREATER,"greater"),(0,x.Z)(p,w.gl.GEQUAL,"gequal"),(0,x.Z)(p,w.gl.EQUAL,"equal"),(0,x.Z)(p,w.gl.NOTEQUAL,"notequal"),p),j=(h={},(0,x.Z)(h,w.gl.FUNC_ADD,"add"),(0,x.Z)(h,w.gl.MIN_EXT,"min"),(0,x.Z)(h,w.gl.MAX_EXT,"max"),(0,x.Z)(h,w.gl.FUNC_SUBTRACT,"subtract"),(0,x.Z)(h,w.gl.FUNC_REVERSE_SUBTRACT,"reverse subtract"),h),U=(f={},(0,x.Z)(f,w.gl.ZERO,"zero"),(0,x.Z)(f,w.gl.ONE,"one"),(0,x.Z)(f,w.gl.SRC_COLOR,"src color"),(0,x.Z)(f,w.gl.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,x.Z)(f,w.gl.SRC_ALPHA,"src alpha"),(0,x.Z)(f,w.gl.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,x.Z)(f,w.gl.DST_COLOR,"dst color"),(0,x.Z)(f,w.gl.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,x.Z)(f,w.gl.DST_ALPHA,"dst alpha"),(0,x.Z)(f,w.gl.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,x.Z)(f,w.gl.CONSTANT_COLOR,"constant color"),(0,x.Z)(f,w.gl.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,x.Z)(f,w.gl.CONSTANT_ALPHA,"constant alpha"),(0,x.Z)(f,w.gl.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,x.Z)(f,w.gl.SRC_ALPHA_SATURATE,"src alpha saturate"),f),V=(d={},(0,x.Z)(d,w.gl.NEVER,"never"),(0,x.Z)(d,w.gl.ALWAYS,"always"),(0,x.Z)(d,w.gl.LESS,"less"),(0,x.Z)(d,w.gl.LEQUAL,"lequal"),(0,x.Z)(d,w.gl.GREATER,"greater"),(0,x.Z)(d,w.gl.GEQUAL,"gequal"),(0,x.Z)(d,w.gl.EQUAL,"equal"),(0,x.Z)(d,w.gl.NOTEQUAL,"notequal"),d),G=(v={},(0,x.Z)(v,w.gl.ZERO,"zero"),(0,x.Z)(v,w.gl.KEEP,"keep"),(0,x.Z)(v,w.gl.REPLACE,"replace"),(0,x.Z)(v,w.gl.INVERT,"invert"),(0,x.Z)(v,w.gl.INCR,"increment"),(0,x.Z)(v,w.gl.DECR,"decrement"),(0,x.Z)(v,w.gl.INCR_WRAP,"increment wrap"),(0,x.Z)(v,w.gl.DECR_WRAP,"decrement wrap"),v),H=(m={},(0,x.Z)(m,w.gl.FRONT,"front"),(0,x.Z)(m,w.gl.BACK,"back"),m),W=function(){function t(e,n){(0,g.Z)(this,t),(0,x.Z)(this,"buffer",void 0);var r=n.data,i=n.usage,o=n.type;this.buffer=e.buffer({data:r,usage:I[i||w.gl.STATIC_DRAW],type:R[o||w.gl.UNSIGNED_BYTE]})}return(0,_.Z)(t,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(t){var e=t.data,n=t.offset;this.buffer.subdata(e,n)}}]),t}(),q=function(){function t(e,n){(0,g.Z)(this,t),(0,x.Z)(this,"elements",void 0);var r=n.data,i=n.usage,o=n.type,a=n.count;this.elements=e.elements({data:r,usage:I[i||w.gl.STATIC_DRAW],type:R[o||w.gl.UNSIGNED_BYTE],count:a})}return(0,_.Z)(t,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(t){var e=t.data;this.elements.subdata(e)}},{key:"destroy",value:function(){}}]),t}(),X=function(){function t(e,n){(0,g.Z)(this,t),(0,x.Z)(this,"framebuffer",void 0);var r=n.width,i=n.height,o=n.color,a=n.colors,s=(n.depth,n.stencil,{width:r,height:i});Array.isArray(a)&&(s.colors=a.map((function(t){return t.get()}))),o&&"boolean"!=typeof o&&(s.color=o.get()),this.framebuffer=e.framebuffer(s)}return(0,_.Z)(t,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(t){var e=t.width,n=t.height;this.framebuffer.resize(e,n)}}]),t}(),Y=n(71002),K=n(36719),Q=n.n(K),J=n(68630),$=n.n(J),tt=n(50361),et=n.n(tt);function nt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function rt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?nt(Object(n),!0).forEach((function(e){(0,x.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):nt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var it,ot=function(){function t(e,n){(0,g.Z)(this,t),(0,x.Z)(this,"reGl",void 0),(0,x.Z)(this,"destroyed",!1),(0,x.Z)(this,"drawCommand",void 0),(0,x.Z)(this,"drawPickCommand",void 0),(0,x.Z)(this,"drawParams",void 0),(0,x.Z)(this,"options",void 0),(0,x.Z)(this,"uniforms",{}),this.reGl=e;var r=n.vs,i=n.fs,o=n.attributes,a=n.uniforms,s=n.primitive,u=n.count,l=n.elements,c=n.depth,p=n.blend,h=n.stencil,f=n.cull,d=n.instances,v={};this.options=n,a&&(this.uniforms=this.extractUniforms(a),Object.keys(a).forEach((function(t){v[t]=e.prop(t)})));var m={};Object.keys(o).forEach((function(t){m[t]=o[t].get()}));var y={attributes:m,frag:i,uniforms:v,vert:r,blend:{},primitive:L[void 0===s?w.gl.TRIANGLES:s]};d&&(y.instances=d),u&&(y.count=u),l&&(y.elements=l.get()),this.initDepthDrawParams({depth:c},y),this.initBlendDrawParams({blend:p},y),this.initStencilDrawParams({stencil:h},y),this.initCullDrawParams({cull:f},y),this.drawCommand=e(y);var _=et()(y);_.blend=rt(rt({},_.blend),{},{enable:!1}),this.drawPickCommand=e(_),this.drawParams=y}return(0,_.Z)(t,[{key:"updateAttributesAndElements",value:function(t,e){var n={};Object.keys(t).forEach((function(e){n[e]=t[e].get()})),this.drawParams.attributes=n,this.drawParams.elements=e.get(),this.drawCommand=this.reGl(this.drawParams);var r=et()(this.drawParams);r.blend=rt(rt({},r.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(r)}},{key:"updateAttributes",value:function(t){var e={};Object.keys(t).forEach((function(n){e[n]=t[n].get()})),this.drawParams.attributes=e,this.drawCommand=this.reGl(this.drawParams);var n=et()(this.drawParams);n.blend=rt(rt({},n.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(n)}},{key:"addUniforms",value:function(t){this.uniforms=rt(rt({},this.uniforms),this.extractUniforms(t))}},{key:"draw",value:function(t,e){if(!this.drawParams.attributes||0!==Object.keys(this.drawParams.attributes).length){var n=rt(rt({},this.uniforms),this.extractUniforms(t.uniforms||{})),r={};Object.keys(n).forEach((function(t){var e=(0,Y.Z)(n[t]);"boolean"===e||"number"===e||Array.isArray(n[t])||n[t].BYTES_PER_ELEMENT?r[t]=n[t]:r[t]=n[t].get()})),e?this.drawPickCommand(r):this.drawCommand(r)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach((function(t){t.destroy()})),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(t,e){var n=t.depth;n&&(e.depth={enable:void 0===n.enable||!!n.enable,mask:void 0===n.mask||!!n.mask,func:B[n.func||w.gl.LESS],range:n.range||[0,1]})}},{key:"initBlendDrawParams",value:function(t,e){var n=t.blend;if(n){var r=n.enable,i=n.func,o=n.equation,a=n.color,s=void 0===a?[0,0,0,0]:a;e.blend={enable:!!r,func:{srcRGB:U[i&&i.srcRGB||w.gl.SRC_ALPHA],srcAlpha:U[i&&i.srcAlpha||w.gl.SRC_ALPHA],dstRGB:U[i&&i.dstRGB||w.gl.ONE_MINUS_SRC_ALPHA],dstAlpha:U[i&&i.dstAlpha||w.gl.ONE_MINUS_SRC_ALPHA]},equation:{rgb:j[o&&o.rgb||w.gl.FUNC_ADD],alpha:j[o&&o.alpha||w.gl.FUNC_ADD]},color:s}}}},{key:"initStencilDrawParams",value:function(t,e){var n=t.stencil;if(n){var r=n.enable,i=n.mask,o=void 0===i?-1:i,a=n.func,s=void 0===a?{cmp:w.gl.ALWAYS,ref:0,mask:-1}:a,u=n.opFront,l=void 0===u?{fail:w.gl.KEEP,zfail:w.gl.KEEP,zpass:w.gl.KEEP}:u,c=n.opBack,p=void 0===c?{fail:w.gl.KEEP,zfail:w.gl.KEEP,zpass:w.gl.KEEP}:c;e.stencil={enable:!!r,mask:o,func:rt(rt({},s),{},{cmp:V[s.cmp]}),opFront:{fail:G[l.fail],zfail:G[l.zfail],zpass:G[l.zpass]},opBack:{fail:G[p.fail],zfail:G[p.zfail],zpass:G[p.zpass]}}}}},{key:"initCullDrawParams",value:function(t,e){var n=t.cull;if(n){var r=n.enable,i=n.face,o=void 0===i?w.gl.BACK:i;e.cull={enable:!!r,face:H[o]}}}},{key:"extractUniforms",value:function(t){var e=this,n={};return Object.keys(t).forEach((function(r){e.extractUniformsRecursively(r,t[r],n,"")})),n}},{key:"extractUniformsRecursively",value:function(t,e,n,r){var i=this;null===e||"number"==typeof e||"boolean"==typeof e||Array.isArray(e)&&"number"==typeof e[0]||Q()(e)||""===e||"resize"in e?n["".concat(r&&r+".").concat(t)]=e:($()(e)&&Object.keys(e).forEach((function(o){i.extractUniformsRecursively(o,e[o],n,"".concat(r&&r+".").concat(t))})),Array.isArray(e)&&e.forEach((function(e,o){Object.keys(e).forEach((function(a){i.extractUniformsRecursively(a,e[a],n,"".concat(r&&r+".").concat(t,"[").concat(o,"]"))}))})))}}]),t}(),at=function(){function t(e,n){(0,g.Z)(this,t),(0,x.Z)(this,"texture",void 0),(0,x.Z)(this,"width",void 0),(0,x.Z)(this,"height",void 0),(0,x.Z)(this,"isDistroy",!1);var r=n.data,i=n.type,o=void 0===i?w.gl.UNSIGNED_BYTE:i,a=n.width,s=n.height,u=n.flipY,l=void 0!==u&&u,c=n.format,p=void 0===c?w.gl.RGBA:c,h=n.mipmap,f=void 0!==h&&h,d=n.wrapS,v=void 0===d?w.gl.CLAMP_TO_EDGE:d,m=n.wrapT,y=void 0===m?w.gl.CLAMP_TO_EDGE:m,_=n.aniso,b=void 0===_?0:_,S=n.alignment,E=void 0===S?1:S,C=n.premultiplyAlpha,T=void 0!==C&&C,A=n.mag,M=void 0===A?w.gl.NEAREST:A,k=n.min,P=void 0===k?w.gl.NEAREST:k,O=n.colorSpace,L=void 0===O?w.gl.BROWSER_DEFAULT_WEBGL:O,I=n.x,B=void 0===I?0:I,j=n.y,U=void 0===j?0:j,V=n.copy,G=void 0!==V&&V;this.width=a,this.height=s;var H={width:a,height:s,type:R[o],format:D[p],wrapS:z[v],wrapT:z[y],mag:Z[M],min:Z[P],alignment:E,flipY:l,colorSpace:F[L],premultiplyAlpha:T,aniso:b,x:B,y:U,copy:G};r&&(H.data=r),"number"==typeof f?H.mipmap=N[f]:"boolean"==typeof f&&(H.mipmap=f),this.texture=e.texture(H)}return(0,_.Z)(t,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.texture(t)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(t){var e=t.width,n=t.height;this.texture.resize(e,n),this.width=e,this.height=n}},{key:"destroy",value:function(){var t;this.isDistroy||(null===(t=this.texture)||void 0===t||t.destroy());this.isDistroy=!0}}]),t}(),st=(0,M.b2)()(it=function(){function t(){var e=this;(0,g.Z)(this,t),(0,x.Z)(this,"extensionObject",void 0),(0,x.Z)(this,"gl",void 0),(0,x.Z)(this,"$container",void 0),(0,x.Z)(this,"canvas",void 0),(0,x.Z)(this,"width",void 0),(0,x.Z)(this,"height",void 0),(0,x.Z)(this,"isDirty",void 0),(0,x.Z)(this,"createModel",(function(t){return new ot(e.gl,t)})),(0,x.Z)(this,"createAttribute",(function(t){return new O(e.gl,t)})),(0,x.Z)(this,"createBuffer",(function(t){return new W(e.gl,t)})),(0,x.Z)(this,"createElements",(function(t){return new q(e.gl,t)})),(0,x.Z)(this,"createTexture2D",(function(t){return new at(e.gl,t)})),(0,x.Z)(this,"createFramebuffer",(function(t){return new X(e.gl,t)})),(0,x.Z)(this,"useFramebuffer",(function(t,n){e.gl({framebuffer:t?t.get():null})(n)})),(0,x.Z)(this,"clear",(function(t){var n=t.color,r=t.depth,i=t.stencil,o=t.framebuffer,a=void 0===o?null:o,s={color:n,depth:r,stencil:i};s.framebuffer=null===a?a:a.get(),e.gl.clear(s)})),(0,x.Z)(this,"viewport",(function(t){var n=t.x,r=t.y,i=t.width,o=t.height;e.gl._gl.viewport(n,r,i,o),e.width=i,e.height=o,e.gl._refresh()})),(0,x.Z)(this,"readPixels",(function(t){var n=t.framebuffer,r={x:t.x,y:t.y,width:t.width,height:t.height};return n&&(r.framebuffer=n.get()),e.gl.read(r)})),(0,x.Z)(this,"getViewportSize",(function(){return{width:e.gl._gl.drawingBufferWidth,height:e.gl._gl.drawingBufferHeight}})),(0,x.Z)(this,"getContainer",(function(){return A.isMini?e.canvas:null===(t=e.canvas)||void 0===t?void 0:t.parentElement;var t})),(0,x.Z)(this,"getCanvas",(function(){return e.canvas})),(0,x.Z)(this,"getGLContext",(function(){return e.gl._gl})),(0,x.Z)(this,"destroy",(function(){e.canvas=null,e.gl.destroy(),e.gl=null}))}var e;return(0,_.Z)(t,[{key:"init",value:(e=(0,E.Z)(T().mark((function t(e,n){var r=this;return T().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.canvas=e,t.next=3,new Promise((function(t,e){P()({canvas:r.canvas,attributes:{alpha:!0,antialias:n.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:n.preserveDrawingBuffer,stencil:n.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(n,r){!n&&r||e(n),t(r)}})}));case 3:this.gl=t.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return t.stop()}}),t,this)}))),function(t,n){return e.apply(this,arguments)})},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(t){return!!this.getGLContext().getExtension(t)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var t=this.getGLContext();t.disable(t.CULL_FACE)}},{key:"setDirty",value:function(t){this.isDirty=t}},{key:"getDirty",value:function(){return this.isDirty}}]),t}())||it,ut=n(25108);function lt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function ct(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?lt(Object(n),!0).forEach((function(e){(0,x.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):lt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var pt=function(){function t(e){(0,g.Z)(this,t),(0,x.Z)(this,"sceneService",void 0),(0,x.Z)(this,"mapService",void 0),(0,x.Z)(this,"controlService",void 0),(0,x.Z)(this,"layerService",void 0),(0,x.Z)(this,"iconService",void 0),(0,x.Z)(this,"markerService",void 0),(0,x.Z)(this,"popupService",void 0),(0,x.Z)(this,"fontService",void 0),(0,x.Z)(this,"interactionService",void 0),(0,x.Z)(this,"container",void 0);var n=e.id,r=e.map,i=e.canvas,o=e.hasBaseMap,a=(0,w.createSceneContainer)();this.container=a,r.setContainer(a,n,i,o),a.bind(w.TYPES.IRendererService).to(st).inSingletonScope(),this.sceneService=a.get(w.TYPES.ISceneService),this.mapService=a.get(w.TYPES.IMapService),this.iconService=a.get(w.TYPES.IIconService),this.fontService=a.get(w.TYPES.IFontService),this.controlService=a.get(w.TYPES.IControlService),this.layerService=a.get(w.TYPES.ILayerService),this.markerService=a.get(w.TYPES.IMarkerService),this.interactionService=a.get(w.TYPES.IInteractionService),this.popupService=a.get(w.TYPES.IPopupService),A.isMini?this.sceneService.initMiniScene(e):(this.initComponent(n),this.sceneService.init(e),this.initControl())}return(0,_.Z)(t,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(t){return this.sceneService.exportPng(t)}},{key:"exportMap",value:function(t){return this.sceneService.exportPng(t)}},{key:"registerRenderService",value:function(t){var e=this;this.sceneService.loaded?new t(this).init():this.on("loaded",(function(){new t(e).init()}))}},{key:"setBgColor",value:function(t){this.mapService.setBgColor(t)}},{key:"addLayer",value:function(t){var e=(0,w.createLayerContainer)(this.container);t.setContainer(e,this.container),this.sceneService.addLayer(t);var n=t.getLayerConfig();if(n){var r=n.mask,i=n.maskfence,o=n.maskColor,a=void 0===o?"#000":o,s=n.maskOpacity,u=void 0===s?0:s;if(r&&i){var l=(new S.MaskLayer).source(i).shape("fill").color(a).style({opacity:u});this.addMask(l,t.id)}}else ut.warn("addLayer should run after scene loaded!")}},{key:"addMask",value:function(t,e){var n=this.getLayer(e);if(n){var r=(0,w.createLayerContainer)(this.container);t.setContainer(r,this.container),n.addMaskLayer(t),this.sceneService.addLayer(t)}else ut.warn("parent layer not find!")}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(t){return this.layerService.getLayer(t)}},{key:"getLayerByName",value:function(t){return this.layerService.getLayerByName(t)}},{key:"removeLayer",value:function(t,e){this.layerService.remove(t,e)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(t){this.layerService.setEnableRender(t)}},{key:"addIconFont",value:function(t,e){this.fontService.addIconFont(t,e)}},{key:"addIconFonts",value:function(t){var e=this;t.forEach((function(t){var n=(0,y.Z)(t,2),r=n[0],i=n[1];e.fontService.addIconFont(r,i)}))}},{key:"addFontFace",value:function(t,e){this.sceneService.addFontFace(t,e)}},{key:"addImage",value:function(t,e){A.isMini?this.iconService.addImageMini(t,e,this.sceneService):this.iconService.addImage(t,e)}},{key:"hasImage",value:function(t){return this.iconService.hasImage(t)}},{key:"removeImage",value:function(t){this.iconService.removeImage(t)}},{key:"addIconFontGlyphs",value:function(t,e){this.fontService.addIconGlyphs(e)}},{key:"addControl",value:function(t){this.controlService.addControl(t,this.container)}},{key:"removeControl",value:function(t){this.controlService.removeControl(t)}},{key:"getControlByName",value:function(t){return this.controlService.getControlByName(t)}},{key:"addMarker",value:function(t){this.markerService.addMarker(t)}},{key:"addMarkerLayer",value:function(t){this.markerService.addMarkerLayer(t)}},{key:"removeMarkerLayer",value:function(t){this.markerService.removeMarkerLayer(t)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(t){this.popupService.addPopup(t)}},{key:"on",value:function(t,e){-1===w.SceneEventList.indexOf(t)?this.mapService.on(t,e):this.sceneService.on(t,e)}},{key:"once",value:function(t,e){-1===w.SceneEventList.indexOf(t)?this.mapService.once(t,e):this.sceneService.once(t,e)}},{key:"off",value:function(t,e){-1===w.SceneEventList.indexOf(t)?this.mapService.off(t,e):this.sceneService.off(t,e)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(t){return this.mapService.getCenter(t)}},{key:"setCenter",value:function(t,e){return this.mapService.setCenter(t,e)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(t){return this.mapService.setPitch(t)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(t){this.mapService.setRotation(t)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(t){this.mapService.panTo(t)}},{key:"panBy",value:function(t,e){this.mapService.panBy(t,e)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(t){this.mapService.setZoom(t)}},{key:"fitBounds",value:function(t,e){var n=this.sceneService.getSceneConfig(),r=n.fitBoundsOptions,i=n.animate;this.mapService.fitBounds(t,e||ct(ct({},r),{},{animate:i}))}},{key:"setZoomAndCenter",value:function(t,e){this.mapService.setZoomAndCenter(t,e)}},{key:"setMapStyle",value:function(t){this.mapService.setMapStyle(t)}},{key:"setMapStatus",value:function(t){this.mapService.setMapStatus(t)}},{key:"pixelToLngLat",value:function(t){return this.mapService.pixelToLngLat(t)}},{key:"lngLatToPixel",value:function(t){return this.mapService.lngLatToPixel(t)}},{key:"containerToLngLat",value:function(t){return this.mapService.containerToLngLat(t)}},{key:"lngLatToContainer",value:function(t){return this.mapService.lngLatToContainer(t)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(t,e){this.container.bind(w.TYPES.IPostProcessingPass).to(t).whenTargetNamed(e)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(t){this.controlService.init({container:A.DOM.getContainer(t)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var t=this.sceneService.getSceneConfig(),e=t.logoVisible,n=t.logoPosition;e&&this.addControl(new b.Logo({position:n}))}}]),t}()},33591:function(t,e,n){"use strict";n.r(e),n.d(e,{DEFAULT_DATA:function(){return Ct},DEFAULT_PARSER:function(){return Tt},default:function(){return At},getParser:function(){return o},getTransform:function(){return s},registerParser:function(){return a},registerTransform:function(){return u}});var r={},i={},o=function(t){return i[t]},a=function(t,e){i[t]=e},s=function(t){return r[t]},u=function(t,e){r[t]=e},l={},c={};function p(t){return new Function("d","return {"+t.map((function(t,e){return JSON.stringify(t)+": d["+e+'] || ""'})).join(",")+"}")}function h(t){var e=Object.create(null),n=[];return t.forEach((function(t){for(var r in t)r in e||n.push(e[r]=r)})),n}function f(t,e){var n=t+"",r=n.length;return r<e?new Array(e-r+1).join(0)+n:n}function d(t){var e,n=t.getUTCHours(),r=t.getUTCMinutes(),i=t.getUTCSeconds(),o=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":((e=t.getUTCFullYear())<0?"-"+f(-e,6):e>9999?"+"+f(e,6):f(e,4))+"-"+f(t.getUTCMonth()+1,2)+"-"+f(t.getUTCDate(),2)+(o?"T"+f(n,2)+":"+f(r,2)+":"+f(i,2)+"."+f(o,3)+"Z":i?"T"+f(n,2)+":"+f(r,2)+":"+f(i,2)+"Z":r||n?"T"+f(n,2)+":"+f(r,2)+"Z":"")}var v=function(t){var e=new RegExp('["'+t+"\n\r]"),n=t.charCodeAt(0);function r(t,e){var r,i=[],o=t.length,a=0,s=0,u=o<=0,p=!1;function h(){if(u)return c;if(p)return p=!1,l;var e,r,i=a;if(34===t.charCodeAt(i)){for(;a++<o&&34!==t.charCodeAt(a)||34===t.charCodeAt(++a););return(e=a)>=o?u=!0:10===(r=t.charCodeAt(a++))?p=!0:13===r&&(p=!0,10===t.charCodeAt(a)&&++a),t.slice(i+1,e-1).replace(/""/g,'"')}for(;a<o;){if(10===(r=t.charCodeAt(e=a++)))p=!0;else if(13===r)p=!0,10===t.charCodeAt(a)&&++a;else if(r!==n)continue;return t.slice(i,e)}return u=!0,t.slice(i,o)}for(10===t.charCodeAt(o-1)&&--o,13===t.charCodeAt(o-1)&&--o;(r=h())!==c;){for(var f=[];r!==l&&r!==c;)f.push(r),r=h();e&&null==(f=e(f,s++))||i.push(f)}return i}function i(e,n){return e.map((function(e){return n.map((function(t){return a(e[t])})).join(t)}))}function o(e){return e.map(a).join(t)}function a(t){return null==t?"":t instanceof Date?d(t):e.test(t+="")?'"'+t.replace(/"/g,'""')+'"':t}return{parse:function(t,e){var n,i,o=r(t,(function(t,r){if(n)return n(t,r-1);i=t,n=e?function(t,e){var n=p(t);return function(r,i){return e(n(r),i,t)}}(t,e):p(t)}));return o.columns=i||[],o},parseRows:r,format:function(e,n){return null==n&&(n=h(e)),[n.map(a).join(t)].concat(i(e,n)).join("\n")},formatBody:function(t,e){return null==e&&(e=h(t)),i(t,e).join("\n")},formatRows:function(t){return t.map(o).join("\n")},formatRow:o,formatValue:a}}(","),m=v.parse,y=(v.parseRows,v.format,v.formatBody,v.formatRows,v.formatRow,v.formatValue,n(4942)),g=n(93433),_=n(38163),x=n.n(_);function b(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function w(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?b(Object(n),!0).forEach((function(e){(0,y.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function S(t,e){var n=e.x,r=e.y,i=e.x1,o=e.y1,a=e.coordinates,s=[];return Array.isArray(t)?(t.forEach((function(t,e){var u=[];(n&&r&&(u=[parseFloat(t[n]),parseFloat(t[r])]),n&&r&&i&&o)&&(u=[[parseFloat(t[n]),parseFloat(t[r])],[parseFloat(t[i]),parseFloat(t[o])]]);if(a){var l="Polygon";Array.isArray(a[0])||(l="Point"),Array.isArray(a[0])&&!Array.isArray(a[0][0])&&(l="LineString");var c={type:l,coordinates:(0,g.Z)(t[a])};x()(c,!0),u=c.coordinates}var p=w(w({},t),{},{_id:e,coordinates:u});s.push(p)})),{dataArray:s}):{dataArray:[]}}var E=n(1449);function C(t,e){var n,r,i,o,a,s,u,l,c,p,h=0,f="FeatureCollection"===t.type,d="Feature"===t.type,v=f?t.features.length:1;for(n=0;n<v;n++){for(s=f?t.features[n].geometry:d?t.geometry:t,l=f?t.features[n].properties:d?t.properties:{},c=f?t.features[n].bbox:d?t.bbox:void 0,p=f?t.features[n].id:d?t.id:void 0,a=(u=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,i=0;i<a;i++)if(null!==(o=u?s.geometries[i]:s))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(o,h,l,c,p))return!1;break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(!1===e(o.geometries[r],h,l,c,p))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,h,l,c,p))return!1;h++}}function T(t,e){C(t,(function(t,n,r,i,o){var a,s=null===t?null:t.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return!1!==e((0,E.zL)(t,r,{bbox:i,id:o}),n,0)&&void 0}switch(s){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon"}for(var u=0;u<t.coordinates.length;u++){var l={type:a,coordinates:t.coordinates[u]};if(!1===e((0,E.zL)(l,r),n,u))return!1}}))}function A(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function M(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?A(Object(n),!0).forEach((function(e){(0,y.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var k=n(35251);function P(t,e){var n=e.extent,r=void 0===n?[121.168,30.2828,121.384,30.4219]:n,i=new Promise((function(e){t instanceof HTMLImageElement?e([t]):function(t,e){var n=t,r=[];if("string"==typeof n)(0,k.getImage)({url:n},(function(t,n){r.push(n),e(r)}));else{var i=n.length,o=0;n.forEach((function(t){(0,k.getImage)({url:t},(function(t,n){o++,r.push(n),o===i&&e(r)}))}))}}(t,(function(t){e(t)}))}));return{originData:t,images:i,_id:1,dataArray:[{_id:0,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]}}var O=n(15861),L=n(87757),I=n.n(L);function R(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function D(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?R(Object(n),!0).forEach((function(e){(0,y.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var N,Z={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},z=(N=(0,O.Z)(I().mark((function t(e,n){var r;return I().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=(0,k.getURLFromTemplate)(e,n),t.abrupt("return",new Promise((function(t,e){(0,k.getImage)({url:r},(function(n,r){n?e(n):t(r)}))})));case 2:case"end":return t.stop()}}),t)}))),function(t,e){return N.apply(this,arguments)});var F=n(15671),B=n(43144),j=n(97326),U=n(60136),V=n(82963),G=n(61120),H=n(30236),W=n.n(H),q=n(47037),X=n.n(q),Y=n(23560),K=n.n(Y),Q=n(50361),J=n.n(Q),$=n(46343),tt=n(26729),et=n(69848),nt=n.n(et);function rt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function it(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?rt(Object(n),!0).forEach((function(e){(0,y.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):rt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function ot(t,e){var n=e.radius,r=void 0===n?40:n,i=e.maxZoom,o=void 0===i?18:i,a=e.minZoom,s=void 0===a?0:a,u=e.zoom,l=void 0===u?2:u;if(t.pointIndex){var c=t.pointIndex.getClusters(t.extent,Math.floor(l));return t.dataArray=c.map((function(t,e){return it({coordinates:t.geometry.coordinates,_id:e+1},t.properties)})),t}var p=new(nt())({radius:r,minZoom:s,maxZoom:o}),h={type:"FeatureCollection",features:[]};return h.features=t.dataArray.map((function(t){return{type:"Feature",geometry:{type:"Point",coordinates:t.coordinates},properties:it({},t)}})),p.load(h.features),p}function at(t){if(0===t.length)return 0;for(var e,n=t[0],r=0,i=1;i<t.length;i++)e=n+1*t[i],Math.abs(n)>=Math.abs(t[i])?r+=n-e+t[i]:r+=t[i]-e+n,n=e;return n+1*r}var st={min:function(t){if(0===t.length)throw new Error("min requires at least one data point");for(var e=t[0],n=1;n<t.length;n++)t[n]<e&&(e=t[n]);return e},max:function(t){if(0===t.length)throw new Error("max requires at least one data point");for(var e=t[0],n=1;n<t.length;n++)t[n]>e&&(e=t[n]);return e},mean:function(t){if(0===t.length)throw new Error("mean requires at least one data point");return at(t)/t.length},sum:at};function ut(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function lt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ut(Object(n),!0).forEach((function(e){(0,y.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ut(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function ct(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,G.Z)(t);if(e){var i=(0,G.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,V.Z)(this,n)}}function pt(t,e){if(Array.isArray(e))return e}var ht=function(t){(0,U.Z)(n,t);var e=ct(n);function n(t,r){var i;return(0,F.Z)(this,n),i=e.call(this),(0,y.Z)((0,j.Z)(i),"data",void 0),(0,y.Z)((0,j.Z)(i),"center",void 0),(0,y.Z)((0,j.Z)(i),"extent",void 0),(0,y.Z)((0,j.Z)(i),"hooks",{init:new $.ni}),(0,y.Z)((0,j.Z)(i),"parser",{type:"geojson"}),(0,y.Z)((0,j.Z)(i),"transforms",[]),(0,y.Z)((0,j.Z)(i),"cluster",!1),(0,y.Z)((0,j.Z)(i),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,y.Z)((0,j.Z)(i),"tileset",void 0),(0,y.Z)((0,j.Z)(i),"mapService",void 0),(0,y.Z)((0,j.Z)(i),"invalidExtent",!1),(0,y.Z)((0,j.Z)(i),"dataArrayChanged",!1),(0,y.Z)((0,j.Z)(i),"originData",void 0),(0,y.Z)((0,j.Z)(i),"rawData",void 0),(0,y.Z)((0,j.Z)(i),"cfg",{}),(0,y.Z)((0,j.Z)(i),"clusterIndex",void 0),i.originData=t,i.initCfg(r),i.hooks.init.tap("parser",(function(){i.excuteParser()})),i.hooks.init.tap("cluster",(function(){i.initCluster()})),i.hooks.init.tap("transform",(function(){i.executeTrans()})),i.init(),i}return(0,B.Z)(n,[{key:"getClusters",value:function(t){return this.clusterIndex.getClusters(this.caculClusterExtent(2),t)}},{key:"getClustersLeaves",value:function(t){return this.clusterIndex.getLeaves(t,1/0)}},{key:"updateClusterData",value:function(t){var e=this,n=this.clusterOptions,r=n.method,i=void 0===r?"sum":r,a=n.field,s=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(t));this.clusterOptions.zoom=t,s.forEach((function(t){t.id||(t.properties.point_count=1)})),(a||K()(i))&&(s=s.map((function(t){var n=t.id;if(n){var r,o=e.clusterIndex.getLeaves(n,1/0).map((function(t){return t.properties}));if(X()(i)&&a){var s=function(t,e){return t.map((function(t){return 1*t[e]}))}(o,a);r=st[i](s)}K()(i)&&(r=i(o)),t.properties.stat=r}else t.properties.point_count=1;return t}))),this.data=o("geojson")({type:"FeatureCollection",features:s}),this.executeTrans()}},{key:"getFeatureById",value:function(t){var e=this.parser.type;if("geojson"!==(void 0===e?"geojson":e)||this.cluster)return t<this.data.dataArray.length?this.data.dataArray[t]:"null";var n=t<this.originData.features.length?this.originData.features[t]:"null",r=J()(n);if(0!==this.transforms.length||this.dataArrayChanged){var i=this.data.dataArray.find((function(e){return e._id===t}));r.properties=i}return r}},{key:"updateFeaturePropertiesById",value:function(t,e){this.data.dataArray=this.data.dataArray.map((function(n){return n._id===t?lt(lt({},n),e):n})),this.dataArrayChanged=!0,this.emit("update")}},{key:"getFeatureId",value:function(t,e){var n=this.data.dataArray.find((function(n){return n[t]===e}));return null==n?void 0:n._id}},{key:"setData",value:function(t,e){this.originData=t,this.dataArrayChanged=!1,this.initCfg(e),this.init(),this.emit("update")}},{key:"destroy",value:function(){var t;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,null===(t=this.tileset)||void 0===t||t.destroy()}},{key:"initCfg",value:function(t){this.cfg=W()(this.cfg,t,pt);var e=this.cfg;e&&(e.parser&&(this.parser=e.parser),e.transforms&&(this.transforms=e.transforms),this.cluster=e.cluster||!1,e.clusterOptions&&(this.cluster=!0,this.clusterOptions=lt(lt({},this.clusterOptions),e.clusterOptions)))}},{key:"init",value:function(){this.hooks.init.call(this)}},{key:"excuteParser",value:function(){var t=this.parser,e=t.type||"geojson",n=o(e);this.data=n(this.originData,t),this.extent=(0,k.extent)(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3],this.tileset=this.initTileset()}},{key:"setCenter",value:function(t){this.center=[(t[0]+t[2])/2,(t[1]+t[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var t=this.data.tilesetOptions;if(t)return this.tileset?(this.tileset.updateOptions(t),this.tileset):new k.TilesetManager(lt({},t))}},{key:"executeTrans",value:function(){var t=this;this.transforms.forEach((function(e){var n=e.type,r=s(n)(t.data,e);Object.assign(t.data,r)}))}},{key:"initCluster",value:function(){if(this.cluster){var t=this.clusterOptions||{};this.clusterIndex=ot(this.data,t)}}},{key:"caculClusterExtent",value:function(t){var e=[[-1/0,-1/0],[1/0,1/0]];return this.invalidExtent||(e=(0,k.padBounds)((0,k.bBoxToBounds)(this.extent),t)),e[0].concat(e[1])}}]),n}(tt.EventEmitter);function ft(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return dt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return dt(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function dt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var vt=6378e3;var mt=n(29439),yt=Math.PI/3,gt=[0,yt,2*yt,3*yt,4*yt,5*yt];function _t(t){return t[0]}function xt(t){return t[1]}function bt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function wt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?bt(Object(n),!0).forEach((function(e){(0,y.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):bt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function St(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Et(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?St(Object(n),!0).forEach((function(e){(0,y.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):St(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}a("rasterTile",(function(t,e){var n=D(D(D({},Z),e),{},{getTileData:function(e){return z(t,e)}});return{data:t,dataArray:[],tilesetOptions:n}})),a("geojson",(function(t,e){var n=[],r={};return t.features?(t.features=t.features.filter((function(t){var e=t.geometry;return null!=t&&e&&e.type&&e.coordinates&&e.coordinates.length>0})),x()(t,!0),0===t.features.length?{dataArray:[],featureKeys:r}:(T(t,(function(t,e){var r=function(t){if(Array.isArray(t))return t;if("Feature"===t.type){if(null!==t.geometry)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}(t),i=e,o=M(M({},t.properties),{},{coordinates:r,_id:i});n.push(o)})),{dataArray:n,featureKeys:r})):(t.features=[],{dataArray:[]})})),a("image",P),a("csv",(function(t,e){return S(m(t),e)})),a("json",S),a("raster",(function(t,e){var n=e.extent,r=e.width,i=e.height,o=e.min,a=e.max;return{_id:1,dataArray:[{_id:1,data:Array.from(t),width:r,height:i,min:o,max:a,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]}})),u("cluster",ot),u("filter",(function(t,e){var n=e.callback;return n&&(t.dataArray=t.dataArray.filter(n)),t})),u("join",(function(t,e){var n=e.sourceField,r=e.targetField,i=e.data,o={};return i.forEach((function(t){o[t[n]]=t})),t.dataArray=t.dataArray.map((function(t){var e=t[r];return Et(Et({},t),o[e])})),t})),u("map",(function(t,e){var n=e.callback;return n&&(t.dataArray=t.dataArray.map(n)),t})),u("grid",(function(t,e){var n=t.dataArray,r=e.size,i=void 0===r?10:r,o=i/(2*Math.PI*vt)*(256<<20)/2,a=function(t,e){var n,r,i=1/0,o=-1/0,a=ft(t);try{for(a.s();!(r=a.n()).done;){n=r.value.coordinates[1],Number.isFinite(n)&&(i=n<i?n:i,o=n>o?n:o)}}catch(t){a.e(t)}finally{a.f()}var s=(u=e,l=(i+o)/2,h=u,c=h/vt*(180/Math.PI),p=function(t,e){return e/vt*(180/Math.PI)/Math.cos(t*Math.PI/180)}(l,u),{yOffset:c,xOffset:p});var u,l,c,p,h;if(s.xOffset<=0||s.yOffset<=0)return{gridHash:{},gridOffset:s};var f,d={},v=ft(t);try{for(v.s();!(f=v.n()).done;){var m=f.value,y=m.coordinates[1],g=m.coordinates[0];if(Number.isFinite(y)&&Number.isFinite(g)){var _=Math.floor((y+90)/s.yOffset),x=Math.floor((g+180)/s.xOffset),b="".concat(_,"-").concat(x);d[b]=d[b]||{count:0,points:[]},d[b].count+=1,d[b].points.push(m)}}}catch(t){v.e(t)}finally{v.f()}return{gridHash:d,gridOffset:s}}(n,i),s=function(t,e,n){return Object.keys(t).reduce((function(r,i,o){var a=i.split("-"),s=parseInt(a[0],10),u=parseInt(a[1],10),l={};if(n.field&&n.method){var c=k.Satistics.getColumn(t[i].points,n.field);l[n.method]=k.Satistics.statMap[n.method](c)}return Object.assign(l,{_id:o,coordinates:(0,k.aProjectFlat)([e.xOffset*(u+.5)-180,e.yOffset*(s+.5)-90]),rawData:t[i].points,count:t[i].count}),r.push(l),r}),[])}(a.gridHash,a.gridOffset,e);return{yOffset:o,xOffset:o,radius:o,type:"grid",dataArray:s}})),u("hexagon",(function(t,e){var n=t.dataArray,r=e.size,i=void 0===r?10:r,o=e.method,a=void 0===o?"sum":o,s=i/(2*Math.PI*6378e3)*(256<<20)/2,u=n.map((function(t){var e=(0,k.aProjectFlat)(t.coordinates),n=(0,mt.Z)(e,2),r=n[0],i=n[1];return wt(wt({},t),{},{coordinates:[r,i]})})),l=function(){var t,e,n,r=0,i=0,o=1,a=1,s=_t,u=xt;function l(t){var r,i={},o=[],a=t.length;for(r=0;r<a;++r)if(!isNaN(c=+s.call(null,l=t[r],r,t))&&!isNaN(p=+u.call(null,l,r,t))){var l,c,p,h=Math.round(p/=n),f=Math.round(c=c/e-(1&h)/2),d=p-h;if(3*Math.abs(d)>1){var v=c-f,m=f+(c<f?-1:1)/2,y=h+(p<h?-1:1),g=c-m,_=p-y;v*v+d*d>g*g+_*_&&(f=m+(1&h?1:-1)/2,h=y)}var x=f+"-"+h,b=i[x];b?b.push(l):(o.push(b=i[x]=[l]),b.x=(f+(1&h)/2)*e,b.y=h*n)}return o}function c(t){var e=0,n=0;return gt.map((function(r){var i=Math.sin(r)*t,o=-Math.cos(r)*t,a=i-e,s=o-n;return e=i,n=o,[a,s]}))}return l.hexagon=function(e){return"m"+c(null==e?t:+e).join("l")+"z"},l.centers=function(){for(var s=[],u=Math.round(i/n),l=Math.round(r/e),c=u*n;c<a+t;c+=n,++u)for(var p=l*e+(1&u)*e/2;p<o+e/2;p+=e)s.push([p,c]);return s},l.mesh=function(){var e=c(t).slice(0,4).join("l");return l.centers().map((function(t){return"M"+t+"m"+e})).join("")},l.x=function(t){return arguments.length?(s=t,l):s},l.y=function(t){return arguments.length?(u=t,l):u},l.radius=function(r){return arguments.length?(e=2*(t=+r)*Math.sin(yt),n=1.5*t,l):t},l.size=function(t){return arguments.length?(r=i=0,o=+t[0],a=+t[1],l):[o-r,a-i]},l.extent=function(t){return arguments.length?(r=+t[0][0],i=+t[0][1],o=+t[1][0],a=+t[1][1],l):[[r,i],[o,a]]},l.radius(1)}().radius(s).x((function(t){return t.coordinates[0]})).y((function(t){return t.coordinates[1]})),c={dataArray:l(u).map((function(t,n){var r;if(e.field&&a){var i=k.Satistics.getColumn(t,e.field);t[a]=k.Satistics.statMap[a](i)}return r={},(0,y.Z)(r,e.method,t[a]),(0,y.Z)(r,"count",t.length),(0,y.Z)(r,"rawData",t),(0,y.Z)(r,"coordinates",[t.x,t.y]),(0,y.Z)(r,"_id",n),r})),radius:s,xOffset:s,yOffset:s,type:"hexagon"};return c}));var Ct=[{lng1:100,lat1:30,lng2:130,lat2:30}],Tt={parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}},At=ht},35251:function(t,e,n){"use strict";n.r(e),n.d(e,{$XMLHttpRequest:function(){return oe},$location:function(){return ae},$window:function(){return ie},BKDRHash:function(){return o},DOM:function(){return r},FrequencyController:function(){return yn},LRUCache:function(){return dn},LoadTileDataStatus:function(){return Mn},Satistics:function(){return i},Tile:function(){return Wn},TilesetManager:function(){return $n},UpdateTileStrategy:function(){return An},aProjectFlat:function(){return $e},amap2Project:function(){return en},anchorTranslate:function(){return En},anchorType:function(){return mn},applyAnchorClass:function(){return Cn},bBoxToBounds:function(){return sn},bindAll:function(){return vn},boundsContains:function(){return an},calAngle:function(){return pn},calDistance:function(){return ln},decodePickingColor:function(){return bn},dispatchMapCameraParams:function(){return Nt},dispatchMouseDown:function(){return Qt},dispatchMouseMove:function(){return Jt},dispatchMouseUp:function(){return $t},dispatchPointerDown:function(){return Wt},dispatchPointerMove:function(){return qt},dispatchPointerUp:function(){return Xt},dispatchTouchEnd:function(){return Dt},dispatchTouchMove:function(){return Rt},dispatchTouchStart:function(){return It},djb2hash:function(){return a},encodePickingColor:function(){return wn},extent:function(){return Ge},flow:function(){return fn},generateColorRamp:function(){return Sn},getAngle:function(){return hn},getArrayBuffer:function(){return Be},getCullFace:function(){return On},getImage:function(){return je},getJSON:function(){return Fe},getMask:function(){return Tn},getURLFromTemplate:function(){return In},isColor:function(){return _n},isMini:function(){return ne},isMiniAli:function(){return te},isURLTemplate:function(){return Ln},isWeChatMiniProgram:function(){return ee},latitude:function(){return Qe},lngLatToMeters:function(){return Xe},lnglatDistance:function(){return nn},longitude:function(){return Ke},metersToLngLat:function(){return Ye},miniWindow:function(){return re},normalize:function(){return un},padBounds:function(){return on},project:function(){return rn},rgb2arr:function(){return xn},tranfrormCoord:function(){return We},unProjectFlat:function(){return tn},validateLngLat:function(){return Je}});var r={};n.r(r),n.d(r,{DPR:function(){return Ee},addClass:function(){return fe},create:function(){return pe},empty:function(){return ge},getClass:function(){return ye},getContainer:function(){return ue},getViewPortScale:function(){return Se},hasClass:function(){return ve},printCanvas:function(){return we},remove:function(){return he},removeClass:function(){return de},setClass:function(){return me},setTransform:function(){return xe},splitWords:function(){return ce},triggerResize:function(){return be},trim:function(){return le}});var i={};function o(t){var e=0;t+="x";for(var n=Math.floor(65745979961613.07),r=0;r<t.length;r++)e>n&&(e=Math.floor(e/137)),e=131*e+t.charCodeAt(r);return e}function a(t){for(var e=5381,n=(t=t.toString()).length;n;)e=33*e^t.charCodeAt(--n);return e>>>0}n.r(i),n.d(i,{getColumn:function(){return Oe},getSatByColumn:function(){return Le},max:function(){return Ce},mean:function(){return Me},min:function(){return Te},mode:function(){return ke},statMap:function(){return Pe},sum:function(){return Ae}});var s=n(29439),u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function l(t){this.message=t}function c(t){for(var e,n,r,i,o="",a=0,s=(t=String(t)).length%3;a<t.length;){if((n=t.charCodeAt(a++))>255||(r=t.charCodeAt(a++))>255||(i=t.charCodeAt(a++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");o+=u.charAt((e=n<<16|r<<8|i)>>18&63)+u.charAt(e>>12&63)+u.charAt(e>>6&63)+u.charAt(63&e)}return s?o.slice(0,s-3)+"===".substring(s):o}l.prototype=new Error,l.prototype.name="InvalidCharacterError";var p,h=n(15671),f=n(43144),d=function(){function t(e,n){(0,h.Z)(this,t),this.buffers=e,this.type=n}return(0,f.Z)(t,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(t,e,n){throw new Error("not implemented")}}]),t}();p="undefined"==typeof window?{devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(t){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(t){return null},clearMeasures:function(t){return null},clearMarks:function(t){return null},measure:function(t,e,n){return{duration:0}},now:function(){return(new Date).getTime()}},Blob:"",dispatchEvent:function(t){return!0},Event:function(t,e){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:window;var v="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM?my.getSystemInfoSync().pixelRatio:p.devicePixelRatio,m=n(60136),y=n(82963),g=n(61120),_=n(4942),x=(0,f.Z)((function t(e,n){(0,h.Z)(this,t),(0,_.Z)(this,"cancelBubble",void 0),(0,_.Z)(this,"cancelable",void 0),(0,_.Z)(this,"target",void 0),(0,_.Z)(this,"currentTarget",void 0),(0,_.Z)(this,"preventDefault",void 0),(0,_.Z)(this,"stopPropagation",void 0),(0,_.Z)(this,"type",void 0),(0,_.Z)(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=e,this.timeStamp=Date.now()})),b=n(97326);function w(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return S(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return S(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function S(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var E=new WeakMap,C=function(){function t(){(0,h.Z)(this,t),E.set(this,{})}return(0,f.Z)(t,[{key:"addEventListener",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=E.get(this);r||(r={}),r[t]||(r[t]=[]),r[t].push(e),E.set(this,r),n.capture,n.once,n.passive}},{key:"removeEventListener",value:function(t,e){var n=E.get(this);if(n){var r=n[t];if(r&&r.length>0)for(var i=r.length;i--;i>0)if(r[i]===e){r.splice(i,1);break}}}},{key:"dispatchEvent",value:function(t){var e=E.get(this)[t.type];if(e){var n,r=w(e);try{for(r.s();!(n=r.n()).done;){(0,n.value)(t)}}catch(t){r.e(t)}finally{r.f()}}}}]),t}();function T(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,g.Z)(t);if(e){var i=(0,g.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,y.Z)(this,n)}}var A=function(t){(0,m.Z)(n,t);var e=T(n);function n(){var t;return(0,h.Z)(this,n),t=e.call(this),(0,_.Z)((0,b.Z)(t),"childNodes",void 0),t.childNodes=[],t}return(0,f.Z)(n,[{key:"appendChild",value:function(t){this.childNodes.push(t)}},{key:"cloneNode",value:function(){var t=Object.create(this);return Object.assign(t,this),t}},{key:"removeChild",value:function(t){var e=this.childNodes.findIndex((function(e){return e===t}));return e>-1?this.childNodes.splice(e,1):null}}]),n}(C);function M(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,g.Z)(t);if(e){var i=(0,g.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,y.Z)(this,n)}}var k,P,O,L,I=function(t){(0,m.Z)(n,t);var e=M(n);function n(){var t;return(0,h.Z)(this,n),t=e.call(this),(0,_.Z)((0,b.Z)(t),"className",void 0),(0,_.Z)((0,b.Z)(t),"children",void 0),t.className="",t.children=[],t}return(0,f.Z)(n,[{key:"setAttribute",value:function(t,e){this[t]=e}},{key:"getAttribute",value:function(t){return this[t]}},{key:"setAttributeNS",value:function(t,e){this[t]=e}},{key:"getAttributeNS",value:function(t){return this[t]}}]),n}(A);if("undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var R=my.getSystemInfoSync();k=R.screenWidth,P=R.screenHeight,O=R.windowWidth,L=R.windowHeight}else{var D=p.innerWidth,N=p.innerHeight;k=D,P=N,O=D,L=N}var Z={width:k,height:P,availWidth:O,availHeight:L,availLeft:0,availTop:0},z=Z.availWidth,F=Z.availHeight,B={style:[]};function j(t,e){var n,r;"parentNode"in t||(n=0===e?function(){return null}:1===e?function(){return B}:function(){return null},Object.defineProperty(t,"parentNode",{enumerable:!0,get:n}));"parentElement"in t||(r=0===e?function(){return null}:1===e?function(){return B}:function(){return null},Object.defineProperty(t,"parentElement",{enumerable:!0,get:r}))}function U(t){t.style=t.style||{},Object.assign(t.style,{top:"0px",left:"0px",width:z+"px",height:F+"px",margin:"0px",padding:"0px"})}function V(t){"clientLeft"in t||(t.clientLeft=0,t.clientTop=0),"clientWidth"in t||(t.clientWidth=z,t.clientHeight=F),"getBoundingClientRect"in t||(t.getBoundingClientRect=function(){return{x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight}})}function G(t){"offsetLeft"in t||(t.offsetLeft=0,t.offsetTop=0),"offsetWidth"in t||(t.offsetWidth=z,t.offsetHeight=F)}function H(t){"scrollLeft"in t||(t.scrollLeft=0,t.scrollTop=0),"scrollWidth"in t||(t.scrollWidth=z,t.scrollHeight=F)}function W(t){var e=function(){return!0};t.classList=[],t.classList.add=e,t.classList.remove=e,t.classList.contains=e,t.classList.toggle=e}function q(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,g.Z)(t);if(e){var i=(0,g.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,y.Z)(this,n)}}function X(){}var Y=function(t){(0,m.Z)(n,t);var e=q(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1?arguments[1]:void 0;return(0,h.Z)(this,n),t=e.call(this),(0,_.Z)((0,b.Z)(t),"className",void 0),(0,_.Z)((0,b.Z)(t),"children",void 0),(0,_.Z)((0,b.Z)(t),"focus",void 0),(0,_.Z)((0,b.Z)(t),"blur",void 0),(0,_.Z)((0,b.Z)(t),"insertBefore",void 0),(0,_.Z)((0,b.Z)(t),"appendChild",void 0),(0,_.Z)((0,b.Z)(t),"removeChild",void 0),(0,_.Z)((0,b.Z)(t),"remove",void 0),(0,_.Z)((0,b.Z)(t),"innerHTML",void 0),(0,_.Z)((0,b.Z)(t),"tagName",void 0),t.className="",t.children=[],t.focus=X,t.blur=X,t.insertBefore=X,t.appendChild=X,t.removeChild=X,t.remove=X,t.innerHTML="",t.tagName=r.toUpperCase(),j((0,b.Z)(t),i),U((0,b.Z)(t)),W((0,b.Z)(t)),V((0,b.Z)(t)),G((0,b.Z)(t)),H((0,b.Z)(t)),t}return(0,f.Z)(n)}(I);function K(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,g.Z)(t);if(e){var i=(0,g.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,y.Z)(this,n)}}var Q=function(t){(0,m.Z)(n,t);var e=K(n);function n(t){return(0,h.Z)(this,n),e.call(this,t)}return(0,f.Z)(n,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),n}(Y);function J(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,g.Z)(t);if(e){var i=(0,g.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,y.Z)(this,n)}}var $=function(t){(0,m.Z)(n,t);var e=J(n);function n(){return(0,h.Z)(this,n),e.call(this,"video")}return(0,f.Z)(n)}(Q),tt={};function et(){return tt}var nt=(0,f.Z)((function t(){(0,h.Z)(this,t);var e=et(),n=e.createImage&&e.createImage()||{};return"tagName"in n||(n.tagName="IMG",n.__proto__=t.prototype),j(n),W(n),Object.assign(n,{addEventListener:function(t,e){n["on".concat(t)]=e.bind(n)},removeEventListener:function(t){n["on".concat(t)]=null}}),n})),rt={href:"",protocol:"",host:""};function it(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,g.Z)(t);if(e){var i=(0,g.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,y.Z)(this,n)}}var ot=function(t){(0,m.Z)(n,t);var e=it(n);function n(){return(0,h.Z)(this,n),e.call(this,"body",0)}return(0,f.Z)(n,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e,n){}},{key:"dispatchEvent",value:function(t){}}]),n}(Y),at=function(t){(0,m.Z)(n,t);var e=it(n);function n(){return(0,h.Z)(this,n),e.call(this,"html",0)}return(0,f.Z)(n,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e){}},{key:"dispatchEvent",value:function(t){}}]),n}(Y),st={},ut={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:rt,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(t){return"canvas"===(t=t.toLowerCase())?my.createOffscreenCanvas(1024,128,"2d"):"img"===t?new nt:"video"===t?new $:new Y(t)},createElementNS:function(t,e){return this.createElement(e)},createTextNode:function(t){return t},getElementById:function(t){return null},getElementsByTagName:function(t){return t=t.toLowerCase(),[]},getElementsByTagNameNS:function(t,e){return this.getElementsByTagName(e)},getElementsByName:function(t){return[]},querySelector:function(t){return null},querySelectorAll:function(t){return[]},addEventListener:function(t,e,n){st[t]||(st[t]=[]),st[t].push(e)},removeEventListener:function(t,e){var n=st[t];if(n&&n.length>0)for(var r=n.length;r--;r>0)if(n[r]===e){n.splice(r,1);break}},dispatchEvent:function(t){var e=t.type,n=st[e];if(n)for(var r=0;r<n.length;r++)n[r](t);t.target&&"function"==typeof t.target["on"+e]&&t.target["on"+e](t)},createEvent:function(t){return new x(t)}};ut.documentElement=new at,ut.head=new Y("head"),ut.body=new ot;var lt,ct,pt,ht,ft=Object,dt=n(71002),vt=function(){function t(){(0,h.Z)(this,t),(0,_.Z)(this,"_w",void 0),(0,_.Z)(this,"_h",void 0),(0,_.Z)(this,"_data",void 0);var e=arguments.length;if(2===e){if("number"==typeof arguments[0]&&"number"==typeof arguments[1])return this._w=arguments[0],this._h=arguments[1],void(this._data=new Uint8ClampedArray(this._w*this._h*4))}else 3===e&&"object"===(0,dt.Z)(arguments[0])&&"number"==typeof arguments[1]&&"number"==typeof arguments[2]&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,f.Z)(t,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),t}();if("undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var mt=my.getSystemInfoSync();lt=mt.system,ct=mt.platform,pt=mt.language}else{var yt={versions:(ht=p.navigator.userAgent,{trident:ht.indexOf("Trident")>-1,presto:ht.indexOf("Presto")>-1,webKit:ht.indexOf("AppleWebKit")>-1,gecko:ht.indexOf("Gecko")>-1&&-1===ht.indexOf("KHTML"),mobile:!!ht.match(/AppleWebKit.*Mobile.*/),ios:!!ht.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:ht.indexOf("Android")>-1||ht.indexOf("Linux")>-1,iPhone:ht.indexOf("iPhone")>-1,iPad:ht.indexOf("iPad")>-1,webApp:-1===ht.indexOf("Safari"),weixin:ht.indexOf("MicroMessenger")>-1,qq:" qq"===ht.match(/\sQQ/i)}),language:(p.navigator.browserLanguage||p.navigator.language).toLowerCase()};yt.versions.android?ct="android":yt.versions.trident?ct="IE":yt.versions.presto?ct="Opera":yt.versions.webKit?ct="webKit":yt.versions.gecko?ct="Firefox":yt.versions.mobile?ct="mobile":yt.versions.ios?ct="ios":yt.versions.iPhone?ct="iPhone":yt.versions.iPad?ct="ipad":yt.versions.webApp?ct="webApp":yt.versions.weixin?ct="weixin":yt.versions.qq&&(ct="qq"),lt=p.navigator.userAgent,pt=yt.language}var gt=-1!==lt.toLowerCase().indexOf("android")?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",_t="Mozilla/5.0 (".concat(gt,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(pt),xt={platform:ct,language:pt,appVersion:"5.0 (".concat(gt,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:_t},bt=0;var wt=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";(0,h.Z)(this,t),(0,_.Z)(this,"href",void 0),0!=e.indexOf("http://")&&0!=e.indexOf("https://")?this.href=n+e:this.href=e}return(0,f.Z)(t,null,[{key:"createObjectURL",value:function(t){var e=t.buffers[0],n=t.type,r=function(t){for(var e="",n=new Uint8Array(t),r=n.byteLength,i=0;i<r;i++)e+=String.fromCharCode(n[i]);return c(e)}(e);return"data:".concat(n,";base64, ")+r}}]),t}();function St(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,g.Z)(t);if(e){var i=(0,g.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,y.Z)(this,n)}}var Et=new Map,Ct=new Map,Tt=new Map;var At=function(t){(0,m.Z)(n,t);var e=St(n);function n(){var t;return(0,h.Z)(this,n),t=e.call(this),(0,_.Z)((0,b.Z)(t),"onabort",void 0),(0,_.Z)((0,b.Z)(t),"onerror",void 0),(0,_.Z)((0,b.Z)(t),"onload",void 0),(0,_.Z)((0,b.Z)(t),"onloadstart",void 0),(0,_.Z)((0,b.Z)(t),"onprogress",void 0),(0,_.Z)((0,b.Z)(t),"ontimeout",void 0),(0,_.Z)((0,b.Z)(t),"onloadend",void 0),(0,_.Z)((0,b.Z)(t),"onreadystatechange",void 0),(0,_.Z)((0,b.Z)(t),"readyState",void 0),(0,_.Z)((0,b.Z)(t),"response",void 0),(0,_.Z)((0,b.Z)(t),"responseText",void 0),(0,_.Z)((0,b.Z)(t),"_responseType",void 0),(0,_.Z)((0,b.Z)(t),"responseXML",void 0),(0,_.Z)((0,b.Z)(t),"status",void 0),(0,_.Z)((0,b.Z)(t),"statusText",void 0),(0,_.Z)((0,b.Z)(t),"upload",void 0),(0,_.Z)((0,b.Z)(t),"withCredentials",void 0),(0,_.Z)((0,b.Z)(t),"timeout",void 0),(0,_.Z)((0,b.Z)(t),"_url",void 0),(0,_.Z)((0,b.Z)(t),"_method",void 0),t.onabort=null,t.onerror=null,t.onload=null,t.onloadstart=null,t.onprogress=null,t.ontimeout=null,t.onloadend=null,t.onreadystatechange=null,t.readyState=0,t.response=null,t.responseText=null,t._responseType="text",t.responseXML=null,t.status=0,t.statusText="",t.upload={},t.withCredentials=!1,Et.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),t}return(0,f.Z)(n,[{key:"responseType",set:function(t){this._responseType=t}},{key:"abort",value:function(){var t=Tt.get("requestTask");t&&t.abort()}},{key:"getAllResponseHeaders",value:function(){var t=Ct.get("responseHeader");return Object.keys(t).map((function(e){return"".concat(e,": ").concat(t[e])})).join("\n")}},{key:"getResponseHeader",value:function(t){return Ct.get("responseHeader")[t]}},{key:"open",value:function(t,e,n){this._method=t,this._url=e}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){}},{key:"setRequestHeader",value:function(t,e){var n=Et.get("requestHeader");n[t]=e,Et.set("requestHeader",n)}},{key:"addEventListener",value:function(t,e){var n=this;"function"==typeof e&&(this["on"+t]=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.target=t.target||n,e.call(n,t)})}},{key:"removeEventListener",value:function(t,e){this["on"+t]===e&&(this["on"+t]=null)}}]),n}(C);function Mt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,g.Z)(t);if(e){var i=(0,g.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,y.Z)(this,n)}}(0,_.Z)(At,"UNSEND",void 0),(0,_.Z)(At,"OPENED",void 0),(0,_.Z)(At,"HEADERS_RECEIVED",void 0),(0,_.Z)(At,"LOADING",void 0),(0,_.Z)(At,"DONE",void 0),At.UNSEND=0,At.OPENED=1,At.HEADERS_RECEIVED=2,At.LOADING=3,At.DONE=4;var kt=function(t){(0,m.Z)(n,t);var e=Mt(n);function n(t){var r;return(0,h.Z)(this,n),r=e.call(this,t),(0,_.Z)((0,b.Z)(r),"touches",void 0),(0,_.Z)((0,b.Z)(r),"targetTouches",void 0),(0,_.Z)((0,b.Z)(r),"changedTouches",void 0),r.touches=[],r.targetTouches=[],r.changedTouches=[],r.target=et(),r.currentTarget=et(),r}return(0,f.Z)(n)}(x);function Pt(t){var e=t||{},n=e.x,r=void 0===n?0:n,i=e.y,o=void 0===i?0:i,a=e.clientX,s=void 0===a?0:a,u=e.clientY,l=void 0===u?0:u;-1!==Object.keys(t).indexOf("x")?(t.pageX=t.clientX=r,t.pageY=t.clientY=o):(t.x=s,t.y=l)}function Ot(t){return function(e){var n=new kt(t);n.changedTouches=e.changedTouches,n.touches=e.touches,n.targetTouches=Array.prototype.slice.call(e.touches),n.timeStamp=e.timeStamp,n.changedTouches.forEach((function(t){return Pt(t)})),n.touches.forEach((function(t){return Pt(t)})),n.targetTouches.forEach((function(t){return Pt(t)})),ut.dispatchEvent(n)}}var Lt,It=Ot("touchstart"),Rt=Ot("touchmove"),Dt=Ot("touchend"),Nt=(Lt="mapCameaParams",function(t){t.type=Lt,ut.dispatchEvent(t)});function Zt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,g.Z)(t);if(e){var i=(0,g.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,y.Z)(this,n)}}var zt=function(t){(0,m.Z)(n,t);var e=Zt(n);function n(t){var r;return(0,h.Z)(this,n),r=e.call(this,t),(0,_.Z)((0,b.Z)(r),"buttons",void 0),(0,_.Z)((0,b.Z)(r),"which",void 0),(0,_.Z)((0,b.Z)(r),"pointerId",void 0),(0,_.Z)((0,b.Z)(r),"bubbles",void 0),(0,_.Z)((0,b.Z)(r),"button",void 0),(0,_.Z)((0,b.Z)(r),"width",void 0),(0,_.Z)((0,b.Z)(r),"height",void 0),(0,_.Z)((0,b.Z)(r),"pressure",void 0),(0,_.Z)((0,b.Z)(r),"isPrimary",void 0),(0,_.Z)((0,b.Z)(r),"pointerType",void 0),(0,_.Z)((0,b.Z)(r),"altKey",void 0),(0,_.Z)((0,b.Z)(r),"ctrlKey",void 0),(0,_.Z)((0,b.Z)(r),"metaKey",void 0),(0,_.Z)((0,b.Z)(r),"shiftKey",void 0),r.target=et(),r.currentTarget=et(),r}return(0,f.Z)(n)}(x),Ft=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],Bt=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0];function jt(t,e,n){for(var r=new zt(t),i=0;i<Ft.length;i++){var o=Ft[i];r[o]=e[o]||Bt[i]}return r.type=t,r.target=et(),r.currentTarget=et(),r.buttons=function(t){var e=0;"touchstart"!==t&&"touchmove"!==t&&"pointerdown"!==t&&"pointermove"!==t||(e=1);return e}(t),r.which=r.buttons,r.pointerId=(e.identifier||0)+2,r.bubbles=!0,r.cancelable=!0,r.button=0,r.width=2*(e.radiusX||.5),r.height=2*(e.radiusY||.5),r.pressure=e.force||.5,r.isPrimary=function(t){return Ut===t.identifier}(e),r.pointerType="touch",r.altKey=n.altKey,r.ctrlKey=n.ctrlKey,r.metaKey=n.metaKey,r.shiftKey=n.shiftKey,n.preventDefault&&(r.preventDefault=function(){n.preventDefault()}),r}var Ut=null;function Vt(t){null===Ut&&(Ut=t.identifier)}function Gt(t){Ut===t.identifier&&(Ut=null)}function Ht(t){return function(e){for(var n=e.changedTouches,r=0;r<n.length;r++){var i=n[r];0===r&&"pointerdown"===t?Vt(i):"pointerup"!==t&&"pointercancel"!==t||Gt(i);var o=jt(t,i,e);ut.dispatchEvent(o)}}}var Wt=Ht("pointerdown"),qt=Ht("pointermove"),Xt=Ht("pointerup");function Yt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,g.Z)(t);if(e){var i=(0,g.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,y.Z)(this,n)}}!function(t){(0,m.Z)(n,t);var e=Yt(n);function n(t){return(0,h.Z)(this,n),e.call(this,t)}(0,f.Z)(n)}(x);function Kt(t){return function(e){e.type=t,ut.dispatchEvent(e)}}var Qt=Kt("mousedown"),Jt=Kt("mousemove"),$t=Kt("mouseup"),te="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,ee="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram),ne=te||ee,re={atob:function(t){var e=String(t).replace(/=+$/,"");if(e.length%4==1)throw new l("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,r,i="",o=0,a=0;r=e.charAt(a++);~r&&(n=o%4?64*n+r:r,o++%4)?i+=String.fromCharCode(255&n>>(-2*o&6)):0)r=u.indexOf(r);return i},btoa:c,devicePixelRatio:v,Blob:d,document:ut,Element:I,Event:x,EventTarget:C,HTMLCanvasElement:ft,HTMLElement:Y,HTMLMediaElement:Q,HTMLVideoElement:$,Image:nt,ImageData:vt,navigator:xt,Node:A,requestAnimationFrame:function(t){var e=et();return e.requestAnimationFrame?e.requestAnimationFrame(t):function(t){var e=Date.now(),n=Math.max(bt+23,e);return setTimeout((function(){t(bt=n)}),n-e)}(t)},cancelAnimationFrame:function(t){var e=et();return e.cancelAnimationFrame?e.cancelAnimationFrame(t):clearTimeout(t)},screen:Z,XMLHttpRequest:At,performance:{mark:function(t){return null},clearMeasures:function(t){return null},clearMarks:function(t){return null},measure:function(t,e,n){return{duration:0}},now:function(){}},URL:wt,WebGLRenderingContext:{GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:0x10000000000000000,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},WebGL2RenderingContext:{},addEventListener:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};ut.addEventListener(t,e,n)},removeEventListener:function(t,e,n){ut.removeEventListener(t,e)},dispatchEvent:function(t){ut.dispatchEvent(t)},innerWidth:Z.availWidth,innerHeight:Z.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},ie=ne?re:p,oe=ne?At:p.XMLHttpRequest,ae=ne?rt:p.location,se=n(25108);function ue(t){var e=t;return"string"==typeof t&&(e=ie.document.getElementById(t)),e}function le(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function ce(t){return le(t).split(/\s+/)}function pe(t,e,n){var r=ie.document.createElement(t);return r.className=e||"",n&&n.appendChild(r),r}function he(t){var e=t.parentNode;e&&e.removeChild(t)}function fe(t,e){if(void 0!==t.classList)for(var n=ce(e),r=0,i=n.length;r<i;r++)t.classList.add(n[r]);else if(!ve(t,e)){var o=ye(t);me(t,(o?o+" ":"")+e)}}function de(t,e){void 0!==t.classList?t.classList.remove(e):me(t,le((" "+ye(t)+" ").replace(" "+e+" "," ")))}function ve(t,e){if(void 0!==t.classList)return t.classList.contains(e);var n=ye(t);return n.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(n)}function me(t,e){t instanceof HTMLElement?t.className=e:t.className.baseVal=e}function ye(t){return t instanceof SVGElement&&(t=t.correspondingElement),void 0===t.className.baseVal?t.className:t.className.baseVal}function ge(t){for(;t&&t.firstChild;)t.removeChild(t.firstChild)}var _e=function(t){var e,n,r=null==ie||null===(e=ie.document)||void 0===e||null===(n=e.documentElement)||void 0===n?void 0:n.style;if(!r)return t[0];for(var i in t)if(t[i]&&t[i]in r)return t[i];return t[0]}(["transform","WebkitTransform"]);function xe(t,e){t.style[_e]=e}function be(){if("function"==typeof Event)ie.dispatchEvent(new Event("resize"));else{var t=ie.document.createEvent("UIEvents");t.initUIEvent("resize",!0,!1,ie,0),ie.dispatchEvent(t)}}function we(t){var e=["padding: "+(t.height/2-8)+"px "+t.width/2+"px;","line-height: "+t.height+"px;","background-image: url("+t.toDataURL()+");"];se.log("%c\n",e.join(""))}function Se(){var t,e=ie.document.querySelector('meta[name="viewport"]');if(!e)return 1;var n=(null===(t=e.content)||void 0===t?void 0:t.split(",")).find((function(t){var e=t.split("="),n=(0,s.Z)(e,2),r=n[0];n[1];return"initial-scale"===r}));return n?1*n.split("=")[1]:1}var Ee=Se()<1?1:ie.devicePixelRatio;function Ce(t){if(0===t.length)throw new Error("max requires at least one data point");for(var e=t[0],n=1;n<t.length;n++)t[n]>e&&(e=t[n]);return 1*e}function Te(t){if(0===t.length)throw new Error("min requires at least one data point");for(var e=t[0],n=1;n<t.length;n++)t[n]<e&&(e=t[n]);return 1*e}function Ae(t){if(0===t.length)return 0;for(var e=1*t[0],n=1;n<t.length;n++)e+=1*t[n];return e}function Me(t){if(0===t.length)throw new Error("mean requires at least one data point");return Ae(t)/t.length}function ke(t){if(0===t.length)throw new Error("mean requires at least one data point");if(t.length<3)return t[0];t.sort();for(var e=t[0],n=NaN,r=0,i=1,o=1;o<t.length+1;o++)t[o]!==e?(i>r&&(r=i,n=e),i=1,e=t[o]):i++;return 1*n}var Pe={min:Te,max:Ce,mean:Me,sum:Ae,mode:ke};function Oe(t,e){return t.map((function(t){return t[e]}))}function Le(t,e){return Pe[t](e)}var Ie=n(89611);var Re=n(5647);function De(t){var e="function"==typeof Map?new Map:void 0;return De=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return(0,Re.Z)(t,arguments,(0,g.Z)(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),(0,Ie.Z)(r,t)},De(t)}function Ne(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,g.Z)(t);if(e){var i=(0,g.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,y.Z)(this,n)}}var Ze=function(t){(0,m.Z)(n,t);var e=Ne(n);function n(t,r,i){var o;return(0,h.Z)(this,n),o=e.call(this,t),(0,_.Z)((0,b.Z)(o),"status",void 0),(0,_.Z)((0,b.Z)(o),"url",void 0),o.status=r,o.url=i,o.name=o.constructor.name,o.message=t,o}return(0,f.Z)(n,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),n}(De(Error));function ze(t){var e=new oe;for(var n in e.open("GET",t.url,!0),t.headers)t.headers.hasOwnProperty(n)&&e.setRequestHeader(n,t.headers[n]);return e.withCredentials="include"===t.credentials,e}var Fe=function(t,e){var n=ze(t);return n.setRequestHeader("Accept","application/json"),n.onerror=function(){e(new Error(n.statusText))},n.onload=function(){if(n.status>=200&&n.status<300&&n.response){var r;try{r=JSON.parse(n.response)}catch(t){return e(t)}e(null,r)}else 401===n.status?e(new Ze("".concat(n.statusText),n.status,t.url)):e(new Ze(n.statusText,n.status,t.url))},n.send(),n},Be=function(t,e){var n=ze(t);return n.responseType="arraybuffer",n.onerror=function(){e(new Error(n.statusText))},n.onload=function(){var r=n.response;if(0===r.byteLength&&200===n.status)return e(new Error("http status 200 returned without content."));n.status>=200&&n.status<300&&n.response?e(null,{data:r,cacheControl:n.getResponseHeader("Cache-Control"),expires:n.getResponseHeader("Expires")}):e(new Ze(n.statusText,n.status,t.url))},n.send(),n};var je=function(t,e){return Be(t,(function(t,n){if(t)e(t);else if(n){var r=new ie.Image;r.crossOrigin="anonymous";var i=ie.URL||ie.webkitURL;r.onload=function(){e(null,r),i.revokeObjectURL(r.src),r.onload=null},r.onerror=function(){return e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var o=new ie.Blob([new Uint8Array(n.data)],{type:"image/png"});r.src=n.data.byteLength?i.createObjectURL(o):"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII="}}))},Ue=n(1449),Ve=2*Math.PI*6378137/2;function Ge(t){var e=[1/0,1/0,-1/0,-1/0];return t.forEach((function(t){var n=t.coordinates;He(e,n)})),e}function He(t,e){return Array.isArray(e[0])?e.forEach((function(e){He(t,e)})):(t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])),t}function We(t,e){return qe(t,e)}function qe(t,e){return Array.isArray(t[0])?t.map((function(t){return qe(t,e)})):e(t)}function Xe(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{enable:!0,decimal:1},r=(t=Je(t,e))[0],i=t[1],o=r*Ve/180,a=Math.log(Math.tan((90+i)*Math.PI/360))/(Math.PI/180);return a=a*Ve/180,n.enable&&(o=Number(o.toFixed(n.decimal)),a=Number(a.toFixed(n.decimal))),3===t.length?[o,a,t[2]]:[o,a]}function Ye(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,n=t[0],r=t[1],i=n/Ve*180,o=r/Ve*180;return o=180/Math.PI*(2*Math.atan(Math.exp(o*Math.PI/180))-Math.PI/2),null!=e&&(i=Number(i.toFixed(e)),o=Number(o.toFixed(e))),3===t.length?[i,o,t[2]]:[i,o]}function Ke(t){if(null==t)throw new Error("lng is required");return(t>180||t<-180)&&((t%=360)>180&&(t=-360+t),t<-180&&(t=360+t),0===t&&(t=0)),t}function Qe(t){if(null==t)throw new Error("lat is required");return(t>90||t<-90)&&((t%=180)>90&&(t=-180+t),t<-90&&(t=180+t),0===t&&(t=0)),t}function Je(t,e){if(!1===e)return t;var n=Ke(t[0]),r=Qe(t[1]);return r>85&&(r=85),r<-85&&(r=-85),3===t.length?[n,r,t[2]]:[n,r]}function $e(t){var e=85.0511287798,n=Math.max(Math.min(e,t[1]),-e),r=256<<20,i=Math.PI/180,o=t[0]*i,a=n*i;a=Math.log(Math.tan(Math.PI/4+a/2));return o=r*(.5/Math.PI*o+.5),a=r*(-.5/Math.PI*a+(i=.5)),[Math.floor(o),Math.floor(a)]}function tn(t){var e=.5/Math.PI,n=-.5/Math.PI,r=.5,i=256<<20,o=(0,s.Z)(t,2),a=o[0],u=o[1];return a=(a/i-.5)/e,u=(u/i-r)/n,u=2*(Math.atan(Math.pow(Math.E,u))-Math.PI/4),[a/(r=Math.PI/180),u/r]}function en(t,e){var n=85.0511287798,r=Math.PI/180,i=6378137;return e=Math.max(Math.min(n,e),-n),e*=r,[(t*=r)*i,(e=Math.log(Math.tan(Math.PI/4+e/2)))*i]}function nn(t,e,n){var r=(0,Ue.Ht)(e[1]-t[1]),i=(0,Ue.Ht)(e[0]-t[0]),o=(0,Ue.Ht)(t[1]),a=(0,Ue.Ht)(e[1]),s=Math.pow(Math.sin(r/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(o)*Math.cos(a);return(0,Ue.DL)(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)),"meters")}function rn(t){var e=Math.PI/180,n=85.0511287798,r=6378137,i=Math.max(Math.min(n,t[1]),-n),o=Math.sin(i*e);return[r*t[0]*e,r*Math.log((1+o)/(1-o))/2]}function on(t,e){var n=Math.abs(t[1][1]-t[0][1])*e,r=Math.abs(t[1][0]-t[0][0])*e;return[[t[0][0]-r,t[0][1]-n],[t[1][0]+r,t[1][1]+n]]}function an(t,e){return t[0][0]<=e[0][0]&&t[0][1]<=e[0][1]&&t[1][0]>=e[1][0]&&t[1][1]>=e[1][1]}function sn(t){return[[t[0],t[1]],[t[2],t[3]]]}function un(t){var e=ln(t,[0,0]);return[t[0]/e,t[1]/e]}function ln(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}function cn(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function pn(t,e){return 180*Math.acos(function(t,e){return t[0]*e[0]+t[1]*e[1]}(t,e)/(cn(t)*cn(e)))/Math.PI}function hn(t,e){return e[0]>0?e[1]>0?90-180*Math.atan(e[1]/e[0])/Math.PI:90+180*Math.atan(-e[1]/e[0])/Math.PI:e[1]<0?90-180*Math.atan(e[1]/e[0])/Math.PI+180:270+180*Math.atan(e[1]/-e[0])/Math.PI}function fn(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;if(t&&!(t.length<2)){for(var n=0,r=[],i=0;i<t.length-1;i++){var o=t[i],a=t[i+1],s=ln(o,a);n+=s;var u=[o[0]-a[0],o[1]-a[1]],l=hn(0,u);if(i>0){var c=r[i-1].rotation;c-l>360-c+l&&(l+=360)}r.push({start:o,end:a,dis:s,rotation:l,duration:0})}return r.map((function(t){t.duration=e*(t.dis/n)})),r}}var dn=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,n=arguments.length>1?arguments[1]:void 0;(0,h.Z)(this,t),(0,_.Z)(this,"limit",void 0),(0,_.Z)(this,"cache",void 0),(0,_.Z)(this,"destroy",void 0),(0,_.Z)(this,"order",void 0),this.limit=e,this.destroy=n||this.defaultDestroy,this.order=[],this.clear()}return(0,f.Z)(t,[{key:"clear",value:function(){var t=this;this.order.forEach((function(e){t.delete(e)})),this.cache={},this.order=[]}},{key:"get",value:function(t){var e=this.cache[t];return e&&(this.deleteOrder(t),this.appendOrder(t)),e}},{key:"set",value:function(t,e){this.cache[t]?(this.delete(t),this.cache[t]=e,this.appendOrder(t)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[t]=e,this.appendOrder(t))}},{key:"delete",value:function(t){var e=this.cache[t];e&&(this.deleteCache(t),this.deleteOrder(t),this.destroy(e,t))}},{key:"deleteCache",value:function(t){delete this.cache[t]}},{key:"deleteOrder",value:function(t){var e=this.order.findIndex((function(e){return e===t}));e>=0&&this.order.splice(e,1)}},{key:"appendOrder",value:function(t){this.order.push(t)}},{key:"defaultDestroy",value:function(t,e){return null}}]),t}();function vn(t,e){t.forEach((function(t){e[t]&&(e[t]=e[t].bind(e))}))}var mn,yn=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16;(0,h.Z)(this,t),(0,_.Z)(this,"duration",16),(0,_.Z)(this,"timestamp",(new Date).getTime()),this.duration=e}return(0,f.Z)(t,[{key:"run",value:function(t){var e=(new Date).getTime(),n=e-this.timestamp;this.timestamp=e,n>=this.duration&&t()}}]),t}(),gn=n(2650);function _n(t){return"string"==typeof t&&!!gn.ZP(t)}function xn(t){var e=gn.ZP(t),n=[0,0,0,0];return null!=e&&(n[0]=e.r/255,n[1]=e.g/255,n[2]=e.b/255,n[3]=e.opacity),n}function bn(t){return(t&&t[0])+256*(t&&t[1])+65536*(t&&t[2])-1}function wn(t){return[t+1&255,t+1>>8&255,t+1>>8>>8&255]}function Sn(t){var e=ie.document.createElement("canvas"),n=e.getContext("2d");e.width=256,e.height=1;for(var r=n.createLinearGradient(0,0,256,1),i=null,o=t.positions[0],a=t.positions[t.positions.length-1],s=0;s<t.colors.length;++s){var u=(t.positions[s]-o)/(a-o);r.addColorStop(u,t.colors[s])}if(n.fillStyle=r,n.fillRect(0,0,256,1),ne)return{data:i=new Uint8ClampedArray(n.getImageData(0,0,256,1).data),width:256,height:1};i=n.getImageData(0,0,256,1).data;for(var l=n.createImageData(256,1),c=0;c<l.data.length;c+=4)l.data[c+0]=i[c+0],l.data[c+1]=i[c+1],l.data[c+2]=i[c+2],l.data[c+3]=i[c+3];return l}!function(t){t.CENTER="center",t.TOP="top",t["TOP-LEFT"]="top-left",t["TOP-RIGHT"]="top-right",t.BOTTOM="bottom",t["BOTTOM-LEFT"]="bottom-left",t.LEFT="left",t.RIGHT="right"}(mn||(mn={}));var En={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Cn(t,e,n){var r=t.classList;for(var i in En)En.hasOwnProperty(i)&&r.remove("l7-".concat(n,"-anchor-").concat(i));r.add("l7-".concat(n,"-anchor-").concat(e))}function Tn(t,e){return{enable:t,mask:255,func:{cmp:514,ref:e?1:0,mask:255}}}var An,Mn,kn=1029,Pn=1028;function On(t){switch(t){case"GAODE1.x":case"GAODE2.x":case"GLOBEL":return kn;default:return Pn}}function Ln(t){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(t)}function In(t,e){if(!t||!t.length)throw new Error("url is not allowed to be empty");var n=e.x,r=e.y,i=e.z;Array.isArray(t)&&(t=t[Math.abs(n+r)%t.length]);return t.replace(/\{x\}/g,n.toString()).replace(/\{y\}/g,r.toString()).replace(/\{z\}/g,i.toString()).replace(/\{-y\}/g,(Math.pow(2,i)-r-1).toString())}!function(t){t.Overlap="overlap",t.Replace="replace"}(An||(An={})),function(t){t.Loading="Loading",t.Loaded="Loaded",t.Failure="Failure",t.Cancelled="Cancelled"}(Mn||(Mn={}));var Rn=n(15861),Dn=n(87757),Nn=n.n(Dn);var Zn;function zn(t){for(;t;){if(t.isLoaded)return t.properties.state|=2,!0;t=t.parent}return!1}function Fn(t){t.children.forEach((function(t){t.isLoaded?t.properties.state|=2:Fn(t)}))}var Bn=[-1/0,-1/0,1/0,1/0],jn=(Zn={},(0,_.Z)(Zn,An.Overlap,(function(t){t.forEach((function(t){t.properties.state=0})),t.forEach((function(t){t.isCurrent&&!zn(t)&&Fn(t)})),t.forEach((function(t){t.isVisible=Boolean(2&t.properties.state)}))})),(0,_.Z)(Zn,An.Replace,(function(t){t.forEach((function(t){t.properties.state=0})),t.forEach((function(t){t.isCurrent&&zn(t)})),t.slice().sort((function(t,e){return t.z-e.z})).forEach((function(t){t.isVisible=Boolean(2&t.properties.state),t.children.length&&(t.isVisible||1&t.properties.state)?t.children.forEach((function(t){t.properties.state=1})):t.isCurrent&&Fn(t)}))})),Zn),Un=function(){};function Vn(t,e,n){return[Math.floor((t+180)/360*Math.pow(2,n)),Math.floor((1-Math.log(Math.tan(e*Math.PI/180)+1/Math.cos(e*Math.PI/180))/Math.PI)/2*Math.pow(2,n))]}function Gn(t,e,n){var r=t/Math.pow(2,n)*360-180,i=Math.PI-2*Math.PI*e/Math.pow(2,n);return[r,180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)))]}var Hn=function(t,e,n){var r=Math.pow(2,n),i=t;return i<0?i+=r:i>r-1&&(i%=r),{warpX:i,warpY:e}},Wn=function(){function t(e){(0,h.Z)(this,t),(0,_.Z)(this,"x",void 0),(0,_.Z)(this,"y",void 0),(0,_.Z)(this,"z",void 0),(0,_.Z)(this,"tileSize",256),(0,_.Z)(this,"isVisible",!1),(0,_.Z)(this,"isCurrent",!1),(0,_.Z)(this,"layer",null),(0,_.Z)(this,"layers",[]),(0,_.Z)(this,"parent",null),(0,_.Z)(this,"children",[]),(0,_.Z)(this,"data",null),(0,_.Z)(this,"properties",{}),(0,_.Z)(this,"loadStatus",void 0),(0,_.Z)(this,"abortController",void 0),(0,_.Z)(this,"loadDataId",0);var n=e.x,r=e.y,i=e.z,o=e.tileSize;this.x=n,this.y=r,this.z=i,this.tileSize=o}var e;return(0,f.Z)(t,[{key:"isLoading",get:function(){return this.loadStatus===Mn.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===Mn.Loaded}},{key:"isCancelled",get:function(){return this.loadStatus===Mn.Cancelled}},{key:"isDone",get:function(){return[Mn.Loaded,Mn.Cancelled,Mn.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return t=this.x,e=this.y,n=this.z,r=Gn(t,e,n),i=(0,s.Z)(r,2),o=i[0],a=i[1],u=Gn(t+1,e+1,n),l=(0,s.Z)(u,2),c=l[0],[o,l[1],c,a];var t,e,n,r,i,o,a,u,l,c}},{key:"bboxPolygon",get:function(){var t=(0,s.Z)(this.bounds,4),e=t[0],n=t[1],r=[(t[2]-e)/2,(t[3]-n)/2];return function(t,e){void 0===e&&(e={});var n=Number(t[0]),r=Number(t[1]),i=Number(t[2]),o=Number(t[3]);if(6===t.length)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var a=[n,r],s=[n,o],u=[i,o],l=[i,r];return(0,Ue.yu)([[a,l,u,s,a]],e.properties,{bbox:t,id:e.id})}(this.bounds,{properties:{key:this.key,bbox:this.bounds,center:r,meta:"\n      ".concat(this.key,"\n      ")}})}},{key:"key",get:function(){return"".concat(this.x,",").concat(this.y,",").concat(this.z)}},{key:"loadData",value:(e=(0,Rn.Z)(Nn().mark((function t(e){var n,r,i,o,a,s,u,l,c,p,h,f,d,v,m,y;return Nn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.getData,r=e.onLoad,i=e.onError,this.loadDataId++,o=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=Mn.Loading,a=null,t.prev=7,u=this.x,l=this.y,c=this.z,p=this.bounds,h=this.tileSize,f=Hn(u,l,c),d=f.warpX,v=f.warpY,m=this.abortController.signal,y={x:d,y:v,z:c,bounds:p,tileSize:h,signal:m},t.next=14,n(y);case 14:a=t.sent,t.next=20;break;case 17:t.prev=17,t.t0=t.catch(7),s=t.t0;case 20:if(o===this.loadDataId){t.next=22;break}return t.abrupt("return");case 22:if(!this.isCancelled||a){t.next=24;break}return t.abrupt("return");case 24:if(!s&&a){t.next=28;break}return this.loadStatus=Mn.Failure,i(s,this),t.abrupt("return");case 28:this.loadStatus=Mn.Loaded,this.data=a,r(this);case 31:case"end":return t.stop()}}),t,this,[[7,17]])}))),function(t){return e.apply(this,arguments)})},{key:"reloadData",value:function(t){this.isLoading&&this.abortLoad(),this.loadData(t)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=Mn.Cancelled,this.abortController.abort())}}]),t}(),qn=n(26729);function Xn(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return Yn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Yn(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Yn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Kn(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Qn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Kn(Object(n),!0).forEach((function(e){(0,_.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Kn(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Jn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,g.Z)(t);if(e){var i=(0,g.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,y.Z)(this,n)}}var $n=function(t){(0,m.Z)(n,t);var e=Jn(n);function n(t){var r;return(0,h.Z)(this,n),r=e.call(this),(0,_.Z)((0,b.Z)(r),"currentTiles",[]),(0,_.Z)((0,b.Z)(r),"options",void 0),(0,_.Z)((0,b.Z)(r),"cacheTiles",new Map),(0,_.Z)((0,b.Z)(r),"lastViewStates",void 0),(0,_.Z)((0,b.Z)(r),"onTileLoad",(function(t){r.emit("tile-loaded",t),r.updateTileVisible()})),(0,_.Z)((0,b.Z)(r),"onTileError",(function(t,e){r.emit("tile-error",{error:t,tile:e}),r.updateTileVisible()})),(0,_.Z)((0,b.Z)(r),"onTileUnload",(function(t){r.emit("tile-unload",t)})),r.options={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,extent:Bn,getTileData:Un,updateStrategy:An.Overlap},r.updateOptions(t),r}return(0,f.Z)(n,[{key:"isLoaded",get:function(){return this.currentTiles.every((function(t){return t.isDone}))}},{key:"tiles",get:function(){return Array.from(this.cacheTiles.values()).sort((function(t,e){return t.z-e.z}))}},{key:"updateOptions",value:function(t){var e=void 0===t.minZoom?this.options.minZoom:Math.ceil(t.minZoom),n=void 0===t.maxZoom?this.options.maxZoom:Math.floor(t.maxZoom);this.options=Qn(Qn(Qn({},this.options),t),{},{minZoom:e,maxZoom:n})}},{key:"update",value:function(t,e){var n=this;if(!this.lastViewStates||this.lastViewStates.zoom!==t||this.lastViewStates.latLonBounds.toString()!==e.toString()){this.lastViewStates={zoom:t,latLonBounds:e};var r=!1,i=this.getTileIndices(t,e);this.currentTiles=i.map((function(t){var e=t.x,i=t.y,o=t.z,a=n.getTile(e,i,o);return a||(a=n.createTile(e,i,o),r=!0,a)})),r&&(this.resizeCacheTiles(),this.rebuildTileTree()),this.updateTileVisible()}}},{key:"reloadAll",value:function(){var t,e=Xn(this.cacheTiles);try{for(e.s();!(t=e.n()).done;){var n=(0,s.Z)(t.value,2),r=n[0],i=n[1];this.currentTiles.includes(i)||(this.cacheTiles.delete(r),this.onTileUnload(i)),this.onTileUnload(i),i.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(t){e.e(t)}finally{e.f()}}},{key:"destroy",value:function(){var t,e=Xn(this.cacheTiles.values());try{for(e.s();!(t=e.n()).done;){var n=t.value;n.isLoading&&n.abortLoad()}}catch(t){e.e(t)}finally{e.f()}this.cacheTiles.clear(),this.currentTiles=[],this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var t,e=this.options.updateStrategy,n=new Map,r=Xn(this.cacheTiles.values());try{for(r.s();!(t=r.n()).done;){var i=t.value;n.set(i.key,i.isVisible),i.isCurrent=!1,i.isVisible=!1}}catch(t){r.e(t)}finally{r.f()}var o,a=Xn(this.currentTiles);try{for(a.s();!(o=a.n()).done;){var s=o.value;s.isCurrent=!0,s.isVisible=!0}}catch(t){a.e(t)}finally{a.f()}var u=Array.from(this.cacheTiles.values());"function"==typeof e?e(u):jn[e](u);var l=Array.from(this.cacheTiles.values()).some((function(t){return t.isVisible!==n.get(t.key)}));l&&this.emit("tile-update")}},{key:"getTileIndices",value:function(t,e){var n=this.options,r=n.tileSize,i=n.extent,o=n.zoomOffset,a=function(t){var e=t.zoom,n=t.latLonBounds,r=t.maxZoom,i=void 0===r?1/0:r,o=t.minZoom,a=void 0===o?0:o,u=t.zoomOffset,l=void 0===u?0:u,c=t.extent,p=void 0===c?Bn:c,h=Math.ceil(e)+l;h<a?h=a:h>i&&(h=i);for(var f=(0,s.Z)(n,4),d=f[0],v=f[1],m=f[2],y=f[3],g=[Math.max(d,p[0]),Math.max(v,p[1]),Math.min(m,p[2]),Math.min(y,p[3])],_=[],x=Vn(g[0],g[1],h),b=(0,s.Z)(x,2),w=b[0],S=b[1],E=Vn(g[2],g[3],h),C=(0,s.Z)(E,2),T=C[0],A=C[1],M=w;M<=T;M++)for(var k=A;k<=S;k++)_.push({x:M,y:k,z:h});return _}({maxZoom:Math.floor(this.options.maxZoom),minZoom:Math.ceil(this.options.minZoom),zoomOffset:o,tileSize:r,zoom:t,latLonBounds:e,extent:i});return a}},{key:"getTileId",value:function(t,e,n){return"".concat(t,",").concat(e,",").concat(n)}},{key:"getTile",value:function(t,e,n){var r=this.getTileId(t,e,n);return this.cacheTiles.get(r)}},{key:"createTile",value:function(t,e,n){var r=this.getTileId(t,e,n),i=new Wn({x:t,y:e,z:n,tileSize:this.options.tileSize});return this.cacheTiles.set(r,i),i.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),i}},{key:"resizeCacheTiles",value:function(){var t=5*this.currentTiles.length;if(this.cacheTiles.size>t){var e,n=Xn(this.cacheTiles);try{for(n.s();!(e=n.n()).done;){var r=(0,s.Z)(e.value,2),i=r[0],o=r[1];if(o.isVisible||this.currentTiles.includes(o)||(this.cacheTiles.delete(i),this.onTileUnload(o)),this.cacheTiles.size<=t)break}}catch(t){n.e(t)}finally{n.f()}}}},{key:"rebuildTileTree",value:function(){var t,e=Xn(this.cacheTiles.values());try{for(e.s();!(t=e.n()).done;){var n=t.value;n.parent=null,n.children.length=0}}catch(t){e.e(t)}finally{e.f()}var r,i=Xn(this.cacheTiles.values());try{for(i.s();!(r=i.n()).done;){var o=r.value,a=this.getNearestAncestor(o.x,o.y,o.z);o.parent=a,null!=a&&a.children&&a.children.push(o)}}catch(t){i.e(t)}finally{i.f()}}},{key:"getNearestAncestor",value:function(t,e,n){for(;n>this.options.minZoom;){t=Math.floor(t/2),e=Math.floor(e/2),n-=1;var r=this.getTile(t,e,n);if(r)return r}return null}}]),n}(n.n(qn)())},26259:function(t,e,n){"use strict";n.r(e),n.d(e,{CategoryLegend:function(){return R},ContinueLegend:function(){return V},Tooltip:function(){return C},version:function(){return G}});var r=n(70655),i=n(14062);function o(t,e){if(t)for(var n in e)e.hasOwnProperty(n)&&(t.style[n]=e[n]);return t}var a,s,u,l,c,p='\n  "-apple-system", BlinkMacSystemFont, "Segoe UI", Roboto,"Helvetica Neue",\n  Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei",\n  SimSun, "sans-serif"',h="l7plot-tooltip",f="l7plot-tooltip__title",d="l7plot-tooltip__list",v="l7plot-tooltip__list-item",m="l7plot-tooltip__name",y="l7plot-tooltip__value",g='<li class="'+v+'" data-index={index}>\n  <span class="'+m+'">{name}</span>\n  <span class="'+y+'">{value}</span>\n</li>',_=((a={})[h]={visibility:"visible",zIndex:999,transition:"visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1), left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1)",backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",borderRadius:"2px",color:"rgb(87, 87, 87)",fontSize:"12px",fontFamily:p,lineHeight:"20px",padding:"10px 10px 6px 10px"},a[f]={marginBottom:"4px"},a[d]={margin:"0px",listStyleType:"none",padding:"0px"},a[v]={listStyleType:"none",marginBottom:"4px",whiteSpace:"nowrap",display:"flex",justifyContent:"space-between"},a[m]={},a[y]={marginLeft:"30px"},a);function x(t){s||(s=document.createElement("table"),u=document.createElement("tr"),l=/^\s*<(\w+|!)[^>]*>/,c={tr:document.createElement("tbody"),tbody:s,thead:s,tfoot:s,td:u,th:u,"*":document.createElement("div")});var e=l.test(t)&&RegExp.$1;e&&e in c||(e="*");var n=c[e];t="string"==typeof t?t.replace(/(^\s*)|(\s*$)/g,""):t,n.innerHTML=""+t;var r=n.childNodes[0];return r&&n.contains(r)&&n.removeChild(r),r}function b(t){for(var e=t.childNodes,n=e.length-1;n>=0;n--)t.removeChild(e[n])}var w,S,E=function(){function t(t){this.destroyed=!1,this.options=(0,i.deepMix)({},this.getDefaultOptions(),t),this.container=this.initContainer(),this.initDom(),this.applyStyles(),this.initEvent(),this.initCapture(),this.initVisible(),this.render()}return t.prototype.getDefaultOptions=function(){return{name:"",containerTpl:"<div></div>",visible:!0,capture:!0,domStyles:{}}},t.prototype.getContainer=function(){return this.container},t.prototype.getParentContainer=function(){var t,e=this.options.parent;if(!e)return t;if((0,i.isString)(e)){var n=document.getElementById(e);if(!n)throw new Error("No parent id "+e);t=n}else t=e;return t},t.prototype.initContainer=function(){var t=this.createDom(this.options.containerTpl),e=this.getParentContainer();return e&&e.appendChild(t),t},t.prototype.initVisible=function(){this.options.visible?this.show():this.hide()},t.prototype.initCapture=function(){this.setCapture(this.options.capture)},t.prototype.update=function(t){this.options=(0,i.deepMix)({},this.options,t),this.updateInner(t),this.afterUpdate(t)},t.prototype.updateInner=function(t){t.domStyles&&this.applyStyles()},t.prototype.afterUpdate=function(t){t.capture&&this.setCapture(t.capture)},t.prototype.setCapture=function(t){var e=t?"auto":"none";this.container.style.pointerEvents=e},t.prototype.applyStyles=function(){var t=this.options.domStyles;if(t){var e=this.container;this.applyChildrenStyles(e,t);var n,r=this.options.className;if(r&&(n=r,e.className.match(new RegExp("(\\s|^)"+n+"(\\s|$)"))))o(e,t[r])}},t.prototype.applyChildrenStyles=function(t,e){(0,i.each)(e,(function(e,n){var r=t.getElementsByClassName(n);(0,i.each)(r,(function(t){o(t,e)}))}))},t.prototype.applyStyle=function(t,e){var n=this.options.domStyles;n&&o(e,n[t])},t.prototype.createDom=function(t){return void 0===t&&(t="<div></div>"),x(t)},t.prototype.removeDom=function(){var t=this.container;t&&t.parentNode&&t.parentNode.removeChild(t)},t.prototype.destroy=function(){this.removeEvent(),this.removeDom(),this.destroyed=!0},t}(),C=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return(0,i.deepMix)({},t.prototype.getDefaultOptions.call(this),{id:"l7plot-tooltip",name:"l7plot-tooltip",title:"",showTitle:!0,items:[],containerTpl:'<div class="l7plot-tooltip">\n  <div class="l7plot-tooltip__title"></div>\n  <ul class="l7plot-tooltip__list"></ul>\n</div>',itemTpl:g,domStyles:_,className:h})},e.prototype.initContainer=function(){var e=this.options.customContent;if(e){var n=this.getHtmlContentNode(e),r=this.getParentContainer();return r&&r.appendChild(n),n}return t.prototype.initContainer.call(this)},e.prototype.initDom=function(){this.cacheDoms()},e.prototype.initEvent=function(){},e.prototype.removeEvent=function(){},e.prototype.cacheDoms=function(){var t=this.container,e=t.getElementsByClassName(f)[0],n=t.getElementsByClassName(d)[0];this.titleDom=e,this.listDom=n},e.prototype.render=function(){this.options.customContent?this.renderCustomContent(this.options.customContent):(this.resetTitle(),this.renderItems())},e.prototype.show=function(){var t=this.container;t&&!this.destroyed&&o(t,{visibility:"visible"})},e.prototype.hide=function(){var t=this.container;t&&!this.destroyed&&o(t,{visibility:"hidden"})},e.prototype.updateInner=function(e){this.options.customContent?this.renderCustomContent(this.options.customContent):(e.title&&this.resetTitle(),e.items&&this.renderItems()),t.prototype.updateInner.call(this,e)},e.prototype.renderCustomContent=function(t){var e=this.container.parentNode,n=this.getHtmlContentNode(t),r=this.container;e&&e.replaceChild(n,r),this.container=n,this.applyStyles()},e.prototype.getHtmlContentNode=function(t){var e=t(this.options.title||"",this.options.items);return(0,i.isString)(e)?this.createDom(e):e},e.prototype.resetTitle=function(){var t=this.options.title;this.options.showTitle&&t?(this.showTitle(),this.setTitle(t)):this.hideTitle()},e.prototype.showTitle=function(){var t=this.titleDom;t&&o(t,{display:"block"})},e.prototype.hideTitle=function(){var t=this.titleDom;t&&o(t,{display:"none"})},e.prototype.setTitle=function(t){var e=this.titleDom;e&&(e.innerHTML=t)},e.prototype.renderItems=function(){var t=this;this.clearItemDoms();var e=this.options.items,n=this.options.itemTpl||g,o=this.listDom;o&&(e.forEach((function(e){var a=(0,r.__assign)({},e),s=(0,i.substitute)(n,a),u=t.createDom(s);o.appendChild(u)})),this.applyChildrenStyles(o,this.options.domStyles))},e.prototype.clearItemDoms=function(){this.listDom&&b(this.listDom)},e.prototype.clear=function(){this.setTitle(""),this.clearItemDoms()},e}(E),T="l7plot-legend l7plot-legend__category",A="l7plot-legend__title",M="l7plot-legend__category-list",k="l7plot-legend__list-item",P="l7plot-legend__category-marker",O="l7plot-legend__category-value",L='<li class="l7plot-legend__list-item" data-index={index}>\n  <span class="'+P+'" style="background:{color}"></span>\n  <span class="'+O+'">{value}</span>\n</li>',I=((w={})[T]={visibility:"visible",zIndex:1,backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",borderRadius:"2px",color:"rgb(87, 87, 87)",fontFamily:p,padding:"10px 10px 6px 10px",lineHeight:1,fontSize:"12px"},w[A]={fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},w[M]={margin:"0px",listStyleType:"none",padding:"0px"},w[k]={listStyleType:"none",display:"flex",alignItems:"center",marginBottom:"2px"},w[P]={width:"10px",height:"10px"},w[O]={paddingLeft:"8px"},w),R=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return(0,i.deepMix)({},t.prototype.getDefaultOptions.call(this),{id:"l7plot-category-legend",name:"l7plot-category-legend",title:"",items:[],containerTpl:'<div class="l7plot-legend l7plot-legend__category">\n  <div class="l7plot-legend__title"></div>\n  <ul class="l7plot-legend__category-list"></ul>\n</div>',itemTpl:L,domStyles:I,className:T})},e.prototype.initContainer=function(){var e=this.options.customContent;if(e){var n=this.getHtmlContentNode(e),r=this.getParentContainer();return r&&r.appendChild(n),n}return t.prototype.initContainer.call(this)},e.prototype.initDom=function(){this.cacheDoms()},e.prototype.initEvent=function(){},e.prototype.removeEvent=function(){},e.prototype.cacheDoms=function(){var t=this.container,e=t.getElementsByClassName(A)[0],n=t.getElementsByClassName(M)[0];this.titleDom=e,this.listDom=n},e.prototype.render=function(){this.options.customContent?this.renderCustomContent(this.options.customContent):(this.resetTitle(),this.renderItems())},e.prototype.show=function(){var t=this.container;t&&!this.destroyed&&o(t,{visibility:"visible"})},e.prototype.hide=function(){var t=this.container;t&&!this.destroyed&&o(t,{visibility:"hidden"})},e.prototype.updateInner=function(e){this.options.customContent?this.renderCustomContent(this.options.customContent):(e.title&&this.resetTitle(),e.items&&this.renderItems()),t.prototype.updateInner.call(this,e)},e.prototype.renderCustomContent=function(t){var e=this.container.parentNode,n=this.getHtmlContentNode(t),r=this.container;e&&e.replaceChild(n,r),this.container=n,this.applyStyles()},e.prototype.getHtmlContentNode=function(t){var e=t(this.options.title||"",this.options.items);return(0,i.isString)(e)?this.createDom(e):e},e.prototype.resetTitle=function(){var t=this.options.title;t?(this.showTitle(),this.setTitle(t)):this.hideTitle()},e.prototype.showTitle=function(){var t=this.titleDom;t&&o(t,{display:"block"})},e.prototype.hideTitle=function(){var t=this.titleDom;t&&o(t,{display:"none"})},e.prototype.setTitle=function(t){var e=this.titleDom;e&&(e.innerHTML=t)},e.prototype.renderItems=function(){var t=this;this.clearItemDoms();var e=this.options.items.length>30?this.options.items.slice(0,30):this.options.items,n=this.options.itemTpl||L,o=this.listDom;o&&(e.forEach((function(e){var a=""===e.value?"—":Array.isArray(e.value)?e.value.join(" - "):e.value,s=(0,r.__assign)((0,r.__assign)({},e),{value:a}),u=(0,i.substitute)(n,s),l=t.createDom(u);o.appendChild(l)})),this.applyChildrenStyles(o,this.options.domStyles))},e.prototype.clearItemDoms=function(){this.listDom&&b(this.listDom)},e.prototype.clear=function(){this.setTitle(""),this.clearItemDoms()},e}(E),D="l7plot-legend l7plot-legend__continue",N="l7plot-legend__title",Z="l7plot-legend__ribbon-container",z="l7plot-legend__ribbon",F="l7plot-legend__gradient-bar",B="l7plot-legend__value-range",j='<div class="'+z+'">\n  <span class="'+B+'">{min}</span>\n  <div class="'+F+'" style="background-image: {backgroundImage}"></div>\n  <span class="'+B+'">{max}</span>\n</div>',U=((S={})[D]={visibility:"visible",zIndex:1,backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",borderRadius:"2px",color:"rgb(87, 87, 87)",fontFamily:p,padding:"10px",lineHeight:1,fontSize:"12px"},S["l7plot-legend__title"]={fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},S[z]={display:"flex",alignItems:"center"},S[F]={width:"140px",height:"14px",margin:"0px 5px"},S[B]={padding:"0px"},S),V=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return(0,i.deepMix)({},t.prototype.getDefaultOptions.call(this),{id:"l7plot-continue-legend",name:"l7plot-continue-legend",title:"",containerTpl:'<div class="l7plot-legend l7plot-legend__continue">\n  <div class="l7plot-legend__title"></div>\n  <div class="l7plot-legend__ribbon-container"></div>\n</div>',ribbonTpl:j,domStyles:U,className:D})},e.prototype.initContainer=function(){var e=this.options.customContent;if(e){var n=this.getHtmlContentNode(e),r=this.getParentContainer();return r&&r.appendChild(n),n}return t.prototype.initContainer.call(this)},e.prototype.initDom=function(){this.cacheDoms()},e.prototype.initEvent=function(){},e.prototype.removeEvent=function(){},e.prototype.cacheDoms=function(){var t=this.container,e=t.getElementsByClassName(N)[0],n=t.getElementsByClassName(Z)[0];this.titleDom=e,this.ribbonContainerDom=n},e.prototype.render=function(){this.options.customContent?this.renderCustomContent(this.options.customContent):(this.resetTitle(),this.renderRibbon())},e.prototype.show=function(){var t=this.container;t&&!this.destroyed&&o(t,{visibility:"visible"})},e.prototype.hide=function(){var t=this.container;t&&!this.destroyed&&o(t,{visibility:"hidden"})},e.prototype.updateInner=function(e){this.options.customContent?this.renderCustomContent(this.options.customContent):(e.title&&this.resetTitle(),e.colors&&this.renderRibbon()),t.prototype.updateInner.call(this,e)},e.prototype.renderCustomContent=function(t){var e=this.container.parentNode,n=this.getHtmlContentNode(t),r=this.container;e&&e.replaceChild(n,r),this.container=n,this.applyStyles()},e.prototype.getHtmlContentNode=function(t){var e=t(this.options.title||"",this.options.min,this.options.max,this.options.colors);return(0,i.isString)(e)?this.createDom(e):e},e.prototype.resetTitle=function(){var t=this.options.title;t?(this.showTitle(),this.setTitle(t)):this.hideTitle()},e.prototype.showTitle=function(){var t=this.titleDom;t&&o(t,{display:"block"})},e.prototype.hideTitle=function(){var t=this.titleDom;t&&o(t,{display:"none"})},e.prototype.setTitle=function(t){var e=this.titleDom;e&&(e.innerHTML=t)},e.prototype.renderRibbon=function(){this.clearRibbonContainerDoms();var t=this.options,e=t.min,n=t.max,r=t.colors,o=t.ribbonTpl,a=void 0===o?j:o,s=this.ribbonContainerDom;if(s){var u={min:e,max:n,backgroundImage:"linear-gradient(to right, "+r.join(", ")+")"},l=(0,i.substitute)(a,u),c=this.createDom(l);s.appendChild(c),this.applyChildrenStyles(s,this.options.domStyles)}},e.prototype.clearRibbonContainerDoms=function(){this.ribbonContainerDom&&b(this.ribbonContainerDom)},e.prototype.clear=function(){this.setTitle(""),this.clearRibbonContainerDoms()},e}(E),G="0.0.3"},3876:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ITEM_TPL=e.CONTAINER_TPL=e.VALUE_CLASS=e.MARKER_CLASS=e.LIST_ITEM_CLASS=e.LIST_CLASS=e.TITLE_CLASS=e.CONTAINER_CLASS=void 0,e.CONTAINER_CLASS="l7plot-legend l7plot-legend__category",e.TITLE_CLASS="l7plot-legend__title",e.LIST_CLASS="l7plot-legend__category-list",e.LIST_ITEM_CLASS="l7plot-legend__list-item",e.MARKER_CLASS="l7plot-legend__category-marker",e.VALUE_CLASS="l7plot-legend__category-value",e.CONTAINER_TPL='<div class="'+e.CONTAINER_CLASS+'">\n  <div class="'+e.TITLE_CLASS+'"></div>\n  <ul class="'+e.LIST_CLASS+'"></ul>\n</div>',e.ITEM_TPL='<li class="'+e.LIST_ITEM_CLASS+'" data-index={index}>\n  <span class="'+e.MARKER_CLASS+'" style="background:{color}"></span>\n  <span class="'+e.VALUE_CLASS+'">{value}</span>\n</li>'},56992:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RIBBON_TPL=e.CONTAINER_TPL=e.VALUE_RANGE_CLASS=e.GRADIENT_BAR_CLASS=e.RIBBON_CLASS=e.RIBBON_CONTAINER_CLASS=e.TITLE_CLASS=e.CONTAINER_CLASS=void 0,e.CONTAINER_CLASS="l7plot-legend l7plot-legend__continue",e.TITLE_CLASS="l7plot-legend__title",e.RIBBON_CONTAINER_CLASS="l7plot-legend__ribbon-container",e.RIBBON_CLASS="l7plot-legend__ribbon",e.GRADIENT_BAR_CLASS="l7plot-legend__gradient-bar",e.VALUE_RANGE_CLASS="l7plot-legend__value-range",e.CONTAINER_TPL='<div class="'+e.CONTAINER_CLASS+'">\n  <div class="'+e.TITLE_CLASS+'"></div>\n  <div class="'+e.RIBBON_CONTAINER_CLASS+'"></div>\n</div>',e.RIBBON_TPL='<div class="'+e.RIBBON_CLASS+'">\n  <span class="'+e.VALUE_RANGE_CLASS+'">{min}</span>\n  <div class="'+e.GRADIENT_BAR_CLASS+'" style="background-image: {backgroundImage}"></div>\n  <span class="'+e.VALUE_RANGE_CLASS+'">{max}</span>\n</div>'},77972:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ITEM_TPL=e.CONTAINER_TPL=e.VALUE_CLASS=e.NAME_CLASS=e.LIST_ITEM_CLASS=e.LIST_CLASS=e.TITLE_CLASS=e.CONTAINER_CLASS=void 0,e.CONTAINER_CLASS="l7plot-tooltip",e.TITLE_CLASS="l7plot-tooltip__title",e.LIST_CLASS="l7plot-tooltip__list",e.LIST_ITEM_CLASS="l7plot-tooltip__list-item",e.NAME_CLASS="l7plot-tooltip__name",e.VALUE_CLASS="l7plot-tooltip__value",e.CONTAINER_TPL='<div class="'+e.CONTAINER_CLASS+'">\n  <div class="'+e.TITLE_CLASS+'"></div>\n  <ul class="'+e.LIST_CLASS+'"></ul>\n</div>',e.ITEM_TPL='<li class="'+e.LIST_ITEM_CLASS+'" data-index={index}>\n  <span class="'+e.NAME_CLASS+'">{name}</span>\n  <span class="'+e.VALUE_CLASS+'">{value}</span>\n</li>'},27544:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MappingLayer=e.getMappingFunction=void 0;var r=n(14062);function i(t,e){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var i={};return t.forEach((function(t,e){i[t]=n[e]})),delete i[void 0],e(i)}}e.getMappingFunction=i;var o=function(){function t(){}return t.shape=function(e,n){if((0,r.isString)(n))e.shape(n);else if((0,r.isFunction)(n)){var o=[];e.shape(o.join("*"),i(o,n))}else if((0,r.isObject)(n)){var a=n.field?n.field:"";if((0,r.isFunction)(n.value)){o=(0,r.isArray)(a)?a:a.split("*");e.shape(a,i(o,n.value))}else e.shape(a,n.value);(0,r.isString)(a)&&n.scale&&t.scale(e,a,n.scale)}},t.size=function(e,n){if((0,r.isNumber)(n))e.size(n);else if((0,r.isArray)(n))e.size(n);else if((0,r.isFunction)(n)){var o=[];e.size(o.join("*"),i(o,n))}else if((0,r.isObject)(n)){var a=n.field?n.field:"";if((0,r.isFunction)(n.value)){o=(0,r.isArray)(a)?a:a.split("*");e.size(a,i(o,n.value))}else e.size(a,n.value);(0,r.isString)(a)&&n.scale&&t.scale(e,a,n.scale)}},t.color=function(e,n){if((0,r.isString)(n))e.color(n);else if((0,r.isFunction)(n)){var o=[];e.color(o.join("*"),i(o,n))}else if((0,r.isObject)(n)){var a=n.field?n.field:"";if((0,r.isFunction)(n.value)){o=(0,r.isArray)(a)?a:a.split("*");e.color(a,i(o,n.value))}else e.color(a,n.value);(0,r.isString)(a)&&n.scale&&t.scale(e,a,n.scale)}},t.style=function(t,e){e&&t.style(e)},t.state=function(t,e){var n=e.active,r=e.select;n&&t.active(n),r&&t.select(r)},t.rotate=function(t,e){(0,r.isString)(e)||(0,r.isFunction)(e)||(0,r.isObject)(e)},t.texture=function(t,e){(0,r.isString)(e)&&t.texture(e)},t.animate=function(t,e){((0,r.isBoolean)(e)||(0,r.isObject)(e))&&t.animate(e)},t.scale=function(t,e,n){t.scale(e,n)},t.filter=function(t,e){var n=e.field?e.field:"",o=(0,r.isArray)(n)?n:n.split("*");t.filter(o.join("*"),i(o,e.value))},t}();e.MappingLayer=o},60105:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MappingSource=void 0;var n=function(){function t(){}return t.aggregation=function(t,e){var n=e.type,r={type:void 0===n?"grid":n,size:e.radius,method:e.method,field:e.field};t.transforms?(t.transforms=t.transforms.filter((function(t){return t.type!==r.type})),t.transforms.push(r)):t.transforms=[r]},t}();e.MappingSource=n},86677:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Legend=void 0;var r=n(70655),i=n(30398),o=n(26259),a=function(t){function e(e){var n=t.call(this,e)||this;return n.legendComponents=[],n.options=e,n.legendComponents=n.initLegendComponents(e.items),n}return(0,r.__extends)(e,t),e.prototype.initLegendComponents=function(t){for(var e=[],n=0;n<t.length;n++){var r=t[n],i=r.type,a=r.options;if("category"===i){var s=new o.CategoryLegend({title:a.title,items:a.items,className:a.className,customContent:a.customContent,domStyles:a.domStyles});e.push(s)}else if("continue"===i){s=new o.ContinueLegend({title:a.title,min:a.min,max:a.max,colors:a.colors,className:a.className,customContent:a.customContent,domStyles:a.domStyles});e.push(s)}}return e},e.prototype.getDefaultOptions=function(){return{position:"bottomleft"}},e.prototype.onAdd=function(){var t=window.document.createElement("div");return t.className="l7plot-legend-container",this.legendComponents.forEach((function(e){var n=e.getContainer();t.appendChild(n)})),t},e.prototype.onRemove=function(){this.legendComponents.forEach((function(t){t.destroy()}))},e}(i.Control);e.Legend=a},20430:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Tooltip=void 0;var r=n(70655),i=n(30398),o=(0,r.__importDefault)(n(90494)),a=n(14062),s=n(26259),u=n(54503),l=n(75516),c=n(57042),p=["mousemove","click"],h=function(t){function e(e,n,r){var o=t.call(this)||this;o.currentVisible=!1,o.interactionTriggerHander=function(t){var e=t.feature,n=t.featureId,r=o.options,i=r.title,s=r.customTitle,l=r.items,c=r.customItems,p="Feature"===e.type&&e.geometry&&e.properties?e.properties:e,h=[];if(c){var f=c(e);if(!Array.isArray(f))throw new Error("customItems return array");h=f}else l&&l.forEach((function(t){if((0,a.isString)(t)){var e=t.split(".").pop()||t;void 0!==(r=(0,u.get)(p,t))&&h.push({name:e,value:r})}else{var r,i=t.field,o=t.alias,s=t.customValue,l=o||i.split(".").pop()||i;void 0!==(r=(0,u.get)(p,i))&&h.push({name:l,value:s?s(r,p,n):r})}}));var d={title:s?s(p):i,items:h};o.updateTooltip(t,d)},o.interactionUntriggerHander=function(){o.hideTooltip()},o.scene=e,o.interactionLayers=n,o.options=(0,c.deepAssign)({},o.getDefaultOptions(),r);var l=o.options,p=l.offsets,h=l.title,f=l.showTitle,d=l.customContent,v=l.domStyles,m=l.anchor,y=l.className;return o.marker=new i.Marker({offsets:p,anchor:m,draggable:!1}),o.tooltipComponent=new s.Tooltip({title:h,showTitle:f,items:[],customContent:d,domStyles:v,className:y}),o.setComponent(),o.initInteractionEvent(),o}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return{showTitle:!0,showComponent:!0,items:[],offsets:[15,0],trigger:"mousemove",anchor:l.TooltipAnchorType["TOP-LEFT"]}},e.prototype.update=function(t){this.marker.remove(),this.currentVisible=!1,this.options=(0,c.deepAssign)({},this.options,t);var e=this.options,n=e.offsets,r=e.showTitle,o=e.customContent,a=e.domStyles,s=e.anchor,u=e.className;this.marker=new i.Marker({offsets:n,anchor:s,draggable:!1}),this.tooltipComponent.update({showTitle:r,customContent:o,domStyles:a,className:u}),this.setComponent()},e.prototype.initInteractionEvent=function(){var t=this,e=this.options.trigger||"mousemove";if(!p.includes(e))throw new Error("trigger is mousemove or click");this.interactionLayers.forEach((function(n){var r=n.layer;r.on(e,t.interactionTriggerHander),r.on("un".concat(e),t.interactionUntriggerHander)}))},e.prototype.unBindInteractionEvent=function(){var t=this,e=this.options.trigger||"mousemove";this.interactionLayers.forEach((function(n){var r=n.layer;r.off(e,t.interactionTriggerHander),r.off("un".concat(e),t.interactionUntriggerHander)}))},e.prototype.updateTooltip=function(t,e){var n=t.lngLat,r=t.x,i=t.y;if(this.options.showComponent&&(this.updateComponent(e),this.setPostion(n)),this.currentVisible){var o={type:"tooltip:change",data:e,lngLat:n,x:r,y:i};this.emit("tooltip:change",o)}else{this.showTooltip();var a={type:"tooltip:show",data:e,lngLat:n,x:r,y:i};this.emit("tooltip:show",a)}},e.prototype.showTooltip=function(){this.currentVisible||(this.options.showComponent&&this.scene.addMarker(this.marker),this.currentVisible=!0)},e.prototype.hideTooltip=function(){if(this.currentVisible){this.options.showComponent&&this.marker.remove(),this.currentVisible=!1;this.emit("tooltip:hide",{type:"tooltip:hide"})}},e.prototype.updateComponent=function(t){(0,a.isEqual)(this.lastComponentOptions,t)||(this.tooltipComponent.update(t),this.lastComponentOptions=t)},e.prototype.setComponent=function(){var t=this.tooltipComponent.getContainer(),e=window.document.createElement("div");e.style.cursor="auto",e.style.userSelect="text",e.className="l7plot-tooltip-container",["mousemove","mousedown","mouseup","click","dblclick"].forEach((function(t){e.addEventListener(t,(function(t){return t.stopPropagation()}))})),e.appendChild(t),this.marker.setElement(e)},e.prototype.setPostion=function(t){this.marker.setLnglat(t)},e.prototype.destroy=function(){this.unBindInteractionEvent(),this.off(),this.marker.remove(),this.tooltipComponent.destroy()},e}(o.default);e.Tooltip=h},34525:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LayerGroup=void 0;var r=n(70655),i=n(14062),o=function(t){function e(e,n){void 0===e&&(e=[]),void 0===n&&(n={});var r=t.call(this)||this;return r.name=n.name?n.name:(0,i.uniqueId)("layerGroup"),r.layers=e,r}return(0,r.__extends)(e,t),e.prototype.addTo=function(t){var e=this;this.scene=t;var n=0,r=this.layers.length;this.layers.forEach((function(i){i.once("inited",(function(t){n++,e.emit("inited",t),n===r&&e.emit("inited-all")})),i.addTo(t)}))},e.prototype.hasLayer=function(t){return this.layers.some((function(e){return e===t}))},e.prototype.addLayer=function(t){var e=this;this.layers.push(t),this.scene&&(t.once("inited",(function(t){return e.emit("inited",t)})),t.addTo(this.scene))},e.prototype.removeLayer=function(t){var e=this.layers.findIndex((function(e){return e===t}));return-1!==e&&(this.layers.splice(e,1),this.scene&&t.remove(this.scene),!0)},e.prototype.getLayers=function(){return this.layers},e.prototype.getInteractionLayers=function(){return this.layers.filter((function(t){return t.interaction}))},e.prototype.getLayer=function(t){return this.layers.find((function(e){return e.layer.id===t}))},e.prototype.getLayerByName=function(t){return this.layers.find((function(e){return e.name===t}))},e.prototype.removeAllLayer=function(){var t=this;this.layers.forEach((function(e){t.scene&&e.remove(t.scene)})),this.layers=[]},e.prototype.isEmpty=function(){return 0===this.layers.length},e}((0,r.__importDefault)(n(90494)).default);e.LayerGroup=o},19093:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PlotLayer=void 0;var r=n(70655),i=n(14062),o=(0,r.__importDefault)(n(33591)),a=(0,r.__importDefault)(n(90494)),s=n(55226),u=n(60105),l=n(52164),c=n(57042),p=["name","zIndex","visible","minZoom","maxZoom","pickingBuffer","autoFit","blend"],h=function(t){function e(e){var n=t.call(this)||this;return n.options=(0,c.deepAssign)({},n.getDefaultOptions(),e),n.lastOptions=n.options,n}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return{}},e.prototype.pickLayerConfig=function(t){return(0,i.pick)(t,p)},e.prototype.addTo=function(t){t.addLayer(this.layer)},e.prototype.remove=function(t){t.removeLayer(this.layer)},e.prototype.update=function(t){this.updateOption(t),this.updateConfig(t)},e.prototype.updateOption=function(t){this.lastOptions=this.options,this.options=(0,c.deepAssign)({},this.options,t)},e.prototype.updateConfig=function(t){(0,i.isUndefined)(t.zIndex)||(0,i.isEqual)(this.lastOptions.zIndex,this.options.zIndex)||this.setIndex(t.zIndex),(0,i.isUndefined)(t.blend)||(0,i.isEqual)(this.lastOptions.blend,this.options.blend)||this.setBlend(t.blend),(0,i.isUndefined)(t.minZoom)||(0,i.isEqual)(this.lastOptions.minZoom,this.options.minZoom)||this.setMinZoom(t.minZoom),(0,i.isUndefined)(t.maxZoom)||(0,i.isEqual)(this.lastOptions.maxZoom,this.options.maxZoom)||this.setMinZoom(t.maxZoom),(0,i.isUndefined)(t.visible)||(0,i.isEqual)(this.lastOptions.visible,this.options.visible)||(t.visible?this.show():this.hide())},e.prototype.render=function(){this.layer.renderLayers()},e.prototype.setSource=function(t){if(t instanceof o.default)this.layer.setSource(t);else{var e=t.data,n=t.aggregation,i=(0,r.__rest)(t,["data","aggregation"]);n&&u.MappingSource.aggregation(i,n),this.layer.getSource()?this.layer.setData(e,i):this.layer.source(e,i)}},e.prototype.changeData=function(t){this.setSource(t)},e.prototype.setIndex=function(t){this.layer.setIndex(t)},e.prototype.setBlend=function(t){this.layer.setBlend(t)},e.prototype.setMinZoom=function(t){this.layer.setMinZoom(t)},e.prototype.setMaxZoom=function(t){this.layer.setMaxZoom(t)},e.prototype.show=function(){this.layer.inited&&this.layer.show()},e.prototype.hide=function(){this.layer.inited&&this.layer.hide()},e.prototype.toggleVisible=function(){this.isVisible()?this.hide():this.show()},e.prototype.isVisible=function(){return this.layer.inited?this.layer.isVisible():this.options.visible},e.prototype.fitBounds=function(t){this.layer.fitBounds(t)},e.prototype.on=function(e,n){return-1!==l.LayerEventList.indexOf(e)?this.layer.on(e,n):t.prototype.on.call(this,e,n),this},e.prototype.once=function(e,n){return-1!==l.LayerEventList.indexOf(e)?this.layer.once(e,n):t.prototype.once.call(this,e,n),this},e.prototype.off=function(e,n){return-1!==l.LayerEventList.indexOf(e)?this.layer.off(e,n):t.prototype.off.call(this,e,n),this},e.LayerType=s.LayerType,e.LayerConfigkeys=p,e}(a.default);e.PlotLayer=h},52164:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LayerEventList=e.MapEventList=e.SceneEventList=void 0,e.SceneEventList=[{original:"loaded",adaptation:"scene-loaded"},{original:"resize",adaptation:"resize"},{original:"destroy",adaptation:"destroy"},{original:"resize",adaptation:"resize"}],e.MapEventList=["mapmove","movestart","moveend","zoomchange","zoomstart","zoomend","click","dblclick","contextmenu","mousemove","mousewheel","mouseover","mouseout","mouseup","mousedown","dragstart","dragging","dragend"],e.LayerEventList=["inited","add","remove","dataUpdate","click","unclick","contextmenu","uncontextmenu","mouseenter","mousemove","unmousemove","mouseout","mouseup","unmouseup","mousedown","uncontextmenu","unpick"]},12392:function(t,e,n){"use strict";var r=n(25108);Object.defineProperty(e,"__esModule",{value:!0}),e.Map=void 0;var i=n(70655),o=n(37728),a=n(72888),s=n(30398),u=(0,i.__importDefault)(n(90494)),l=n(14062),c=n(20430),p=n(86677),h=n(57042),f=n(75516),d=n(34525),v=n(52164),m=n(23021),y=n(23316),g=n(4548),_={map:{type:f.BaseMapType.Amap},logo:!0},x=function(t){function e(e){var n=t.call(this)||this;return n.inited=!1,n.sceneLoaded=!1,n.layersLoaded=!1,n.loaded=!1,n.layerGroup=new d.LayerGroup,n.options=(0,h.deepAssign)({},n.getDefaultOptions(),e),n.lastOptions=n.options,n}return(0,i.__extends)(e,t),e.prototype.getDefaultOptions=function(){return e.DefaultOptions},e.prototype.createContainer=function(t){var e=this.options,n=e.width,r=e.height,i="string"==typeof t?document.getElementById(t):t;return i.style.position||(i.style.position="relative"),n&&(i.style.width||(i.style.width="".concat(n,"px"))),r&&(i.style.height||(i.style.height="".concat(r,"px"))),i},e.prototype.createTheme=function(){return(0,l.isObject)(this.options.theme)?(0,h.deepAssign)({},(0,y.getTheme)("default"),(0,g.createTheme)(this.options.theme)):(0,y.getTheme)(this.options.theme)},e.prototype.createMap=function(){var t=this.options.map?this.options.map:_.map,e=t.type,n=(0,i.__rest)(t,["type"]),r=Object.assign({style:this.theme.mapStyle},n);return e===f.BaseMapType.Amap?new a.GaodeMap(r):new a.Mapbox(r)},e.prototype.createScene=function(){var t=this.options,e=t.logo,n=t.antialias,r=t.preserveDrawingBuffer,a=(0,l.isBoolean)(e)?{logoVisible:e}:{logoVisible:null==e?void 0:e.visible,logoPosition:null==e?void 0:e.position},s=Object.assign({antialias:n,preserveDrawingBuffer:r},a),u=this.createMap();return new o.Scene((0,i.__assign)({id:this.container,map:u},s))},e.prototype.registerResources=function(){var t=this;m.IMAGES_CACHE.size&&m.IMAGES_CACHE.forEach((function(e,n){!t.scene.hasImage(n)&&t.scene.addImage(n,e)})),m.FONT_FACE_CACHE.size&&m.FONT_FACE_CACHE.forEach((function(e,n){t.scene.addFontFace(n,e)})),m.ICON_FONT_CACHE.size&&m.ICON_FONT_CACHE.forEach((function(e,n){t.scene.addIconFont(n,e)}))},e.prototype.update=function(t){this.updateOption(t),t.map&&!(0,l.isEqual)(this.lastOptions.map,this.options.map)&&this.updateMap(t.map),this.render(),this.emit("update")},e.prototype.updateOption=function(t){this.lastOptions=this.options,this.options=(0,h.deepAssign)({},this.options,t)},e.prototype.updateMap=function(t){var e;if(this.scene){var n=t.style,r=t.center,i=t.zoom,o=t.rotation,a=t.pitch;(0,l.isUndefined)(a)||this.scene.setPitch(a),(0,l.isUndefined)(o)||this.scene.setRotation(o),n&&n!==(null===(e=this.lastOptions.map)||void 0===e?void 0:e.style)&&this.scene.setMapStyle(n),i&&r&&this.scene.setZoomAndCenter(i,r)}},e.prototype.changeSize=function(t,e){this.options.width===t&&this.options.height===e||(this.container.style.width="".concat(t,"px"),this.container.style.height="".concat(e,"px"),this.options=Object.assign(this.options,{width:t,height:e}))},e.prototype.on=function(t,e){return this.proxyEventHander("on",t,e),this},e.prototype.once=function(t,e){return this.proxyEventHander("once",t,e),this},e.prototype.off=function(t,e){return this.proxyEventHander("off",t,e),this},e.prototype.proxyEventHander=function(e,n,r){var o=v.SceneEventList.find((function(t){return t.adaptation===n}));if(o)this.scene[e](o.original,r);else if(-1!==v.MapEventList.indexOf(n))this.scene[e](n,r);else if(n.includes("Layer:")){var a=(0,i.__read)(n.split(":"),2),s=a[0],u=a[1];if(!(this[s]&&this[s][e])||-1===v.LayerEventList.indexOf(u))throw new Error('No event name "'.concat(n,'"'));this[s][e](u,r)}else t.prototype[e].call(this,n,r)},e.prototype.getScene=function(){return this.scene},e.prototype.getMap=function(){var t,e;return(null===(t=this.options.map)||void 0===t?void 0:t.type)===f.BaseMapType.Amap||(null===(e=this.options.map)||void 0===e||e.type,f.BaseMapType.Mapbox),this.scene.map},e.prototype.addLayer=function(t){this.layerGroup.addLayer(t)},e.prototype.getLayes=function(){return r.warn("Replace to use getLayers()"),this.getLayers()},e.prototype.getLayers=function(){return this.layerGroup.getLayers()},e.prototype.getLayerByName=function(t){return this.layerGroup.getLayerByName(t)},e.prototype.removeLayer=function(t){return this.layerGroup.removeLayer(t)},e.prototype.removeAllLayer=function(){this.layerGroup.removeAllLayer()},e.prototype.zoomIn=function(){this.scene.zoomIn()},e.prototype.zoomOut=function(){this.scene.zoomOut()},e.prototype.setPitch=function(t){this.scene.setPitch(t)},e.prototype.fitBounds=function(t){this.scene.fitBounds(t)},e.prototype.setMapStatus=function(t){this.scene.setMapStatus(t)},e.prototype.setBgColor=function(t){this.scene.setBgColor(t)},e.prototype.initComponents=function(){this.initControls(),this.initTooltip()},e.prototype.updateComponents=function(){this.updateControls(),this.initTooltip()},e.prototype.initControls=function(){var t=this.options,e=t.zoom,n=t.scale,r=t.layerMenu,i=t.legend;n&&this.addScaleControl(n),e&&this.addZoomControl(e),r&&this.addLayerMenuControl(r),i&&this.addLegendControl(i)},e.prototype.updateControls=function(){var t=this.options,e=t.zoom,n=t.scale,r=t.layerMenu,i=t.legend;(0,l.isEqual)(this.lastOptions.zoom,e)||(e?this.updateZoomControl(e):this.removeZoomControl()),(0,l.isEqual)(this.lastOptions.scale,n)||(n?this.updateScaleControl(n):this.removeScaleControl()),(0,l.isEqual)(this.lastOptions.layerMenu,r)||(r?this.updateLayerMenuControl(r):this.removeLayerMenuControl()),(0,l.isEqual)(this.lastOptions.legend,i)||(i?this.updateLegendControl(i):this.removeLegendControl())},e.prototype.addZoomControl=function(t){this.zoomControl||(this.zoomControl=new s.Zoom(t),this.scene.addControl(this.zoomControl))},e.prototype.updateZoomControl=function(t){this.zoomControl?(this.removeZoomControl(),this.addZoomControl(t)):this.addZoomControl(t)},e.prototype.removeZoomControl=function(){this.zoomControl&&(this.zoomControl.remove(),this.zoomControl=void 0)},e.prototype.addScaleControl=function(t){this.scaleControl||(this.scaleControl=new s.Scale(t),this.scene.addControl(this.scaleControl))},e.prototype.updateScaleControl=function(t){this.scaleControl?(this.removeScaleControl(),this.addScaleControl(t)):this.addScaleControl(t)},e.prototype.removeScaleControl=function(){this.scaleControl&&(this.scaleControl.remove(),this.scaleControl=void 0)},e.prototype.addLayerMenuControl=function(t){if(!this.layerMenuControl){var e={};this.layerGroup.getLayers().forEach((function(t){var n=t.name,r=t.layer;e[n]=r})),this.layerMenuControl=new s.Layers(Object.assign({},t,{baseLayers:{},overlayers:e})),this.scene.addControl(this.layerMenuControl)}},e.prototype.updateLayerMenuControl=function(t){this.layerMenuControl?(this.removeLayerMenuControl(),this.addLayerMenuControl(t)):this.addLayerMenuControl(t)},e.prototype.removeLayerMenuControl=function(){this.layerMenuControl&&(this.layerMenuControl.remove(),this.layerMenuControl=void 0)},e.prototype.getLegendOptions=function(){return{}},e.prototype.addLegendControl=function(t){if(!this.legendControl){var e=this.theme.components.legend,n=(0,h.deepAssign)({},this.getLegendOptions(),t),r=n.type,o=n.position,a=(0,i.__rest)(n,["type","position"]),s=[];if("category"===r){var u=(0,h.deepAssign)({},{domStyles:e.category.domStyles},a);s.push({type:r,options:u})}else if("continue"===r){var l=(0,h.deepAssign)({},{domStyles:e.continue.domStyles},a);s.push({type:r,options:l})}s.length&&(this.legendControl=new p.Legend({position:o,items:s}),this.scene.addControl(this.legendControl))}},e.prototype.updateLegendControl=function(t){this.legendControl?(this.removeLegendControl(),this.addLegendControl(t)):this.addLegendControl(t)},e.prototype.removeLegendControl=function(){this.legendControl&&(this.legendControl.remove(),this.legendControl=void 0)},e.prototype.initTooltip=function(){var t=this;this.tooltip&&this.tooltip.destroy();var e=this.options.tooltip;if(e){var n=(0,h.deepAssign)({},{domStyles:this.theme.components.tooltip.domStyles},e),r=this.layerGroup.getInteractionLayers();this.tooltip=new c.Tooltip(this.scene,r,n),this.tooltip.on("*",(function(e){return t.emit(e.type,e)}))}},e.prototype.exportPng=function(t){return this.scene.exportPng(t)},e.prototype.destroy=function(){var e;t.prototype.off.call(this,"*"),this.removeScaleControl(),this.removeZoomControl(),this.removeLayerMenuControl(),this.removeLegendControl(),null===(e=this.tooltip)||void 0===e||e.destroy(),this.scene.destroy()},e.DefaultOptions=_,e}(u.default);e.Map=x},23021:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.unregisterIconFont=e.registerIconFonts=e.registerIconFont=e.ICON_FONT_CACHE=e.unregisterFontFace=e.registerFontFace=e.FONT_FACE_CACHE=e.unregisterImage=e.hasImage=e.getImage=e.registerImages=e.registerImage=e.IMAGES_CACHE=void 0,e.IMAGES_CACHE=new Map,e.registerImage=function(t,n){e.IMAGES_CACHE.set(t,n)},e.registerImages=function(t){t.forEach((function(t){e.IMAGES_CACHE.set(t.id,t.image)}))},e.getImage=function(t){return e.IMAGES_CACHE.get(t)},e.hasImage=function(t){return e.IMAGES_CACHE.has(t)},e.unregisterImage=function(t){return e.IMAGES_CACHE.delete(t)},e.FONT_FACE_CACHE=new Map,e.registerFontFace=function(t,n){e.FONT_FACE_CACHE.set(t,n)},e.unregisterFontFace=function(t){return e.FONT_FACE_CACHE.delete(t)},e.ICON_FONT_CACHE=new Map,e.registerIconFont=function(t,n){e.ICON_FONT_CACHE.set(t,n)},e.registerIconFonts=function(t){t.forEach((function(t){e.ICON_FONT_CACHE.set(t.name,t.fontUnicode)}))},e.unregisterIconFont=function(t){return e.ICON_FONT_CACHE.delete(t)}},3071:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Plot=void 0;var r=n(70655),i=n(12392),o=n(57042),a=n(71713),s=n(75516),u=n(60105),l=n(14062),c=n(23316),p={autoFit:!1},h=function(t){function e(e,n){var r=this;if("string"==typeof e||e instanceof Element){if(void 0===n)throw new Error("options is undefined");(r=t.call(this,n)||this).container=r.createContainer(e),r.theme=r.createTheme(),r.scene=r.createScene(),r.registerResources(),r.initLayers()}else r=t.call(this,e)||this;return r}return(0,r.__extends)(e,t),e.prototype.initLayers=function(){this.source=this.createSource(),this.render(),this.inited=!0},e.prototype.initLayersEvent=function(){},e.prototype.getDefaultOptions=function(){return e.DefaultOptions},e.prototype.createSource=function(){var t=this.options.source,e=t.data,n=t.aggregation,i=(0,r.__rest)(t,["data","aggregation"]);return n&&u.MappingSource.aggregation(i,n),new s.Source(e,i)},e.prototype.createLabelLayer=function(t,e,n){var i=n||{},o=i.visible,s=i.minZoom,u=i.maxZoom,l=i.zIndex,c=void 0===l?0:l;return new a.TextLayer((0,r.__assign)({name:"labelLayer",visible:o,minZoom:s,maxZoom:u,zIndex:c+.1,source:t},e))},e.prototype.updateLabelLayer=function(t,e,n,i){e?i?i.update((0,r.__assign)({},e)):(i=this.createLabelLayer(t,e,n),this.layerGroup.addLayer(i)):!1===e&&i&&this.layerGroup.removeLayer(i)},e.prototype.render=function(){var t=this.createLayers(this.source);this.inited?(this.layerGroup.removeAllLayer(),t.addTo(this.scene),this.layerGroup=t):(this.layerGroup=t,this.onLayersLoaded(),t.addTo(this.scene)),this.initLayersEvent()},e.prototype.onLayersLoaded=function(){var t=this,e=function(){t.initComponents(),t.loaded=!0,t.emit("loaded")};this.scene.sceneService.loaded?(this.sceneLoaded=!0,this.layersLoaded&&e()):this.scene.once("loaded",(function(){t.sceneLoaded=!0,t.layersLoaded&&e()})),this.layerGroup.isEmpty()?this.layersLoaded=!0:this.layerGroup.once("inited-all",(function(){t.layersLoaded=!0,t.sceneLoaded&&e()}))},e.prototype.attachToScene=function(t,e){this.scene=t,this.theme=e||(0,c.getTheme)("default"),this.registerResources(),this.initLayers()},e.prototype.unattachFromScene=function(){var t;this.removeAllLayer(),null===(t=this.tooltip)||void 0===t||t.destroy()},e.prototype.addToScene=function(t){this.attachToScene(t)},e.prototype.removeFromScene=function(){var t;this.removeAllLayer(),this.removeScaleControl(),this.removeZoomControl(),this.removeLayerMenuControl(),this.removeLegendControl(),null===(t=this.tooltip)||void 0===t||t.destroy()},e.prototype.update=function(t){if(this.updateOption(t),t.map&&!(0,l.isEqual)(this.lastOptions.map,this.options.map)&&this.updateMap(t.map),this.scene.setEnableRender(!1),t.source&&!(0,l.isEqual)(this.lastOptions.source,this.options.source)){var e=t.source,n=e.data,i=(0,r.__rest)(e,["data"]);this.changeData(n,i)}this.scene.setEnableRender(!0),this.render(),this.updateComponents(),this.emit("update")},e.prototype.changeData=function(t,e){this.options.source=(0,o.deepAssign)({},this.options.source,(0,r.__assign)({data:t},e));var n=this.options.source,i=n.aggregation,a=(0,r.__rest)(n,["aggregation"]);i&&u.MappingSource.aggregation(a,i),this.source.setData(this.options.source.data,a),this.options.legend&&this.updateLegendControl(this.options.legend),this.emit("change-data")},e.DefaultOptions=p,e.PlotType=s.PlotType,e}(i.Map);e.Plot=h},59183:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Choropleth=e.Area=e.Flow=e.Path=e.Hexbin=e.Grid=e.Heatmap=e.DotDensity=e.Dot=e.PrismLayer=e.AreaLayer=e.ArcLayer=e.PathLayer=e.HexbinLayer=e.GridLayer=e.HeatmapLayer=e.TextLayer=e.DotDensityLayer=e.IconLayer=e.DotLayer=e.L7Plot=e.Plot=e.Map=e.registerTheme=e.getTheme=e.unregisterIconFont=e.registerIconFonts=e.registerIconFont=e.unregisterFontFace=e.registerFontFace=e.unregisterImage=e.registerImages=e.registerImage=e.version=void 0;var r=n(70655);e.version="0.0.3";var i=n(23021);Object.defineProperty(e,"registerImage",{enumerable:!0,get:function(){return i.registerImage}}),Object.defineProperty(e,"registerImages",{enumerable:!0,get:function(){return i.registerImages}}),Object.defineProperty(e,"unregisterImage",{enumerable:!0,get:function(){return i.unregisterImage}}),Object.defineProperty(e,"registerFontFace",{enumerable:!0,get:function(){return i.registerFontFace}}),Object.defineProperty(e,"unregisterFontFace",{enumerable:!0,get:function(){return i.unregisterFontFace}}),Object.defineProperty(e,"registerIconFont",{enumerable:!0,get:function(){return i.registerIconFont}}),Object.defineProperty(e,"registerIconFonts",{enumerable:!0,get:function(){return i.registerIconFonts}}),Object.defineProperty(e,"unregisterIconFont",{enumerable:!0,get:function(){return i.unregisterIconFont}});var o=n(23316);Object.defineProperty(e,"getTheme",{enumerable:!0,get:function(){return o.getTheme}}),Object.defineProperty(e,"registerTheme",{enumerable:!0,get:function(){return o.registerTheme}}),(0,r.__exportStar)(n(75516),e);var a=n(12392);Object.defineProperty(e,"Map",{enumerable:!0,get:function(){return a.Map}});var s=n(3071);Object.defineProperty(e,"Plot",{enumerable:!0,get:function(){return s.Plot}});var u=n(46278);Object.defineProperty(e,"L7Plot",{enumerable:!0,get:function(){return u.L7Plot}});var l=n(94340);Object.defineProperty(e,"DotLayer",{enumerable:!0,get:function(){return l.DotLayer}});var c=n(39276);Object.defineProperty(e,"IconLayer",{enumerable:!0,get:function(){return c.IconLayer}});var p=n(49855);Object.defineProperty(e,"DotDensityLayer",{enumerable:!0,get:function(){return p.DotDensityLayer}});var h=n(71713);Object.defineProperty(e,"TextLayer",{enumerable:!0,get:function(){return h.TextLayer}});var f=n(99177);Object.defineProperty(e,"HeatmapLayer",{enumerable:!0,get:function(){return f.HeatmapLayer}});var d=n(25140);Object.defineProperty(e,"GridLayer",{enumerable:!0,get:function(){return d.GridLayer}});var v=n(89645);Object.defineProperty(e,"HexbinLayer",{enumerable:!0,get:function(){return v.HexbinLayer}});var m=n(84591);Object.defineProperty(e,"PathLayer",{enumerable:!0,get:function(){return m.PathLayer}});var y=n(11997);Object.defineProperty(e,"ArcLayer",{enumerable:!0,get:function(){return y.ArcLayer}});var g=n(79743);Object.defineProperty(e,"AreaLayer",{enumerable:!0,get:function(){return g.AreaLayer}});var _=n(17937);Object.defineProperty(e,"PrismLayer",{enumerable:!0,get:function(){return _.PrismLayer}});var x=n(76347);Object.defineProperty(e,"Dot",{enumerable:!0,get:function(){return x.Dot}});var b=n(43091);Object.defineProperty(e,"DotDensity",{enumerable:!0,get:function(){return b.DotDensity}});var w=n(1403);Object.defineProperty(e,"Heatmap",{enumerable:!0,get:function(){return w.Heatmap}});var S=n(83821);Object.defineProperty(e,"Grid",{enumerable:!0,get:function(){return S.Grid}});var E=n(15266);Object.defineProperty(e,"Hexbin",{enumerable:!0,get:function(){return E.Hexbin}});var C=n(13778);Object.defineProperty(e,"Path",{enumerable:!0,get:function(){return C.Path}});var T=n(8623);Object.defineProperty(e,"Flow",{enumerable:!0,get:function(){return T.Flow}});var A=n(98994);Object.defineProperty(e,"Area",{enumerable:!0,get:function(){return A.Area}});var M=n(87883);Object.defineProperty(e,"Choropleth",{enumerable:!0,get:function(){return M.Choropleth}})},11997:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ArcLayer=void 0;var r=n(70655),i=n(57042),o=n(34213),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=o.LinesLayer.LayerType.ArcLayer,e}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return(0,i.deepAssign)({},o.LinesLayer.DefaultOptions,{shape:"arc"})},e}(o.LinesLayer);e.ArcLayer=a},52133:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.mappingLayer=e.getDefaultState=void 0;var r=n(14062),i=n(27544),o="#2f54eb",a={active:{fill:!1,stroke:o,lineWidth:1.5,lineOpacity:.8},select:{fill:!1,stroke:o,lineWidth:1.5,lineOpacity:.8}};e.getDefaultState=function(t){return(0,r.isUndefined)(t)||(!1===t.active?a.active=Object.assign(a.active,{fill:!1,stroke:!1}):"object"==typeof t.active&&(!1===t.active.fill?a.active.fill=!1:"string"==typeof t.active.fill&&(a.active.fill=t.active.fill),!1===t.active.stroke?a.active.stroke=!1:"string"==typeof t.active.stroke&&(a.active.stroke=t.active.stroke),"number"==typeof t.active.lineWidth&&(a.active.lineWidth=t.active.lineWidth),"number"==typeof t.active.lineOpacity&&(a.active.lineOpacity=t.active.lineOpacity)),!1===t.select?a.select=Object.assign(a.select,{fill:!1,stroke:!1}):"object"==typeof t.select&&(!1===t.select.fill?a.select.fill=!1:"string"==typeof t.select.fill&&(a.select.fill=t.select.fill),!1===t.select.stroke?a.select.stroke=!1:"string"==typeof t.select.stroke&&(a.select.stroke=t.select.stroke),"number"==typeof t.select.lineWidth&&(a.select.lineWidth=t.select.lineWidth),"number"==typeof t.select.lineOpacity&&(a.select.lineOpacity=t.select.lineOpacity))),a},e.mappingLayer=function(t,n,r,o,a,s){var u=s.color,l=s.style,c=s.state,p=(0,e.getDefaultState)(c),h={active:!1!==p.active.fill&&{color:p.active.fill},select:!1},f={opacity:null==l?void 0:l.opacity},d=null==l?void 0:l.fillBottomColor,v=null==l?void 0:l.lineWidth,m=null==l?void 0:l.stroke,y={opacity:null==l?void 0:l.lineOpacity,dashArray:null==l?void 0:l.lineDash,lineType:null==l?void 0:l.lineType};if(i.MappingLayer.shape(t,"fill"),u&&i.MappingLayer.color(t,u),f&&i.MappingLayer.style(t,f),h&&i.MappingLayer.state(t,h),d&&t.setBottomColor(d),i.MappingLayer.shape(n,"line"),v&&i.MappingLayer.size(n,v),m&&i.MappingLayer.color(n,m),y&&i.MappingLayer.style(n,y),p.active.stroke){var g=p.active.stroke,_=p.active.lineWidth||v,x={opacity:p.active.lineOpacity};i.MappingLayer.shape(r,"line"),_&&i.MappingLayer.size(r,_),g&&i.MappingLayer.color(r,g),x&&i.MappingLayer.style(r,x)}if(p.select.fill){var b=p.select.fill;i.MappingLayer.shape(o,"fill"),b&&i.MappingLayer.color(o,b),f&&i.MappingLayer.style(o,f),i.MappingLayer.state(o,{select:!1,active:!1})}if(p.select.stroke){var w=p.select.stroke,S=(_=p.select.lineWidth||v,{opacity:p.select.lineOpacity});i.MappingLayer.shape(a,"line"),_&&i.MappingLayer.size(a,_),w&&i.MappingLayer.color(a,w),S&&i.MappingLayer.style(a,S)}}},79743:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AreaLayer=void 0;var r=n(70655),i=n(14062),o=n(91011),a=n(19093),s=n(52133),u=n(88006),l={visible:!0,state:{active:!1,select:!1},enabledMultiSelect:!1},c=["color","style","state","enabledMultiSelect"],p=function(t){function e(e){var n=t.call(this,e)||this;n.selectData=[],n.type=a.PlotLayer.LayerType.AreaLayer,n.interaction=!0,n.onHighlighHandle=function(t){var e=t.feature,r=t.featureId;n.setHighlightLayerSource(e,r)},n.onUnhighlighHandle=function(){n.setHighlightLayerSource()},n.onSelectHandle=function(t){var e=n.options.enabledMultiSelect,r=t.feature,o=t.featureId,a=(0,i.clone)(n.selectData),s=a.findIndex((function(t){return t.featureId===o}));if(-1===s)e?a.push({feature:r,featureId:o}):a=[{feature:r,featureId:o}],n.emit("select",r,(0,i.clone)(a));else{var u=a[s];e?a.splice(s,1):a=[],n.emit("unselect",u,(0,i.clone)(a))}n.setSelectLayerSource(a)};var u=n.options,l=u.name,c=u.source,p=u.visible,h=u.minZoom,f=u.maxZoom,d=u.zIndex,v=void 0===d?0:d,m=n.pickLayerConfig(n.options),y=(0,s.getDefaultState)(n.options.state);return n.name=l||(0,i.uniqueId)(n.type),n.layer=new o.PolygonLayer((0,r.__assign)((0,r.__assign)({},m),{name:n.name})),n.strokeLayer=new o.LineLayer({name:"strokeLayer",visible:p,zIndex:v,minZoom:h,maxZoom:f}),n.highlightLayer=new o.LineLayer({name:"highlightLayer",visible:p&&Boolean(y.active.stroke),zIndex:v+.1,minZoom:h,maxZoom:f}),n.selectFillLayer=new o.PolygonLayer({name:"selectFillLayer",visible:p&&Boolean(y.select.fill),zIndex:v+.1,minZoom:h,maxZoom:f}),n.selectStrokeLayer=new o.LineLayer({name:"selectStrokeLayer",visible:p&&Boolean(y.select.stroke),zIndex:v+.1,minZoom:h,maxZoom:f}),n.mappingLayer(n.options),n.setSource(c),n.initEvent(),n}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return l},e.prototype.mappingLayer=function(t){(0,s.mappingLayer)(this.layer,this.strokeLayer,this.highlightLayer,this.selectFillLayer,this.selectStrokeLayer,t)},e.prototype.setSource=function(e){t.prototype.setSource.call(this,e),this.setStrokeLayerSource(),this.setHighlightLayerSource(),this.selectFillLayer.source({type:"FeatureCollection",features:[]},{parser:{type:"geojson"}}),this.selectStrokeLayer.source({type:"FeatureCollection",features:[]},{parser:{type:"geojson"}})},e.prototype.setStrokeLayerSource=function(){var t=this.layer.getSource();if(t)this.strokeLayer.setSource(t);else{var e=this.layer.sourceOption,n=e.data,r=e.options;this.strokeLayer.source(n,r)}},e.prototype.setHighlightLayerSource=function(t,e){if(void 0===e&&(e=-999),this.highlightLayerData!==e){var n=t?[t]:[];this.highlightLayer.setData({type:"FeatureCollection",features:n},{parser:{type:"geojson"}}),this.highlightLayerData=e}},e.prototype.setSelectLayerSource=function(t){if(void 0===t&&(t=[]),this.selectData.length!==t.length||!(0,i.isEqual)(this.selectData.map((function(t){return t.featureId})),t.map((function(t){return t.featureId})))){var e=t.map((function(t){return t.feature}));this.selectFillLayer.setData({type:"FeatureCollection",features:e},{parser:{type:"geojson"}}),this.selectStrokeLayer.setData({type:"FeatureCollection",features:e},{parser:{type:"geojson"}}),this.selectData=t}},e.prototype.initEvent=function(){this.layer.off("mousemove",this.onHighlighHandle),this.layer.off("unmousemove",this.onHighlighHandle),this.layer.off("click",this.onSelectHandle),this.selectData=[],this.highlightLayerData=null,this.options.state&&(this.options.state.active&&(this.layer.on("mousemove",this.onHighlighHandle),this.layer.on("unmousemove",this.onUnhighlighHandle)),this.options.state.select&&this.layer.on("click",this.onSelectHandle))},e.prototype.addTo=function(t){t.addLayer(this.layer),t.addLayer(this.strokeLayer),t.addLayer(this.highlightLayer),t.addLayer(this.selectFillLayer),t.addLayer(this.selectStrokeLayer)},e.prototype.remove=function(t){t.removeLayer(this.layer),t.removeLayer(this.strokeLayer),t.removeLayer(this.highlightLayer),t.removeLayer(this.selectFillLayer),t.removeLayer(this.selectStrokeLayer)},e.prototype.update=function(e){if(t.prototype.update.call(this,e),this.mappingLayer(this.options),this.options.visible){(0,i.isUndefined)(e.state)||(0,i.isEqual)(this.lastOptions.state,this.options.state)||this.updateHighlightLayer();var n=(0,s.getDefaultState)(this.options.state);n.active.stroke&&this.setHighlightLayerSource(),(n.select.fill||n.select.stroke)&&this.setSelectLayerSource()}this.initEvent()},e.prototype.updateHighlightLayer=function(){var t=(0,s.getDefaultState)(this.options.state),e=(0,s.getDefaultState)(this.lastOptions.state);e.active.stroke!==t.active.stroke&&(t.active.stroke?this.highlightLayer.show():this.highlightLayer.hide()),e.select.fill!==t.select.fill&&(t.select.fill?this.selectFillLayer.show():this.selectFillLayer.hide()),e.select.stroke!==t.select.stroke&&(t.select.stroke?this.selectStrokeLayer.show():this.selectStrokeLayer.hide())},e.prototype.setIndex=function(t){this.layer.setIndex(t),this.strokeLayer.setIndex(t),this.highlightLayer.setIndex(t+.1),this.selectFillLayer.setIndex(t+.1),this.selectStrokeLayer.setIndex(t+.1)},e.prototype.setMinZoom=function(t){this.layer.setMinZoom(t),this.strokeLayer.setMinZoom(t),this.highlightLayer.setMinZoom(t),this.selectFillLayer.setMinZoom(t),this.selectStrokeLayer.setMinZoom(t)},e.prototype.setMaxZoom=function(t){this.layer.setMaxZoom(t),this.strokeLayer.setMaxZoom(t),this.highlightLayer.setMaxZoom(t),this.selectFillLayer.setMaxZoom(t),this.selectStrokeLayer.setMaxZoom(t)},e.prototype.show=function(){this.layer.inited&&(this.layer.show(),this.strokeLayer.show(),this.selectFillLayer.show(),this.selectStrokeLayer.show())},e.prototype.hide=function(){this.layer.inited&&(this.layer.hide(),this.strokeLayer.hide(),this.selectFillLayer.hide(),this.selectStrokeLayer.hide())},e.prototype.getColorLegendItems=function(){var t=this.layer.getLegendItems("color");return Array.isArray(t)&&0!==t.length?(0,u.getColorLegendItems)(t):[]},e.prototype.setActive=function(t){},e.prototype.setSelect=function(t){},e.DefaultOptions=l,e.LayerOptionsKeys=a.PlotLayer.LayerConfigkeys.concat(c),e}(a.PlotLayer);e.AreaLayer=p},74939:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ColumnLayer=void 0;var r=n(70655),i=n(57042),o=n(94340),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=o.DotLayer.LayerType.ColumnLayer,e}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return(0,i.deepAssign)({},o.DotLayer.DefaultOptions,{shape:"cylinder"})},e}(o.DotLayer);e.ColumnLayer=a},49855:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DotDensityLayer=void 0;var r=n(70655),i=n(57042),o=n(94340),a=["color","size","style","state","animate"],s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=o.DotLayer.LayerType.DotDensity,e.interaction=!1,e}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return(0,i.deepAssign)({},o.DotLayer.DefaultOptions,{shape:"dot",size:1})},e.LayerOptionsKeys=o.DotLayer.LayerConfigkeys.concat(a),e}(o.DotLayer);e.DotDensityLayer=s},22050:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.mappingLayer=void 0;var r=n(27544);e.mappingLayer=function(t,e){var n=e.shape,i=e.color,o=e.size,a=e.style,s=e.state,u=e.animate;n&&r.MappingLayer.shape(t,n),o&&r.MappingLayer.size(t,o),i&&r.MappingLayer.color(t,i),a&&r.MappingLayer.style(t,a),s&&r.MappingLayer.state(t,s),u&&r.MappingLayer.animate(t,u)}},88006:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getColorLegendItems=void 0;var r=n(70655);e.getColorLegendItems=function(t){var e=[];if(function(t){return"number"==typeof t[0].value}(t)){if(1===t.length){var n=t[0];return[{color:u=n.color,value:p=[l=n.value,l]}]}for(var i=new Map,o=void 0,a=0;a<t.length;a++){var s=t[a],u=s.color,l=s.value;if(i.has(u)){var c=i.get(u);Array.isArray(c)&&c.push(l)}else{var p=[l];i.set(u,p),o&&o.push(l),o=p}}i.forEach((function(t,n){var r=[t[0],t[t.length-1]];e.push({color:n,value:r})}))}else e=t.map((function(t){return(0,r.__assign)((0,r.__assign)({},t),{value:[Math.ceil(t.value[0]),Math.ceil(t.value[1])]})}));return e}},94340:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DotLayer=void 0;var r=n(70655),i=n(14062),o=n(91011),a=n(19093),s=n(22050),u=n(88006),l={source:{data:[],parser:{type:"json",x:"x",y:"y"}},shape:"circle",size:12,color:"#5FD3A6"},c=["shape","color","size","style","state","animate"],p=function(t){function e(e){var n=t.call(this,e)||this;n.type=a.PlotLayer.LayerType.DotLayer,n.interaction=!0;var s=n.options,u=s.name,l=s.source,c=n.pickLayerConfig(n.options);return n.name=u||(0,i.uniqueId)(n.type),n.layer=new o.PointLayer((0,r.__assign)((0,r.__assign)({},c),{name:n.name})),n.mappingLayer(n.layer,n.options),n.setSource(l),n}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return l},e.prototype.mappingLayer=function(t,e){(0,s.mappingLayer)(t,e)},e.prototype.update=function(e){t.prototype.update.call(this,e),this.mappingLayer(this.layer,this.options)},e.prototype.getColorLegendItems=function(){var t=this.layer.getLegendItems("color");return Array.isArray(t)&&0!==t.length?(0,u.getColorLegendItems)(t):[]},e.DefaultOptions=l,e.LayerOptionsKeys=a.PlotLayer.LayerConfigkeys.concat(c),e}(a.PlotLayer);e.DotLayer=p},39655:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.mappingLayer=void 0;var r=n(27544);e.mappingLayer=function(t,e){var n=e.shape,i=e.color,o=e.size,a=e.style,s=e.state;n&&r.MappingLayer.shape(t,n),o&&r.MappingLayer.size(t,o),i&&r.MappingLayer.color(t,i),a&&r.MappingLayer.style(t,a),s&&r.MappingLayer.state(t,s)}},25140:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.GridLayer=void 0;var r=n(70655),i=n(14062),o=n(91011),a=n(19093),s=n(39655),u={source:{data:[],parser:{type:"json",x:"x",y:"y"},aggregation:{type:"grid",field:"",radius:15e3,method:"sum"}},shape:"square",color:"#5FD3A6",style:{coverage:.9,angle:0,opacity:1}},l=["shape","color","size","style","state"],c=function(t){function e(e){var n=t.call(this,e)||this;n.type=a.PlotLayer.LayerType.GridLayer,n.interaction=!1;var s=n.options,u=s.name,l=s.source,c=n.pickLayerConfig(n.options);return n.name=u||(0,i.uniqueId)(n.type),n.layer=new o.HeatmapLayer((0,r.__assign)((0,r.__assign)({},c),{name:n.name})),n.mappingLayer(n.layer,n.options),n.setSource(l),n}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return u},e.prototype.mappingLayer=function(t,e){(0,s.mappingLayer)(t,e)},e.prototype.update=function(e){t.prototype.update.call(this,e),this.mappingLayer(this.layer,this.options)},e.DefaultOptions=u,e.LayerOptionsKeys=a.PlotLayer.LayerConfigkeys.concat(l),e}(a.PlotLayer);e.GridLayer=c},79634:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.mappingLayer=void 0;var r=n(27544);e.mappingLayer=function(t,e){var n=e.shape,i=e.size,o=e.style,a=e.state;n&&r.MappingLayer.shape(t,n),i&&r.MappingLayer.size(t,i),o&&("colorsRamp"in o&&(o.rampColors=function(t){var e=t.colorsRamp,n={colors:[],positions:[]};return e.forEach((function(t){var e=t.color,r=t.position;n.colors.push(e),n.positions.push(r)})),n}(o)),r.MappingLayer.style(t,o)),a&&r.MappingLayer.state(t,a)}},99177:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.HeatmapLayer=void 0;var r=n(70655),i=n(14062),o=n(91011),a=n(19093),s=n(79634),u={source:{data:[],parser:{type:"json",x:"x",y:"y"}},shape:"heatmap",size:{value:[0,1]},style:{intensity:3,radius:20,opacity:1,colorsRamp:[{color:"rgba(33,102,172,0.0)",position:0},{color:"rgb(103,169,207)",position:.2},{color:"rgb(209,229,240)",position:.4},{color:"rgb(253,219,199)",position:.6},{color:"rgb(239,138,98)",position:.8},{color:"rgb(178,24,43,1.0)",position:1}]}},l=["shape","color","size","style","state"],c=function(t){function e(e){var n=t.call(this,e)||this;n.type=a.PlotLayer.LayerType.HeatmapLayer,n.interaction=!1;var s=n.options,u=s.name,l=s.source,c=n.pickLayerConfig(n.options);return n.name=u||(0,i.uniqueId)(n.type),n.layer=new o.HeatmapLayer((0,r.__assign)((0,r.__assign)({},c),{name:n.name})),n.mappingLayer(n.layer,n.options),n.setSource(l),n}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return u},e.prototype.mappingLayer=function(t,e){(0,s.mappingLayer)(t,e)},e.prototype.update=function(e){t.prototype.update.call(this,e),this.mappingLayer(this.layer,this.options)},e.DefaultOptions=u,e.LayerOptionsKeys=a.PlotLayer.LayerConfigkeys.concat(l),e}(a.PlotLayer);e.HeatmapLayer=c},460:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.mappingLayer=void 0;var r=n(27544);e.mappingLayer=function(t,e){var n=e.shape,i=e.color,o=e.size,a=e.style,s=e.state;n&&r.MappingLayer.shape(t,n),o&&r.MappingLayer.size(t,o),i&&r.MappingLayer.color(t,i),a&&r.MappingLayer.style(t,a),s&&r.MappingLayer.state(t,s)}},89645:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.HexbinLayer=void 0;var r=n(70655),i=n(14062),o=n(91011),a=n(19093),s=n(460),u={source:{data:[],parser:{type:"json",x:"x",y:"y"},aggregation:{type:"hexagon",field:"",radius:15e3,method:"sum"}},shape:"hexagon",color:"#5FD3A6",style:{coverage:.9,angle:0,opacity:1}},l=["shape","color","size","style","state"],c=function(t){function e(e){var n=t.call(this,e)||this;n.type=a.PlotLayer.LayerType.HexbinLayer,n.interaction=!1;var s=n.options,u=s.name,l=s.source,c=n.pickLayerConfig(n.options);return n.name=u||(0,i.uniqueId)(n.type),n.layer=new o.HeatmapLayer((0,r.__assign)((0,r.__assign)({},c),{name:n.name})),n.mappingLayer(n.layer,n.options),n.setSource(l),n}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return u},e.prototype.mappingLayer=function(t,e){(0,s.mappingLayer)(t,e)},e.prototype.update=function(e){t.prototype.update.call(this,e),this.mappingLayer(this.layer,this.options)},e.DefaultOptions=u,e.LayerOptionsKeys=a.PlotLayer.LayerConfigkeys.concat(l),e}(a.PlotLayer);e.HexbinLayer=c},39276:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.IconLayer=void 0;var r=n(70655),i=n(57042),o=n(94340),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=o.DotLayer.LayerType.IconLayer,e}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return(0,i.deepAssign)({},o.DotLayer.DefaultOptions,{color:void 0})},e}(o.DotLayer);e.IconLayer=a},93627:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.mappingLayer=void 0;var r=n(27544);e.mappingLayer=function(t,e){var n=e.shape,i=e.color,o=e.size,a=e.style,s=e.state,u=e.animate,l=e.texture;n&&r.MappingLayer.shape(t,n),o&&r.MappingLayer.size(t,o),i&&r.MappingLayer.color(t,i),a&&r.MappingLayer.style(t,a),s&&r.MappingLayer.state(t,s),u&&r.MappingLayer.animate(t,u),l&&r.MappingLayer.texture(t,l)}},34213:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LinesLayer=void 0;var r=n(70655),i=n(14062),o=n(91011),a=n(19093),s=n(93627),u=n(88006),l={},c=["shape","color","size","style","state","animate"],p=function(t){function e(e){var n=t.call(this,e)||this;n.type=a.PlotLayer.LayerType.LinesLayer,n.interaction=!0;var s=n.options,u=s.name,l=s.source,c=n.pickLayerConfig(n.options);return n.name=u||(0,i.uniqueId)(n.type),n.layer=new o.LineLayer((0,r.__assign)((0,r.__assign)({},c),{name:n.name})),n.mappingLayer(n.layer,n.options),n.setSource(l),n}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return l},e.prototype.mappingLayer=function(t,e){(0,s.mappingLayer)(t,e)},e.prototype.update=function(e){t.prototype.update.call(this,e),this.mappingLayer(this.layer,this.options)},e.prototype.getColorLegendItems=function(){var t=this.layer.getLegendItems("color");return Array.isArray(t)&&0!==t.length?(0,u.getColorLegendItems)(t):[]},e.DefaultOptions=l,e.LayerOptionsKeys=a.PlotLayer.LayerConfigkeys.concat(c),e}(a.PlotLayer);e.LinesLayer=p},84591:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PathLayer=void 0;var r=n(70655),i=n(57042),o=n(34213),a=["color","size","style","state","animate"],s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=o.LinesLayer.LayerType.PathLayer,e}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return(0,i.deepAssign)({},o.LinesLayer.DefaultOptions,{shape:"line"})},e.LayerOptionsKeys=o.LinesLayer.LayerConfigkeys.concat(a),e}(o.LinesLayer);e.PathLayer=s},19868:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.mappingLayer=void 0;var r=n(27544);e.mappingLayer=function(t,e){var n=e.color,i=e.size,o=e.style,a=e.state;r.MappingLayer.shape(t,"extrude"),i&&r.MappingLayer.size(t,i),n&&r.MappingLayer.color(t,n),o&&r.MappingLayer.style(t,o),a&&r.MappingLayer.state(t,a)}},17937:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PrismLayer=void 0;var r=n(70655),i=n(14062),o=n(91011),a=n(19093),s=n(19868),u=n(88006),l={},c=["color","size","style","state"],p=function(t){function e(e){var n=t.call(this,e)||this;n.type=a.PlotLayer.LayerType.PrismLayer,n.interaction=!0;var s=n.options,u=s.name,l=s.source,c=n.pickLayerConfig(n.options);return n.name=u||(0,i.uniqueId)(n.type),n.layer=new o.PolygonLayer((0,r.__assign)((0,r.__assign)({},c),{name:n.name})),n.mappingLayer(n.layer,n.options),n.setSource(l),n}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return l},e.prototype.mappingLayer=function(t,e){(0,s.mappingLayer)(t,e)},e.prototype.update=function(e){t.prototype.update.call(this,e),this.mappingLayer(this.layer,this.options)},e.prototype.getColorLegendItems=function(){var t=this.layer.getLegendItems("color");return Array.isArray(t)&&0!==t.length?(0,u.getColorLegendItems)(t):[]},e.DefaultOptions=l,e.LayerOptionsKeys=a.PlotLayer.LayerConfigkeys.concat(c),e}(a.PlotLayer);e.PrismLayer=p},57483:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.mappingLayer=void 0;var r=n(27544);e.mappingLayer=function(t,e){var n=e.field,i=e.content,o=e.style,a=void 0===o?{}:o,s=e.state,u=a.fontSize,l=a.fill,c={field:n||(i||""),value:"text"};r.MappingLayer.shape(t,c),u&&r.MappingLayer.size(t,u),l&&r.MappingLayer.color(t,l),a&&r.MappingLayer.style(t,a),s&&r.MappingLayer.state(t,s)}},71713:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TextLayer=void 0;var r=n(70655),i=n(14062),o=n(91011),a=n(19093),s=n(57483),u={style:{fontSize:12}},l=[],c=function(t){function e(e){var n=t.call(this,e)||this;n.type=a.PlotLayer.LayerType.TextLayer,n.interaction=!1;var s=n.options,u=s.name,l=s.source,c=n.pickLayerConfig(n.options);return n.name=u||(0,i.uniqueId)(n.type),n.layer=new o.PointLayer((0,r.__assign)((0,r.__assign)({},c),{name:n.name})),n.mappingLayer(n.layer,n.options),n.setSource(l),n}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return u},e.prototype.mappingLayer=function(t,e){(0,s.mappingLayer)(t,e)},e.prototype.update=function(e){t.prototype.update.call(this,e),this.mappingLayer(this.layer,this.options)},e.DefaultOptions=u,e.LayerOptionsKeys=a.PlotLayer.LayerConfigkeys.concat(l),e}(a.PlotLayer);e.TextLayer=c},46278:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.L7Plot=void 0;var r=n(70655),i=n(14062),o=n(12392),a=n(57042),s=n(34525),u=n(20183),l={},c=function(t){function e(e,n){var r=t.call(this,n)||this;return r.plots=[],r.container=r.createContainer(e),r.theme=r.createTheme(),r.scene=r.createScene(),r.registerResources(),r.render(),r.inited=!0,r}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return(0,a.deepAssign)({},o.Map.DefaultOptions,e.DefaultOptions)},e.prototype.createLayers=function(){for(var t=new s.LayerGroup([]),e=this.options.layers||[],n=0;n<e.length;n++){var r=this.createLayer(e[n]);t.addLayer(r)}return t},e.prototype.createLayer=function(t){var e=t.type,n=(0,r.__rest)(t,["type"]),o=u.LAYERS_MAP[e];if((0,i.isUndefined)(o))throw new Error("Don't exist ".concat(e," layer"));return new o(n)},e.prototype.addLayer=function(e){if(function(t){return"function"==typeof t.render}(e))t.prototype.addLayer.call(this,e);else{var n=this.createLayer(e);t.prototype.addLayer.call(this,n)}},e.prototype.removeLayerByName=function(t){var e=this.layerGroup.getLayerByName(t);return!!e&&this.layerGroup.removeLayer(e)},e.prototype.updateLayers=function(t){},e.prototype.updatePlots=function(t){},e.prototype.render=function(){var t=this.createLayers();this.inited?(this.layerGroup.removeAllLayer(),t.addTo(this.scene),this.layerGroup=t,this.updateControls()):(this.layerGroup=t,this.onLayersLoaded(),t.addTo(this.scene))},e.prototype.onLayersLoaded=function(){var t=this,e=function(){t.renderPlots(),t.initControls(),t.loaded=!0,t.emit("loaded")};this.scene.sceneService.loaded?(this.sceneLoaded=!0,this.layersLoaded&&e()):this.scene.once("loaded",(function(){t.sceneLoaded=!0,t.layersLoaded&&e()})),this.layerGroup.isEmpty()?this.layersLoaded=!0:this.layerGroup.once("inited-all",(function(){t.layersLoaded=!0,t.sceneLoaded&&e()}))},e.prototype.renderPlots=function(){for(var t=this.options.plots||[],e=0;e<t.length;e++){var n=t[e],r=this.createPlot(n);this.plots.push(r)}},e.prototype.createPlot=function(t){var e=t.type,n=(t.legend,t.layerMenu,(0,r.__rest)(t,["type","legend","layerMenu"])),o=u.PLOTS_MAP[e];if((0,i.isUndefined)(o))throw new Error("Don't exist ".concat(e," plot"));var a=new o(n);return a.attachToScene(this.scene,this.theme),a},e.prototype.addPlot=function(t){var e=this.createPlot(t);this.plots.push(e)},e.prototype.getPlots=function(){return this.plots},e.prototype.getPlotByName=function(t){return this.plots.find((function(e){var n;return(null===(n=e.options)||void 0===n?void 0:n.name)===t}))},e.prototype.removePlotByName=function(t){var e=this.plots.findIndex((function(e){var n;return(null===(n=e.options)||void 0===n?void 0:n.name)===t}));return-1!==e&&((0,r.__read)(this.plots.splice(e,1),1)[0].unattachFromScene(),!0)},e.prototype.removeAllPlot=function(){this.plots.forEach((function(t){t.unattachFromScene()})),this.plots=[]},e.DefaultOptions=l,e}(o.Map);e.L7Plot=c},20183:function(t,e,n){"use strict";var r,i;Object.defineProperty(e,"__esModule",{value:!0}),e.LAYERS_MAP=e.PLOTS_MAP=void 0;var o=n(75516),a=n(76347),s=n(43091),u=n(1403),l=n(83821),c=n(15266),p=n(13778),h=n(8623),f=n(98994),d=n(87883),v=n(71713),m=n(94340),y=n(39276),g=n(74939),_=n(49855),x=n(25140),b=n(89645),w=n(84591),S=n(11997),E=n(99177),C=n(79743),T=n(17937);e.PLOTS_MAP=((r={})[o.PlotType.Dot]=a.Dot,r[o.PlotType.DotDensity]=s.DotDensity,r[o.PlotType.Heatmap]=u.Heatmap,r[o.PlotType.Grid]=l.Grid,r[o.PlotType.Hexbin]=c.Hexbin,r[o.PlotType.Path]=p.Path,r[o.PlotType.Flow]=h.Flow,r[o.PlotType.Area]=f.Area,r[o.PlotType.Choropleth]=d.Choropleth,r),e.LAYERS_MAP=((i={})[o.LayerType.TextLayer]=v.TextLayer,i[o.LayerType.DotLayer]=m.DotLayer,i[o.LayerType.IconLayer]=y.IconLayer,i[o.LayerType.DotDensity]=_.DotDensityLayer,i[o.LayerType.ColumnLayer]=g.ColumnLayer,i[o.LayerType.HeatmapLayer]=E.HeatmapLayer,i[o.LayerType.GridLayer]=x.GridLayer,i[o.LayerType.HexbinLayer]=b.HexbinLayer,i[o.LayerType.PathLayer]=w.PathLayer,i[o.LayerType.ArcLayer]=S.ArcLayer,i[o.LayerType.AreaLayer]=C.AreaLayer,i[o.LayerType.PrismLayer]=T.PrismLayer,i)},57925:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DEFAULT_OPTIONS=void 0;var r=n(3071),i=n(57042);e.DEFAULT_OPTIONS=(0,i.deepAssign)({},r.Plot.DefaultOptions,{source:{data:{type:"FeatureCollection",features:[]},parser:{type:"geojson"}}})},98994:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Area=void 0;var r=n(70655),i=n(14062),o=n(3071),a=n(57925),s=n(79743),u=n(34525),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=o.Plot.PlotType.Area,e}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return e.DefaultOptions},e.prototype.createLayers=function(t){this.areaLayer=new s.AreaLayer((0,r.__assign)({source:t},(0,i.pick)(this.options,s.AreaLayer.LayerOptionsKeys)));var e=new u.LayerGroup([this.areaLayer]);return this.options.label&&(this.labelLayer=this.createLabelLayer(t,this.options.label,this.options),e.addLayer(this.labelLayer)),e},e.prototype.updateLayers=function(t){var e=(0,i.pick)(t,s.AreaLayer.LayerOptionsKeys);this.areaLayer.update(e),this.updateLabelLayer(this.source,t.label,this.options,this.labelLayer)},e.prototype.initLayersEvent=function(){},e.prototype.getLegendOptions=function(){var t=this.areaLayer.getColorLegendItems();return 0!==t.length?{type:"category",items:t}:{}},e.DefaultOptions=a.DEFAULT_OPTIONS,e}(o.Plot);e.Area=l},30201:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.unregisterCacheArea=e.hasCacheArea=e.getCacheArea=e.registerCacheAreas=e.registerCacheArea=e.AREA_CACHE=void 0,e.AREA_CACHE=new Map,e.registerCacheArea=function(t,n){e.AREA_CACHE.set(t,n)},e.registerCacheAreas=function(t){t.forEach((function(t){e.AREA_CACHE.set(t.key,t.area)}))},e.getCacheArea=function(t){return e.AREA_CACHE.get(t)},e.hasCacheArea=function(t){return e.AREA_CACHE.has(t)},e.unregisterCacheArea=function(t){return e.AREA_CACHE.delete(t)}},89102:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CHINA_BOUNDARY_STYLE=e.GEO_AREA_URL=e.GEO_DATA_URL=e.DEFAULT_AREA_GRANULARITY=e.DEFAULT_OPTIONS=void 0;var r=n(3071),i=n(57042);e.DEFAULT_OPTIONS=(0,i.deepAssign)({},r.Plot.DefaultOptions,{source:{data:[],joinBy:{geoField:"adcode"}},viewLevel:{level:"country",adcode:"100000"},chinaBorder:!0}),e.DEFAULT_AREA_GRANULARITY={world:"country",country:"province",province:"city",city:"district",district:"district"},e.GEO_DATA_URL="https://gw.alipayobjects.com/os/alisis/geo-data-v0.1.1",e.GEO_AREA_URL="".concat(e.GEO_DATA_URL,"/choropleth-data"),e.CHINA_BOUNDARY_STYLE={national:{color:"red",width:1,opacity:1},dispute:{color:"red",width:1,opacity:.8,dashArray:[1,6]},coast:{color:"blue",width:.7,opacity:.8},hkm:{color:"gray",width:.7,opacity:.8}}},14207:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getDrillStepDefaultConfig=e.isEqualDrillSteps=e.topojson2geojson=e.getGeoAreaConfig=void 0;var r=n(70655),i=n(14062),o=(0,r.__importStar)(n(18146)),a=n(89102);e.getGeoAreaConfig=function(t){var e={url:a.GEO_AREA_URL,type:"topojson",extension:"topo.json"};return(0,i.isUndefined)(t)||("string"==typeof t?e.url=t:(e.url=(null==t?void 0:t.url)||a.GEO_AREA_URL,e.type=t.type,e.extension="topojson"===t.type?"topo.json":"json")),e};e.topojson2geojson=function(t){try{return o.feature(t,"json")}catch(t){throw new Error('Failed convert to geojson from topojson, topojson default layer name "json"')}};e.isEqualDrillSteps=function(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++){var r=t[n],i=r.level,o=r.granularity;if(e[n].level!==i||e[n].granularity!==o)return!1}return!0};e.getDrillStepDefaultConfig=function(t){return(0,i.pick)(t,["source","color","style","state","label","tooltip"])}},87883:function(t,e,n){"use strict";var r=n(25108);Object.defineProperty(e,"__esModule",{value:!0}),e.Choropleth=void 0;var i=n(70655),o=n(14062),a=n(3071),s=n(57042),u=n(89102),l=n(79743),c=n(71713),p=n(75516),h=n(34525),f=n(87405),d=n(30201),v=n(14207),m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=a.Plot.PlotType.Choropleth,e.chinaBoundaryData={type:"FeatureCollection",features:[]},e.currentDistrictData={type:"FeatureCollection",features:[]},e.drillSteps=[],e.drillStacks=[],e.onDrillDownHander=function(t){var n,r=e.options.drill,o=r.steps,a=r.onDown,l=null===(n=t.feature)||void 0===n?void 0:n.properties,c=l.adcode;if(!e.drillStacks.length){var p=e.options.viewLevel,h=p.level,f=p.adcode,d=p.granularity,m=void 0===d?u.DEFAULT_AREA_GRANULARITY[h]:d,y=(0,v.getDrillStepDefaultConfig)(e.options);e.drillStacks=[{level:h,adcode:f,granularity:m,config:y}]}if(e.drillStacks.length!==o.length+1){var g=e.drillStacks.slice(-1)[0],_=e.drillStacks.length-1,x=e.drillSteps[_],b=x.level,w=x.granularity,S=void 0===w?u.DEFAULT_AREA_GRANULARITY[b]:w,E=(0,i.__rest)(x,["level","granularity"]),C={from:{level:g.level,adcode:g.adcode,granularity:g.granularity},to:{level:b,adcode:c,granularity:S,properties:l}},T=function(t){void 0===t&&(t={});var n={level:b,adcode:c,granularity:S},r=(0,s.deepAssign)({},E,t);e.changeView(n,r).then((function(t){t&&(e.drillStacks.push(t),e.emit("drilldown",C))}))};a?a(C.from,C.to,T):T()}},e.onDrillUpHander=function(){var t=e.options.drill.onUp;if(!(0===e.drillStacks.length||1===e.drillStacks.length)){var n=e.drillStacks.length-1,r=e.drillStacks[n],i=e.drillStacks[n-1],o={from:{level:r.level,adcode:r.adcode,granularity:r.granularity},to:{level:i.level,adcode:i.adcode,granularity:i.granularity}},a=function(t){void 0===t&&(t={});var n=o.to,r=(0,s.deepAssign)({},i.config,t);e.changeView(n,r).then((function(t){t&&(e.drillStacks.pop(),e.emit("drillup",o))}))};t?t(o.from,o.to,a):a()}},e}return(0,i.__extends)(e,t),e.prototype.initLayers=function(){var t=this;this.getInitDistrictData().then((function(){t.source=t.createSource(),t.render(),t.inited=!0}))},e.prototype.render=function(){if(r.time("l7plot choropleth render time"),this.inited)this.scene.setEnableRender(!0),this.scene.render();else{var t=this.createLayers(this.source);this.layerGroup=t,this.onLayersLoaded(),t.addTo(this.scene),this.initLayersEvent()}r.timeEnd("l7plot choropleth render time")},e.prototype.update=function(t){var e,n,a,s=this;if(this.updateOption(t),t.map&&!(0,o.isEqual)(this.lastOptions.map,this.options.map)&&this.updateMap(t.map),t.drill&&!1!==t.drill.enabled&&!(0,o.isEqual)(null===(e=this.lastOptions.drill)||void 0===e?void 0:e.steps,null===(n=this.options.drill)||void 0===n?void 0:n.steps)&&this.drillReset(),this.scene.setEnableRender(!1),t.viewLevel&&!(0,o.isEqual)(this.lastOptions.viewLevel,this.options.viewLevel)){var u=null===(a=t.source)||void 0===a?void 0:a.joinBy.geoData;r.time("l7plot choropleth update viewLevel time"),this.getDistrictData(u).then((function(){var e=s.options.source,n=e.data,o=(0,i.__rest)(e,["data"]);s.changeData(n,o),s.updateLayers(t),s.render(),s.updateComponents(),r.timeEnd("l7plot choropleth update viewLevel time"),s.emit("update")}))}else{if(t.source&&!(0,o.isEqual)(this.lastOptions.source,this.options.source)){var l=this.options.source,c=l.data,p=(0,i.__rest)(l,["data"]);this.changeData(c,p)}this.updateLayers(t),this.render(),this.updateComponents(),this.emit("update")}},e.prototype.getDefaultOptions=function(){return e.DefaultOptions},e.prototype.parserSourceConfig=function(t){var e=t.data,n=t.joinBy,r=(0,i.__rest)(t,["data","joinBy"]),o=n.sourceField,a=n.geoField,s=n.geoData,u={type:"join",sourceField:o,targetField:a,data:e};return r.transforms?r.transforms.push(u):r.transforms=[u],r.parser&&delete r.parser,{data:s,sourceCFG:r}},e.prototype.createSource=function(){var t=this.parserSourceConfig(this.options.source),e=t.data,n=t.sourceCFG;return new p.Source(e,n)},e.prototype.changeData=function(t,e){r.time("l7plot choropleth update data time"),this.options.source=(0,s.deepAssign)({},this.options.source,(0,i.__assign)({data:t},e));var n=this.parserSourceConfig(this.options.source),o=n.data,a=n.sourceCFG;this.source.setData(o,a),r.timeEnd("l7plot choropleth update data time"),this.options.legend&&this.updateLegendControl(this.options.legend),this.emit("change-data")},e.prototype.createLayers=function(t){this.fillAreaLayer=new l.AreaLayer((0,i.__assign)({name:"fillAreaLayer",source:t},(0,o.pick)(this.options,l.AreaLayer.LayerOptionsKeys)));var e=new h.LayerGroup([this.fillAreaLayer]);if(this.options.chinaBorder){var n=this.createCountryBoundaryLayer(this.chinaBoundaryData,this.options),r=n.chinaBoundaryLayer,a=n.chinaDisputeBoundaryLayer;this.chinaBoundaryLayer=r,this.chinaDisputeBoundaryLayer=a,e.addLayer(this.chinaBoundaryLayer),e.addLayer(this.chinaDisputeBoundaryLayer)}return this.options.label&&(this.labelLayer=this.createLabelLayer(t,this.options.label),e.addLayer(this.labelLayer)),e},e.prototype.createCountryBoundaryLayer=function(t,e){var n=(0,f.createCountryBoundaryLayer)(t,e);return{chinaBoundaryLayer:n.chinaBoundaryLayer,chinaDisputeBoundaryLayer:n.chinaDisputeBoundaryLayer}},e.prototype.createLabelLayer=function(t,e){var n=this,r=t.originData.features.map((function(t){var e=t.properties;return Object.assign({},e,{centroid:e.centroid||e.center})})).filter((function(t){return t.centroid})),o=this.options,a=o.visible,s=o.minZoom,u=o.maxZoom,l=o.zIndex,p=void 0===l?0:l,h=new c.TextLayer((0,i.__assign)({name:"labelLayer",source:{data:r,parser:{type:"json",coordinates:"centroid"},transforms:t.transforms},visible:a,minZoom:s,maxZoom:u,zIndex:p+.1},e)),f=function(){var t=n.source.originData.features.map((function(t){return t.properties})).filter((function(t){return t.centroid}));h.layer.setData(t)};return t.on("update",f),h.on("remove",(function(){t.off("update",f)})),h},e.prototype.updateLayers=function(t){var e=(0,o.pick)(t,l.AreaLayer.LayerOptionsKeys);if(this.fillAreaLayer.update(e),t.chinaBorder){if(!this.chinaBoundaryLayer){var n=this.createCountryBoundaryLayer(this.chinaBoundaryData,this.options),r=n.chinaBoundaryLayer,i=n.chinaDisputeBoundaryLayer;this.chinaBoundaryLayer=r,this.chinaDisputeBoundaryLayer=i,this.layerGroup.addLayer(this.chinaBoundaryLayer),this.layerGroup.addLayer(this.chinaDisputeBoundaryLayer)}}else!1===t.chinaBorder&&(this.chinaBoundaryLayer&&this.layerGroup.removeLayer(this.chinaBoundaryLayer),this.chinaDisputeBoundaryLayer&&this.layerGroup.removeLayer(this.chinaDisputeBoundaryLayer));this.updateLabelLayer(this.source,t.label,this.options,this.labelLayer)},e.prototype.initLayersEvent=function(){this.initDrillEvent()},e.prototype.initDrillEvent=function(){if(this.lastOptions.drill){var t=this.lastOptions.drill,e=t.triggerUp,n=void 0===e?"unclick":e,r=t.triggerDown,i=void 0===r?"click":r;this.fillAreaLayer.off(n,this.onDrillUpHander),this.fillAreaLayer.off(i,this.onDrillDownHander)}if(this.options.drill&&!1!==this.options.drill.enabled){var o=this.options.drill,a=o.steps,s=o.triggerUp,l=void 0===s?"unclick":s,c=o.triggerDown,p=void 0===c?"click":c,h=a.map((function(t){return"string"==typeof t?{level:t,granularity:u.DEFAULT_AREA_GRANULARITY[t]}:(t.granularity||(t.granularity=u.DEFAULT_AREA_GRANULARITY[t.level]),t)}));(0,v.isEqualDrillSteps)(h,this.drillSteps)||(this.drillSteps=h,this.drillStacks=[]),this.fillAreaLayer.on(l,this.onDrillUpHander),this.fillAreaLayer.on(p,this.onDrillDownHander)}},e.prototype.drillReset=function(){this.drillStacks=[]},e.prototype.getLegendOptions=function(){var t=this.fillAreaLayer.getColorLegendItems();return 0!==t.length?{type:"category",items:t}:{}},e.prototype.fetchData=function(t,e,n){return(0,i.__awaiter)(this,void 0,void 0,(function(){var r,o,a,s,u,l,c;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:return r="".concat(e,"_").concat(t,"_").concat(n),(o=(0,d.getCacheArea)(r))?[2,o]:(a=(0,v.getGeoAreaConfig)(this.options.geoArea),s=a.url,u=a.type,l=a.extension,[4,fetch("".concat(s,"/").concat(t,"/").concat(r,".").concat(l))]);case 1:return[4,i.sent().json()];case 2:return c=i.sent(),"topojson"===u&&(c=(0,v.topojson2geojson)(c)),(0,d.registerCacheArea)(r,c),[2,c]}}))}))},e.prototype.getInitDistrictData=function(){var t;return(0,i.__awaiter)(this,void 0,void 0,(function(){var e,n,r,o;return(0,i.__generator)(this,(function(a){switch(a.label){case 0:e=this.fetchData("country","100000","boundary"),n=null===(t=this.options.source)||void 0===t?void 0:t.joinBy.geoData,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,Promise.all([e,this.getDistrictData(n)])];case 2:return o=i.__read.apply(void 0,[a.sent(),1]),this.chinaBoundaryData=o[0],[3,4];case 3:throw r=a.sent(),new Error("Failed to get china boundary data，".concat(r));case 4:return[2]}}))}))},e.prototype.getDistrictData=function(t){return(0,i.__awaiter)(this,void 0,void 0,(function(){var e,n,r,o,a,l,c,p;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:e=this.options.viewLevel,n=e.level,r=e.adcode,o=e.granularity,a=void 0===o?u.DEFAULT_AREA_GRANULARITY[n]:o,l=t?Promise.resolve(t):this.fetchData(n,r,a),i.label=1;case 1:return i.trys.push([1,3,,4]),c=this,[4,l];case 2:return c.currentDistrictData=i.sent(),this.options.source=(0,s.deepAssign)({},this.options.source,{joinBy:{geoData:this.currentDistrictData}}),[3,4];case 3:throw p=i.sent(),new Error("Failed to get district data，".concat(p));case 4:return[2]}}))}))},e.prototype.drillDown=function(t,e){var n=this;void 0===e&&(e={}),this.changeView(t,e).then((function(t){t&&n.drillStacks.push(t)}))},e.prototype.drillUp=function(t){if(void 0===t&&(t={}),!(0===this.drillStacks.length||1===this.drillStacks.length)){var e=this.drillStacks.length-1,n=this.drillStacks[e-1],r=n.config,o=(0,i.__rest)(n,["config"]),a=(0,s.deepAssign)({},r,t);this.changeView(o,a),this.drillStacks.pop()}},e.prototype.changeView=function(t,e){return void 0===e&&(e={}),(0,i.__awaiter)(this,void 0,void 0,(function(){var n,r,o,a,l,c;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:return n=t.level,r=t.adcode,o=t.granularity,a=void 0===o?u.DEFAULT_AREA_GRANULARITY[n]:o,[4,this.fetchData(n,r,a)];case 1:return(l=i.sent()).features.length?(c=(0,s.deepAssign)({},(0,v.getDrillStepDefaultConfig)(this.options),e,{viewLevel:{level:n,adcode:r,granularity:a},source:{joinBy:{geoData:l}}}),this.update(c),[2,{level:n,adcode:r,granularity:a,config:c}]):[2]}}))}))},e.DefaultOptions=u.DEFAULT_OPTIONS,e.GeoDataUrl=u.GEO_DATA_URL,e.GeoAreaUrl=u.GEO_AREA_URL,e}(a.Plot);e.Choropleth=m},87405:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.createCountryBoundaryLayer=void 0;var r=n(57042),i=n(84591),o=n(89102);e.createCountryBoundaryLayer=function(t,e){var n=e||{},a=n.visible,s=n.minZoom,u=n.maxZoom,l=n.zIndex,c=void 0===l?0:l,p=n.chinaBorder,h="object"==typeof p?(0,r.deepAssign)({},o.CHINA_BOUNDARY_STYLE,p):o.CHINA_BOUNDARY_STYLE,f=t.features.filter((function(t){var e=t.properties;return["coast","hkm","national"].includes(null==e?void 0:e.type)})),d=t.features.filter((function(t){var e=t.properties;return"dispute"===(null==e?void 0:e.type)})),v=new i.PathLayer({name:"chinaBoundaryLayer",visible:a,minZoom:s,maxZoom:u,zIndex:c+.1,source:{data:{type:"FeatureCollection",features:f},parser:{type:"geojson"}},color:{field:"type",value:function(t){var e=t.type;return h[e].color}},size:{field:"type",value:function(t){var e=t.type;return h[e].width}},style:{opacity:["type",function(t){return h[t].opacity}]}});return{chinaBoundaryLayer:v,chinaDisputeBoundaryLayer:new i.PathLayer({name:"chinaDisputeBoundaryLayer",visible:a,minZoom:s,maxZoom:u,zIndex:c+.1,source:{data:{type:"FeatureCollection",features:d},parser:{type:"geojson"}},color:h.dispute.color,size:h.dispute.width,style:{opacity:h.dispute.opacity,lineType:"dash",dashArray:h.dispute.dashArray}})}}},86514:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DEFAULT_OPTIONS=void 0;var r=n(3071),i=n(57042);e.DEFAULT_OPTIONS=(0,i.deepAssign)({},r.Plot.DefaultOptions,{source:{data:[],parser:{type:"json",x:"x",y:"y"}}})},43091:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DotDensity=void 0;var r=n(70655),i=n(14062),o=n(3071),a=n(86514),s=n(34525),u=n(49855),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=o.Plot.PlotType.DotDensity,e}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return e.DefaultOptions},e.prototype.createLayers=function(t){return this.dotDensityLayer=new u.DotDensityLayer((0,r.__assign)({source:t},(0,i.pick)(this.options,u.DotDensityLayer.LayerOptionsKeys))),new s.LayerGroup([this.dotDensityLayer])},e.prototype.updateLayers=function(t){var e=(0,i.pick)(t,u.DotDensityLayer.LayerOptionsKeys);this.dotDensityLayer.update(e)},e.DefaultOptions=a.DEFAULT_OPTIONS,e}(o.Plot);e.DotDensity=l},98486:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DEFAULT_OPTIONS=void 0;var r=n(3071),i=n(57042);e.DEFAULT_OPTIONS=(0,i.deepAssign)({},r.Plot.DefaultOptions,{source:{data:[],parser:{type:"json",x:"x",y:"y"}}})},76347:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Dot=void 0;var r=n(70655),i=n(14062),o=n(3071),a=n(98486),s=n(94340),u=n(34525),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=o.Plot.PlotType.Dot,e}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return e.DefaultOptions},e.prototype.createLayers=function(t){this.dotLayer=new s.DotLayer((0,r.__assign)({source:t},(0,i.pick)(this.options,s.DotLayer.LayerOptionsKeys)));var e=new u.LayerGroup([this.dotLayer]);return this.options.label&&(this.labelLayer=this.createLabelLayer(t,this.options.label,this.options),e.addLayer(this.labelLayer)),e},e.prototype.updateLayers=function(t){var e=(0,i.pick)(t,s.DotLayer.LayerOptionsKeys);this.dotLayer.update(e),this.updateLabelLayer(this.source,t.label,this.options,this.labelLayer)},e.prototype.getLegendOptions=function(){var t=this.dotLayer.getColorLegendItems();return 0!==t.length?{type:"category",items:t}:{}},e.DefaultOptions=a.DEFAULT_OPTIONS,e}(o.Plot);e.Dot=l},53556:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DEFAULT_OPTIONS=void 0;var r=n(3071),i=n(57042);e.DEFAULT_OPTIONS=(0,i.deepAssign)({},r.Plot.DefaultOptions,{source:{data:[],parser:{type:"json"}},shape:"arc"})},8623:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Flow=void 0;var r=n(70655),i=n(14062),o=n(3071),a=n(53556),s=n(11997),u=n(94340),l=n(71713),c=n(34525),p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=o.Plot.PlotType.Flow,e}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return e.DefaultOptions},e.prototype.createLayers=function(t){this.flowLayer=new s.ArcLayer((0,r.__assign)({name:"flowLayer",source:t},(0,i.pick)(this.options,s.ArcLayer.LayerOptionsKeys)));var e=new c.LayerGroup([this.flowLayer]);return this.options.radiation&&(this.radiationLayer=this.createRadiationLayer(t),e.addLayer(this.radiationLayer)),this.options.label&&(this.labelLayer=this.createLabelLayer(t,this.options.label),e.addLayer(this.labelLayer)),e},e.prototype.parserPointData=function(t){var e=[];return t.data.dataArray.forEach((function(t){var n=t.coordinates,i=(0,r.__read)(n,2),o=(i[0],i[1]);e.push((0,r.__assign)((0,r.__assign)({},t),{coordinates:o}))})),e},e.prototype.createRadiationLayer=function(t){var e=this,n=this.parserPointData(t),r=this.options.radiation||{},i=r.enabled,o=void 0===i||i,a=r.color,s=r.size,l=void 0===s?20:s,c=r.shape,p=void 0===c?"circle":c,h=r.animate,f=void 0===h||h,d=new u.DotLayer({name:"radiationLayer",source:{data:n,parser:{type:"json",coordinates:"coordinates"}},visible:o,color:a,size:l,shape:p,animate:f}),v=function(){var t=e.parserPointData(e.source);d.layer.setData(t)};return t.on("update",v),d.on("remove",(function(){t.off("update",v)})),d},e.prototype.createLabelLayer=function(t,e){var n=this,i=this.parserPointData(t),o=this.options,a=o.visible,s=o.minZoom,u=o.maxZoom,c=o.zIndex,p=void 0===c?0:c,h=new l.TextLayer((0,r.__assign)({name:"labelLayer",source:{data:i,parser:{type:"json",coordinates:"coordinates"}},visible:a,minZoom:s,maxZoom:u,zIndex:p+.1},e)),f=function(){var t=n.parserPointData(n.source);h.layer.setData(t)};return t.on("update",f),h.on("remove",(function(){t.off("update",f)})),h},e.prototype.updateLayers=function(t){var e=(0,i.pick)(t,s.ArcLayer.LayerOptionsKeys);if(this.flowLayer.update(e),t.radiation)if(this.radiationLayer){var n=(0,r.__assign)((0,r.__assign)({},t.radiation),{visible:t.radiation.enabled});this.radiationLayer.update(n)}else this.radiationLayer=this.createRadiationLayer(this.source),this.layerGroup.addLayer(this.radiationLayer);this.updateLabelLayer(this.source,t.label,this.options,this.labelLayer)},e.prototype.getLegendOptions=function(){var t=this.flowLayer.getColorLegendItems();return 0!==t.length?{type:"category",items:t}:{}},e.DefaultOptions=a.DEFAULT_OPTIONS,e}(o.Plot);e.Flow=p},62120:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DEFAULT_OPTIONS=void 0;var r=n(3071),i=n(57042);e.DEFAULT_OPTIONS=(0,i.deepAssign)({},r.Plot.DefaultOptions,{source:{data:[],parser:{type:"json",x:"x",y:"y"},aggregation:{type:"grid",radius:15e3,method:"sum"}}})},83821:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Grid=void 0;var r=n(70655),i=n(14062),o=n(3071),a=n(62120),s=n(25140),u=n(34525),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=o.Plot.PlotType.Grid,e}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return e.DefaultOptions},e.prototype.createLayers=function(t){this.gridLayer=new s.GridLayer((0,r.__assign)({source:t},(0,i.pick)(this.options,s.GridLayer.LayerOptionsKeys)));var e=new u.LayerGroup([this.gridLayer]);return this.options.label&&(this.labelLayer=this.createLabelLayer(this.source,this.options.label,this.options),e.addLayer(this.labelLayer)),e},e.prototype.updateLayers=function(t){var e=(0,i.pick)(t,s.GridLayer.LayerOptionsKeys);this.gridLayer.update(e),this.updateLabelLayer(this.source,t.label,this.options,this.labelLayer)},e.DefaultOptions=a.DEFAULT_OPTIONS,e}(o.Plot);e.Grid=l},79455:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DEFAULT_OPTIONS=void 0;var r=n(3071),i=n(57042);e.DEFAULT_OPTIONS=(0,i.deepAssign)({},r.Plot.DefaultOptions,{source:{data:[],parser:{type:"json",x:"x",y:"y"}}})},1403:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Heatmap=void 0;var r=n(70655),i=n(14062),o=n(3071),a=n(79455),s=n(99177),u=n(34525),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=o.Plot.PlotType.Heatmap,e}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return e.DefaultOptions},e.prototype.createLayers=function(t){this.heatmapLayer=new s.HeatmapLayer((0,r.__assign)({source:t},(0,i.pick)(this.options,s.HeatmapLayer.LayerOptionsKeys)));var e=new u.LayerGroup([this.heatmapLayer]);return this.options.label&&(this.labelLayer=this.createLabelLayer(this.source,this.options.label,this.options),e.addLayer(this.labelLayer)),e},e.prototype.updateLayers=function(t){var e=(0,i.pick)(t,s.HeatmapLayer.LayerOptionsKeys);this.heatmapLayer.update(e),this.updateLabelLayer(this.source,t.label,this.options,this.labelLayer)},e.prototype.getLegendOptions=function(){var t,e=this.heatmapLayer.layer.getLegendItems("size");return Array.isArray(e)&&0!==e.length?{type:"continue",min:e[0].value,max:e[e.length-1].value,colors:null===(t=this.heatmapLayer.options.style)||void 0===t?void 0:t.colorsRamp.map((function(t){return t.color}))}:{}},e.DefaultOptions=a.DEFAULT_OPTIONS,e}(o.Plot);e.Heatmap=l},1625:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DEFAULT_OPTIONS=void 0;var r=n(3071),i=n(57042);e.DEFAULT_OPTIONS=(0,i.deepAssign)({},r.Plot.DefaultOptions,{source:{data:[],parser:{type:"json",x:"x",y:"y"},aggregation:{type:"hexagon",radius:15e3,method:"sum"}}})},15266:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Hexbin=void 0;var r=n(70655),i=n(14062),o=n(3071),a=n(1625),s=n(89645),u=n(34525),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=o.Plot.PlotType.Hexbin,e}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return e.DefaultOptions},e.prototype.createLayers=function(t){this.hexbinLayer=new s.HexbinLayer((0,r.__assign)({source:t},(0,i.pick)(this.options,s.HexbinLayer.LayerOptionsKeys)));var e=new u.LayerGroup([this.hexbinLayer]);return this.options.label&&(this.labelLayer=this.createLabelLayer(this.source,this.options.label,this.options),e.addLayer(this.labelLayer)),e},e.prototype.updateLayers=function(t){var e=(0,i.pick)(t,s.HexbinLayer.LayerOptionsKeys);this.hexbinLayer.update(e),this.updateLabelLayer(this.source,t.label,this.options,this.labelLayer)},e.DefaultOptions=a.DEFAULT_OPTIONS,e}(o.Plot);e.Hexbin=l},8153:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DEFAULT_OPTIONS=void 0;var r=n(3071),i=n(57042);e.DEFAULT_OPTIONS=(0,i.deepAssign)({},r.Plot.DefaultOptions,{source:{data:{type:"FeatureCollection",features:[]},parser:{type:"geojson"}}})},13778:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Path=void 0;var r=n(70655),i=n(14062),o=n(3071),a=n(8153),s=n(84591),u=n(34525),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=o.Plot.PlotType.Path,e}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return e.DefaultOptions},e.prototype.createLayers=function(t){return this.pathLayer=new s.PathLayer((0,r.__assign)({source:t},(0,i.pick)(this.options,s.PathLayer.LayerOptionsKeys))),new u.LayerGroup([this.pathLayer])},e.prototype.updateLayers=function(t){var e=(0,i.pick)(t,s.PathLayer.LayerOptionsKeys);this.pathLayer.update(e)},e.prototype.getLegendOptions=function(){var t=this.pathLayer.getColorLegendItems();return 0!==t.length?{type:"category",items:t}:{}},e.DefaultOptions=a.DEFAULT_OPTIONS,e}(o.Plot);e.Path=l},23316:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.registerTheme=e.getTheme=void 0;var r=n(14062),i=n(4548),o=(0,i.createTheme)({}),a={default:o,light:o,dark:(0,i.createDarkTheme)({})};e.getTheme=function(t){return void 0===t&&(t="default"),(0,r.get)(a,(0,r.lowerCase)(t),a.default)},e.registerTheme=function(t,e,n){void 0===n&&(n="light"),a[(0,r.lowerCase)(t)]="light"===n?(0,i.createTheme)(e):(0,i.createDarkTheme)(e)}},51070:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.dark=e.createDarkStyleSheet=void 0;var n="#000",r="#FFFFFF",i="#A6A6A6",o=["#5B8FF9","#5AD8A6","#5D7092","#F6BD16","#E86452","#6DC8EC","#945FB9","#FF9845","#1E9493","#FF99C3"],a=["#5B8FF9","#CDDDFD","#5AD8A6","#CDF3E4","#5D7092","#CED4DE","#F6BD16","#FCEBB9","#E86452","#F8D0CB","#6DC8EC","#D3EEF9","#945FB9","#DECFEA","#FF9845","#FFE0C7","#1E9493","#BBDEDE","#FF99C3","#FFE0ED"],s=["#B8E1FF","#9AC5FF","#7DAAFF","#5B8FF9","#3D76DD","#085EC0","#0047A5","#00318A","#001D70"];e.createDarkStyleSheet=function(t){void 0===t&&(t={});var e=t.mapStyle,u=void 0===e?"dark":e,l=t.subColor,c=void 0===l?"rgba(255,255,255,0.05)":l,p=t.paletteQualitative10,h=void 0===p?o:p,f=t.paletteQualitative20,d=void 0===f?a:f,v=t.paletteSemanticRed,m=void 0===v?"#F4664A":v,y=t.paletteSemanticGreen,g=void 0===y?"#30BF78":y,_=t.paletteSemanticYellow,x=void 0===_?"#FAAD14":_,b=t.paletteSequence,w=void 0===b?s:b,S=t.fontFamily,E=void 0===S?'"-apple-system", "Segoe UI", Roboto, "Helvetica Neue", Arial,\n    "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",\n    "Noto Color Emoji"':S,C=t.brandColor;return{mapStyle:u,brandColor:void 0===C?h[0]:C,subColor:c,paletteQualitative10:h,paletteQualitative20:d,paletteSemanticRed:m,paletteSemanticGreen:g,paletteSemanticYellow:x,paletteSequence:w,fontFamily:E,legendContainerFillColor:"rgba(31, 31, 31, 0.85)",legendContainerShadow:"0 2px 8px 0 rgba(166, 166, 166, 0.20)",legendContainerBorderRadius:2,legendTextFillColor:i,legendTextFontSize:12,tooltipContainerFillColor:"rgba(31, 31, 31, 0.9)",tooltipContainerShadow:"0px 2px 4px rgba(0, 0, 0, 0.5)",tooltipContainerBorderRadius:2,tooltipTextFillColor:i,tooltipItemNameFillColor:i,tooltipItemValueFillColor:i,tooltipTextFontSize:12,tooltipTextLineHeight:"20px",labelFillColor:i,labelFillColorDark:"#2c3542",labelFillColorLight:"#ffffff",labelFontSize:12,pointFillColor:o[0],pointFillOpacity:.95,pointSize:4,pointBorder:1,pointBorderColor:n,pointActiveBorderColor:r,pointSelectedBorderColor:r}},e.dark=(0,e.createDarkStyleSheet)()},64349:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.light=e.createLightStyleSheet=void 0;var n="#000",r="#595959",i="#FFFFFF",o=["#5B8FF9","#5AD8A6","#5D7092","#F6BD16","#6F5EF9","#6DC8EC","#945FB9","#FF9845","#1E9493","#FF99C3"],a=["#5B8FF9","#CDDDFD","#5AD8A6","#CDF3E4","#5D7092","#CED4DE","#F6BD16","#FCEBB9","#6F5EF9","#D3CEFD","#6DC8EC","#D3EEF9","#945FB9","#DECFEA","#FF9845","#FFE0C7","#1E9493","#BBDEDE","#FF99C3","#FFE0ED"],s=["#B8E1FF","#9AC5FF","#7DAAFF","#5B8FF9","#3D76DD","#085EC0","#0047A5","#00318A","#001D70"];e.createLightStyleSheet=function(t){void 0===t&&(t={});var e=t.mapStyle,u=void 0===e?"light":e,l=t.subColor,c=void 0===l?"rgba(0,0,0,0.05)":l,p=t.paletteQualitative10,h=void 0===p?o:p,f=t.paletteQualitative20,d=void 0===f?a:f,v=t.paletteSemanticRed,m=void 0===v?"#F4664A":v,y=t.paletteSemanticGreen,g=void 0===y?"#30BF78":y,_=t.paletteSemanticYellow,x=void 0===_?"#FAAD14":_,b=t.paletteSequence,w=void 0===b?s:b,S=t.fontFamily,E=void 0===S?'"-apple-system", "Segoe UI", Roboto, "Helvetica Neue", Arial,\n    "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",\n    "Noto Color Emoji"':S,C=t.brandColor,T=void 0===C?h[0]:C;return{mapStyle:u,brandColor:T,subColor:c,paletteQualitative10:h,paletteQualitative20:d,paletteSemanticRed:m,paletteSemanticGreen:g,paletteSemanticYellow:x,paletteSequence:w,fontFamily:E,legendContainerFillColor:"rgba(255, 255, 255, 0.85)",legendContainerShadow:"0 2px 8px 0 rgba(166, 166, 166, 0.20)",legendContainerBorderRadius:2,legendTextFillColor:r,legendTextFontSize:12,tooltipContainerFillColor:"rgba(255, 255, 255, 0.9)",tooltipContainerShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",tooltipContainerBorderRadius:2,tooltipTextFillColor:r,tooltipItemNameFillColor:r,tooltipItemValueFillColor:r,tooltipTextFontSize:12,tooltipTextLineHeight:"20px",labelFillColor:r,labelFillColorDark:"#2c3542",labelFillColorLight:"#ffffff",labelFontSize:12,pointFillColor:T,pointFillOpacity:.95,pointSize:4,pointBorder:1,pointBorderColor:i,pointActiveBorderColor:n,pointSelectedBorderColor:n}},e.light=(0,e.createLightStyleSheet)()},53830:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.createThemeByStyleSheet=void 0;var r=n(70655),i=(0,r.__importStar)(n(77972)),o=(0,r.__importStar)(n(3876)),a=(0,r.__importStar)(n(56992));e.createThemeByStyleSheet=function(t){var e,n,r,s={point:{default:{fill:t.pointFillColor,size:t.pointSize,stroke:t.pointBorderColor,lineWidth:t.pointBorder,fillOpacity:t.pointFillOpacity},active:{fill:t.pointActiveFillColor},selected:{fill:t.pointSelectedFillColor}}};return{mapStyle:t.mapStyle,defaultColor:t.brandColor,subColor:t.subColor,semanticRed:t.paletteSemanticRed,semanticGreen:t.paletteSemanticGreen,fontFamily:t.fontFamily,colors10:t.paletteQualitative10,colors20:t.paletteQualitative20,sequenceColors:t.paletteSequence,shapes:{point:["circle","square"],line:["line"]},sizes:[1,10],geometries:{point:{circle:{default:{style:s.point.default},active:{style:s.point.active},selected:{style:s.point.selected}}},line:{},polygon:{}},components:{legend:{category:{domStyles:(e={},e[o.CONTAINER_CLASS]={visibility:"visible",zIndex:1,backgroundColor:t.legendContainerFillColor,boxShadow:t.legendContainerShadow,borderRadius:"".concat(t.legendContainerBorderRadius,"px"),color:t.legendTextFillColor,fontFamily:t.fontFamily,padding:"10px",lineHeight:"1",fontSize:"".concat(t.legendTextFontSize,"px")},e[o.TITLE_CLASS]={fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},e[o.LIST_CLASS]={margin:"0px",padding:"0px"},e[o.LIST_ITEM_CLASS]={marginBottom:"2px"},e[o.MARKER_CLASS]={width:"10px",height:"10px"},e[o.VALUE_CLASS]={paddingLeft:"8px"},e)},continue:{domStyles:(n={},n[a.CONTAINER_CLASS]={visibility:"visible",zIndex:1,backgroundColor:t.legendContainerFillColor,boxShadow:t.legendContainerShadow,borderRadius:"".concat(t.legendContainerBorderRadius,"px"),color:t.legendTextFillColor,fontFamily:t.fontFamily,padding:"10px",lineHeight:1,fontSize:"".concat(t.legendTextFontSize,"px")},n[a.TITLE_CLASS]={fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},n[a.RIBBON_CLASS]={display:"flex",alignItems:"center"},n[a.GRADIENT_BAR_CLASS]={width:"140px",height:"14px",margin:"0px 5px"},n[a.VALUE_RANGE_CLASS]={padding:"0px"},n)}},tooltip:{domStyles:(r={},r[i.CONTAINER_CLASS]={visibility:"visible",zIndex:999,transition:"visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1), left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1)",backgroundColor:t.tooltipContainerFillColor,boxShadow:t.tooltipContainerShadow,borderRadius:"".concat(t.tooltipContainerBorderRadius,"px"),color:t.tooltipTextFillColor,fontSize:"".concat(t.tooltipTextFontSize,"px"),fontFamily:t.fontFamily,lineHeight:t.tooltipTextLineHeight},r[i.TITLE_CLASS]={marginBottom:"4px"},r[i.LIST_CLASS]={margin:"0px",padding:"0px"},r[i.LIST_ITEM_CLASS]={marginBottom:"4px"},r[i.NAME_CLASS]={color:t.tooltipItemNameFillColor},r[i.VALUE_CLASS]={color:t.tooltipItemValueFillColor,marginLeft:"30px"},r)},label:{style:{textAnchor:"center",textOffset:[0,0],fill:t.labelFillColor,fontSize:t.labelFontSize,fontFamily:t.fontFamily,fillColorDark:t.labelFillColorDark,fillColorLight:t.labelFillColorLight}}}}}},72985:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.createDarkTheme=e.createTheme=void 0;var r=n(70655),i=n(14062),o=n(53830),a=n(64349),s=n(51070);e.createTheme=function(t){var e=t.styleSheet,n=void 0===e?{}:e,s=(0,r.__rest)(t,["styleSheet"]),u=(0,a.createLightStyleSheet)(n);return(0,i.deepMix)({},(0,o.createThemeByStyleSheet)(u),s)},e.createDarkTheme=function(t){var e=t.styleSheet,n=void 0===e?{}:e,a=(0,r.__rest)(t,["styleSheet"]),u=(0,s.createDarkStyleSheet)(n);return(0,i.deepMix)({},(0,o.createThemeByStyleSheet)(u),a)}},4548:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.createDarkTheme=e.createTheme=void 0;var r=n(72985);Object.defineProperty(e,"createTheme",{enumerable:!0,get:function(){return r.createTheme}}),Object.defineProperty(e,"createDarkTheme",{enumerable:!0,get:function(){return r.createDarkTheme}})},69947:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},1019:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BlendType=void 0;var r=n(20832);Object.defineProperty(e,"BlendType",{enumerable:!0,get:function(){return r.BlendType}});n(37728)},79194:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PositionType=void 0;var r=n(20832);Object.defineProperty(e,"PositionType",{enumerable:!0,get:function(){return r.PositionType}})},75516:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(70655);(0,r.__exportStar)(n(1019),e),(0,r.__exportStar)(n(69947),e),(0,r.__exportStar)(n(55226),e),(0,r.__exportStar)(n(36240),e),(0,r.__exportStar)(n(38113),e),(0,r.__exportStar)(n(53178),e),(0,r.__exportStar)(n(4085),e),(0,r.__exportStar)(n(16995),e),(0,r.__exportStar)(n(79194),e),(0,r.__exportStar)(n(43071),e),(0,r.__exportStar)(n(46690),e)},53178:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},55226:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LayerType=e.LineStyleType=void 0,function(t){t[t.solid=0]="solid",t[t.dash=1]="dash"}(e.LineStyleType||(e.LineStyleType={})),function(t){t.TextLayer="textLayer",t.DotLayer="dotLayer",t.IconLayer="iconLayer",t.DotDensity="dotDensityLayer",t.ColumnLayer="columnLayer",t.HeatmapLayer="heatmapLayer",t.GridLayer="gridLayer",t.HexbinLayer="hexbinLayer",t.LinesLayer="linesLayer",t.PathLayer="pathLayer",t.ArcLayer="arcLayer",t.AreaLayer="areaLayer",t.PrismLayer="prismLayer"}(e.LayerType||(e.LayerType={}))},43071:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},36240:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BaseMapType=e.Source=e.MapboxglMap=void 0;var r=n(70655),i=n(6158);Object.defineProperty(e,"MapboxglMap",{enumerable:!0,get:function(){return i.Map}});var o=(0,r.__importDefault)(n(33591));e.Source=o.default,function(t){t.Amap="amap",t.Mapbox="mapbox"}(e.BaseMapType||(e.BaseMapType={}))},38113:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PlotType=void 0,function(t){t.Dot="dot",t.DotDensity="dotDensity",t.Heatmap="heatmap",t.Grid="grid",t.Hexbin="hexbin",t.Path="path",t.Flow="flow",t.Area="area",t.Choropleth="choropleth"}(e.PlotType||(e.PlotType={}))},16995:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},46690:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},4085:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TooltipAnchorType=void 0;var r=n(35251);Object.defineProperty(e,"TooltipAnchorType",{enumerable:!0,get:function(){return r.anchorType}})},21658:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.deepAssign=void 0;var n=(new Object).toString,r=function(t,e){return n.call(t)==="[object "+e+"]"},i=function(t){return r(t,"Array")},o=function(t){if(!function(t){return"object"==typeof t&&null!==t}(t)||!r(t,"Object"))return!1;for(var e=t;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},a=function(t,e,n,r){for(var s in n=n||0,r=r||5,e)if(Object.prototype.hasOwnProperty.call(e,s)){var u=e[s];u?o(u)?(o(t[s])||(t[s]={}),n<r?a(t[s],u,n+1,r):t[s]=e[s]):i(u)?(t[s]=[],t[s]=t[s].concat(u)):t[s]=u:t[s]=u}};e.deepAssign=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0;r<e.length;r+=1)a(t,e[r]);return t}},57042:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.deepAssign=void 0;var r=n(21658);Object.defineProperty(e,"deepAssign",{enumerable:!0,get:function(){return r.deepAssign}})},14062:function(t,e,n){"use strict";n.r(e),n.d(e,{Cache:function(){return Ce},assign:function(){return Wt},augment:function(){return qt},clamp:function(){return et},clearAnimationFrame:function(){return Gt},clone:function(){return Yt},contains:function(){return i},debounce:function(){return Kt},deepMix:function(){return $t},difference:function(){return a},each:function(){return f},endsWith:function(){return V},every:function(){return G},extend:function(){return te},filter:function(){return o},find:function(){return g},findIndex:function(){return _},firstValue:function(){return x},fixedBase:function(){return nt},flatten:function(){return b},flattenDeep:function(){return S},forIn:function(){return _t},get:function(){return ce},getEllipsisText:function(){return Ee},getRange:function(){return T},getType:function(){return Ot},getWrapBehavior:function(){return K},group:function(){return Y},groupBy:function(){return q},groupToMap:function(){return X},has:function(){return xt},hasKey:function(){return bt},hasValue:function(){return St},head:function(){return B},identity:function(){return xe},includes:function(){return i},indexOf:function(){return ee},isArguments:function(){return Lt},isArray:function(){return p},isArrayLike:function(){return r},isBoolean:function(){return It},isDate:function(){return Rt},isDecimal:function(){return it},isElement:function(){return Ut},isEmpty:function(){return re},isEqual:function(){return oe},isEqualWith:function(){return ae},isError:function(){return Dt},isEven:function(){return ot},isFinite:function(){return Nt},isFunction:function(){return l},isInteger:function(){return at},isMatch:function(){return v},isNegative:function(){return st},isNil:function(){return c},isNull:function(){return Zt},isNumber:function(){return rt},isNumberEqual:function(){return ut},isObject:function(){return h},isObjectLike:function(){return m},isOdd:function(){return lt},isPlainObject:function(){return y},isPositive:function(){return ct},isPrototype:function(){return Ft},isRegExp:function(){return Bt},isString:function(){return D},isType:function(){return u},isUndefined:function(){return jt},keys:function(){return d},last:function(){return j},lowerCase:function(){return Ct},lowerFirst:function(){return Tt},map:function(){return se},mapValues:function(){return le},max:function(){return E},maxBy:function(){return pt},measureTextWidth:function(){return Se},memoize:function(){return Qt},min:function(){return C},minBy:function(){return ht},mix:function(){return Wt},mod:function(){return ft},noop:function(){return _e},number2color:function(){return $},omit:function(){return de},parseRadius:function(){return tt},pick:function(){return fe},pull:function(){return P},pullAt:function(){return L},reduce:function(){return I},remove:function(){return R},requestAnimationFrame:function(){return Vt},set:function(){return pe},size:function(){return be},some:function(){return H},sortBy:function(){return N},startsWith:function(){return U},substitute:function(){return At},throttle:function(){return ve},toArray:function(){return me},toDegree:function(){return vt},toInteger:function(){return mt},toRadian:function(){return gt},toString:function(){return Et},union:function(){return z},uniq:function(){return Z},uniqueId:function(){return ge},upperCase:function(){return Mt},upperFirst:function(){return kt},values:function(){return wt},valuesOfKey:function(){return F},wrapBehavior:function(){return Q}});var r=function(t){return null!==t&&"function"!=typeof t&&isFinite(t.length)},i=function(t,e){return!!r(t)&&t.indexOf(e)>-1},o=function(t,e){if(!r(t))return t;for(var n=[],i=0;i<t.length;i++){var o=t[i];e(o,i)&&n.push(o)}return n},a=function(t,e){return void 0===e&&(e=[]),o(t,(function(t){return!i(e,t)}))},s={}.toString,u=function(t,e){return s.call(t)==="[object "+e+"]"},l=function(t){return u(t,"Function")},c=function(t){return null==t},p=function(t){return Array.isArray?Array.isArray(t):u(t,"Array")},h=function(t){var e=typeof t;return null!==t&&"object"===e||"function"===e};var f=function(t,e){if(t)if(p(t))for(var n=0,r=t.length;n<r&&!1!==e(t[n],n);n++);else if(h(t))for(var i in t)if(t.hasOwnProperty(i)&&!1===e(t[i],i))break},d=Object.keys?function(t){return Object.keys(t)}:function(t){var e=[];return f(t,(function(n,r){l(t)&&"prototype"===r||e.push(r)})),e};var v=function(t,e){var n=d(e),r=n.length;if(c(t))return!r;for(var i=0;i<r;i+=1){var o=n[i];if(e[o]!==t[o]||!(o in t))return!1}return!0},m=function(t){return"object"==typeof t&&null!==t},y=function(t){if(!m(t)||!u(t,"Object"))return!1;if(null===Object.getPrototypeOf(t))return!0;for(var e=t;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e};var g=function(t,e){if(!p(t))return null;var n;if(l(e)&&(n=e),y(e)&&(n=function(t){return v(t,e)}),n)for(var r=0;r<t.length;r+=1)if(n(t[r]))return t[r];return null};var _=function(t,e,n){void 0===n&&(n=0);for(var r=n;r<t.length;r++)if(e(t[r],r))return r;return-1},x=function(t,e){for(var n=null,r=0;r<t.length;r++){var i=t[r][e];if(!c(i)){n=p(i)?i[0]:i;break}}return n},b=function(t){if(!p(t))return[];for(var e=[],n=0;n<t.length;n++)e=e.concat(t[n]);return e},w=function(t,e){if(void 0===e&&(e=[]),p(t))for(var n=0;n<t.length;n+=1)w(t[n],e);else e.push(t);return e},S=w,E=function(t){if(p(t))return t.reduce((function(t,e){return Math.max(t,e)}),t[0])},C=function(t){if(p(t))return t.reduce((function(t,e){return Math.min(t,e)}),t[0])},T=function(t){var e=t.filter((function(t){return!isNaN(t)}));if(!e.length)return{min:0,max:0};if(p(t[0])){for(var n=[],r=0;r<t.length;r++)n=n.concat(t[r]);e=n}var i=E(e);return{min:C(e),max:i}},A=Array.prototype,M=A.splice,k=A.indexOf,P=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0;r<e.length;r++)for(var i=e[r],o=-1;(o=k.call(t,i))>-1;)M.call(t,o,1);return t},O=Array.prototype.splice,L=function(t,e){if(!r(t))return[];for(var n=t?e.length:0,i=n-1;n--;){var o=void 0,a=e[n];n!==i&&a===o||(o=a,O.call(t,a,1))}return t},I=function(t,e,n){if(!p(t)&&!y(t))return t;var r=n;return f(t,(function(t,n){r=e(r,t,n)})),r},R=function(t,e){var n=[];if(!r(t))return n;for(var i=-1,o=[],a=t.length;++i<a;){var s=t[i];e(s,i,t)&&(n.push(s),o.push(i))}return L(t,o),n},D=function(t){return u(t,"String")};var N=function(t,e){var n;if(l(e))n=function(t,n){return e(t)-e(n)};else{var r=[];D(e)?r.push(e):p(e)&&(r=e),n=function(t,e){for(var n=0;n<r.length;n+=1){var i=r[n];if(t[i]>e[i])return 1;if(t[i]<e[i])return-1}return 0}}return t.sort(n),t};function Z(t,e){void 0===e&&(e=new Map);var n=[];if(Array.isArray(t))for(var r=0,i=t.length;r<i;r++){var o=t[r];e.has(o)||(n.push(o),e.set(o,!0))}return n}var z=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Z([].concat.apply([],t))},F=function(t,e){for(var n=[],r={},i=0;i<t.length;i++){var o=t[i][e];if(!c(o)){p(o)||(o=[o]);for(var a=0;a<o.length;a++){var s=o[a];r[s]||(n.push(s),r[s]=!0)}}}return n};function B(t){if(r(t))return t[0]}function j(t){if(r(t)){return t[t.length-1]}}var U=function(t,e){return!(!p(t)&&!D(t))&&t[0]===e};var V=function(t,e){return!(!p(t)&&!D(t))&&t[t.length-1]===e},G=function(t,e){for(var n=0;n<t.length;n++)if(!e(t[n],n))return!1;return!0},H=function(t,e){for(var n=0;n<t.length;n++)if(e(t[n],n))return!0;return!1},W=Object.prototype.hasOwnProperty;var q=function(t,e){if(!e||!p(t))return{};for(var n,r={},i=l(e)?e:function(t){return t[e]},o=0;o<t.length;o++){var a=t[o];n=i(a),W.call(r,n)?r[n].push(a):r[n]=[a]}return r};function X(t,e){if(!e)return{0:t};if(!l(e)){var n=p(e)?e:e.replace(/\s+/g,"").split("*");e=function(t){for(var e="_",r=0,i=n.length;r<i;r++)e+=t[n[r]]&&t[n[r]].toString();return e}}return q(t,e)}var Y=function(t,e){if(!e)return[t];var n=X(t,e),r=[];for(var i in n)r.push(n[i]);return r};var K=function(t,e){return t["_wrap_"+e]};var Q=function(t,e){if(t["_wrap_"+e])return t["_wrap_"+e];var n=function(n){t[e](n)};return t["_wrap_"+e]=n,n},J={};var $=function(t){var e=J[t];if(!e){for(var n=t.toString(16),r=n.length;r<6;r++)n="0"+n;e="#"+n,J[t]=e}return e};var tt=function(t){var e=0,n=0,r=0,i=0;return p(t)?1===t.length?e=n=r=i=t[0]:2===t.length?(e=r=t[0],n=i=t[1]):3===t.length?(e=t[0],n=i=t[1],r=t[2]):(e=t[0],n=t[1],r=t[2],i=t[3]):e=n=r=i=t,{r1:e,r2:n,r3:r,r4:i}},et=function(t,e,n){return t<e?e:t>n?n:t},nt=function(t,e){var n=e.toString(),r=n.indexOf(".");if(-1===r)return Math.round(t);var i=n.substr(r+1).length;return i>20&&(i=20),parseFloat(t.toFixed(i))},rt=function(t){return u(t,"Number")},it=function(t){return rt(t)&&t%1!=0},ot=function(t){return rt(t)&&t%2==0},at=Number.isInteger?Number.isInteger:function(t){return rt(t)&&t%1==0},st=function(t){return rt(t)&&t<0};function ut(t,e,n){return void 0===n&&(n=1e-5),Math.abs(t-e)<n}var lt=function(t){return rt(t)&&t%2!=0},ct=function(t){return rt(t)&&t>0},pt=function(t,e){if(p(t)){for(var n,r=-1/0,i=0;i<t.length;i++){var o=t[i],a=l(e)?e(o):o[e];a>r&&(n=o,r=a)}return n}},ht=function(t,e){if(p(t)){for(var n,r=1/0,i=0;i<t.length;i++){var o=t[i],a=l(e)?e(o):o[e];a<r&&(n=o,r=a)}return n}},ft=function(t,e){return(t%e+e)%e},dt=180/Math.PI,vt=function(t){return dt*t},mt=parseInt,yt=Math.PI/180,gt=function(t){return yt*t},_t=f,xt=function(t,e){return t.hasOwnProperty(e)},bt=xt,wt=Object.values?function(t){return Object.values(t)}:function(t){var e=[];return f(t,(function(n,r){l(t)&&"prototype"===r||e.push(n)})),e},St=function(t,e){return i(wt(t),e)},Et=function(t){return c(t)?"":t.toString()},Ct=function(t){return Et(t).toLowerCase()},Tt=function(t){var e=Et(t);return e.charAt(0).toLowerCase()+e.substring(1)};var At=function(t,e){return t&&e?t.replace(/\\?\{([^{}]+)\}/g,(function(t,n){return"\\"===t.charAt(0)?t.slice(1):void 0===e[n]?"":e[n]})):t},Mt=function(t){return Et(t).toUpperCase()},kt=function(t){var e=Et(t);return e.charAt(0).toUpperCase()+e.substring(1)},Pt={}.toString,Ot=function(t){return Pt.call(t).replace(/^\[object /,"").replace(/]$/,"")},Lt=function(t){return u(t,"Arguments")},It=function(t){return u(t,"Boolean")},Rt=function(t){return u(t,"Date")},Dt=function(t){return u(t,"Error")};function Nt(t){return rt(t)&&isFinite(t)}var Zt=function(t){return null===t},zt=Object.prototype,Ft=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||zt)},Bt=function(t){return u(t,"RegExp")},jt=function(t){return void 0===t},Ut=function(t){return t instanceof Element||t instanceof HTMLDocument};function Vt(t){return(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,16)})(t)}function Gt(t){(window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame||clearTimeout)(t)}function Ht(t,e){for(var n in e)e.hasOwnProperty(n)&&"constructor"!==n&&void 0!==e[n]&&(t[n]=e[n])}function Wt(t,e,n,r){return e&&Ht(t,e),n&&Ht(t,n),r&&Ht(t,r),t}var qt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=t[0],r=1;r<t.length;r++){var i=t[r];l(i)&&(i=i.prototype),Wt(n.prototype,i)}},Xt=function(t){if("object"!=typeof t||null===t)return t;var e;if(p(t)){e=[];for(var n=0,r=t.length;n<r;n++)"object"==typeof t[n]&&null!=t[n]?e[n]=Xt(t[n]):e[n]=t[n]}else for(var i in e={},t)"object"==typeof t[i]&&null!=t[i]?e[i]=Xt(t[i]):e[i]=t[i];return e},Yt=Xt;var Kt=function(t,e,n){var r;return function(){var i=this,o=arguments,a=function(){r=null,n||t.apply(i,o)},s=n&&!r;clearTimeout(r),r=setTimeout(a,e),s&&t.apply(i,o)}},Qt=function(t,e){if(!l(t))throw new TypeError("Expected a function");var n=function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var o=e?e.apply(this,r):r[0],a=n.cache;if(a.has(o))return a.get(o);var s=t.apply(this,r);return a.set(o,s),s};return n.cache=new Map,n};function Jt(t,e,n,r){for(var i in n=n||0,r=r||5,e)if(e.hasOwnProperty(i)){var o=e[i];null!==o&&y(o)?(y(t[i])||(t[i]={}),n<r?Jt(t[i],o,n+1,r):t[i]=e[i]):p(o)?(t[i]=[],t[i]=t[i].concat(o)):void 0!==o&&(t[i]=o)}}var $t=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0;r<e.length;r+=1)Jt(t,e[r]);return t},te=function(t,e,n,r){l(e)||(n=e,e=t,t=function(){});var i=Object.create?function(t,e){return Object.create(t,{constructor:{value:e}})}:function(t,e){function n(){}n.prototype=t;var r=new n;return r.constructor=e,r},o=i(e.prototype,t);return t.prototype=Wt(o,t.prototype),t.superclass=i(e.prototype,e),Wt(o,n),Wt(t,r),t},ee=function(t,e){if(!r(t))return-1;var n=Array.prototype.indexOf;if(n)return n.call(t,e);for(var i=-1,o=0;o<t.length;o++)if(t[o]===e){i=o;break}return i},ne=Object.prototype.hasOwnProperty;var re=function(t){if(c(t))return!0;if(r(t))return!t.length;var e=Ot(t);if("Map"===e||"Set"===e)return!t.size;if(Ft(t))return!Object.keys(t).length;for(var n in t)if(ne.call(t,n))return!1;return!0},ie=function(t,e){if(t===e)return!0;if(!t||!e)return!1;if(D(t)||D(e))return!1;if(r(t)||r(e)){if(t.length!==e.length)return!1;for(var n=!0,i=0;i<t.length&&(n=ie(t[i],e[i]));i++);return n}if(m(t)||m(e)){var o=Object.keys(t),a=Object.keys(e);if(o.length!==a.length)return!1;for(n=!0,i=0;i<o.length&&(n=ie(t[o[i]],e[o[i]]));i++);return n}return!1},oe=ie,ae=function(t,e,n){return l(n)?!!n(t,e):oe(t,e)},se=function(t,e){if(!r(t))return t;for(var n=[],i=0;i<t.length;i++){var o=t[i];n.push(e(o,i))}return n},ue=function(t){return t},le=function(t,e){void 0===e&&(e=ue);var n={};return h(t)&&!c(t)&&Object.keys(t).forEach((function(r){n[r]=e(t[r],r)})),n},ce=function(t,e,n){for(var r=0,i=D(e)?e.split("."):e;t&&r<i.length;)t=t[i[r++]];return void 0===t||r<i.length?n:t},pe=function(t,e,n){var r=t,i=D(e)?e.split("."):e;return i.forEach((function(t,e){e<i.length-1?(h(r[t])||(r[t]=rt(i[e+1])?[]:{}),r=r[t]):r[t]=n})),t},he=Object.prototype.hasOwnProperty,fe=function(t,e){if(null===t||!y(t))return{};var n={};return f(e,(function(e){he.call(t,e)&&(n[e]=t[e])})),n},de=function(t,e){return I(t,(function(t,n,r){return e.includes(r)||(t[r]=n),t}),{})},ve=function(t,e,n){var r,i,o,a,s=0;n||(n={});var u=function(){s=!1===n.leading?0:Date.now(),r=null,a=t.apply(i,o),r||(i=o=null)},l=function(){var l=Date.now();s||!1!==n.leading||(s=l);var c=e-(l-s);return i=this,o=arguments,c<=0||c>e?(r&&(clearTimeout(r),r=null),s=l,a=t.apply(i,o),r||(i=o=null)):r||!1===n.trailing||(r=setTimeout(u,c)),a};return l.cancel=function(){clearTimeout(r),s=0,r=i=o=null},l},me=function(t){return r(t)?Array.prototype.slice.call(t):[]},ye={},ge=function(t){return ye[t=t||"g"]?ye[t]+=1:ye[t]=1,t+ye[t]},_e=function(){},xe=function(t){return t};function be(t){return c(t)?0:r(t)?t.length:Object.keys(t).length}Object.create;var we;Object.create;var Se=Qt((function(t,e){void 0===e&&(e={});var n=e.fontSize,r=e.fontFamily,i=e.fontWeight,o=e.fontStyle,a=e.fontVariant;return we||(we=document.createElement("canvas").getContext("2d")),we.font=[o,a,i,n+"px",r].join(" "),we.measureText(D(t)?t:"").width}),(function(t,e){return void 0===e&&(e={}),function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}([t],wt(e)).join("")})),Ee=function(t,e,n,r){void 0===r&&(r="...");var i,o,a=Se(r,n),s=D(t)?t:Et(t),u=e,l=[];if(Se(t,n)<=e)return t;for(;i=s.substr(0,16),!((o=Se(i,n))+a>u&&o>u);)if(l.push(i),u-=o,!(s=s.substr(16)))return l.join("");for(;i=s.substr(0,1),!((o=Se(i,n))+a>u);)if(l.push(i),u-=o,!(s=s.substr(1)))return l.join("");return""+l.join("")+r},Ce=function(){function t(){this.map={}}return t.prototype.has=function(t){return void 0!==this.map[t]},t.prototype.get=function(t,e){var n=this.map[t];return void 0===n?e:n},t.prototype.set=function(t,e){this.map[t]=e},t.prototype.clear=function(){this.map={}},t.prototype.delete=function(t){delete this.map[t]},t.prototype.size=function(){return Object.keys(this.map).length},t}()},31795:function(t,e,n){var r=n(75752);function i(t){var e=0;if(t&&t.length>0){e+=Math.abs(o(t[0]));for(var n=1;n<t.length;n++)e-=Math.abs(o(t[n]))}return e}function o(t){var e,n,i,o,s,u,l=0,c=t.length;if(c>2){for(u=0;u<c;u++)u===c-2?(i=c-2,o=c-1,s=0):u===c-1?(i=c-1,o=0,s=1):(i=u,o=u+1,s=u+2),e=t[i],n=t[o],l+=(a(t[s][0])-a(e[0]))*Math.sin(a(n[1]));l=l*r.RADIUS*r.RADIUS/2}return l}function a(t){return t*Math.PI/180}t.exports.geometry=function t(e){var n,r=0;switch(e.type){case"Polygon":return i(e.coordinates);case"MultiPolygon":for(n=0;n<e.coordinates.length;n++)r+=i(e.coordinates[n]);return r;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(n=0;n<e.geometries.length;n++)r+=t(e.geometries[n]);return r}},t.exports.ring=o},38163:function(t,e,n){var r=n(31795);function i(t,e){return function(n){return t(n,e)}}function o(t,e){e=!!e,t[0]=a(t[0],e);for(var n=1;n<t.length;n++)t[n]=a(t[n],!e);return t}function a(t,e){return function(t){return r.ring(t)>=0}(t)===e?t:t.reverse()}t.exports=function t(e,n){switch(e&&e.type||null){case"FeatureCollection":return e.features=e.features.map(i(t,n)),e;case"GeometryCollection":return e.geometries=e.geometries.map(i(t,n)),e;case"Feature":return e.geometry=t(e.geometry,n),e;case"Polygon":case"MultiPolygon":return function(t,e){"Polygon"===t.type?t.coordinates=o(t.coordinates,e):"MultiPolygon"===t.type&&(t.coordinates=t.coordinates.map(i(o,e)));return t}(e,n);default:return e}}},99874:function(t){function e(t,e,n,r){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=n,this.p2y=r}t.exports=e,e.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},e.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},e.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},e.prototype.solveCurveX=function(t,e){var n,r,i,o,a;for(void 0===e&&(e=1e-6),i=t,a=0;a<8;a++){if(o=this.sampleCurveX(i)-t,Math.abs(o)<e)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=o/s}if((i=t)<(n=0))return n;if(i>(r=1))return r;for(;n<r;){if(o=this.sampleCurveX(i),Math.abs(o-t)<e)return i;t>o?n=i:r=i,i=.5*(r-n)+n}return i},e.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}},2650:function(t,e,n){"use strict";function r(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function i(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function o(){}n.d(e,{ZP:function(){return b},B8:function(){return C}});var a=.7,s=1/a,u="\\s*([+-]?\\d+)\\s*",l="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",c="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",p=/^#([0-9a-f]{3,8})$/,h=new RegExp("^rgb\\("+[u,u,u]+"\\)$"),f=new RegExp("^rgb\\("+[c,c,c]+"\\)$"),d=new RegExp("^rgba\\("+[u,u,u,l]+"\\)$"),v=new RegExp("^rgba\\("+[c,c,c,l]+"\\)$"),m=new RegExp("^hsl\\("+[l,c,c]+"\\)$"),y=new RegExp("^hsla\\("+[l,c,c,l]+"\\)$"),g={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function _(){return this.rgb().formatHex()}function x(){return this.rgb().formatRgb()}function b(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=p.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?w(e):3===n?new T(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?S(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?S(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=h.exec(t))?new T(e[1],e[2],e[3],1):(e=f.exec(t))?new T(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=d.exec(t))?S(e[1],e[2],e[3],e[4]):(e=v.exec(t))?S(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=m.exec(t))?P(e[1],e[2]/100,e[3]/100,1):(e=y.exec(t))?P(e[1],e[2]/100,e[3]/100,e[4]):g.hasOwnProperty(t)?w(g[t]):"transparent"===t?new T(NaN,NaN,NaN,0):null}function w(t){return new T(t>>16&255,t>>8&255,255&t,1)}function S(t,e,n,r){return r<=0&&(t=e=n=NaN),new T(t,e,n,r)}function E(t){return t instanceof o||(t=b(t)),t?new T((t=t.rgb()).r,t.g,t.b,t.opacity):new T}function C(t,e,n,r){return 1===arguments.length?E(t):new T(t,e,n,null==r?1:r)}function T(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function A(){return"#"+k(this.r)+k(this.g)+k(this.b)}function M(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}function k(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function P(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new L(t,e,n,r)}function O(t){if(t instanceof L)return new L(t.h,t.s,t.l,t.opacity);if(t instanceof o||(t=b(t)),!t)return new L;if(t instanceof L)return t;var e=(t=t.rgb()).r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),a=Math.max(e,n,r),s=NaN,u=a-i,l=(a+i)/2;return u?(s=e===a?(n-r)/u+6*(n<r):n===a?(r-e)/u+2:(e-n)/u+4,u/=l<.5?a+i:2-a-i,s*=60):u=l>0&&l<1?0:s,new L(s,u,l,t.opacity)}function L(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function I(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}r(o,b,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:_,formatHex:_,formatHsl:function(){return O(this).formatHsl()},formatRgb:x,toString:x}),r(T,C,i(o,{brighter:function(t){return t=null==t?s:Math.pow(s,t),new T(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?a:Math.pow(a,t),new T(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:A,formatHex:A,formatRgb:M,toString:M})),r(L,(function(t,e,n,r){return 1===arguments.length?O(t):new L(t,e,n,null==r?1:r)}),i(o,{brighter:function(t){return t=null==t?s:Math.pow(s,t),new L(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?a:Math.pow(a,t),new L(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new T(I(t>=240?t-240:t+120,i,r),I(t,i,r),I(t<120?t+240:t-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===t?")":", "+t+")")}}))},9187:function(t){"use strict";function e(t,e,o){o=o||2;var a,s,u,p,h,d,v,m=e&&e.length,y=m?e[0]*o:t.length,g=n(t,0,y,o,!0),_=[];if(!g||g.next===g.prev)return _;if(m&&(g=function(t,e,i,o){var a,s,u,p=[];for(a=0,s=e.length;a<s;a++)(u=n(t,e[a]*o,a<s-1?e[a+1]*o:t.length,o,!1))===u.next&&(u.steiner=!0),p.push(f(u));for(p.sort(l),a=0;a<p.length;a++)i=r(i=c(p[a],i),i.next);return i}(t,e,g,o)),t.length>80*o){a=u=t[0],s=p=t[1];for(var x=o;x<y;x+=o)(h=t[x])<a&&(a=h),(d=t[x+1])<s&&(s=d),h>u&&(u=h),d>p&&(p=d);v=0!==(v=Math.max(u-a,p-s))?1/v:0}return i(g,_,o,a,s,v),_}function n(t,e,n,r,i){var o,a;if(i===T(t,e,n,r)>0)for(o=e;o<n;o+=r)a=S(o,t[o],t[o+1],a);else for(o=n-r;o>=e;o-=r)a=S(o,t[o],t[o+1],a);return a&&y(a,a.next)&&(E(a),a=a.next),a}function r(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!y(r,r.next)&&0!==m(r.prev,r,r.next))r=r.next;else{if(E(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function i(t,e,n,l,c,p,f){if(t){!f&&p&&function(t,e,n,r){var i=t;do{null===i.z&&(i.z=h(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,n,r,i,o,a,s,u,l=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,r=n,s=0,e=0;e<l&&(s++,r=r.nextZ);e++);for(u=l;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,l*=2}while(a>1)}(i)}(t,l,c,p);for(var d,v,m=t;t.prev!==t.next;)if(d=t.prev,v=t.next,p?a(t,l,c,p):o(t))e.push(d.i/n),e.push(t.i/n),e.push(v.i/n),E(t),t=v.next,m=v.next;else if((t=v)===m){f?1===f?i(t=s(r(t),e,n),e,n,l,c,p,2):2===f&&u(t,e,n,l,c,p):i(r(t),e,n,l,c,p,1);break}}}function o(t){var e=t.prev,n=t,r=t.next;if(m(e,n,r)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(d(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&m(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function a(t,e,n,r){var i=t.prev,o=t,a=t.next;if(m(i,o,a)>=0)return!1;for(var s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,u=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,l=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,c=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,p=h(s,u,e,n,r),f=h(l,c,e,n,r),v=t.prevZ,y=t.nextZ;v&&v.z>=p&&y&&y.z<=f;){if(v!==t.prev&&v!==t.next&&d(i.x,i.y,o.x,o.y,a.x,a.y,v.x,v.y)&&m(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,y!==t.prev&&y!==t.next&&d(i.x,i.y,o.x,o.y,a.x,a.y,y.x,y.y)&&m(y.prev,y,y.next)>=0)return!1;y=y.nextZ}for(;v&&v.z>=p;){if(v!==t.prev&&v!==t.next&&d(i.x,i.y,o.x,o.y,a.x,a.y,v.x,v.y)&&m(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;y&&y.z<=f;){if(y!==t.prev&&y!==t.next&&d(i.x,i.y,o.x,o.y,a.x,a.y,y.x,y.y)&&m(y.prev,y,y.next)>=0)return!1;y=y.nextZ}return!0}function s(t,e,n){var i=t;do{var o=i.prev,a=i.next.next;!y(o,a)&&g(o,i,i.next,a)&&b(o,a)&&b(a,o)&&(e.push(o.i/n),e.push(i.i/n),e.push(a.i/n),E(i),E(i.next),i=t=a),i=i.next}while(i!==t);return r(i)}function u(t,e,n,o,a,s){var u=t;do{for(var l=u.next.next;l!==u.prev;){if(u.i!==l.i&&v(u,l)){var c=w(u,l);return u=r(u,u.next),c=r(c,c.next),i(u,e,n,o,a,s),void i(c,e,n,o,a,s)}l=l.next}u=u.next}while(u!==t)}function l(t,e){return t.x-e.x}function c(t,e){var n=function(t,e){var n,r=e,i=t.x,o=t.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a){if(a=s,s===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!n)return null;if(i===a)return n;var u,l=n,c=n.x,h=n.y,f=1/0;r=n;do{i>=r.x&&r.x>=c&&i!==r.x&&d(o<h?i:a,o,c,h,o<h?a:i,o,r.x,r.y)&&(u=Math.abs(o-r.y)/(i-r.x),b(r,t)&&(u<f||u===f&&(r.x>n.x||r.x===n.x&&p(n,r)))&&(n=r,f=u)),r=r.next}while(r!==l);return n}(t,e);if(!n)return e;var i=w(n,t),o=r(n,n.next);return r(i,i.next),e===n?o:e}function p(t,e){return m(t.prev,t,e.prev)<0&&m(e.next,t,t.next)<0}function h(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function f(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function d(t,e,n,r,i,o,a,s){return(i-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(r-s)-(n-a)*(e-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function v(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&g(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(b(t,e)&&b(e,t)&&function(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(m(t.prev,t,e.prev)||m(t,e.prev,e))||y(t,e)&&m(t.prev,t,t.next)>0&&m(e.prev,e,e.next)>0)}function m(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function y(t,e){return t.x===e.x&&t.y===e.y}function g(t,e,n,r){var i=x(m(t,e,n)),o=x(m(t,e,r)),a=x(m(n,r,t)),s=x(m(n,r,e));return i!==o&&a!==s||(!(0!==i||!_(t,n,e))||(!(0!==o||!_(t,r,e))||(!(0!==a||!_(n,t,r))||!(0!==s||!_(n,e,r)))))}function _(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function x(t){return t>0?1:t<0?-1:0}function b(t,e){return m(t.prev,t,t.next)<0?m(t,e,t.next)>=0&&m(t,t.prev,e)>=0:m(t,e,t.prev)<0||m(t,t.next,e)<0}function w(t,e){var n=new C(t.i,t.x,t.y),r=new C(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function S(t,e,n,r){var i=new C(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function E(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function C(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function T(t,e,n,r){for(var i=0,o=e,a=n-r;o<n;o+=r)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}t.exports=e,t.exports.default=e,e.deviation=function(t,e,n,r){var i=e&&e.length,o=i?e[0]*n:t.length,a=Math.abs(T(t,0,o,n));if(i)for(var s=0,u=e.length;s<u;s++){var l=e[s]*n,c=s<u-1?e[s+1]*n:t.length;a-=Math.abs(T(t,l,c,n))}var p=0;for(s=0;s<r.length;s+=3){var h=r[s]*n,f=r[s+1]*n,d=r[s+2]*n;p+=Math.abs((t[h]-t[d])*(t[f+1]-t[h+1])-(t[h]-t[f])*(t[d+1]-t[h+1]))}return 0===a&&0===p?0:Math.abs((p-a)/a)},e.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)n.vertices.push(t[i][o][a]);i>0&&(r+=t[i-1].length,n.holes.push(r))}return n}},67709:function(t){function e(t){var e=t.target||t.srcElement;e.__resizeRAF__&&cancelAnimationFrame(e.__resizeRAF__),e.__resizeRAF__=requestAnimationFrame((function(){var n=e.__resizeTrigger__,r=n&&n.__resizeListeners__;r&&r.forEach((function(e){e.call(n,t)}))}))}var n=function(t,n){var r,i=this.document,o=i.attachEvent;if("undefined"!=typeof navigator&&(r=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/)),!t.__resizeListeners__)if(t.__resizeListeners__=[],o)t.__resizeTrigger__=t,t.attachEvent("onresize",e);else{"static"===getComputedStyle(t).position&&(t.style.position="relative");var a=t.__resizeTrigger__=i.createElement("object");a.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),a.setAttribute("class","resize-sensor"),a.setAttribute("tabindex","-1"),a.setAttribute("title",""),a.__resizeElement__=t,a.onload=function(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",e)},a.type="text/html",r&&t.appendChild(a),a.data="about:blank",r||t.appendChild(a)}t.__resizeListeners__.push(n)};t.exports="undefined"==typeof window?n:n.bind(window),t.exports.unbind=function(t,n){var r=document.attachEvent,i=t.__resizeListeners__||[];if(n){var o=i.indexOf(n);-1!==o&&i.splice(o,1)}else i=t.__resizeListeners__=[];if(!i.length){if(r)t.detachEvent("onresize",e);else if(t.__resizeTrigger__){var a=t.__resizeTrigger__.contentDocument,s=a&&a.defaultView;s&&(s.removeEventListener("resize",e),delete s.__resizeTrigger__),t.__resizeTrigger__=!t.removeChild(t.__resizeTrigger__)}delete t.__resizeListeners__}}},33322:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return C}});var r=n(67294),i=n(59183),o=n(14062),a=function(t){return Object.prototype.toString.call(t).slice(8,-1)},s=function(t){if(!t)return t;var e=new t.constructor;for(var n in t)t.hasOwnProperty(n)&&(e[n]="Object"===a(t[n])||"Array"===a(t[n])?s(t[n]):t[n]);return e},u=function(){return u=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},u.apply(this,arguments)},l=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n},c=function(t){var e=t.source,n=l(t,["source"]);return u(u({},s(n)),{source:u({},e)})},p=function(){return p=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},p.apply(this,arguments)},h=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n};var f,d=(f=function(t,e){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},f(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}f(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),v=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.state={hasError:!1},e.renderError=function(t){var n=e.props.errorTemplate;return n&&"function"==typeof n?n(t):r.createElement("h5",null,"组件出错了，请核查后重试： ",t.message)},e}return d(e,t),e.getDerivedStateFromError=function(t){return{hasError:!0,error:t}},e.getDerivedStateFromProps=function(t,e){return e.children!==t.children?{children:t.children,hasError:!1,error:void 0}:null},e.prototype.render=function(){return this.state.hasError?this.renderError(this.state.error):r.createElement(r.Fragment,null,this.props.children)},e}(r.Component),m=v,y=function(){return y=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},y.apply(this,arguments)};var g=function(t){var e=t.animate,n=t.backgroundColor,i=t.backgroundOpacity,o=t.baseUrl,a=t.children,s=t.foregroundColor,u=t.foregroundOpacity,l=t.gradientRatio,c=t.uniqueKey,p=t.interval,h=t.rtl,f=t.speed,d=t.style,v=t.title,m=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n}(t,["animate","backgroundColor","backgroundOpacity","baseUrl","children","foregroundColor","foregroundOpacity","gradientRatio","uniqueKey","interval","rtl","speed","style","title"]),g=c||Math.random().toString(36).substring(6),_=g+"-diff",x=g+"-animated-diff",b=g+"-aria",w=h?{transform:"scaleX(-1)"}:null,S="0; "+p+"; 1",E=f+"s";return(0,r.createElement)("svg",y({"aria-labelledby":b,role:"img",style:y(y({},d),w)},m),v?(0,r.createElement)("title",{id:b},v):null,(0,r.createElement)("rect",{role:"presentation",x:"0",y:"0",width:"100%",height:"100%",clipPath:"url("+o+"#"+_+")",style:{fill:"url("+o+"#"+x+")"}}),(0,r.createElement)("defs",{role:"presentation"},(0,r.createElement)("clipPath",{id:_},a),(0,r.createElement)("linearGradient",{id:x},(0,r.createElement)("stop",{offset:"0%",stopColor:n,stopOpacity:i},e&&(0,r.createElement)("animate",{attributeName:"offset",values:-l+"; "+-l+"; 1",keyTimes:S,dur:E,repeatCount:"indefinite"})),(0,r.createElement)("stop",{offset:"50%",stopColor:s,stopOpacity:u},e&&(0,r.createElement)("animate",{attributeName:"offset",values:-l/2+"; "+-l/2+"; "+(1+l/2),keyTimes:S,dur:E,repeatCount:"indefinite"})),(0,r.createElement)("stop",{offset:"100%",stopColor:n,stopOpacity:i},e&&(0,r.createElement)("animate",{attributeName:"offset",values:"0; 0; "+(1+l),keyTimes:S,dur:E,repeatCount:"indefinite"})))))};g.defaultProps={animate:!0,backgroundColor:"#f5f6f7",backgroundOpacity:1,baseUrl:"",foregroundColor:"#eee",foregroundOpacity:1,gradientRatio:2,id:null,interval:.25,rtl:!1,speed:1.2,style:{},title:"Loading..."};var _=function(t){return t.children?(0,r.createElement)(g,y({},t)):(0,r.createElement)(x,y({},t))},x=function(t){return(0,r.createElement)(_,y({viewBox:"0 0 476 124"},t),(0,r.createElement)("rect",{x:"48",y:"8",width:"88",height:"6",rx:"3"}),(0,r.createElement)("rect",{x:"48",y:"26",width:"52",height:"6",rx:"3"}),(0,r.createElement)("rect",{x:"0",y:"56",width:"410",height:"6",rx:"3"}),(0,r.createElement)("rect",{x:"0",y:"72",width:"380",height:"6",rx:"3"}),(0,r.createElement)("rect",{x:"0",y:"88",width:"178",height:"6",rx:"3"}),(0,r.createElement)("circle",{cx:"20",cy:"20",r:"20"}))},b=_,w=function(t){var e=t.loadingTemplate;return r.createElement("div",{style:{position:"absolute",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",left:0,top:0,zIndex:99,backgroundColor:"#fff"}},e||r.createElement(b,{viewBox:"0 0 400 180",width:200,height:90,speed:1},r.createElement("rect",{x:"20",y:"5",rx:"0",ry:"0",width:"1",height:"170"}),r.createElement("rect",{x:"20",y:"175",rx:"0",ry:"0",width:"360",height:"1"}),r.createElement("rect",{x:"40",y:"75",rx:"0",ry:"0",width:"35",height:"100"}),r.createElement("rect",{x:"80",y:"125",rx:"0",ry:"0",width:"35",height:"50"}),r.createElement("rect",{x:"120",y:"105",rx:"0",ry:"0",width:"35",height:"70"}),r.createElement("rect",{x:"160",y:"35",rx:"0",ry:"0",width:"35",height:"140"}),r.createElement("rect",{x:"200",y:"55",rx:"0",ry:"0",width:"35",height:"120"}),r.createElement("rect",{x:"240",y:"15",rx:"0",ry:"0",width:"35",height:"160"}),r.createElement("rect",{x:"280",y:"135",rx:"0",ry:"0",width:"35",height:"40"}),r.createElement("rect",{x:"320",y:"85",rx:"0",ry:"0",width:"35",height:"90"})))},S=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n},E=(0,r.forwardRef)((function(t,e){var n=t.chartRef,a=t.containerStyle,s=void 0===a?{height:"inherit"}:a,u=t.className,l=t.loading,f=t.loadingTemplate,d=t.errorTemplate,v=S(t,["chartRef","containerStyle","className","loading","loadingTemplate","errorTemplate"]),y=function(t,e){var n=(0,r.useRef)(),i=(0,r.useRef)(),a=(0,r.useRef)(null),s=e.onReady;return(0,r.useEffect)((function(){if(n.current&&i.current&&!(0,o.isEqual)(i.current,e)){var t,r,a,s=i.current,u=(s.onReady,s.map),l=s.source,p=h(s,["onReady","map","source"]),f=(e.onReady,e.map),d=e.source,v=h(e,["onReady","map","source"]);if(r=!(0,o.isEqual)(u,f),t=!(0,o.isEqual)(l,d),a=!(0,o.isEqual)(p,v),r&&f){var m=(0,o.pick)(f,["center","pitch","rotation","zoom","style"]);n.current.updateMap(m)}if(t&&d){var y=d.data,g=h(d,["data"]);n.current.loaded?n.current.changeData(y,g):n.current.once("loaded",(function(){var t;null===(t=n.current)||void 0===t||t.changeData(y,g)}))}a&&v&&(n.current.loaded?n.current.update(v):n.current.once("loaded",(function(){var t;null===(t=n.current)||void 0===t||t.update(v)}))),i.current=c(e)}}),[e]),(0,r.useEffect)((function(){return a.current?(n.current=new t(a.current,p({},e)),i.current||(i.current=c(e)),s&&n.current.once("loaded",(function(){s(n.current)})),function(){n.current&&(n.current.destroy(),n.current=void 0)}):function(){return null}}),[]),{plotRef:n,containerRef:a}}(i.Choropleth,v),g=y.plotRef,_=y.containerRef;return(0,r.useEffect)((function(){!function(t,e){t&&((0,o.isFunction)(t)?t(e):t.current=e)}(n,g.current)}),[g.current]),(0,r.useImperativeHandle)(e,(function(){return{getChart:function(){return g.current}}})),r.createElement(m,{errorTemplate:d},l&&r.createElement(w,{loadingTemplate:f}),r.createElement("div",{className:u,style:s,ref:_}))})),C=function(){var t={map:{type:"mapbox",style:"blank",center:[120.19382669582967,30.258134],zoom:3,pitch:0},source:{data:[{name:"云南省",code:53e4,value:17881.12},{name:"黑龙江省",code:23e4,value:16361.62},{name:"贵州省",code:52e4,value:14806.45},{name:"北京市",code:11e4,value:30319.98},{name:"河北省",code:13e4,value:36010.27},{name:"山西省",code:14e4,value:16818.11},{name:"吉林省",code:22e4,value:15074},{name:"宁夏回族自治区",code:64e4,value:3705.18},{name:"辽宁省",code:21e4,value:25315.35},{name:"海南省",code:46e4,value:4832.05},{name:"内蒙古自治区",code:15e4,value:17289.22},{name:"天津市",code:12e4,value:18809.64},{name:"新疆维吾尔自治区",code:65e4,value:12199.08},{name:"上海市",code:31e4,value:32679.87},{name:"陕西省",code:61e4,value:24438.32},{name:"甘肃省",code:62e4,value:8246.07},{name:"安徽省",code:34e4,value:30006.82},{name:"香港特别行政区",code:81e4,value:0},{name:"广东省",code:44e4,value:97277.77},{name:"河南省",code:41e4,value:48055.86},{name:"湖南省",code:43e4,value:36425.78},{name:"江西省",code:36e4,value:21984.78},{name:"四川省",code:51e4,value:40678.13},{name:"广西壮族自治区",code:45e4,value:20353.51},{name:"江苏省",code:32e4,value:92595.4},{name:"澳门特别行政区",code:82e4,value:null},{name:"浙江省",code:33e4,value:56197.15},{name:"山东省",code:37e4,value:76469.67},{name:"青海省",code:63e4,value:2865.23},{name:"重庆市",code:5e5,value:20363.19},{name:"福建省",code:35e4,value:35804.04},{name:"湖北省",code:42e4,value:39366.55},{name:"西藏自治区",code:54e4,value:1477.63},{name:"台湾省",code:71e4,value:null}],joinBy:{sourceField:"code",geoField:"adcode"}},viewLevel:{level:"country",adcode:1e5},autoFit:!0,color:{field:"value",value:["#B8E1FF","#7DAAFF","#3D76DD","#0047A5","#001D70"],scale:{type:"quantile"}},style:{opacity:1,stroke:"#ccc",lineWidth:.6,lineOpacity:1},label:{visible:!0,field:"name",style:{fill:"#000",opacity:.8,fontSize:10,stroke:"#fff",strokeWidth:1.5,textAllowOverlap:!1,padding:[5,5]}},state:{active:{stroke:"black",lineWidth:1}},tooltip:{items:["name","adcode","value"]},zoom:{position:"bottomright"},legend:{position:"bottomleft"}};return r.createElement("section",{style:{width:"100%",height:600}},r.createElement(E,t))}},26729:function(t){"use strict";var e=Object.prototype.hasOwnProperty,n="~";function r(){}function i(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function o(t,e,r,o,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new i(r,o||t,a),u=n?n+e:e;return t._events[u]?t._events[u].fn?t._events[u]=[t._events[u],s]:t._events[u].push(s):(t._events[u]=s,t._eventsCount++),t}function a(t,e){0==--t._eventsCount?t._events=new r:delete t._events[e]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),s.prototype.eventNames=function(){var t,r,i=[];if(0===this._eventsCount)return i;for(r in t=this._events)e.call(t,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},s.prototype.listeners=function(t){var e=n?n+t:t,r=this._events[e];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,a=new Array(o);i<o;i++)a[i]=r[i].fn;return a},s.prototype.listenerCount=function(t){var e=n?n+t:t,r=this._events[e];return r?r.fn?1:r.length:0},s.prototype.emit=function(t,e,r,i,o,a){var s=n?n+t:t;if(!this._events[s])return!1;var u,l,c=this._events[s],p=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),p){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,r),!0;case 4:return c.fn.call(c.context,e,r,i),!0;case 5:return c.fn.call(c.context,e,r,i,o),!0;case 6:return c.fn.call(c.context,e,r,i,o,a),!0}for(l=1,u=new Array(p-1);l<p;l++)u[l-1]=arguments[l];c.fn.apply(c.context,u)}else{var h,f=c.length;for(l=0;l<f;l++)switch(c[l].once&&this.removeListener(t,c[l].fn,void 0,!0),p){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,e);break;case 3:c[l].fn.call(c[l].context,e,r);break;case 4:c[l].fn.call(c[l].context,e,r,i);break;default:if(!u)for(h=1,u=new Array(p-1);h<p;h++)u[h-1]=arguments[h];c[l].fn.apply(c[l].context,u)}}return!0},s.prototype.on=function(t,e,n){return o(this,t,e,n,!1)},s.prototype.once=function(t,e,n){return o(this,t,e,n,!0)},s.prototype.removeListener=function(t,e,r,i){var o=n?n+t:t;if(!this._events[o])return this;if(!e)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==e||i&&!s.once||r&&s.context!==r||a(this,o);else{for(var u=0,l=[],c=s.length;u<c;u++)(s[u].fn!==e||i&&!s[u].once||r&&s[u].context!==r)&&l.push(s[u]);l.length?this._events[o]=1===l.length?l[0]:l:a(this,o)}return this},s.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&a(this,e)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,t.exports=s},49685:function(t,e,n){"use strict";n.d(e,{FD:function(){return o},Ib:function(){return r},WT:function(){return i}});var r=1e-6,i="undefined"!=typeof Float32Array?Float32Array:Array,o=Math.random;Math.PI;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)})},85975:function(t,e,n){"use strict";n.r(e),n.d(e,{add:function(){return q},adjoint:function(){return h},clone:function(){return o},copy:function(){return a},create:function(){return i},determinant:function(){return f},equals:function(){return J},exactEquals:function(){return Q},frob:function(){return W},fromQuat:function(){return R},fromQuat2:function(){return M},fromRotation:function(){return S},fromRotationTranslation:function(){return A},fromRotationTranslationScale:function(){return L},fromRotationTranslationScaleOrigin:function(){return I},fromScaling:function(){return w},fromTranslation:function(){return b},fromValues:function(){return s},fromXRotation:function(){return E},fromYRotation:function(){return C},fromZRotation:function(){return T},frustum:function(){return D},getRotation:function(){return O},getScaling:function(){return P},getTranslation:function(){return k},identity:function(){return l},invert:function(){return p},lookAt:function(){return V},mul:function(){return $},multiply:function(){return d},multiplyScalar:function(){return Y},multiplyScalarAndAdd:function(){return K},ortho:function(){return j},orthoNO:function(){return B},orthoZO:function(){return U},perspective:function(){return Z},perspectiveFromFieldOfView:function(){return F},perspectiveNO:function(){return N},perspectiveZO:function(){return z},rotate:function(){return y},rotateX:function(){return g},rotateY:function(){return _},rotateZ:function(){return x},scale:function(){return m},set:function(){return u},str:function(){return H},sub:function(){return tt},subtract:function(){return X},targetTo:function(){return G},translate:function(){return v},transpose:function(){return c}});var r=n(49685);function i(){var t=new r.WT(16);return r.WT!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function o(t){var e=new r.WT(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function a(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function s(t,e,n,i,o,a,s,u,l,c,p,h,f,d,v,m){var y=new r.WT(16);return y[0]=t,y[1]=e,y[2]=n,y[3]=i,y[4]=o,y[5]=a,y[6]=s,y[7]=u,y[8]=l,y[9]=c,y[10]=p,y[11]=h,y[12]=f,y[13]=d,y[14]=v,y[15]=m,y}function u(t,e,n,r,i,o,a,s,u,l,c,p,h,f,d,v,m){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=u,t[8]=l,t[9]=c,t[10]=p,t[11]=h,t[12]=f,t[13]=d,t[14]=v,t[15]=m,t}function l(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function c(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],o=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=o,t[11]=e[14],t[12]=i,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function p(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],p=e[9],h=e[10],f=e[11],d=e[12],v=e[13],m=e[14],y=e[15],g=n*s-r*a,_=n*u-i*a,x=n*l-o*a,b=r*u-i*s,w=r*l-o*s,S=i*l-o*u,E=c*v-p*d,C=c*m-h*d,T=c*y-f*d,A=p*m-h*v,M=p*y-f*v,k=h*y-f*m,P=g*k-_*M+x*A+b*T-w*C+S*E;return P?(P=1/P,t[0]=(s*k-u*M+l*A)*P,t[1]=(i*M-r*k-o*A)*P,t[2]=(v*S-m*w+y*b)*P,t[3]=(h*w-p*S-f*b)*P,t[4]=(u*T-a*k-l*C)*P,t[5]=(n*k-i*T+o*C)*P,t[6]=(m*x-d*S-y*_)*P,t[7]=(c*S-h*x+f*_)*P,t[8]=(a*M-s*T+l*E)*P,t[9]=(r*T-n*M-o*E)*P,t[10]=(d*w-v*x+y*g)*P,t[11]=(p*x-c*w-f*g)*P,t[12]=(s*C-a*A-u*E)*P,t[13]=(n*A-r*C+i*E)*P,t[14]=(v*_-d*b-m*g)*P,t[15]=(c*b-p*_+h*g)*P,t):null}function h(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],p=e[9],h=e[10],f=e[11],d=e[12],v=e[13],m=e[14],y=e[15];return t[0]=s*(h*y-f*m)-p*(u*y-l*m)+v*(u*f-l*h),t[1]=-(r*(h*y-f*m)-p*(i*y-o*m)+v*(i*f-o*h)),t[2]=r*(u*y-l*m)-s*(i*y-o*m)+v*(i*l-o*u),t[3]=-(r*(u*f-l*h)-s*(i*f-o*h)+p*(i*l-o*u)),t[4]=-(a*(h*y-f*m)-c*(u*y-l*m)+d*(u*f-l*h)),t[5]=n*(h*y-f*m)-c*(i*y-o*m)+d*(i*f-o*h),t[6]=-(n*(u*y-l*m)-a*(i*y-o*m)+d*(i*l-o*u)),t[7]=n*(u*f-l*h)-a*(i*f-o*h)+c*(i*l-o*u),t[8]=a*(p*y-f*v)-c*(s*y-l*v)+d*(s*f-l*p),t[9]=-(n*(p*y-f*v)-c*(r*y-o*v)+d*(r*f-o*p)),t[10]=n*(s*y-l*v)-a*(r*y-o*v)+d*(r*l-o*s),t[11]=-(n*(s*f-l*p)-a*(r*f-o*p)+c*(r*l-o*s)),t[12]=-(a*(p*m-h*v)-c*(s*m-u*v)+d*(s*h-u*p)),t[13]=n*(p*m-h*v)-c*(r*m-i*v)+d*(r*h-i*p),t[14]=-(n*(s*m-u*v)-a*(r*m-i*v)+d*(r*u-i*s)),t[15]=n*(s*h-u*p)-a*(r*h-i*p)+c*(r*u-i*s),t}function f(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],l=t[8],c=t[9],p=t[10],h=t[11],f=t[12],d=t[13],v=t[14],m=t[15];return(e*a-n*o)*(p*m-h*v)-(e*s-r*o)*(c*m-h*d)+(e*u-i*o)*(c*v-p*d)+(n*s-r*a)*(l*m-h*f)-(n*u-i*a)*(l*v-p*f)+(r*u-i*s)*(l*d-c*f)}function d(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],p=e[8],h=e[9],f=e[10],d=e[11],v=e[12],m=e[13],y=e[14],g=e[15],_=n[0],x=n[1],b=n[2],w=n[3];return t[0]=_*r+x*s+b*p+w*v,t[1]=_*i+x*u+b*h+w*m,t[2]=_*o+x*l+b*f+w*y,t[3]=_*a+x*c+b*d+w*g,_=n[4],x=n[5],b=n[6],w=n[7],t[4]=_*r+x*s+b*p+w*v,t[5]=_*i+x*u+b*h+w*m,t[6]=_*o+x*l+b*f+w*y,t[7]=_*a+x*c+b*d+w*g,_=n[8],x=n[9],b=n[10],w=n[11],t[8]=_*r+x*s+b*p+w*v,t[9]=_*i+x*u+b*h+w*m,t[10]=_*o+x*l+b*f+w*y,t[11]=_*a+x*c+b*d+w*g,_=n[12],x=n[13],b=n[14],w=n[15],t[12]=_*r+x*s+b*p+w*v,t[13]=_*i+x*u+b*h+w*m,t[14]=_*o+x*l+b*f+w*y,t[15]=_*a+x*c+b*d+w*g,t}function v(t,e,n){var r,i,o,a,s,u,l,c,p,h,f,d,v=n[0],m=n[1],y=n[2];return e===t?(t[12]=e[0]*v+e[4]*m+e[8]*y+e[12],t[13]=e[1]*v+e[5]*m+e[9]*y+e[13],t[14]=e[2]*v+e[6]*m+e[10]*y+e[14],t[15]=e[3]*v+e[7]*m+e[11]*y+e[15]):(r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],p=e[8],h=e[9],f=e[10],d=e[11],t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=l,t[7]=c,t[8]=p,t[9]=h,t[10]=f,t[11]=d,t[12]=r*v+s*m+p*y+e[12],t[13]=i*v+u*m+h*y+e[13],t[14]=o*v+l*m+f*y+e[14],t[15]=a*v+c*m+d*y+e[15]),t}function m(t,e,n){var r=n[0],i=n[1],o=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function y(t,e,n,i){var o,a,s,u,l,c,p,h,f,d,v,m,y,g,_,x,b,w,S,E,C,T,A,M,k=i[0],P=i[1],O=i[2],L=Math.hypot(k,P,O);return L<r.Ib?null:(k*=L=1/L,P*=L,O*=L,o=Math.sin(n),s=1-(a=Math.cos(n)),u=e[0],l=e[1],c=e[2],p=e[3],h=e[4],f=e[5],d=e[6],v=e[7],m=e[8],y=e[9],g=e[10],_=e[11],x=k*k*s+a,b=P*k*s+O*o,w=O*k*s-P*o,S=k*P*s-O*o,E=P*P*s+a,C=O*P*s+k*o,T=k*O*s+P*o,A=P*O*s-k*o,M=O*O*s+a,t[0]=u*x+h*b+m*w,t[1]=l*x+f*b+y*w,t[2]=c*x+d*b+g*w,t[3]=p*x+v*b+_*w,t[4]=u*S+h*E+m*C,t[5]=l*S+f*E+y*C,t[6]=c*S+d*E+g*C,t[7]=p*S+v*E+_*C,t[8]=u*T+h*A+m*M,t[9]=l*T+f*A+y*M,t[10]=c*T+d*A+g*M,t[11]=p*T+v*A+_*M,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function g(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[4],a=e[5],s=e[6],u=e[7],l=e[8],c=e[9],p=e[10],h=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+l*r,t[5]=a*i+c*r,t[6]=s*i+p*r,t[7]=u*i+h*r,t[8]=l*i-o*r,t[9]=c*i-a*r,t[10]=p*i-s*r,t[11]=h*i-u*r,t}function _(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],l=e[8],c=e[9],p=e[10],h=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-l*r,t[1]=a*i-c*r,t[2]=s*i-p*r,t[3]=u*i-h*r,t[8]=o*r+l*i,t[9]=a*r+c*i,t[10]=s*r+p*i,t[11]=u*r+h*i,t}function x(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],l=e[4],c=e[5],p=e[6],h=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+l*r,t[1]=a*i+c*r,t[2]=s*i+p*r,t[3]=u*i+h*r,t[4]=l*i-o*r,t[5]=c*i-a*r,t[6]=p*i-s*r,t[7]=h*i-u*r,t}function b(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function w(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function S(t,e,n){var i,o,a,s=n[0],u=n[1],l=n[2],c=Math.hypot(s,u,l);return c<r.Ib?null:(s*=c=1/c,u*=c,l*=c,i=Math.sin(e),a=1-(o=Math.cos(e)),t[0]=s*s*a+o,t[1]=u*s*a+l*i,t[2]=l*s*a-u*i,t[3]=0,t[4]=s*u*a-l*i,t[5]=u*u*a+o,t[6]=l*u*a+s*i,t[7]=0,t[8]=s*l*a+u*i,t[9]=u*l*a-s*i,t[10]=l*l*a+o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function E(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function C(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function T(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function A(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=r+r,u=i+i,l=o+o,c=r*s,p=r*u,h=r*l,f=i*u,d=i*l,v=o*l,m=a*s,y=a*u,g=a*l;return t[0]=1-(f+v),t[1]=p+g,t[2]=h-y,t[3]=0,t[4]=p-g,t[5]=1-(c+v),t[6]=d+m,t[7]=0,t[8]=h+y,t[9]=d-m,t[10]=1-(c+f),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function M(t,e){var n=new r.WT(3),i=-e[0],o=-e[1],a=-e[2],s=e[3],u=e[4],l=e[5],c=e[6],p=e[7],h=i*i+o*o+a*a+s*s;return h>0?(n[0]=2*(u*s+p*i+l*a-c*o)/h,n[1]=2*(l*s+p*o+c*i-u*a)/h,n[2]=2*(c*s+p*a+u*o-l*i)/h):(n[0]=2*(u*s+p*i+l*a-c*o),n[1]=2*(l*s+p*o+c*i-u*a),n[2]=2*(c*s+p*a+u*o-l*i)),A(t,e,n),t}function k(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function P(t,e){var n=e[0],r=e[1],i=e[2],o=e[4],a=e[5],s=e[6],u=e[8],l=e[9],c=e[10];return t[0]=Math.hypot(n,r,i),t[1]=Math.hypot(o,a,s),t[2]=Math.hypot(u,l,c),t}function O(t,e){var n=new r.WT(3);P(n,e);var i=1/n[0],o=1/n[1],a=1/n[2],s=e[0]*i,u=e[1]*o,l=e[2]*a,c=e[4]*i,p=e[5]*o,h=e[6]*a,f=e[8]*i,d=e[9]*o,v=e[10]*a,m=s+p+v,y=0;return m>0?(y=2*Math.sqrt(m+1),t[3]=.25*y,t[0]=(h-d)/y,t[1]=(f-l)/y,t[2]=(u-c)/y):s>p&&s>v?(y=2*Math.sqrt(1+s-p-v),t[3]=(h-d)/y,t[0]=.25*y,t[1]=(u+c)/y,t[2]=(f+l)/y):p>v?(y=2*Math.sqrt(1+p-s-v),t[3]=(f-l)/y,t[0]=(u+c)/y,t[1]=.25*y,t[2]=(h+d)/y):(y=2*Math.sqrt(1+v-s-p),t[3]=(u-c)/y,t[0]=(f+l)/y,t[1]=(h+d)/y,t[2]=.25*y),t}function L(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=e[3],u=i+i,l=o+o,c=a+a,p=i*u,h=i*l,f=i*c,d=o*l,v=o*c,m=a*c,y=s*u,g=s*l,_=s*c,x=r[0],b=r[1],w=r[2];return t[0]=(1-(d+m))*x,t[1]=(h+_)*x,t[2]=(f-g)*x,t[3]=0,t[4]=(h-_)*b,t[5]=(1-(p+m))*b,t[6]=(v+y)*b,t[7]=0,t[8]=(f+g)*w,t[9]=(v-y)*w,t[10]=(1-(p+d))*w,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function I(t,e,n,r,i){var o=e[0],a=e[1],s=e[2],u=e[3],l=o+o,c=a+a,p=s+s,h=o*l,f=o*c,d=o*p,v=a*c,m=a*p,y=s*p,g=u*l,_=u*c,x=u*p,b=r[0],w=r[1],S=r[2],E=i[0],C=i[1],T=i[2],A=(1-(v+y))*b,M=(f+x)*b,k=(d-_)*b,P=(f-x)*w,O=(1-(h+y))*w,L=(m+g)*w,I=(d+_)*S,R=(m-g)*S,D=(1-(h+v))*S;return t[0]=A,t[1]=M,t[2]=k,t[3]=0,t[4]=P,t[5]=O,t[6]=L,t[7]=0,t[8]=I,t[9]=R,t[10]=D,t[11]=0,t[12]=n[0]+E-(A*E+P*C+I*T),t[13]=n[1]+C-(M*E+O*C+R*T),t[14]=n[2]+T-(k*E+L*C+D*T),t[15]=1,t}function R(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n+n,s=r+r,u=i+i,l=n*a,c=r*a,p=r*s,h=i*a,f=i*s,d=i*u,v=o*a,m=o*s,y=o*u;return t[0]=1-p-d,t[1]=c+y,t[2]=h-m,t[3]=0,t[4]=c-y,t[5]=1-l-d,t[6]=f+v,t[7]=0,t[8]=h+m,t[9]=f-v,t[10]=1-l-p,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function D(t,e,n,r,i,o,a){var s=1/(n-e),u=1/(i-r),l=1/(o-a);return t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*u,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(i+r)*u,t[10]=(a+o)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*l,t[15]=0,t}function N(t,e,n,r,i){var o,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(o=1/(r-i),t[10]=(i+r)*o,t[14]=2*i*r*o):(t[10]=-1,t[14]=-2*r),t}var Z=N;function z(t,e,n,r,i){var o,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(o=1/(r-i),t[10]=i*o,t[14]=i*r*o):(t[10]=-1,t[14]=-r),t}function F(t,e,n,r){var i=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),u=2/(a+s),l=2/(i+o);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=-(a-s)*u*.5,t[9]=(i-o)*l*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t}function B(t,e,n,r,i,o,a){var s=1/(e-n),u=1/(r-i),l=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*u,t[14]=(a+o)*l,t[15]=1,t}var j=B;function U(t,e,n,r,i,o,a){var s=1/(e-n),u=1/(r-i),l=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=l,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*u,t[14]=o*l,t[15]=1,t}function V(t,e,n,i){var o,a,s,u,c,p,h,f,d,v,m=e[0],y=e[1],g=e[2],_=i[0],x=i[1],b=i[2],w=n[0],S=n[1],E=n[2];return Math.abs(m-w)<r.Ib&&Math.abs(y-S)<r.Ib&&Math.abs(g-E)<r.Ib?l(t):(h=m-w,f=y-S,d=g-E,o=x*(d*=v=1/Math.hypot(h,f,d))-b*(f*=v),a=b*(h*=v)-_*d,s=_*f-x*h,(v=Math.hypot(o,a,s))?(o*=v=1/v,a*=v,s*=v):(o=0,a=0,s=0),u=f*s-d*a,c=d*o-h*s,p=h*a-f*o,(v=Math.hypot(u,c,p))?(u*=v=1/v,c*=v,p*=v):(u=0,c=0,p=0),t[0]=o,t[1]=u,t[2]=h,t[3]=0,t[4]=a,t[5]=c,t[6]=f,t[7]=0,t[8]=s,t[9]=p,t[10]=d,t[11]=0,t[12]=-(o*m+a*y+s*g),t[13]=-(u*m+c*y+p*g),t[14]=-(h*m+f*y+d*g),t[15]=1,t)}function G(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=r[0],u=r[1],l=r[2],c=i-n[0],p=o-n[1],h=a-n[2],f=c*c+p*p+h*h;f>0&&(c*=f=1/Math.sqrt(f),p*=f,h*=f);var d=u*h-l*p,v=l*c-s*h,m=s*p-u*c;return(f=d*d+v*v+m*m)>0&&(d*=f=1/Math.sqrt(f),v*=f,m*=f),t[0]=d,t[1]=v,t[2]=m,t[3]=0,t[4]=p*m-h*v,t[5]=h*d-c*m,t[6]=c*v-p*d,t[7]=0,t[8]=c,t[9]=p,t[10]=h,t[11]=0,t[12]=i,t[13]=o,t[14]=a,t[15]=1,t}function H(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function W(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function q(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t}function X(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}function Y(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t}function K(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t}function Q(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function J(t,e){var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],c=t[7],p=t[8],h=t[9],f=t[10],d=t[11],v=t[12],m=t[13],y=t[14],g=t[15],_=e[0],x=e[1],b=e[2],w=e[3],S=e[4],E=e[5],C=e[6],T=e[7],A=e[8],M=e[9],k=e[10],P=e[11],O=e[12],L=e[13],I=e[14],R=e[15];return Math.abs(n-_)<=r.Ib*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(i-x)<=r.Ib*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(o-b)<=r.Ib*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(a-w)<=r.Ib*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(s-S)<=r.Ib*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(u-E)<=r.Ib*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(l-C)<=r.Ib*Math.max(1,Math.abs(l),Math.abs(C))&&Math.abs(c-T)<=r.Ib*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(p-A)<=r.Ib*Math.max(1,Math.abs(p),Math.abs(A))&&Math.abs(h-M)<=r.Ib*Math.max(1,Math.abs(h),Math.abs(M))&&Math.abs(f-k)<=r.Ib*Math.max(1,Math.abs(f),Math.abs(k))&&Math.abs(d-P)<=r.Ib*Math.max(1,Math.abs(d),Math.abs(P))&&Math.abs(v-O)<=r.Ib*Math.max(1,Math.abs(v),Math.abs(O))&&Math.abs(m-L)<=r.Ib*Math.max(1,Math.abs(m),Math.abs(L))&&Math.abs(y-I)<=r.Ib*Math.max(1,Math.abs(y),Math.abs(I))&&Math.abs(g-R)<=r.Ib*Math.max(1,Math.abs(g),Math.abs(R))}var $=d,tt=X},31437:function(t,e,n){"use strict";n.d(e,{$X:function(){return l},AK:function(){return h},Fv:function(){return p},IH:function(){return u},JG:function(){return a},Ue:function(){return i},al:function(){return o},lu:function(){return v},t7:function(){return f},t8:function(){return s},tk:function(){return c}});var r=n(49685);function i(){var t=new r.WT(2);return r.WT!=Float32Array&&(t[0]=0,t[1]=0),t}function o(t,e){var n=new r.WT(2);return n[0]=t,n[1]=e,n}function a(t,e){return t[0]=e[0],t[1]=e[1],t}function s(t,e,n){return t[0]=e,t[1]=n,t}function u(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function l(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function c(t,e){return t[0]=-e[0],t[1]=-e[1],t}function p(t,e){var n=e[0],r=e[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t}function h(t,e){return t[0]*e[0]+t[1]*e[1]}function f(t,e,n,r){var i=e[0],o=e[1];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t}var d,v=l;d=i()},77160:function(t,e,n){"use strict";n.r(e),n.d(e,{add:function(){return c},angle:function(){return F},bezier:function(){return O},ceil:function(){return d},clone:function(){return o},copy:function(){return u},create:function(){return i},cross:function(){return M},dist:function(){return X},distance:function(){return b},div:function(){return q},divide:function(){return f},dot:function(){return A},equals:function(){return V},exactEquals:function(){return U},floor:function(){return v},forEach:function(){return J},fromValues:function(){return s},hermite:function(){return P},inverse:function(){return C},len:function(){return K},length:function(){return a},lerp:function(){return k},max:function(){return y},min:function(){return m},mul:function(){return W},multiply:function(){return h},negate:function(){return E},normalize:function(){return T},random:function(){return L},rotateX:function(){return N},rotateY:function(){return Z},rotateZ:function(){return z},round:function(){return g},scale:function(){return _},scaleAndAdd:function(){return x},set:function(){return l},sqrDist:function(){return Y},sqrLen:function(){return Q},squaredDistance:function(){return w},squaredLength:function(){return S},str:function(){return j},sub:function(){return H},subtract:function(){return p},transformMat3:function(){return R},transformMat4:function(){return I},transformQuat:function(){return D},zero:function(){return B}});var r=n(49685);function i(){var t=new r.WT(3);return r.WT!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function o(t){var e=new r.WT(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function a(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function s(t,e,n){var i=new r.WT(3);return i[0]=t,i[1]=e,i[2]=n,i}function u(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function l(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function c(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function p(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function h(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function f(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function d(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function v(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function m(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function y(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function g(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function _(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function x(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}function b(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.hypot(n,r,i)}function w(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return n*n+r*r+i*i}function S(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}function E(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function C(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function T(t,e){var n=e[0],r=e[1],i=e[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function A(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function M(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],u=n[2];return t[0]=i*u-o*s,t[1]=o*a-r*u,t[2]=r*s-i*a,t}function k(t,e,n,r){var i=e[0],o=e[1],a=e[2];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=a+r*(n[2]-a),t}function P(t,e,n,r,i,o){var a=o*o,s=a*(2*o-3)+1,u=a*(o-2)+o,l=a*(o-1),c=a*(3-2*o);return t[0]=e[0]*s+n[0]*u+r[0]*l+i[0]*c,t[1]=e[1]*s+n[1]*u+r[1]*l+i[1]*c,t[2]=e[2]*s+n[2]*u+r[2]*l+i[2]*c,t}function O(t,e,n,r,i,o){var a=1-o,s=a*a,u=o*o,l=s*a,c=3*o*s,p=3*u*a,h=u*o;return t[0]=e[0]*l+n[0]*c+r[0]*p+i[0]*h,t[1]=e[1]*l+n[1]*c+r[1]*p+i[1]*h,t[2]=e[2]*l+n[2]*c+r[2]*p+i[2]*h,t}function L(t,e){e=e||1;var n=2*r.FD()*Math.PI,i=2*r.FD()-1,o=Math.sqrt(1-i*i)*e;return t[0]=Math.cos(n)*o,t[1]=Math.sin(n)*o,t[2]=i*e,t}function I(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[3]*r+n[7]*i+n[11]*o+n[15];return a=a||1,t[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/a,t[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/a,t[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/a,t}function R(t,e,n){var r=e[0],i=e[1],o=e[2];return t[0]=r*n[0]+i*n[3]+o*n[6],t[1]=r*n[1]+i*n[4]+o*n[7],t[2]=r*n[2]+i*n[5]+o*n[8],t}function D(t,e,n){var r=n[0],i=n[1],o=n[2],a=n[3],s=e[0],u=e[1],l=e[2],c=i*l-o*u,p=o*s-r*l,h=r*u-i*s,f=i*h-o*p,d=o*c-r*h,v=r*p-i*c,m=2*a;return c*=m,p*=m,h*=m,f*=2,d*=2,v*=2,t[0]=s+c+f,t[1]=u+p+d,t[2]=l+h+v,t}function N(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function Z(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function z(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function F(t,e){var n=t[0],r=t[1],i=t[2],o=e[0],a=e[1],s=e[2],u=Math.sqrt(n*n+r*r+i*i)*Math.sqrt(o*o+a*a+s*s),l=u&&A(t,e)/u;return Math.acos(Math.min(Math.max(l,-1),1))}function B(t){return t[0]=0,t[1]=0,t[2]=0,t}function j(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function U(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function V(t,e){var n=t[0],i=t[1],o=t[2],a=e[0],s=e[1],u=e[2];return Math.abs(n-a)<=r.Ib*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-s)<=r.Ib*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(o-u)<=r.Ib*Math.max(1,Math.abs(o),Math.abs(u))}var G,H=p,W=h,q=f,X=b,Y=w,K=a,Q=S,J=(G=i(),function(t,e,n,r,i,o){var a,s;for(e||(e=3),n||(n=0),s=r?Math.min(r*e+n,t.length):t.length,a=n;a<s;a+=e)G[0]=t[a],G[1]=t[a+1],G[2]=t[a+2],i(G,G,o),t[a]=G[0],t[a+1]=G[1],t[a+2]=G[2];return t})},98333:function(t,e,n){"use strict";n.d(e,{Ue:function(){return i},al:function(){return o},bA:function(){return a},fF:function(){return s}});var r=n(49685);function i(){var t=new r.WT(4);return r.WT!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function o(t,e,n,i){var o=new r.WT(4);return o[0]=t,o[1]=e,o[2]=n,o[3]=i,o}function a(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function s(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,t[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,t[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,t[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,t}var u;u=i()},7375:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=Symbol.for("INJECTION");function r(t,e,r,i){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:function(){return i&&!Reflect.hasMetadata(n,this,e)&&Reflect.defineMetadata(n,r(),this,e),Reflect.hasMetadata(n,this,e)?Reflect.getMetadata(n,this,e):r()},set:function(t){Reflect.defineMetadata(n,t,this,e)}})}e.makePropertyInjectDecorator=function(t,e){return function(n){return function(i,o){r(i,o,(function(){return t.get(n)}),e)}}},e.makePropertyInjectNamedDecorator=function(t,e){return function(n,i){return function(o,a){r(o,a,(function(){return t.getNamed(n,i)}),e)}}},e.makePropertyInjectTaggedDecorator=function(t,e){return function(n,i,o){return function(a,s){r(a,s,(function(){return t.getTagged(n,i,o)}),e)}}},e.makePropertyMultiInjectDecorator=function(t,e){return function(n){return function(i,o){r(i,o,(function(){return t.getAll(n)}),e)}}}},84879:function(t,e,n){"use strict";var r=n(7375);e.Z=function(t,e){return void 0===e&&(e=!0),{lazyInject:r.makePropertyInjectDecorator(t,e),lazyInjectNamed:r.makePropertyInjectNamedDecorator(t,e),lazyInjectTagged:r.makePropertyInjectTaggedDecorator(t,e),lazyMultiInject:r.makePropertyMultiInjectDecorator(t,e)}}},99934:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.tagProperty=e.tagParameter=e.decorate=void 0;var r=n(16674),i=n(6867);function o(t,e,n,i,o){var a={},s="number"==typeof o,u=void 0!==o&&s?o.toString():n;if(s&&void 0!==n)throw new Error(r.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(t,e)&&(a=Reflect.getMetadata(t,e));var l=a[u];if(Array.isArray(l))for(var c=0,p=l;c<p.length;c++){var h=p[c];if(h.key===i.key)throw new Error(r.DUPLICATED_METADATA+" "+h.key.toString())}else l=[];l.push(i),a[u]=l,Reflect.defineMetadata(t,a,e)}function a(t,e){Reflect.decorate(t,e)}function s(t,e){return function(n,r){e(n,r,t)}}e.tagParameter=function(t,e,n,r){o(i.TAGGED,t,e,r,n)},e.tagProperty=function(t,e,n){o(i.TAGGED_PROP,t.constructor,e,n)},e.decorate=function(t,e,n){"number"==typeof n?a([s(n,t)],e):"string"==typeof n?Reflect.decorate([t],e,n):a([t],e)}},5744:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.inject=e.LazyServiceIdentifer=void 0;var r=n(16674),i=n(6867),o=n(47738),a=n(99934),s=function(){function t(t){this._cb=t}return t.prototype.unwrap=function(){return this._cb()},t}();e.LazyServiceIdentifer=s,e.inject=function(t){return function(e,n,s){if(void 0===t)throw new Error(r.UNDEFINED_INJECT_ANNOTATION(e.name));var u=new o.Metadata(i.INJECT_TAG,t);"number"==typeof s?a.tagParameter(e,n,s,u):a.tagProperty(e,n,u)}}},64315:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.injectable=void 0;var r=n(16674),i=n(6867);e.injectable=function(){return function(t){if(Reflect.hasOwnMetadata(i.PARAM_TYPES,t))throw new Error(r.DUPLICATED_INJECTABLE_DECORATOR);var e=Reflect.getMetadata(i.DESIGN_PARAM_TYPES,t)||[];return Reflect.defineMetadata(i.PARAM_TYPES,e,t),t}}},71693:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.multiInject=void 0;var r=n(6867),i=n(47738),o=n(99934);e.multiInject=function(t){return function(e,n,a){var s=new i.Metadata(r.MULTI_INJECT_TAG,t);"number"==typeof a?o.tagParameter(e,n,a,s):o.tagProperty(e,n,s)}}},38085:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.named=void 0;var r=n(6867),i=n(47738),o=n(99934);e.named=function(t){return function(e,n,a){var s=new i.Metadata(r.NAMED_TAG,t);"number"==typeof a?o.tagParameter(e,n,a,s):o.tagProperty(e,n,s)}}},6515:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.optional=void 0;var r=n(6867),i=n(47738),o=n(99934);e.optional=function(){return function(t,e,n){var a=new i.Metadata(r.OPTIONAL_TAG,!0);"number"==typeof n?o.tagParameter(t,e,n,a):o.tagProperty(t,e,a)}}},7014:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.postConstruct=void 0;var r=n(16674),i=n(6867),o=n(47738);e.postConstruct=function(){return function(t,e,n){var a=new o.Metadata(i.POST_CONSTRUCT,e);if(Reflect.hasOwnMetadata(i.POST_CONSTRUCT,t.constructor))throw new Error(r.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(i.POST_CONSTRUCT,a,t.constructor)}}},32052:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.tagged=void 0;var r=n(47738),i=n(99934);e.tagged=function(t,e){return function(n,o,a){var s=new r.Metadata(t,e);"number"==typeof a?i.tagParameter(n,o,a,s):i.tagProperty(n,o,s)}}},55638:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.targetName=void 0;var r=n(6867),i=n(47738),o=n(99934);e.targetName=function(t){return function(e,n,a){var s=new i.Metadata(r.NAME_TAG,t);o.tagParameter(e,n,a,s)}}},86757:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.unmanaged=void 0;var r=n(6867),i=n(47738),o=n(99934);e.unmanaged=function(){return function(t,e,n){var a=new i.Metadata(r.UNMANAGED_TAG,!0);o.tagParameter(t,e,n,a)}}},44290:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Binding=void 0;var r=n(28421),i=n(37791),o=function(){function t(t,e){this.id=i.id(),this.activated=!1,this.serviceIdentifier=t,this.scope=e,this.type=r.BindingTypeEnum.Invalid,this.constraint=function(t){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return t.prototype.clone=function(){var e=new t(this.serviceIdentifier,this.scope);return e.activated=e.scope===r.BindingScopeEnum.Singleton&&this.activated,e.implementationType=this.implementationType,e.dynamicValue=this.dynamicValue,e.scope=this.scope,e.type=this.type,e.factory=this.factory,e.provider=this.provider,e.constraint=this.constraint,e.onActivation=this.onActivation,e.cache=this.cache,e},t}();e.Binding=o},23184:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingCount=void 0;e.BindingCount={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1}},16674:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.STACK_OVERFLOW=e.CIRCULAR_DEPENDENCY_IN_FACTORY=e.POST_CONSTRUCT_ERROR=e.MULTIPLE_POST_CONSTRUCT_METHODS=e.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=e.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=e.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=e.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=e.ARGUMENTS_LENGTH_MISMATCH=e.INVALID_DECORATOR_OPERATION=e.INVALID_TO_SELF_VALUE=e.INVALID_FUNCTION_BINDING=e.INVALID_MIDDLEWARE_RETURN=e.NO_MORE_SNAPSHOTS_AVAILABLE=e.INVALID_BINDING_TYPE=e.NOT_IMPLEMENTED=e.CIRCULAR_DEPENDENCY=e.UNDEFINED_INJECT_ANNOTATION=e.MISSING_INJECT_ANNOTATION=e.MISSING_INJECTABLE_ANNOTATION=e.NOT_REGISTERED=e.CANNOT_UNBIND=e.AMBIGUOUS_MATCH=e.KEY_NOT_FOUND=e.NULL_ARGUMENT=e.DUPLICATED_METADATA=e.DUPLICATED_INJECTABLE_DECORATOR=void 0,e.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",e.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",e.NULL_ARGUMENT="NULL argument",e.KEY_NOT_FOUND="Key Not Found",e.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",e.CANNOT_UNBIND="Could not unbind serviceIdentifier:",e.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",e.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",e.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";e.UNDEFINED_INJECT_ANNOTATION=function(t){return"@inject called with undefined this could mean that the class "+t+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."},e.CIRCULAR_DEPENDENCY="Circular dependency found:",e.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",e.INVALID_BINDING_TYPE="Invalid binding type:",e.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",e.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",e.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",e.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",e.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";e.ARGUMENTS_LENGTH_MISMATCH=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"The number of constructor arguments in the derived class "+t[0]+" must be >= than the number of constructor arguments of its base class."},e.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",e.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",e.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",e.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",e.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";e.POST_CONSTRUCT_ERROR=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"@postConstruct error in class "+t[0]+": "+t[1]};e.CIRCULAR_DEPENDENCY_IN_FACTORY=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"It looks like there is a circular dependency in one of the '"+t[0]+"' bindings. Please investigate bindings withservice identifier '"+t[1]+"'."},e.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TargetTypeEnum=e.BindingTypeEnum=e.BindingScopeEnum=void 0;e.BindingScopeEnum={Request:"Request",Singleton:"Singleton",Transient:"Transient"};e.BindingTypeEnum={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};e.TargetTypeEnum={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"}},6867:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NON_CUSTOM_TAG_KEYS=e.POST_CONSTRUCT=e.DESIGN_PARAM_TYPES=e.PARAM_TYPES=e.TAGGED_PROP=e.TAGGED=e.MULTI_INJECT_TAG=e.INJECT_TAG=e.OPTIONAL_TAG=e.UNMANAGED_TAG=e.NAME_TAG=e.NAMED_TAG=void 0,e.NAMED_TAG="named",e.NAME_TAG="name",e.UNMANAGED_TAG="unmanaged",e.OPTIONAL_TAG="optional",e.INJECT_TAG="inject",e.MULTI_INJECT_TAG="multi_inject",e.TAGGED="inversify:tagged",e.TAGGED_PROP="inversify:tagged_props",e.PARAM_TYPES="inversify:paramtypes",e.DESIGN_PARAM_TYPES="design:paramtypes",e.POST_CONSTRUCT="post_construct",e.NON_CUSTOM_TAG_KEYS=[e.INJECT_TAG,e.MULTI_INJECT_TAG,e.NAME_TAG,e.UNMANAGED_TAG,e.NAMED_TAG,e.OPTIONAL_TAG]},51389:function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__spreadArray||function(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t};Object.defineProperty(e,"__esModule",{value:!0}),e.Container=void 0;var a=n(44290),s=n(16674),u=n(28421),l=n(6867),c=n(51377),p=n(86311),h=n(31927),f=n(51860),d=n(37791),v=n(55800),m=n(85700),y=n(80175),g=function(){function t(t){this._appliedMiddleware=[];var e=t||{};if("object"!=typeof e)throw new Error(""+s.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(void 0===e.defaultScope)e.defaultScope=u.BindingScopeEnum.Transient;else if(e.defaultScope!==u.BindingScopeEnum.Singleton&&e.defaultScope!==u.BindingScopeEnum.Transient&&e.defaultScope!==u.BindingScopeEnum.Request)throw new Error(""+s.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(void 0===e.autoBindInjectable)e.autoBindInjectable=!1;else if("boolean"!=typeof e.autoBindInjectable)throw new Error(""+s.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(void 0===e.skipBaseClassChecks)e.skipBaseClassChecks=!1;else if("boolean"!=typeof e.skipBaseClassChecks)throw new Error(""+s.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:e.autoBindInjectable,defaultScope:e.defaultScope,skipBaseClassChecks:e.skipBaseClassChecks},this.id=d.id(),this._bindingDictionary=new y.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new c.MetadataReader}return t.merge=function(e,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var a=new t,s=o([e,n],r).map((function(t){return p.getBindingDictionary(t)})),u=p.getBindingDictionary(a);function l(t,e){t.traverse((function(t,n){n.forEach((function(t){e.add(t.serviceIdentifier,t.clone())}))}))}return s.forEach((function(t){l(t,u)})),a},t.prototype.load=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=this._getContainerModuleHelpersFactory(),r=0,i=t;r<i.length;r++){var o=i[r],a=n(o.id);o.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)}},t.prototype.loadAsync=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return r(this,void 0,void 0,(function(){var e,n,r,o,a;return i(this,(function(i){switch(i.label){case 0:e=this._getContainerModuleHelpersFactory(),n=0,r=t,i.label=1;case 1:return n<r.length?(o=r[n],a=e(o.id),[4,o.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)]):[3,4];case 2:i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},t.prototype.unload=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=function(t){return function(e){return e.moduleId===t}};e.forEach((function(e){var n=r(e.id);t._bindingDictionary.removeByCondition(n)}))},t.prototype.bind=function(t){var e=this.options.defaultScope||u.BindingScopeEnum.Transient,n=new a.Binding(t,e);return this._bindingDictionary.add(t,n),new f.BindingToSyntax(n)},t.prototype.rebind=function(t){return this.unbind(t),this.bind(t)},t.prototype.unbind=function(t){try{this._bindingDictionary.remove(t)}catch(e){throw new Error(s.CANNOT_UNBIND+" "+v.getServiceIdentifierAsString(t))}},t.prototype.unbindAll=function(){this._bindingDictionary=new y.Lookup},t.prototype.isBound=function(t){var e=this._bindingDictionary.hasKey(t);return!e&&this.parent&&(e=this.parent.isBound(t)),e},t.prototype.isBoundNamed=function(t,e){return this.isBoundTagged(t,l.NAMED_TAG,e)},t.prototype.isBoundTagged=function(t,e,n){var r=!1;if(this._bindingDictionary.hasKey(t)){var i=this._bindingDictionary.get(t),o=p.createMockRequest(this,t,e,n);r=i.some((function(t){return t.constraint(o)}))}return!r&&this.parent&&(r=this.parent.isBoundTagged(t,e,n)),r},t.prototype.snapshot=function(){this._snapshots.push(m.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},t.prototype.restore=function(){var t=this._snapshots.pop();if(void 0===t)throw new Error(s.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=t.bindings,this._middleware=t.middleware},t.prototype.createChild=function(e){var n=new t(e||this.options);return n.parent=this,n},t.prototype.applyMiddleware=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._appliedMiddleware=this._appliedMiddleware.concat(t);var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=t.reduce((function(t,e){return e(t)}),n)},t.prototype.applyCustomMetadataReader=function(t){this._metadataReader=t},t.prototype.get=function(t){return this._get(!1,!1,u.TargetTypeEnum.Variable,t)},t.prototype.getTagged=function(t,e,n){return this._get(!1,!1,u.TargetTypeEnum.Variable,t,e,n)},t.prototype.getNamed=function(t,e){return this.getTagged(t,l.NAMED_TAG,e)},t.prototype.getAll=function(t){return this._get(!0,!0,u.TargetTypeEnum.Variable,t)},t.prototype.getAllTagged=function(t,e,n){return this._get(!1,!0,u.TargetTypeEnum.Variable,t,e,n)},t.prototype.getAllNamed=function(t,e){return this.getAllTagged(t,l.NAMED_TAG,e)},t.prototype.resolve=function(t){var e=this.createChild();return e.bind(t).toSelf(),this._appliedMiddleware.forEach((function(t){e.applyMiddleware(t)})),e.get(t)},t.prototype._getContainerModuleHelpersFactory=function(){var t=this,e=function(t,e){t._binding.moduleId=e},n=function(n){return function(r){var i=t.rebind.bind(t)(r);return e(i,n),i}};return function(r){return{bindFunction:(i=r,function(n){var r=t.bind.bind(t)(n);return e(r,i),r}),isboundFunction:function(e){return t.isBound.bind(t)(e)},rebindFunction:n(r),unbindFunction:function(e){t.unbind.bind(t)(e)}};var i}},t.prototype._get=function(t,e,n,r,i,o){var a=null,u={avoidConstraints:t,contextInterceptor:function(t){return t},isMultiInject:e,key:i,serviceIdentifier:r,targetType:n,value:o};if(this._middleware){if(null==(a=this._middleware(u)))throw new Error(s.INVALID_MIDDLEWARE_RETURN)}else a=this._planAndResolve()(u);return a},t.prototype._planAndResolve=function(){var t=this;return function(e){var n=p.plan(t._metadataReader,t,e.isMultiInject,e.targetType,e.serviceIdentifier,e.key,e.value,e.avoidConstraints);return n=e.contextInterceptor(n),h.resolve(n)}},t}();e.Container=g},33244:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AsyncContainerModule=e.ContainerModule=void 0;var r=n(37791),i=function(t){this.id=r.id(),this.registry=t};e.ContainerModule=i;var o=function(t){this.id=r.id(),this.registry=t};e.AsyncContainerModule=o},85700:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ContainerSnapshot=void 0;var n=function(){function t(){}return t.of=function(e,n){var r=new t;return r.bindings=e,r.middleware=n,r},t}();e.ContainerSnapshot=n},80175:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Lookup=void 0;var r=n(16674),i=function(){function t(){this._map=new Map}return t.prototype.getMap=function(){return this._map},t.prototype.add=function(t,e){if(null==t)throw new Error(r.NULL_ARGUMENT);if(null==e)throw new Error(r.NULL_ARGUMENT);var n=this._map.get(t);void 0!==n?(n.push(e),this._map.set(t,n)):this._map.set(t,[e])},t.prototype.get=function(t){if(null==t)throw new Error(r.NULL_ARGUMENT);var e=this._map.get(t);if(void 0!==e)return e;throw new Error(r.KEY_NOT_FOUND)},t.prototype.remove=function(t){if(null==t)throw new Error(r.NULL_ARGUMENT);if(!this._map.delete(t))throw new Error(r.KEY_NOT_FOUND)},t.prototype.removeByCondition=function(t){var e=this;this._map.forEach((function(n,r){var i=n.filter((function(e){return!t(e)}));i.length>0?e._map.set(r,i):e._map.delete(r)}))},t.prototype.hasKey=function(t){if(null==t)throw new Error(r.NULL_ARGUMENT);return this._map.has(t)},t.prototype.clone=function(){var e=new t;return this._map.forEach((function(t,n){t.forEach((function(t){return e.add(n,t.clone())}))})),e},t.prototype.traverse=function(t){this._map.forEach((function(e,n){t(n,e)}))},t}();e.Lookup=i},86700:function(t,e,n){"use strict";e.GW=e.zY=e.f3=e.b2=e.W2=void 0,n(6867);var r=n(51389);Object.defineProperty(e,"W2",{enumerable:!0,get:function(){return r.Container}});var i=n(28421);var o=n(33244);var a=n(64315);Object.defineProperty(e,"b2",{enumerable:!0,get:function(){return a.injectable}});var s=n(32052);var u=n(38085);var l=n(5744);Object.defineProperty(e,"f3",{enumerable:!0,get:function(){return l.inject}});var c=n(6515);var p=n(86757);var h=n(71693);var f=n(55638);var d=n(7014);Object.defineProperty(e,"zY",{enumerable:!0,get:function(){return d.postConstruct}});var v=n(51377);var m=n(37791);var y=n(99934);Object.defineProperty(e,"GW",{enumerable:!0,get:function(){return y.decorate}});var g=n(80758);var _=n(55800);var x=n(70600)},95228:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Context=void 0;var r=n(37791),i=function(){function t(t){this.id=r.id(),this.container=t}return t.prototype.addPlan=function(t){this.plan=t},t.prototype.setCurrentRequest=function(t){this.currentRequest=t},t}();e.Context=i},47738:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Metadata=void 0;var r=n(6867),i=function(){function t(t,e){this.key=t,this.value=e}return t.prototype.toString=function(){return this.key===r.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},t}();e.Metadata=i},51377:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MetadataReader=void 0;var r=n(6867),i=function(){function t(){}return t.prototype.getConstructorMetadata=function(t){return{compilerGeneratedMetadata:Reflect.getMetadata(r.PARAM_TYPES,t),userGeneratedMetadata:Reflect.getMetadata(r.TAGGED,t)||{}}},t.prototype.getPropertiesMetadata=function(t){return Reflect.getMetadata(r.TAGGED_PROP,t)||[]},t}();e.MetadataReader=i},55314:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Plan=void 0;var n=function(t,e){this.parentContext=t,this.rootRequest=e};e.Plan=n},86311:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getBindingDictionary=e.createMockRequest=e.plan=void 0;var r=n(23184),i=n(16674),o=n(28421),a=n(6867),s=n(85265),u=n(55800),l=n(95228),c=n(47738),p=n(55314),h=n(6e3),f=n(6748),d=n(18924);function v(t){return t._bindingDictionary}function m(t,e,n,o,a){var s=g(n.container,a.serviceIdentifier),l=[];return s.length===r.BindingCount.NoBindingsAvailable&&n.container.options.autoBindInjectable&&"function"==typeof a.serviceIdentifier&&t.getConstructorMetadata(a.serviceIdentifier).compilerGeneratedMetadata&&(n.container.bind(a.serviceIdentifier).toSelf(),s=g(n.container,a.serviceIdentifier)),l=e?s:s.filter((function(t){var e=new f.Request(t.serviceIdentifier,n,o,t,a);return t.constraint(e)})),function(t,e,n,o){switch(e.length){case r.BindingCount.NoBindingsAvailable:if(n.isOptional())return e;var a=u.getServiceIdentifierAsString(t),s=i.NOT_REGISTERED;throw s+=u.listMetadataForTarget(a,n),s+=u.listRegisteredBindingsForServiceIdentifier(o,a,g),new Error(s);case r.BindingCount.OnlyOneBindingAvailable:if(!n.isArray())return e;case r.BindingCount.MultipleBindingsAvailable:default:if(n.isArray())return e;a=u.getServiceIdentifierAsString(t),s=i.AMBIGUOUS_MATCH+" "+a;throw s+=u.listRegisteredBindingsForServiceIdentifier(o,a,g),new Error(s)}}(a.serviceIdentifier,l,a,n.container),l}function y(t,e,n,r,a,s){var u,l;if(null===a){u=m(t,e,r,null,s),l=new f.Request(n,r,null,u,s);var c=new p.Plan(r,l);r.addPlan(c)}else u=m(t,e,r,a,s),l=a.addChildRequest(s.serviceIdentifier,u,s);u.forEach((function(e){var n=null;if(s.isArray())n=l.addChildRequest(e.serviceIdentifier,e,s);else{if(e.cache)return;n=l}if(e.type===o.BindingTypeEnum.Instance&&null!==e.implementationType){var a=h.getDependencies(t,e.implementationType);if(!r.container.options.skipBaseClassChecks){var u=h.getBaseClassDependencyCount(t,e.implementationType);if(a.length<u){var c=i.ARGUMENTS_LENGTH_MISMATCH(h.getFunctionName(e.implementationType));throw new Error(c)}}a.forEach((function(e){y(t,!1,e.serviceIdentifier,r,n,e)}))}}))}function g(t,e){var n=[],r=v(t);return r.hasKey(e)?n=r.get(e):null!==t.parent&&(n=g(t.parent,e)),n}e.getBindingDictionary=v,e.plan=function(t,e,n,r,i,o,p,h){void 0===h&&(h=!1);var f=new l.Context(e),v=function(t,e,n,r,i,o){var s=t?a.MULTI_INJECT_TAG:a.INJECT_TAG,u=new c.Metadata(s,n),l=new d.Target(e,r,n,u);if(void 0!==i){var p=new c.Metadata(i,o);l.metadata.push(p)}return l}(n,r,i,"",o,p);try{return y(t,h,i,f,null,v),f}catch(t){throw s.isStackOverflowExeption(t)&&f.plan&&u.circularDependencyToException(f.plan.rootRequest),t}},e.createMockRequest=function(t,e,n,r){var i=new d.Target(o.TargetTypeEnum.Variable,"",e,new c.Metadata(n,r)),a=new l.Context(t);return new f.Request(e,a,null,[],i)}},88460:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.QueryableString=void 0;var n=function(){function t(t){this.str=t}return t.prototype.startsWith=function(t){return 0===this.str.indexOf(t)},t.prototype.endsWith=function(t){var e,n=t.split("").reverse().join("");return e=this.str.split("").reverse().join(""),this.startsWith.call({str:e},n)},t.prototype.contains=function(t){return-1!==this.str.indexOf(t)},t.prototype.equals=function(t){return this.str===t},t.prototype.value=function(){return this.str},t}();e.QueryableString=n},6e3:function(t,e,n){"use strict";var r=this&&this.__spreadArray||function(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t};Object.defineProperty(e,"__esModule",{value:!0}),e.getFunctionName=e.getBaseClassDependencyCount=e.getDependencies=void 0;var i=n(5744),o=n(16674),a=n(28421),s=n(6867),u=n(55800);Object.defineProperty(e,"getFunctionName",{enumerable:!0,get:function(){return u.getFunctionName}});var l=n(18924);function c(t,e,n,i){var a=t.getConstructorMetadata(n),s=a.compilerGeneratedMetadata;if(void 0===s){var u=o.MISSING_INJECTABLE_ANNOTATION+" "+e+".";throw new Error(u)}var l=a.userGeneratedMetadata,c=Object.keys(l),f=0===n.length&&c.length>0,d=c.length>n.length,v=function(t,e,n,r,i){for(var o=[],a=0;a<i;a++){var s=p(a,t,e,n,r);null!==s&&o.push(s)}return o}(i,e,s,l,f||d?c.length:n.length),m=h(t,n);return r(r([],v),m)}function p(t,e,n,r,s){var u=s[t.toString()]||[],c=f(u),p=!0!==c.unmanaged,h=r[t],d=c.inject||c.multiInject;if((h=d||h)instanceof i.LazyServiceIdentifer&&(h=h.unwrap()),p){if(!e&&(h===Object||h===Function||void 0===h)){var v=o.MISSING_INJECT_ANNOTATION+" argument "+t+" in class "+n+".";throw new Error(v)}var m=new l.Target(a.TargetTypeEnum.ConstructorArgument,c.targetName,h);return m.metadata=u,m}return null}function h(t,e){for(var n=t.getPropertiesMetadata(e),i=[],o=0,s=Object.keys(n);o<s.length;o++){var u=s[o],c=n[u],p=f(n[u]),d=p.targetName||u,v=p.inject||p.multiInject,m=new l.Target(a.TargetTypeEnum.ClassProperty,d,v);m.metadata=c,i.push(m)}var y=Object.getPrototypeOf(e.prototype).constructor;if(y!==Object){var g=h(t,y);i=r(r([],i),g)}return i}function f(t){var e={};return t.forEach((function(t){e[t.key.toString()]=t.value})),{inject:e[s.INJECT_TAG],multiInject:e[s.MULTI_INJECT_TAG],targetName:e[s.NAME_TAG],unmanaged:e[s.UNMANAGED_TAG]}}e.getDependencies=function(t,e){return c(t,u.getFunctionName(e),e,!1)},e.getBaseClassDependencyCount=function t(e,n){var r=Object.getPrototypeOf(n.prototype).constructor;if(r!==Object){var i=c(e,u.getFunctionName(r),r,!0),o=i.map((function(t){return t.metadata.filter((function(t){return t.key===s.UNMANAGED_TAG}))})),a=[].concat.apply([],o).length,l=i.length-a;return l>0?l:t(e,r)}return 0}},6748:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Request=void 0;var r=n(37791),i=function(){function t(t,e,n,i,o){this.id=r.id(),this.serviceIdentifier=t,this.parentContext=e,this.parentRequest=n,this.target=o,this.childRequests=[],this.bindings=Array.isArray(i)?i:[i],this.requestScope=null===n?new Map:null}return t.prototype.addChildRequest=function(e,n,r){var i=new t(e,this.parentContext,this,n,r);return this.childRequests.push(i),i},t}();e.Request=i},18924:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Target=void 0;var r=n(6867),i=n(37791),o=n(47738),a=n(88460),s=function(){function t(t,e,n,s){this.id=i.id(),this.type=t,this.serviceIdentifier=n,this.name=new a.QueryableString(e||""),this.metadata=new Array;var u=null;"string"==typeof s?u=new o.Metadata(r.NAMED_TAG,s):s instanceof o.Metadata&&(u=s),null!==u&&this.metadata.push(u)}return t.prototype.hasTag=function(t){for(var e=0,n=this.metadata;e<n.length;e++){if(n[e].key===t)return!0}return!1},t.prototype.isArray=function(){return this.hasTag(r.MULTI_INJECT_TAG)},t.prototype.matchesArray=function(t){return this.matchesTag(r.MULTI_INJECT_TAG)(t)},t.prototype.isNamed=function(){return this.hasTag(r.NAMED_TAG)},t.prototype.isTagged=function(){return this.metadata.some((function(t){return r.NON_CUSTOM_TAG_KEYS.every((function(e){return t.key!==e}))}))},t.prototype.isOptional=function(){return this.matchesTag(r.OPTIONAL_TAG)(!0)},t.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter((function(t){return t.key===r.NAMED_TAG}))[0]:null},t.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter((function(t){return r.NON_CUSTOM_TAG_KEYS.every((function(e){return t.key!==e}))})):null},t.prototype.matchesNamedTag=function(t){return this.matchesTag(r.NAMED_TAG)(t)},t.prototype.matchesTag=function(t){var e=this;return function(n){for(var r=0,i=e.metadata;r<i.length;r++){var o=i[r];if(o.key===t&&o.value===n)return!0}return!1}},t}();e.Target=s},52279:function(t,e,n){"use strict";var r=this&&this.__spreadArray||function(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t};Object.defineProperty(e,"__esModule",{value:!0}),e.resolveInstance=void 0;var i=n(16674),o=n(28421),a=n(6867);e.resolveInstance=function(t,e,n){var s,u,l=null;if(e.length>0){var c=e.filter((function(t){return null!==t.target&&t.target.type===o.TargetTypeEnum.ConstructorArgument})).map(n);u=c,l=function(t,e,n){var r=e.filter((function(t){return null!==t.target&&t.target.type===o.TargetTypeEnum.ClassProperty})),i=r.map(n);return r.forEach((function(e,n){var r;r=e.target.name.value();var o=i[n];t[r]=o})),t}(l=new((s=t).bind.apply(s,r([void 0],u))),e,n)}else l=new t;return function(t,e){if(Reflect.hasMetadata(a.POST_CONSTRUCT,t)){var n=Reflect.getMetadata(a.POST_CONSTRUCT,t);try{e[n.value]()}catch(e){throw new Error(i.POST_CONSTRUCT_ERROR(t.name,e.message))}}}(t,l),l}},31927:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.resolve=void 0;var r=n(16674),i=n(28421),o=n(85265),a=n(55800),s=n(52279),u=function(t,e,n){try{return n()}catch(n){throw o.isStackOverflowExeption(n)?new Error(r.CIRCULAR_DEPENDENCY_IN_FACTORY(t,e.toString())):n}},l=function(t){return function(e){e.parentContext.setCurrentRequest(e);var n=e.bindings,o=e.childRequests,c=e.target&&e.target.isArray(),p=!(e.parentRequest&&e.parentRequest.target&&e.target&&e.parentRequest.target.matchesArray(e.target.serviceIdentifier));if(c&&p)return o.map((function(e){return l(t)(e)}));var h=null;if(!e.target.isOptional()||0!==n.length){var f=n[0],d=f.scope===i.BindingScopeEnum.Singleton,v=f.scope===i.BindingScopeEnum.Request;if(d&&f.activated)return f.cache;if(v&&null!==t&&t.has(f.id))return t.get(f.id);if(f.type===i.BindingTypeEnum.ConstantValue)h=f.cache,f.activated=!0;else if(f.type===i.BindingTypeEnum.Function)h=f.cache,f.activated=!0;else if(f.type===i.BindingTypeEnum.Constructor)h=f.implementationType;else if(f.type===i.BindingTypeEnum.DynamicValue&&null!==f.dynamicValue)h=u("toDynamicValue",f.serviceIdentifier,(function(){return f.dynamicValue(e.parentContext)}));else if(f.type===i.BindingTypeEnum.Factory&&null!==f.factory)h=u("toFactory",f.serviceIdentifier,(function(){return f.factory(e.parentContext)}));else if(f.type===i.BindingTypeEnum.Provider&&null!==f.provider)h=u("toProvider",f.serviceIdentifier,(function(){return f.provider(e.parentContext)}));else{if(f.type!==i.BindingTypeEnum.Instance||null===f.implementationType){var m=a.getServiceIdentifierAsString(e.serviceIdentifier);throw new Error(r.INVALID_BINDING_TYPE+" "+m)}h=s.resolveInstance(f.implementationType,o,l(t))}return"function"==typeof f.onActivation&&(h=f.onActivation(e.parentContext,h)),d&&(f.cache=h,f.activated=!0),v&&null!==t&&!t.has(f.id)&&t.set(f.id,h),h}}};e.resolve=function(t){return l(t.plan.rootRequest.requestScope)(t.plan.rootRequest)}},83366:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingInSyntax=void 0;var r=n(28421),i=n(71325),o=function(){function t(t){this._binding=t}return t.prototype.inRequestScope=function(){return this._binding.scope=r.BindingScopeEnum.Request,new i.BindingWhenOnSyntax(this._binding)},t.prototype.inSingletonScope=function(){return this._binding.scope=r.BindingScopeEnum.Singleton,new i.BindingWhenOnSyntax(this._binding)},t.prototype.inTransientScope=function(){return this._binding.scope=r.BindingScopeEnum.Transient,new i.BindingWhenOnSyntax(this._binding)},t}();e.BindingInSyntax=o},99812:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingInWhenOnSyntax=void 0;var r=n(83366),i=n(51811),o=n(98370),a=function(){function t(t){this._binding=t,this._bindingWhenSyntax=new o.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new i.BindingOnSyntax(this._binding),this._bindingInSyntax=new r.BindingInSyntax(t)}return t.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},t.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},t.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},t.prototype.when=function(t){return this._bindingWhenSyntax.when(t)},t.prototype.whenTargetNamed=function(t){return this._bindingWhenSyntax.whenTargetNamed(t)},t.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},t.prototype.whenTargetTagged=function(t,e){return this._bindingWhenSyntax.whenTargetTagged(t,e)},t.prototype.whenInjectedInto=function(t){return this._bindingWhenSyntax.whenInjectedInto(t)},t.prototype.whenParentNamed=function(t){return this._bindingWhenSyntax.whenParentNamed(t)},t.prototype.whenParentTagged=function(t,e){return this._bindingWhenSyntax.whenParentTagged(t,e)},t.prototype.whenAnyAncestorIs=function(t){return this._bindingWhenSyntax.whenAnyAncestorIs(t)},t.prototype.whenNoAncestorIs=function(t){return this._bindingWhenSyntax.whenNoAncestorIs(t)},t.prototype.whenAnyAncestorNamed=function(t){return this._bindingWhenSyntax.whenAnyAncestorNamed(t)},t.prototype.whenAnyAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenAnyAncestorTagged(t,e)},t.prototype.whenNoAncestorNamed=function(t){return this._bindingWhenSyntax.whenNoAncestorNamed(t)},t.prototype.whenNoAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenNoAncestorTagged(t,e)},t.prototype.whenAnyAncestorMatches=function(t){return this._bindingWhenSyntax.whenAnyAncestorMatches(t)},t.prototype.whenNoAncestorMatches=function(t){return this._bindingWhenSyntax.whenNoAncestorMatches(t)},t.prototype.onActivation=function(t){return this._bindingOnSyntax.onActivation(t)},t}();e.BindingInWhenOnSyntax=a},51811:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingOnSyntax=void 0;var r=n(98370),i=function(){function t(t){this._binding=t}return t.prototype.onActivation=function(t){return this._binding.onActivation=t,new r.BindingWhenSyntax(this._binding)},t}();e.BindingOnSyntax=i},51860:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingToSyntax=void 0;var r=n(16674),i=n(28421),o=n(99812),a=n(71325),s=function(){function t(t){this._binding=t}return t.prototype.to=function(t){return this._binding.type=i.BindingTypeEnum.Instance,this._binding.implementationType=t,new o.BindingInWhenOnSyntax(this._binding)},t.prototype.toSelf=function(){if("function"!=typeof this._binding.serviceIdentifier)throw new Error(""+r.INVALID_TO_SELF_VALUE);var t=this._binding.serviceIdentifier;return this.to(t)},t.prototype.toConstantValue=function(t){return this._binding.type=i.BindingTypeEnum.ConstantValue,this._binding.cache=t,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},t.prototype.toDynamicValue=function(t){return this._binding.type=i.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=t,this._binding.implementationType=null,new o.BindingInWhenOnSyntax(this._binding)},t.prototype.toConstructor=function(t){return this._binding.type=i.BindingTypeEnum.Constructor,this._binding.implementationType=t,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},t.prototype.toFactory=function(t){return this._binding.type=i.BindingTypeEnum.Factory,this._binding.factory=t,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},t.prototype.toFunction=function(t){if("function"!=typeof t)throw new Error(r.INVALID_FUNCTION_BINDING);var e=this.toConstantValue(t);return this._binding.type=i.BindingTypeEnum.Function,this._binding.scope=i.BindingScopeEnum.Singleton,e},t.prototype.toAutoFactory=function(t){return this._binding.type=i.BindingTypeEnum.Factory,this._binding.factory=function(e){return function(){return e.container.get(t)}},this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},t.prototype.toProvider=function(t){return this._binding.type=i.BindingTypeEnum.Provider,this._binding.provider=t,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},t.prototype.toService=function(t){this.toDynamicValue((function(e){return e.container.get(t)}))},t}();e.BindingToSyntax=s},71325:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingWhenOnSyntax=void 0;var r=n(51811),i=n(98370),o=function(){function t(t){this._binding=t,this._bindingWhenSyntax=new i.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new r.BindingOnSyntax(this._binding)}return t.prototype.when=function(t){return this._bindingWhenSyntax.when(t)},t.prototype.whenTargetNamed=function(t){return this._bindingWhenSyntax.whenTargetNamed(t)},t.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},t.prototype.whenTargetTagged=function(t,e){return this._bindingWhenSyntax.whenTargetTagged(t,e)},t.prototype.whenInjectedInto=function(t){return this._bindingWhenSyntax.whenInjectedInto(t)},t.prototype.whenParentNamed=function(t){return this._bindingWhenSyntax.whenParentNamed(t)},t.prototype.whenParentTagged=function(t,e){return this._bindingWhenSyntax.whenParentTagged(t,e)},t.prototype.whenAnyAncestorIs=function(t){return this._bindingWhenSyntax.whenAnyAncestorIs(t)},t.prototype.whenNoAncestorIs=function(t){return this._bindingWhenSyntax.whenNoAncestorIs(t)},t.prototype.whenAnyAncestorNamed=function(t){return this._bindingWhenSyntax.whenAnyAncestorNamed(t)},t.prototype.whenAnyAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenAnyAncestorTagged(t,e)},t.prototype.whenNoAncestorNamed=function(t){return this._bindingWhenSyntax.whenNoAncestorNamed(t)},t.prototype.whenNoAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenNoAncestorTagged(t,e)},t.prototype.whenAnyAncestorMatches=function(t){return this._bindingWhenSyntax.whenAnyAncestorMatches(t)},t.prototype.whenNoAncestorMatches=function(t){return this._bindingWhenSyntax.whenNoAncestorMatches(t)},t.prototype.onActivation=function(t){return this._bindingOnSyntax.onActivation(t)},t}();e.BindingWhenOnSyntax=o},98370:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingWhenSyntax=void 0;var r=n(51811),i=n(80758),o=function(){function t(t){this._binding=t}return t.prototype.when=function(t){return this._binding.constraint=t,new r.BindingOnSyntax(this._binding)},t.prototype.whenTargetNamed=function(t){return this._binding.constraint=i.namedConstraint(t),new r.BindingOnSyntax(this._binding)},t.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(t){return null!==t.target&&!t.target.isNamed()&&!t.target.isTagged()},new r.BindingOnSyntax(this._binding)},t.prototype.whenTargetTagged=function(t,e){return this._binding.constraint=i.taggedConstraint(t)(e),new r.BindingOnSyntax(this._binding)},t.prototype.whenInjectedInto=function(t){return this._binding.constraint=function(e){return i.typeConstraint(t)(e.parentRequest)},new r.BindingOnSyntax(this._binding)},t.prototype.whenParentNamed=function(t){return this._binding.constraint=function(e){return i.namedConstraint(t)(e.parentRequest)},new r.BindingOnSyntax(this._binding)},t.prototype.whenParentTagged=function(t,e){return this._binding.constraint=function(n){return i.taggedConstraint(t)(e)(n.parentRequest)},new r.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorIs=function(t){return this._binding.constraint=function(e){return i.traverseAncerstors(e,i.typeConstraint(t))},new r.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorIs=function(t){return this._binding.constraint=function(e){return!i.traverseAncerstors(e,i.typeConstraint(t))},new r.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorNamed=function(t){return this._binding.constraint=function(e){return i.traverseAncerstors(e,i.namedConstraint(t))},new r.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorNamed=function(t){return this._binding.constraint=function(e){return!i.traverseAncerstors(e,i.namedConstraint(t))},new r.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorTagged=function(t,e){return this._binding.constraint=function(n){return i.traverseAncerstors(n,i.taggedConstraint(t)(e))},new r.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorTagged=function(t,e){return this._binding.constraint=function(n){return!i.traverseAncerstors(n,i.taggedConstraint(t)(e))},new r.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorMatches=function(t){return this._binding.constraint=function(e){return i.traverseAncerstors(e,t)},new r.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorMatches=function(t){return this._binding.constraint=function(e){return!i.traverseAncerstors(e,t)},new r.BindingOnSyntax(this._binding)},t}();e.BindingWhenSyntax=o},80758:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.typeConstraint=e.namedConstraint=e.taggedConstraint=e.traverseAncerstors=void 0;var r=n(6867),i=n(47738),o=function(t,e){var n=t.parentRequest;return null!==n&&(!!e(n)||o(n,e))};e.traverseAncerstors=o;var a=function(t){return function(e){var n=function(n){return null!==n&&null!==n.target&&n.target.matchesTag(t)(e)};return n.metaData=new i.Metadata(t,e),n}};e.taggedConstraint=a;var s=a(r.NAMED_TAG);e.namedConstraint=s;e.typeConstraint=function(t){return function(e){var n=null;if(null!==e){if(n=e.bindings[0],"string"==typeof t)return n.serviceIdentifier===t;var r=e.bindings[0].implementationType;return t===r}return!1}}},70600:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.multiBindToService=void 0;e.multiBindToService=function(t){return function(e){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return n.forEach((function(n){return t.bind(n).toService(e)}))}}}},85265:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isStackOverflowExeption=void 0;var r=n(16674);e.isStackOverflowExeption=function(t){return t instanceof RangeError||t.message===r.STACK_OVERFLOW}},37791:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.id=void 0;var n=0;e.id=function(){return n++}},55800:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.circularDependencyToException=e.listMetadataForTarget=e.listRegisteredBindingsForServiceIdentifier=e.getServiceIdentifierAsString=e.getFunctionName=void 0;var r=n(16674);function i(t){return"function"==typeof t?t.name:"symbol"==typeof t?t.toString():t}function o(t,e){return null!==t.parentRequest&&(t.parentRequest.serviceIdentifier===e||o(t.parentRequest,e))}function a(t){if(t.name)return t.name;var e=t.toString(),n=e.match(/^function\s*([^\s(]+)/);return n?n[1]:"Anonymous function: "+e}e.getServiceIdentifierAsString=i,e.listRegisteredBindingsForServiceIdentifier=function(t,e,n){var r="",i=n(t,e);return 0!==i.length&&(r="\nRegistered bindings:",i.forEach((function(t){var e="Object";null!==t.implementationType&&(e=a(t.implementationType)),r=r+"\n "+e,t.constraint.metaData&&(r=r+" - "+t.constraint.metaData)}))),r},e.circularDependencyToException=function t(e){e.childRequests.forEach((function(e){if(o(e,e.serviceIdentifier)){var n=function(t){return function t(e,n){void 0===n&&(n=[]);var r=i(e.serviceIdentifier);return n.push(r),null!==e.parentRequest?t(e.parentRequest,n):n}(t).reverse().join(" --\x3e ")}(e);throw new Error(r.CIRCULAR_DEPENDENCY+" "+n)}t(e)}))},e.listMetadataForTarget=function(t,e){if(e.isTagged()||e.isNamed()){var n="",r=e.getNamedTag(),i=e.getCustomTags();return null!==r&&(n+=r.toString()+"\n"),null!==i&&i.forEach((function(t){n+=t.toString()+"\n"}))," "+t+"\n "+t+" - "+n}return" "+t},e.getFunctionName=a},31745:function(t){"use strict";t.exports=n,t.exports.default=n;var e=1e20;function n(t,e,n,r,i,o){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=r||.25,this.fontFamily=i||"sans-serif",this.fontWeight=o||"normal",this.radius=n||8;var a=this.size=this.fontSize+2*this.buffer,s=a+2*this.buffer,u="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM;u?this.canvas=my.createOffscreenCanvas(a,a,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(s*s),this.gridInner=new Float64Array(s*s),this.f=new Float64Array(s),this.z=new Float64Array(s+1),this.v=new Uint16Array(s),this.useMetrics=void 0!==this.ctx.measureText("A").actualBoundingBoxLeft,this.middle=u?Math.round(a/2*1):Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function r(t,e,n,r,o,a){for(var s=0;s<e;s++)i(t,s,e,n,r,o,a);for(var u=0;u<n;u++)i(t,u*e,1,e,r,o,a)}function i(t,n,r,i,o,a,s){var u,l,c,p;for(a[0]=0,s[0]=-e,s[1]=e,u=0;u<i;u++)o[u]=t[n+u*r];for(u=1,l=0,c=0;u<i;u++){do{p=a[l],c=(o[u]-o[p]+u*u-p*p)/(u-p)/2}while(c<=s[l]&&--l>-1);a[++l]=u,s[l]=c,s[l+1]=e}for(u=0,l=0;u<i;u++){for(;s[l+1]<u;)l++;p=a[l],t[n+u*r]=o[p]+(u-p)*(u-p)}}n.prototype._draw=function(t,n){var i,o,a,s,u,l,c,p,h,f=this.ctx.measureText(t),d=f.width,v=2*this.buffer;n&&this.useMetrics?(u=Math.floor(f.actualBoundingBoxAscent),p=this.buffer+Math.ceil(f.actualBoundingBoxAscent),l=this.buffer,c=this.buffer,i=(o=Math.min(this.size,Math.ceil(f.actualBoundingBoxRight-f.actualBoundingBoxLeft)))+v,a=(s=Math.min(this.size-l,Math.ceil(f.actualBoundingBoxAscent+f.actualBoundingBoxDescent)))+v,this.ctx.textBaseline="alphabetic"):(i=o=this.size,a=s=this.size,u=19*this.fontSize/24,l=c=0,p=this.middle,this.ctx.textBaseline="middle"),o&&s&&(this.ctx.clearRect(c,l,o,s),this.ctx.fillText(t,this.buffer,p),h=this.ctx.getImageData(c,l,o,s));var m=new Uint8ClampedArray(i*a);return function(t,n,r,i,o,a,s){a.fill(e,0,n*r),s.fill(0,0,n*r);for(var u=(n-i)/2,l=0;l<o;l++)for(var c=0;c<i;c++){var p=(l+u)*n+c+u,h=t.data[4*(l*i+c)+3]/255;if(1===h)a[p]=0,s[p]=e;else if(0===h)a[p]=e,s[p]=0;else{var f=Math.max(0,.5-h),d=Math.max(0,h-.5);a[p]=f*f,s[p]=d*d}}}(h,i,a,o,s,this.gridOuter,this.gridInner),r(this.gridOuter,i,a,this.f,this.v,this.z),r(this.gridInner,i,a,this.f,this.v,this.z),function(t,e,n,r,i,o,a){for(var s=0;s<e*n;s++){var u=Math.sqrt(r[s])-Math.sqrt(i[s]);t[s]=Math.round(255-255*(u/o+a))}}(m,i,a,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:m,metrics:{width:o,height:s,sdfWidth:i,sdfHeight:a,top:u,left:0,advance:d}}},n.prototype.draw=function(t){return this._draw(t,!1).data},n.prototype.drawWithMetrics=function(t){return this._draw(t,!0)}},26690:function(t,e,n){"use strict";n.r(e),n.d(e,{Function:function(){return Te},Interpreter:function(){return _e},default:function(){return Ae},evaluate:function(){return Ce},vm:function(){return r}});var r={};n.r(r),n.d(r,{Script:function(){return Ee},compileFunction:function(){return be},createContext:function(){return xe},runInContext:function(){return we},runInNewContext:function(){return Se}});var i={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},o="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",a={5:o,"5module":o+" export import",6:o+" const class extends export import super"},s=/^in(stanceof)?$/,u="ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙՠ-ֈא-תׯ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࡠ-ࡪࢠ-ࢴࢶ-ࣇऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱৼਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡૹଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘ-ౚౠౡಀಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഄ-ഌഎ-ഐഒ-ഺഽൎൔ-ൖൟ-ൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄຆ-ຊຌ-ຣລວ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏽᏸ-ᏽᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡸᢀ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᲀ-ᲈᲐ-ᲺᲽ-Ჿᳩ-ᳬᳮ-ᳳᳵᳶᳺᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕ℘-ℝℤΩℨK-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞ々-〇〡-〩〱-〵〸-〼ぁ-ゖ゛-ゟァ-ヺー-ヿㄅ-ㄯㄱ-ㆎㆠ-ㆿㇰ-ㇿ㐀-䶿一-鿼ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞿꟂ-ꟊꟵ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꣽꣾꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭩꭰ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",l="‌‍·̀-ͯ·҃-֑҇-ׇֽֿׁׂׅׄؐ-ًؚ-٩ٰۖ-ۜ۟-۪ۤۧۨ-ۭ۰-۹ܑܰ-݊ަ-ް߀-߉߫-߽߳ࠖ-࠙ࠛ-ࠣࠥ-ࠧࠩ-࡙࠭-࡛࣓-ࣣ࣡-ःऺ-़ा-ॏ॑-ॗॢॣ०-९ঁ-ঃ়া-ৄেৈো-্ৗৢৣ০-৯৾ਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑ੦-ੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢૣ૦-૯ૺ-૿ଁ-ଃ଼ା-ୄେୈୋ-୍୕-ୗୢୣ୦-୯ஂா-ூெ-ைொ-்ௗ௦-௯ఀ-ఄా-ౄె-ైొ-్ౕౖౢౣ౦-౯ಁ-ಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢೣ೦-೯ഀ-ഃ഻഼ാ-ൄെ-ൈൊ-്ൗൢൣ൦-൯ඁ-ඃ්ා-ුූෘ-ෟ෦-෯ෲෳัิ-ฺ็-๎๐-๙ັິ-ຼ່-ໍ໐-໙༘༙༠-༩༹༵༷༾༿ཱ-྄྆྇ྍ-ྗྙ-ྼ࿆ါ-ှ၀-၉ၖ-ၙၞ-ၠၢ-ၤၧ-ၭၱ-ၴႂ-ႍႏ-ႝ፝-፟፩-፱ᜒ-᜔ᜲ-᜴ᝒᝓᝲᝳ឴-៓៝០-៩᠋-᠍᠐-᠙ᢩᤠ-ᤫᤰ-᤻᥆-᥏᧐-᧚ᨗ-ᨛᩕ-ᩞ᩠-᩿᩼-᪉᪐-᪙᪰-᪽ᪿᫀᬀ-ᬄ᬴-᭄᭐-᭙᭫-᭳ᮀ-ᮂᮡ-ᮭ᮰-᮹᯦-᯳ᰤ-᰷᱀-᱉᱐-᱙᳐-᳔᳒-᳨᳭᳴᳷-᳹᷀-᷹᷻-᷿‿⁀⁔⃐-⃥⃜⃡-⃰⳯-⵿⳱ⷠ-〪ⷿ-゙゚〯꘠-꘩꙯ꙴ-꙽ꚞꚟ꛰꛱ꠂ꠆ꠋꠣ-ꠧ꠬ꢀꢁꢴ-ꣅ꣐-꣙꣠-꣱ꣿ-꤉ꤦ-꤭ꥇ-꥓ꦀ-ꦃ꦳-꧀꧐-꧙ꧥ꧰-꧹ꨩ-ꨶꩃꩌꩍ꩐-꩙ꩻ-ꩽꪰꪲ-ꪴꪷꪸꪾ꪿꫁ꫫ-ꫯꫵ꫶ꯣ-ꯪ꯬꯭꯰-꯹ﬞ︀-️︠-︯︳︴﹍-﹏０-９＿",c=new RegExp("["+u+"]"),p=new RegExp("["+u+l+"]");u=l=null;var h=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],f=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function d(t,e){for(var n=65536,r=0;r<e.length;r+=2){if((n+=e[r])>t)return!1;if((n+=e[r+1])>=t)return!0}}function v(t,e){return t<65?36===t:t<91||(t<97?95===t:t<123||(t<=65535?t>=170&&c.test(String.fromCharCode(t)):!1!==e&&d(t,h)))}function m(t,e){return t<48?36===t:t<58||!(t<65)&&(t<91||(t<97?95===t:t<123||(t<=65535?t>=170&&p.test(String.fromCharCode(t)):!1!==e&&(d(t,h)||d(t,f)))))}var y=function(t,e){void 0===e&&(e={}),this.label=t,this.keyword=e.keyword,this.beforeExpr=!!e.beforeExpr,this.startsExpr=!!e.startsExpr,this.isLoop=!!e.isLoop,this.isAssign=!!e.isAssign,this.prefix=!!e.prefix,this.postfix=!!e.postfix,this.binop=e.binop||null,this.updateContext=null};function g(t,e){return new y(t,{beforeExpr:!0,binop:e})}var _={beforeExpr:!0},x={startsExpr:!0},b={};function w(t,e){return void 0===e&&(e={}),e.keyword=t,b[t]=new y(t,e)}var S={num:new y("num",x),regexp:new y("regexp",x),string:new y("string",x),name:new y("name",x),eof:new y("eof"),bracketL:new y("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new y("]"),braceL:new y("{",{beforeExpr:!0,startsExpr:!0}),braceR:new y("}"),parenL:new y("(",{beforeExpr:!0,startsExpr:!0}),parenR:new y(")"),comma:new y(",",_),semi:new y(";",_),colon:new y(":",_),dot:new y("."),question:new y("?",_),questionDot:new y("?."),arrow:new y("=>",_),template:new y("template"),invalidTemplate:new y("invalidTemplate"),ellipsis:new y("...",_),backQuote:new y("`",x),dollarBraceL:new y("${",{beforeExpr:!0,startsExpr:!0}),eq:new y("=",{beforeExpr:!0,isAssign:!0}),assign:new y("_=",{beforeExpr:!0,isAssign:!0}),incDec:new y("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new y("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:g("||",1),logicalAND:g("&&",2),bitwiseOR:g("|",3),bitwiseXOR:g("^",4),bitwiseAND:g("&",5),equality:g("==/!=/===/!==",6),relational:g("</>/<=/>=",7),bitShift:g("<</>>/>>>",8),plusMin:new y("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:g("%",10),star:g("*",10),slash:g("/",10),starstar:new y("**",{beforeExpr:!0}),coalesce:g("??",1),_break:w("break"),_case:w("case",_),_catch:w("catch"),_continue:w("continue"),_debugger:w("debugger"),_default:w("default",_),_do:w("do",{isLoop:!0,beforeExpr:!0}),_else:w("else",_),_finally:w("finally"),_for:w("for",{isLoop:!0}),_function:w("function",x),_if:w("if"),_return:w("return",_),_switch:w("switch"),_throw:w("throw",_),_try:w("try"),_var:w("var"),_const:w("const"),_while:w("while",{isLoop:!0}),_with:w("with"),_new:w("new",{beforeExpr:!0,startsExpr:!0}),_this:w("this",x),_super:w("super",x),_class:w("class",x),_extends:w("extends",_),_export:w("export"),_import:w("import",x),_null:w("null",x),_true:w("true",x),_false:w("false",x),_in:w("in",{beforeExpr:!0,binop:7}),_instanceof:w("instanceof",{beforeExpr:!0,binop:7}),_typeof:w("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:w("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:w("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},E=/\r\n?|\n|\u2028|\u2029/,C=new RegExp(E.source,"g");function T(t,e){return 10===t||13===t||!e&&(8232===t||8233===t)}var A=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,M=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,k=Object.prototype,P=k.hasOwnProperty,O=k.toString;function L(t,e){return P.call(t,e)}var I=Array.isArray||function(t){return"[object Array]"===O.call(t)};function R(t){return new RegExp("^(?:"+t.replace(/ /g,"|")+")$")}var D=function(t,e){this.line=t,this.column=e};D.prototype.offset=function(t){return new D(this.line,this.column+t)};var N=function(t,e,n){this.start=e,this.end=n,null!==t.sourceFile&&(this.source=t.sourceFile)};function Z(t,e){for(var n=1,r=0;;){C.lastIndex=r;var i=C.exec(t);if(!(i&&i.index<e))return new D(n,e-r);++n,r=i.index+i[0].length}}var z={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function F(t){var e={};for(var n in z)e[n]=t&&L(t,n)?t[n]:z[n];if(e.ecmaVersion>=2015&&(e.ecmaVersion-=2009),null==e.allowReserved&&(e.allowReserved=e.ecmaVersion<5),I(e.onToken)){var r=e.onToken;e.onToken=function(t){return r.push(t)}}return I(e.onComment)&&(e.onComment=function(t,e){return function(n,r,i,o,a,s){var u={type:n?"Block":"Line",value:r,start:i,end:o};t.locations&&(u.loc=new N(this,a,s)),t.ranges&&(u.range=[i,o]),e.push(u)}}(e,e.onComment)),e}function B(t,e){return 2|(t?4:0)|(e?8:0)}var j=function(t,e,n){this.options=t=F(t),this.sourceFile=t.sourceFile,this.keywords=R(a[t.ecmaVersion>=6?6:"module"===t.sourceType?"5module":5]);var r="";if(!0!==t.allowReserved){for(var o=t.ecmaVersion;!(r=i[o]);o--);"module"===t.sourceType&&(r+=" await")}this.reservedWords=R(r);var s=(r?r+" ":"")+i.strict;this.reservedWordsStrict=R(s),this.reservedWordsStrictBind=R(s+" "+i.strictBind),this.input=String(e),this.containsEsc=!1,n?(this.pos=n,this.lineStart=this.input.lastIndexOf("\n",n-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(E).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=S.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule="module"===t.sourceType,this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},0===this.pos&&t.allowHashBang&&"#!"===this.input.slice(0,2)&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(1),this.regexpState=null},U={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};j.prototype.parse=function(){var t=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(t)},U.inFunction.get=function(){return(2&this.currentVarScope().flags)>0},U.inGenerator.get=function(){return(8&this.currentVarScope().flags)>0},U.inAsync.get=function(){return(4&this.currentVarScope().flags)>0},U.allowSuper.get=function(){return(64&this.currentThisScope().flags)>0},U.allowDirectSuper.get=function(){return(128&this.currentThisScope().flags)>0},U.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},j.prototype.inNonArrowFunction=function(){return(2&this.currentThisScope().flags)>0},j.extend=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];for(var n=this,r=0;r<t.length;r++)n=t[r](n);return n},j.parse=function(t,e){return new this(e,t).parse()},j.parseExpressionAt=function(t,e,n){var r=new this(n,t,e);return r.nextToken(),r.parseExpression()},j.tokenizer=function(t,e){return new this(e,t)},Object.defineProperties(j.prototype,U);var V=j.prototype,G=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;function H(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}V.strictDirective=function(t){for(;;){M.lastIndex=t,t+=M.exec(this.input)[0].length;var e=G.exec(this.input.slice(t));if(!e)return!1;if("use strict"===(e[1]||e[2])){M.lastIndex=t+e[0].length;var n=M.exec(this.input),r=n.index+n[0].length,i=this.input.charAt(r);return";"===i||"}"===i||E.test(n[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(i)||"!"===i&&"="===this.input.charAt(r+1))}t+=e[0].length,M.lastIndex=t,t+=M.exec(this.input)[0].length,";"===this.input[t]&&t++}},V.eat=function(t){return this.type===t&&(this.next(),!0)},V.isContextual=function(t){return this.type===S.name&&this.value===t&&!this.containsEsc},V.eatContextual=function(t){return!!this.isContextual(t)&&(this.next(),!0)},V.expectContextual=function(t){this.eatContextual(t)||this.unexpected()},V.canInsertSemicolon=function(){return this.type===S.eof||this.type===S.braceR||E.test(this.input.slice(this.lastTokEnd,this.start))},V.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},V.semicolon=function(){this.eat(S.semi)||this.insertSemicolon()||this.unexpected()},V.afterTrailingComma=function(t,e){if(this.type===t)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),e||this.next(),!0},V.expect=function(t){this.eat(t)||this.unexpected()},V.unexpected=function(t){this.raise(null!=t?t:this.start,"Unexpected token")},V.checkPatternErrors=function(t,e){if(t){t.trailingComma>-1&&this.raiseRecoverable(t.trailingComma,"Comma is not permitted after the rest element");var n=e?t.parenthesizedAssign:t.parenthesizedBind;n>-1&&this.raiseRecoverable(n,"Parenthesized pattern")}},V.checkExpressionErrors=function(t,e){if(!t)return!1;var n=t.shorthandAssign,r=t.doubleProto;if(!e)return n>=0||r>=0;n>=0&&this.raise(n,"Shorthand property assignments are valid only in destructuring patterns"),r>=0&&this.raiseRecoverable(r,"Redefinition of __proto__ property")},V.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},V.isSimpleAssignTarget=function(t){return"ParenthesizedExpression"===t.type?this.isSimpleAssignTarget(t.expression):"Identifier"===t.type||"MemberExpression"===t.type};var W=j.prototype;W.parseTopLevel=function(t){var e={};for(t.body||(t.body=[]);this.type!==S.eof;){var n=this.parseStatement(null,!0,e);t.body.push(n)}if(this.inModule)for(var r=0,i=Object.keys(this.undefinedExports);r<i.length;r+=1){var o=i[r];this.raiseRecoverable(this.undefinedExports[o].start,"Export '"+o+"' is not defined")}return this.adaptDirectivePrologue(t.body),this.next(),t.sourceType=this.options.sourceType,this.finishNode(t,"Program")};var q={kind:"loop"},X={kind:"switch"};W.isLet=function(t){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;M.lastIndex=this.pos;var e=M.exec(this.input),n=this.pos+e[0].length,r=this.input.charCodeAt(n);if(91===r)return!0;if(t)return!1;if(123===r)return!0;if(v(r,!0)){for(var i=n+1;m(this.input.charCodeAt(i),!0);)++i;var o=this.input.slice(n,i);if(!s.test(o))return!0}return!1},W.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;M.lastIndex=this.pos;var t=M.exec(this.input),e=this.pos+t[0].length;return!(E.test(this.input.slice(this.pos,e))||"function"!==this.input.slice(e,e+8)||e+8!==this.input.length&&m(this.input.charAt(e+8)))},W.parseStatement=function(t,e,n){var r,i=this.type,o=this.startNode();switch(this.isLet(t)&&(i=S._var,r="let"),i){case S._break:case S._continue:return this.parseBreakContinueStatement(o,i.keyword);case S._debugger:return this.parseDebuggerStatement(o);case S._do:return this.parseDoStatement(o);case S._for:return this.parseForStatement(o);case S._function:return t&&(this.strict||"if"!==t&&"label"!==t)&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(o,!1,!t);case S._class:return t&&this.unexpected(),this.parseClass(o,!0);case S._if:return this.parseIfStatement(o);case S._return:return this.parseReturnStatement(o);case S._switch:return this.parseSwitchStatement(o);case S._throw:return this.parseThrowStatement(o);case S._try:return this.parseTryStatement(o);case S._const:case S._var:return r=r||this.value,t&&"var"!==r&&this.unexpected(),this.parseVarStatement(o,r);case S._while:return this.parseWhileStatement(o);case S._with:return this.parseWithStatement(o);case S.braceL:return this.parseBlock(!0,o);case S.semi:return this.parseEmptyStatement(o);case S._export:case S._import:if(this.options.ecmaVersion>10&&i===S._import){M.lastIndex=this.pos;var a=M.exec(this.input),s=this.pos+a[0].length,u=this.input.charCodeAt(s);if(40===u||46===u)return this.parseExpressionStatement(o,this.parseExpression())}return this.options.allowImportExportEverywhere||(e||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),i===S._import?this.parseImport(o):this.parseExport(o,n);default:if(this.isAsyncFunction())return t&&this.unexpected(),this.next(),this.parseFunctionStatement(o,!0,!t);var l=this.value,c=this.parseExpression();return i===S.name&&"Identifier"===c.type&&this.eat(S.colon)?this.parseLabeledStatement(o,l,c,t):this.parseExpressionStatement(o,c)}},W.parseBreakContinueStatement=function(t,e){var n="break"===e;this.next(),this.eat(S.semi)||this.insertSemicolon()?t.label=null:this.type!==S.name?this.unexpected():(t.label=this.parseIdent(),this.semicolon());for(var r=0;r<this.labels.length;++r){var i=this.labels[r];if(null==t.label||i.name===t.label.name){if(null!=i.kind&&(n||"loop"===i.kind))break;if(t.label&&n)break}}return r===this.labels.length&&this.raise(t.start,"Unsyntactic "+e),this.finishNode(t,n?"BreakStatement":"ContinueStatement")},W.parseDebuggerStatement=function(t){return this.next(),this.semicolon(),this.finishNode(t,"DebuggerStatement")},W.parseDoStatement=function(t){return this.next(),this.labels.push(q),t.body=this.parseStatement("do"),this.labels.pop(),this.expect(S._while),t.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(S.semi):this.semicolon(),this.finishNode(t,"DoWhileStatement")},W.parseForStatement=function(t){this.next();var e=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(q),this.enterScope(0),this.expect(S.parenL),this.type===S.semi)return e>-1&&this.unexpected(e),this.parseFor(t,null);var n=this.isLet();if(this.type===S._var||this.type===S._const||n){var r=this.startNode(),i=n?"let":this.value;return this.next(),this.parseVar(r,!0,i),this.finishNode(r,"VariableDeclaration"),(this.type===S._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&1===r.declarations.length?(this.options.ecmaVersion>=9&&(this.type===S._in?e>-1&&this.unexpected(e):t.await=e>-1),this.parseForIn(t,r)):(e>-1&&this.unexpected(e),this.parseFor(t,r))}var o=new H,a=this.parseExpression(!0,o);return this.type===S._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===S._in?e>-1&&this.unexpected(e):t.await=e>-1),this.toAssignable(a,!1,o),this.checkLVal(a),this.parseForIn(t,a)):(this.checkExpressionErrors(o,!0),e>-1&&this.unexpected(e),this.parseFor(t,a))},W.parseFunctionStatement=function(t,e,n){return this.next(),this.parseFunction(t,K|(n?0:Q),!1,e)},W.parseIfStatement=function(t){return this.next(),t.test=this.parseParenExpression(),t.consequent=this.parseStatement("if"),t.alternate=this.eat(S._else)?this.parseStatement("if"):null,this.finishNode(t,"IfStatement")},W.parseReturnStatement=function(t){return this.inFunction||this.options.allowReturnOutsideFunction||this.raise(this.start,"'return' outside of function"),this.next(),this.eat(S.semi)||this.insertSemicolon()?t.argument=null:(t.argument=this.parseExpression(),this.semicolon()),this.finishNode(t,"ReturnStatement")},W.parseSwitchStatement=function(t){var e;this.next(),t.discriminant=this.parseParenExpression(),t.cases=[],this.expect(S.braceL),this.labels.push(X),this.enterScope(0);for(var n=!1;this.type!==S.braceR;)if(this.type===S._case||this.type===S._default){var r=this.type===S._case;e&&this.finishNode(e,"SwitchCase"),t.cases.push(e=this.startNode()),e.consequent=[],this.next(),r?e.test=this.parseExpression():(n&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),n=!0,e.test=null),this.expect(S.colon)}else e||this.unexpected(),e.consequent.push(this.parseStatement(null));return this.exitScope(),e&&this.finishNode(e,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(t,"SwitchStatement")},W.parseThrowStatement=function(t){return this.next(),E.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),t.argument=this.parseExpression(),this.semicolon(),this.finishNode(t,"ThrowStatement")};var Y=[];W.parseTryStatement=function(t){if(this.next(),t.block=this.parseBlock(),t.handler=null,this.type===S._catch){var e=this.startNode();if(this.next(),this.eat(S.parenL)){e.param=this.parseBindingAtom();var n="Identifier"===e.param.type;this.enterScope(n?32:0),this.checkLVal(e.param,n?4:2),this.expect(S.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),e.param=null,this.enterScope(0);e.body=this.parseBlock(!1),this.exitScope(),t.handler=this.finishNode(e,"CatchClause")}return t.finalizer=this.eat(S._finally)?this.parseBlock():null,t.handler||t.finalizer||this.raise(t.start,"Missing catch or finally clause"),this.finishNode(t,"TryStatement")},W.parseVarStatement=function(t,e){return this.next(),this.parseVar(t,!1,e),this.semicolon(),this.finishNode(t,"VariableDeclaration")},W.parseWhileStatement=function(t){return this.next(),t.test=this.parseParenExpression(),this.labels.push(q),t.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(t,"WhileStatement")},W.parseWithStatement=function(t){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),t.object=this.parseParenExpression(),t.body=this.parseStatement("with"),this.finishNode(t,"WithStatement")},W.parseEmptyStatement=function(t){return this.next(),this.finishNode(t,"EmptyStatement")},W.parseLabeledStatement=function(t,e,n,r){for(var i=0,o=this.labels;i<o.length;i+=1){o[i].name===e&&this.raise(n.start,"Label '"+e+"' is already declared")}for(var a=this.type.isLoop?"loop":this.type===S._switch?"switch":null,s=this.labels.length-1;s>=0;s--){var u=this.labels[s];if(u.statementStart!==t.start)break;u.statementStart=this.start,u.kind=a}return this.labels.push({name:e,kind:a,statementStart:this.start}),t.body=this.parseStatement(r?-1===r.indexOf("label")?r+"label":r:"label"),this.labels.pop(),t.label=n,this.finishNode(t,"LabeledStatement")},W.parseExpressionStatement=function(t,e){return t.expression=e,this.semicolon(),this.finishNode(t,"ExpressionStatement")},W.parseBlock=function(t,e,n){for(void 0===t&&(t=!0),void 0===e&&(e=this.startNode()),e.body=[],this.expect(S.braceL),t&&this.enterScope(0);this.type!==S.braceR;){var r=this.parseStatement(null);e.body.push(r)}return n&&(this.strict=!1),this.next(),t&&this.exitScope(),this.finishNode(e,"BlockStatement")},W.parseFor=function(t,e){return t.init=e,this.expect(S.semi),t.test=this.type===S.semi?null:this.parseExpression(),this.expect(S.semi),t.update=this.type===S.parenR?null:this.parseExpression(),this.expect(S.parenR),t.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(t,"ForStatement")},W.parseForIn=function(t,e){var n=this.type===S._in;return this.next(),"VariableDeclaration"===e.type&&null!=e.declarations[0].init&&(!n||this.options.ecmaVersion<8||this.strict||"var"!==e.kind||"Identifier"!==e.declarations[0].id.type)?this.raise(e.start,(n?"for-in":"for-of")+" loop variable declaration may not have an initializer"):"AssignmentPattern"===e.type&&this.raise(e.start,"Invalid left-hand side in for-loop"),t.left=e,t.right=n?this.parseExpression():this.parseMaybeAssign(),this.expect(S.parenR),t.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(t,n?"ForInStatement":"ForOfStatement")},W.parseVar=function(t,e,n){for(t.declarations=[],t.kind=n;;){var r=this.startNode();if(this.parseVarId(r,n),this.eat(S.eq)?r.init=this.parseMaybeAssign(e):"const"!==n||this.type===S._in||this.options.ecmaVersion>=6&&this.isContextual("of")?"Identifier"===r.id.type||e&&(this.type===S._in||this.isContextual("of"))?r.init=null:this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):this.unexpected(),t.declarations.push(this.finishNode(r,"VariableDeclarator")),!this.eat(S.comma))break}return t},W.parseVarId=function(t,e){t.id=this.parseBindingAtom(),this.checkLVal(t.id,"var"===e?1:2,!1)};var K=1,Q=2;W.parseFunction=function(t,e,n,r){this.initFunction(t),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!r)&&(this.type===S.star&&e&Q&&this.unexpected(),t.generator=this.eat(S.star)),this.options.ecmaVersion>=8&&(t.async=!!r),e&K&&(t.id=4&e&&this.type!==S.name?null:this.parseIdent(),!t.id||e&Q||this.checkLVal(t.id,this.strict||t.generator||t.async?this.treatFunctionsAsVar?1:2:3));var i=this.yieldPos,o=this.awaitPos,a=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(B(t.async,t.generator)),e&K||(t.id=this.type===S.name?this.parseIdent():null),this.parseFunctionParams(t),this.parseFunctionBody(t,n,!1),this.yieldPos=i,this.awaitPos=o,this.awaitIdentPos=a,this.finishNode(t,e&K?"FunctionDeclaration":"FunctionExpression")},W.parseFunctionParams=function(t){this.expect(S.parenL),t.params=this.parseBindingList(S.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},W.parseClass=function(t,e){this.next();var n=this.strict;this.strict=!0,this.parseClassId(t,e),this.parseClassSuper(t);var r=this.startNode(),i=!1;for(r.body=[],this.expect(S.braceL);this.type!==S.braceR;){var o=this.parseClassElement(null!==t.superClass);o&&(r.body.push(o),"MethodDefinition"===o.type&&"constructor"===o.kind&&(i&&this.raise(o.start,"Duplicate constructor in the same class"),i=!0))}return this.strict=n,this.next(),t.body=this.finishNode(r,"ClassBody"),this.finishNode(t,e?"ClassDeclaration":"ClassExpression")},W.parseClassElement=function(t){var e=this;if(this.eat(S.semi))return null;var n=this.startNode(),r=function(t,r){void 0===r&&(r=!1);var i=e.start,o=e.startLoc;return!!e.eatContextual(t)&&(!(e.type===S.parenL||r&&e.canInsertSemicolon())||(n.key&&e.unexpected(),n.computed=!1,n.key=e.startNodeAt(i,o),n.key.name=t,e.finishNode(n.key,"Identifier"),!1))};n.kind="method",n.static=r("static");var i=this.eat(S.star),o=!1;i||(this.options.ecmaVersion>=8&&r("async",!0)?(o=!0,i=this.options.ecmaVersion>=9&&this.eat(S.star)):r("get")?n.kind="get":r("set")&&(n.kind="set")),n.key||this.parsePropertyName(n);var a=n.key,s=!1;return n.computed||n.static||!("Identifier"===a.type&&"constructor"===a.name||"Literal"===a.type&&"constructor"===a.value)?n.static&&"Identifier"===a.type&&"prototype"===a.name&&this.raise(a.start,"Classes may not have a static property named prototype"):("method"!==n.kind&&this.raise(a.start,"Constructor can't have get/set modifier"),i&&this.raise(a.start,"Constructor can't be a generator"),o&&this.raise(a.start,"Constructor can't be an async method"),n.kind="constructor",s=t),this.parseClassMethod(n,i,o,s),"get"===n.kind&&0!==n.value.params.length&&this.raiseRecoverable(n.value.start,"getter should have no params"),"set"===n.kind&&1!==n.value.params.length&&this.raiseRecoverable(n.value.start,"setter should have exactly one param"),"set"===n.kind&&"RestElement"===n.value.params[0].type&&this.raiseRecoverable(n.value.params[0].start,"Setter cannot use rest params"),n},W.parseClassMethod=function(t,e,n,r){return t.value=this.parseMethod(e,n,r),this.finishNode(t,"MethodDefinition")},W.parseClassId=function(t,e){this.type===S.name?(t.id=this.parseIdent(),e&&this.checkLVal(t.id,2,!1)):(!0===e&&this.unexpected(),t.id=null)},W.parseClassSuper=function(t){t.superClass=this.eat(S._extends)?this.parseExprSubscripts():null},W.parseExport=function(t,e){if(this.next(),this.eat(S.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(t.exported=this.parseIdent(!0),this.checkExport(e,t.exported.name,this.lastTokStart)):t.exported=null),this.expectContextual("from"),this.type!==S.string&&this.unexpected(),t.source=this.parseExprAtom(),this.semicolon(),this.finishNode(t,"ExportAllDeclaration");if(this.eat(S._default)){var n;if(this.checkExport(e,"default",this.lastTokStart),this.type===S._function||(n=this.isAsyncFunction())){var r=this.startNode();this.next(),n&&this.next(),t.declaration=this.parseFunction(r,4|K,!1,n)}else if(this.type===S._class){var i=this.startNode();t.declaration=this.parseClass(i,"nullableID")}else t.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(t,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())t.declaration=this.parseStatement(null),"VariableDeclaration"===t.declaration.type?this.checkVariableExport(e,t.declaration.declarations):this.checkExport(e,t.declaration.id.name,t.declaration.id.start),t.specifiers=[],t.source=null;else{if(t.declaration=null,t.specifiers=this.parseExportSpecifiers(e),this.eatContextual("from"))this.type!==S.string&&this.unexpected(),t.source=this.parseExprAtom();else{for(var o=0,a=t.specifiers;o<a.length;o+=1){var s=a[o];this.checkUnreserved(s.local),this.checkLocalExport(s.local)}t.source=null}this.semicolon()}return this.finishNode(t,"ExportNamedDeclaration")},W.checkExport=function(t,e,n){t&&(L(t,e)&&this.raiseRecoverable(n,"Duplicate export '"+e+"'"),t[e]=!0)},W.checkPatternExport=function(t,e){var n=e.type;if("Identifier"===n)this.checkExport(t,e.name,e.start);else if("ObjectPattern"===n)for(var r=0,i=e.properties;r<i.length;r+=1){var o=i[r];this.checkPatternExport(t,o)}else if("ArrayPattern"===n)for(var a=0,s=e.elements;a<s.length;a+=1){var u=s[a];u&&this.checkPatternExport(t,u)}else"Property"===n?this.checkPatternExport(t,e.value):"AssignmentPattern"===n?this.checkPatternExport(t,e.left):"RestElement"===n?this.checkPatternExport(t,e.argument):"ParenthesizedExpression"===n&&this.checkPatternExport(t,e.expression)},W.checkVariableExport=function(t,e){if(t)for(var n=0,r=e;n<r.length;n+=1){var i=r[n];this.checkPatternExport(t,i.id)}},W.shouldParseExportStatement=function(){return"var"===this.type.keyword||"const"===this.type.keyword||"class"===this.type.keyword||"function"===this.type.keyword||this.isLet()||this.isAsyncFunction()},W.parseExportSpecifiers=function(t){var e=[],n=!0;for(this.expect(S.braceL);!this.eat(S.braceR);){if(n)n=!1;else if(this.expect(S.comma),this.afterTrailingComma(S.braceR))break;var r=this.startNode();r.local=this.parseIdent(!0),r.exported=this.eatContextual("as")?this.parseIdent(!0):r.local,this.checkExport(t,r.exported.name,r.exported.start),e.push(this.finishNode(r,"ExportSpecifier"))}return e},W.parseImport=function(t){return this.next(),this.type===S.string?(t.specifiers=Y,t.source=this.parseExprAtom()):(t.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),t.source=this.type===S.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(t,"ImportDeclaration")},W.parseImportSpecifiers=function(){var t=[],e=!0;if(this.type===S.name){var n=this.startNode();if(n.local=this.parseIdent(),this.checkLVal(n.local,2),t.push(this.finishNode(n,"ImportDefaultSpecifier")),!this.eat(S.comma))return t}if(this.type===S.star){var r=this.startNode();return this.next(),this.expectContextual("as"),r.local=this.parseIdent(),this.checkLVal(r.local,2),t.push(this.finishNode(r,"ImportNamespaceSpecifier")),t}for(this.expect(S.braceL);!this.eat(S.braceR);){if(e)e=!1;else if(this.expect(S.comma),this.afterTrailingComma(S.braceR))break;var i=this.startNode();i.imported=this.parseIdent(!0),this.eatContextual("as")?i.local=this.parseIdent():(this.checkUnreserved(i.imported),i.local=i.imported),this.checkLVal(i.local,2),t.push(this.finishNode(i,"ImportSpecifier"))}return t},W.adaptDirectivePrologue=function(t){for(var e=0;e<t.length&&this.isDirectiveCandidate(t[e]);++e)t[e].directive=t[e].expression.raw.slice(1,-1)},W.isDirectiveCandidate=function(t){return"ExpressionStatement"===t.type&&"Literal"===t.expression.type&&"string"==typeof t.expression.value&&('"'===this.input[t.start]||"'"===this.input[t.start])};var J=j.prototype;J.toAssignable=function(t,e,n){if(this.options.ecmaVersion>=6&&t)switch(t.type){case"Identifier":this.inAsync&&"await"===t.name&&this.raise(t.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":t.type="ObjectPattern",n&&this.checkPatternErrors(n,!0);for(var r=0,i=t.properties;r<i.length;r+=1){var o=i[r];this.toAssignable(o,e),"RestElement"!==o.type||"ArrayPattern"!==o.argument.type&&"ObjectPattern"!==o.argument.type||this.raise(o.argument.start,"Unexpected token")}break;case"Property":"init"!==t.kind&&this.raise(t.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(t.value,e);break;case"ArrayExpression":t.type="ArrayPattern",n&&this.checkPatternErrors(n,!0),this.toAssignableList(t.elements,e);break;case"SpreadElement":t.type="RestElement",this.toAssignable(t.argument,e),"AssignmentPattern"===t.argument.type&&this.raise(t.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":"="!==t.operator&&this.raise(t.left.end,"Only '=' operator can be used for specifying default value."),t.type="AssignmentPattern",delete t.operator,this.toAssignable(t.left,e);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(t.expression,e,n);break;case"ChainExpression":this.raiseRecoverable(t.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!e)break;default:this.raise(t.start,"Assigning to rvalue")}else n&&this.checkPatternErrors(n,!0);return t},J.toAssignableList=function(t,e){for(var n=t.length,r=0;r<n;r++){var i=t[r];i&&this.toAssignable(i,e)}if(n){var o=t[n-1];6===this.options.ecmaVersion&&e&&o&&"RestElement"===o.type&&"Identifier"!==o.argument.type&&this.unexpected(o.argument.start)}return t},J.parseSpread=function(t){var e=this.startNode();return this.next(),e.argument=this.parseMaybeAssign(!1,t),this.finishNode(e,"SpreadElement")},J.parseRestBinding=function(){var t=this.startNode();return this.next(),6===this.options.ecmaVersion&&this.type!==S.name&&this.unexpected(),t.argument=this.parseBindingAtom(),this.finishNode(t,"RestElement")},J.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case S.bracketL:var t=this.startNode();return this.next(),t.elements=this.parseBindingList(S.bracketR,!0,!0),this.finishNode(t,"ArrayPattern");case S.braceL:return this.parseObj(!0)}return this.parseIdent()},J.parseBindingList=function(t,e,n){for(var r=[],i=!0;!this.eat(t);)if(i?i=!1:this.expect(S.comma),e&&this.type===S.comma)r.push(null);else{if(n&&this.afterTrailingComma(t))break;if(this.type===S.ellipsis){var o=this.parseRestBinding();this.parseBindingListItem(o),r.push(o),this.type===S.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(t);break}var a=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(a),r.push(a)}return r},J.parseBindingListItem=function(t){return t},J.parseMaybeDefault=function(t,e,n){if(n=n||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(S.eq))return n;var r=this.startNodeAt(t,e);return r.left=n,r.right=this.parseMaybeAssign(),this.finishNode(r,"AssignmentPattern")},J.checkLVal=function(t,e,n){switch(void 0===e&&(e=0),t.type){case"Identifier":2===e&&"let"===t.name&&this.raiseRecoverable(t.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(t.name)&&this.raiseRecoverable(t.start,(e?"Binding ":"Assigning to ")+t.name+" in strict mode"),n&&(L(n,t.name)&&this.raiseRecoverable(t.start,"Argument name clash"),n[t.name]=!0),0!==e&&5!==e&&this.declareName(t.name,e,t.start);break;case"ChainExpression":this.raiseRecoverable(t.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":e&&this.raiseRecoverable(t.start,"Binding member expression");break;case"ObjectPattern":for(var r=0,i=t.properties;r<i.length;r+=1){var o=i[r];this.checkLVal(o,e,n)}break;case"Property":this.checkLVal(t.value,e,n);break;case"ArrayPattern":for(var a=0,s=t.elements;a<s.length;a+=1){var u=s[a];u&&this.checkLVal(u,e,n)}break;case"AssignmentPattern":this.checkLVal(t.left,e,n);break;case"RestElement":this.checkLVal(t.argument,e,n);break;case"ParenthesizedExpression":this.checkLVal(t.expression,e,n);break;default:this.raise(t.start,(e?"Binding":"Assigning to")+" rvalue")}};var $=j.prototype;$.checkPropClash=function(t,e,n){if(!(this.options.ecmaVersion>=9&&"SpreadElement"===t.type||this.options.ecmaVersion>=6&&(t.computed||t.method||t.shorthand))){var r,i=t.key;switch(i.type){case"Identifier":r=i.name;break;case"Literal":r=String(i.value);break;default:return}var o=t.kind;if(this.options.ecmaVersion>=6)"__proto__"===r&&"init"===o&&(e.proto&&(n?n.doubleProto<0&&(n.doubleProto=i.start):this.raiseRecoverable(i.start,"Redefinition of __proto__ property")),e.proto=!0);else{var a=e[r="$"+r];if(a)("init"===o?this.strict&&a.init||a.get||a.set:a.init||a[o])&&this.raiseRecoverable(i.start,"Redefinition of property");else a=e[r]={init:!1,get:!1,set:!1};a[o]=!0}}},$.parseExpression=function(t,e){var n=this.start,r=this.startLoc,i=this.parseMaybeAssign(t,e);if(this.type===S.comma){var o=this.startNodeAt(n,r);for(o.expressions=[i];this.eat(S.comma);)o.expressions.push(this.parseMaybeAssign(t,e));return this.finishNode(o,"SequenceExpression")}return i},$.parseMaybeAssign=function(t,e,n){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(t);this.exprAllowed=!1}var r=!1,i=-1,o=-1;e?(i=e.parenthesizedAssign,o=e.trailingComma,e.parenthesizedAssign=e.trailingComma=-1):(e=new H,r=!0);var a=this.start,s=this.startLoc;this.type!==S.parenL&&this.type!==S.name||(this.potentialArrowAt=this.start);var u=this.parseMaybeConditional(t,e);if(n&&(u=n.call(this,u,a,s)),this.type.isAssign){var l=this.startNodeAt(a,s);return l.operator=this.value,l.left=this.type===S.eq?this.toAssignable(u,!1,e):u,r||(e.parenthesizedAssign=e.trailingComma=e.doubleProto=-1),e.shorthandAssign>=l.left.start&&(e.shorthandAssign=-1),this.checkLVal(u),this.next(),l.right=this.parseMaybeAssign(t),this.finishNode(l,"AssignmentExpression")}return r&&this.checkExpressionErrors(e,!0),i>-1&&(e.parenthesizedAssign=i),o>-1&&(e.trailingComma=o),u},$.parseMaybeConditional=function(t,e){var n=this.start,r=this.startLoc,i=this.parseExprOps(t,e);if(this.checkExpressionErrors(e))return i;if(this.eat(S.question)){var o=this.startNodeAt(n,r);return o.test=i,o.consequent=this.parseMaybeAssign(),this.expect(S.colon),o.alternate=this.parseMaybeAssign(t),this.finishNode(o,"ConditionalExpression")}return i},$.parseExprOps=function(t,e){var n=this.start,r=this.startLoc,i=this.parseMaybeUnary(e,!1);return this.checkExpressionErrors(e)||i.start===n&&"ArrowFunctionExpression"===i.type?i:this.parseExprOp(i,n,r,-1,t)},$.parseExprOp=function(t,e,n,r,i){var o=this.type.binop;if(null!=o&&(!i||this.type!==S._in)&&o>r){var a=this.type===S.logicalOR||this.type===S.logicalAND,s=this.type===S.coalesce;s&&(o=S.logicalAND.binop);var u=this.value;this.next();var l=this.start,c=this.startLoc,p=this.parseExprOp(this.parseMaybeUnary(null,!1),l,c,o,i),h=this.buildBinary(e,n,t,p,u,a||s);return(a&&this.type===S.coalesce||s&&(this.type===S.logicalOR||this.type===S.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(h,e,n,r,i)}return t},$.buildBinary=function(t,e,n,r,i,o){var a=this.startNodeAt(t,e);return a.left=n,a.operator=i,a.right=r,this.finishNode(a,o?"LogicalExpression":"BinaryExpression")},$.parseMaybeUnary=function(t,e){var n,r=this.start,i=this.startLoc;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))n=this.parseAwait(),e=!0;else if(this.type.prefix){var o=this.startNode(),a=this.type===S.incDec;o.operator=this.value,o.prefix=!0,this.next(),o.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(t,!0),a?this.checkLVal(o.argument):this.strict&&"delete"===o.operator&&"Identifier"===o.argument.type?this.raiseRecoverable(o.start,"Deleting local variable in strict mode"):e=!0,n=this.finishNode(o,a?"UpdateExpression":"UnaryExpression")}else{if(n=this.parseExprSubscripts(t),this.checkExpressionErrors(t))return n;for(;this.type.postfix&&!this.canInsertSemicolon();){var s=this.startNodeAt(r,i);s.operator=this.value,s.prefix=!1,s.argument=n,this.checkLVal(n),this.next(),n=this.finishNode(s,"UpdateExpression")}}return!e&&this.eat(S.starstar)?this.buildBinary(r,i,n,this.parseMaybeUnary(null,!1),"**",!1):n},$.parseExprSubscripts=function(t){var e=this.start,n=this.startLoc,r=this.parseExprAtom(t);if("ArrowFunctionExpression"===r.type&&")"!==this.input.slice(this.lastTokStart,this.lastTokEnd))return r;var i=this.parseSubscripts(r,e,n);return t&&"MemberExpression"===i.type&&(t.parenthesizedAssign>=i.start&&(t.parenthesizedAssign=-1),t.parenthesizedBind>=i.start&&(t.parenthesizedBind=-1)),i},$.parseSubscripts=function(t,e,n,r){for(var i=this.options.ecmaVersion>=8&&"Identifier"===t.type&&"async"===t.name&&this.lastTokEnd===t.end&&!this.canInsertSemicolon()&&t.end-t.start==5&&this.potentialArrowAt===t.start,o=!1;;){var a=this.parseSubscript(t,e,n,r,i,o);if(a.optional&&(o=!0),a===t||"ArrowFunctionExpression"===a.type){if(o){var s=this.startNodeAt(e,n);s.expression=a,a=this.finishNode(s,"ChainExpression")}return a}t=a}},$.parseSubscript=function(t,e,n,r,i,o){var a=this.options.ecmaVersion>=11,s=a&&this.eat(S.questionDot);r&&s&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var u=this.eat(S.bracketL);if(u||s&&this.type!==S.parenL&&this.type!==S.backQuote||this.eat(S.dot)){var l=this.startNodeAt(e,n);l.object=t,l.property=u?this.parseExpression():this.parseIdent("never"!==this.options.allowReserved),l.computed=!!u,u&&this.expect(S.bracketR),a&&(l.optional=s),t=this.finishNode(l,"MemberExpression")}else if(!r&&this.eat(S.parenL)){var c=new H,p=this.yieldPos,h=this.awaitPos,f=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var d=this.parseExprList(S.parenR,this.options.ecmaVersion>=8,!1,c);if(i&&!s&&!this.canInsertSemicolon()&&this.eat(S.arrow))return this.checkPatternErrors(c,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=p,this.awaitPos=h,this.awaitIdentPos=f,this.parseArrowExpression(this.startNodeAt(e,n),d,!0);this.checkExpressionErrors(c,!0),this.yieldPos=p||this.yieldPos,this.awaitPos=h||this.awaitPos,this.awaitIdentPos=f||this.awaitIdentPos;var v=this.startNodeAt(e,n);v.callee=t,v.arguments=d,a&&(v.optional=s),t=this.finishNode(v,"CallExpression")}else if(this.type===S.backQuote){(s||o)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var m=this.startNodeAt(e,n);m.tag=t,m.quasi=this.parseTemplate({isTagged:!0}),t=this.finishNode(m,"TaggedTemplateExpression")}return t},$.parseExprAtom=function(t){this.type===S.slash&&this.readRegexp();var e,n=this.potentialArrowAt===this.start;switch(this.type){case S._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),e=this.startNode(),this.next(),this.type!==S.parenL||this.allowDirectSuper||this.raise(e.start,"super() call outside constructor of a subclass"),this.type!==S.dot&&this.type!==S.bracketL&&this.type!==S.parenL&&this.unexpected(),this.finishNode(e,"Super");case S._this:return e=this.startNode(),this.next(),this.finishNode(e,"ThisExpression");case S.name:var r=this.start,i=this.startLoc,o=this.containsEsc,a=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!o&&"async"===a.name&&!this.canInsertSemicolon()&&this.eat(S._function))return this.parseFunction(this.startNodeAt(r,i),0,!1,!0);if(n&&!this.canInsertSemicolon()){if(this.eat(S.arrow))return this.parseArrowExpression(this.startNodeAt(r,i),[a],!1);if(this.options.ecmaVersion>=8&&"async"===a.name&&this.type===S.name&&!o)return a=this.parseIdent(!1),!this.canInsertSemicolon()&&this.eat(S.arrow)||this.unexpected(),this.parseArrowExpression(this.startNodeAt(r,i),[a],!0)}return a;case S.regexp:var s=this.value;return(e=this.parseLiteral(s.value)).regex={pattern:s.pattern,flags:s.flags},e;case S.num:case S.string:return this.parseLiteral(this.value);case S._null:case S._true:case S._false:return(e=this.startNode()).value=this.type===S._null?null:this.type===S._true,e.raw=this.type.keyword,this.next(),this.finishNode(e,"Literal");case S.parenL:var u=this.start,l=this.parseParenAndDistinguishExpression(n);return t&&(t.parenthesizedAssign<0&&!this.isSimpleAssignTarget(l)&&(t.parenthesizedAssign=u),t.parenthesizedBind<0&&(t.parenthesizedBind=u)),l;case S.bracketL:return e=this.startNode(),this.next(),e.elements=this.parseExprList(S.bracketR,!0,!0,t),this.finishNode(e,"ArrayExpression");case S.braceL:return this.parseObj(!1,t);case S._function:return e=this.startNode(),this.next(),this.parseFunction(e,0);case S._class:return this.parseClass(this.startNode(),!1);case S._new:return this.parseNew();case S.backQuote:return this.parseTemplate();case S._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},$.parseExprImport=function(){var t=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var e=this.parseIdent(!0);switch(this.type){case S.parenL:return this.parseDynamicImport(t);case S.dot:return t.meta=e,this.parseImportMeta(t);default:this.unexpected()}},$.parseDynamicImport=function(t){if(this.next(),t.source=this.parseMaybeAssign(),!this.eat(S.parenR)){var e=this.start;this.eat(S.comma)&&this.eat(S.parenR)?this.raiseRecoverable(e,"Trailing comma is not allowed in import()"):this.unexpected(e)}return this.finishNode(t,"ImportExpression")},$.parseImportMeta=function(t){this.next();var e=this.containsEsc;return t.property=this.parseIdent(!0),"meta"!==t.property.name&&this.raiseRecoverable(t.property.start,"The only valid meta property for import is 'import.meta'"),e&&this.raiseRecoverable(t.start,"'import.meta' must not contain escaped characters"),"module"!==this.options.sourceType&&this.raiseRecoverable(t.start,"Cannot use 'import.meta' outside a module"),this.finishNode(t,"MetaProperty")},$.parseLiteral=function(t){var e=this.startNode();return e.value=t,e.raw=this.input.slice(this.start,this.end),110===e.raw.charCodeAt(e.raw.length-1)&&(e.bigint=e.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(e,"Literal")},$.parseParenExpression=function(){this.expect(S.parenL);var t=this.parseExpression();return this.expect(S.parenR),t},$.parseParenAndDistinguishExpression=function(t){var e,n=this.start,r=this.startLoc,i=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var o,a=this.start,s=this.startLoc,u=[],l=!0,c=!1,p=new H,h=this.yieldPos,f=this.awaitPos;for(this.yieldPos=0,this.awaitPos=0;this.type!==S.parenR;){if(l?l=!1:this.expect(S.comma),i&&this.afterTrailingComma(S.parenR,!0)){c=!0;break}if(this.type===S.ellipsis){o=this.start,u.push(this.parseParenItem(this.parseRestBinding())),this.type===S.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}u.push(this.parseMaybeAssign(!1,p,this.parseParenItem))}var d=this.start,v=this.startLoc;if(this.expect(S.parenR),t&&!this.canInsertSemicolon()&&this.eat(S.arrow))return this.checkPatternErrors(p,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=h,this.awaitPos=f,this.parseParenArrowList(n,r,u);u.length&&!c||this.unexpected(this.lastTokStart),o&&this.unexpected(o),this.checkExpressionErrors(p,!0),this.yieldPos=h||this.yieldPos,this.awaitPos=f||this.awaitPos,u.length>1?((e=this.startNodeAt(a,s)).expressions=u,this.finishNodeAt(e,"SequenceExpression",d,v)):e=u[0]}else e=this.parseParenExpression();if(this.options.preserveParens){var m=this.startNodeAt(n,r);return m.expression=e,this.finishNode(m,"ParenthesizedExpression")}return e},$.parseParenItem=function(t){return t},$.parseParenArrowList=function(t,e,n){return this.parseArrowExpression(this.startNodeAt(t,e),n)};var tt=[];$.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var t=this.startNode(),e=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(S.dot)){t.meta=e;var n=this.containsEsc;return t.property=this.parseIdent(!0),"target"!==t.property.name&&this.raiseRecoverable(t.property.start,"The only valid meta property for new is 'new.target'"),n&&this.raiseRecoverable(t.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(t.start,"'new.target' can only be used in functions"),this.finishNode(t,"MetaProperty")}var r=this.start,i=this.startLoc,o=this.type===S._import;return t.callee=this.parseSubscripts(this.parseExprAtom(),r,i,!0),o&&"ImportExpression"===t.callee.type&&this.raise(r,"Cannot use new with import()"),this.eat(S.parenL)?t.arguments=this.parseExprList(S.parenR,this.options.ecmaVersion>=8,!1):t.arguments=tt,this.finishNode(t,"NewExpression")},$.parseTemplateElement=function(t){var e=t.isTagged,n=this.startNode();return this.type===S.invalidTemplate?(e||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),n.value={raw:this.value,cooked:null}):n.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,"\n"),cooked:this.value},this.next(),n.tail=this.type===S.backQuote,this.finishNode(n,"TemplateElement")},$.parseTemplate=function(t){void 0===t&&(t={});var e=t.isTagged;void 0===e&&(e=!1);var n=this.startNode();this.next(),n.expressions=[];var r=this.parseTemplateElement({isTagged:e});for(n.quasis=[r];!r.tail;)this.type===S.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(S.dollarBraceL),n.expressions.push(this.parseExpression()),this.expect(S.braceR),n.quasis.push(r=this.parseTemplateElement({isTagged:e}));return this.next(),this.finishNode(n,"TemplateLiteral")},$.isAsyncProp=function(t){return!t.computed&&"Identifier"===t.key.type&&"async"===t.key.name&&(this.type===S.name||this.type===S.num||this.type===S.string||this.type===S.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===S.star)&&!E.test(this.input.slice(this.lastTokEnd,this.start))},$.parseObj=function(t,e){var n=this.startNode(),r=!0,i={};for(n.properties=[],this.next();!this.eat(S.braceR);){if(r)r=!1;else if(this.expect(S.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(S.braceR))break;var o=this.parseProperty(t,e);t||this.checkPropClash(o,i,e),n.properties.push(o)}return this.finishNode(n,t?"ObjectPattern":"ObjectExpression")},$.parseProperty=function(t,e){var n,r,i,o,a=this.startNode();if(this.options.ecmaVersion>=9&&this.eat(S.ellipsis))return t?(a.argument=this.parseIdent(!1),this.type===S.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(a,"RestElement")):(this.type===S.parenL&&e&&(e.parenthesizedAssign<0&&(e.parenthesizedAssign=this.start),e.parenthesizedBind<0&&(e.parenthesizedBind=this.start)),a.argument=this.parseMaybeAssign(!1,e),this.type===S.comma&&e&&e.trailingComma<0&&(e.trailingComma=this.start),this.finishNode(a,"SpreadElement"));this.options.ecmaVersion>=6&&(a.method=!1,a.shorthand=!1,(t||e)&&(i=this.start,o=this.startLoc),t||(n=this.eat(S.star)));var s=this.containsEsc;return this.parsePropertyName(a),!t&&!s&&this.options.ecmaVersion>=8&&!n&&this.isAsyncProp(a)?(r=!0,n=this.options.ecmaVersion>=9&&this.eat(S.star),this.parsePropertyName(a,e)):r=!1,this.parsePropertyValue(a,t,n,r,i,o,e,s),this.finishNode(a,"Property")},$.parsePropertyValue=function(t,e,n,r,i,o,a,s){if((n||r)&&this.type===S.colon&&this.unexpected(),this.eat(S.colon))t.value=e?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,a),t.kind="init";else if(this.options.ecmaVersion>=6&&this.type===S.parenL)e&&this.unexpected(),t.kind="init",t.method=!0,t.value=this.parseMethod(n,r);else if(e||s||!(this.options.ecmaVersion>=5)||t.computed||"Identifier"!==t.key.type||"get"!==t.key.name&&"set"!==t.key.name||this.type===S.comma||this.type===S.braceR||this.type===S.eq)this.options.ecmaVersion>=6&&!t.computed&&"Identifier"===t.key.type?((n||r)&&this.unexpected(),this.checkUnreserved(t.key),"await"!==t.key.name||this.awaitIdentPos||(this.awaitIdentPos=i),t.kind="init",e?t.value=this.parseMaybeDefault(i,o,t.key):this.type===S.eq&&a?(a.shorthandAssign<0&&(a.shorthandAssign=this.start),t.value=this.parseMaybeDefault(i,o,t.key)):t.value=t.key,t.shorthand=!0):this.unexpected();else{(n||r)&&this.unexpected(),t.kind=t.key.name,this.parsePropertyName(t),t.value=this.parseMethod(!1);var u="get"===t.kind?0:1;if(t.value.params.length!==u){var l=t.value.start;"get"===t.kind?this.raiseRecoverable(l,"getter should have no params"):this.raiseRecoverable(l,"setter should have exactly one param")}else"set"===t.kind&&"RestElement"===t.value.params[0].type&&this.raiseRecoverable(t.value.params[0].start,"Setter cannot use rest params")}},$.parsePropertyName=function(t){if(this.options.ecmaVersion>=6){if(this.eat(S.bracketL))return t.computed=!0,t.key=this.parseMaybeAssign(),this.expect(S.bracketR),t.key;t.computed=!1}return t.key=this.type===S.num||this.type===S.string?this.parseExprAtom():this.parseIdent("never"!==this.options.allowReserved)},$.initFunction=function(t){t.id=null,this.options.ecmaVersion>=6&&(t.generator=t.expression=!1),this.options.ecmaVersion>=8&&(t.async=!1)},$.parseMethod=function(t,e,n){var r=this.startNode(),i=this.yieldPos,o=this.awaitPos,a=this.awaitIdentPos;return this.initFunction(r),this.options.ecmaVersion>=6&&(r.generator=t),this.options.ecmaVersion>=8&&(r.async=!!e),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(64|B(e,r.generator)|(n?128:0)),this.expect(S.parenL),r.params=this.parseBindingList(S.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(r,!1,!0),this.yieldPos=i,this.awaitPos=o,this.awaitIdentPos=a,this.finishNode(r,"FunctionExpression")},$.parseArrowExpression=function(t,e,n){var r=this.yieldPos,i=this.awaitPos,o=this.awaitIdentPos;return this.enterScope(16|B(n,!1)),this.initFunction(t),this.options.ecmaVersion>=8&&(t.async=!!n),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,t.params=this.toAssignableList(e,!0),this.parseFunctionBody(t,!0,!1),this.yieldPos=r,this.awaitPos=i,this.awaitIdentPos=o,this.finishNode(t,"ArrowFunctionExpression")},$.parseFunctionBody=function(t,e,n){var r=e&&this.type!==S.braceL,i=this.strict,o=!1;if(r)t.body=this.parseMaybeAssign(),t.expression=!0,this.checkParams(t,!1);else{var a=this.options.ecmaVersion>=7&&!this.isSimpleParamList(t.params);i&&!a||(o=this.strictDirective(this.end))&&a&&this.raiseRecoverable(t.start,"Illegal 'use strict' directive in function with non-simple parameter list");var s=this.labels;this.labels=[],o&&(this.strict=!0),this.checkParams(t,!i&&!o&&!e&&!n&&this.isSimpleParamList(t.params)),this.strict&&t.id&&this.checkLVal(t.id,5),t.body=this.parseBlock(!1,void 0,o&&!i),t.expression=!1,this.adaptDirectivePrologue(t.body.body),this.labels=s}this.exitScope()},$.isSimpleParamList=function(t){for(var e=0,n=t;e<n.length;e+=1){if("Identifier"!==n[e].type)return!1}return!0},$.checkParams=function(t,e){for(var n={},r=0,i=t.params;r<i.length;r+=1){var o=i[r];this.checkLVal(o,1,e?null:n)}},$.parseExprList=function(t,e,n,r){for(var i=[],o=!0;!this.eat(t);){if(o)o=!1;else if(this.expect(S.comma),e&&this.afterTrailingComma(t))break;var a=void 0;n&&this.type===S.comma?a=null:this.type===S.ellipsis?(a=this.parseSpread(r),r&&this.type===S.comma&&r.trailingComma<0&&(r.trailingComma=this.start)):a=this.parseMaybeAssign(!1,r),i.push(a)}return i},$.checkUnreserved=function(t){var e=t.start,n=t.end,r=t.name;(this.inGenerator&&"yield"===r&&this.raiseRecoverable(e,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&"await"===r&&this.raiseRecoverable(e,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(r)&&this.raise(e,"Unexpected keyword '"+r+"'"),this.options.ecmaVersion<6&&-1!==this.input.slice(e,n).indexOf("\\"))||(this.strict?this.reservedWordsStrict:this.reservedWords).test(r)&&(this.inAsync||"await"!==r||this.raiseRecoverable(e,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(e,"The keyword '"+r+"' is reserved"))},$.parseIdent=function(t,e){var n=this.startNode();return this.type===S.name?n.name=this.value:this.type.keyword?(n.name=this.type.keyword,"class"!==n.name&&"function"!==n.name||this.lastTokEnd===this.lastTokStart+1&&46===this.input.charCodeAt(this.lastTokStart)||this.context.pop()):this.unexpected(),this.next(!!t),this.finishNode(n,"Identifier"),t||(this.checkUnreserved(n),"await"!==n.name||this.awaitIdentPos||(this.awaitIdentPos=n.start)),n},$.parseYield=function(t){this.yieldPos||(this.yieldPos=this.start);var e=this.startNode();return this.next(),this.type===S.semi||this.canInsertSemicolon()||this.type!==S.star&&!this.type.startsExpr?(e.delegate=!1,e.argument=null):(e.delegate=this.eat(S.star),e.argument=this.parseMaybeAssign(t)),this.finishNode(e,"YieldExpression")},$.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var t=this.startNode();return this.next(),t.argument=this.parseMaybeUnary(null,!1),this.finishNode(t,"AwaitExpression")};var et=j.prototype;et.raise=function(t,e){var n=Z(this.input,t);e+=" ("+n.line+":"+n.column+")";var r=new SyntaxError(e);throw r.pos=t,r.loc=n,r.raisedAt=this.pos,r},et.raiseRecoverable=et.raise,et.curPosition=function(){if(this.options.locations)return new D(this.curLine,this.pos-this.lineStart)};var nt=j.prototype,rt=function(t){this.flags=t,this.var=[],this.lexical=[],this.functions=[]};nt.enterScope=function(t){this.scopeStack.push(new rt(t))},nt.exitScope=function(){this.scopeStack.pop()},nt.treatFunctionsAsVarInScope=function(t){return 2&t.flags||!this.inModule&&1&t.flags},nt.declareName=function(t,e,n){var r=!1;if(2===e){var i=this.currentScope();r=i.lexical.indexOf(t)>-1||i.functions.indexOf(t)>-1||i.var.indexOf(t)>-1,i.lexical.push(t),this.inModule&&1&i.flags&&delete this.undefinedExports[t]}else if(4===e){this.currentScope().lexical.push(t)}else if(3===e){var o=this.currentScope();r=this.treatFunctionsAsVar?o.lexical.indexOf(t)>-1:o.lexical.indexOf(t)>-1||o.var.indexOf(t)>-1,o.functions.push(t)}else for(var a=this.scopeStack.length-1;a>=0;--a){var s=this.scopeStack[a];if(s.lexical.indexOf(t)>-1&&!(32&s.flags&&s.lexical[0]===t)||!this.treatFunctionsAsVarInScope(s)&&s.functions.indexOf(t)>-1){r=!0;break}if(s.var.push(t),this.inModule&&1&s.flags&&delete this.undefinedExports[t],3&s.flags)break}r&&this.raiseRecoverable(n,"Identifier '"+t+"' has already been declared")},nt.checkLocalExport=function(t){-1===this.scopeStack[0].lexical.indexOf(t.name)&&-1===this.scopeStack[0].var.indexOf(t.name)&&(this.undefinedExports[t.name]=t)},nt.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},nt.currentVarScope=function(){for(var t=this.scopeStack.length-1;;t--){var e=this.scopeStack[t];if(3&e.flags)return e}},nt.currentThisScope=function(){for(var t=this.scopeStack.length-1;;t--){var e=this.scopeStack[t];if(3&e.flags&&!(16&e.flags))return e}};var it=function(t,e,n){this.type="",this.start=e,this.end=0,t.options.locations&&(this.loc=new N(t,n)),t.options.directSourceFile&&(this.sourceFile=t.options.directSourceFile),t.options.ranges&&(this.range=[e,0])},ot=j.prototype;function at(t,e,n,r){return t.type=e,t.end=n,this.options.locations&&(t.loc.end=r),this.options.ranges&&(t.range[1]=n),t}ot.startNode=function(){return new it(this,this.start,this.startLoc)},ot.startNodeAt=function(t,e){return new it(this,t,e)},ot.finishNode=function(t,e){return at.call(this,t,e,this.lastTokEnd,this.lastTokEndLoc)},ot.finishNodeAt=function(t,e,n,r){return at.call(this,t,e,n,r)};var st=function(t,e,n,r,i){this.token=t,this.isExpr=!!e,this.preserveSpace=!!n,this.override=r,this.generator=!!i},ut={b_stat:new st("{",!1),b_expr:new st("{",!0),b_tmpl:new st("${",!1),p_stat:new st("(",!1),p_expr:new st("(",!0),q_tmpl:new st("`",!0,!0,(function(t){return t.tryReadTemplateToken()})),f_stat:new st("function",!1),f_expr:new st("function",!0),f_expr_gen:new st("function",!0,!1,null,!0),f_gen:new st("function",!1,!1,null,!0)},lt=j.prototype;lt.initialContext=function(){return[ut.b_stat]},lt.braceIsBlock=function(t){var e=this.curContext();return e===ut.f_expr||e===ut.f_stat||(t!==S.colon||e!==ut.b_stat&&e!==ut.b_expr?t===S._return||t===S.name&&this.exprAllowed?E.test(this.input.slice(this.lastTokEnd,this.start)):t===S._else||t===S.semi||t===S.eof||t===S.parenR||t===S.arrow||(t===S.braceL?e===ut.b_stat:t!==S._var&&t!==S._const&&t!==S.name&&!this.exprAllowed):!e.isExpr)},lt.inGeneratorContext=function(){for(var t=this.context.length-1;t>=1;t--){var e=this.context[t];if("function"===e.token)return e.generator}return!1},lt.updateContext=function(t){var e,n=this.type;n.keyword&&t===S.dot?this.exprAllowed=!1:(e=n.updateContext)?e.call(this,t):this.exprAllowed=n.beforeExpr},S.parenR.updateContext=S.braceR.updateContext=function(){if(1!==this.context.length){var t=this.context.pop();t===ut.b_stat&&"function"===this.curContext().token&&(t=this.context.pop()),this.exprAllowed=!t.isExpr}else this.exprAllowed=!0},S.braceL.updateContext=function(t){this.context.push(this.braceIsBlock(t)?ut.b_stat:ut.b_expr),this.exprAllowed=!0},S.dollarBraceL.updateContext=function(){this.context.push(ut.b_tmpl),this.exprAllowed=!0},S.parenL.updateContext=function(t){var e=t===S._if||t===S._for||t===S._with||t===S._while;this.context.push(e?ut.p_stat:ut.p_expr),this.exprAllowed=!0},S.incDec.updateContext=function(){},S._function.updateContext=S._class.updateContext=function(t){!t.beforeExpr||t===S.semi||t===S._else||t===S._return&&E.test(this.input.slice(this.lastTokEnd,this.start))||(t===S.colon||t===S.braceL)&&this.curContext()===ut.b_stat?this.context.push(ut.f_stat):this.context.push(ut.f_expr),this.exprAllowed=!1},S.backQuote.updateContext=function(){this.curContext()===ut.q_tmpl?this.context.pop():this.context.push(ut.q_tmpl),this.exprAllowed=!1},S.star.updateContext=function(t){if(t===S._function){var e=this.context.length-1;this.context[e]===ut.f_expr?this.context[e]=ut.f_expr_gen:this.context[e]=ut.f_gen}this.exprAllowed=!0},S.name.updateContext=function(t){var e=!1;this.options.ecmaVersion>=6&&t!==S.dot&&("of"===this.value&&!this.exprAllowed||"yield"===this.value&&this.inGeneratorContext())&&(e=!0),this.exprAllowed=e};var ct="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",pt=ct+" Extended_Pictographic",ht={9:ct,10:pt,11:"ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS Extended_Pictographic"},ft="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",dt="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",vt=dt+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",mt={9:dt,10:vt,11:"Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho"},yt={};function gt(t){var e=yt[t]={binary:R(ht[t]+" "+ft),nonBinary:{General_Category:R(ft),Script:R(mt[t])}};e.nonBinary.Script_Extensions=e.nonBinary.Script,e.nonBinary.gc=e.nonBinary.General_Category,e.nonBinary.sc=e.nonBinary.Script,e.nonBinary.scx=e.nonBinary.Script_Extensions}gt(9),gt(10),gt(11);var _t=j.prototype,xt=function(t){this.parser=t,this.validFlags="gim"+(t.options.ecmaVersion>=6?"uy":"")+(t.options.ecmaVersion>=9?"s":""),this.unicodeProperties=yt[t.options.ecmaVersion>=11?11:t.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};function bt(t){return t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t)))}function wt(t){return 36===t||t>=40&&t<=43||46===t||63===t||t>=91&&t<=94||t>=123&&t<=125}function St(t){return t>=65&&t<=90||t>=97&&t<=122}function Et(t){return St(t)||95===t}function Ct(t){return Et(t)||Tt(t)}function Tt(t){return t>=48&&t<=57}function At(t){return t>=48&&t<=57||t>=65&&t<=70||t>=97&&t<=102}function Mt(t){return t>=65&&t<=70?t-65+10:t>=97&&t<=102?t-97+10:t-48}function kt(t){return t>=48&&t<=55}xt.prototype.reset=function(t,e,n){var r=-1!==n.indexOf("u");this.start=0|t,this.source=e+"",this.flags=n,this.switchU=r&&this.parser.options.ecmaVersion>=6,this.switchN=r&&this.parser.options.ecmaVersion>=9},xt.prototype.raise=function(t){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+t)},xt.prototype.at=function(t,e){void 0===e&&(e=!1);var n=this.source,r=n.length;if(t>=r)return-1;var i=n.charCodeAt(t);if(!e&&!this.switchU||i<=55295||i>=57344||t+1>=r)return i;var o=n.charCodeAt(t+1);return o>=56320&&o<=57343?(i<<10)+o-56613888:i},xt.prototype.nextIndex=function(t,e){void 0===e&&(e=!1);var n=this.source,r=n.length;if(t>=r)return r;var i,o=n.charCodeAt(t);return!e&&!this.switchU||o<=55295||o>=57344||t+1>=r||(i=n.charCodeAt(t+1))<56320||i>57343?t+1:t+2},xt.prototype.current=function(t){return void 0===t&&(t=!1),this.at(this.pos,t)},xt.prototype.lookahead=function(t){return void 0===t&&(t=!1),this.at(this.nextIndex(this.pos,t),t)},xt.prototype.advance=function(t){void 0===t&&(t=!1),this.pos=this.nextIndex(this.pos,t)},xt.prototype.eat=function(t,e){return void 0===e&&(e=!1),this.current(e)===t&&(this.advance(e),!0)},_t.validateRegExpFlags=function(t){for(var e=t.validFlags,n=t.flags,r=0;r<n.length;r++){var i=n.charAt(r);-1===e.indexOf(i)&&this.raise(t.start,"Invalid regular expression flag"),n.indexOf(i,r+1)>-1&&this.raise(t.start,"Duplicate regular expression flag")}},_t.validateRegExpPattern=function(t){this.regexp_pattern(t),!t.switchN&&this.options.ecmaVersion>=9&&t.groupNames.length>0&&(t.switchN=!0,this.regexp_pattern(t))},_t.regexp_pattern=function(t){t.pos=0,t.lastIntValue=0,t.lastStringValue="",t.lastAssertionIsQuantifiable=!1,t.numCapturingParens=0,t.maxBackReference=0,t.groupNames.length=0,t.backReferenceNames.length=0,this.regexp_disjunction(t),t.pos!==t.source.length&&(t.eat(41)&&t.raise("Unmatched ')'"),(t.eat(93)||t.eat(125))&&t.raise("Lone quantifier brackets")),t.maxBackReference>t.numCapturingParens&&t.raise("Invalid escape");for(var e=0,n=t.backReferenceNames;e<n.length;e+=1){var r=n[e];-1===t.groupNames.indexOf(r)&&t.raise("Invalid named capture referenced")}},_t.regexp_disjunction=function(t){for(this.regexp_alternative(t);t.eat(124);)this.regexp_alternative(t);this.regexp_eatQuantifier(t,!0)&&t.raise("Nothing to repeat"),t.eat(123)&&t.raise("Lone quantifier brackets")},_t.regexp_alternative=function(t){for(;t.pos<t.source.length&&this.regexp_eatTerm(t););},_t.regexp_eatTerm=function(t){return this.regexp_eatAssertion(t)?(t.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(t)&&t.switchU&&t.raise("Invalid quantifier"),!0):!!(t.switchU?this.regexp_eatAtom(t):this.regexp_eatExtendedAtom(t))&&(this.regexp_eatQuantifier(t),!0)},_t.regexp_eatAssertion=function(t){var e=t.pos;if(t.lastAssertionIsQuantifiable=!1,t.eat(94)||t.eat(36))return!0;if(t.eat(92)){if(t.eat(66)||t.eat(98))return!0;t.pos=e}if(t.eat(40)&&t.eat(63)){var n=!1;if(this.options.ecmaVersion>=9&&(n=t.eat(60)),t.eat(61)||t.eat(33))return this.regexp_disjunction(t),t.eat(41)||t.raise("Unterminated group"),t.lastAssertionIsQuantifiable=!n,!0}return t.pos=e,!1},_t.regexp_eatQuantifier=function(t,e){return void 0===e&&(e=!1),!!this.regexp_eatQuantifierPrefix(t,e)&&(t.eat(63),!0)},_t.regexp_eatQuantifierPrefix=function(t,e){return t.eat(42)||t.eat(43)||t.eat(63)||this.regexp_eatBracedQuantifier(t,e)},_t.regexp_eatBracedQuantifier=function(t,e){var n=t.pos;if(t.eat(123)){var r=0,i=-1;if(this.regexp_eatDecimalDigits(t)&&(r=t.lastIntValue,t.eat(44)&&this.regexp_eatDecimalDigits(t)&&(i=t.lastIntValue),t.eat(125)))return-1!==i&&i<r&&!e&&t.raise("numbers out of order in {} quantifier"),!0;t.switchU&&!e&&t.raise("Incomplete quantifier"),t.pos=n}return!1},_t.regexp_eatAtom=function(t){return this.regexp_eatPatternCharacters(t)||t.eat(46)||this.regexp_eatReverseSolidusAtomEscape(t)||this.regexp_eatCharacterClass(t)||this.regexp_eatUncapturingGroup(t)||this.regexp_eatCapturingGroup(t)},_t.regexp_eatReverseSolidusAtomEscape=function(t){var e=t.pos;if(t.eat(92)){if(this.regexp_eatAtomEscape(t))return!0;t.pos=e}return!1},_t.regexp_eatUncapturingGroup=function(t){var e=t.pos;if(t.eat(40)){if(t.eat(63)&&t.eat(58)){if(this.regexp_disjunction(t),t.eat(41))return!0;t.raise("Unterminated group")}t.pos=e}return!1},_t.regexp_eatCapturingGroup=function(t){if(t.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(t):63===t.current()&&t.raise("Invalid group"),this.regexp_disjunction(t),t.eat(41))return t.numCapturingParens+=1,!0;t.raise("Unterminated group")}return!1},_t.regexp_eatExtendedAtom=function(t){return t.eat(46)||this.regexp_eatReverseSolidusAtomEscape(t)||this.regexp_eatCharacterClass(t)||this.regexp_eatUncapturingGroup(t)||this.regexp_eatCapturingGroup(t)||this.regexp_eatInvalidBracedQuantifier(t)||this.regexp_eatExtendedPatternCharacter(t)},_t.regexp_eatInvalidBracedQuantifier=function(t){return this.regexp_eatBracedQuantifier(t,!0)&&t.raise("Nothing to repeat"),!1},_t.regexp_eatSyntaxCharacter=function(t){var e=t.current();return!!wt(e)&&(t.lastIntValue=e,t.advance(),!0)},_t.regexp_eatPatternCharacters=function(t){for(var e=t.pos,n=0;-1!==(n=t.current())&&!wt(n);)t.advance();return t.pos!==e},_t.regexp_eatExtendedPatternCharacter=function(t){var e=t.current();return!(-1===e||36===e||e>=40&&e<=43||46===e||63===e||91===e||94===e||124===e)&&(t.advance(),!0)},_t.regexp_groupSpecifier=function(t){if(t.eat(63)){if(this.regexp_eatGroupName(t))return-1!==t.groupNames.indexOf(t.lastStringValue)&&t.raise("Duplicate capture group name"),void t.groupNames.push(t.lastStringValue);t.raise("Invalid group")}},_t.regexp_eatGroupName=function(t){if(t.lastStringValue="",t.eat(60)){if(this.regexp_eatRegExpIdentifierName(t)&&t.eat(62))return!0;t.raise("Invalid capture group name")}return!1},_t.regexp_eatRegExpIdentifierName=function(t){if(t.lastStringValue="",this.regexp_eatRegExpIdentifierStart(t)){for(t.lastStringValue+=bt(t.lastIntValue);this.regexp_eatRegExpIdentifierPart(t);)t.lastStringValue+=bt(t.lastIntValue);return!0}return!1},_t.regexp_eatRegExpIdentifierStart=function(t){var e=t.pos,n=this.options.ecmaVersion>=11,r=t.current(n);return t.advance(n),92===r&&this.regexp_eatRegExpUnicodeEscapeSequence(t,n)&&(r=t.lastIntValue),function(t){return v(t,!0)||36===t||95===t}(r)?(t.lastIntValue=r,!0):(t.pos=e,!1)},_t.regexp_eatRegExpIdentifierPart=function(t){var e=t.pos,n=this.options.ecmaVersion>=11,r=t.current(n);return t.advance(n),92===r&&this.regexp_eatRegExpUnicodeEscapeSequence(t,n)&&(r=t.lastIntValue),function(t){return m(t,!0)||36===t||95===t||8204===t||8205===t}(r)?(t.lastIntValue=r,!0):(t.pos=e,!1)},_t.regexp_eatAtomEscape=function(t){return!!(this.regexp_eatBackReference(t)||this.regexp_eatCharacterClassEscape(t)||this.regexp_eatCharacterEscape(t)||t.switchN&&this.regexp_eatKGroupName(t))||(t.switchU&&(99===t.current()&&t.raise("Invalid unicode escape"),t.raise("Invalid escape")),!1)},_t.regexp_eatBackReference=function(t){var e=t.pos;if(this.regexp_eatDecimalEscape(t)){var n=t.lastIntValue;if(t.switchU)return n>t.maxBackReference&&(t.maxBackReference=n),!0;if(n<=t.numCapturingParens)return!0;t.pos=e}return!1},_t.regexp_eatKGroupName=function(t){if(t.eat(107)){if(this.regexp_eatGroupName(t))return t.backReferenceNames.push(t.lastStringValue),!0;t.raise("Invalid named reference")}return!1},_t.regexp_eatCharacterEscape=function(t){return this.regexp_eatControlEscape(t)||this.regexp_eatCControlLetter(t)||this.regexp_eatZero(t)||this.regexp_eatHexEscapeSequence(t)||this.regexp_eatRegExpUnicodeEscapeSequence(t,!1)||!t.switchU&&this.regexp_eatLegacyOctalEscapeSequence(t)||this.regexp_eatIdentityEscape(t)},_t.regexp_eatCControlLetter=function(t){var e=t.pos;if(t.eat(99)){if(this.regexp_eatControlLetter(t))return!0;t.pos=e}return!1},_t.regexp_eatZero=function(t){return 48===t.current()&&!Tt(t.lookahead())&&(t.lastIntValue=0,t.advance(),!0)},_t.regexp_eatControlEscape=function(t){var e=t.current();return 116===e?(t.lastIntValue=9,t.advance(),!0):110===e?(t.lastIntValue=10,t.advance(),!0):118===e?(t.lastIntValue=11,t.advance(),!0):102===e?(t.lastIntValue=12,t.advance(),!0):114===e&&(t.lastIntValue=13,t.advance(),!0)},_t.regexp_eatControlLetter=function(t){var e=t.current();return!!St(e)&&(t.lastIntValue=e%32,t.advance(),!0)},_t.regexp_eatRegExpUnicodeEscapeSequence=function(t,e){void 0===e&&(e=!1);var n,r=t.pos,i=e||t.switchU;if(t.eat(117)){if(this.regexp_eatFixedHexDigits(t,4)){var o=t.lastIntValue;if(i&&o>=55296&&o<=56319){var a=t.pos;if(t.eat(92)&&t.eat(117)&&this.regexp_eatFixedHexDigits(t,4)){var s=t.lastIntValue;if(s>=56320&&s<=57343)return t.lastIntValue=1024*(o-55296)+(s-56320)+65536,!0}t.pos=a,t.lastIntValue=o}return!0}if(i&&t.eat(123)&&this.regexp_eatHexDigits(t)&&t.eat(125)&&((n=t.lastIntValue)>=0&&n<=1114111))return!0;i&&t.raise("Invalid unicode escape"),t.pos=r}return!1},_t.regexp_eatIdentityEscape=function(t){if(t.switchU)return!!this.regexp_eatSyntaxCharacter(t)||!!t.eat(47)&&(t.lastIntValue=47,!0);var e=t.current();return!(99===e||t.switchN&&107===e)&&(t.lastIntValue=e,t.advance(),!0)},_t.regexp_eatDecimalEscape=function(t){t.lastIntValue=0;var e=t.current();if(e>=49&&e<=57){do{t.lastIntValue=10*t.lastIntValue+(e-48),t.advance()}while((e=t.current())>=48&&e<=57);return!0}return!1},_t.regexp_eatCharacterClassEscape=function(t){var e=t.current();if(function(t){return 100===t||68===t||115===t||83===t||119===t||87===t}(e))return t.lastIntValue=-1,t.advance(),!0;if(t.switchU&&this.options.ecmaVersion>=9&&(80===e||112===e)){if(t.lastIntValue=-1,t.advance(),t.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(t)&&t.eat(125))return!0;t.raise("Invalid property name")}return!1},_t.regexp_eatUnicodePropertyValueExpression=function(t){var e=t.pos;if(this.regexp_eatUnicodePropertyName(t)&&t.eat(61)){var n=t.lastStringValue;if(this.regexp_eatUnicodePropertyValue(t)){var r=t.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(t,n,r),!0}}if(t.pos=e,this.regexp_eatLoneUnicodePropertyNameOrValue(t)){var i=t.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(t,i),!0}return!1},_t.regexp_validateUnicodePropertyNameAndValue=function(t,e,n){L(t.unicodeProperties.nonBinary,e)||t.raise("Invalid property name"),t.unicodeProperties.nonBinary[e].test(n)||t.raise("Invalid property value")},_t.regexp_validateUnicodePropertyNameOrValue=function(t,e){t.unicodeProperties.binary.test(e)||t.raise("Invalid property name")},_t.regexp_eatUnicodePropertyName=function(t){var e=0;for(t.lastStringValue="";Et(e=t.current());)t.lastStringValue+=bt(e),t.advance();return""!==t.lastStringValue},_t.regexp_eatUnicodePropertyValue=function(t){var e=0;for(t.lastStringValue="";Ct(e=t.current());)t.lastStringValue+=bt(e),t.advance();return""!==t.lastStringValue},_t.regexp_eatLoneUnicodePropertyNameOrValue=function(t){return this.regexp_eatUnicodePropertyValue(t)},_t.regexp_eatCharacterClass=function(t){if(t.eat(91)){if(t.eat(94),this.regexp_classRanges(t),t.eat(93))return!0;t.raise("Unterminated character class")}return!1},_t.regexp_classRanges=function(t){for(;this.regexp_eatClassAtom(t);){var e=t.lastIntValue;if(t.eat(45)&&this.regexp_eatClassAtom(t)){var n=t.lastIntValue;!t.switchU||-1!==e&&-1!==n||t.raise("Invalid character class"),-1!==e&&-1!==n&&e>n&&t.raise("Range out of order in character class")}}},_t.regexp_eatClassAtom=function(t){var e=t.pos;if(t.eat(92)){if(this.regexp_eatClassEscape(t))return!0;if(t.switchU){var n=t.current();(99===n||kt(n))&&t.raise("Invalid class escape"),t.raise("Invalid escape")}t.pos=e}var r=t.current();return 93!==r&&(t.lastIntValue=r,t.advance(),!0)},_t.regexp_eatClassEscape=function(t){var e=t.pos;if(t.eat(98))return t.lastIntValue=8,!0;if(t.switchU&&t.eat(45))return t.lastIntValue=45,!0;if(!t.switchU&&t.eat(99)){if(this.regexp_eatClassControlLetter(t))return!0;t.pos=e}return this.regexp_eatCharacterClassEscape(t)||this.regexp_eatCharacterEscape(t)},_t.regexp_eatClassControlLetter=function(t){var e=t.current();return!(!Tt(e)&&95!==e)&&(t.lastIntValue=e%32,t.advance(),!0)},_t.regexp_eatHexEscapeSequence=function(t){var e=t.pos;if(t.eat(120)){if(this.regexp_eatFixedHexDigits(t,2))return!0;t.switchU&&t.raise("Invalid escape"),t.pos=e}return!1},_t.regexp_eatDecimalDigits=function(t){var e=t.pos,n=0;for(t.lastIntValue=0;Tt(n=t.current());)t.lastIntValue=10*t.lastIntValue+(n-48),t.advance();return t.pos!==e},_t.regexp_eatHexDigits=function(t){var e=t.pos,n=0;for(t.lastIntValue=0;At(n=t.current());)t.lastIntValue=16*t.lastIntValue+Mt(n),t.advance();return t.pos!==e},_t.regexp_eatLegacyOctalEscapeSequence=function(t){if(this.regexp_eatOctalDigit(t)){var e=t.lastIntValue;if(this.regexp_eatOctalDigit(t)){var n=t.lastIntValue;e<=3&&this.regexp_eatOctalDigit(t)?t.lastIntValue=64*e+8*n+t.lastIntValue:t.lastIntValue=8*e+n}else t.lastIntValue=e;return!0}return!1},_t.regexp_eatOctalDigit=function(t){var e=t.current();return kt(e)?(t.lastIntValue=e-48,t.advance(),!0):(t.lastIntValue=0,!1)},_t.regexp_eatFixedHexDigits=function(t,e){var n=t.pos;t.lastIntValue=0;for(var r=0;r<e;++r){var i=t.current();if(!At(i))return t.pos=n,!1;t.lastIntValue=16*t.lastIntValue+Mt(i),t.advance()}return!0};var Pt=function(t){this.type=t.type,this.value=t.value,this.start=t.start,this.end=t.end,t.options.locations&&(this.loc=new N(t,t.startLoc,t.endLoc)),t.options.ranges&&(this.range=[t.start,t.end])},Ot=j.prototype;function Lt(t){return"function"!=typeof BigInt?null:BigInt(t.replace(/_/g,""))}function It(t){return t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t)))}Ot.next=function(t){!t&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new Pt(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},Ot.getToken=function(){return this.next(),new Pt(this)},"undefined"!=typeof Symbol&&(Ot[Symbol.iterator]=function(){var t=this;return{next:function(){var e=t.getToken();return{done:e.type===S.eof,value:e}}}}),Ot.curContext=function(){return this.context[this.context.length-1]},Ot.nextToken=function(){var t=this.curContext();return t&&t.preserveSpace||this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length?this.finishToken(S.eof):t.override?t.override(this):void this.readToken(this.fullCharCodeAtPos())},Ot.readToken=function(t){return v(t,this.options.ecmaVersion>=6)||92===t?this.readWord():this.getTokenFromCode(t)},Ot.fullCharCodeAtPos=function(){var t=this.input.charCodeAt(this.pos);return t<=55295||t>=57344?t:(t<<10)+this.input.charCodeAt(this.pos+1)-56613888},Ot.skipBlockComment=function(){var t,e=this.options.onComment&&this.curPosition(),n=this.pos,r=this.input.indexOf("*/",this.pos+=2);if(-1===r&&this.raise(this.pos-2,"Unterminated comment"),this.pos=r+2,this.options.locations)for(C.lastIndex=n;(t=C.exec(this.input))&&t.index<this.pos;)++this.curLine,this.lineStart=t.index+t[0].length;this.options.onComment&&this.options.onComment(!0,this.input.slice(n+2,r),n,this.pos,e,this.curPosition())},Ot.skipLineComment=function(t){for(var e=this.pos,n=this.options.onComment&&this.curPosition(),r=this.input.charCodeAt(this.pos+=t);this.pos<this.input.length&&!T(r);)r=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(e+t,this.pos),e,this.pos,n,this.curPosition())},Ot.skipSpace=function(){t:for(;this.pos<this.input.length;){var t=this.input.charCodeAt(this.pos);switch(t){case 32:case 160:++this.pos;break;case 13:10===this.input.charCodeAt(this.pos+1)&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break t}break;default:if(!(t>8&&t<14||t>=5760&&A.test(String.fromCharCode(t))))break t;++this.pos}}},Ot.finishToken=function(t,e){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var n=this.type;this.type=t,this.value=e,this.updateContext(n)},Ot.readToken_dot=function(){var t=this.input.charCodeAt(this.pos+1);if(t>=48&&t<=57)return this.readNumber(!0);var e=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&46===t&&46===e?(this.pos+=3,this.finishToken(S.ellipsis)):(++this.pos,this.finishToken(S.dot))},Ot.readToken_slash=function(){var t=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):61===t?this.finishOp(S.assign,2):this.finishOp(S.slash,1)},Ot.readToken_mult_modulo_exp=function(t){var e=this.input.charCodeAt(this.pos+1),n=1,r=42===t?S.star:S.modulo;return this.options.ecmaVersion>=7&&42===t&&42===e&&(++n,r=S.starstar,e=this.input.charCodeAt(this.pos+2)),61===e?this.finishOp(S.assign,n+1):this.finishOp(r,n)},Ot.readToken_pipe_amp=function(t){var e=this.input.charCodeAt(this.pos+1);if(e===t){if(this.options.ecmaVersion>=12)if(61===this.input.charCodeAt(this.pos+2))return this.finishOp(S.assign,3);return this.finishOp(124===t?S.logicalOR:S.logicalAND,2)}return 61===e?this.finishOp(S.assign,2):this.finishOp(124===t?S.bitwiseOR:S.bitwiseAND,1)},Ot.readToken_caret=function(){return 61===this.input.charCodeAt(this.pos+1)?this.finishOp(S.assign,2):this.finishOp(S.bitwiseXOR,1)},Ot.readToken_plus_min=function(t){var e=this.input.charCodeAt(this.pos+1);return e===t?45!==e||this.inModule||62!==this.input.charCodeAt(this.pos+2)||0!==this.lastTokEnd&&!E.test(this.input.slice(this.lastTokEnd,this.pos))?this.finishOp(S.incDec,2):(this.skipLineComment(3),this.skipSpace(),this.nextToken()):61===e?this.finishOp(S.assign,2):this.finishOp(S.plusMin,1)},Ot.readToken_lt_gt=function(t){var e=this.input.charCodeAt(this.pos+1),n=1;return e===t?(n=62===t&&62===this.input.charCodeAt(this.pos+2)?3:2,61===this.input.charCodeAt(this.pos+n)?this.finishOp(S.assign,n+1):this.finishOp(S.bitShift,n)):33!==e||60!==t||this.inModule||45!==this.input.charCodeAt(this.pos+2)||45!==this.input.charCodeAt(this.pos+3)?(61===e&&(n=2),this.finishOp(S.relational,n)):(this.skipLineComment(4),this.skipSpace(),this.nextToken())},Ot.readToken_eq_excl=function(t){var e=this.input.charCodeAt(this.pos+1);return 61===e?this.finishOp(S.equality,61===this.input.charCodeAt(this.pos+2)?3:2):61===t&&62===e&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(S.arrow)):this.finishOp(61===t?S.eq:S.prefix,1)},Ot.readToken_question=function(){var t=this.options.ecmaVersion;if(t>=11){var e=this.input.charCodeAt(this.pos+1);if(46===e){var n=this.input.charCodeAt(this.pos+2);if(n<48||n>57)return this.finishOp(S.questionDot,2)}if(63===e){if(t>=12)if(61===this.input.charCodeAt(this.pos+2))return this.finishOp(S.assign,3);return this.finishOp(S.coalesce,2)}}return this.finishOp(S.question,1)},Ot.getTokenFromCode=function(t){switch(t){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(S.parenL);case 41:return++this.pos,this.finishToken(S.parenR);case 59:return++this.pos,this.finishToken(S.semi);case 44:return++this.pos,this.finishToken(S.comma);case 91:return++this.pos,this.finishToken(S.bracketL);case 93:return++this.pos,this.finishToken(S.bracketR);case 123:return++this.pos,this.finishToken(S.braceL);case 125:return++this.pos,this.finishToken(S.braceR);case 58:return++this.pos,this.finishToken(S.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(S.backQuote);case 48:var e=this.input.charCodeAt(this.pos+1);if(120===e||88===e)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(111===e||79===e)return this.readRadixNumber(8);if(98===e||66===e)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(t);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(t);case 124:case 38:return this.readToken_pipe_amp(t);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(t);case 60:case 62:return this.readToken_lt_gt(t);case 61:case 33:return this.readToken_eq_excl(t);case 63:return this.readToken_question();case 126:return this.finishOp(S.prefix,1)}this.raise(this.pos,"Unexpected character '"+It(t)+"'")},Ot.finishOp=function(t,e){var n=this.input.slice(this.pos,this.pos+e);return this.pos+=e,this.finishToken(t,n)},Ot.readRegexp=function(){for(var t,e,n=this.pos;;){this.pos>=this.input.length&&this.raise(n,"Unterminated regular expression");var r=this.input.charAt(this.pos);if(E.test(r)&&this.raise(n,"Unterminated regular expression"),t)t=!1;else{if("["===r)e=!0;else if("]"===r&&e)e=!1;else if("/"===r&&!e)break;t="\\"===r}++this.pos}var i=this.input.slice(n,this.pos);++this.pos;var o=this.pos,a=this.readWord1();this.containsEsc&&this.unexpected(o);var s=this.regexpState||(this.regexpState=new xt(this));s.reset(n,i,a),this.validateRegExpFlags(s),this.validateRegExpPattern(s);var u=null;try{u=new RegExp(i,a)}catch(t){}return this.finishToken(S.regexp,{pattern:i,flags:a,value:u})},Ot.readInt=function(t,e,n){for(var r=this.options.ecmaVersion>=12&&void 0===e,i=n&&48===this.input.charCodeAt(this.pos),o=this.pos,a=0,s=0,u=0,l=null==e?1/0:e;u<l;++u,++this.pos){var c=this.input.charCodeAt(this.pos),p=void 0;if(r&&95===c)i&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),95===s&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),0===u&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),s=c;else{if((p=c>=97?c-97+10:c>=65?c-65+10:c>=48&&c<=57?c-48:1/0)>=t)break;s=c,a=a*t+p}}return r&&95===s&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===o||null!=e&&this.pos-o!==e?null:a},Ot.readRadixNumber=function(t){var e=this.pos;this.pos+=2;var n=this.readInt(t);return null==n&&this.raise(this.start+2,"Expected number in radix "+t),this.options.ecmaVersion>=11&&110===this.input.charCodeAt(this.pos)?(n=Lt(this.input.slice(e,this.pos)),++this.pos):v(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(S.num,n)},Ot.readNumber=function(t){var e=this.pos;t||null!==this.readInt(10,void 0,!0)||this.raise(e,"Invalid number");var n=this.pos-e>=2&&48===this.input.charCodeAt(e);n&&this.strict&&this.raise(e,"Invalid number");var r=this.input.charCodeAt(this.pos);if(!n&&!t&&this.options.ecmaVersion>=11&&110===r){var i=Lt(this.input.slice(e,this.pos));return++this.pos,v(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(S.num,i)}n&&/[89]/.test(this.input.slice(e,this.pos))&&(n=!1),46!==r||n||(++this.pos,this.readInt(10),r=this.input.charCodeAt(this.pos)),69!==r&&101!==r||n||(43!==(r=this.input.charCodeAt(++this.pos))&&45!==r||++this.pos,null===this.readInt(10)&&this.raise(e,"Invalid number")),v(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var o,a=(o=this.input.slice(e,this.pos),n?parseInt(o,8):parseFloat(o.replace(/_/g,"")));return this.finishToken(S.num,a)},Ot.readCodePoint=function(){var t;if(123===this.input.charCodeAt(this.pos)){this.options.ecmaVersion<6&&this.unexpected();var e=++this.pos;t=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,t>1114111&&this.invalidStringToken(e,"Code point out of bounds")}else t=this.readHexChar(4);return t},Ot.readString=function(t){for(var e="",n=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var r=this.input.charCodeAt(this.pos);if(r===t)break;92===r?(e+=this.input.slice(n,this.pos),e+=this.readEscapedChar(!1),n=this.pos):(T(r,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return e+=this.input.slice(n,this.pos++),this.finishToken(S.string,e)};var Rt={};Ot.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(t){if(t!==Rt)throw t;this.readInvalidTemplateToken()}this.inTemplateElement=!1},Ot.invalidStringToken=function(t,e){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Rt;this.raise(t,e)},Ot.readTmplToken=function(){for(var t="",e=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var n=this.input.charCodeAt(this.pos);if(96===n||36===n&&123===this.input.charCodeAt(this.pos+1))return this.pos!==this.start||this.type!==S.template&&this.type!==S.invalidTemplate?(t+=this.input.slice(e,this.pos),this.finishToken(S.template,t)):36===n?(this.pos+=2,this.finishToken(S.dollarBraceL)):(++this.pos,this.finishToken(S.backQuote));if(92===n)t+=this.input.slice(e,this.pos),t+=this.readEscapedChar(!0),e=this.pos;else if(T(n)){switch(t+=this.input.slice(e,this.pos),++this.pos,n){case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:t+="\n";break;default:t+=String.fromCharCode(n)}this.options.locations&&(++this.curLine,this.lineStart=this.pos),e=this.pos}else++this.pos}},Ot.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if("{"!==this.input[this.pos+1])break;case"`":return this.finishToken(S.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},Ot.readEscapedChar=function(t){var e=this.input.charCodeAt(++this.pos);switch(++this.pos,e){case 110:return"\n";case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return It(this.readCodePoint());case 116:return"\t";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(t){var n=this.pos-1;return this.invalidStringToken(n,"Invalid escape sequence in template string"),null}default:if(e>=48&&e<=55){var r=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],i=parseInt(r,8);return i>255&&(r=r.slice(0,-1),i=parseInt(r,8)),this.pos+=r.length-1,e=this.input.charCodeAt(this.pos),"0"===r&&56!==e&&57!==e||!this.strict&&!t||this.invalidStringToken(this.pos-1-r.length,t?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(i)}return T(e)?"":String.fromCharCode(e)}},Ot.readHexChar=function(t){var e=this.pos,n=this.readInt(16,t);return null===n&&this.invalidStringToken(e,"Bad character escape sequence"),n},Ot.readWord1=function(){this.containsEsc=!1;for(var t="",e=!0,n=this.pos,r=this.options.ecmaVersion>=6;this.pos<this.input.length;){var i=this.fullCharCodeAtPos();if(m(i,r))this.pos+=i<=65535?1:2;else{if(92!==i)break;this.containsEsc=!0,t+=this.input.slice(n,this.pos);var o=this.pos;117!==this.input.charCodeAt(++this.pos)&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var a=this.readCodePoint();(e?v:m)(a,r)||this.invalidStringToken(o,"Invalid Unicode escape"),t+=It(a),n=this.pos}e=!1}return t+this.input.slice(n,this.pos)},Ot.readWord=function(){var t=this.readWord1(),e=S.name;return this.keywords.test(t)&&(e=b[t]),this.finishToken(e,t)};function Dt(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function Nt(t){var e="function"==typeof Map?new Map:void 0;return Nt=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return zt(t,arguments,Bt(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Ft(r,t)},Nt(t)}function Zt(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function zt(t,e,n){return zt=Zt()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&Ft(i,n.prototype),i},zt.apply(null,arguments)}function Ft(t,e){return Ft=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Ft(t,e)}function Bt(t){return Bt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Bt(t)}j.acorn={Parser:j,version:"7.4.1",defaultOptions:z,Position:D,SourceLocation:N,getLineInfo:Z,Node:it,TokenType:y,tokTypes:S,keywordTypes:b,TokContext:st,tokContexts:ut,isIdentifierChar:m,isIdentifierStart:v,Token:Pt,isNewLine:T,lineBreak:E,lineBreakG:C,nonASCIIwhitespace:A};var jt=function(t){function e(){return t.apply(this,arguments)||this}return Dt(e,t),e}(Nt(Error)),Ut=function(t){function e(){return t.apply(this,arguments)||this}return Dt(e,t),e}(Nt(SyntaxError)),Vt=function(t){function e(){return t.apply(this,arguments)||this}return Dt(e,t),e}(Nt(ReferenceError)),Gt=function(t){function e(){return t.apply(this,arguments)||this}return Dt(e,t),e}(Nt(TypeError)),Ht=function(t){function e(){return t.apply(this,arguments)||this}return Dt(e,t),e}(jt),Wt=function(t){function e(){return t.apply(this,arguments)||this}return Dt(e,t),e}(Ut),qt=function(t){function e(){return t.apply(this,arguments)||this}return Dt(e,t),e}(Vt),Xt={UnknownError:[3001,"%0",Ht],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",Ht],NodeTypeSyntaxError:[1001,"Unknown node type: %0",qt],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",qt],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",qt],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",qt],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",qt],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",qt],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",qt],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",qt],ParamTypeSyntaxError:[1009,"Unknown param type: %0",qt],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",qt],FunctionUndefinedReferenceError:[2001,"%0 is not a function",Vt],VariableUndefinedReferenceError:[2002,"%0 is not defined",Vt],IsNotConstructor:[2003,"%0 is not a constructor",Gt]};function Yt(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function Kt(t,e,n){return Kt=Yt()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&Qt(i,n.prototype),i},Kt.apply(null,arguments)}function Qt(t,e){return Qt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Qt(t,e)}function Jt(t,e){Object.defineProperty(t,"name",{value:e,writable:!1,enumerable:!1,configurable:!0})}var $t=Object.prototype.hasOwnProperty,te=Symbol("Break"),ee=Symbol("Continue"),ne=Symbol("DefaultCase"),re=Symbol("EmptyStatementReturn"),ie=Symbol("WithScopeName"),oe=Symbol("SuperScopeName"),ae=Symbol("RootScopeName"),se=Symbol("GlobalScopeName");function ue(t){return"function"==typeof t}var le=function(){function t(t){this.interpreter=t}return t.prototype.generator=function(){var t=this.interpreter;return{getOptions:t.getOptions.bind(t),getCurrentScope:function(){return this.getCurrentScope()}.bind(t),getGlobalScope:function(){return this.getGlobalScope()}.bind(t),getCurrentContext:function(){return this.getCurrentContext()}.bind(t),getExecStartTime:t.getExecStartTime.bind(t)}},t}();function ce(t,e,n){if(void 0===n&&(n=!0),!(t instanceof le))throw new Error("Illegal call");if("string"!=typeof e)return e;if(e){var r=t.generator(),i={timeout:r.getOptions().timeout,_initEnv:function(){n||this.setCurrentContext(r.getCurrentContext()),this.execStartTime=r.getExecStartTime(),this.execEndTime=this.execStartTime}},o=n?r.getGlobalScope():r.getCurrentScope();return new _e(o,i).evaluate(e)}}function pe(t){if(!(t instanceof le))throw new Error("Illegal call");for(var e=t.generator(),n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var o=r.pop(),a=new _e(e.getGlobalScope(),e.getOptions()),s="\n\t\t    (function anonymous("+r.join(",")+"){\n\t\t        "+o+"\n\t\t    });\n\t\t    ";return a.evaluate(s)}Object.defineProperty(ce,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1}),Object.defineProperty(pe,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var he=function(t){this.value=t},fe=function(t){this.value=t},de=function(t){this.value=t},ve=function(t,e,n){void 0===e&&(e=null),this.name=n,this.parent=e,this.data=t,this.labelStack=[]};function me(){}function ye(t,e){return void 0===t&&(t=null),new ve(Object.create(null),t,e)}var ge={NaN:NaN,Infinity:1/0,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:ce,Function:pe};"undefined"!=typeof JSON&&(ge.JSON=JSON),"undefined"!=typeof Promise&&(ge.Promise=Promise),"undefined"!=typeof Set&&(ge.Set=Set),"undefined"!=typeof Map&&(ge.Map=Map),"undefined"!=typeof Symbol&&(ge.Symbol=Symbol),"undefined"!=typeof Proxy&&(ge.Proxy=Proxy),"undefined"!=typeof WeakMap&&(ge.WeakMap=WeakMap),"undefined"!=typeof WeakSet&&(ge.WeakSet=WeakSet),"undefined"!=typeof Reflect&&(ge.Reflect=Reflect);var _e=function(){function t(e,n){void 0===e&&(e=t.global),void 0===n&&(n={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:n.ecmaVersion||t.ecmaVersion,timeout:n.timeout||0,rootContext:n.rootContext,globalContextInFunction:void 0===n.globalContextInFunction?t.globalContextInFunction:n.globalContextInFunction,_initEnv:n._initEnv},this.context=e||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var e=t.prototype;return e.initEnvironment=function(t){var e;if(t instanceof ve)e=t;else{var n=null,r=this.createSuperScope(t);this.options.rootContext&&(n=new ve(function(t){return Object.create(t)}(this.options.rootContext),r,ae)),e=new ve(t,n||r,se)}this.globalScope=e,this.currentScope=this.globalScope,this.globalContext=e.data,this.currentContext=e.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var i=this.options._initEnv;i&&i.call(this)},e.getExecStartTime=function(){return this.execStartTime},e.getExecutionTime=function(){return this.execEndTime-this.execStartTime},e.setExecTimeout=function(t){void 0===t&&(t=0),this.options.timeout=t},e.getOptions=function(){return this.options},e.getGlobalScope=function(){return this.globalScope},e.getCurrentScope=function(){return this.currentScope},e.getCurrentContext=function(){return this.currentContext},e.isInterruptThrow=function(t){return t instanceof Ht||t instanceof qt||t instanceof Wt},e.createSuperScope=function(t){var e=Object.assign({},ge);return Object.keys(e).forEach((function(n){n in t&&delete e[n]})),new ve(e,null,oe)},e.setCurrentContext=function(t){this.currentContext=t},e.setCurrentScope=function(t){this.currentScope=t},e.evaluate=function(e){var n,r,i;if(void 0===e&&(e=""),e)return r=e,i={ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||t.ecmaVersion},n=j.parse(r,i),this.evaluateNode(n,e)},e.appendCode=function(t){return this.evaluate(t)},e.evaluateNode=function(t,e){var n=this;void 0===e&&(e=""),this.value=void 0,this.source=e,this.sourceList.push(e),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var r=this.getCurrentScope(),i=this.getCurrentContext(),o=r.labelStack.concat([]),a=this.callStack.concat([]);try{var s=this.createClosure(t);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),s()}catch(t){throw t}finally{n.setCurrentScope(r),n.setCurrentContext(i),r.labelStack=o,n.callStack=a,this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},e.createErrorMessage=function(t,e,n){var r=t[1].replace("%0",String(e));return null!==n&&(r+=this.getNodePosition(n||this.lastExecNode)),r},e.createError=function(t,e){return new e(t)},e.createThrowError=function(t,e){return this.createError(t,e)},e.createInternalThrowError=function(t,e,n){return this.createError(this.createErrorMessage(t,e,n),t[2])},e.checkTimeout=function(){if(!this.isRunning)return!1;var t=this.options.timeout||0;return Date.now()-this.execStartTime>t},e.getNodePosition=function(t){if(t){return t.loc?" ["+t.loc.start.line+":"+t.loc.start.column+"]":""}return""},e.createClosure=function(t){var e,n=this;switch(t.type){case"BinaryExpression":e=this.binaryExpressionHandler(t);break;case"LogicalExpression":e=this.logicalExpressionHandler(t);break;case"UnaryExpression":e=this.unaryExpressionHandler(t);break;case"UpdateExpression":e=this.updateExpressionHandler(t);break;case"ObjectExpression":e=this.objectExpressionHandler(t);break;case"ArrayExpression":e=this.arrayExpressionHandler(t);break;case"CallExpression":e=this.callExpressionHandler(t);break;case"NewExpression":e=this.newExpressionHandler(t);break;case"MemberExpression":e=this.memberExpressionHandler(t);break;case"ThisExpression":e=this.thisExpressionHandler(t);break;case"SequenceExpression":e=this.sequenceExpressionHandler(t);break;case"Literal":e=this.literalHandler(t);break;case"Identifier":e=this.identifierHandler(t);break;case"AssignmentExpression":e=this.assignmentExpressionHandler(t);break;case"FunctionDeclaration":e=this.functionDeclarationHandler(t);break;case"VariableDeclaration":e=this.variableDeclarationHandler(t);break;case"BlockStatement":case"Program":e=this.programHandler(t);break;case"ExpressionStatement":e=this.expressionStatementHandler(t);break;case"EmptyStatement":e=this.emptyStatementHandler(t);break;case"ReturnStatement":e=this.returnStatementHandler(t);break;case"FunctionExpression":e=this.functionExpressionHandler(t);break;case"IfStatement":e=this.ifStatementHandler(t);break;case"ConditionalExpression":e=this.conditionalExpressionHandler(t);break;case"ForStatement":e=this.forStatementHandler(t);break;case"WhileStatement":e=this.whileStatementHandler(t);break;case"DoWhileStatement":e=this.doWhileStatementHandler(t);break;case"ForInStatement":e=this.forInStatementHandler(t);break;case"WithStatement":e=this.withStatementHandler(t);break;case"ThrowStatement":e=this.throwStatementHandler(t);break;case"TryStatement":e=this.tryStatementHandler(t);break;case"ContinueStatement":e=this.continueStatementHandler(t);break;case"BreakStatement":e=this.breakStatementHandler(t);break;case"SwitchStatement":e=this.switchStatementHandler(t);break;case"LabeledStatement":e=this.labeledStatementHandler(t);break;case"DebuggerStatement":e=this.debuggerStatementHandler(t);break;default:throw this.createInternalThrowError(Xt.NodeTypeSyntaxError,t.type,t)}return function(){var r=n.options.timeout;if(r&&r>0&&n.checkTimeout())throw n.createInternalThrowError(Xt.ExecutionTimeOutError,r,null);return n.lastExecNode=t,e.apply(void 0,arguments)}},e.binaryExpressionHandler=function(t){var e=this,n=this.createClosure(t.left),r=this.createClosure(t.right);return function(){var i=n(),o=r();switch(t.operator){case"==":return i==o;case"!=":return i!=o;case"===":return i===o;case"!==":return i!==o;case"<":return i<o;case"<=":return i<=o;case">":return i>o;case">=":return i>=o;case"<<":return i<<o;case">>":return i>>o;case">>>":return i>>>o;case"+":return i+o;case"-":return i-o;case"*":return i*o;case"**":return Math.pow(i,o);case"/":return i/o;case"%":return i%o;case"|":return i|o;case"^":return i^o;case"&":return i&o;case"in":return i in o;case"instanceof":return i instanceof o;default:throw e.createInternalThrowError(Xt.BinaryOperatorSyntaxError,t.operator,t)}}},e.logicalExpressionHandler=function(t){var e=this,n=this.createClosure(t.left),r=this.createClosure(t.right);return function(){switch(t.operator){case"||":return n()||r();case"&&":return n()&&r();default:throw e.createInternalThrowError(Xt.LogicalOperatorSyntaxError,t.operator,t)}}},e.unaryExpressionHandler=function(t){var e,n=this;if("delete"===t.operator){var r=this.createObjectGetter(t.argument),i=this.createNameGetter(t.argument);return function(){return delete r()[i()]}}if("typeof"===t.operator&&"Identifier"===t.argument.type){var o=this.createObjectGetter(t.argument),a=this.createNameGetter(t.argument);e=function(){return o()[a()]}}else e=this.createClosure(t.argument);return function(){var r=e();switch(t.operator){case"-":return-r;case"+":return+r;case"!":return!r;case"~":return~r;case"void":return;case"typeof":return typeof r;default:throw n.createInternalThrowError(Xt.UnaryOperatorSyntaxError,t.operator,t)}}},e.updateExpressionHandler=function(t){var e=this,n=this.createObjectGetter(t.argument),r=this.createNameGetter(t.argument);return function(){var i=n(),o=r();switch(e.assertVariable(i,o,t),t.operator){case"++":return t.prefix?++i[o]:i[o]++;case"--":return t.prefix?--i[o]:i[o]--;default:throw e.createInternalThrowError(Xt.UpdateOperatorSyntaxError,t.operator,t)}}},e.objectExpressionHandler=function(t){var e=this,n=[];var r=Object.create(null);return t.properties.forEach((function(t){var i=t.kind,o=function(t){return"Identifier"===t.type?t.name:"Literal"===t.type?t.value:this.throwError(Xt.ObjectStructureSyntaxError,t.type,t)}(t.key);r[o]&&"init"!==i||(r[o]={}),r[o][i]=e.createClosure(t.value),n.push({key:o,property:t})})),function(){for(var t={},e=n.length,i=0;i<e;i++){var o=n[i],a=o.key,s=r[a],u=s.init?s.init():void 0,l=s.get?s.get():function(){},c=s.set?s.set():function(t){};if("set"in s||"get"in s){var p={configurable:!0,enumerable:!0,get:l,set:c};Object.defineProperty(t,a,p)}else{var h=o.property,f=h.kind;"Identifier"!==h.key.type||"FunctionExpression"!==h.value.type||"init"!==f||h.value.id||Jt(u,h.key.name),t[a]=u}}return t}},e.arrayExpressionHandler=function(t){var e=this,n=t.elements.map((function(t){return t?e.createClosure(t):t}));return function(){for(var t=n.length,e=Array(t),r=0;r<t;r++){var i=n[r];i&&(e[r]=i())}return e}},e.safeObjectGet=function(t,e,n){return t[e]},e.createCallFunctionGetter=function(t){var e=this;if("MemberExpression"===t.type){var n=this.createClosure(t.object),r=this.createMemberKeyGetter(t),i=this.source;return function(){var o=n(),a=r(),s=e.safeObjectGet(o,a,t);if(!s||!ue(s)){var u=i.slice(t.start,t.end);throw e.createInternalThrowError(Xt.FunctionUndefinedReferenceError,u,t)}return s.__IS_EVAL_FUNC?function(t){return s(new le(e),t,!0)}:s.__IS_FUNCTION_FUNC?function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return s.apply(void 0,[new le(e)].concat(n))}:s.bind(o)}}var o=this.createClosure(t);return function(){var n="";"Identifier"===t.type&&(n=t.name);var r=o();if(!r||!ue(r))throw e.createInternalThrowError(Xt.FunctionUndefinedReferenceError,n,t);if("Identifier"===t.type&&r.__IS_EVAL_FUNC&&"eval"===n)return function(t){var i=e.getScopeFromName(n,e.getCurrentScope()),o=i.name===oe||i.name===se||i.name===ae;return r(new le(e),t,!o)};if(r.__IS_EVAL_FUNC)return function(t){return r(new le(e),t,!0)};if(r.__IS_FUNCTION_FUNC)return function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return r.apply(void 0,[new le(e)].concat(n))};var i=e.options.globalContextInFunction;if("Identifier"===t.type){var a=e.getIdentifierScope(t);a.name===ie&&(i=a.data)}return r.bind(i)}},e.callExpressionHandler=function(t){var e=this,n=this.createCallFunctionGetter(t.callee),r=t.arguments.map((function(t){return e.createClosure(t)}));return function(){return n().apply(void 0,r.map((function(t){return t()})))}},e.functionExpressionHandler=function(t){var e=this,n=this,r=this.source,i=this.collectDeclVars,o=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var a=t.id?t.id.name:"",s=t.params.length,u=t.params.map((function(t){return e.createParamNameGetter(t)})),l=this.createClosure(t.body),c=this.collectDeclVars,p=this.collectDeclFuncs;return this.collectDeclVars=i,this.collectDeclFuncs=o,function(){var e=n.getCurrentScope(),i=function t(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];n.callStack.push(""+a);var s=n.getCurrentScope(),h=ye(e,"FunctionScope("+a+")");n.setCurrentScope(h),n.addDeclarationsToScope(c,p,h),a&&(h.data[a]=t),h.data.arguments=arguments,u.forEach((function(t,e){h.data[t()]=i[e]}));var f=n.getCurrentContext();n.setCurrentContext(this);var d=l();if(n.setCurrentContext(f),n.setCurrentScope(s),n.callStack.pop(),d instanceof he)return d.value};return Jt(i,a),Object.defineProperty(i,"length",{value:s,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(i,"toString",{value:function(){return r.slice(t.start,t.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(i,"valueOf",{value:function(){return r.slice(t.start,t.end)},writable:!0,configurable:!0,enumerable:!1}),i}},e.newExpressionHandler=function(t){var e=this,n=this.source,r=this.createClosure(t.callee),i=t.arguments.map((function(t){return e.createClosure(t)}));return function(){var o=r();if(!ue(o)||o.__IS_EVAL_FUNC){var a=t.callee,s=n.slice(a.start,a.end);throw e.createInternalThrowError(Xt.IsNotConstructor,s,t)}return o.__IS_FUNCTION_FUNC?o.apply(void 0,[new le(e)].concat(i.map((function(t){return t()})))):Kt(o,i.map((function(t){return t()})))}},e.memberExpressionHandler=function(t){var e=this.createClosure(t.object),n=this.createMemberKeyGetter(t);return function(){return e()[n()]}},e.thisExpressionHandler=function(t){var e=this;return function(){return e.getCurrentContext()}},e.sequenceExpressionHandler=function(t){var e=this,n=t.expressions.map((function(t){return e.createClosure(t)}));return function(){for(var t,e=n.length,r=0;r<e;r++){t=(0,n[r])()}return t}},e.literalHandler=function(t){return function(){return t.regex?new RegExp(t.regex.pattern,t.regex.flags):t.value}},e.identifierHandler=function(t){var e=this;return function(){var n=e.getCurrentScope(),r=e.getScopeDataFromName(t.name,n);return e.assertVariable(r,t.name,t),r[t.name]}},e.getIdentifierScope=function(t){var e=this.getCurrentScope();return this.getScopeFromName(t.name,e)},e.assignmentExpressionHandler=function(t){var e=this;"Identifier"!==t.left.type||"FunctionExpression"!==t.right.type||t.right.id||(t.right.id={type:"Identifier",name:t.left.name});var n=this.createObjectGetter(t.left),r=this.createNameGetter(t.left),i=this.createClosure(t.right);return function(){var o=n(),a=r(),s=i();switch("="!==t.operator&&e.assertVariable(o,a,t),t.operator){case"=":return o[a]=s;case"+=":return o[a]+=s;case"-=":return o[a]-=s;case"*=":return o[a]*=s;case"**=":return o[a]=Math.pow(o[a],s);case"/=":return o[a]/=s;case"%=":return o[a]%=s;case"<<=":return o[a]<<=s;case">>=":return o[a]>>=s;case">>>=":return o[a]>>>=s;case"&=":return o[a]&=s;case"^=":return o[a]^=s;case"|=":return o[a]|=s;default:throw e.createInternalThrowError(Xt.AssignmentExpressionSyntaxError,t.type,t)}}},e.functionDeclarationHandler=function(t){if(t.id){var e=this.functionExpressionHandler(t);Object.defineProperty(e,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(t.id.name,e)}return function(){return re}},e.getVariableName=function(t){if("Identifier"===t.type)return t.name;throw this.createInternalThrowError(Xt.VariableTypeSyntaxError,t.type,t)},e.variableDeclarationHandler=function(t){for(var e,n=this,r=[],i=0;i<t.declarations.length;i++){var o=t.declarations[i];this.varDeclaration(this.getVariableName(o.id)),o.init&&r.push({type:"AssignmentExpression",operator:"=",left:o.id,right:o.init})}return r.length&&(e=this.createClosure({type:"BlockStatement",body:r})),function(){if(e){var t=n.isVarDeclMode;n.isVarDeclMode=!0,e(),n.isVarDeclMode=t}return re}},e.assertVariable=function(t,e,n){if(t===this.globalScope.data&&!(e in t))throw this.createInternalThrowError(Xt.VariableUndefinedReferenceError,e,n)},e.programHandler=function(t){var e=this,n=t.body.map((function(t){return e.createClosure(t)}));return function(){for(var t=re,r=0;r<n.length;r++){var i=n[r],o=e.setValue(i());if(o!==re&&((t=o)instanceof he||t instanceof fe||t instanceof de||t===te||t===ee))break}return t}},e.expressionStatementHandler=function(t){return this.createClosure(t.expression)},e.emptyStatementHandler=function(t){return function(){return re}},e.returnStatementHandler=function(t){var e=t.argument?this.createClosure(t.argument):me;return function(){return new he(e())}},e.ifStatementHandler=function(t){var e=this.createClosure(t.test),n=this.createClosure(t.consequent),r=t.alternate?this.createClosure(t.alternate):function(){return re};return function(){return e()?n():r()}},e.conditionalExpressionHandler=function(t){return this.ifStatementHandler(t)},e.forStatementHandler=function(t){var e=this,n=me,r=t.test?this.createClosure(t.test):function(){return!0},i=me,o=this.createClosure(t.body);return"ForStatement"===t.type&&(n=t.init?this.createClosure(t.init):n,i=t.update?this.createClosure(t.update):me),function(a){var s,u=re,l="DoWhileStatement"===t.type;for(a&&"LabeledStatement"===a.type&&(s=a.label.name),n();l||r();i()){l=!1;var c=e.setValue(o());if(c!==re&&c!==ee){if(c===te)break;if((u=c)instanceof de&&u.value===s)u=re;else if(u instanceof he||u instanceof fe||u instanceof de)break}}return u}},e.whileStatementHandler=function(t){return this.forStatementHandler(t)},e.doWhileStatementHandler=function(t){return this.forStatementHandler(t)},e.forInStatementHandler=function(t){var e=this,n=t.left,r=this.createClosure(t.right),i=this.createClosure(t.body);return"VariableDeclaration"===t.left.type&&(this.createClosure(t.left)(),n=t.left.declarations[0].id),function(t){var o,a,s=re;t&&"LabeledStatement"===t.type&&(o=t.label.name);var u=r();for(a in u){e.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:n,right:{type:"Literal",value:a}})();var l=e.setValue(i());if(l!==re&&l!==ee){if(l===te)break;if((s=l)instanceof de&&s.value===o)s=re;else if(s instanceof he||s instanceof fe||s instanceof de)break}}return s}},e.withStatementHandler=function(t){var e=this,n=this.createClosure(t.object),r=this.createClosure(t.body);return function(){var t=n(),i=e.getCurrentScope(),o=new ve(t,i,ie);e.setCurrentScope(o);var a=e.setValue(r());return e.setCurrentScope(i),a}},e.throwStatementHandler=function(t){var e=this,n=this.createClosure(t.argument);return function(){throw e.setValue(void 0),n()}},e.tryStatementHandler=function(t){var e=this,n=this.createClosure(t.block),r=t.handler?this.catchClauseHandler(t.handler):null,i=t.finalizer?this.createClosure(t.finalizer):null;return function(){var t,o,a=e.getCurrentScope(),s=e.getCurrentContext(),u=a.labelStack.concat([]),l=e.callStack.concat([]),c=re,p=function(){e.setCurrentScope(a),e.setCurrentContext(s),a.labelStack=u,e.callStack=l};try{(c=e.setValue(n()))instanceof he&&(t=c)}catch(n){if(p(),e.isInterruptThrow(n))throw n;if(r)try{(c=e.setValue(r(n)))instanceof he&&(t=c)}catch(t){if(p(),e.isInterruptThrow(t))throw t;o=t}}if(i)try{(c=i())instanceof he&&(t=c)}catch(t){if(p(),e.isInterruptThrow(t))throw t;o=t}if(o)throw o;return t||c}},e.catchClauseHandler=function(t){var e=this,n=this.createParamNameGetter(t.param),r=this.createClosure(t.body);return function(t){var i,o=e.getCurrentScope().data,a=n(),s=$t.call(o,a),u=o[a];return o[a]=t,i=r(),s?o[a]=u:delete o[a],i}},e.continueStatementHandler=function(t){return function(){return t.label?new de(t.label.name):ee}},e.breakStatementHandler=function(t){return function(){return t.label?new fe(t.label.name):te}},e.switchStatementHandler=function(t){var e=this,n=this.createClosure(t.discriminant),r=t.cases.map((function(t){return e.switchCaseHandler(t)}));return function(){for(var t,i,o,a=n(),s=!1,u=0;u<r.length;u++){var l=r[u](),c=l.testClosure();if(c!==ne){if(s||c===a){if(s=!0,(i=e.setValue(l.bodyClosure()))===re)continue;if(i===te)break;if((t=i)instanceof he||t instanceof fe||t instanceof de||t===ee)break}}else o=l}!s&&o&&((i=e.setValue(o.bodyClosure()))===re||i===te||i===ee||(t=i));return t}},e.switchCaseHandler=function(t){var e=t.test?this.createClosure(t.test):function(){return ne},n=this.createClosure({type:"BlockStatement",body:t.consequent});return function(){return{testClosure:e,bodyClosure:n}}},e.labeledStatementHandler=function(t){var e=this,n=t.label.name,r=this.createClosure(t.body);return function(){var i,o=e.getCurrentScope();return o.labelStack.push(n),(i=r(t))instanceof fe&&i.value===n&&(i=re),o.labelStack.pop(),i}},e.debuggerStatementHandler=function(t){return function(){return re}},e.createParamNameGetter=function(t){if("Identifier"===t.type)return function(){return t.name};throw this.createInternalThrowError(Xt.ParamTypeSyntaxError,t.type,t)},e.createObjectKeyGetter=function(t){var e;return e="Identifier"===t.type?function(){return t.name}:this.createClosure(t),function(){return e()}},e.createMemberKeyGetter=function(t){return t.computed?this.createClosure(t.property):this.createObjectKeyGetter(t.property)},e.createObjectGetter=function(t){var e=this;switch(t.type){case"Identifier":return function(){return e.getScopeDataFromName(t.name,e.getCurrentScope())};case"MemberExpression":return this.createClosure(t.object);default:throw this.createInternalThrowError(Xt.AssignmentTypeSyntaxError,t.type,t)}},e.createNameGetter=function(t){switch(t.type){case"Identifier":return function(){return t.name};case"MemberExpression":return this.createMemberKeyGetter(t);default:throw this.createInternalThrowError(Xt.AssignmentTypeSyntaxError,t.type,t)}},e.varDeclaration=function(t){this.collectDeclVars[t]=void 0},e.funcDeclaration=function(t,e){this.collectDeclFuncs[t]=e},e.addDeclarationsToScope=function(t,e,n){var r=n.data;for(var i in e){var o=e[i];r[i]=o?o():o}for(var a in t)a in r||(r[a]=void 0)},e.getScopeValue=function(t,e){return this.getScopeFromName(t,e).data[t]},e.getScopeDataFromName=function(t,e){return this.getScopeFromName(t,e).data},e.getScopeFromName=function(t,e){var n=e;do{if(t in n.data)return n}while(n=n.parent);return this.globalScope},e.setValue=function(t){var e=this.callStack.length;return this.isVarDeclMode||e||t===re||t===te||t===ee||t instanceof fe||t instanceof de||(this.value=t instanceof he?t.value:t),t},e.getValue=function(){return this.value},t}();function xe(t){return void 0===t&&(t=Object.create(null)),t}function be(t,e,n){void 0===e&&(e=[]),void 0===n&&(n={});var r=n.parsingContext,i=void 0===n.timeout?0:n.timeout,o="\n    (function anonymous("+e.join(",")+"){\n         "+t+"\n    });\n    ";return new _e(r,{ecmaVersion:n.ecmaVersion,timeout:i,rootContext:n.rootContext,globalContextInFunction:n.globalContextInFunction}).evaluate(o)}function we(t,e,n){return new _e(e,n).evaluate(t)}_e.version="0.0.3",_e.eval=ce,_e.Function=pe,_e.ecmaVersion=5,_e.globalContextInFunction=void 0,_e.global=Object.create(null);var Se=we,Ee=function(){function t(t){this._code=t}var e=t.prototype;return e.runInContext=function(t){return we(this._code,t)},e.runInNewContext=function(t){return we(this._code,t)},t}(),Ce=function(t,e,n){return we(t,e,n)};function Te(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=e.pop();return be(r||"",e)}var Ae=Ce},20396:function(t,e,n){var r;!function(i,o,a,s){"use strict";var u,l="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,c="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram),p=l||c,h=["","webkit","Moz","MS","ms","o"],f=p?"":o.createElement("div"),d=Math.round,v=Math.abs,m=Date.now;function y(t,e,n){return setTimeout(E(t,n),e)}function g(t,e,n){return!!Array.isArray(t)&&(_(t,n[e],n),!0)}function _(t,e,n){var r;if(t)if(t.forEach)t.forEach(e,n);else if(t.length!==s)for(r=0;r<t.length;)e.call(n,t[r],r,t),r++;else for(r in t)t.hasOwnProperty(r)&&e.call(n,t[r],r,t)}function x(t,e,n){var r="DEPRECATED METHOD: "+e+"\n"+n+" AT \n";return function(){var e=new Error("get-stack-trace"),n=e&&e.stack?e.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",o=i.console&&(i.console.warn||i.console.log);return o&&o.call(i.console,r,n),t.apply(this,arguments)}}u="function"!=typeof Object.assign?function(t){if(t===s||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(r!==s&&null!==r)for(var i in r)r.hasOwnProperty(i)&&(e[i]=r[i])}return e}:Object.assign;var b=x((function(t,e,n){for(var r=Object.keys(e),i=0;i<r.length;)(!n||n&&t[r[i]]===s)&&(t[r[i]]=e[r[i]]),i++;return t}),"extend","Use `assign`."),w=x((function(t,e){return b(t,e,!0)}),"merge","Use `assign`.");function S(t,e,n){var r,i=e.prototype;(r=t.prototype=Object.create(i)).constructor=t,r._super=i,n&&u(r,n)}function E(t,e){return function(){return t.apply(e,arguments)}}function C(t,e){return"function"==typeof t?t.apply(e&&e[0]||s,e):t}function T(t,e){return t===s?e:t}function A(t,e,n){_(O(e),(function(e){t.addEventListener(e,n,!1)}))}function M(t,e,n){_(O(e),(function(e){t.removeEventListener(e,n,!1)}))}function k(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function P(t,e){return t.indexOf(e)>-1}function O(t){return t.trim().split(/\s+/g)}function L(t,e,n){if(t.indexOf&&!n)return t.indexOf(e);for(var r=0;r<t.length;){if(n&&t[r][n]==e||!n&&t[r]===e)return r;r++}return-1}function I(t){return Array.prototype.slice.call(t,0)}function R(t,e,n){for(var r=[],i=[],o=0;o<t.length;){var a=e?t[o][e]:t[o];L(i,a)<0&&r.push(t[o]),i[o]=a,o++}return n&&(r=e?r.sort((function(t,n){return t[e]>n[e]})):r.sort()),r}function D(t,e){for(var n,r,i=e[0].toUpperCase()+e.slice(1),o=0;o<h.length;){if((r=(n=h[o])?n+i:e)in t)return r;o++}return s}var N=1;function Z(t){var e=t.ownerDocument||t;return e.defaultView||e.parentWindow||i}var z="ontouchstart"in i,F=D(i,"PointerEvent")!==s,B=z&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),j="touch",U="mouse",V=24,G=["x","y"],H=["clientX","clientY"];function W(t,e){var n=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){C(t.options.enable,[t])&&n.handler(e)},this.init()}function q(t,e,n){var r=n.pointers.length,i=n.changedPointers.length,o=1&e&&r-i==0,a=12&e&&r-i==0;n.isFirst=!!o,n.isFinal=!!a,o&&(t.session={}),n.eventType=e,function(t,e){var n=t.session,r=e.pointers,i=r.length;n.firstInput||(n.firstInput=X(e));i>1&&!n.firstMultiple?n.firstMultiple=X(e):1===i&&(n.firstMultiple=!1);var o=n.firstInput,a=n.firstMultiple,u=a?a.center:o.center,l=e.center=Y(r);e.timeStamp=m(),e.deltaTime=e.timeStamp-o.timeStamp,e.angle=$(u,l),e.distance=J(u,l),function(t,e){var n=e.center,r=t.offsetDelta||{},i=t.prevDelta||{},o=t.prevInput||{};1!==e.eventType&&4!==o.eventType||(i=t.prevDelta={x:o.deltaX||0,y:o.deltaY||0},r=t.offsetDelta={x:n.x,y:n.y});e.deltaX=i.x+(n.x-r.x),e.deltaY=i.y+(n.y-r.y)}(n,e),e.offsetDirection=Q(e.deltaX,e.deltaY);var c=K(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=c.x,e.overallVelocityY=c.y,e.overallVelocity=v(c.x)>v(c.y)?c.x:c.y,e.scale=a?(p=a.pointers,h=r,J(h[0],h[1],H)/J(p[0],p[1],H)):1,e.rotation=a?function(t,e){return $(e[1],e[0],H)+$(t[1],t[0],H)}(a.pointers,r):0,e.maxPointers=n.prevInput?e.pointers.length>n.prevInput.maxPointers?e.pointers.length:n.prevInput.maxPointers:e.pointers.length,function(t,e){var n,r,i,o,a=t.lastInterval||e,u=e.timeStamp-a.timeStamp;if(8!=e.eventType&&(u>25||a.velocity===s)){var l=e.deltaX-a.deltaX,c=e.deltaY-a.deltaY,p=K(u,l,c);r=p.x,i=p.y,n=v(p.x)>v(p.y)?p.x:p.y,o=Q(l,c),t.lastInterval=e}else n=a.velocity,r=a.velocityX,i=a.velocityY,o=a.direction;e.velocity=n,e.velocityX=r,e.velocityY=i,e.direction=o}(n,e);var p,h;var f=t.element;k(e.srcEvent.target,f)&&(f=e.srcEvent.target);e.target=f}(t,n),t.emit("hammer.input",n),t.recognize(n),t.session.prevInput=n}function X(t){for(var e=[],n=0;n<t.pointers.length;)e[n]={clientX:d(t.pointers[n].clientX),clientY:d(t.pointers[n].clientY)},n++;return{timeStamp:m(),pointers:e,center:Y(e),deltaX:t.deltaX,deltaY:t.deltaY}}function Y(t){var e=t.length;if(1===e)return{x:d(t[0].clientX),y:d(t[0].clientY)};for(var n=0,r=0,i=0;i<e;)n+=t[i].clientX,r+=t[i].clientY,i++;return{x:d(n/e),y:d(r/e)}}function K(t,e,n){return{x:e/t||0,y:n/t||0}}function Q(t,e){return t===e?1:v(t)>=v(e)?t<0?2:4:e<0?8:16}function J(t,e,n){n||(n=G);var r=e[n[0]]-t[n[0]],i=e[n[1]]-t[n[1]];return Math.sqrt(r*r+i*i)}function $(t,e,n){n||(n=G);var r=e[n[0]]-t[n[0]],i=e[n[1]]-t[n[1]];return 180*Math.atan2(i,r)/Math.PI}W.prototype={handler:function(){},init:function(){this.evEl&&A(this.element,this.evEl,this.domHandler),this.evTarget&&A(this.target,this.evTarget,this.domHandler),this.evWin&&A(Z(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&M(this.element,this.evEl,this.domHandler),this.evTarget&&M(this.target,this.evTarget,this.domHandler),this.evWin&&M(Z(this.element),this.evWin,this.domHandler)}};var tt={mousedown:1,mousemove:2,mouseup:4},et="mousedown",nt="mousemove mouseup";function rt(){this.evEl=et,this.evWin=nt,this.pressed=!1,W.apply(this,arguments)}S(rt,W,{handler:function(t){var e=tt[t.type];1&e&&0===t.button&&(this.pressed=!0),2&e&&1!==t.which&&(e=4),this.pressed&&(4&e&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:U,srcEvent:t}))}});var it={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},ot={2:j,3:"pen",4:U,5:"kinect"},at="pointerdown",st="pointermove pointerup pointercancel";function ut(){this.evEl=at,this.evWin=st,W.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}p||!i.MSPointerEvent||i.PointerEvent||(at="MSPointerDown",st="MSPointerMove MSPointerUp MSPointerCancel"),S(ut,W,{handler:function(t){var e=this.store,n=!1,r=t.type.toLowerCase().replace("ms",""),i=it[r],o=ot[t.pointerType]||t.pointerType,a=o==j,s=L(e,t.pointerId,"pointerId");1&i&&(0===t.button||a)?s<0&&(e.push(t),s=e.length-1):12&i&&(n=!0),s<0||(e[s]=t,this.callback(this.manager,i,{pointers:e,changedPointers:[t],pointerType:o,srcEvent:t}),n&&e.splice(s,1))}});var lt={touchstart:1,touchmove:2,touchend:4,touchcancel:8},ct="touchstart",pt="touchstart touchmove touchend touchcancel";function ht(){this.evTarget=ct,this.evWin=pt,this.started=!1,W.apply(this,arguments)}function ft(t,e){var n=I(t.touches),r=I(t.changedTouches);return 12&e&&(n=R(n.concat(r),"identifier",!0)),[n,r]}S(ht,W,{handler:function(t){var e=lt[t.type];if(1===e&&(this.started=!0),this.started){var n=ft.call(this,t,e);12&e&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:j,srcEvent:t})}}});var dt={touchstart:1,touchmove:2,touchend:4,touchcancel:8},vt="touchstart touchmove touchend touchcancel";function mt(){this.evTarget=vt,this.targetIds={},W.apply(this,arguments)}function yt(t,e){var n=I(t.touches),r=this.targetIds;if(3&e&&1===n.length)return r[n[0].identifier]=!0,[n,n];var i,o,a=I(t.changedTouches),s=[],u=this.target;if(o=n.filter((function(t){return k(t.target,u)})),1===e)for(i=0;i<o.length;)r[o[i].identifier]=!0,i++;for(i=0;i<a.length;)r[a[i].identifier]&&s.push(a[i]),12&e&&delete r[a[i].identifier],i++;return s.length?[R(o.concat(s),"identifier",!0),s]:void 0}S(mt,W,{handler:function(t){var e=dt[t.type],n=yt.call(this,t,e);n&&this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:j,srcEvent:t})}});function gt(){W.apply(this,arguments);var t=E(this.handler,this);this.touch=new mt(this.manager,t),this.mouse=new rt(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function _t(t,e){1&t?(this.primaryTouch=e.changedPointers[0].identifier,xt.call(this,e)):12&t&&xt.call(this,e)}function xt(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var n={x:e.clientX,y:e.clientY};this.lastTouches.push(n);var r=this.lastTouches;setTimeout((function(){var t=r.indexOf(n);t>-1&&r.splice(t,1)}),2500)}}function bt(t){for(var e=t.srcEvent.clientX,n=t.srcEvent.clientY,r=0;r<this.lastTouches.length;r++){var i=this.lastTouches[r],o=Math.abs(e-i.x),a=Math.abs(n-i.y);if(o<=25&&a<=25)return!0}return!1}S(gt,W,{handler:function(t,e,n){var r=n.pointerType==j,i=n.pointerType==U;if(!(i&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(r)_t.call(this,e,n);else if(i&&bt.call(this,n))return;this.callback(t,e,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var wt=p?s:D(f.style,"touchAction"),St=wt!==s,Et="compute",Ct="auto",Tt="manipulation",At="none",Mt="pan-x",kt="pan-y",Pt=function(){if(!St)return!1;var t={};if(p)return t;var e=i.CSS&&i.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(n){t[n]=!e||i.CSS.supports("touch-action",n)})),t}();function Ot(t,e){this.manager=t,this.set(e)}Ot.prototype={set:function(t){t==Et&&(t=this.compute()),St&&this.manager.element.style&&Pt[t]&&(this.manager.element.style[wt]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return _(this.manager.recognizers,(function(e){C(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))})),function(t){if(P(t,At))return At;var e=P(t,Mt),n=P(t,kt);if(e&&n)return At;if(e||n)return e?Mt:kt;if(P(t,Tt))return Tt;return Ct}(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,n=t.offsetDirection;if(this.manager.session.prevented)e.preventDefault();else{var r=this.actions,i=P(r,At)&&!Pt.none,o=P(r,kt)&&!Pt["pan-y"],a=P(r,Mt)&&!Pt["pan-x"];if(i){var s=1===t.pointers.length,u=t.distance<2,l=t.deltaTime<250;if(s&&u&&l)return}if(!a||!o)return i||o&&6&n||a&&n&V?this.preventSrc(e):void 0}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var Lt=32;function It(t){this.options=u({},this.defaults,t||{}),this.id=N++,this.manager=null,this.options.enable=T(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function Rt(t){return 16&t?"cancel":8&t?"end":4&t?"move":2&t?"start":""}function Dt(t){return 16==t?"down":8==t?"up":2==t?"left":4==t?"right":""}function Nt(t,e){var n=e.manager;return n?n.get(t):t}function Zt(){It.apply(this,arguments)}function zt(){Zt.apply(this,arguments),this.pX=null,this.pY=null}function Ft(){Zt.apply(this,arguments)}function Bt(){It.apply(this,arguments),this._timer=null,this._input=null}function jt(){Zt.apply(this,arguments)}function Ut(){Zt.apply(this,arguments)}function Vt(){It.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Gt(t,e){return(e=e||{}).recognizers=T(e.recognizers,Gt.defaults.preset),new Ht(t,e)}It.prototype={defaults:{},set:function(t){return u(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(g(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=Nt(t,this)).id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return g(t,"dropRecognizeWith",this)||(t=Nt(t,this),delete this.simultaneous[t.id]),this},requireFailure:function(t){if(g(t,"requireFailure",this))return this;var e=this.requireFail;return-1===L(e,t=Nt(t,this))&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(g(t,"dropRequireFailure",this))return this;t=Nt(t,this);var e=L(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){var e=this,n=this.state;function r(n){e.manager.emit(n,t)}n<8&&r(e.options.event+Rt(n)),r(e.options.event),t.additionalEvent&&r(t.additionalEvent),n>=8&&r(e.options.event+Rt(n))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=Lt},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(33&this.requireFail[t].state))return!1;t++}return!0},recognize:function(t){var e=u({},t);if(!C(this.options.enable,[this,e]))return this.reset(),void(this.state=Lt);56&this.state&&(this.state=1),this.state=this.process(e),30&this.state&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}},S(Zt,It,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,n=t.eventType,r=6&e,i=this.attrTest(t);return r&&(8&n||!i)?16|e:r||i?4&n?8|e:2&e?4|e:2:Lt}}),S(zt,Zt,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var t=this.options.direction,e=[];return 6&t&&e.push(kt),t&V&&e.push(Mt),e},directionTest:function(t){var e=this.options,n=!0,r=t.distance,i=t.direction,o=t.deltaX,a=t.deltaY;return i&e.direction||(6&e.direction?(i=0===o?1:o<0?2:4,n=o!=this.pX,r=Math.abs(t.deltaX)):(i=0===a?1:a<0?8:16,n=a!=this.pY,r=Math.abs(t.deltaY))),t.direction=i,n&&r>e.threshold&&i&e.direction},attrTest:function(t){return Zt.prototype.attrTest.call(this,t)&&(2&this.state||!(2&this.state)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=Dt(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),S(Ft,Zt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[At]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||2&this.state)},emit:function(t){if(1!==t.scale){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}}),S(Bt,It,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Ct]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,r=t.distance<e.threshold,i=t.deltaTime>e.time;if(this._input=t,!r||!n||12&t.eventType&&!i)this.reset();else if(1&t.eventType)this.reset(),this._timer=y((function(){this.state=8,this.tryEmit()}),e.time,this);else if(4&t.eventType)return 8;return Lt},reset:function(){clearTimeout(this._timer)},emit:function(t){8===this.state&&(t&&4&t.eventType?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=m(),this.manager.emit(this.options.event,this._input)))}}),S(jt,Zt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[At]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||2&this.state)}}),S(Ut,Zt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:30,pointers:1},getTouchAction:function(){return zt.prototype.getTouchAction.call(this)},attrTest:function(t){var e,n=this.options.direction;return 30&n?e=t.overallVelocity:6&n?e=t.overallVelocityX:n&V&&(e=t.overallVelocityY),this._super.attrTest.call(this,t)&&n&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&v(e)>this.options.velocity&&4&t.eventType},emit:function(t){var e=Dt(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),S(Vt,It,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Tt]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,r=t.distance<e.threshold,i=t.deltaTime<e.time;if(this.reset(),1&t.eventType&&0===this.count)return this.failTimeout();if(r&&i&&n){if(4!=t.eventType)return this.failTimeout();var o=!this.pTime||t.timeStamp-this.pTime<e.interval,a=!this.pCenter||J(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,a&&o?this.count+=1:this.count=1,this._input=t,0===this.count%e.taps)return this.hasRequireFailures()?(this._timer=y((function(){this.state=8,this.tryEmit()}),e.interval,this),2):8}return Lt},failTimeout:function(){return this._timer=y((function(){this.state=Lt}),this.options.interval,this),Lt},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Gt.VERSION="2.0.7",Gt.defaults={domEvents:!1,touchAction:Et,enable:!0,inputTarget:null,inputClass:null,preset:[[jt,{enable:!1}],[Ft,{enable:!1},["rotate"]],[Ut,{direction:6}],[zt,{direction:6},["swipe"]],[Vt],[Vt,{event:"doubletap",taps:2},["tap"]],[Bt]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function Ht(t,e){var n;this.options=u({},Gt.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=new((n=this).options.inputClass||(F?ut:B?mt:z?gt:rt))(n,q),this.touchAction=new Ot(this,this.options.touchAction),Wt(this,!0),_(this.options.recognizers,(function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])}),this)}function Wt(t,e){var n,r=t.element;r.style&&(_(t.options.cssProps,(function(i,o){n=D(r.style,o),e?(t.oldCssProps[n]=r.style[n],r.style[n]=i):r.style[n]=t.oldCssProps[n]||""})),e||(t.oldCssProps={}))}(Ht.prototype={set:function(t){return u(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){var n;this.touchAction.preventDefaults(t);var r=this.recognizers,i=e.curRecognizer;(!i||i&&8&i.state)&&(i=e.curRecognizer=null);for(var o=0;o<r.length;)n=r[o],2===e.stopped||i&&n!=i&&!n.canRecognizeWith(i)?n.reset():n.recognize(t),!i&&14&n.state&&(i=e.curRecognizer=n),o++}},get:function(t){if(t instanceof It)return t;for(var e=this.recognizers,n=0;n<e.length;n++)if(e[n].options.event==t)return e[n];return null},add:function(t){if(g(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(g(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,n=L(e,t);-1!==n&&(e.splice(n,1),this.touchAction.update())}return this},on:function(t,e){if(t!==s&&e!==s){var n=this.handlers;return _(O(t),(function(t){n[t]=n[t]||[],n[t].push(e)})),this}},off:function(t,e){if(t!==s){var n=this.handlers;return _(O(t),(function(t){e?n[t]&&n[t].splice(L(n[t],e),1):delete n[t]})),this}},emit:function(t,e){this.options.domEvents&&function(t,e){if(p)return;var n=o.createEvent("Event");n.initEvent(t,!0,!0),n.gesture=e,e.target.dispatchEvent(n)}(t,e);var n=this.handlers[t]&&this.handlers[t].slice();if(n&&n.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var r=0;r<n.length;)n[r](e),r++}},destroy:function(){this.element&&Wt(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},p)||(u(Gt,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:Lt,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:V,DIRECTION_ALL:30,Manager:Ht,Input:W,TouchAction:Ot,TouchInput:mt,MouseInput:rt,PointerEventInput:ut,TouchMouseInput:gt,SingleTouchInput:ht,Recognizer:It,AttrRecognizer:Zt,Tap:Vt,Pan:zt,Swipe:Ut,Pinch:Ft,Rotate:jt,Press:Bt,on:A,off:M,each:_,merge:w,extend:b,assign:u,inherit:S,bindFn:E,prefixed:D}),("undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Hammer=Gt,(r=function(){return Gt}.call(e,n,e,t))===s||(t.exports=r))}("undefined"!=typeof window?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document)},88307:function(t,e,n){var r=n(25108);t.exports=function(t){"use strict";var e=function(t){return t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Uint32Array||t instanceof Int8Array||t instanceof Int16Array||t instanceof Int32Array||t instanceof Float32Array||t instanceof Float64Array||t instanceof Uint8ClampedArray},n=function(t,e){for(var n=Object.keys(e),r=0;r<n.length;++r)t[n[r]]=e[n[r]];return t},i="\n";function o(t){return"undefined"!=typeof atob?atob(t):"base64:"+t}function a(t){var e=new Error("(regl) "+t);throw r.error(e),e}function s(t,e){t||a(e)}function u(t){return t?": "+t:""}function l(t,e,n){t in e||a("unknown parameter ("+t+")"+u(n)+". possible values: "+Object.keys(e).join())}function c(t,n){e(t)||a("invalid parameter type"+u(n)+". must be a typed array")}function p(t,e){switch(e){case"number":return"number"==typeof t;case"object":return"object"==typeof t;case"string":return"string"==typeof t;case"boolean":return"boolean"==typeof t;case"function":return"function"==typeof t;case"undefined":return void 0===t;case"symbol":return"symbol"==typeof t}}function h(t,e,n){p(t,e)||a("invalid parameter type"+u(n)+". expected "+e+", got "+typeof t)}function f(t,e){t>=0&&(0|t)===t||a("invalid parameter type, ("+t+")"+u(e)+". must be a nonnegative integer")}function d(t,e,n){e.indexOf(t)<0&&a("invalid value"+u(n)+". must be one of: "+e)}var v=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function m(t){Object.keys(t).forEach((function(t){v.indexOf(t)<0&&a('invalid regl constructor argument "'+t+'". must be one of '+v)}))}function y(t,e){for(t+="";t.length<e;)t=" "+t;return t}function g(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function _(t,e){this.number=t,this.line=e,this.errors=[]}function x(t,e,n){this.file=t,this.line=e,this.message=n}function b(){var t=new Error,e=(t.stack||t).toString(),n=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(e);if(n)return n[1];var r=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(e);return r?r[1]:"unknown"}function w(){var t=new Error,e=(t.stack||t).toString(),n=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(e);if(n)return n[1];var r=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(e);return r?r[1]:"unknown"}function S(t,e){var n=t.split("\n"),r=1,i=0,a={unknown:new g,0:new g};a.unknown.name=a[0].name=e||b(),a.unknown.lines.push(new _(0,""));for(var s=0;s<n.length;++s){var u=n[s],l=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(u);if(l)switch(l[1]){case"line":var c=/(\d+)(\s+\d+)?/.exec(l[2]);c&&(r=0|c[1],c[2]&&((i=0|c[2])in a||(a[i]=new g)));break;case"define":var p=/SHADER_NAME(_B64)?\s+(.*)$/.exec(l[2]);p&&(a[i].name=p[1]?o(p[2]):p[2])}a[i].lines.push(new _(r++,u))}return Object.keys(a).forEach((function(t){var e=a[t];e.lines.forEach((function(t){e.index[t.number]=t}))})),a}function E(t){var e=[];return t.split("\n").forEach((function(t){if(!(t.length<5)){var n=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(t);n?e.push(new x(0|n[1],0|n[2],n[3].trim())):t.length>0&&e.push(new x("unknown",0,t))}})),e}function C(t,e){e.forEach((function(e){var n=t[e.file];if(n){var r=n.index[e.line];if(r)return r.errors.push(e),void(n.hasErrors=!0)}t.unknown.hasErrors=!0,t.unknown.lines[0].errors.push(e)}))}function T(t,e,n,o,a){if(!t.getShaderParameter(e,t.COMPILE_STATUS)){var u=t.getShaderInfoLog(e),l=o===t.FRAGMENT_SHADER?"fragment":"vertex";I(n,"string",l+" shader source must be a string",a);var c=S(n,a),p=E(u);C(c,p),Object.keys(c).forEach((function(t){var e=c[t];if(e.hasErrors){var n=[""],o=[""];a("file number "+t+": "+e.name+"\n","color:red;text-decoration:underline;font-weight:bold"),e.lines.forEach((function(t){if(t.errors.length>0){a(y(t.number,4)+"|  ","background-color:yellow; font-weight:bold"),a(t.line+i,"color:red; background-color:yellow; font-weight:bold");var e=0;t.errors.forEach((function(n){var r=n.message,o=/^\s*'(.*)'\s*:\s*(.*)$/.exec(r);if(o){var s=o[1];r=o[2],"assign"===s&&(s="="),e=Math.max(t.line.indexOf(s,e),0)}else e=0;a(y("| ",6)),a(y("^^^",e+3)+i,"font-weight:bold"),a(y("| ",6)),a(r+i,"font-weight:bold")})),a(y("| ",6)+i)}else a(y(t.number,4)+"|  "),a(t.line+i,"color:red")})),"undefined"==typeof document||window.chrome?r.log(n.join("")):(o[0]=n.join("%c"),r.log.apply(r,o))}function a(t,e){n.push(t),o.push(e||"")}})),s.raise("Error compiling "+l+" shader, "+c[0].name)}}function A(t,e,n,o,a){if(!t.getProgramParameter(e,t.LINK_STATUS)){var u=t.getProgramInfoLog(e),l=S(n,a),c='Error linking program with vertex shader, "'+S(o,a)[0].name+'", and fragment shader "'+l[0].name+'"';"undefined"!=typeof document?r.log("%c"+c+i+"%c"+u,"color:red;text-decoration:underline;font-weight:bold","color:red"):r.log(c+i+u),s.raise(c)}}function M(t){t._commandRef=b()}function k(t,e,n,r){function i(t){return t?r.id(t):0}function o(t,e){Object.keys(e).forEach((function(e){t[r.id(e)]=!0}))}M(t),t._fragId=i(t.static.frag),t._vertId=i(t.static.vert);var a=t._uniformSet={};o(a,e.static),o(a,e.dynamic);var s=t._attributeSet={};o(s,n.static),o(s,n.dynamic),t._hasCount="count"in t.static||"count"in t.dynamic||"elements"in t.static||"elements"in t.dynamic}function P(t,e){var n=w();a(t+" in command "+(e||b())+("unknown"===n?"":" called from "+n))}function O(t,e,n){t||P(e,n||b())}function L(t,e,n,r){t in e||P("unknown parameter ("+t+")"+u(n)+". possible values: "+Object.keys(e).join(),r||b())}function I(t,e,n,r){p(t,e)||P("invalid parameter type"+u(n)+". expected "+e+", got "+typeof t,r||b())}function R(t){t()}function D(t,e,n){t.texture?d(t.texture._texture.internalformat,e,"unsupported texture format for attachment"):d(t.renderbuffer._renderbuffer.format,n,"unsupported renderbuffer format for attachment")}var N=33071,Z=9728,z=9984,F=9985,B=9986,j=9987,U=5121,V=5122,G=5123,H=5124,W=5125,q=5126,X=32819,Y=32820,K=33635,Q=34042,J=36193,$={};function tt(t,e){return t===Y||t===X||t===K?2:t===Q?4:$[t]*e}function et(t){return!(t&t-1||!t)}function nt(t,e,n){var r,i=e.width,o=e.height,a=e.channels;s(i>0&&i<=n.maxTextureSize&&o>0&&o<=n.maxTextureSize,"invalid texture shape"),t.wrapS===N&&t.wrapT===N||s(et(i)&&et(o),"incompatible wrap mode for texture, both width and height must be power of 2"),1===e.mipmask?1!==i&&1!==o&&s(t.minFilter!==z&&t.minFilter!==B&&t.minFilter!==F&&t.minFilter!==j,"min filter requires mipmap"):(s(et(i)&&et(o),"texture must be a square power of 2 to support mipmapping"),s(e.mipmask===(i<<1)-1,"missing or incomplete mipmap data")),e.type===q&&(n.extensions.indexOf("oes_texture_float_linear")<0&&s(t.minFilter===Z&&t.magFilter===Z,"filter not supported, must enable oes_texture_float_linear"),s(!t.genMipmaps,"mipmap generation not supported with float textures"));var u=e.images;for(r=0;r<16;++r)if(u[r]){var l=i>>r,c=o>>r;s(e.mipmask&1<<r,"missing mipmap data");var p=u[r];if(s(p.width===l&&p.height===c,"invalid shape for mip images"),s(p.format===e.format&&p.internalformat===e.internalformat&&p.type===e.type,"incompatible type for mip image"),p.compressed);else if(p.data){var h=Math.ceil(tt(p.type,a)*l/p.unpackAlignment)*p.unpackAlignment;s(p.data.byteLength===h*c,"invalid data for image, buffer size is inconsistent with image format")}else p.element||p.copy}else t.genMipmaps||s(0==(e.mipmask&1<<r),"extra mipmap data");e.compressed&&s(!t.genMipmaps,"mipmap generation for compressed images not supported")}function rt(t,e,n,r){var i=t.width,o=t.height,a=t.channels;s(i>0&&i<=r.maxTextureSize&&o>0&&o<=r.maxTextureSize,"invalid texture shape"),s(i===o,"cube map must be square"),s(e.wrapS===N&&e.wrapT===N,"wrap mode not supported by cube map");for(var u=0;u<n.length;++u){var l=n[u];s(l.width===i&&l.height===o,"inconsistent cube map face shape"),e.genMipmaps&&(s(!l.compressed,"can not generate mipmap for compressed textures"),s(1===l.mipmask,"can not specify mipmaps and generate mipmaps"));for(var c=l.images,p=0;p<16;++p){var h=c[p];if(h){var f=i>>p,d=o>>p;s(l.mipmask&1<<p,"missing mipmap data"),s(h.width===f&&h.height===d,"invalid shape for mip images"),s(h.format===t.format&&h.internalformat===t.internalformat&&h.type===t.type,"incompatible type for mip image"),h.compressed||(h.data?s(h.data.byteLength===f*d*Math.max(tt(h.type,a),h.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):h.element||h.copy)}}}}$[5120]=$[U]=1,$[V]=$[G]=$[J]=$[K]=$[X]=$[Y]=2,$[H]=$[W]=$[q]=$[Q]=4;var it=n(s,{optional:R,raise:a,commandRaise:P,command:O,parameter:l,commandParameter:L,constructor:m,type:h,commandType:I,isTypedArray:c,nni:f,oneOf:d,shaderError:T,linkError:A,callSite:w,saveCommandRef:M,saveDrawInfo:k,framebufferFormat:D,guessCommand:b,texture2D:nt,textureCube:rt}),ot=0,at=0,st=5,ut=6;function lt(t,e){this.id=ot++,this.type=t,this.data=e}function ct(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function pt(t){if(0===t.length)return[];var e=t.charAt(0),n=t.charAt(t.length-1);if(t.length>1&&e===n&&('"'===e||"'"===e))return['"'+ct(t.substr(1,t.length-2))+'"'];var r=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(t);if(r)return pt(t.substr(0,r.index)).concat(pt(r[1])).concat(pt(t.substr(r.index+r[0].length)));var i=t.split(".");if(1===i.length)return['"'+ct(t)+'"'];for(var o=[],a=0;a<i.length;++a)o=o.concat(pt(i[a]));return o}function ht(t){return"["+pt(t).join("][")+"]"}function ft(t,e){return new lt(t,ht(e+""))}function dt(t){return"function"==typeof t&&!t._reglType||t instanceof lt}function vt(t,e){return"function"==typeof t?new lt(at,t):"number"==typeof t||"boolean"==typeof t?new lt(st,t):Array.isArray(t)?new lt(ut,t.map((function(t,n){return vt(t,e+"["+n+"]")}))):t instanceof lt?t:void it(!1,"invalid option type in uniform "+e)}var mt={DynamicVariable:lt,define:ft,isDynamic:dt,unbox:vt,accessor:ht},yt={next:"function"==typeof requestAnimationFrame?function(t){return requestAnimationFrame(t)}:function(t){return setTimeout(t,16)},cancel:"function"==typeof cancelAnimationFrame?function(t){return cancelAnimationFrame(t)}:clearTimeout},gt="undefined"!=typeof my&&my&&"function"==typeof my.showToast&&!0!==my.isFRM?function(){return+new Date}:"undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date};function _t(){var t={"":0},e=[""];return{id:function(n){var r=t[n];return r||(r=t[n]=e.length,e.push(n),r)},str:function(t){return e[t]}}}function xt(t,e,r){var i,o=document.createElement("canvas");function a(){var e=window.innerWidth,n=window.innerHeight;if(t!==document.body){var i=o.getBoundingClientRect();e=i.right-i.left,n=i.bottom-i.top}o.width=r*e,o.height=r*n}function s(){i?i.disconnect():window.removeEventListener("resize",a),t.removeChild(o)}return n(o.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),t.appendChild(o),t===document.body&&(o.style.position="absolute",n(t.style,{margin:0,padding:0})),t!==document.body&&"function"==typeof ResizeObserver?(i=new ResizeObserver((function(){setTimeout(a)}))).observe(t):window.addEventListener("resize",a,!1),a(),{canvas:o,onDestroy:s}}function bt(t,e){function n(n){try{return t.getContext(n,e)}catch(t){return null}}return n("webgl")||n("experimental-webgl")||n("webgl-experimental")}function wt(t){return"string"==typeof t.nodeName&&"function"==typeof t.appendChild&&"function"==typeof t.getBoundingClientRect}function St(t){return"function"==typeof t.drawArrays||"function"==typeof t.drawElements}function Et(t){return"string"==typeof t?t.split():(it(Array.isArray(t),"invalid extension array"),t)}function Ct(t){return"string"==typeof t?(it("undefined"!=typeof document,"not supported outside of DOM"),document.querySelector(t)):t}function Tt(t){var e,n,r,i,o=t||{},a={},s=[],u=[],l="undefined"==typeof window?1:window.devicePixelRatio,c=!1,p=function(t){t&&it.raise(t)},h=function(){};if("string"==typeof o?(it("undefined"!=typeof document,"selector queries only supported in DOM environments"),e=document.querySelector(o),it(e,"invalid query string for element")):"object"==typeof o?wt(o)?e=o:St(o)?r=(i=o).canvas:(it.constructor(o),"gl"in o?i=o.gl:"canvas"in o?r=Ct(o.canvas):"container"in o&&(n=Ct(o.container)),"attributes"in o&&(a=o.attributes,it.type(a,"object","invalid context attributes")),"extensions"in o&&(s=Et(o.extensions)),"optionalExtensions"in o&&(u=Et(o.optionalExtensions)),"onDone"in o&&(it.type(o.onDone,"function","invalid or missing onDone callback"),p=o.onDone),"profile"in o&&(c=!!o.profile),"pixelRatio"in o&&(l=+o.pixelRatio,it(l>0,"invalid pixel ratio"))):it.raise("invalid arguments to regl"),e&&("canvas"===e.nodeName.toLowerCase()?r=e:n=e),!i){if(!r){it("undefined"!=typeof document,"must manually specify webgl context outside of DOM environments");var f=xt(n||document.body,p,l);if(!f)return null;r=f.canvas,h=f.onDestroy}void 0===a.premultipliedAlpha&&(a.premultipliedAlpha=!0),i=bt(r,a)}return i?{gl:i,canvas:r,container:n,extensions:s,optionalExtensions:u,pixelRatio:l,profile:c,onDone:p,onDestroy:h}:(h(),p("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function At(t,e){var n={};function r(t){it.type(t,"string","extension name must be string");var e,r=t.toLowerCase();try{e=n[r]=i(t)}catch(t){}return!!e}function i(e){return t.getExtension(e)?t.getExtension(e):t.getExtension(e.toLowerCase())?t.getExtension(e.toLowerCase()):null}for(var o=0;o<e.extensions.length;++o){var a=e.extensions[o];if(!r(a))return e.onDestroy(),e.onDone('"'+a+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return e.optionalExtensions.forEach(r),{extensions:n,restore:function(){Object.keys(n).forEach((function(t){if(n[t]&&!r(t))throw new Error("(regl): error restoring extension "+t)}))}}}function Mt(t,e){for(var n=Array(t),r=0;r<t;++r)n[r]=e(r);return n}var kt=5120,Pt=5121,Ot=5122,Lt=5123,It=5124,Rt=5125,Dt=5126;function Nt(t){for(var e=16;e<=1<<28;e*=16)if(t<=e)return e;return 0}function Zt(t){var e,n;return e=(t>65535)<<4,e|=n=((t>>>=e)>255)<<3,e|=n=((t>>>=n)>15)<<2,(e|=n=((t>>>=n)>3)<<1)|(t>>>=n)>>1}function zt(){var t=Mt(8,(function(){return[]}));function e(e){var n=Nt(e),r=t[Zt(n)>>2];return r.length>0?r.pop():new ArrayBuffer(n)}function n(e){t[Zt(e.byteLength)>>2].push(e)}function r(t,n){var r=null;switch(t){case kt:r=new Int8Array(e(n),0,n);break;case Pt:r=new Uint8Array(e(n),0,n);break;case Ot:r=new Int16Array(e(2*n),0,n);break;case Lt:r=new Uint16Array(e(2*n),0,n);break;case It:r=new Int32Array(e(4*n),0,n);break;case Rt:r=new Uint32Array(e(4*n),0,n);break;case Dt:r=new Float32Array(e(4*n),0,n);break;default:return null}return r.length!==n?r.subarray(0,n):r}function i(t){n(t.buffer)}return{alloc:e,free:n,allocType:r,freeType:i}}var Ft=zt();Ft.zero=zt();var Bt=3408,jt=3410,Ut=3411,Vt=3412,Gt=3413,Ht=3414,Wt=3415,qt=33901,Xt=33902,Yt=3379,Kt=3386,Qt=34921,Jt=36347,$t=36348,te=35661,ee=35660,ne=34930,re=36349,ie=34076,oe=34024,ae=7936,se=7937,ue=7938,le=35724,ce=34047,pe=36063,he=34852,fe=3553,de=34067,ve=34069,me=33984,ye=6408,ge=5126,_e=5121,xe=36160,be=36053,we=36064,Se=16384,Ee=function(t,e){var n=1;e.ext_texture_filter_anisotropic&&(n=t.getParameter(ce));var r=1,i=1;e.webgl_draw_buffers&&(r=t.getParameter(he),i=t.getParameter(pe));var o=!!e.oes_texture_float;if(o){var a=t.createTexture();t.bindTexture(fe,a),t.texImage2D(fe,0,ye,1,1,0,ye,ge,null);var s=t.createFramebuffer();if(t.bindFramebuffer(xe,s),t.framebufferTexture2D(xe,we,fe,a,0),t.bindTexture(fe,null),t.checkFramebufferStatus(xe)!==be)o=!1;else{t.viewport(0,0,1,1),t.clearColor(1,0,0,1),t.clear(Se);var u=Ft.allocType(ge,4);t.readPixels(0,0,1,1,ye,ge,u),t.getError()?o=!1:(t.deleteFramebuffer(s),t.deleteTexture(a),o=1===u[0]),Ft.freeType(u)}}var l=!0;if("undefined"==typeof navigator||!(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))){var c=t.createTexture(),p=Ft.allocType(_e,36);t.activeTexture(me),t.bindTexture(de,c),t.texImage2D(ve,0,ye,3,3,0,ye,_e,p),Ft.freeType(p),t.bindTexture(de,null),t.deleteTexture(c),l=!t.getError()}return{colorBits:[t.getParameter(jt),t.getParameter(Ut),t.getParameter(Vt),t.getParameter(Gt)],depthBits:t.getParameter(Ht),stencilBits:t.getParameter(Wt),subpixelBits:t.getParameter(Bt),extensions:Object.keys(e).filter((function(t){return!!e[t]})),maxAnisotropic:n,maxDrawbuffers:r,maxColorAttachments:i,pointSizeDims:t.getParameter(qt),lineWidthDims:t.getParameter(Xt),maxViewportDims:t.getParameter(Kt),maxCombinedTextureUnits:t.getParameter(te),maxCubeMapSize:t.getParameter(ie),maxRenderbufferSize:t.getParameter(oe),maxTextureUnits:t.getParameter(ne),maxTextureSize:t.getParameter(Yt),maxAttributes:t.getParameter(Qt),maxVertexUniforms:t.getParameter(Jt),maxVertexTextureUnits:t.getParameter(ee),maxVaryingVectors:t.getParameter($t),maxFragmentUniforms:t.getParameter(re),glsl:t.getParameter(le),renderer:t.getParameter(se),vendor:t.getParameter(ae),version:t.getParameter(ue),readFloat:o,npotTextureCube:l}};function Ce(t){return!!t&&"object"==typeof t&&Array.isArray(t.shape)&&Array.isArray(t.stride)&&"number"==typeof t.offset&&t.shape.length===t.stride.length&&(Array.isArray(t.data)||e(t.data))}var Te=function(t){return Object.keys(t).map((function(e){return t[e]}))},Ae={shape:Ie,flatten:Le};function Me(t,e,n){for(var r=0;r<e;++r)n[r]=t[r]}function ke(t,e,n,r){for(var i=0,o=0;o<e;++o)for(var a=t[o],s=0;s<n;++s)r[i++]=a[s]}function Pe(t,e,n,r,i,o){for(var a=o,s=0;s<e;++s)for(var u=t[s],l=0;l<n;++l)for(var c=u[l],p=0;p<r;++p)i[a++]=c[p]}function Oe(t,e,n,r,i){for(var o=1,a=n+1;a<e.length;++a)o*=e[a];var s=e[n];if(e.length-n==4){var u=e[n+1],l=e[n+2],c=e[n+3];for(a=0;a<s;++a)Pe(t[a],u,l,c,r,i),i+=o}else for(a=0;a<s;++a)Oe(t[a],e,n+1,r,i),i+=o}function Le(t,e,n,r){var i=1;if(e.length)for(var o=0;o<e.length;++o)i*=e[o];else i=0;var a=r||Ft.allocType(n,i);switch(e.length){case 0:break;case 1:Me(t,e[0],a);break;case 2:ke(t,e[0],e[1],a);break;case 3:Pe(t,e[0],e[1],e[2],a,0);break;default:Oe(t,e,0,a,0)}return a}function Ie(t){for(var e=[],n=t;n.length;n=n[0])e.push(n.length);return e}var Re={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},De={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},Ne={dynamic:35048,stream:35040,static:35044},Ze=Ae.flatten,ze=Ae.shape,Fe=35044,Be=35040,je=5121,Ue=5126,Ve=[];function Ge(t){return 0|Re[Object.prototype.toString.call(t)]}function He(t,e){for(var n=0;n<e.length;++n)t[n]=e[n]}function We(t,e,n,r,i,o,a){for(var s=0,u=0;u<n;++u)for(var l=0;l<r;++l)t[s++]=e[i*u+o*l+a]}function qe(t,n,r,i){var o=0,a={};function s(e){this.id=o++,this.buffer=t.createBuffer(),this.type=e,this.usage=Fe,this.byteLength=0,this.dimension=1,this.dtype=je,this.persistentData=null,r.profile&&(this.stats={size:0})}s.prototype.bind=function(){t.bindBuffer(this.type,this.buffer)},s.prototype.destroy=function(){f(this)};var u=[];function l(t,e){var n=u.pop();return n||(n=new s(t)),n.bind(),h(n,e,Be,0,1,!1),n}function c(t){u.push(t)}function p(e,n,r){e.byteLength=n.byteLength,t.bufferData(e.type,n,r)}function h(t,n,r,i,o,a){var s,u;if(t.usage=r,Array.isArray(n)){if(t.dtype=i||Ue,n.length>0)if(Array.isArray(n[0])){s=ze(n);for(var l=1,c=1;c<s.length;++c)l*=s[c];t.dimension=l,p(t,u=Ze(n,s,t.dtype),r),a?t.persistentData=u:Ft.freeType(u)}else if("number"==typeof n[0]){t.dimension=o;var h=Ft.allocType(t.dtype,n.length);He(h,n),p(t,h,r),a?t.persistentData=h:Ft.freeType(h)}else e(n[0])?(t.dimension=n[0].length,t.dtype=i||Ge(n[0])||Ue,p(t,u=Ze(n,[n.length,n[0].length],t.dtype),r),a?t.persistentData=u:Ft.freeType(u)):it.raise("invalid buffer data")}else if(e(n))t.dtype=i||Ge(n),t.dimension=o,p(t,n,r),a&&(t.persistentData=new Uint8Array(new Uint8Array(n.buffer)));else if(Ce(n)){s=n.shape;var f=n.stride,d=n.offset,v=0,m=0,y=0,g=0;1===s.length?(v=s[0],m=1,y=f[0],g=0):2===s.length?(v=s[0],m=s[1],y=f[0],g=f[1]):it.raise("invalid shape"),t.dtype=i||Ge(n.data)||Ue,t.dimension=m;var _=Ft.allocType(t.dtype,v*m);We(_,n.data,v,m,y,g,d),p(t,_,r),a?t.persistentData=_:Ft.freeType(_)}else n instanceof ArrayBuffer?(t.dtype=je,t.dimension=o,p(t,n,r),a&&(t.persistentData=new Uint8Array(new Uint8Array(n)))):it.raise("invalid buffer data")}function f(e){n.bufferCount--,i(e);var r=e.buffer;it(r,"buffer must not be deleted already"),t.deleteBuffer(r),e.buffer=null,delete a[e.id]}function d(i,o,u,l){n.bufferCount++;var c=new s(o);function p(n){var i=Fe,o=null,a=0,s=0,u=1;return Array.isArray(n)||e(n)||Ce(n)||n instanceof ArrayBuffer?o=n:"number"==typeof n?a=0|n:n&&(it.type(n,"object","buffer arguments must be an object, a number or an array"),"data"in n&&(it(null===o||Array.isArray(o)||e(o)||Ce(o),"invalid data for buffer"),o=n.data),"usage"in n&&(it.parameter(n.usage,Ne,"invalid buffer usage"),i=Ne[n.usage]),"type"in n&&(it.parameter(n.type,De,"invalid buffer type"),s=De[n.type]),"dimension"in n&&(it.type(n.dimension,"number","invalid dimension"),u=0|n.dimension),"length"in n&&(it.nni(a,"buffer length must be a nonnegative integer"),a=0|n.length)),c.bind(),o?h(c,o,i,s,u,l):(a&&t.bufferData(c.type,a,i),c.dtype=s||je,c.usage=i,c.dimension=u,c.byteLength=a),r.profile&&(c.stats.size=c.byteLength*Ve[c.dtype]),p}function d(e,n){it(n+e.byteLength<=c.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+e.byteLength+" starting from offset "+n+" to a buffer of size "+c.byteLength),t.bufferSubData(c.type,n,e)}function v(t,n){var r,i=0|(n||0);if(c.bind(),e(t)||t instanceof ArrayBuffer)d(t,i);else if(Array.isArray(t)){if(t.length>0)if("number"==typeof t[0]){var o=Ft.allocType(c.dtype,t.length);He(o,t),d(o,i),Ft.freeType(o)}else if(Array.isArray(t[0])||e(t[0])){r=ze(t);var a=Ze(t,r,c.dtype);d(a,i),Ft.freeType(a)}else it.raise("invalid buffer data")}else if(Ce(t)){r=t.shape;var s=t.stride,u=0,l=0,h=0,f=0;1===r.length?(u=r[0],l=1,h=s[0],f=0):2===r.length?(u=r[0],l=r[1],h=s[0],f=s[1]):it.raise("invalid shape");var v=Array.isArray(t.data)?c.dtype:Ge(t.data),m=Ft.allocType(v,u*l);We(m,t.data,u,l,h,f,t.offset),d(m,i),Ft.freeType(m)}else it.raise("invalid data for buffer subdata");return p}return a[c.id]=c,u||p(i),p._reglType="buffer",p._buffer=c,p.subdata=v,r.profile&&(p.stats=c.stats),p.destroy=function(){f(c)},p}function v(){Te(a).forEach((function(e){e.buffer=t.createBuffer(),t.bindBuffer(e.type,e.buffer),t.bufferData(e.type,e.persistentData||e.byteLength,e.usage)}))}return r.profile&&(n.getTotalBufferSize=function(){var t=0;return Object.keys(a).forEach((function(e){t+=a[e].stats.size})),t}),{create:d,createStream:l,destroyStream:c,clear:function(){Te(a).forEach(f),u.forEach(f)},getBuffer:function(t){return t&&t._buffer instanceof s?t._buffer:null},restore:v,_initBuffer:h}}Ve[5120]=1,Ve[5122]=2,Ve[5124]=4,Ve[5121]=1,Ve[5123]=2,Ve[5125]=4,Ve[5126]=4;var Xe={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Ye=0,Ke=1,Qe=4,Je=5120,$e=5121,tn=5122,en=5123,nn=5124,rn=5125,on=34963,an=35040,sn=35044;function un(t,n,r,i){var o={},a=0,s={uint8:$e,uint16:en};function u(t){this.id=a++,o[this.id]=this,this.buffer=t,this.primType=Qe,this.vertCount=0,this.type=0}n.oes_element_index_uint&&(s.uint32=rn),u.prototype.bind=function(){this.buffer.bind()};var l=[];function c(t){var e=l.pop();return e||(e=new u(r.create(null,on,!0,!1)._buffer)),h(e,t,an,-1,-1,0,0),e}function p(t){l.push(t)}function h(i,o,a,s,u,l,c){var p;if(i.buffer.bind(),o){var h=c;c||e(o)&&(!Ce(o)||e(o.data))||(h=n.oes_element_index_uint?rn:en),r._initBuffer(i.buffer,o,a,h,3)}else t.bufferData(on,l,a),i.buffer.dtype=p||$e,i.buffer.usage=a,i.buffer.dimension=3,i.buffer.byteLength=l;if(p=c,!c){switch(i.buffer.dtype){case $e:case Je:p=$e;break;case en:case tn:p=en;break;case rn:case nn:p=rn;break;default:it.raise("unsupported type for element array")}i.buffer.dtype=p}i.type=p,it(p!==rn||!!n.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var f=u;f<0&&(f=i.buffer.byteLength,p===en?f>>=1:p===rn&&(f>>=2)),i.vertCount=f;var d=s;if(s<0){d=Qe;var v=i.buffer.dimension;1===v&&(d=Ye),2===v&&(d=Ke),3===v&&(d=Qe)}i.primType=d}function f(t){i.elementsCount--,it(null!==t.buffer,"must not double destroy elements"),delete o[t.id],t.buffer.destroy(),t.buffer=null}function d(t,n){var o=r.create(null,on,!0),a=new u(o._buffer);function l(t){if(t)if("number"==typeof t)o(t),a.primType=Qe,a.vertCount=0|t,a.type=$e;else{var n=null,r=sn,i=-1,u=-1,c=0,p=0;Array.isArray(t)||e(t)||Ce(t)?n=t:(it.type(t,"object","invalid arguments for elements"),"data"in t&&(n=t.data,it(Array.isArray(n)||e(n)||Ce(n),"invalid data for element buffer")),"usage"in t&&(it.parameter(t.usage,Ne,"invalid element buffer usage"),r=Ne[t.usage]),"primitive"in t&&(it.parameter(t.primitive,Xe,"invalid element buffer primitive"),i=Xe[t.primitive]),"count"in t&&(it("number"==typeof t.count&&t.count>=0,"invalid vertex count for elements"),u=0|t.count),"type"in t&&(it.parameter(t.type,s,"invalid buffer type"),p=s[t.type]),"length"in t?c=0|t.length:(c=u,p===en||p===tn?c*=2:p!==rn&&p!==nn||(c*=4))),h(a,n,r,i,u,c,p)}else o(),a.primType=Qe,a.vertCount=0,a.type=$e;return l}return i.elementsCount++,l(t),l._reglType="elements",l._elements=a,l.subdata=function(t,e){return o.subdata(t,e),l},l.destroy=function(){f(a)},l}return{create:d,createStream:c,destroyStream:p,getElements:function(t){return"function"==typeof t&&t._elements instanceof u?t._elements:null},clear:function(){Te(o).forEach(f)}}}var ln=new Float32Array(1),cn=new Uint32Array(ln.buffer),pn=5123;function hn(t){for(var e=Ft.allocType(pn,t.length),n=0;n<t.length;++n)if(isNaN(t[n]))e[n]=65535;else if(t[n]===1/0)e[n]=31744;else if(t[n]===-1/0)e[n]=64512;else{ln[0]=t[n];var r=cn[0],i=r>>>31<<15,o=(r<<1>>>24)-127,a=r>>13&1023;if(o<-24)e[n]=i;else if(o<-14){var s=-14-o;e[n]=i+(a+1024>>s)}else e[n]=o>15?i+31744:i+(o+15<<10)+a}return e}function fn(t){return Array.isArray(t)||e(t)}var dn=function(t){return!(t&t-1||!t)},vn=34467,mn=3553,yn=34067,gn=34069,_n=6408,xn=6406,bn=6407,wn=6409,Sn=6410,En=32854,Cn=32855,Tn=36194,An=32819,Mn=32820,kn=33635,Pn=34042,On=6402,Ln=34041,In=35904,Rn=35906,Dn=36193,Nn=33776,Zn=33777,zn=33778,Fn=33779,Bn=35986,jn=35987,Un=34798,Vn=35840,Gn=35841,Hn=35842,Wn=35843,qn=36196,Xn=5121,Yn=5123,Kn=5125,Qn=5126,Jn=10242,$n=10243,tr=10497,er=33071,nr=33648,rr=10240,ir=10241,or=9728,ar=9729,sr=9984,ur=9985,lr=9986,cr=9987,pr=33170,hr=4352,fr=4353,dr=4354,vr=34046,mr=3317,yr=37440,gr=37441,_r=37443,xr=37444,br=33984,wr=[sr,lr,ur,cr],Sr=[0,wn,Sn,bn,_n],Er={};function Cr(t){return"[object "+t+"]"}Er[wn]=Er[xn]=Er[On]=1,Er[Ln]=Er[Sn]=2,Er[bn]=Er[In]=3,Er[_n]=Er[Rn]=4;var Tr=Cr("HTMLCanvasElement"),Ar=Cr("OffscreenCanvas"),Mr=Cr("CanvasRenderingContext2D"),kr=Cr("ImageBitmap"),Pr=Cr("HTMLImageElement"),Or=Cr("HTMLVideoElement"),Lr=Object.keys(Re).concat([Tr,Ar,Mr,kr,Pr,Or]),Ir=[];Ir[Xn]=1,Ir[Qn]=4,Ir[Dn]=2,Ir[Yn]=2,Ir[Kn]=4;var Rr=[];function Dr(t){return Array.isArray(t)&&(0===t.length||"number"==typeof t[0])}function Nr(t){return!!Array.isArray(t)&&!(0===t.length||!fn(t[0]))}function Zr(t){return Object.prototype.toString.call(t)}function zr(t){return Zr(t)===Tr}function Fr(t){return Zr(t)===Ar}function Br(t){return Zr(t)===Mr}function jr(t){return Zr(t)===kr}function Ur(t){return Zr(t)===Pr}function Vr(t){return Zr(t)===Or}function Gr(t){return!!("undefined"!=typeof my&&my&&"function"==typeof my.showToast&&!0!==my.isFRM&&t&&t.getContext)}function Hr(t){return!!("undefined"!=typeof my&&my&&"function"==typeof my.showToast&&!0!==my.isFRM&&t&&"src"in t&&"crossOrigin"in t)}function Wr(t){if(!t)return!1;if(Gr(t)||Hr(t))return!0;var e=Zr(t);return Lr.indexOf(e)>=0||Dr(t)||Nr(t)||Ce(t)}function qr(t){return 0|Re[Object.prototype.toString.call(t)]}function Xr(t,e){var n=e.length;switch(t.type){case Xn:case Yn:case Kn:case Qn:var r=Ft.allocType(t.type,n);r.set(e),t.data=r;break;case Dn:t.data=hn(e);break;default:it.raise("unsupported texture type, must specify a typed array")}}function Yr(t,e){return Ft.allocType(t.type===Dn?Qn:t.type,e)}function Kr(t,e){t.type===Dn?(t.data=hn(e),Ft.freeType(e)):t.data=e}function Qr(t,e,n,r,i,o){for(var a=t.width,s=t.height,u=t.channels,l=Yr(t,a*s*u),c=0,p=0;p<s;++p)for(var h=0;h<a;++h)for(var f=0;f<u;++f)l[c++]=e[n*h+r*p+i*f+o];Kr(t,l)}function Jr(t,e,n,r,i,o){var a;if(a=void 0!==Rr[t]?Rr[t]:Er[t]*Ir[e],o&&(a*=6),i){for(var s=0,u=n;u>=1;)s+=a*u*u,u/=2;return s}return a*n*r}function $r(t,r,i,o,a,s,u){var l={"don't care":hr,"dont care":hr,nice:dr,fast:fr},c={repeat:tr,clamp:er,mirror:nr},p={nearest:or,linear:ar},h=n({mipmap:cr,"nearest mipmap nearest":sr,"linear mipmap nearest":ur,"nearest mipmap linear":lr,"linear mipmap linear":cr},p),f={none:0,browser:xr},d={uint8:Xn,rgba4:An,rgb565:kn,"rgb5 a1":Mn},v={alpha:xn,luminance:wn,"luminance alpha":Sn,rgb:bn,rgba:_n,rgba4:En,"rgb5 a1":Cn,rgb565:Tn},m={};r.ext_srgb&&(v.srgb=In,v.srgba=Rn),r.oes_texture_float&&(d.float32=d.float=Qn),r.oes_texture_half_float&&(d.float16=d["half float"]=Dn),r.webgl_depth_texture&&(n(v,{depth:On,"depth stencil":Ln}),n(d,{uint16:Yn,uint32:Kn,"depth stencil":Pn})),r.webgl_compressed_texture_s3tc&&n(m,{"rgb s3tc dxt1":Nn,"rgba s3tc dxt1":Zn,"rgba s3tc dxt3":zn,"rgba s3tc dxt5":Fn}),r.webgl_compressed_texture_atc&&n(m,{"rgb atc":Bn,"rgba atc explicit alpha":jn,"rgba atc interpolated alpha":Un}),r.webgl_compressed_texture_pvrtc&&n(m,{"rgb pvrtc 4bppv1":Vn,"rgb pvrtc 2bppv1":Gn,"rgba pvrtc 4bppv1":Hn,"rgba pvrtc 2bppv1":Wn}),r.webgl_compressed_texture_etc1&&(m["rgb etc1"]=qn);var y=Array.prototype.slice.call(t.getParameter(vn)||new Uint32Array(0));Object.keys(m).forEach((function(t){var e=m[t];y.indexOf(e)>=0&&(v[t]=e)}));var g=Object.keys(v);i.textureFormats=g;var _=[];Object.keys(v).forEach((function(t){var e=v[t];_[e]=t}));var x=[];Object.keys(d).forEach((function(t){var e=d[t];x[e]=t}));var b=[];Object.keys(p).forEach((function(t){var e=p[t];b[e]=t}));var w=[];Object.keys(h).forEach((function(t){var e=h[t];w[e]=t}));var S=[];Object.keys(c).forEach((function(t){var e=c[t];S[e]=t}));var E=g.reduce((function(t,e){var n=v[e];return n===wn||n===xn||n===wn||n===Sn||n===On||n===Ln||r.ext_srgb&&(n===In||n===Rn)?t[n]=n:n===Cn||e.indexOf("rgba")>=0?t[n]=_n:t[n]=bn,t}),{});function C(){this.internalformat=_n,this.format=_n,this.type=Xn,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=xr,this.width=0,this.height=0,this.channels=0}function T(t,e){t.internalformat=e.internalformat,t.format=e.format,t.type=e.type,t.compressed=e.compressed,t.premultiplyAlpha=e.premultiplyAlpha,t.flipY=e.flipY,t.unpackAlignment=e.unpackAlignment,t.colorSpace=e.colorSpace,t.width=e.width,t.height=e.height,t.channels=e.channels}function A(t,e){if("object"==typeof e&&e){if("premultiplyAlpha"in e&&(it.type(e.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),t.premultiplyAlpha=e.premultiplyAlpha),"flipY"in e&&(it.type(e.flipY,"boolean","invalid texture flip"),t.flipY=e.flipY),"alignment"in e&&(it.oneOf(e.alignment,[1,2,4,8],"invalid texture unpack alignment"),t.unpackAlignment=e.alignment),"colorSpace"in e&&(it.parameter(e.colorSpace,f,"invalid colorSpace"),t.colorSpace=f[e.colorSpace]),"type"in e){var n=e.type;it(r.oes_texture_float||!("float"===n||"float32"===n),"you must enable the OES_texture_float extension in order to use floating point textures."),it(r.oes_texture_half_float||!("half float"===n||"float16"===n),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),it(r.webgl_depth_texture||!("uint16"===n||"uint32"===n||"depth stencil"===n),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),it.parameter(n,d,"invalid texture type"),t.type=d[n]}var o=t.width,a=t.height,s=t.channels,u=!1;"shape"in e?(it(Array.isArray(e.shape)&&e.shape.length>=2,"shape must be an array"),o=e.shape[0],a=e.shape[1],3===e.shape.length&&(s=e.shape[2],it(s>0&&s<=4,"invalid number of channels"),u=!0),it(o>=0&&o<=i.maxTextureSize,"invalid width"),it(a>=0&&a<=i.maxTextureSize,"invalid height")):("radius"in e&&(o=a=e.radius,it(o>=0&&o<=i.maxTextureSize,"invalid radius")),"width"in e&&(o=e.width,it(o>=0&&o<=i.maxTextureSize,"invalid width")),"height"in e&&(a=e.height,it(a>=0&&a<=i.maxTextureSize,"invalid height")),"channels"in e&&(s=e.channels,it(s>0&&s<=4,"invalid number of channels"),u=!0)),t.width=0|o,t.height=0|a,t.channels=0|s;var l=!1;if("format"in e){var c=e.format;it(r.webgl_depth_texture||!("depth"===c||"depth stencil"===c),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),it.parameter(c,v,"invalid texture format");var p=t.internalformat=v[c];t.format=E[p],c in d&&("type"in e||(t.type=d[c])),c in m&&(t.compressed=!0),l=!0}!u&&l?t.channels=Er[t.format]:u&&!l?t.channels!==Sr[t.format]&&(t.format=t.internalformat=Sr[t.channels]):l&&u&&it(t.channels===Er[t.format],"number of channels inconsistent with specified format")}}function M(e){t.pixelStorei(yr,e.flipY),t.pixelStorei(gr,e.premultiplyAlpha),t.pixelStorei(_r,e.colorSpace),t.pixelStorei(mr,e.unpackAlignment)}function k(){C.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function P(t,n){var r=null;if(Wr(n)?r=n:n&&(it.type(n,"object","invalid pixel data type"),A(t,n),"x"in n&&(t.xOffset=0|n.x),"y"in n&&(t.yOffset=0|n.y),Wr(n.data)&&(r=n.data)),it(!t.compressed||r instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),n.copy){it(!r,"can not specify copy and data field for the same texture");var o=a.viewportWidth,s=a.viewportHeight;t.width=t.width||o-t.xOffset,t.height=t.height||s-t.yOffset,t.needsCopy=!0,it(t.xOffset>=0&&t.xOffset<o&&t.yOffset>=0&&t.yOffset<s&&t.width>0&&t.width<=o&&t.height>0&&t.height<=s,"copy texture read out of bounds")}else if(r){if(e(r))t.channels=t.channels||4,t.data=r,"type"in n||t.type!==Xn||(t.type=qr(r));else if(Dr(r))t.channels=t.channels||4,Xr(t,r),t.alignment=1,t.needsFree=!0;else if(Ce(r)){var u=r.data;Array.isArray(u)||t.type!==Xn||(t.type=qr(u));var l,c,p,h,f,d,v=r.shape,m=r.stride;3===v.length?(p=v[2],d=m[2]):(it(2===v.length,"invalid ndarray pixel data, must be 2 or 3D"),p=1,d=1),l=v[0],c=v[1],h=m[0],f=m[1],t.alignment=1,t.width=l,t.height=c,t.channels=p,t.format=t.internalformat=Sr[p],t.needsFree=!0,Qr(t,u,h,f,d,r.offset)}else if(Gr(r)||zr(r)||Fr(r)||Br(r))Gr(r)||zr(r)||Fr(r)?t.element=r:t.element=r.canvas,t.width=t.element.width,t.height=t.element.height,t.channels=4;else if(jr(r))t.element=r,t.width=r.width,t.height=r.height,t.channels=4;else if(Ur(r))t.element=r,t.width=r.naturalWidth,t.height=r.naturalHeight,t.channels=4;else if(Hr(r))t.element=r,t.width=r.width,t.height=r.height,t.channels=4;else if(Vr(r))t.element=r,t.width=r.videoWidth,t.height=r.videoHeight,t.channels=4;else if(Nr(r)){var y=t.width||r[0].length,g=t.height||r.length,_=t.channels;_=fn(r[0][0])?_||r[0][0].length:_||1;for(var x=Ae.shape(r),b=1,w=0;w<x.length;++w)b*=x[w];var S=Yr(t,b);Ae.flatten(r,x,"",S),Kr(t,S),t.alignment=1,t.width=y,t.height=g,t.channels=_,t.format=t.internalformat=Sr[_],t.needsFree=!0}}else t.width=t.width||1,t.height=t.height||1,t.channels=t.channels||4;t.type===Qn?it(i.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):t.type===Dn&&it(i.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function O(e,n,r){var i=e.element,a=e.data,s=e.internalformat,u=e.format,l=e.type,c=e.width,p=e.height;M(e),i?t.texImage2D(n,r,u,u,l,i):e.compressed?t.compressedTexImage2D(n,r,s,c,p,0,a):e.needsCopy?(o(),t.copyTexImage2D(n,r,u,e.xOffset,e.yOffset,c,p,0)):t.texImage2D(n,r,u,c,p,0,u,l,a||null)}function L(e,n,r,i,a){var s=e.element,u=e.data,l=e.internalformat,c=e.format,p=e.type,h=e.width,f=e.height;M(e),s?t.texSubImage2D(n,a,r,i,c,p,s):e.compressed?t.compressedTexSubImage2D(n,a,r,i,l,h,f,u):e.needsCopy?(o(),t.copyTexSubImage2D(n,a,r,i,e.xOffset,e.yOffset,h,f)):t.texSubImage2D(n,a,r,i,h,f,c,p,u)}var I=[];function R(){return I.pop()||new k}function D(t){t.needsFree&&Ft.freeType(t.data),k.call(t),I.push(t)}function N(){C.call(this),this.genMipmaps=!1,this.mipmapHint=hr,this.mipmask=0,this.images=Array(16)}function Z(t,e,n){var r=t.images[0]=R();t.mipmask=1,r.width=t.width=e,r.height=t.height=n,r.channels=t.channels=4}function z(t,e){var n=null;if(Wr(e))T(n=t.images[0]=R(),t),P(n,e),t.mipmask=1;else if(A(t,e),Array.isArray(e.mipmap))for(var r=e.mipmap,i=0;i<r.length;++i)T(n=t.images[i]=R(),t),n.width>>=i,n.height>>=i,P(n,r[i]),t.mipmask|=1<<i;else T(n=t.images[0]=R(),t),P(n,e),t.mipmask=1;T(t,t.images[0]),!t.compressed||t.internalformat!==Nn&&t.internalformat!==Zn&&t.internalformat!==zn&&t.internalformat!==Fn||it(t.width%4==0&&t.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function F(t,e){for(var n=t.images,r=0;r<n.length;++r){if(!n[r])return;O(n[r],e,r)}}var B=[];function j(){var t=B.pop()||new N;C.call(t),t.mipmask=0;for(var e=0;e<16;++e)t.images[e]=null;return t}function U(t){for(var e=t.images,n=0;n<e.length;++n)e[n]&&D(e[n]),e[n]=null;B.push(t)}function V(){this.minFilter=or,this.magFilter=or,this.wrapS=er,this.wrapT=er,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=hr}function G(t,e){if("min"in e){var n=e.min;it.parameter(n,h),t.minFilter=h[n],wr.indexOf(t.minFilter)>=0&&!("faces"in e)&&(t.genMipmaps=!0)}if("mag"in e){var r=e.mag;it.parameter(r,p),t.magFilter=p[r]}var o=t.wrapS,a=t.wrapT;if("wrap"in e){var s=e.wrap;"string"==typeof s?(it.parameter(s,c),o=a=c[s]):Array.isArray(s)&&(it.parameter(s[0],c),it.parameter(s[1],c),o=c[s[0]],a=c[s[1]])}else{if("wrapS"in e){var u=e.wrapS;it.parameter(u,c),o=c[u]}if("wrapT"in e){var f=e.wrapT;it.parameter(f,c),a=c[f]}}if(t.wrapS=o,t.wrapT=a,"anisotropic"in e){var d=e.anisotropic;it("number"==typeof d&&d>=1&&d<=i.maxAnisotropic,"aniso samples must be between 1 and "),t.anisotropic=e.anisotropic}if("mipmap"in e){var v=!1;switch(typeof e.mipmap){case"string":it.parameter(e.mipmap,l,"invalid mipmap hint"),t.mipmapHint=l[e.mipmap],t.genMipmaps=!0,v=!0;break;case"boolean":v=t.genMipmaps=e.mipmap;break;case"object":it(Array.isArray(e.mipmap),"invalid mipmap type"),t.genMipmaps=!1,v=!0;break;default:it.raise("invalid mipmap type")}v&&!("min"in e)&&(t.minFilter=sr)}}function H(e,n){t.texParameteri(n,ir,e.minFilter),t.texParameteri(n,rr,e.magFilter),t.texParameteri(n,Jn,e.wrapS),t.texParameteri(n,$n,e.wrapT),r.ext_texture_filter_anisotropic&&t.texParameteri(n,vr,e.anisotropic),e.genMipmaps&&(t.hint(pr,e.mipmapHint),t.generateMipmap(n))}var W=0,q={},X=i.maxTextureUnits,Y=Array(X).map((function(){return null}));function K(e){C.call(this),this.mipmask=0,this.internalformat=_n,this.id=W++,this.refCount=1,this.target=e,this.texture=t.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new V,u.profile&&(this.stats={size:0})}function Q(e){t.activeTexture(br),t.bindTexture(e.target,e.texture)}function J(){var e=Y[0];e?t.bindTexture(e.target,e.texture):t.bindTexture(mn,null)}function $(e){var n=e.texture;it(n,"must not double destroy texture");var r=e.unit,i=e.target;r>=0&&(t.activeTexture(br+r),t.bindTexture(i,null),Y[r]=null),t.deleteTexture(n),e.texture=null,e.params=null,e.pixels=null,e.refCount=0,delete q[e.id],s.textureCount--}function tt(e,n){var r=new K(mn);function o(t,e){var n=r.texInfo;V.call(n);var a=j();return"number"==typeof t?Z(a,0|t,"number"==typeof e?0|e:0|t):t?(it.type(t,"object","invalid arguments to regl.texture"),G(n,t),z(a,t)):Z(a,1,1),n.genMipmaps&&(a.mipmask=(a.width<<1)-1),r.mipmask=a.mipmask,T(r,a),it.texture2D(n,a,i),r.internalformat=a.internalformat,o.width=a.width,o.height=a.height,Q(r),F(a,mn),H(n,mn),J(),U(a),u.profile&&(r.stats.size=Jr(r.internalformat,r.type,a.width,a.height,n.genMipmaps,!1)),o.format=_[r.internalformat],o.type=x[r.type],o.mag=b[n.magFilter],o.min=w[n.minFilter],o.wrapS=S[n.wrapS],o.wrapT=S[n.wrapT],o}function a(t,e,n,i){it(!!t,"must specify image data");var a=0|e,s=0|n,u=0|i,l=R();return T(l,r),l.width=0,l.height=0,P(l,t),l.width=l.width||(r.width>>u)-a,l.height=l.height||(r.height>>u)-s,it(r.type===l.type&&r.format===l.format&&r.internalformat===l.internalformat,"incompatible format for texture.subimage"),it(a>=0&&s>=0&&a+l.width<=r.width&&s+l.height<=r.height,"texture.subimage write out of bounds"),it(r.mipmask&1<<u,"missing mipmap data"),it(l.data||l.element||l.needsCopy,"missing image data"),Q(r),L(l,mn,a,s,u),J(),D(l),o}function l(e,n){var i=0|e,a=0|n||i;if(i===r.width&&a===r.height)return o;o.width=r.width=i,o.height=r.height=a,Q(r);for(var s=0;r.mipmask>>s;++s){var l=i>>s,c=a>>s;if(!l||!c)break;t.texImage2D(mn,s,r.format,l,c,0,r.format,r.type,null)}return J(),u.profile&&(r.stats.size=Jr(r.internalformat,r.type,i,a,!1,!1)),o}return q[r.id]=r,s.textureCount++,o(e,n),o.subimage=a,o.resize=l,o._reglType="texture2d",o._texture=r,u.profile&&(o.stats=r.stats),o.destroy=function(){r.decRef()},o}function et(e,n,r,o,a,l){var c=new K(yn);q[c.id]=c,s.cubeCount++;var p=new Array(6);function h(t,e,n,r,o,a){var s,l=c.texInfo;for(V.call(l),s=0;s<6;++s)p[s]=j();if("number"!=typeof t&&t)if("object"==typeof t)if(e)z(p[0],t),z(p[1],e),z(p[2],n),z(p[3],r),z(p[4],o),z(p[5],a);else if(G(l,t),A(c,t),"faces"in t){var f=t.faces;for(it(Array.isArray(f)&&6===f.length,"cube faces must be a length 6 array"),s=0;s<6;++s)it("object"==typeof f[s]&&!!f[s],"invalid input for cube map face"),T(p[s],c),z(p[s],f[s])}else for(s=0;s<6;++s)z(p[s],t);else it.raise("invalid arguments to cube map");else{var d=0|t||1;for(s=0;s<6;++s)Z(p[s],d,d)}for(T(c,p[0]),it.optional((function(){i.npotTextureCube||it(dn(c.width)&&dn(c.height),"your browser does not support non power or two texture dimensions")})),l.genMipmaps?c.mipmask=(p[0].width<<1)-1:c.mipmask=p[0].mipmask,it.textureCube(c,l,p,i),c.internalformat=p[0].internalformat,h.width=p[0].width,h.height=p[0].height,Q(c),s=0;s<6;++s)F(p[s],gn+s);for(H(l,yn),J(),u.profile&&(c.stats.size=Jr(c.internalformat,c.type,h.width,h.height,l.genMipmaps,!0)),h.format=_[c.internalformat],h.type=x[c.type],h.mag=b[l.magFilter],h.min=w[l.minFilter],h.wrapS=S[l.wrapS],h.wrapT=S[l.wrapT],s=0;s<6;++s)U(p[s]);return h}function f(t,e,n,r,i){it(!!e,"must specify image data"),it("number"==typeof t&&t===(0|t)&&t>=0&&t<6,"invalid face");var o=0|n,a=0|r,s=0|i,u=R();return T(u,c),u.width=0,u.height=0,P(u,e),u.width=u.width||(c.width>>s)-o,u.height=u.height||(c.height>>s)-a,it(c.type===u.type&&c.format===u.format&&c.internalformat===u.internalformat,"incompatible format for texture.subimage"),it(o>=0&&a>=0&&o+u.width<=c.width&&a+u.height<=c.height,"texture.subimage write out of bounds"),it(c.mipmask&1<<s,"missing mipmap data"),it(u.data||u.element||u.needsCopy,"missing image data"),Q(c),L(u,gn+t,o,a,s),J(),D(u),h}function d(e){var n=0|e;if(n!==c.width){h.width=c.width=n,h.height=c.height=n,Q(c);for(var r=0;r<6;++r)for(var i=0;c.mipmask>>i;++i)t.texImage2D(gn+r,i,c.format,n>>i,n>>i,0,c.format,c.type,null);return J(),u.profile&&(c.stats.size=Jr(c.internalformat,c.type,h.width,h.height,!1,!0)),h}}return h(e,n,r,o,a,l),h.subimage=f,h.resize=d,h._reglType="textureCube",h._texture=c,u.profile&&(h.stats=c.stats),h.destroy=function(){c.decRef()},h}function nt(){for(var e=0;e<X;++e)t.activeTexture(br+e),t.bindTexture(mn,null),Y[e]=null;Te(q).forEach($),s.cubeCount=0,s.textureCount=0}function rt(){for(var e=0;e<X;++e){var n=Y[e];n&&(n.bindCount=0,n.unit=-1,Y[e]=null)}Te(q).forEach((function(e){e.texture=t.createTexture(),t.bindTexture(e.target,e.texture);for(var n=0;n<32;++n)if(0!=(e.mipmask&1<<n))if(e.target===mn)t.texImage2D(mn,n,e.internalformat,e.width>>n,e.height>>n,0,e.internalformat,e.type,null);else for(var r=0;r<6;++r)t.texImage2D(gn+r,n,e.internalformat,e.width>>n,e.height>>n,0,e.internalformat,e.type,null);H(e.texInfo,e.target)}))}function ot(){for(var e=0;e<X;++e){var n=Y[e];n&&(n.bindCount=0,n.unit=-1,Y[e]=null),t.activeTexture(br+e),t.bindTexture(mn,null),t.bindTexture(yn,null)}}return n(K.prototype,{bind:function(){var e=this;e.bindCount+=1;var n=e.unit;if(n<0){for(var r=0;r<X;++r){var i=Y[r];if(i){if(i.bindCount>0)continue;i.unit=-1}Y[r]=e,n=r;break}n>=X&&it.raise("insufficient number of texture units"),u.profile&&s.maxTextureUnits<n+1&&(s.maxTextureUnits=n+1),e.unit=n,t.activeTexture(br+n),t.bindTexture(e.target,e.texture)}return n},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&$(this)}}),u.profile&&(s.getTotalTextureSize=function(){var t=0;return Object.keys(q).forEach((function(e){t+=q[e].stats.size})),t}),{create2D:tt,createCube:et,clear:nt,getTexture:function(t){return null},restore:rt,refresh:ot}}Rr[En]=2,Rr[Cn]=2,Rr[Tn]=2,Rr[Ln]=4,Rr[Nn]=.5,Rr[Zn]=.5,Rr[zn]=1,Rr[Fn]=1,Rr[Bn]=.5,Rr[jn]=1,Rr[Un]=1,Rr[Vn]=.5,Rr[Gn]=.25,Rr[Hn]=.5,Rr[Wn]=.25,Rr[qn]=.5;var ti=36161,ei=32854,ni=32855,ri=36194,ii=33189,oi=36168,ai=34041,si=35907,ui=34836,li=34842,ci=34843,pi=[];function hi(t,e,n){return pi[t]*e*n}pi[ei]=2,pi[ni]=2,pi[ri]=2,pi[ii]=2,pi[oi]=1,pi[ai]=4,pi[si]=4,pi[ui]=16,pi[li]=8,pi[ci]=6;var fi=function(t,e,n,r,i){var o={rgba4:ei,rgb565:ri,"rgb5 a1":ni,depth:ii,stencil:oi,"depth stencil":ai};e.ext_srgb&&(o.srgba=si),e.ext_color_buffer_half_float&&(o.rgba16f=li,o.rgb16f=ci),e.webgl_color_buffer_float&&(o.rgba32f=ui);var a=[];Object.keys(o).forEach((function(t){var e=o[t];a[e]=t}));var s=0,u={};function l(t){this.id=s++,this.refCount=1,this.renderbuffer=t,this.format=ei,this.width=0,this.height=0,i.profile&&(this.stats={size:0})}function c(e){var n=e.renderbuffer;it(n,"must not double destroy renderbuffer"),t.bindRenderbuffer(ti,null),t.deleteRenderbuffer(n),e.renderbuffer=null,e.refCount=0,delete u[e.id],r.renderbufferCount--}function p(e,s){var c=new l(t.createRenderbuffer());function p(e,r){var s=0,u=0,l=ei;if("object"==typeof e&&e){var h=e;if("shape"in h){var f=h.shape;it(Array.isArray(f)&&f.length>=2,"invalid renderbuffer shape"),s=0|f[0],u=0|f[1]}else"radius"in h&&(s=u=0|h.radius),"width"in h&&(s=0|h.width),"height"in h&&(u=0|h.height);"format"in h&&(it.parameter(h.format,o,"invalid renderbuffer format"),l=o[h.format])}else"number"==typeof e?(s=0|e,u="number"==typeof r?0|r:s):e?it.raise("invalid arguments to renderbuffer constructor"):s=u=1;if(it(s>0&&u>0&&s<=n.maxRenderbufferSize&&u<=n.maxRenderbufferSize,"invalid renderbuffer size"),s!==c.width||u!==c.height||l!==c.format)return p.width=c.width=s,p.height=c.height=u,c.format=l,t.bindRenderbuffer(ti,c.renderbuffer),t.renderbufferStorage(ti,l,s,u),it(0===t.getError(),"invalid render buffer format"),i.profile&&(c.stats.size=hi(c.format,c.width,c.height)),p.format=a[c.format],p}function h(e,r){var o=0|e,a=0|r||o;return o===c.width&&a===c.height||(it(o>0&&a>0&&o<=n.maxRenderbufferSize&&a<=n.maxRenderbufferSize,"invalid renderbuffer size"),p.width=c.width=o,p.height=c.height=a,t.bindRenderbuffer(ti,c.renderbuffer),t.renderbufferStorage(ti,c.format,o,a),it(0===t.getError(),"invalid render buffer format"),i.profile&&(c.stats.size=hi(c.format,c.width,c.height))),p}return u[c.id]=c,r.renderbufferCount++,p(e,s),p.resize=h,p._reglType="renderbuffer",p._renderbuffer=c,i.profile&&(p.stats=c.stats),p.destroy=function(){c.decRef()},p}function h(){Te(u).forEach((function(e){e.renderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(ti,e.renderbuffer),t.renderbufferStorage(ti,e.format,e.width,e.height)})),t.bindRenderbuffer(ti,null)}return l.prototype.decRef=function(){--this.refCount<=0&&c(this)},i.profile&&(r.getTotalRenderbufferSize=function(){var t=0;return Object.keys(u).forEach((function(e){t+=u[e].stats.size})),t}),{create:p,clear:function(){Te(u).forEach(c)},restore:h}},di=36160,vi=36161,mi=3553,yi=34069,gi=36064,_i=36096,xi=36128,bi=33306,wi=36053,Si=36054,Ei=36055,Ci=36057,Ti=36061,Ai=36193,Mi=5121,ki=5126,Pi=6407,Oi=6408,Li=6402,Ii=[Pi,Oi],Ri=[];Ri[Oi]=4,Ri[Pi]=3;var Di=[];Di[Mi]=1,Di[ki]=4,Di[Ai]=2;var Ni=33189,Zi=36168,zi=34041,Fi=[32854,32855,36194,35907,34842,34843,34836],Bi={};function ji(t,e,r,i,o,a){var s={cur:null,next:null,dirty:!1,setFBO:null},u=["rgba"],l=["rgba4","rgb565","rgb5 a1"];e.ext_srgb&&l.push("srgba"),e.ext_color_buffer_half_float&&l.push("rgba16f","rgb16f"),e.webgl_color_buffer_float&&l.push("rgba32f");var c=["uint8"];function p(t,e,n){this.target=t,this.texture=e,this.renderbuffer=n;var r=0,i=0;e?(r=e.width,i=e.height):n&&(r=n.width,i=n.height),this.width=r,this.height=i}function h(t){t&&(t.texture&&t.texture._texture.decRef(),t.renderbuffer&&t.renderbuffer._renderbuffer.decRef())}function f(t,e,n){if(t)if(t.texture){var r=t.texture._texture,i=Math.max(1,r.width),o=Math.max(1,r.height);it(i===e&&o===n,"inconsistent width/height for supplied texture"),r.refCount+=1}else{var a=t.renderbuffer._renderbuffer;it(a.width===e&&a.height===n,"inconsistent width/height for renderbuffer"),a.refCount+=1}}function d(e,n){n&&(n.texture?t.framebufferTexture2D(di,e,n.target,n.texture._texture.texture,0):t.framebufferRenderbuffer(di,e,vi,n.renderbuffer._renderbuffer.renderbuffer))}function v(t){var e=mi,n=null,r=null,i=t;"object"==typeof t&&(i=t.data,"target"in t&&(e=0|t.target)),it.type(i,"function","invalid attachment data");var o=i._reglType;return"texture2d"===o?(n=i,it(e===mi)):"textureCube"===o?(n=i,it(e>=yi&&e<yi+6,"invalid cube map target")):"renderbuffer"===o?(r=i,e=vi):it.raise("invalid regl object for attachment"),new p(e,n,r)}function m(t,e,n,r,a){if(n){var s=i.create2D({width:t,height:e,format:r,type:a});return s._texture.refCount=0,new p(mi,s,null)}var u=o.create({width:t,height:e,format:r});return u._renderbuffer.refCount=0,new p(vi,null,u)}function y(t){return t&&(t.texture||t.renderbuffer)}function g(t,e,n){t&&(t.texture?t.texture.resize(e,n):t.renderbuffer&&t.renderbuffer.resize(e,n),t.width=e,t.height=n)}e.oes_texture_half_float&&c.push("half float","float16"),e.oes_texture_float&&c.push("float","float32");var _=0,x={};function b(){this.id=_++,x[this.id]=this,this.framebuffer=t.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function w(t){t.colorAttachments.forEach(h),h(t.depthAttachment),h(t.stencilAttachment),h(t.depthStencilAttachment)}function S(e){var n=e.framebuffer;it(n,"must not double destroy framebuffer"),t.deleteFramebuffer(n),e.framebuffer=null,a.framebufferCount--,delete x[e.id]}function E(e){var n;t.bindFramebuffer(di,e.framebuffer);var i=e.colorAttachments;for(n=0;n<i.length;++n)d(gi+n,i[n]);for(n=i.length;n<r.maxColorAttachments;++n)t.framebufferTexture2D(di,gi+n,mi,null,0);t.framebufferTexture2D(di,bi,mi,null,0),t.framebufferTexture2D(di,_i,mi,null,0),t.framebufferTexture2D(di,xi,mi,null,0),d(_i,e.depthAttachment),d(xi,e.stencilAttachment),d(bi,e.depthStencilAttachment);var o=t.checkFramebufferStatus(di);t.isContextLost()||o===wi||it.raise("framebuffer configuration not supported, status = "+Bi[o]),t.bindFramebuffer(di,s.next?s.next.framebuffer:null),s.cur=s.next,t.getError()}function C(t,i){var o=new b;function p(t,n){var i;it(s.next!==o,"can not update framebuffer which is currently in use");var a=0,h=0,d=!0,g=!0,_=null,x=!0,b="rgba",S="uint8",C=1,T=null,A=null,M=null,k=!1;if("number"==typeof t)a=0|t,h=0|n||a;else if(t){it.type(t,"object","invalid arguments for framebuffer");var P=t;if("shape"in P){var O=P.shape;it(Array.isArray(O)&&O.length>=2,"invalid shape for framebuffer"),a=O[0],h=O[1]}else"radius"in P&&(a=h=P.radius),"width"in P&&(a=P.width),"height"in P&&(h=P.height);("color"in P||"colors"in P)&&(_=P.color||P.colors,Array.isArray(_)&&it(1===_.length||e.webgl_draw_buffers,"multiple render targets not supported")),_||("colorCount"in P&&(C=0|P.colorCount,it(C>0,"invalid color buffer count")),"colorTexture"in P&&(x=!!P.colorTexture,b="rgba4"),"colorType"in P&&(S=P.colorType,x?(it(e.oes_texture_float||!("float"===S||"float32"===S),"you must enable OES_texture_float in order to use floating point framebuffer objects"),it(e.oes_texture_half_float||!("half float"===S||"float16"===S),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===S||"float16"===S?(it(e.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),b="rgba16f"):"float"!==S&&"float32"!==S||(it(e.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),b="rgba32f"),it.oneOf(S,c,"invalid color type")),"colorFormat"in P&&(b=P.colorFormat,u.indexOf(b)>=0?x=!0:l.indexOf(b)>=0?x=!1:it.optional((function(){x?it.oneOf(P.colorFormat,u,"invalid color format for texture"):it.oneOf(P.colorFormat,l,"invalid color format for renderbuffer")})))),("depthTexture"in P||"depthStencilTexture"in P)&&(k=!(!P.depthTexture&&!P.depthStencilTexture),it(!k||e.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in P&&("boolean"==typeof P.depth?d=P.depth:(T=P.depth,g=!1)),"stencil"in P&&("boolean"==typeof P.stencil?g=P.stencil:(A=P.stencil,d=!1)),"depthStencil"in P&&("boolean"==typeof P.depthStencil?d=g=P.depthStencil:(M=P.depthStencil,d=!1,g=!1))}else a=h=1;var L=null,I=null,R=null,D=null;if(Array.isArray(_))L=_.map(v);else if(_)L=[v(_)];else for(L=new Array(C),i=0;i<C;++i)L[i]=m(a,h,x,b,S);it(e.webgl_draw_buffers||L.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),it(L.length<=r.maxColorAttachments,"too many color attachments, not supported"),a=a||L[0].width,h=h||L[0].height,T?I=v(T):d&&!g&&(I=m(a,h,k,"depth","uint32")),A?R=v(A):g&&!d&&(R=m(a,h,!1,"stencil","uint8")),M?D=v(M):!T&&!A&&g&&d&&(D=m(a,h,k,"depth stencil","depth stencil")),it(!!T+!!A+!!M<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var N=null;for(i=0;i<L.length;++i)if(f(L[i],a,h),it(!L[i]||L[i].texture&&Ii.indexOf(L[i].texture._texture.format)>=0||L[i].renderbuffer&&Fi.indexOf(L[i].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+i+" is invalid"),L[i]&&L[i].texture){var Z=Ri[L[i].texture._texture.format]*Di[L[i].texture._texture.type];null===N?N=Z:it(N===Z,"all color attachments much have the same number of bits per pixel.")}return f(I,a,h),it(!I||I.texture&&I.texture._texture.format===Li||I.renderbuffer&&I.renderbuffer._renderbuffer.format===Ni,"invalid depth attachment for framebuffer object"),f(R,a,h),it(!R||R.renderbuffer&&R.renderbuffer._renderbuffer.format===Zi,"invalid stencil attachment for framebuffer object"),f(D,a,h),it(!D||D.texture&&D.texture._texture.format===zi||D.renderbuffer&&D.renderbuffer._renderbuffer.format===zi,"invalid depth-stencil attachment for framebuffer object"),w(o),o.width=a,o.height=h,o.colorAttachments=L,o.depthAttachment=I,o.stencilAttachment=R,o.depthStencilAttachment=D,p.color=L.map(y),p.depth=y(I),p.stencil=y(R),p.depthStencil=y(D),p.width=o.width,p.height=o.height,E(o),p}function h(t,e){it(s.next!==o,"can not resize a framebuffer which is currently in use");var n=Math.max(0|t,1),r=Math.max(0|e||n,1);if(n===o.width&&r===o.height)return p;for(var i=o.colorAttachments,a=0;a<i.length;++a)g(i[a],n,r);return g(o.depthAttachment,n,r),g(o.stencilAttachment,n,r),g(o.depthStencilAttachment,n,r),o.width=p.width=n,o.height=p.height=r,E(o),p}return a.framebufferCount++,p(t,i),n(p,{resize:h,_reglType:"framebuffer",_framebuffer:o,destroy:function(){S(o),w(o)},use:function(t){s.setFBO({framebuffer:p},t)}})}function T(t){var o=Array(6);function a(t){var r;it(o.indexOf(s.next)<0,"can not update framebuffer which is currently in use");var l,p={color:null},h=0,f=null,d="rgba",v="uint8",m=1;if("number"==typeof t)h=0|t;else if(t){it.type(t,"object","invalid arguments for framebuffer");var y=t;if("shape"in y){var g=y.shape;it(Array.isArray(g)&&g.length>=2,"invalid shape for framebuffer"),it(g[0]===g[1],"cube framebuffer must be square"),h=g[0]}else"radius"in y&&(h=0|y.radius),"width"in y?(h=0|y.width,"height"in y&&it(y.height===h,"must be square")):"height"in y&&(h=0|y.height);("color"in y||"colors"in y)&&(f=y.color||y.colors,Array.isArray(f)&&it(1===f.length||e.webgl_draw_buffers,"multiple render targets not supported")),f||("colorCount"in y&&(m=0|y.colorCount,it(m>0,"invalid color buffer count")),"colorType"in y&&(it.oneOf(y.colorType,c,"invalid color type"),v=y.colorType),"colorFormat"in y&&(d=y.colorFormat,it.oneOf(y.colorFormat,u,"invalid color format for texture"))),"depth"in y&&(p.depth=y.depth),"stencil"in y&&(p.stencil=y.stencil),"depthStencil"in y&&(p.depthStencil=y.depthStencil)}else h=1;if(f)if(Array.isArray(f))for(l=[],r=0;r<f.length;++r)l[r]=f[r];else l=[f];else{l=Array(m);var _={radius:h,format:d,type:v};for(r=0;r<m;++r)l[r]=i.createCube(_)}for(p.color=Array(l.length),r=0;r<l.length;++r){var x=l[r];it("function"==typeof x&&"textureCube"===x._reglType,"invalid cube map"),h=h||x.width,it(x.width===h&&x.height===h,"invalid cube map shape"),p.color[r]={target:yi,data:l[r]}}for(r=0;r<6;++r){for(var b=0;b<l.length;++b)p.color[b].target=yi+r;r>0&&(p.depth=o[0].depth,p.stencil=o[0].stencil,p.depthStencil=o[0].depthStencil),o[r]?o[r](p):o[r]=C(p)}return n(a,{width:h,height:h,color:l})}function l(t){var e,n=0|t;if(it(n>0&&n<=r.maxCubeMapSize,"invalid radius for cube fbo"),n===a.width)return a;var i=a.color;for(e=0;e<i.length;++e)i[e].resize(n);for(e=0;e<6;++e)o[e].resize(n);return a.width=a.height=n,a}return a(t),n(a,{faces:o,resize:l,_reglType:"framebufferCube",destroy:function(){o.forEach((function(t){t.destroy()}))}})}function A(){s.cur=null,s.next=null,s.dirty=!0,Te(x).forEach((function(e){e.framebuffer=t.createFramebuffer(),E(e)}))}return n(s,{getFramebuffer:function(t){if("function"==typeof t&&"framebuffer"===t._reglType){var e=t._framebuffer;if(e instanceof b)return e}return null},create:C,createCube:T,clear:function(){Te(x).forEach(S)},restore:A})}Bi[wi]="complete",Bi[Si]="incomplete attachment",Bi[Ci]="incomplete dimensions",Bi[Ei]="incomplete, missing attachment",Bi[Ti]="unsupported";var Ui=5126,Vi=34962,Gi=34963,Hi=["attributes","elements","offset","count","primitive","instances"];function Wi(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Ui,this.offset=0,this.stride=0,this.divisor=0}function qi(t,n,r,i,o,a,s){for(var u=r.maxAttributes,l=new Array(u),c=0;c<u;++c)l[c]=new Wi;var p=0,h={},f={Record:Wi,scope:{},state:l,currentVAO:null,targetVAO:null,restore:v()?w:function(){},createVAO:S,getVAO:y,destroyBuffer:d,setVAO:v()?g:_,clear:v()?x:function(){}};function d(e){for(var n=0;n<l.length;++n){var r=l[n];r.buffer===e&&(t.disableVertexAttribArray(n),r.buffer=null)}}function v(){return n.oes_vertex_array_object}function m(){return n.angle_instanced_arrays}function y(t){return"function"==typeof t&&t._vao?t._vao:null}function g(t){if(t!==f.currentVAO){var e=v();t?e.bindVertexArrayOES(t.vao):e.bindVertexArrayOES(null),f.currentVAO=t}}function _(e){if(e!==f.currentVAO){if(e)e.bindAttrs();else{for(var n=m(),r=0;r<l.length;++r){var i=l[r];i.buffer?(t.enableVertexAttribArray(r),i.buffer.bind(),t.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offfset),n&&i.divisor&&n.vertexAttribDivisorANGLE(r,i.divisor)):(t.disableVertexAttribArray(r),t.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}s.elements?t.bindBuffer(Gi,s.elements.buffer.buffer):t.bindBuffer(Gi,null)}f.currentVAO=e}}function x(){Te(h).forEach((function(t){t.destroy()}))}function b(){this.id=++p,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var t=v();this.vao=t?t.createVertexArrayOES():null,h[this.id]=this,this.buffers=[]}function w(){v()&&Te(h).forEach((function(t){t.refresh()}))}function S(t){var r=new b;function s(t){var i;if(Array.isArray(t))i=t,r.elements&&r.ownsElements&&r.elements.destroy(),r.elements=null,r.ownsElements=!1,r.offset=0,r.count=0,r.instances=-1,r.primitive=4;else{if(it("object"==typeof t,"invalid arguments for create vao"),it("attributes"in t,"must specify attributes for vao"),t.elements){var l=t.elements;r.ownsElements?"function"==typeof l&&"elements"===l._reglType?(r.elements.destroy(),r.ownsElements=!1):(r.elements(l),r.ownsElements=!1):a.getElements(t.elements)?(r.elements=t.elements,r.ownsElements=!1):(r.elements=a.create(t.elements),r.ownsElements=!0)}else r.elements=null,r.ownsElements=!1;i=t.attributes,r.offset=0,r.count=-1,r.instances=-1,r.primitive=4,r.elements&&(r.count=r.elements._elements.vertCount,r.primitive=r.elements._elements.primType),"offset"in t&&(r.offset=0|t.offset),"count"in t&&(r.count=0|t.count),"instances"in t&&(r.instances=0|t.instances),"primitive"in t&&(it(t.primitive in Xe,"bad primitive type: "+t.primitive),r.primitive=Xe[t.primitive]),it.optional((function(){for(var e=Object.keys(t),n=0;n<e.length;++n)it(Hi.indexOf(e[n])>=0,'invalid option for vao: "'+e[n]+'" valid options are '+Hi)})),it(Array.isArray(i),"attributes must be an array")}it(i.length<u,"too many attributes"),it(i.length>0,"must specify at least one attribute");var c={},p=r.attributes;p.length=i.length;for(var h=0;h<i.length;++h){var f,d=i[h],v=p[h]=new Wi,m=d.data||d;Array.isArray(m)||e(m)||Ce(m)?(r.buffers[h]&&(f=r.buffers[h],e(m)&&f._buffer.byteLength>=m.byteLength?f.subdata(m):(f.destroy(),r.buffers[h]=null)),r.buffers[h]||(f=r.buffers[h]=o.create(d,Vi,!1,!0)),v.buffer=o.getBuffer(f),v.size=0|v.buffer.dimension,v.normalized=!1,v.type=v.buffer.dtype,v.offset=0,v.stride=0,v.divisor=0,v.state=1,c[h]=1):o.getBuffer(d)?(v.buffer=o.getBuffer(d),v.size=0|v.buffer.dimension,v.normalized=!1,v.type=v.buffer.dtype,v.offset=0,v.stride=0,v.divisor=0,v.state=1):o.getBuffer(d.buffer)?(v.buffer=o.getBuffer(d.buffer),v.size=0|(+d.size||v.buffer.dimension),v.normalized=!!d.normalized||!1,"type"in d?(it.parameter(d.type,De,"invalid buffer type"),v.type=De[d.type]):v.type=v.buffer.dtype,v.offset=0|(d.offset||0),v.stride=0|(d.stride||0),v.divisor=0|(d.divisor||0),v.state=1,it(v.size>=1&&v.size<=4,"size must be between 1 and 4"),it(v.offset>=0,"invalid offset"),it(v.stride>=0&&v.stride<=255,"stride must be between 0 and 255"),it(v.divisor>=0,"divisor must be positive"),it(!v.divisor||!!n.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in d?(it(h>0,"first attribute must not be a constant"),v.x=+d.x||0,v.y=+d.y||0,v.z=+d.z||0,v.w=+d.w||0,v.state=2):it(!1,"invalid attribute spec for location "+h)}for(var y=0;y<r.buffers.length;++y)!c[y]&&r.buffers[y]&&(r.buffers[y].destroy(),r.buffers[y]=null);return r.refresh(),s}return i.vaoCount+=1,s.destroy=function(){for(var t=0;t<r.buffers.length;++t)r.buffers[t]&&r.buffers[t].destroy();r.buffers.length=0,r.ownsElements&&(r.elements.destroy(),r.elements=null,r.ownsElements=!1),r.destroy()},s._vao=r,s._reglType="vao",s(t)}return b.prototype.bindAttrs=function(){for(var e=m(),n=this.attributes,r=0;r<n.length;++r){var i=n[r];i.buffer?(t.enableVertexAttribArray(r),t.bindBuffer(Vi,i.buffer.buffer),t.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offset),e&&i.divisor&&e.vertexAttribDivisorANGLE(r,i.divisor)):(t.disableVertexAttribArray(r),t.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}for(var o=n.length;o<u;++o)t.disableVertexAttribArray(o);var s=a.getElements(this.elements);s?t.bindBuffer(Gi,s.buffer.buffer):t.bindBuffer(Gi,null)},b.prototype.refresh=function(){var t=v();t&&(t.bindVertexArrayOES(this.vao),this.bindAttrs(),f.currentVAO=null,t.bindVertexArrayOES(null))},b.prototype.destroy=function(){if(this.vao){var t=v();this===f.currentVAO&&(f.currentVAO=null,t.bindVertexArrayOES(null)),t.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),h[this.id]&&(delete h[this.id],i.vaoCount-=1)},f}var Xi=35632,Yi=35633,Ki=35718,Qi=35721;function Ji(t,e,r,i){var o={},a={};function s(t,e,n,r){this.name=t,this.id=e,this.location=n,this.info=r}function u(t,e){for(var n=0;n<t.length;++n)if(t[n].id===e.id)return void(t[n].location=e.location);t.push(e)}function l(n,r,i){var s=n===Xi?o:a,u=s[r];if(!u){var l=e.str(r);u=t.createShader(n),t.shaderSource(u,l),t.compileShader(u),it.shaderError(t,u,l,n,i),s[r]=u}return u}var c={},p=[],h=0;function f(t,e){this.id=h++,this.fragId=t,this.vertId=e,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,i.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function d(n,r,o){var a,c,p=l(Xi,n.fragId),h=l(Yi,n.vertId),f=n.program=t.createProgram();if(t.attachShader(f,p),t.attachShader(f,h),o)for(a=0;a<o.length;++a){var d=o[a];t.bindAttribLocation(f,d[0],d[1])}t.linkProgram(f),it.linkError(t,f,e.str(n.fragId),e.str(n.vertId),r);var v=t.getProgramParameter(f,Ki);i.profile&&(n.stats.uniformsCount=v);var m=n.uniforms;for(a=0;a<v;++a)if(c=t.getActiveUniform(f,a))if(c.size>1)for(var y=0;y<c.size;++y){var g=c.name.replace("[0]","["+y+"]");u(m,new s(g,e.id(g),t.getUniformLocation(f,g),c))}else u(m,new s(c.name,e.id(c.name),t.getUniformLocation(f,c.name),c));var _=t.getProgramParameter(f,Qi);i.profile&&(n.stats.attributesCount=_);var x=n.attributes;for(a=0;a<_;++a)(c=t.getActiveAttrib(f,a))&&u(x,new s(c.name,e.id(c.name),t.getAttribLocation(f,c.name),c))}function v(){o={},a={};for(var t=0;t<p.length;++t)d(p[t],null,p[t].attributes.map((function(t){return[t.location,t.name]})))}return i.profile&&(r.getMaxUniformsCount=function(){var t=0;return p.forEach((function(e){e.stats.uniformsCount>t&&(t=e.stats.uniformsCount)})),t},r.getMaxAttributesCount=function(){var t=0;return p.forEach((function(e){e.stats.attributesCount>t&&(t=e.stats.attributesCount)})),t}),{clear:function(){var e=t.deleteShader.bind(t);Te(o).forEach(e),o={},Te(a).forEach(e),a={},p.forEach((function(e){t.deleteProgram(e.program)})),p.length=0,c={},r.shaderCount=0},program:function(e,i,s,u){it.command(e>=0,"missing vertex shader",s),it.command(i>=0,"missing fragment shader",s);var l=c[i];l||(l=c[i]={});var h=l[e];if(h&&(h.refCount++,!u))return h;var v=new f(i,e);return r.shaderCount++,d(v,s,u),h||(l[e]=v),p.push(v),n(v,{destroy:function(){if(v.refCount--,v.refCount<=0){t.deleteProgram(v.program);var e=p.indexOf(v);p.splice(e,1),r.shaderCount--}l[v.vertId].refCount<=0&&(t.deleteShader(a[v.vertId]),delete a[v.vertId],delete c[v.fragId][v.vertId]),Object.keys(c[v.fragId]).length||(t.deleteShader(o[v.fragId]),delete o[v.fragId],delete c[v.fragId])}})},restore:v,shader:l,frag:-1,vert:-1}}var $i=6408,to=5121,eo=3333,no=5126;function ro(t,n,r,i,o,a,s){function u(u){var l;null===n.next?(it(o.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),l=to):(it(null!==n.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),l=n.next.colorAttachments[0].texture._texture.type,it.optional((function(){a.oes_texture_float?(it(l===to||l===no,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),l===no&&it(s.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):it(l===to,"Reading from a framebuffer is only allowed for the type 'uint8'")})));var c=0,p=0,h=i.framebufferWidth,f=i.framebufferHeight,d=null;e(u)?d=u:u&&(it.type(u,"object","invalid arguments to regl.read()"),c=0|u.x,p=0|u.y,it(c>=0&&c<i.framebufferWidth,"invalid x offset for regl.read"),it(p>=0&&p<i.framebufferHeight,"invalid y offset for regl.read"),h=0|(u.width||i.framebufferWidth-c),f=0|(u.height||i.framebufferHeight-p),d=u.data||null),d&&(l===to?it(d instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):l===no&&it(d instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),it(h>0&&h+c<=i.framebufferWidth,"invalid width for read pixels"),it(f>0&&f+p<=i.framebufferHeight,"invalid height for read pixels"),r();var v=h*f*4;return d||(l===to?d=new Uint8Array(v):l===no&&(d=d||new Float32Array(v))),it.isTypedArray(d,"data buffer for regl.read() must be a typedarray"),it(d.byteLength>=v,"data buffer for regl.read() too small"),t.pixelStorei(eo,4),t.readPixels(c,p,h,f,$i,l,d),d}function l(t){var e;return n.setFBO({framebuffer:t.framebuffer},(function(){e=u(t)})),e}function c(t){return t&&"framebuffer"in t?l(t):u(t)}return c}function io(t){return Array.prototype.slice.call(t)}function oo(t){return io(t).join("")}function ao(){var e=0,r=[],i=[];function o(t){for(var n=0;n<i.length;++n)if(i[n]===t)return r[n];var o="g"+e++;return r.push(o),i.push(t),o}function a(){var t=[];function r(){t.push.apply(t,io(arguments))}var i=[];function o(){var n="v"+e++;return i.push(n),arguments.length>0&&(t.push(n,"="),t.push.apply(t,io(arguments)),t.push(";")),n}return n(r,{def:o,toString:function(){return oo([i.length>0?"var "+i.join(",")+";":"",oo(t)])}})}function s(){var t=a(),e=a(),r=t.toString,i=e.toString;function o(n,r){e(n,r,"=",t.def(n,r),";")}return n((function(){t.apply(t,io(arguments))}),{def:t.def,entry:t,exit:e,save:o,set:function(e,n,r){o(e,n),t(e,n,"=",r,";")},toString:function(){return r()+i()}})}function u(){var t=oo(arguments),e=s(),r=s(),i=e.toString,o=r.toString;return n(e,{then:function(){return e.apply(e,io(arguments)),this},else:function(){return r.apply(r,io(arguments)),this},toString:function(){var e=o();return e&&(e="else{"+e+"}"),oo(["if(",t,"){",i(),"}",e])}})}var l=a(),c={};function p(t,e){var r=[];function i(){var t="a"+r.length;return r.push(t),t}e=e||0;for(var o=0;o<e;++o)i();var a=s(),u=a.toString;return c[t]=n(a,{arg:i,toString:function(){return oo(["function(",r.join(),"){",u(),"}"])}})}function h(){var e=['"use strict";',l,"return {"];Object.keys(c).forEach((function(t){e.push('"',t,'":',c[t].toString(),",")})),e.push("}");var n=oo(e).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return("undefined"!=typeof my&&my&&"function"==typeof my.showToast&&!0!==my.isFRM?t.Function.apply(null,r.concat(n)):Function.apply(null,r.concat(n))).apply(null,i)}return{global:l,link:o,block:a,proc:p,scope:s,cond:u,compile:h}}var so="xyzw".split(""),uo=5121,lo=1,co=2,po=0,ho=1,fo=2,vo=3,mo=4,yo=5,go=6,_o="dither",xo="blend.enable",bo="blend.color",wo="blend.equation",So="blend.func",Eo="depth.enable",Co="depth.func",To="depth.range",Ao="depth.mask",Mo="colorMask",ko="cull.enable",Po="cull.face",Oo="frontFace",Lo="lineWidth",Io="polygonOffset.enable",Ro="polygonOffset.offset",Do="sample.alpha",No="sample.enable",Zo="sample.coverage",zo="stencil.enable",Fo="stencil.mask",Bo="stencil.func",jo="stencil.opFront",Uo="stencil.opBack",Vo="scissor.enable",Go="scissor.box",Ho="viewport",Wo="profile",qo="framebuffer",Xo="vert",Yo="frag",Ko="elements",Qo="primitive",Jo="count",$o="offset",ta="instances",ea="vao",na="Width",ra="Height",ia=qo+na,oa=qo+ra,aa=Ho+na,sa=Ho+ra,ua="drawingBuffer",la=ua+na,ca=ua+ra,pa=[So,wo,Bo,jo,Uo,Zo,Ho,Go,Ro],ha=34962,fa=34963,da=3553,va=34067,ma=2884,ya=3042,ga=3024,_a=2960,xa=2929,ba=3089,wa=32823,Sa=32926,Ea=32928,Ca=5126,Ta=35664,Aa=35665,Ma=35666,ka=5124,Pa=35667,Oa=35668,La=35669,Ia=35670,Ra=35671,Da=35672,Na=35673,Za=35674,za=35675,Fa=35676,Ba=35678,ja=35680,Ua=4,Va=1028,Ga=1029,Ha=2304,Wa=2305,qa=32775,Xa=32776,Ya=519,Ka=7680,Qa=0,Ja=1,$a=32774,ts=513,es=36160,ns=36064,rs={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},is=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],os={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},as={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},ss={frag:35632,vert:35633},us={cw:Ha,ccw:Wa};function ls(t){return Array.isArray(t)||e(t)||Ce(t)}function cs(t){return t.sort((function(t,e){return t===Ho?-1:e===Ho?1:t<e?-1:1}))}function ps(t,e,n,r){this.thisDep=t,this.contextDep=e,this.propDep=n,this.append=r}function hs(t){return t&&!(t.thisDep||t.contextDep||t.propDep)}function fs(t){return new ps(!1,!1,!1,t)}function ds(t,e){var n=t.type;if(n===po){var r=t.data.length;return new ps(!0,r>=1,r>=2,e)}if(n===mo){var i=t.data;return new ps(i.thisDep,i.contextDep,i.propDep,e)}if(n===yo)return new ps(!1,!1,!1,e);if(n===go){for(var o=!1,a=!1,s=!1,u=0;u<t.data.length;++u){var l=t.data[u];if(l.type===ho)s=!0;else if(l.type===fo)a=!0;else if(l.type===vo)o=!0;else if(l.type===po){o=!0;var c=l.data;c>=1&&(a=!0),c>=2&&(s=!0)}else l.type===mo&&(o=o||l.data.thisDep,a=a||l.data.contextDep,s=s||l.data.propDep)}return new ps(o,a,s,e)}return new ps(n===vo,n===fo,n===ho,e)}var vs=new ps(!1,!1,!1,(function(){}));function ms(t,e,r,i,o,a,s,u,l,c,p,h,f,d,v){var m=c.Record,y={add:32774,subtract:32778,"reverse subtract":32779};r.ext_blend_minmax&&(y.min=qa,y.max=Xa);var g=r.angle_instanced_arrays,_=r.webgl_draw_buffers,x=r.oes_vertex_array_object,b={dirty:!0,profile:v.profile},w={},S=[],E={},C={};function T(t){return t.replace(".","_")}function A(t,e,n){var r=T(t);S.push(t),w[r]=b[r]=!!n,E[r]=e}function M(t,e,n){var r=T(t);S.push(t),Array.isArray(n)?(b[r]=n.slice(),w[r]=n.slice()):b[r]=w[r]=n,C[r]=e}A(_o,ga),A(xo,ya),M(bo,"blendColor",[0,0,0,0]),M(wo,"blendEquationSeparate",[$a,$a]),M(So,"blendFuncSeparate",[Ja,Qa,Ja,Qa]),A(Eo,xa,!0),M(Co,"depthFunc",ts),M(To,"depthRange",[0,1]),M(Ao,"depthMask",!0),M(Mo,Mo,[!0,!0,!0,!0]),A(ko,ma),M(Po,"cullFace",Ga),M(Oo,Oo,Wa),M(Lo,Lo,1),A(Io,wa),M(Ro,"polygonOffset",[0,0]),A(Do,Sa),A(No,Ea),M(Zo,"sampleCoverage",[1,!1]),A(zo,_a),M(Fo,"stencilMask",-1),M(Bo,"stencilFunc",[Ya,0,-1]),M(jo,"stencilOpSeparate",[Va,Ka,Ka,Ka]),M(Uo,"stencilOpSeparate",[Ga,Ka,Ka,Ka]),A(Vo,ba),M(Go,"scissor",[0,0,t.drawingBufferWidth,t.drawingBufferHeight]),M(Ho,Ho,[0,0,t.drawingBufferWidth,t.drawingBufferHeight]);var k={gl:t,context:f,strings:e,next:w,current:b,draw:h,elements:a,buffer:o,shader:p,attributes:c.state,vao:c,uniforms:l,framebuffer:u,extensions:r,timer:d,isBufferArgs:ls},P={primTypes:Xe,compareFuncs:os,blendFuncs:rs,blendEquations:y,stencilOps:as,glTypes:De,orientationType:us};it.optional((function(){k.isArrayLike=fn})),_&&(P.backBuffer=[Ga],P.drawBuffer=Mt(i.maxDrawbuffers,(function(t){return 0===t?[0]:Mt(t,(function(t){return ns+t}))})));var O=0;function L(){var t=ao(),n=t.link,r=t.global;t.id=O++,t.batchId="0";var i=n(k),o=t.shared={props:"a0"};Object.keys(k).forEach((function(t){o[t]=r.def(i,".",t)})),it.optional((function(){t.CHECK=n(it),t.commandStr=it.guessCommand(),t.command=n(t.commandStr),t.assert=function(t,e,r){t("if(!(",e,"))",this.CHECK,".commandRaise(",n(r),",",this.command,");")},P.invalidBlendCombinations=is}));var a=t.next={},s=t.current={};Object.keys(C).forEach((function(t){Array.isArray(b[t])&&(a[t]=r.def(o.next,".",t),s[t]=r.def(o.current,".",t))}));var u=t.constants={};Object.keys(P).forEach((function(t){u[t]=r.def(JSON.stringify(P[t]))})),t.invoke=function(e,r){switch(r.type){case po:var i=["this",o.context,o.props,t.batchId];return e.def(n(r.data),".call(",i.slice(0,Math.max(r.data.length+1,4)),")");case ho:return e.def(o.props,r.data);case fo:return e.def(o.context,r.data);case vo:return e.def("this",r.data);case mo:return r.data.append(t,e),r.data.ref;case yo:return r.data.toString();case go:return r.data.map((function(n){return t.invoke(e,n)}))}},t.attribCache={};var l={};return t.scopeAttrib=function(t){var r=e.id(t);if(r in l)return l[r];var i=c.scope[r];return i||(i=c.scope[r]=new m),l[r]=n(i)},t}function I(t){var e,n=t.static,r=t.dynamic;if(Wo in n){var i=!!n[Wo];(e=fs((function(t,e){return i}))).enable=i}else if(Wo in r){var o=r[Wo];e=ds(o,(function(t,e){return t.invoke(e,o)}))}return e}function R(t,e){var n=t.static,r=t.dynamic;if(qo in n){var i=n[qo];return i?(i=u.getFramebuffer(i),it.command(i,"invalid framebuffer object"),fs((function(t,e){var n=t.link(i),r=t.shared;e.set(r.framebuffer,".next",n);var o=r.context;return e.set(o,"."+ia,n+".width"),e.set(o,"."+oa,n+".height"),n}))):fs((function(t,e){var n=t.shared;e.set(n.framebuffer,".next","null");var r=n.context;return e.set(r,"."+ia,r+"."+la),e.set(r,"."+oa,r+"."+ca),"null"}))}if(qo in r){var o=r[qo];return ds(o,(function(t,e){var n=t.invoke(e,o),r=t.shared,i=r.framebuffer,a=e.def(i,".getFramebuffer(",n,")");it.optional((function(){t.assert(e,"!"+n+"||"+a,"invalid framebuffer object")})),e.set(i,".next",a);var s=r.context;return e.set(s,"."+ia,a+"?"+a+".width:"+s+"."+la),e.set(s,"."+oa,a+"?"+a+".height:"+s+"."+ca),a}))}return null}function D(t,e,n){var r=t.static,i=t.dynamic;function o(t){if(t in r){var o=r[t];it.commandType(o,"object","invalid "+t,n.commandStr);var a,s,u=!0,l=0|o.x,c=0|o.y;return"width"in o?(a=0|o.width,it.command(a>=0,"invalid "+t,n.commandStr)):u=!1,"height"in o?(s=0|o.height,it.command(s>=0,"invalid "+t,n.commandStr)):u=!1,new ps(!u&&e&&e.thisDep,!u&&e&&e.contextDep,!u&&e&&e.propDep,(function(t,e){var n=t.shared.context,r=a;"width"in o||(r=e.def(n,".",ia,"-",l));var i=s;return"height"in o||(i=e.def(n,".",oa,"-",c)),[l,c,r,i]}))}if(t in i){var p=i[t],h=ds(p,(function(e,n){var r=e.invoke(n,p);it.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+t)}));var i=e.shared.context,o=n.def(r,".x|0"),a=n.def(r,".y|0"),s=n.def('"width" in ',r,"?",r,".width|0:","(",i,".",ia,"-",o,")"),u=n.def('"height" in ',r,"?",r,".height|0:","(",i,".",oa,"-",a,")");return it.optional((function(){e.assert(n,s+">=0&&"+u+">=0","invalid "+t)})),[o,a,s,u]}));return e&&(h.thisDep=h.thisDep||e.thisDep,h.contextDep=h.contextDep||e.contextDep,h.propDep=h.propDep||e.propDep),h}return e?new ps(e.thisDep,e.contextDep,e.propDep,(function(t,e){var n=t.shared.context;return[0,0,e.def(n,".",ia),e.def(n,".",oa)]})):null}var a=o(Ho);if(a){var s=a;a=new ps(a.thisDep,a.contextDep,a.propDep,(function(t,e){var n=s.append(t,e),r=t.shared.context;return e.set(r,"."+aa,n[2]),e.set(r,"."+sa,n[3]),n}))}return{viewport:a,scissor_box:o(Go)}}function N(t,e){var n=t.static;if("string"==typeof n[Yo]&&"string"==typeof n[Xo]){if(Object.keys(e.dynamic).length>0)return null;var r=e.static,i=Object.keys(r);if(i.length>0&&"number"==typeof r[i[0]]){for(var o=[],a=0;a<i.length;++a)it("number"==typeof r[i[a]],"must specify all vertex attribute locations when using vaos"),o.push([0|r[i[a]],i[a]]);return o}}return null}function Z(t,n,r){var i=t.static,o=t.dynamic;function a(t){if(t in i){var n=e.id(i[t]);it.optional((function(){p.shader(ss[t],n,it.guessCommand())}));var r=fs((function(){return n}));return r.id=n,r}if(t in o){var a=o[t];return ds(a,(function(e,n){var r=e.invoke(n,a),i=n.def(e.shared.strings,".id(",r,")");return it.optional((function(){n(e.shared.shader,".shader(",ss[t],",",i,",",e.command,");")})),i}))}return null}var s,u=a(Yo),l=a(Xo),c=null;return hs(u)&&hs(l)?(c=p.program(l.id,u.id,null,r),s=fs((function(t,e){return t.link(c)}))):s=new ps(u&&u.thisDep||l&&l.thisDep,u&&u.contextDep||l&&l.contextDep,u&&u.propDep||l&&l.propDep,(function(t,e){var n,r=t.shared.shader;n=u?u.append(t,e):e.def(r,".",Yo);var i=r+".program("+(l?l.append(t,e):e.def(r,".",Xo))+","+n;return it.optional((function(){i+=","+t.command})),e.def(i+")")})),{frag:u,vert:l,progVar:s,program:c}}function z(t,e){var n=t.static,r=t.dynamic,i={},o=!1;function s(){if(ea in n){var t=n[ea];return null!==t&&null===c.getVAO(t)&&(t=c.createVAO(t)),o=!0,i.vao=t,fs((function(e){var n=c.getVAO(t);return n?e.link(n):"null"}))}if(ea in r){o=!0;var e=r[ea];return ds(e,(function(t,n){var r=t.invoke(n,e);return n.def(t.shared.vao+".getVAO("+r+")")}))}return null}var u=s(),l=!1;function p(){if(Ko in n){var t=n[Ko];if(i.elements=t,ls(t)){var s=i.elements=a.create(t,!0);t=a.getElements(s),l=!0}else t&&(t=a.getElements(t),l=!0,it.command(t,"invalid elements",e.commandStr));var c=fs((function(e,n){if(t){var r=e.link(t);return e.ELEMENTS=r,r}return e.ELEMENTS=null,null}));return c.value=t,c}if(Ko in r){l=!0;var p=r[Ko];return ds(p,(function(t,e){var n=t.shared,r=n.isBufferArgs,i=n.elements,o=t.invoke(e,p),a=e.def("null"),s=e.def(r,"(",o,")"),u=t.cond(s).then(a,"=",i,".createStream(",o,");").else(a,"=",i,".getElements(",o,");");return it.optional((function(){t.assert(u.else,"!"+o+"||"+a,"invalid elements")})),e.entry(u),e.exit(t.cond(s).then(i,".destroyStream(",a,");")),t.ELEMENTS=a,a}))}return o?new ps(u.thisDep,u.contextDep,u.propDep,(function(t,e){return e.def(t.shared.vao+".currentVAO?"+t.shared.elements+".getElements("+t.shared.vao+".currentVAO.elements):null")})):null}var h=p();function f(){if(Qo in n){var t=n[Qo];return i.primitive=t,it.commandParameter(t,Xe,"invalid primitve",e.commandStr),fs((function(e,n){return Xe[t]}))}if(Qo in r){var a=r[Qo];return ds(a,(function(t,e){var n=t.constants.primTypes,r=t.invoke(e,a);return it.optional((function(){t.assert(e,r+" in "+n,"invalid primitive, must be one of "+Object.keys(Xe))})),e.def(n,"[",r,"]")}))}return l?hs(h)?h.value?fs((function(t,e){return e.def(t.ELEMENTS,".primType")})):fs((function(){return Ua})):new ps(h.thisDep,h.contextDep,h.propDep,(function(t,e){var n=t.ELEMENTS;return e.def(n,"?",n,".primType:",Ua)})):o?new ps(u.thisDep,u.contextDep,u.propDep,(function(t,e){return e.def(t.shared.vao+".currentVAO?"+t.shared.vao+".currentVAO.primitive:"+Ua)})):null}function d(t,a){if(t in n){var s=0|n[t];return a?i.offset=s:i.instances=s,it.command(!a||s>=0,"invalid "+t,e.commandStr),fs((function(t,e){return a&&(t.OFFSET=s),s}))}if(t in r){var c=r[t];return ds(c,(function(e,n){var r=e.invoke(n,c);return a&&(e.OFFSET=r,it.optional((function(){e.assert(n,r+">=0","invalid "+t)}))),r}))}if(a){if(l)return fs((function(t,e){return t.OFFSET=0,0}));if(o)return new ps(u.thisDep,u.contextDep,u.propDep,(function(t,e){return e.def(t.shared.vao+".currentVAO?"+t.shared.vao+".currentVAO.offset:0")}))}else if(o)return new ps(u.thisDep,u.contextDep,u.propDep,(function(t,e){return e.def(t.shared.vao+".currentVAO?"+t.shared.vao+".currentVAO.instances:-1")}));return null}var v=d($o,!0);function m(){if(Jo in n){var t=0|n[Jo];return i.count=t,it.command("number"==typeof t&&t>=0,"invalid vertex count",e.commandStr),fs((function(){return t}))}if(Jo in r){var a=r[Jo];return ds(a,(function(t,e){var n=t.invoke(e,a);return it.optional((function(){t.assert(e,"typeof "+n+'==="number"&&'+n+">=0&&"+n+"===("+n+"|0)","invalid vertex count")})),n}))}if(l){if(hs(h)){if(h)return v?new ps(v.thisDep,v.contextDep,v.propDep,(function(t,e){var n=e.def(t.ELEMENTS,".vertCount-",t.OFFSET);return it.optional((function(){t.assert(e,n+">=0","invalid vertex offset/element buffer too small")})),n})):fs((function(t,e){return e.def(t.ELEMENTS,".vertCount")}));var s=fs((function(){return-1}));return it.optional((function(){s.MISSING=!0})),s}var c=new ps(h.thisDep||v.thisDep,h.contextDep||v.contextDep,h.propDep||v.propDep,(function(t,e){var n=t.ELEMENTS;return t.OFFSET?e.def(n,"?",n,".vertCount-",t.OFFSET,":-1"):e.def(n,"?",n,".vertCount:-1")}));return it.optional((function(){c.DYNAMIC=!0})),c}if(o){var p=new ps(u.thisDep,u.contextDep,u.propDep,(function(t,e){return e.def(t.shared.vao,".currentVAO?",t.shared.vao,".currentVAO.count:-1")}));return p}return null}var y=f(),g=m(),_=d(ta,!1);return{elements:h,primitive:y,count:g,instances:_,offset:v,vao:u,vaoActive:o,elementsActive:l,static:i}}function F(t,e){var n=t.static,r=t.dynamic,o={};return S.forEach((function(t){var a=T(t);function s(e,i){if(t in n){var s=e(n[t]);o[a]=fs((function(){return s}))}else if(t in r){var u=r[t];o[a]=ds(u,(function(t,e){return i(t,e,t.invoke(e,u))}))}}switch(t){case ko:case xo:case _o:case zo:case Eo:case Vo:case Io:case Do:case No:case Ao:return s((function(n){return it.commandType(n,"boolean",t,e.commandStr),n}),(function(e,n,r){return it.optional((function(){e.assert(n,"typeof "+r+'==="boolean"',"invalid flag "+t,e.commandStr)})),r}));case Co:return s((function(n){return it.commandParameter(n,os,"invalid "+t,e.commandStr),os[n]}),(function(e,n,r){var i=e.constants.compareFuncs;return it.optional((function(){e.assert(n,r+" in "+i,"invalid "+t+", must be one of "+Object.keys(os))})),n.def(i,"[",r,"]")}));case To:return s((function(t){return it.command(fn(t)&&2===t.length&&"number"==typeof t[0]&&"number"==typeof t[1]&&t[0]<=t[1],"depth range is 2d array",e.commandStr),t}),(function(t,e,n){return it.optional((function(){t.assert(e,t.shared.isArrayLike+"("+n+")&&"+n+".length===2&&typeof "+n+'[0]==="number"&&typeof '+n+'[1]==="number"&&'+n+"[0]<="+n+"[1]","depth range must be a 2d array")})),[e.def("+",n,"[0]"),e.def("+",n,"[1]")]}));case So:return s((function(t){it.commandType(t,"object","blend.func",e.commandStr);var n="srcRGB"in t?t.srcRGB:t.src,r="srcAlpha"in t?t.srcAlpha:t.src,i="dstRGB"in t?t.dstRGB:t.dst,o="dstAlpha"in t?t.dstAlpha:t.dst;return it.commandParameter(n,rs,a+".srcRGB",e.commandStr),it.commandParameter(r,rs,a+".srcAlpha",e.commandStr),it.commandParameter(i,rs,a+".dstRGB",e.commandStr),it.commandParameter(o,rs,a+".dstAlpha",e.commandStr),it.command(-1===is.indexOf(n+", "+i),"unallowed blending combination (srcRGB, dstRGB) = ("+n+", "+i+")",e.commandStr),[rs[n],rs[i],rs[r],rs[o]]}),(function(e,n,r){var i=e.constants.blendFuncs;function o(o,a){var s=n.def('"',o,a,'" in ',r,"?",r,".",o,a,":",r,".",o);return it.optional((function(){e.assert(n,s+" in "+i,"invalid "+t+"."+o+a+", must be one of "+Object.keys(rs))})),s}it.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid blend func, must be an object")}));var a=o("src","RGB"),s=o("dst","RGB");it.optional((function(){var t=e.constants.invalidBlendCombinations;e.assert(n,t+".indexOf("+a+'+", "+'+s+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")}));var u=n.def(i,"[",a,"]"),l=n.def(i,"[",o("src","Alpha"),"]");return[u,n.def(i,"[",s,"]"),l,n.def(i,"[",o("dst","Alpha"),"]")]}));case wo:return s((function(n){return"string"==typeof n?(it.commandParameter(n,y,"invalid "+t,e.commandStr),[y[n],y[n]]):"object"==typeof n?(it.commandParameter(n.rgb,y,t+".rgb",e.commandStr),it.commandParameter(n.alpha,y,t+".alpha",e.commandStr),[y[n.rgb],y[n.alpha]]):void it.commandRaise("invalid blend.equation",e.commandStr)}),(function(e,n,r){var i=e.constants.blendEquations,o=n.def(),a=n.def(),s=e.cond("typeof ",r,'==="string"');return it.optional((function(){function n(t,n,r){e.assert(t,r+" in "+i,"invalid "+n+", must be one of "+Object.keys(y))}n(s.then,t,r),e.assert(s.else,r+"&&typeof "+r+'==="object"',"invalid "+t),n(s.else,t+".rgb",r+".rgb"),n(s.else,t+".alpha",r+".alpha")})),s.then(o,"=",a,"=",i,"[",r,"];"),s.else(o,"=",i,"[",r,".rgb];",a,"=",i,"[",r,".alpha];"),n(s),[o,a]}));case bo:return s((function(t){return it.command(fn(t)&&4===t.length,"blend.color must be a 4d array",e.commandStr),Mt(4,(function(e){return+t[e]}))}),(function(t,e,n){return it.optional((function(){t.assert(e,t.shared.isArrayLike+"("+n+")&&"+n+".length===4","blend.color must be a 4d array")})),Mt(4,(function(t){return e.def("+",n,"[",t,"]")}))}));case Fo:return s((function(t){return it.commandType(t,"number",a,e.commandStr),0|t}),(function(t,e,n){return it.optional((function(){t.assert(e,"typeof "+n+'==="number"',"invalid stencil.mask")})),e.def(n,"|0")}));case Bo:return s((function(n){it.commandType(n,"object",a,e.commandStr);var r=n.cmp||"keep",i=n.ref||0,o="mask"in n?n.mask:-1;return it.commandParameter(r,os,t+".cmp",e.commandStr),it.commandType(i,"number",t+".ref",e.commandStr),it.commandType(o,"number",t+".mask",e.commandStr),[os[r],i,o]}),(function(t,e,n){var r=t.constants.compareFuncs;return it.optional((function(){function i(){t.assert(e,Array.prototype.join.call(arguments,""),"invalid stencil.func")}i(n+"&&typeof ",n,'==="object"'),i('!("cmp" in ',n,")||(",n,".cmp in ",r,")")})),[e.def('"cmp" in ',n,"?",r,"[",n,".cmp]",":",Ka),e.def(n,".ref|0"),e.def('"mask" in ',n,"?",n,".mask|0:-1")]}));case jo:case Uo:return s((function(n){it.commandType(n,"object",a,e.commandStr);var r=n.fail||"keep",i=n.zfail||"keep",o=n.zpass||"keep";return it.commandParameter(r,as,t+".fail",e.commandStr),it.commandParameter(i,as,t+".zfail",e.commandStr),it.commandParameter(o,as,t+".zpass",e.commandStr),[t===Uo?Ga:Va,as[r],as[i],as[o]]}),(function(e,n,r){var i=e.constants.stencilOps;function o(o){return it.optional((function(){e.assert(n,'!("'+o+'" in '+r+")||("+r+"."+o+" in "+i+")","invalid "+t+"."+o+", must be one of "+Object.keys(as))})),n.def('"',o,'" in ',r,"?",i,"[",r,".",o,"]:",Ka)}return it.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+t)})),[t===Uo?Ga:Va,o("fail"),o("zfail"),o("zpass")]}));case Ro:return s((function(t){it.commandType(t,"object",a,e.commandStr);var n=0|t.factor,r=0|t.units;return it.commandType(n,"number",a+".factor",e.commandStr),it.commandType(r,"number",a+".units",e.commandStr),[n,r]}),(function(e,n,r){return it.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+t)})),[n.def(r,".factor|0"),n.def(r,".units|0")]}));case Po:return s((function(t){var n=0;return"front"===t?n=Va:"back"===t&&(n=Ga),it.command(!!n,a,e.commandStr),n}),(function(t,e,n){return it.optional((function(){t.assert(e,n+'==="front"||'+n+'==="back"',"invalid cull.face")})),e.def(n,'==="front"?',Va,":",Ga)}));case Lo:return s((function(t){return it.command("number"==typeof t&&t>=i.lineWidthDims[0]&&t<=i.lineWidthDims[1],"invalid line width, must be a positive number between "+i.lineWidthDims[0]+" and "+i.lineWidthDims[1],e.commandStr),t}),(function(t,e,n){return it.optional((function(){t.assert(e,"typeof "+n+'==="number"&&'+n+">="+i.lineWidthDims[0]+"&&"+n+"<="+i.lineWidthDims[1],"invalid line width")})),n}));case Oo:return s((function(t){return it.commandParameter(t,us,a,e.commandStr),us[t]}),(function(t,e,n){return it.optional((function(){t.assert(e,n+'==="cw"||'+n+'==="ccw"',"invalid frontFace, must be one of cw,ccw")})),e.def(n+'==="cw"?'+Ha+":"+Wa)}));case Mo:return s((function(t){return it.command(fn(t)&&4===t.length,"color.mask must be length 4 array",e.commandStr),t.map((function(t){return!!t}))}),(function(t,e,n){return it.optional((function(){t.assert(e,t.shared.isArrayLike+"("+n+")&&"+n+".length===4","invalid color.mask")})),Mt(4,(function(t){return"!!"+n+"["+t+"]"}))}));case Zo:return s((function(t){it.command("object"==typeof t&&t,a,e.commandStr);var n="value"in t?t.value:1,r=!!t.invert;return it.command("number"==typeof n&&n>=0&&n<=1,"sample.coverage.value must be a number between 0 and 1",e.commandStr),[n,r]}),(function(t,e,n){return it.optional((function(){t.assert(e,n+"&&typeof "+n+'==="object"',"invalid sample.coverage")})),[e.def('"value" in ',n,"?+",n,".value:1"),e.def("!!",n,".invert")]}))}})),o}function B(t,e){var n=t.static,r=t.dynamic,i={};return Object.keys(n).forEach((function(t){var r,o=n[t];if("number"==typeof o||"boolean"==typeof o)r=fs((function(){return o}));else if("function"==typeof o){var a=o._reglType;"texture2d"===a||"textureCube"===a?r=fs((function(t){return t.link(o)})):"framebuffer"===a||"framebufferCube"===a?(it.command(o.color.length>0,'missing color attachment for framebuffer sent to uniform "'+t+'"',e.commandStr),r=fs((function(t){return t.link(o.color[0])}))):it.commandRaise('invalid data for uniform "'+t+'"',e.commandStr)}else fn(o)?r=fs((function(e){return e.global.def("[",Mt(o.length,(function(n){return it.command("number"==typeof o[n]||"boolean"==typeof o[n],"invalid uniform "+t,e.commandStr),o[n]})),"]")})):it.commandRaise('invalid or missing data for uniform "'+t+'"',e.commandStr);r.value=o,i[t]=r})),Object.keys(r).forEach((function(t){var e=r[t];i[t]=ds(e,(function(t,n){return t.invoke(n,e)}))})),i}function j(t,n){var r=t.static,i=t.dynamic,a={};return Object.keys(r).forEach((function(t){var i=r[t],s=e.id(t),u=new m;if(ls(i))u.state=lo,u.buffer=o.getBuffer(o.create(i,ha,!1,!0)),u.type=0;else{var l=o.getBuffer(i);if(l)u.state=lo,u.buffer=l,u.type=0;else if(it.command("object"==typeof i&&i,"invalid data for attribute "+t,n.commandStr),"constant"in i){var c=i.constant;u.buffer="null",u.state=co,"number"==typeof c?u.x=c:(it.command(fn(c)&&c.length>0&&c.length<=4,"invalid constant for attribute "+t,n.commandStr),so.forEach((function(t,e){e<c.length&&(u[t]=c[e])})))}else{l=ls(i.buffer)?o.getBuffer(o.create(i.buffer,ha,!1,!0)):o.getBuffer(i.buffer),it.command(!!l,'missing buffer for attribute "'+t+'"',n.commandStr);var p=0|i.offset;it.command(p>=0,'invalid offset for attribute "'+t+'"',n.commandStr);var h=0|i.stride;it.command(h>=0&&h<256,'invalid stride for attribute "'+t+'", must be integer betweeen [0, 255]',n.commandStr);var f=0|i.size;it.command(!("size"in i)||f>0&&f<=4,'invalid size for attribute "'+t+'", must be 1,2,3,4',n.commandStr);var d=!!i.normalized,v=0;"type"in i&&(it.commandParameter(i.type,De,"invalid type for attribute "+t,n.commandStr),v=De[i.type]);var y=0|i.divisor;it.optional((function(){"divisor"in i&&(it.command(0===y||g,'cannot specify divisor for attribute "'+t+'", instancing not supported',n.commandStr),it.command(y>=0,'invalid divisor for attribute "'+t+'"',n.commandStr));var e=n.commandStr,r=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(i).forEach((function(n){it.command(r.indexOf(n)>=0,'unknown parameter "'+n+'" for attribute pointer "'+t+'" (valid parameters are '+r+")",e)}))})),u.buffer=l,u.state=lo,u.size=f,u.normalized=d,u.type=v||l.dtype,u.offset=p,u.stride=h,u.divisor=y}}a[t]=fs((function(t,e){var n=t.attribCache;if(s in n)return n[s];var r={isStream:!1};return Object.keys(u).forEach((function(t){r[t]=u[t]})),u.buffer&&(r.buffer=t.link(u.buffer),r.type=r.type||r.buffer+".dtype"),n[s]=r,r}))})),Object.keys(i).forEach((function(t){var e=i[t];function n(n,r){var i=n.invoke(r,e),o=n.shared,a=n.constants,s=o.isBufferArgs,u=o.buffer;it.optional((function(){n.assert(r,i+"&&(typeof "+i+'==="object"||typeof '+i+'==="function")&&('+s+"("+i+")||"+u+".getBuffer("+i+")||"+u+".getBuffer("+i+".buffer)||"+s+"("+i+'.buffer)||("constant" in '+i+"&&(typeof "+i+'.constant==="number"||'+o.isArrayLike+"("+i+".constant))))",'invalid dynamic attribute "'+t+'"')}));var l={isStream:r.def(!1)},c=new m;c.state=lo,Object.keys(c).forEach((function(t){l[t]=r.def(""+c[t])}));var p=l.buffer,h=l.type;function f(t){r(l[t],"=",i,".",t,"|0;")}return r("if(",s,"(",i,")){",l.isStream,"=true;",p,"=",u,".createStream(",ha,",",i,");",h,"=",p,".dtype;","}else{",p,"=",u,".getBuffer(",i,");","if(",p,"){",h,"=",p,".dtype;",'}else if("constant" in ',i,"){",l.state,"=",co,";","if(typeof "+i+'.constant === "number"){',l[so[0]],"=",i,".constant;",so.slice(1).map((function(t){return l[t]})).join("="),"=0;","}else{",so.map((function(t,e){return l[t]+"="+i+".constant.length>"+e+"?"+i+".constant["+e+"]:0;"})).join(""),"}}else{","if(",s,"(",i,".buffer)){",p,"=",u,".createStream(",ha,",",i,".buffer);","}else{",p,"=",u,".getBuffer(",i,".buffer);","}",h,'="type" in ',i,"?",a.glTypes,"[",i,".type]:",p,".dtype;",l.normalized,"=!!",i,".normalized;"),f("size"),f("offset"),f("stride"),f("divisor"),r("}}"),r.exit("if(",l.isStream,"){",u,".destroyStream(",p,");","}"),l}a[t]=ds(e,n)})),a}function U(t){var e=t.static,n=t.dynamic,r={};return Object.keys(e).forEach((function(t){var n=e[t];r[t]=fs((function(t,e){return"number"==typeof n||"boolean"==typeof n?""+n:t.link(n)}))})),Object.keys(n).forEach((function(t){var e=n[t];r[t]=ds(e,(function(t,n){return t.invoke(n,e)}))})),r}function V(t,e,n,i,o){var a=t.static,s=t.dynamic;it.optional((function(){var t=[qo,Xo,Yo,Ko,Qo,$o,Jo,ta,Wo,ea].concat(S);function e(e){Object.keys(e).forEach((function(e){it.command(t.indexOf(e)>=0,'unknown parameter "'+e+'"',o.commandStr)}))}e(a),e(s)}));var u=N(t,e),l=R(t,o),p=D(t,l,o),h=z(t,o),f=F(t,o),d=Z(t,o,u);function v(t){var e=p[t];e&&(f[t]=e)}v(Ho),v(T(Go));var m=Object.keys(f).length>0,y={framebuffer:l,draw:h,shader:d,state:f,dirty:m,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(y.profile=I(t,o),y.uniforms=B(n,o),y.drawVAO=y.scopeVAO=h.vao,!y.drawVAO&&d.program&&!u&&r.angle_instanced_arrays&&h.static.elements){var g=!0,_=d.program.attributes.map((function(t){var n=e.static[t];return g=g&&!!n,n}));if(g&&_.length>0){var x=c.getVAO(c.createVAO({attributes:_,elements:h.static.elements}));y.drawVAO=new ps(null,null,null,(function(t,e){return t.link(x)})),y.useVAO=!0}}return u?y.useVAO=!0:y.attributes=j(e,o),y.context=U(i,o),y}function G(t,e,n){var r=t.shared.context,i=t.scope();Object.keys(n).forEach((function(o){e.save(r,"."+o);var a=n[o].append(t,e);Array.isArray(a)?i(r,".",o,"=[",a.join(),"];"):i(r,".",o,"=",a,";")})),e(i)}function H(t,e,n,r){var i,o=t.shared,a=o.gl,s=o.framebuffer;_&&(i=e.def(o.extensions,".webgl_draw_buffers"));var u,l=t.constants,c=l.drawBuffer,p=l.backBuffer;u=n?n.append(t,e):e.def(s,".next"),r||e("if(",u,"!==",s,".cur){"),e("if(",u,"){",a,".bindFramebuffer(",es,",",u,".framebuffer);"),_&&e(i,".drawBuffersWEBGL(",c,"[",u,".colorAttachments.length]);"),e("}else{",a,".bindFramebuffer(",es,",null);"),_&&e(i,".drawBuffersWEBGL(",p,");"),e("}",s,".cur=",u,";"),r||e("}")}function W(t,e,n){var r=t.shared,i=r.gl,o=t.current,a=t.next,s=r.current,u=r.next,l=t.cond(s,".dirty");S.forEach((function(e){var r,c,p=T(e);if(!(p in n.state))if(p in a){r=a[p],c=o[p];var h=Mt(b[p].length,(function(t){return l.def(r,"[",t,"]")}));l(t.cond(h.map((function(t,e){return t+"!=="+c+"["+e+"]"})).join("||")).then(i,".",C[p],"(",h,");",h.map((function(t,e){return c+"["+e+"]="+t})).join(";"),";"))}else{r=l.def(u,".",p);var f=t.cond(r,"!==",s,".",p);l(f),p in E?f(t.cond(r).then(i,".enable(",E[p],");").else(i,".disable(",E[p],");"),s,".",p,"=",r,";"):f(i,".",C[p],"(",r,");",s,".",p,"=",r,";")}})),0===Object.keys(n.state).length&&l(s,".dirty=false;"),e(l)}function q(t,e,n,r){var i=t.shared,o=t.current,a=i.current,s=i.gl;cs(Object.keys(n)).forEach((function(i){var u=n[i];if(!r||r(u)){var l=u.append(t,e);if(E[i]){var c=E[i];hs(u)?e(s,l?".enable(":".disable(",c,");"):e(t.cond(l).then(s,".enable(",c,");").else(s,".disable(",c,");")),e(a,".",i,"=",l,";")}else if(fn(l)){var p=o[i];e(s,".",C[i],"(",l,");",l.map((function(t,e){return p+"["+e+"]="+t})).join(";"),";")}else e(s,".",C[i],"(",l,");",a,".",i,"=",l,";")}}))}function X(t,e){g&&(t.instancing=e.def(t.shared.extensions,".angle_instanced_arrays"))}function Y(t,e,n,r,i){var o,a,s,u=t.shared,l=t.stats,c=u.current,p=u.timer,h=n.profile;function f(){return"undefined"!=typeof my&&my&&"function"==typeof my.showToast&&!0!==my.isFRM||"undefined"==typeof performance?"Date.now()":"performance.now()"}function v(t){t(o=e.def(),"=",f(),";"),"string"==typeof i?t(l,".count+=",i,";"):t(l,".count++;"),d&&(r?t(a=e.def(),"=",p,".getNumPendingQueries();"):t(p,".beginQuery(",l,");"))}function m(t){t(l,".cpuTime+=",f(),"-",o,";"),d&&(r?t(p,".pushScopeStats(",a,",",p,".getNumPendingQueries(),",l,");"):t(p,".endQuery();"))}function y(t){var n=e.def(c,".profile");e(c,".profile=",t,";"),e.exit(c,".profile=",n,";")}if(h){if(hs(h))return void(h.enable?(v(e),m(e.exit),y("true")):y("false"));y(s=h.append(t,e))}else s=e.def(c,".profile");var g=t.block();v(g),e("if(",s,"){",g,"}");var _=t.block();m(_),e.exit("if(",s,"){",_,"}")}function K(t,e,n,r,i){var o=t.shared;function a(t){switch(t){case Ta:case Pa:case Ra:return 2;case Aa:case Oa:case Da:return 3;case Ma:case La:case Na:return 4;default:return 1}}function s(n,r,i){var a=o.gl,s=e.def(n,".location"),u=e.def(o.attributes,"[",s,"]"),l=i.state,c=i.buffer,p=[i.x,i.y,i.z,i.w],h=["buffer","normalized","offset","stride"];function f(){e("if(!",u,".buffer){",a,".enableVertexAttribArray(",s,");}");var n,o=i.type;if(n=i.size?e.def(i.size,"||",r):r,e("if(",u,".type!==",o,"||",u,".size!==",n,"||",h.map((function(t){return u+"."+t+"!=="+i[t]})).join("||"),"){",a,".bindBuffer(",ha,",",c,".buffer);",a,".vertexAttribPointer(",[s,n,o,i.normalized,i.stride,i.offset],");",u,".type=",o,";",u,".size=",n,";",h.map((function(t){return u+"."+t+"="+i[t]+";"})).join(""),"}"),g){var l=i.divisor;e("if(",u,".divisor!==",l,"){",t.instancing,".vertexAttribDivisorANGLE(",[s,l],");",u,".divisor=",l,";}")}}function d(){e("if(",u,".buffer){",a,".disableVertexAttribArray(",s,");",u,".buffer=null;","}if(",so.map((function(t,e){return u+"."+t+"!=="+p[e]})).join("||"),"){",a,".vertexAttrib4f(",s,",",p,");",so.map((function(t,e){return u+"."+t+"="+p[e]+";"})).join(""),"}")}l===lo?f():l===co?d():(e("if(",l,"===",lo,"){"),f(),e("}else{"),d(),e("}"))}r.forEach((function(r){var o,u=r.name,l=n.attributes[u];if(l){if(!i(l))return;o=l.append(t,e)}else{if(!i(vs))return;var c=t.scopeAttrib(u);it.optional((function(){t.assert(e,c+".state","missing attribute "+u)})),o={},Object.keys(new m).forEach((function(t){o[t]=e.def(c,".",t)}))}s(t.link(r),a(r.info.type),o)}))}function Q(t,n,r,i,o,a){for(var s,u=t.shared,l=u.gl,c=0;c<i.length;++c){var p,h=i[c],f=h.name,d=h.info.type,v=r.uniforms[f],m=t.link(h)+".location";if(v){if(!o(v))continue;if(hs(v)){var y=v.value;if(it.command(null!=y,'missing uniform "'+f+'"',t.commandStr),d===Ba||d===ja){it.command("function"==typeof y&&(d===Ba&&("texture2d"===y._reglType||"framebuffer"===y._reglType)||d===ja&&("textureCube"===y._reglType||"framebufferCube"===y._reglType)),"invalid texture for uniform "+f,t.commandStr);var g=t.link(y._texture||y.color[0]._texture);n(l,".uniform1i(",m,",",g+".bind());"),n.exit(g,".unbind();")}else if(d===Za||d===za||d===Fa){it.optional((function(){it.command(fn(y),"invalid matrix for uniform "+f,t.commandStr),it.command(d===Za&&4===y.length||d===za&&9===y.length||d===Fa&&16===y.length,"invalid length for matrix uniform "+f,t.commandStr)}));var _=t.global.def("new Float32Array(["+Array.prototype.slice.call(y)+"])"),x=2;d===za?x=3:d===Fa&&(x=4),n(l,".uniformMatrix",x,"fv(",m,",false,",_,");")}else{switch(d){case Ca:it.commandType(y,"number","uniform "+f,t.commandStr),s="1f";break;case Ta:it.command(fn(y)&&2===y.length,"uniform "+f,t.commandStr),s="2f";break;case Aa:it.command(fn(y)&&3===y.length,"uniform "+f,t.commandStr),s="3f";break;case Ma:it.command(fn(y)&&4===y.length,"uniform "+f,t.commandStr),s="4f";break;case Ia:it.commandType(y,"boolean","uniform "+f,t.commandStr),s="1i";break;case ka:it.commandType(y,"number","uniform "+f,t.commandStr),s="1i";break;case Ra:case Pa:it.command(fn(y)&&2===y.length,"uniform "+f,t.commandStr),s="2i";break;case Da:case Oa:it.command(fn(y)&&3===y.length,"uniform "+f,t.commandStr),s="3i";break;case Na:case La:it.command(fn(y)&&4===y.length,"uniform "+f,t.commandStr),s="4i"}n(l,".uniform",s,"(",m,",",fn(y)?Array.prototype.slice.call(y):y,");")}continue}p=v.append(t,n)}else{if(!o(vs))continue;p=n.def(u.uniforms,"[",e.id(f),"]")}d===Ba?(it(!Array.isArray(p),"must specify a scalar prop for textures"),n("if(",p,"&&",p,'._reglType==="framebuffer"){',p,"=",p,".color[0];","}")):d===ja&&(it(!Array.isArray(p),"must specify a scalar prop for cube maps"),n("if(",p,"&&",p,'._reglType==="framebufferCube"){',p,"=",p,".color[0];","}")),it.optional((function(){function e(e,r){t.assert(n,e,'bad data or missing for uniform "'+f+'".  '+r)}function r(t){it(!Array.isArray(p),"must not specify an array type for uniform"),e("typeof "+p+'==="'+t+'"',"invalid type, expected "+t)}function i(n,r){Array.isArray(p)?it(p.length===n,"must have length "+n):e(u.isArrayLike+"("+p+")&&"+p+".length==="+n,"invalid vector, should have length "+n,t.commandStr)}function o(n){it(!Array.isArray(p),"must not specify a value type"),e("typeof "+p+'==="function"&&'+p+'._reglType==="texture'+(n===da?"2d":"Cube")+'"',"invalid texture type",t.commandStr)}switch(d){case ka:r("number");break;case Pa:i(2,"number");break;case Oa:i(3,"number");break;case La:i(4,"number");break;case Ca:r("number");break;case Ta:i(2,"number");break;case Aa:i(3,"number");break;case Ma:i(4,"number");break;case Ia:r("boolean");break;case Ra:i(2,"boolean");break;case Da:i(3,"boolean");break;case Na:i(4,"boolean");break;case Za:i(4,"number");break;case za:i(9,"number");break;case Fa:i(16,"number");break;case Ba:o(da);break;case ja:o(va)}}));var b=1;switch(d){case Ba:case ja:var w=n.def(p,"._texture");n(l,".uniform1i(",m,",",w,".bind());"),n.exit(w,".unbind();");continue;case ka:case Ia:s="1i";break;case Pa:case Ra:s="2i",b=2;break;case Oa:case Da:s="3i",b=3;break;case La:case Na:s="4i",b=4;break;case Ca:s="1f";break;case Ta:s="2f",b=2;break;case Aa:s="3f",b=3;break;case Ma:s="4f",b=4;break;case Za:s="Matrix2fv";break;case za:s="Matrix3fv";break;case Fa:s="Matrix4fv"}if("M"===s.charAt(0)){n(l,".uniform",s,"(",m,",");var S=Math.pow(d-Za+2,2),E=t.global.def("new Float32Array(",S,")");Array.isArray(p)?n("false,(",Mt(S,(function(t){return E+"["+t+"]="+p[t]})),",",E,")"):n("false,(Array.isArray(",p,")||",p," instanceof Float32Array)?",p,":(",Mt(S,(function(t){return E+"["+t+"]="+p+"["+t+"]"})),",",E,")"),n(");")}else if(b>1){for(var C=[],T=[],A=0;A<b;++A)Array.isArray(p)?T.push(p[A]):T.push(n.def(p+"["+A+"]")),a&&C.push(n.def());a&&n("if(!",t.batchId,"||",C.map((function(t,e){return t+"!=="+T[e]})).join("||"),"){",C.map((function(t,e){return t+"="+T[e]+";"})).join("")),n(l,".uniform",s,"(",m,",",T.join(","),");"),a&&n("}")}else{if(it(!Array.isArray(p),"uniform value must not be an array"),a){var M=n.def();n("if(!",t.batchId,"||",M,"!==",p,"){",M,"=",p,";")}n(l,".uniform",s,"(",m,",",p,");"),a&&n("}")}}}function J(t,e,n,r){var i=t.shared,o=i.gl,a=i.draw,s=r.draw;function u(){var u,l=s.elements,c=e;return l?((l.contextDep&&r.contextDynamic||l.propDep)&&(c=n),u=l.append(t,c),s.elementsActive&&c("if("+u+")"+o+".bindBuffer("+fa+","+u+".buffer.buffer);")):(u=c.def(),c(u,"=",a,".",Ko,";","if(",u,"){",o,".bindBuffer(",fa,",",u,".buffer.buffer);}","else if(",i.vao,".currentVAO){",u,"=",t.shared.elements+".getElements("+i.vao,".currentVAO.elements);",x?"":"if("+u+")"+o+".bindBuffer("+fa+","+u+".buffer.buffer);","}")),u}function l(){var i,o=s.count,u=e;return o?((o.contextDep&&r.contextDynamic||o.propDep)&&(u=n),i=o.append(t,u),it.optional((function(){o.MISSING&&t.assert(e,"false","missing vertex count"),o.DYNAMIC&&t.assert(u,i+">=0","missing vertex count")}))):(i=u.def(a,".",Jo),it.optional((function(){t.assert(u,i+">=0","missing vertex count")}))),i}var c=u();function p(i){var o=s[i];return o?o.contextDep&&r.contextDynamic||o.propDep?o.append(t,n):o.append(t,e):e.def(a,".",i)}var h,f,d=p(Qo),v=p($o),m=l();if("number"==typeof m){if(0===m)return}else n("if(",m,"){"),n.exit("}");g&&(h=p(ta),f=t.instancing);var y=c+".type",_=s.elements&&hs(s.elements)&&!s.vaoActive;function b(){function t(){n(f,".drawElementsInstancedANGLE(",[d,m,y,v+"<<(("+y+"-"+uo+")>>1)",h],");")}function e(){n(f,".drawArraysInstancedANGLE(",[d,v,m,h],");")}c&&"null"!==c?_?t():(n("if(",c,"){"),t(),n("}else{"),e(),n("}")):e()}function w(){function t(){n(o+".drawElements("+[d,m,y,v+"<<(("+y+"-"+uo+")>>1)"]+");")}function e(){n(o+".drawArrays("+[d,v,m]+");")}c&&"null"!==c?_?t():(n("if(",c,"){"),t(),n("}else{"),e(),n("}")):e()}g&&("number"!=typeof h||h>=0)?"string"==typeof h?(n("if(",h,">0){"),b(),n("}else if(",h,"<0){"),w(),n("}")):b():w()}function $(t,e,n,r,i){var o=L(),a=o.proc("body",i);return it.optional((function(){o.commandStr=e.commandStr,o.command=o.link(e.commandStr)})),g&&(o.instancing=a.def(o.shared.extensions,".angle_instanced_arrays")),t(o,a,n,r),o.compile().body}function tt(t,e,n,r){X(t,e),n.useVAO?n.drawVAO?e(t.shared.vao,".setVAO(",n.drawVAO.append(t,e),");"):e(t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"):(e(t.shared.vao,".setVAO(null);"),K(t,e,n,r.attributes,(function(){return!0}))),Q(t,e,n,r.uniforms,(function(){return!0}),!1),J(t,e,e,n)}function et(t,e){var n=t.proc("draw",1);X(t,n),G(t,n,e.context),H(t,n,e.framebuffer),W(t,n,e),q(t,n,e.state),Y(t,n,e,!1,!0);var r=e.shader.progVar.append(t,n);if(n(t.shared.gl,".useProgram(",r,".program);"),e.shader.program)tt(t,n,e,e.shader.program);else{n(t.shared.vao,".setVAO(null);");var i=t.global.def("{}"),o=n.def(r,".id"),a=n.def(i,"[",o,"]");n(t.cond(a).then(a,".call(this,a0);").else(a,"=",i,"[",o,"]=",t.link((function(n){return $(tt,t,e,n,1)})),"(",r,");",a,".call(this,a0);"))}Object.keys(e.state).length>0&&n(t.shared.current,".dirty=true;"),t.shared.vao&&n(t.shared.vao,".setVAO(null);")}function nt(t,e,n,r){function i(){return!0}t.batchId="a1",X(t,e),K(t,e,n,r.attributes,i),Q(t,e,n,r.uniforms,i,!1),J(t,e,e,n)}function rt(t,e,n,r){X(t,e);var i=n.contextDep,o=e.def(),a="a0",s="a1",u=e.def();t.shared.props=u,t.batchId=o;var l=t.scope(),c=t.scope();function p(t){return t.contextDep&&i||t.propDep}function h(t){return!p(t)}if(e(l.entry,"for(",o,"=0;",o,"<",s,";++",o,"){",u,"=",a,"[",o,"];",c,"}",l.exit),n.needsContext&&G(t,c,n.context),n.needsFramebuffer&&H(t,c,n.framebuffer),q(t,c,n.state,p),n.profile&&p(n.profile)&&Y(t,c,n,!1,!0),r)n.useVAO?n.drawVAO?p(n.drawVAO)?c(t.shared.vao,".setVAO(",n.drawVAO.append(t,c),");"):l(t.shared.vao,".setVAO(",n.drawVAO.append(t,l),");"):l(t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"):(l(t.shared.vao,".setVAO(null);"),K(t,l,n,r.attributes,h),K(t,c,n,r.attributes,p)),Q(t,l,n,r.uniforms,h,!1),Q(t,c,n,r.uniforms,p,!0),J(t,l,c,n);else{var f=t.global.def("{}"),d=n.shader.progVar.append(t,c),v=c.def(d,".id"),m=c.def(f,"[",v,"]");c(t.shared.gl,".useProgram(",d,".program);","if(!",m,"){",m,"=",f,"[",v,"]=",t.link((function(e){return $(nt,t,n,e,2)})),"(",d,");}",m,".call(this,a0[",o,"],",o,");")}}function ot(t,e){var n=t.proc("batch",2);t.batchId="0",X(t,n);var r=!1,i=!0;Object.keys(e.context).forEach((function(t){r=r||e.context[t].propDep})),r||(G(t,n,e.context),i=!1);var o=e.framebuffer,a=!1;function s(t){return t.contextDep&&r||t.propDep}o?(o.propDep?r=a=!0:o.contextDep&&r&&(a=!0),a||H(t,n,o)):H(t,n,null),e.state.viewport&&e.state.viewport.propDep&&(r=!0),W(t,n,e),q(t,n,e.state,(function(t){return!s(t)})),e.profile&&s(e.profile)||Y(t,n,e,!1,"a1"),e.contextDep=r,e.needsContext=i,e.needsFramebuffer=a;var u=e.shader.progVar;if(u.contextDep&&r||u.propDep)rt(t,n,e,null);else{var l=u.append(t,n);if(n(t.shared.gl,".useProgram(",l,".program);"),e.shader.program)rt(t,n,e,e.shader.program);else{n(t.shared.vao,".setVAO(null);");var c=t.global.def("{}"),p=n.def(l,".id"),h=n.def(c,"[",p,"]");n(t.cond(h).then(h,".call(this,a0,a1);").else(h,"=",c,"[",p,"]=",t.link((function(n){return $(rt,t,e,n,2)})),"(",l,");",h,".call(this,a0,a1);"))}}Object.keys(e.state).length>0&&n(t.shared.current,".dirty=true;"),t.shared.vao&&n(t.shared.vao,".setVAO(null);")}function at(t,n){var r=t.proc("scope",3);t.batchId="a2";var i=t.shared,o=i.current;function a(e){var o=n.shader[e];o&&r.set(i.shader,"."+e,o.append(t,r))}G(t,r,n.context),n.framebuffer&&n.framebuffer.append(t,r),cs(Object.keys(n.state)).forEach((function(e){var o=n.state[e].append(t,r);fn(o)?o.forEach((function(n,i){r.set(t.next[e],"["+i+"]",n)})):r.set(i.next,"."+e,o)})),Y(t,r,n,!0,!0),[Ko,$o,Jo,ta,Qo].forEach((function(e){var o=n.draw[e];o&&r.set(i.draw,"."+e,""+o.append(t,r))})),Object.keys(n.uniforms).forEach((function(o){var a=n.uniforms[o].append(t,r);Array.isArray(a)&&(a="["+a.join()+"]"),r.set(i.uniforms,"["+e.id(o)+"]",a)})),Object.keys(n.attributes).forEach((function(e){var i=n.attributes[e].append(t,r),o=t.scopeAttrib(e);Object.keys(new m).forEach((function(t){r.set(o,"."+t,i[t])}))})),n.scopeVAO&&r.set(i.vao,".targetVAO",n.scopeVAO.append(t,r)),a(Xo),a(Yo),Object.keys(n.state).length>0&&(r(o,".dirty=true;"),r.exit(o,".dirty=true;")),r("a1(",t.shared.context,",a0,",t.batchId,");")}function st(t){if("object"==typeof t&&!fn(t)){for(var e=Object.keys(t),n=0;n<e.length;++n)if(mt.isDynamic(t[e[n]]))return!0;return!1}}function ut(t,e,n){var r=e.static[n];if(r&&st(r)){var i=t.global,o=Object.keys(r),a=!1,s=!1,u=!1,l=t.global.def("{}");o.forEach((function(e){var n=r[e];if(mt.isDynamic(n)){"function"==typeof n&&(n=r[e]=mt.unbox(n));var o=ds(n,null);a=a||o.thisDep,u=u||o.propDep,s=s||o.contextDep}else{switch(i(l,".",e,"="),typeof n){case"number":i(n);break;case"string":i('"',n,'"');break;case"object":Array.isArray(n)&&i("[",n.join(),"]");break;default:i(t.link(n))}i(";")}})),e.dynamic[n]=new mt.DynamicVariable(mo,{thisDep:a,contextDep:s,propDep:u,ref:l,append:c}),delete e.static[n]}function c(t,e){o.forEach((function(n){var i=r[n];if(mt.isDynamic(i)){var o=t.invoke(e,i);e(l,".",n,"=",o,";")}}))}}function lt(t,e,r,i,o){var a=L();a.stats=a.link(o),Object.keys(e.static).forEach((function(t){ut(a,e,t)})),pa.forEach((function(e){ut(a,t,e)}));var s=V(t,e,r,i,a);return et(a,s),at(a,s),ot(a,s),n(a.compile(),{destroy:function(){s.shader.program.destroy()}})}return{next:w,current:b,procs:function(){var t=L(),e=t.proc("poll"),n=t.proc("refresh"),o=t.block();e(o),n(o);var a,s=t.shared,u=s.gl,l=s.next,c=s.current;o(c,".dirty=false;"),H(t,e),H(t,n,null,!0),g&&(a=t.link(g)),r.oes_vertex_array_object&&n(t.link(r.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var p=0;p<i.maxAttributes;++p){var h=n.def(s.attributes,"[",p,"]"),f=t.cond(h,".buffer");f.then(u,".enableVertexAttribArray(",p,");",u,".bindBuffer(",ha,",",h,".buffer.buffer);",u,".vertexAttribPointer(",p,",",h,".size,",h,".type,",h,".normalized,",h,".stride,",h,".offset);").else(u,".disableVertexAttribArray(",p,");",u,".vertexAttrib4f(",p,",",h,".x,",h,".y,",h,".z,",h,".w);",h,".buffer=null;"),n(f),g&&n(a,".vertexAttribDivisorANGLE(",p,",",h,".divisor);")}return n(t.shared.vao,".currentVAO=null;",t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"),Object.keys(E).forEach((function(r){var i=E[r],a=o.def(l,".",r),s=t.block();s("if(",a,"){",u,".enable(",i,")}else{",u,".disable(",i,")}",c,".",r,"=",a,";"),n(s),e("if(",a,"!==",c,".",r,"){",s,"}")})),Object.keys(C).forEach((function(r){var i,a,s=C[r],p=b[r],h=t.block();if(h(u,".",s,"("),fn(p)){var f=p.length;i=t.global.def(l,".",r),a=t.global.def(c,".",r),h(Mt(f,(function(t){return i+"["+t+"]"})),");",Mt(f,(function(t){return a+"["+t+"]="+i+"["+t+"];"})).join("")),e("if(",Mt(f,(function(t){return i+"["+t+"]!=="+a+"["+t+"]"})).join("||"),"){",h,"}")}else i=o.def(l,".",r),a=o.def(c,".",r),h(i,");",c,".",r,"=",i,";"),e("if(",i,"!==",a,"){",h,"}");n(h)})),t.compile()}(),compile:lt}}function ys(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var gs=34918,_s=34919,xs=35007,bs=function(t,e){if(!e.ext_disjoint_timer_query)return null;var n=[];function r(){return n.pop()||e.ext_disjoint_timer_query.createQueryEXT()}function i(t){n.push(t)}var o=[];function a(t){var n=r();e.ext_disjoint_timer_query.beginQueryEXT(xs,n),o.push(n),f(o.length-1,o.length,t)}function s(){e.ext_disjoint_timer_query.endQueryEXT(xs)}function u(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var l=[];function c(){return l.pop()||new u}function p(t){l.push(t)}var h=[];function f(t,e,n){var r=c();r.startQueryIndex=t,r.endQueryIndex=e,r.sum=0,r.stats=n,h.push(r)}var d=[],v=[];function m(){var t,n,r=o.length;if(0!==r){v.length=Math.max(v.length,r+1),d.length=Math.max(d.length,r+1),d[0]=0,v[0]=0;var a=0;for(t=0,n=0;n<o.length;++n){var s=o[n];e.ext_disjoint_timer_query.getQueryObjectEXT(s,_s)?(a+=e.ext_disjoint_timer_query.getQueryObjectEXT(s,gs),i(s)):o[t++]=s,d[n+1]=a,v[n+1]=t}for(o.length=t,t=0,n=0;n<h.length;++n){var u=h[n],l=u.startQueryIndex,c=u.endQueryIndex;u.sum+=d[c]-d[l];var f=v[l],m=v[c];m===f?(u.stats.gpuTime+=u.sum/1e6,p(u)):(u.startQueryIndex=f,u.endQueryIndex=m,h[t++]=u)}h.length=t}}return{beginQuery:a,endQuery:s,pushScopeStats:f,update:m,getNumPendingQueries:function(){return o.length},clear:function(){n.push.apply(n,o);for(var t=0;t<n.length;t++)e.ext_disjoint_timer_query.deleteQueryEXT(n[t]);o.length=0,n.length=0},restore:function(){o.length=0,n.length=0}}},ws=16384,Ss=256,Es=1024,Cs=34962,Ts="webglcontextlost",As="webglcontextrestored",Ms=1,ks=2,Ps=3;function Os(t,e){for(var n=0;n<t.length;++n)if(t[n]===e)return n;return-1}function Ls(t){var e=Tt(t);if(!e)return null;var r=e.gl,i=r.getContextAttributes(),o=r.isContextLost(),a=At(r,e);if(!a)return null;var s=_t(),u=ys(),l=a.extensions,c=bs(r,l),p=gt(),h=r.drawingBufferWidth,f=r.drawingBufferHeight,d={tick:0,time:0,viewportWidth:h,viewportHeight:f,framebufferWidth:h,framebufferHeight:f,drawingBufferWidth:h,drawingBufferHeight:f,pixelRatio:e.pixelRatio},v={},m={elements:null,primitive:4,count:-1,offset:0,instances:-1},y=Ee(r,l),g=qe(r,u,e,b),_=un(r,l,g,u),x=qi(r,l,y,u,g,_,m);function b(t){return x.destroyBuffer(t)}var w=Ji(r,s,u,e),S=$r(r,l,y,(function(){T.procs.poll()}),d,u,e),E=fi(r,l,y,u,e),C=ji(r,l,y,S,E,u),T=ms(r,s,l,y,g,_,S,C,v,x,w,m,d,c,e),A=ro(r,C,T.procs.poll,d,i,l,y),M=T.next,k=r.canvas,P=[],O=[],L=[],I=[e.onDestroy],R=null;function D(){if(0===P.length)return c&&c.update(),void(R=null);R=yt.next(D),X();for(var t=P.length-1;t>=0;--t){var e=P[t];e&&e(d,null,0)}r.flush(),c&&c.update()}function N(){!R&&P.length>0&&(R=yt.next(D))}function Z(){R&&(yt.cancel(D),R=null)}function z(t){t.preventDefault(),o=!0,Z(),O.forEach((function(t){t()}))}function F(t){r.getError(),o=!1,a.restore(),w.restore(),g.restore(),S.restore(),E.restore(),C.restore(),x.restore(),c&&c.restore(),T.procs.refresh(),N(),L.forEach((function(t){t()}))}var B="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM;function j(){P.length=0,Z(),!B&&k&&(k.removeEventListener(Ts,z),k.removeEventListener(As,F)),w.clear(),C.clear(),E.clear(),x.clear(),S.clear(),_.clear(),g.clear(),c&&c.clear(),I.forEach((function(t){t()}))}function U(t){function e(t){var e=n({},t);function r(t){if(t in e){var n=e[t];delete e[t],Object.keys(n).forEach((function(r){e[t+"."+r]=n[r]}))}}return delete e.uniforms,delete e.attributes,delete e.context,delete e.vao,"stencil"in e&&e.stencil.op&&(e.stencil.opBack=e.stencil.opFront=e.stencil.op,delete e.stencil.op),r("blend"),r("depth"),r("cull"),r("stencil"),r("polygonOffset"),r("scissor"),r("sample"),"vao"in t&&(e.vao=t.vao),e}function r(t,e){var n={},r={};return Object.keys(t).forEach((function(i){var o=t[i];if(mt.isDynamic(o))r[i]=mt.unbox(o,i);else{if(e&&Array.isArray(o))for(var a=0;a<o.length;++a)if(mt.isDynamic(o[a]))return void(r[i]=mt.unbox(o,i));n[i]=o}})),{dynamic:r,static:n}}it(!!t,"invalid args to regl({...})"),it.type(t,"object","invalid args to regl({...})");var i=r(t.context||{},!0),a=r(t.uniforms||{},!0),s=r(t.attributes||{},!1),u=r(e(t),!1),l={gpuTime:0,cpuTime:0,count:0},c=T.compile(u,s,a,i,l),p=c.draw,h=c.batch,f=c.scope,d=[];function v(t){for(;d.length<t;)d.push(null);return d}function m(t,e){var n;if(o&&it.raise("context lost"),"function"==typeof t)return f.call(this,null,t,0);if("function"==typeof e)if("number"==typeof t)for(n=0;n<t;++n)f.call(this,null,e,n);else{if(!Array.isArray(t))return f.call(this,t,e,0);for(n=0;n<t.length;++n)f.call(this,t[n],e,n)}else if("number"==typeof t){if(t>0)return h.call(this,v(0|t),0|t)}else{if(!Array.isArray(t))return p.call(this,t);if(t.length)return h.call(this,t,t.length)}}return n(m,{stats:l,destroy:function(){c.destroy()}})}!B&&k&&(k.addEventListener(Ts,z,!1),k.addEventListener(As,F,!1));var V=C.setFBO=U({framebuffer:mt.define.call(null,Ms,"framebuffer")});function G(t,e){var n=0;T.procs.poll();var i=e.color;i&&(r.clearColor(+i[0]||0,+i[1]||0,+i[2]||0,+i[3]||0),n|=ws),"depth"in e&&(r.clearDepth(+e.depth),n|=Ss),"stencil"in e&&(r.clearStencil(0|e.stencil),n|=Es),it(!!n,"called regl.clear with no buffer specified"),r.clear(n)}function H(t){if(it("object"==typeof t&&t,"regl.clear() takes an object as input"),"framebuffer"in t)if(t.framebuffer&&"framebufferCube"===t.framebuffer_reglType)for(var e=0;e<6;++e)V(n({framebuffer:t.framebuffer.faces[e]},t),G);else V(t,G);else G(null,t)}function W(t){function e(){var e=Os(P,t);function n(){var t=Os(P,n);P[t]=P[P.length-1],P.length-=1,P.length<=0&&Z()}it(e>=0,"cannot cancel a frame twice"),P[e]=n}return it.type(t,"function","regl.frame() callback must be a function"),P.push(t),N(),{cancel:e}}function q(){var t=M.viewport,e=M.scissor_box;t[0]=t[1]=e[0]=e[1]=0,d.viewportWidth=d.framebufferWidth=d.drawingBufferWidth=t[2]=e[2]=r.drawingBufferWidth,d.viewportHeight=d.framebufferHeight=d.drawingBufferHeight=t[3]=e[3]=r.drawingBufferHeight}function X(){d.tick+=1,d.time=K(),q(),T.procs.poll()}function Y(){S.refresh(),q(),T.procs.refresh(),c&&c.update()}function K(){return(gt()-p)/1e3}function Q(t,e){var n;switch(it.type(e,"function","listener callback must be a function"),t){case"frame":return W(e);case"lost":n=O;break;case"restore":n=L;break;case"destroy":n=I;break;default:it.raise("invalid event, must be one of frame,lost,restore,destroy")}return n.push(e),{cancel:function(){for(var t=0;t<n.length;++t)if(n[t]===e)return n[t]=n[n.length-1],void n.pop()}}}Y();var J=n(U,{clear:H,prop:mt.define.bind(null,Ms),context:mt.define.bind(null,ks),this:mt.define.bind(null,Ps),draw:U({}),buffer:function(t){return g.create(t,Cs,!1,!1)},elements:function(t){return _.create(t,!1)},texture:S.create2D,cube:S.createCube,renderbuffer:E.create,framebuffer:C.create,framebufferCube:C.createCube,vao:x.createVAO,attributes:i,frame:W,on:Q,limits:y,hasExtension:function(t){return y.extensions.indexOf(t.toLowerCase())>=0},read:A,destroy:j,_gl:r,_refresh:Y,poll:function(){X(),c&&c.update()},now:K,stats:u});return e.onDone(null,J),J}return Ls}(n(26690))},96874:function(t){t.exports=function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}},77412:function(t){t.exports=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t}},47443:function(t,e,n){var r=n(76778);t.exports=function(t,e){return!!(null==t?0:t.length)&&r(t,e,0)>-1}},1196:function(t){t.exports=function(t,e,n){for(var r=-1,i=null==t?0:t.length;++r<i;)if(n(e,t[r]))return!0;return!1}},29932:function(t){t.exports=function(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}},62663:function(t){t.exports=function(t,e,n,r){var i=-1,o=null==t?0:t.length;for(r&&o&&(n=t[++i]);++i<o;)n=e(n,t[i],i,t);return n}},44286:function(t){t.exports=function(t){return t.split("")}},49029:function(t){var e=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;t.exports=function(t){return t.match(e)||[]}},86556:function(t,e,n){var r=n(89465),i=n(77813);t.exports=function(t,e,n){(void 0!==n&&!i(t[e],n)||void 0===n&&!(e in t))&&r(t,e,n)}},34865:function(t,e,n){var r=n(89465),i=n(77813),o=Object.prototype.hasOwnProperty;t.exports=function(t,e,n){var a=t[e];o.call(t,e)&&i(a,n)&&(void 0!==n||e in t)||r(t,e,n)}},44037:function(t,e,n){var r=n(98363),i=n(3674);t.exports=function(t,e){return t&&r(e,i(e),t)}},63886:function(t,e,n){var r=n(98363),i=n(81704);t.exports=function(t,e){return t&&r(e,i(e),t)}},89465:function(t,e,n){var r=n(38777);t.exports=function(t,e,n){"__proto__"==e&&r?r(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}},29750:function(t){t.exports=function(t,e,n){return t==t&&(void 0!==n&&(t=t<=n?t:n),void 0!==e&&(t=t>=e?t:e)),t}},85990:function(t,e,n){var r=n(46384),i=n(77412),o=n(34865),a=n(44037),s=n(63886),u=n(64626),l=n(278),c=n(18805),p=n(1911),h=n(58234),f=n(46904),d=n(64160),v=n(43824),m=n(29148),y=n(38517),g=n(1469),_=n(44144),x=n(56688),b=n(13218),w=n(72928),S=n(3674),E=n(81704),C="[object Arguments]",T="[object Function]",A="[object Object]",M={};M[C]=M["[object Array]"]=M["[object ArrayBuffer]"]=M["[object DataView]"]=M["[object Boolean]"]=M["[object Date]"]=M["[object Float32Array]"]=M["[object Float64Array]"]=M["[object Int8Array]"]=M["[object Int16Array]"]=M["[object Int32Array]"]=M["[object Map]"]=M["[object Number]"]=M[A]=M["[object RegExp]"]=M["[object Set]"]=M["[object String]"]=M["[object Symbol]"]=M["[object Uint8Array]"]=M["[object Uint8ClampedArray]"]=M["[object Uint16Array]"]=M["[object Uint32Array]"]=!0,M["[object Error]"]=M[T]=M["[object WeakMap]"]=!1,t.exports=function t(e,n,k,P,O,L){var I,R=1&n,D=2&n,N=4&n;if(k&&(I=O?k(e,P,O,L):k(e)),void 0!==I)return I;if(!b(e))return e;var Z=g(e);if(Z){if(I=v(e),!R)return l(e,I)}else{var z=d(e),F=z==T||"[object GeneratorFunction]"==z;if(_(e))return u(e,R);if(z==A||z==C||F&&!O){if(I=D||F?{}:y(e),!R)return D?p(e,s(I,e)):c(e,a(I,e))}else{if(!M[z])return O?e:{};I=m(e,z,R)}}L||(L=new r);var B=L.get(e);if(B)return B;L.set(e,I),w(e)?e.forEach((function(r){I.add(t(r,n,k,r,e,L))})):x(e)&&e.forEach((function(r,i){I.set(i,t(r,n,k,i,e,L))}));var j=Z?void 0:(N?D?f:h:D?E:S)(e);return i(j||e,(function(r,i){j&&(r=e[i=r]),o(I,i,t(r,n,k,i,e,L))})),I}},3118:function(t,e,n){var r=n(13218),i=Object.create,o=function(){function t(){}return function(e){if(!r(e))return{};if(i)return i(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();t.exports=o},41848:function(t){t.exports=function(t,e,n,r){for(var i=t.length,o=n+(r?1:-1);r?o--:++o<i;)if(e(t[o],o,t))return o;return-1}},28483:function(t,e,n){var r=n(25063)();t.exports=r},76778:function(t,e,n){var r=n(41848),i=n(62722),o=n(42351);t.exports=function(t,e,n){return e==e?o(t,e,n):r(t,i,n)}},25588:function(t,e,n){var r=n(64160),i=n(37005);t.exports=function(t){return i(t)&&"[object Map]"==r(t)}},62722:function(t){t.exports=function(t){return t!=t}},29221:function(t,e,n){var r=n(64160),i=n(37005);t.exports=function(t){return i(t)&&"[object Set]"==r(t)}},10313:function(t,e,n){var r=n(13218),i=n(25726),o=n(33498),a=Object.prototype.hasOwnProperty;t.exports=function(t){if(!r(t))return o(t);var e=i(t),n=[];for(var s in t)("constructor"!=s||!e&&a.call(t,s))&&n.push(s);return n}},42980:function(t,e,n){var r=n(46384),i=n(86556),o=n(28483),a=n(59783),s=n(13218),u=n(81704),l=n(36390);t.exports=function t(e,n,c,p,h){e!==n&&o(n,(function(o,u){if(h||(h=new r),s(o))a(e,n,u,c,t,p,h);else{var f=p?p(l(e,u),o,u+"",e,n,h):void 0;void 0===f&&(f=o),i(e,u,f)}}),u)}},59783:function(t,e,n){var r=n(86556),i=n(64626),o=n(77133),a=n(278),s=n(38517),u=n(35694),l=n(1469),c=n(29246),p=n(44144),h=n(23560),f=n(13218),d=n(68630),v=n(36719),m=n(36390),y=n(59881);t.exports=function(t,e,n,g,_,x,b){var w=m(t,n),S=m(e,n),E=b.get(S);if(E)r(t,n,E);else{var C=x?x(w,S,n+"",t,e,b):void 0,T=void 0===C;if(T){var A=l(S),M=!A&&p(S),k=!A&&!M&&v(S);C=S,A||M||k?l(w)?C=w:c(w)?C=a(w):M?(T=!1,C=i(S,!0)):k?(T=!1,C=o(S,!0)):C=[]:d(S)||u(S)?(C=w,u(w)?C=y(w):f(w)&&!h(w)||(C=s(S))):T=!1}T&&(b.set(S,C),_(C,S,g,x,b),b.delete(S)),r(t,n,C)}}},18674:function(t){t.exports=function(t){return function(e){return null==t?void 0:t[e]}}},5976:function(t,e,n){var r=n(6557),i=n(45357),o=n(30061);t.exports=function(t,e){return o(i(t,e,r),t+"")}},56560:function(t,e,n){var r=n(75703),i=n(38777),o=n(6557),a=i?function(t,e){return i(t,"toString",{configurable:!0,enumerable:!1,value:r(e),writable:!0})}:o;t.exports=a},14259:function(t){t.exports=function(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),(n=n>i?i:n)<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var o=Array(i);++r<i;)o[r]=t[r+e];return o}},80531:function(t,e,n){var r=n(62705),i=n(29932),o=n(1469),a=n(33448),s=r?r.prototype:void 0,u=s?s.toString:void 0;t.exports=function t(e){if("string"==typeof e)return e;if(o(e))return i(e,t)+"";if(a(e))return u?u.call(e):"";var n=e+"";return"0"==n&&1/e==-Infinity?"-0":n}},45652:function(t,e,n){var r=n(88668),i=n(47443),o=n(1196),a=n(74757),s=n(23593),u=n(21814);t.exports=function(t,e,n){var l=-1,c=i,p=t.length,h=!0,f=[],d=f;if(n)h=!1,c=o;else if(p>=200){var v=e?null:s(t);if(v)return u(v);h=!1,c=a,d=new r}else d=e?[]:f;t:for(;++l<p;){var m=t[l],y=e?e(m):m;if(m=n||0!==m?m:0,h&&y==y){for(var g=d.length;g--;)if(d[g]===y)continue t;e&&d.push(y),f.push(m)}else c(d,y,n)||(d!==f&&d.push(y),f.push(m))}return f}},40180:function(t,e,n){var r=n(14259);t.exports=function(t,e,n){var i=t.length;return n=void 0===n?i:n,!e&&n>=i?t:r(t,e,n)}},74318:function(t,e,n){var r=n(11149);t.exports=function(t){var e=new t.constructor(t.byteLength);return new r(e).set(new r(t)),e}},64626:function(t,e,n){t=n.nmd(t);var r=n(55639),i=e&&!e.nodeType&&e,o=i&&t&&!t.nodeType&&t,a=o&&o.exports===i?r.Buffer:void 0,s=a?a.allocUnsafe:void 0;t.exports=function(t,e){if(e)return t.slice();var n=t.length,r=s?s(n):new t.constructor(n);return t.copy(r),r}},57157:function(t,e,n){var r=n(74318);t.exports=function(t,e){var n=e?r(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}},93147:function(t){var e=/\w*$/;t.exports=function(t){var n=new t.constructor(t.source,e.exec(t));return n.lastIndex=t.lastIndex,n}},40419:function(t,e,n){var r=n(62705),i=r?r.prototype:void 0,o=i?i.valueOf:void 0;t.exports=function(t){return o?Object(o.call(t)):{}}},77133:function(t,e,n){var r=n(74318);t.exports=function(t,e){var n=e?r(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}},278:function(t){t.exports=function(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}},98363:function(t,e,n){var r=n(34865),i=n(89465);t.exports=function(t,e,n,o){var a=!n;n||(n={});for(var s=-1,u=e.length;++s<u;){var l=e[s],c=o?o(n[l],t[l],l,n,t):void 0;void 0===c&&(c=t[l]),a?i(n,l,c):r(n,l,c)}return n}},18805:function(t,e,n){var r=n(98363),i=n(99551);t.exports=function(t,e){return r(t,i(t),e)}},1911:function(t,e,n){var r=n(98363),i=n(51442);t.exports=function(t,e){return r(t,i(t),e)}},21463:function(t,e,n){var r=n(5976),i=n(16612);t.exports=function(t){return r((function(e,n){var r=-1,o=n.length,a=o>1?n[o-1]:void 0,s=o>2?n[2]:void 0;for(a=t.length>3&&"function"==typeof a?(o--,a):void 0,s&&i(n[0],n[1],s)&&(a=o<3?void 0:a,o=1),e=Object(e);++r<o;){var u=n[r];u&&t(e,u,r,a)}return e}))}},25063:function(t){t.exports=function(t){return function(e,n,r){for(var i=-1,o=Object(e),a=r(e),s=a.length;s--;){var u=a[t?s:++i];if(!1===n(o[u],u,o))break}return e}}},98805:function(t,e,n){var r=n(40180),i=n(62689),o=n(83140),a=n(79833);t.exports=function(t){return function(e){e=a(e);var n=i(e)?o(e):void 0,s=n?n[0]:e.charAt(0),u=n?r(n,1).join(""):e.slice(1);return s[t]()+u}}},35393:function(t,e,n){var r=n(62663),i=n(53816),o=n(58748),a=RegExp("['’]","g");t.exports=function(t){return function(e){return r(o(i(e).replace(a,"")),t,"")}}},23593:function(t,e,n){var r=n(58525),i=n(50308),o=n(21814),a=r&&1/o(new r([,-0]))[1]==1/0?function(t){return new r(t)}:i;t.exports=a},69389:function(t,e,n){var r=n(18674)({À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"});t.exports=r},38777:function(t,e,n){var r=n(10852),i=function(){try{var t=r(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();t.exports=i},46904:function(t,e,n){var r=n(68866),i=n(51442),o=n(81704);t.exports=function(t){return r(t,o,i)}},85924:function(t,e,n){var r=n(5569)(Object.getPrototypeOf,Object);t.exports=r},51442:function(t,e,n){var r=n(62488),i=n(85924),o=n(99551),a=n(70479),s=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)r(e,o(t)),t=i(t);return e}:a;t.exports=s},62689:function(t){var e=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");t.exports=function(t){return e.test(t)}},93157:function(t){var e=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;t.exports=function(t){return e.test(t)}},43824:function(t){var e=Object.prototype.hasOwnProperty;t.exports=function(t){var n=t.length,r=new t.constructor(n);return n&&"string"==typeof t[0]&&e.call(t,"index")&&(r.index=t.index,r.input=t.input),r}},29148:function(t,e,n){var r=n(74318),i=n(57157),o=n(93147),a=n(40419),s=n(77133);t.exports=function(t,e,n){var u=t.constructor;switch(e){case"[object ArrayBuffer]":return r(t);case"[object Boolean]":case"[object Date]":return new u(+t);case"[object DataView]":return i(t,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return s(t,n);case"[object Map]":case"[object Set]":return new u;case"[object Number]":case"[object String]":return new u(t);case"[object RegExp]":return o(t);case"[object Symbol]":return a(t)}}},38517:function(t,e,n){var r=n(3118),i=n(85924),o=n(25726);t.exports=function(t){return"function"!=typeof t.constructor||o(t)?{}:r(i(t))}},16612:function(t,e,n){var r=n(77813),i=n(98612),o=n(65776),a=n(13218);t.exports=function(t,e,n){if(!a(n))return!1;var s=typeof e;return!!("number"==s?i(n)&&o(e,n.length):"string"==s&&e in n)&&r(n[e],t)}},33498:function(t){t.exports=function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}},45357:function(t,e,n){var r=n(96874),i=Math.max;t.exports=function(t,e,n){return e=i(void 0===e?t.length-1:e,0),function(){for(var o=arguments,a=-1,s=i(o.length-e,0),u=Array(s);++a<s;)u[a]=o[e+a];a=-1;for(var l=Array(e+1);++a<e;)l[a]=o[a];return l[e]=n(u),r(t,this,l)}}},36390:function(t){t.exports=function(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}},30061:function(t,e,n){var r=n(56560),i=n(21275)(r);t.exports=i},21275:function(t){var e=Date.now;t.exports=function(t){var n=0,r=0;return function(){var i=e(),o=16-(i-r);if(r=i,o>0){if(++n>=800)return arguments[0]}else n=0;return t.apply(void 0,arguments)}}},42351:function(t){t.exports=function(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}},83140:function(t,e,n){var r=n(44286),i=n(62689),o=n(676);t.exports=function(t){return i(t)?o(t):r(t)}},676:function(t){var e="[\\ud800-\\udfff]",n="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",r="\\ud83c[\\udffb-\\udfff]",i="[^\\ud800-\\udfff]",o="(?:\\ud83c[\\udde6-\\uddff]){2}",a="[\\ud800-\\udbff][\\udc00-\\udfff]",s="(?:"+n+"|"+r+")"+"?",u="[\\ufe0e\\ufe0f]?",l=u+s+("(?:\\u200d(?:"+[i,o,a].join("|")+")"+u+s+")*"),c="(?:"+[i+n+"?",n,o,a,e].join("|")+")",p=RegExp(r+"(?="+r+")|"+c+l,"g");t.exports=function(t){return t.match(p)||[]}},2757:function(t){var e="\\u2700-\\u27bf",n="a-z\\xdf-\\xf6\\xf8-\\xff",r="A-Z\\xc0-\\xd6\\xd8-\\xde",i="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",o="["+i+"]",a="\\d+",s="[\\u2700-\\u27bf]",u="["+n+"]",l="[^\\ud800-\\udfff"+i+a+e+n+r+"]",c="(?:\\ud83c[\\udde6-\\uddff]){2}",p="[\\ud800-\\udbff][\\udc00-\\udfff]",h="["+r+"]",f="(?:"+u+"|"+l+")",d="(?:"+h+"|"+l+")",v="(?:['’](?:d|ll|m|re|s|t|ve))?",m="(?:['’](?:D|LL|M|RE|S|T|VE))?",y="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",g="[\\ufe0e\\ufe0f]?",_=g+y+("(?:\\u200d(?:"+["[^\\ud800-\\udfff]",c,p].join("|")+")"+g+y+")*"),x="(?:"+[s,c,p].join("|")+")"+_,b=RegExp([h+"?"+u+"+"+v+"(?="+[o,h,"$"].join("|")+")",d+"+"+m+"(?="+[o,h+f,"$"].join("|")+")",h+"?"+f+"+"+v,h+"+"+m,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",a,x].join("|"),"g");t.exports=function(t){return t.match(b)||[]}},68929:function(t,e,n){var r=n(48403),i=n(35393)((function(t,e,n){return e=e.toLowerCase(),t+(n?r(e):e)}));t.exports=i},48403:function(t,e,n){var r=n(79833),i=n(11700);t.exports=function(t){return i(r(t).toLowerCase())}},74691:function(t,e,n){var r=n(29750),i=n(14841);t.exports=function(t,e,n){return void 0===n&&(n=e,e=void 0),void 0!==n&&(n=(n=i(n))==n?n:0),void 0!==e&&(e=(e=i(e))==e?e:0),r(i(t),e,n)}},50361:function(t,e,n){var r=n(85990);t.exports=function(t){return r(t,5)}},75703:function(t){t.exports=function(t){return function(){return t}}},53816:function(t,e,n){var r=n(69389),i=n(79833),o=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,a=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g");t.exports=function(t){return(t=i(t))&&t.replace(o,r).replace(a,"")}},6557:function(t){t.exports=function(t){return t}},29246:function(t,e,n){var r=n(98612),i=n(37005);t.exports=function(t){return i(t)&&r(t)}},56688:function(t,e,n){var r=n(25588),i=n(7518),o=n(31167),a=o&&o.isMap,s=a?i(a):r;t.exports=s},14293:function(t){t.exports=function(t){return null==t}},81763:function(t,e,n){var r=n(44239),i=n(37005);t.exports=function(t){return"number"==typeof t||i(t)&&"[object Number]"==r(t)}},68630:function(t,e,n){var r=n(44239),i=n(85924),o=n(37005),a=Function.prototype,s=Object.prototype,u=a.toString,l=s.hasOwnProperty,c=u.call(Object);t.exports=function(t){if(!o(t)||"[object Object]"!=r(t))return!1;var e=i(t);if(null===e)return!0;var n=l.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&u.call(n)==c}},72928:function(t,e,n){var r=n(29221),i=n(7518),o=n(31167),a=o&&o.isSet,s=a?i(a):r;t.exports=s},47037:function(t,e,n){var r=n(44239),i=n(1469),o=n(37005);t.exports=function(t){return"string"==typeof t||!i(t)&&o(t)&&"[object String]"==r(t)}},52353:function(t){t.exports=function(t){return void 0===t}},81704:function(t,e,n){var r=n(14636),i=n(10313),o=n(98612);t.exports=function(t){return o(t)?r(t,!0):i(t)}},82492:function(t,e,n){var r=n(42980),i=n(21463)((function(t,e,n){r(t,e,n)}));t.exports=i},30236:function(t,e,n){var r=n(42980),i=n(21463)((function(t,e,n,i){r(t,e,n,i)}));t.exports=i},50308:function(t){t.exports=function(){}},23493:function(t,e,n){var r=n(23279),i=n(13218);t.exports=function(t,e,n){var o=!0,a=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return i(n)&&(o="leading"in n?!!n.leading:o,a="trailing"in n?!!n.trailing:a),r(t,e,{leading:o,maxWait:e,trailing:a})}},59881:function(t,e,n){var r=n(98363),i=n(81704);t.exports=function(t){return r(t,i(t))}},79833:function(t,e,n){var r=n(80531);t.exports=function(t){return null==t?"":r(t)}},44908:function(t,e,n){var r=n(45652);t.exports=function(t){return t&&t.length?r(t):[]}},11700:function(t,e,n){var r=n(98805)("toUpperCase");t.exports=r},58748:function(t,e,n){var r=n(49029),i=n(93157),o=n(79833),a=n(2757);t.exports=function(t,e,n){return t=o(t),void 0===(e=n?void 0:e)?i(t)?a(t):r(t):t.match(e)||[]}},6158:function(t,e,n){var r=n(25108);t.exports=function(){"use strict";var t,e,n;function i(r,i){if(t)if(e){var o="var sharedChunk = {}; ("+t+")(sharedChunk); ("+e+")(sharedChunk);",a={};t(a),n=i(a),"undefined"!=typeof window&&(n.workerUrl=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"})))}else e=i;else t=i}return i(["exports"],(function(t){function e(t,e){return t(e={exports:{}},e.exports),e.exports}var n=i;function i(t,e,n,r){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=n,this.p2y=r}i.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},i.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},i.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},i.prototype.solveCurveX=function(t,e){var n,r,i,o,a;for(void 0===e&&(e=1e-6),i=t,a=0;a<8;a++){if(o=this.sampleCurveX(i)-t,Math.abs(o)<e)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=o/s}if((i=t)<(n=0))return n;if(i>(r=1))return r;for(;n<r;){if(o=this.sampleCurveX(i),Math.abs(o-t)<e)return i;t>o?n=i:r=i,i=.5*(r-n)+n}return i},i.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var o=a;function a(t,e){this.x=t,this.y=e}a.prototype={clone:function(){return new a(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),r=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=r,this},_rotateAround:function(t,e){var n=Math.cos(t),r=Math.sin(t),i=e.y+r*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-r*(this.y-e.y),this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},a.convert=function(t){return t instanceof a?t:Array.isArray(t)?new a(t[0],t[1]):t};var s="undefined"!=typeof self?self:{},u=Math.pow(2,53)-1;function l(t,e,r,i){var o=new n(t,e,r,i);return function(t){return o.solve(t)}}var c=l(.25,.1,.25,1);function p(t,e,n){return Math.min(n,Math.max(e,t))}function h(t,e,n){var r=n-e,i=((t-e)%r+r)%r+e;return i===e?n:i}function f(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];for(var r=0,i=e;r<i.length;r+=1){var o=i[r];for(var a in o)t[a]=o[a]}return t}var d=1;function v(){return d++}function m(){return function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function y(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function g(t,e){t.forEach((function(t){e[t]&&(e[t]=e[t].bind(e))}))}function _(t,e){return-1!==t.indexOf(e,t.length-e.length)}function x(t,e,n){var r={};for(var i in t)r[i]=e.call(n||this,t[i],i,t);return r}function b(t,e,n){var r={};for(var i in t)e.call(n||this,t[i],i,t)&&(r[i]=t[i]);return r}function w(t){return Array.isArray(t)?t.map(w):"object"==typeof t&&t?x(t,w):t}var S={};function E(t){S[t]||(void 0!==r&&r.warn(t),S[t]=!0)}function C(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function T(t){for(var e=0,n=0,r=t.length,i=r-1,o=void 0,a=void 0;n<r;i=n++)e+=((a=t[i]).x-(o=t[n]).x)*(o.y+a.y);return e}function A(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function M(t){var e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(function(t,n,r,i){var o=r||i;return e[n]=!o||o.toLowerCase(),""})),e["max-age"]){var n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}var k=null;function P(t){if(null==k){var e=t.navigator?t.navigator.userAgent:null;k=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return k}function O(t){try{var e=s[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(t){return!1}}var L,I,R,D,N=s.performance&&s.performance.now?s.performance.now.bind(s.performance):Date.now.bind(Date),Z=s.requestAnimationFrame||s.mozRequestAnimationFrame||s.webkitRequestAnimationFrame||s.msRequestAnimationFrame,z=s.cancelAnimationFrame||s.mozCancelAnimationFrame||s.webkitCancelAnimationFrame||s.msCancelAnimationFrame,F={now:N,frame:function(t){var e=Z(t);return{cancel:function(){return z(e)}}},getImageData:function(t,e){void 0===e&&(e=0);var n=s.document.createElement("canvas"),r=n.getContext("2d");if(!r)throw new Error("failed to create canvas 2d context");return n.width=t.width,n.height=t.height,r.drawImage(t,0,0,t.width,t.height),r.getImageData(-e,-e,t.width+2*e,t.height+2*e)},resolveURL:function(t){return L||(L=s.document.createElement("a")),L.href=t,L.href},hardwareConcurrency:s.navigator&&s.navigator.hardwareConcurrency||4,get devicePixelRatio(){return s.devicePixelRatio},get prefersReducedMotion(){return!!s.matchMedia&&(null==I&&(I=s.matchMedia("(prefers-reduced-motion: reduce)")),I.matches)}},B={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},j={supported:!1,testSupport:function(t){!U&&D&&(V?G(t):R=t)}},U=!1,V=!1;function G(t){var e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,D),t.isContextLost())return;j.supported=!0}catch(t){}t.deleteTexture(e),U=!0}s.document&&((D=s.document.createElement("img")).onload=function(){R&&G(R),R=null,V=!0},D.onerror=function(){U=!0,R=null},D.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var H="01",W=function(t,e){this._transformRequestFn=t,this._customAccessToken=e,this._createSkuToken()};function q(t){return 0===t.indexOf("mapbox:")}W.prototype._createSkuToken=function(){var t=function(){for(var t="",e=0;e<10;e++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",H,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},W.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},W.prototype.transformRequest=function(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}},W.prototype.normalizeStyleURL=function(t,e){if(!q(t))return t;var n=Q(t);return n.path="/styles/v1"+n.path,this._makeAPIURL(n,this._customAccessToken||e)},W.prototype.normalizeGlyphsURL=function(t,e){if(!q(t))return t;var n=Q(t);return n.path="/fonts/v1"+n.path,this._makeAPIURL(n,this._customAccessToken||e)},W.prototype.normalizeSourceURL=function(t,e){if(!q(t))return t;var n=Q(t);return n.path="/v4/"+n.authority+".json",n.params.push("secure"),this._makeAPIURL(n,this._customAccessToken||e)},W.prototype.normalizeSpriteURL=function(t,e,n,r){var i=Q(t);return q(t)?(i.path="/styles/v1"+i.path+"/sprite"+e+n,this._makeAPIURL(i,this._customAccessToken||r)):(i.path+=""+e+n,J(i))},W.prototype.normalizeTileURL=function(t,e){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!q(t))return t;var n=Q(t);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,(F.devicePixelRatio>=2||512===e?"@2x":"")+(j.supported?".webp":"$1")),n.path=n.path.replace(/^.+\/v4\//,"/"),n.path="/v4"+n.path;var r=this._customAccessToken||function(t){for(var e=0,n=t;e<n.length;e+=1){var r=n[e].match(/^access_token=(.*)$/);if(r)return r[1]}return null}(n.params)||B.ACCESS_TOKEN;return B.REQUIRE_ACCESS_TOKEN&&r&&this._skuToken&&n.params.push("sku="+this._skuToken),this._makeAPIURL(n,r)},W.prototype.canonicalizeTileURL=function(t,e){var n=Q(t);if(!n.path.match(/(^\/v4\/)/)||!n.path.match(/\.[\w]+$/))return t;var r="mapbox://tiles/";r+=n.path.replace("/v4/","");var i=n.params;return e&&(i=i.filter((function(t){return!t.match(/^access_token=/)}))),i.length&&(r+="?"+i.join("&")),r},W.prototype.canonicalizeTileset=function(t,e){for(var n=!!e&&q(e),r=[],i=0,o=t.tiles||[];i<o.length;i+=1){var a=o[i];Y(a)?r.push(this.canonicalizeTileURL(a,n)):r.push(a)}return r},W.prototype._makeAPIURL=function(t,e){var n="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",r=Q(B.API_URL);if(t.protocol=r.protocol,t.authority=r.authority,"http"===t.protocol){var i=t.params.indexOf("secure");i>=0&&t.params.splice(i,1)}if("/"!==r.path&&(t.path=""+r.path+t.path),!B.REQUIRE_ACCESS_TOKEN)return J(t);if(!(e=e||B.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+n);if("s"===e[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+n);return t.params=t.params.filter((function(t){return-1===t.indexOf("access_token")})),t.params.push("access_token="+e),J(t)};var X=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function Y(t){return X.test(t)}var K=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Q(t){var e=t.match(K);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function J(t){var e=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+e}function $(t){if(!t)return null;var e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(s.atob(e[1]).split("").map((function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)})).join("")))}catch(t){return null}}var tt=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};tt.prototype.getStorageKey=function(t){var e,n=$(B.ACCESS_TOKEN);return e=n&&n.u?s.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(function(t,e){return String.fromCharCode(Number("0x"+e))}))):B.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+e:"mapbox.eventData:"+e},tt.prototype.fetchEventData=function(){var t=O("localStorage"),e=this.getStorageKey(),n=this.getStorageKey("uuid");if(t)try{var r=s.localStorage.getItem(e);r&&(this.eventData=JSON.parse(r));var i=s.localStorage.getItem(n);i&&(this.anonId=i)}catch(t){E("Unable to read from LocalStorage")}},tt.prototype.saveEventData=function(){var t=O("localStorage"),e=this.getStorageKey(),n=this.getStorageKey("uuid");if(t)try{s.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&s.localStorage.setItem(e,JSON.stringify(this.eventData))}catch(t){E("Unable to write to LocalStorage")}},tt.prototype.processRequests=function(t){},tt.prototype.postEvent=function(t,e,n,r){var i=this;if(B.EVENTS_URL){var o=Q(B.EVENTS_URL);o.params.push("access_token="+(r||B.ACCESS_TOKEN||""));var a={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:H,userId:this.anonId},s=e?f(a,e):a,u={url:J(o),headers:{"Content-Type":"text/plain"},body:JSON.stringify([s])};this.pendingRequest=wt(u,(function(t){i.pendingRequest=null,n(t),i.saveEventData(),i.processRequests(r)}))}},tt.prototype.queueRequest=function(t,e){this.queue.push(t),this.processRequests(e)};var et,nt,rt=function(t){function e(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.postMapLoadEvent=function(t,e,n,r){this.skuToken=n,(B.EVENTS_URL&&r||B.ACCESS_TOKEN&&Array.isArray(t)&&t.some((function(t){return q(t)||Y(t)})))&&this.queueRequest({id:e,timestamp:Date.now()},r)},e.prototype.processRequests=function(t){var e=this;if(!this.pendingRequest&&0!==this.queue.length){var n=this.queue.shift(),r=n.id,i=n.timestamp;r&&this.success[r]||(this.anonId||this.fetchEventData(),y(this.anonId)||(this.anonId=m()),this.postEvent(i,{skuToken:this.skuToken},(function(t){t||r&&(e.success[r]=!0)}),t))}},e}(tt),it=new(function(t){function e(e){t.call(this,"appUserTurnstile"),this._customAccessToken=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.postTurnstileEvent=function(t,e){B.EVENTS_URL&&B.ACCESS_TOKEN&&Array.isArray(t)&&t.some((function(t){return q(t)||Y(t)}))&&this.queueRequest(Date.now(),e)},e.prototype.processRequests=function(t){var e=this;if(!this.pendingRequest&&0!==this.queue.length){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var n=$(B.ACCESS_TOKEN),r=n?n.u:B.ACCESS_TOKEN,i=r!==this.eventData.tokenU;y(this.anonId)||(this.anonId=m(),i=!0);var o=this.queue.shift();if(this.eventData.lastSuccess){var a=new Date(this.eventData.lastSuccess),s=new Date(o),u=(o-this.eventData.lastSuccess)/864e5;i=i||u>=1||u<-1||a.getDate()!==s.getDate()}else i=!0;if(!i)return this.processRequests();this.postEvent(o,{"enabled.telemetry":!1},(function(t){t||(e.eventData.lastSuccess=o,e.eventData.tokenU=r)}),t)}},e}(tt)),ot=it.postTurnstileEvent.bind(it),at=new rt,st=at.postMapLoadEvent.bind(at),ut=500,lt=50;function ct(){s.caches&&!et&&(et=s.caches.open("mapbox-tiles"))}function pt(t){var e=t.indexOf("?");return e<0?t:t.slice(0,e)}var ht,ft=1/0;function dt(){return null==ht&&(ht=s.OffscreenCanvas&&new s.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof s.createImageBitmap),ht}var vt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(vt);var mt,yt,gt=function(t){function e(e,n,r){401===n&&Y(r)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,e),this.status=n,this.url=r,this.name=this.constructor.name,this.message=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},e}(Error),_t=A()?function(){return self.worker&&self.worker.referrer}:function(){return("blob:"===s.location.protocol?s.parent:s).location.href},xt=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(_t())&&!/^\w+:/.test(n))){if(s.fetch&&s.Request&&s.AbortController&&s.Request.prototype.hasOwnProperty("signal"))return function(t,e){var n,r=new s.AbortController,i=new s.Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:_t(),signal:r.signal}),o=!1,a=!1,u=(n=i.url).indexOf("sku=")>0&&Y(n);"json"===t.type&&i.headers.set("Accept","application/json");var l=function(n,r,o){if(!a){if(n&&"SecurityError"!==n.message&&E(n),r&&o)return c(r);var l=Date.now();s.fetch(i).then((function(n){if(n.ok){var r=u?n.clone():null;return c(n,r,l)}return e(new gt(n.statusText,n.status,t.url))})).catch((function(t){20!==t.code&&e(new Error(t.message))}))}},c=function(n,r,u){("arrayBuffer"===t.type?n.arrayBuffer():"json"===t.type?n.json():n.text()).then((function(t){a||(r&&u&&function(t,e,n){if(ct(),et){var r={status:e.status,statusText:e.statusText,headers:new s.Headers};e.headers.forEach((function(t,e){return r.headers.set(e,t)}));var i=M(e.headers.get("Cache-Control")||"");i["no-store"]||(i["max-age"]&&r.headers.set("Expires",new Date(n+1e3*i["max-age"]).toUTCString()),new Date(r.headers.get("Expires")).getTime()-n<42e4||function(t,e){if(void 0===nt)try{new Response(new ReadableStream),nt=!0}catch(t){nt=!1}nt?e(t.body):t.blob().then(e)}(e,(function(e){var n=new s.Response(e,r);ct(),et&&et.then((function(e){return e.put(pt(t.url),n)})).catch((function(t){return E(t.message)}))})))}}(i,r,u),o=!0,e(null,t,n.headers.get("Cache-Control"),n.headers.get("Expires")))})).catch((function(t){a||e(new Error(t.message))}))};return u?function(t,e){if(ct(),!et)return e(null);var n=pt(t.url);et.then((function(t){t.match(n).then((function(r){var i=function(t){if(!t)return!1;var e=new Date(t.headers.get("Expires")||0),n=M(t.headers.get("Cache-Control")||"");return e>Date.now()&&!n["no-cache"]}(r);t.delete(n),i&&t.put(n,r.clone()),e(null,r,i)})).catch(e)})).catch(e)}(i,l):l(null,null),{cancel:function(){a=!0,o||r.abort()}}}(t,e);if(A()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(t,e){var n=new s.XMLHttpRequest;for(var r in n.open(t.method||"GET",t.url,!0),"arrayBuffer"===t.type&&(n.responseType="arraybuffer"),t.headers)n.setRequestHeader(r,t.headers[r]);return"json"===t.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===t.credentials,n.onerror=function(){e(new Error(n.statusText))},n.onload=function(){if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){var r=n.response;if("json"===t.type)try{r=JSON.parse(n.response)}catch(t){return e(t)}e(null,r,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"))}else e(new gt(n.statusText,n.status,t.url))},n.send(t.body),{cancel:function(){return n.abort()}}}(t,e)},bt=function(t,e){return xt(f(t,{type:"arrayBuffer"}),e)},wt=function(t,e){return xt(f(t,{method:"POST"}),e)},St="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";mt=[],yt=0;var Et=function(t,e){if(j.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),yt>=B.MAX_PARALLEL_IMAGE_REQUESTS){var n={requestParameters:t,callback:e,cancelled:!1,cancel:function(){this.cancelled=!0}};return mt.push(n),n}yt++;var r=!1,i=function(){if(!r)for(r=!0,yt--;mt.length&&yt<B.MAX_PARALLEL_IMAGE_REQUESTS;){var t=mt.shift();t.cancelled||(t.cancel=Et(t.requestParameters,t.callback).cancel)}},o=bt(t,(function(t,n,r,o){i(),t?e(t):n&&(dt()?function(t,e){var n=new s.Blob([new Uint8Array(t)],{type:"image/png"});s.createImageBitmap(n).then((function(t){e(null,t)})).catch((function(t){e(new Error("Could not load image because of "+t.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))}))}(n,e):function(t,e,n,r){var i=new s.Image,o=s.URL;i.onload=function(){e(null,i),o.revokeObjectURL(i.src),i.onload=null,s.requestAnimationFrame((function(){i.src=St}))},i.onerror=function(){return e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var a=new s.Blob([new Uint8Array(t)],{type:"image/png"});i.cacheControl=n,i.expires=r,i.src=t.byteLength?o.createObjectURL(a):St}(n,e,r,o))}));return{cancel:function(){o.cancel(),i()}}};function Ct(t,e,n){n[t]&&-1!==n[t].indexOf(e)||(n[t]=n[t]||[],n[t].push(e))}function Tt(t,e,n){if(n&&n[t]){var r=n[t].indexOf(e);-1!==r&&n[t].splice(r,1)}}var At=function(t,e){void 0===e&&(e={}),f(this,e),this.type=t},Mt=function(t){function e(e,n){void 0===n&&(n={}),t.call(this,"error",f({error:e},n))}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(At),kt=function(){};kt.prototype.on=function(t,e){return this._listeners=this._listeners||{},Ct(t,e,this._listeners),this},kt.prototype.off=function(t,e){return Tt(t,e,this._listeners),Tt(t,e,this._oneTimeListeners),this},kt.prototype.once=function(t,e){return this._oneTimeListeners=this._oneTimeListeners||{},Ct(t,e,this._oneTimeListeners),this},kt.prototype.fire=function(t,e){"string"==typeof t&&(t=new At(t,e||{}));var n=t.type;if(this.listens(n)){t.target=this;for(var i=0,o=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];i<o.length;i+=1)o[i].call(this,t);for(var a=0,s=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];a<s.length;a+=1){var u=s[a];Tt(n,u,this._oneTimeListeners),u.call(this,t)}var l=this._eventedParent;l&&(f(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),l.fire(t))}else t instanceof Mt&&r.error(t.error);return this},kt.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},kt.prototype.setEventedParent=function(t,e){return this._eventedParent=t,this._eventedParentData=e,this};var Pt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Ot=function(t,e,n,r){this.message=(t?t+": ":"")+n,r&&(this.identifier=r),null!=e&&e.__line__&&(this.line=e.__line__)};function Lt(t){var e=t.value;return e?[new Ot(t.key,e,"constants have been deprecated as of v8")]:[]}function It(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];for(var r=0,i=e;r<i.length;r+=1){var o=i[r];for(var a in o)t[a]=o[a]}return t}function Rt(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Dt(t){if(Array.isArray(t))return t.map(Dt);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var e={};for(var n in t)e[n]=Dt(t[n]);return e}return Rt(t)}var Nt=function(t){function e(e,n){t.call(this,n),this.message=n,this.key=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Error),Zt=function(t,e){void 0===e&&(e=[]),this.parent=t,this.bindings={};for(var n=0,r=e;n<r.length;n+=1){var i=r[n];this.bindings[i[0]]=i[1]}};Zt.prototype.concat=function(t){return new Zt(this,t)},Zt.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},Zt.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var zt={kind:"null"},Ft={kind:"number"},Bt={kind:"string"},jt={kind:"boolean"},Ut={kind:"color"},Vt={kind:"object"},Gt={kind:"value"},Ht={kind:"collator"},Wt={kind:"formatted"},qt={kind:"resolvedImage"};function Xt(t,e){return{kind:"array",itemType:t,N:e}}function Yt(t){if("array"===t.kind){var e=Yt(t.itemType);return"number"==typeof t.N?"array<"+e+", "+t.N+">":"value"===t.itemType.kind?"array":"array<"+e+">"}return t.kind}var Kt=[zt,Ft,Bt,jt,Ut,Wt,Vt,Xt(Gt),qt];function Qt(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Qt(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(var n=0,r=Kt;n<r.length;n+=1)if(!Qt(r[n],e))return null}return"Expected "+Yt(t)+" but found "+Yt(e)+" instead."}function Jt(t,e){return e.some((function(e){return e.kind===t.kind}))}function $t(t,e){return e.some((function(e){return"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t}))}var te=e((function(t,e){var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(t){return(t=Math.round(t))<0?0:t>255?255:t}function i(t){return r("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function o(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function a(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{e.parseCSSColor=function(t){var e,s=t.replace(/ /g,"").toLowerCase();if(s in n)return n[s].slice();if("#"===s[0])return 4===s.length?(e=parseInt(s.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===s.length&&(e=parseInt(s.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var u=s.indexOf("("),l=s.indexOf(")");if(-1!==u&&l+1===s.length){var c=s.substr(0,u),p=s.substr(u+1,l-(u+1)).split(","),h=1;switch(c){case"rgba":if(4!==p.length)return null;h=o(p.pop());case"rgb":return 3!==p.length?null:[i(p[0]),i(p[1]),i(p[2]),h];case"hsla":if(4!==p.length)return null;h=o(p.pop());case"hsl":if(3!==p.length)return null;var f=(parseFloat(p[0])%360+360)%360/360,d=o(p[1]),v=o(p[2]),m=v<=.5?v*(d+1):v+d-v*d,y=2*v-m;return[r(255*a(y,m,f+1/3)),r(255*a(y,m,f)),r(255*a(y,m,f-1/3)),h];default:return null}}return null}}catch(t){}})).parseCSSColor,ee=function(t,e,n,r){void 0===r&&(r=1),this.r=t,this.g=e,this.b=n,this.a=r};ee.parse=function(t){if(t){if(t instanceof ee)return t;if("string"==typeof t){var e=te(t);if(e)return new ee(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3])}}},ee.prototype.toString=function(){var t=this.toArray(),e=t[1],n=t[2],r=t[3];return"rgba("+Math.round(t[0])+","+Math.round(e)+","+Math.round(n)+","+r+")"},ee.prototype.toArray=function(){var t=this.a;return 0===t?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},ee.black=new ee(0,0,0,1),ee.white=new ee(1,1,1,1),ee.transparent=new ee(0,0,0,0),ee.red=new ee(1,0,0,1);var ne=function(t,e,n){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};ne.prototype.compare=function(t,e){return this.collator.compare(t,e)},ne.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var re=function(t,e,n,r,i){this.text=t,this.image=e,this.scale=n,this.fontStack=r,this.textColor=i},ie=function(t){this.sections=t};ie.fromString=function(t){return new ie([new re(t,null,null,null,null)])},ie.prototype.isEmpty=function(){return 0===this.sections.length||!this.sections.some((function(t){return 0!==t.text.length||t.image&&0!==t.image.name.length}))},ie.factory=function(t){return t instanceof ie?t:ie.fromString(t)},ie.prototype.toString=function(){return 0===this.sections.length?"":this.sections.map((function(t){return t.text})).join("")},ie.prototype.serialize=function(){for(var t=["format"],e=0,n=this.sections;e<n.length;e+=1){var r=n[e];if(r.image)t.push(["image",r.image.name]);else{t.push(r.text);var i={};r.fontStack&&(i["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(i["font-scale"]=r.scale),r.textColor&&(i["text-color"]=["rgba"].concat(r.textColor.toArray())),t.push(i)}}return t};var oe=function(t){this.name=t.name,this.available=t.available};function ae(t,e,n,r){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:"Invalid rgba value ["+[t,e,n,r].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+("number"==typeof r?[t,e,n,r]:[t,e,n]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function se(t){if(null===t)return!0;if("string"==typeof t)return!0;if("boolean"==typeof t)return!0;if("number"==typeof t)return!0;if(t instanceof ee)return!0;if(t instanceof ne)return!0;if(t instanceof ie)return!0;if(t instanceof oe)return!0;if(Array.isArray(t)){for(var e=0,n=t;e<n.length;e+=1)if(!se(n[e]))return!1;return!0}if("object"==typeof t){for(var r in t)if(!se(t[r]))return!1;return!0}return!1}function ue(t){if(null===t)return zt;if("string"==typeof t)return Bt;if("boolean"==typeof t)return jt;if("number"==typeof t)return Ft;if(t instanceof ee)return Ut;if(t instanceof ne)return Ht;if(t instanceof ie)return Wt;if(t instanceof oe)return qt;if(Array.isArray(t)){for(var e,n=t.length,r=0,i=t;r<i.length;r+=1){var o=ue(i[r]);if(e){if(e===o)continue;e=Gt;break}e=o}return Xt(e||Gt,n)}return Vt}function le(t){var e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof ee||t instanceof ie||t instanceof oe?t.toString():JSON.stringify(t)}oe.prototype.toString=function(){return this.name},oe.fromString=function(t){return t?new oe({name:t,available:!1}):null},oe.prototype.serialize=function(){return["image",this.name]};var ce=function(t,e){this.type=t,this.value=e};ce.parse=function(t,e){if(2!==t.length)return e.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!se(t[1]))return e.error("invalid value");var n=t[1],r=ue(n),i=e.expectedType;return"array"!==r.kind||0!==r.N||!i||"array"!==i.kind||"number"==typeof i.N&&0!==i.N||(r=i),new ce(r,n)},ce.prototype.evaluate=function(){return this.value},ce.prototype.eachChild=function(){},ce.prototype.outputDefined=function(){return!0},ce.prototype.serialize=function(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof ee?["rgba"].concat(this.value.toArray()):this.value instanceof ie?this.value.serialize():this.value};var pe=function(t){this.name="ExpressionEvaluationError",this.message=t};pe.prototype.toJSON=function(){return this.message};var he={string:Bt,number:Ft,boolean:jt,object:Vt},fe=function(t,e){this.type=t,this.args=e};fe.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var n,r=1,i=t[0];if("array"===i){var o,a;if(t.length>2){var s=t[1];if("string"!=typeof s||!(s in he)||"object"===s)return e.error('The item type argument of "array" must be one of string, number, boolean',1);o=he[s],r++}else o=Gt;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);a=t[2],r++}n=Xt(o,a)}else n=he[i];for(var u=[];r<t.length;r++){var l=e.parse(t[r],r,Gt);if(!l)return null;u.push(l)}return new fe(n,u)},fe.prototype.evaluate=function(t){for(var e=0;e<this.args.length;e++){var n=this.args[e].evaluate(t);if(!Qt(this.type,ue(n)))return n;if(e===this.args.length-1)throw new pe("Expected value to be of type "+Yt(this.type)+", but found "+Yt(ue(n))+" instead.")}return null},fe.prototype.eachChild=function(t){this.args.forEach(t)},fe.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},fe.prototype.serialize=function(){var t=this.type,e=[t.kind];if("array"===t.kind){var n=t.itemType;if("string"===n.kind||"number"===n.kind||"boolean"===n.kind){e.push(n.kind);var r=t.N;("number"==typeof r||this.args.length>1)&&e.push(r)}}return e.concat(this.args.map((function(t){return t.serialize()})))};var de=function(t){this.type=Wt,this.sections=t};de.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var n=t[1];if(!Array.isArray(n)&&"object"==typeof n)return e.error("First argument must be an image or text section.");for(var r=[],i=!1,o=1;o<=t.length-1;++o){var a=t[o];if(i&&"object"==typeof a&&!Array.isArray(a)){i=!1;var s=null;if(a["font-scale"]&&!(s=e.parse(a["font-scale"],1,Ft)))return null;var u=null;if(a["text-font"]&&!(u=e.parse(a["text-font"],1,Xt(Bt))))return null;var l=null;if(a["text-color"]&&!(l=e.parse(a["text-color"],1,Ut)))return null;var c=r[r.length-1];c.scale=s,c.font=u,c.textColor=l}else{var p=e.parse(t[o],1,Gt);if(!p)return null;var h=p.type.kind;if("string"!==h&&"value"!==h&&"null"!==h&&"resolvedImage"!==h)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");i=!0,r.push({content:p,scale:null,font:null,textColor:null})}}return new de(r)},de.prototype.evaluate=function(t){return new ie(this.sections.map((function(e){var n=e.content.evaluate(t);return ue(n)===qt?new re("",n,null,null,null):new re(le(n),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)})))},de.prototype.eachChild=function(t){for(var e=0,n=this.sections;e<n.length;e+=1){var r=n[e];t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor)}},de.prototype.outputDefined=function(){return!1},de.prototype.serialize=function(){for(var t=["format"],e=0,n=this.sections;e<n.length;e+=1){var r=n[e];t.push(r.content.serialize());var i={};r.scale&&(i["font-scale"]=r.scale.serialize()),r.font&&(i["text-font"]=r.font.serialize()),r.textColor&&(i["text-color"]=r.textColor.serialize()),t.push(i)}return t};var ve=function(t){this.type=qt,this.input=t};ve.parse=function(t,e){if(2!==t.length)return e.error("Expected two arguments.");var n=e.parse(t[1],1,Bt);return n?new ve(n):e.error("No image name provided.")},ve.prototype.evaluate=function(t){var e=this.input.evaluate(t),n=oe.fromString(e);return n&&t.availableImages&&(n.available=t.availableImages.indexOf(e)>-1),n},ve.prototype.eachChild=function(t){t(this.input)},ve.prototype.outputDefined=function(){return!1},ve.prototype.serialize=function(){return["image",this.input.serialize()]};var me={"to-boolean":jt,"to-color":Ut,"to-number":Ft,"to-string":Bt},ye=function(t,e){this.type=t,this.args=e};ye.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var n=t[0];if(("to-boolean"===n||"to-string"===n)&&2!==t.length)return e.error("Expected one argument.");for(var r=me[n],i=[],o=1;o<t.length;o++){var a=e.parse(t[o],o,Gt);if(!a)return null;i.push(a)}return new ye(r,i)},ye.prototype.evaluate=function(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){for(var e,n,r=0,i=this.args;r<i.length;r+=1){if(n=null,(e=i[r].evaluate(t))instanceof ee)return e;if("string"==typeof e){var o=t.parseColor(e);if(o)return o}else if(Array.isArray(e)&&!(n=e.length<3||e.length>4?"Invalid rbga value "+JSON.stringify(e)+": expected an array containing either three or four numeric values.":ae(e[0],e[1],e[2],e[3])))return new ee(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new pe(n||"Could not parse color from value '"+("string"==typeof e?e:String(JSON.stringify(e)))+"'")}if("number"===this.type.kind){for(var a=null,s=0,u=this.args;s<u.length;s+=1){if(null===(a=u[s].evaluate(t)))return 0;var l=Number(a);if(!isNaN(l))return l}throw new pe("Could not convert "+JSON.stringify(a)+" to number.")}return"formatted"===this.type.kind?ie.fromString(le(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?oe.fromString(le(this.args[0].evaluate(t))):le(this.args[0].evaluate(t))},ye.prototype.eachChild=function(t){this.args.forEach(t)},ye.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},ye.prototype.serialize=function(){if("formatted"===this.type.kind)return new de([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new ve(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild((function(e){t.push(e.serialize())})),t};var ge=["Unknown","Point","LineString","Polygon"],_e=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};_e.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},_e.prototype.geometryType=function(){return this.feature?"number"==typeof this.feature.type?ge[this.feature.type]:this.feature.type:null},_e.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},_e.prototype.canonicalID=function(){return this.canonical},_e.prototype.properties=function(){return this.feature&&this.feature.properties||{}},_e.prototype.parseColor=function(t){var e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=ee.parse(t)),e};var xe=function(t,e,n,r){this.name=t,this.type=e,this._evaluate=n,this.args=r};xe.prototype.evaluate=function(t){return this._evaluate(t,this.args)},xe.prototype.eachChild=function(t){this.args.forEach(t)},xe.prototype.outputDefined=function(){return!1},xe.prototype.serialize=function(){return[this.name].concat(this.args.map((function(t){return t.serialize()})))},xe.parse=function(t,e){var n,r=t[0],i=xe.definitions[r];if(!i)return e.error('Unknown expression "'+r+'". If you wanted a literal array, use ["literal", [...]].',0);for(var o=Array.isArray(i)?i[0]:i.type,a=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,s=a.filter((function(e){var n=e[0];return!Array.isArray(n)||n.length===t.length-1})),u=null,l=0,c=s;l<c.length;l+=1){var p=c[l],h=p[0],f=p[1];u=new Ue(e.registry,e.path,null,e.scope);for(var d=[],v=!1,m=1;m<t.length;m++){var y=t[m],g=Array.isArray(h)?h[m-1]:h.type,_=u.parse(y,1+d.length,g);if(!_){v=!0;break}d.push(_)}if(!v)if(Array.isArray(h)&&h.length!==d.length)u.error("Expected "+h.length+" arguments, but found "+d.length+" instead.");else{for(var x=0;x<d.length;x++){var b=Array.isArray(h)?h[x]:h.type,w=d[x];u.concat(x+1).checkSubtype(b,w.type)}if(0===u.errors.length)return new xe(r,o,f,d)}}if(1===s.length)(n=e.errors).push.apply(n,u.errors);else{for(var S=(s.length?s:a).map((function(t){var e;return e=t[0],Array.isArray(e)?"("+e.map(Yt).join(", ")+")":"("+Yt(e.type)+"...)"})).join(" | "),E=[],C=1;C<t.length;C++){var T=e.parse(t[C],1+E.length);if(!T)return null;E.push(Yt(T.type))}e.error("Expected arguments of type "+S+", but found ("+E.join(", ")+") instead.")}return null},xe.register=function(t,e){for(var n in xe.definitions=e,e)t[n]=xe};var be=function(t,e,n){this.type=Ht,this.locale=n,this.caseSensitive=t,this.diacriticSensitive=e};function we(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Se(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Ee(t,e){var n=(180+t[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,i=Math.pow(2,e.z);return[Math.round(n*i*8192),Math.round(r*i*8192)]}function Ce(t,e,n){return e[1]>t[1]!=n[1]>t[1]&&t[0]<(n[0]-e[0])*(t[1]-e[1])/(n[1]-e[1])+e[0]}function Te(t,e){for(var n,r,i,o,a,s,u,l=!1,c=0,p=e.length;c<p;c++)for(var h=e[c],f=0,d=h.length;f<d-1;f++){if((o=(n=t)[0]-(r=h[f])[0])*(u=n[1]-(i=h[f+1])[1])-(s=n[0]-i[0])*(a=n[1]-r[1])==0&&o*s<=0&&a*u<=0)return!1;Ce(t,h[f],h[f+1])&&(l=!l)}return l}function Ae(t,e){for(var n=0;n<e.length;n++)if(Te(t,e[n]))return!0;return!1}function Me(t,e,n,r){var i=r[0]-n[0],o=r[1]-n[1],a=(t[0]-n[0])*o-i*(t[1]-n[1]),s=(e[0]-n[0])*o-i*(e[1]-n[1]);return a>0&&s<0||a<0&&s>0}function ke(t,e,n){for(var r=0,i=n;r<i.length;r+=1)for(var o=i[r],a=0;a<o.length-1;++a)if(0!=(p=[(c=o[a+1])[0]-(l=o[a])[0],c[1]-l[1]])[0]*(h=[(u=e)[0]-(s=t)[0],u[1]-s[1]])[1]-p[1]*h[0]&&Me(s,u,l,c)&&Me(l,c,s,u))return!0;var s,u,l,c,p,h;return!1}function Pe(t,e){for(var n=0;n<t.length;++n)if(!Te(t[n],e))return!1;for(var r=0;r<t.length-1;++r)if(ke(t[r],t[r+1],e))return!1;return!0}function Oe(t,e){for(var n=0;n<e.length;n++)if(Pe(t,e[n]))return!0;return!1}function Le(t,e,n){for(var r=[],i=0;i<t.length;i++){for(var o=[],a=0;a<t[i].length;a++){var s=Ee(t[i][a],n);we(e,s),o.push(s)}r.push(o)}return r}function Ie(t,e,n){for(var r=[],i=0;i<t.length;i++){var o=Le(t[i],e,n);r.push(o)}return r}function Re(t,e,n,r){if(t[0]<n[0]||t[0]>n[2]){var i=.5*r,o=t[0]-n[0]>i?-r:n[0]-t[0]>i?r:0;0===o&&(o=t[0]-n[2]>i?-r:n[2]-t[0]>i?r:0),t[0]+=o}we(e,t)}function De(t,e,n,r){for(var i=8192*Math.pow(2,r.z),o=[8192*r.x,8192*r.y],a=[],s=0,u=t;s<u.length;s+=1)for(var l=0,c=u[s];l<c.length;l+=1){var p=c[l],h=[p.x+o[0],p.y+o[1]];Re(h,e,n,i),a.push(h)}return a}function Ne(t,e,n,r){for(var i,o=8192*Math.pow(2,r.z),a=[8192*r.x,8192*r.y],s=[],u=0,l=t;u<l.length;u+=1){for(var c=[],p=0,h=l[u];p<h.length;p+=1){var f=h[p],d=[f.x+a[0],f.y+a[1]];we(e,d),c.push(d)}s.push(c)}if(e[2]-e[0]<=o/2){(i=e)[0]=i[1]=1/0,i[2]=i[3]=-1/0;for(var v=0,m=s;v<m.length;v+=1)for(var y=0,g=m[v];y<g.length;y+=1)Re(g[y],e,n,o)}return s}be.parse=function(t,e){if(2!==t.length)return e.error("Expected one argument.");var n=t[1];if("object"!=typeof n||Array.isArray(n))return e.error("Collator options argument must be an object.");var r=e.parse(void 0!==n["case-sensitive"]&&n["case-sensitive"],1,jt);if(!r)return null;var i=e.parse(void 0!==n["diacritic-sensitive"]&&n["diacritic-sensitive"],1,jt);if(!i)return null;var o=null;return n.locale&&!(o=e.parse(n.locale,1,Bt))?null:new be(r,i,o)},be.prototype.evaluate=function(t){return new ne(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},be.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},be.prototype.outputDefined=function(){return!1},be.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var Ze=function(t,e){this.type=jt,this.geojson=t,this.geometries=e};function ze(t){if(t instanceof xe){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof Ze)return!1;var e=!0;return t.eachChild((function(t){e&&!ze(t)&&(e=!1)})),e}function Fe(t){if(t instanceof xe&&"feature-state"===t.name)return!1;var e=!0;return t.eachChild((function(t){e&&!Fe(t)&&(e=!1)})),e}function Be(t,e){if(t instanceof xe&&e.indexOf(t.name)>=0)return!1;var n=!0;return t.eachChild((function(t){n&&!Be(t,e)&&(n=!1)})),n}Ze.parse=function(t,e){if(2!==t.length)return e.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(se(t[1])){var n=t[1];if("FeatureCollection"===n.type)for(var r=0;r<n.features.length;++r){var i=n.features[r].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new Ze(n,n.features[r].geometry)}else if("Feature"===n.type){var o=n.geometry.type;if("Polygon"===o||"MultiPolygon"===o)return new Ze(n,n.geometry)}else if("Polygon"===n.type||"MultiPolygon"===n.type)return new Ze(n,n)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Ze.prototype.evaluate=function(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){var n=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=t.canonicalID();if("Polygon"===e.type){var o=Le(e.coordinates,r,i),a=De(t.geometry(),n,r,i);if(!Se(n,r))return!1;for(var s=0,u=a;s<u.length;s+=1)if(!Te(u[s],o))return!1}if("MultiPolygon"===e.type){var l=Ie(e.coordinates,r,i),c=De(t.geometry(),n,r,i);if(!Se(n,r))return!1;for(var p=0,h=c;p<h.length;p+=1)if(!Ae(h[p],l))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){var n=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=t.canonicalID();if("Polygon"===e.type){var o=Le(e.coordinates,r,i),a=Ne(t.geometry(),n,r,i);if(!Se(n,r))return!1;for(var s=0,u=a;s<u.length;s+=1)if(!Pe(u[s],o))return!1}if("MultiPolygon"===e.type){var l=Ie(e.coordinates,r,i),c=Ne(t.geometry(),n,r,i);if(!Se(n,r))return!1;for(var p=0,h=c;p<h.length;p+=1)if(!Oe(h[p],l))return!1}return!0}(t,this.geometries)}return!1},Ze.prototype.eachChild=function(){},Ze.prototype.outputDefined=function(){return!0},Ze.prototype.serialize=function(){return["within",this.geojson]};var je=function(t,e){this.type=e.type,this.name=t,this.boundExpression=e};je.parse=function(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");var n=t[1];return e.scope.has(n)?new je(n,e.scope.get(n)):e.error('Unknown variable "'+n+'". Make sure "'+n+'" has been bound in an enclosing "let" expression before using it.',1)},je.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},je.prototype.eachChild=function(){},je.prototype.outputDefined=function(){return!1},je.prototype.serialize=function(){return["var",this.name]};var Ue=function(t,e,n,r,i){void 0===e&&(e=[]),void 0===r&&(r=new Zt),void 0===i&&(i=[]),this.registry=t,this.path=e,this.key=e.map((function(t){return"["+t+"]"})).join(""),this.scope=r,this.errors=i,this.expectedType=n};function Ve(t,e){for(var n,r=t.length-1,i=0,o=r,a=0;i<=o;)if((n=t[a=Math.floor((i+o)/2)])<=e){if(a===r||e<t[a+1])return a;i=a+1}else{if(!(n>e))throw new pe("Input is not a number.");o=a-1}return 0}Ue.prototype.parse=function(t,e,n,r,i){return void 0===i&&(i={}),e?this.concat(e,n,r)._parse(t,i):this._parse(t,i)},Ue.prototype._parse=function(t,e){function n(t,e,n){return"assert"===n?new fe(e,[t]):"coerce"===n?new ye(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var r=t[0];if("string"!=typeof r)return this.error("Expression name must be a string, but found "+typeof r+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var i=this.registry[r];if(i){var o=i.parse(t,this);if(!o)return null;if(this.expectedType){var a=this.expectedType,s=o.type;if("string"!==a.kind&&"number"!==a.kind&&"boolean"!==a.kind&&"object"!==a.kind&&"array"!==a.kind||"value"!==s.kind)if("color"!==a.kind&&"formatted"!==a.kind&&"resolvedImage"!==a.kind||"value"!==s.kind&&"string"!==s.kind){if(this.checkSubtype(a,s))return null}else o=n(o,a,e.typeAnnotation||"coerce");else o=n(o,a,e.typeAnnotation||"assert")}if(!(o instanceof ce)&&"resolvedImage"!==o.type.kind&&function t(e){if(e instanceof je)return t(e.boundExpression);if(e instanceof xe&&"error"===e.name)return!1;if(e instanceof be)return!1;if(e instanceof Ze)return!1;var n=e instanceof ye||e instanceof fe,r=!0;return e.eachChild((function(e){r=n?r&&t(e):r&&e instanceof ce})),!!r&&ze(e)&&Be(e,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(o)){var u=new _e;try{o=new ce(o.type,o.evaluate(u))}catch(t){return this.error(t.message),null}}return o}return this.error('Unknown expression "'+r+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},Ue.prototype.concat=function(t,e,n){var r="number"==typeof t?this.path.concat(t):this.path,i=n?this.scope.concat(n):this.scope;return new Ue(this.registry,r,e||null,i,this.errors)},Ue.prototype.error=function(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];var r=""+this.key+e.map((function(t){return"["+t+"]"})).join("");this.errors.push(new Nt(r,t))},Ue.prototype.checkSubtype=function(t,e){var n=Qt(t,e);return n&&this.error(n),n};var Ge=function(t,e,n){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(var r=0,i=n;r<i.length;r+=1){var o=i[r],a=o[1];this.labels.push(o[0]),this.outputs.push(a)}};function He(t,e,n){return t*(1-n)+e*n}Ge.parse=function(t,e){if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");var n=e.parse(t[1],1,Ft);if(!n)return null;var r=[],i=null;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);for(var o=1;o<t.length;o+=2){var a=1===o?-1/0:t[o],s=t[o+1],u=o,l=o+1;if("number"!=typeof a)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',u);if(r.length&&r[r.length-1][0]>=a)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',u);var c=e.parse(s,l,i);if(!c)return null;i=i||c.type,r.push([a,c])}return new Ge(i,n,r)},Ge.prototype.evaluate=function(t){var e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);var r=this.input.evaluate(t);if(r<=e[0])return n[0].evaluate(t);var i=e.length;return r>=e[i-1]?n[i-1].evaluate(t):n[Ve(e,r)].evaluate(t)},Ge.prototype.eachChild=function(t){t(this.input);for(var e=0,n=this.outputs;e<n.length;e+=1)t(n[e])},Ge.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))},Ge.prototype.serialize=function(){for(var t=["step",this.input.serialize()],e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t};var We=Object.freeze({__proto__:null,number:He,color:function(t,e,n){return new ee(He(t.r,e.r,n),He(t.g,e.g,n),He(t.b,e.b,n),He(t.a,e.a,n))},array:function(t,e,n){return t.map((function(t,r){return He(t,e[r],n)}))}}),qe=6/29*3*(6/29),Xe=Math.PI/180,Ye=180/Math.PI;function Ke(t){return t>.008856451679035631?Math.pow(t,1/3):t/qe+4/29}function Qe(t){return t>6/29?t*t*t:qe*(t-4/29)}function Je(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function $e(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function tn(t){var e=$e(t.r),n=$e(t.g),r=$e(t.b),i=Ke((.4124564*e+.3575761*n+.1804375*r)/.95047),o=Ke((.2126729*e+.7151522*n+.072175*r)/1);return{l:116*o-16,a:500*(i-o),b:200*(o-Ke((.0193339*e+.119192*n+.9503041*r)/1.08883)),alpha:t.a}}function en(t){var e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,r=isNaN(t.b)?e:e-t.b/200;return e=1*Qe(e),n=.95047*Qe(n),r=1.08883*Qe(r),new ee(Je(3.2404542*n-1.5371385*e-.4985314*r),Je(-.969266*n+1.8760108*e+.041556*r),Je(.0556434*n-.2040259*e+1.0572252*r),t.alpha)}function nn(t,e,n){var r=e-t;return t+n*(r>180||r<-180?r-360*Math.round(r/360):r)}var rn={forward:tn,reverse:en,interpolate:function(t,e,n){return{l:He(t.l,e.l,n),a:He(t.a,e.a,n),b:He(t.b,e.b,n),alpha:He(t.alpha,e.alpha,n)}}},on={forward:function(t){var e=tn(t),n=e.l,r=e.a,i=e.b,o=Math.atan2(i,r)*Ye;return{h:o<0?o+360:o,c:Math.sqrt(r*r+i*i),l:n,alpha:t.a}},reverse:function(t){var e=t.h*Xe,n=t.c;return en({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:nn(t.h,e.h,n),c:He(t.c,e.c,n),l:He(t.l,e.l,n),alpha:He(t.alpha,e.alpha,n)}}},an=Object.freeze({__proto__:null,lab:rn,hcl:on}),sn=function(t,e,n,r,i){this.type=t,this.operator=e,this.interpolation=n,this.input=r,this.labels=[],this.outputs=[];for(var o=0,a=i;o<a.length;o+=1){var s=a[o],u=s[1];this.labels.push(s[0]),this.outputs.push(u)}};function un(t,e,n,r){var i=r-n,o=t-n;return 0===i?0:1===e?o/i:(Math.pow(e,o)-1)/(Math.pow(e,i)-1)}sn.interpolationFactor=function(t,e,r,i){var o=0;if("exponential"===t.name)o=un(e,t.base,r,i);else if("linear"===t.name)o=un(e,1,r,i);else if("cubic-bezier"===t.name){var a=t.controlPoints;o=new n(a[0],a[1],a[2],a[3]).solve(un(e,1,r,i))}return o},sn.parse=function(t,e){var n=t[0],r=t[1],i=t[2],o=t.slice(3);if(!Array.isArray(r)||0===r.length)return e.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){var a=r[1];if("number"!=typeof a)return e.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:a}}else{if("cubic-bezier"!==r[0])return e.error("Unknown interpolation type "+String(r[0]),1,0);var s=r.slice(1);if(4!==s.length||s.some((function(t){return"number"!=typeof t||t<0||t>1})))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:s}}if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(!(i=e.parse(i,2,Ft)))return null;var u=[],l=null;"interpolate-hcl"===n||"interpolate-lab"===n?l=Ut:e.expectedType&&"value"!==e.expectedType.kind&&(l=e.expectedType);for(var c=0;c<o.length;c+=2){var p=o[c],h=o[c+1],f=c+3,d=c+4;if("number"!=typeof p)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',f);if(u.length&&u[u.length-1][0]>=p)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',f);var v=e.parse(h,d,l);if(!v)return null;l=l||v.type,u.push([p,v])}return"number"===l.kind||"color"===l.kind||"array"===l.kind&&"number"===l.itemType.kind&&"number"==typeof l.N?new sn(l,n,r,i,u):e.error("Type "+Yt(l)+" is not interpolatable.")},sn.prototype.evaluate=function(t){var e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);var r=this.input.evaluate(t);if(r<=e[0])return n[0].evaluate(t);var i=e.length;if(r>=e[i-1])return n[i-1].evaluate(t);var o=Ve(e,r),a=sn.interpolationFactor(this.interpolation,r,e[o],e[o+1]),s=n[o].evaluate(t),u=n[o+1].evaluate(t);return"interpolate"===this.operator?We[this.type.kind.toLowerCase()](s,u,a):"interpolate-hcl"===this.operator?on.reverse(on.interpolate(on.forward(s),on.forward(u),a)):rn.reverse(rn.interpolate(rn.forward(s),rn.forward(u),a))},sn.prototype.eachChild=function(t){t(this.input);for(var e=0,n=this.outputs;e<n.length;e+=1)t(n[e])},sn.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))},sn.prototype.serialize=function(){var t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var e=[this.operator,t,this.input.serialize()],n=0;n<this.labels.length;n++)e.push(this.labels[n],this.outputs[n].serialize());return e};var ln=function(t,e){this.type=t,this.args=e};ln.parse=function(t,e){if(t.length<2)return e.error("Expectected at least one argument.");var n=null,r=e.expectedType;r&&"value"!==r.kind&&(n=r);for(var i=[],o=0,a=t.slice(1);o<a.length;o+=1){var s=e.parse(a[o],1+i.length,n,void 0,{typeAnnotation:"omit"});if(!s)return null;n=n||s.type,i.push(s)}var u=r&&i.some((function(t){return Qt(r,t.type)}));return new ln(u?Gt:n,i)},ln.prototype.evaluate=function(t){for(var e,n=null,r=0,i=0,o=this.args;i<o.length&&(r++,(n=o[i].evaluate(t))&&n instanceof oe&&!n.available&&(e||(e=n.name),n=null,r===this.args.length&&(n=e)),null===n);i+=1);return n},ln.prototype.eachChild=function(t){this.args.forEach(t)},ln.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},ln.prototype.serialize=function(){var t=["coalesce"];return this.eachChild((function(e){t.push(e.serialize())})),t};var cn=function(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e};cn.prototype.evaluate=function(t){return this.result.evaluate(t)},cn.prototype.eachChild=function(t){for(var e=0,n=this.bindings;e<n.length;e+=1)t(n[e][1]);t(this.result)},cn.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var n=[],r=1;r<t.length-1;r+=2){var i=t[r];if("string"!=typeof i)return e.error("Expected string, but found "+typeof i+" instead.",r);if(/[^a-zA-Z0-9_]/.test(i))return e.error("Variable names must contain only alphanumeric characters or '_'.",r);var o=e.parse(t[r+1],r+1);if(!o)return null;n.push([i,o])}var a=e.parse(t[t.length-1],t.length-1,e.expectedType,n);return a?new cn(n,a):null},cn.prototype.outputDefined=function(){return this.result.outputDefined()},cn.prototype.serialize=function(){for(var t=["let"],e=0,n=this.bindings;e<n.length;e+=1){var r=n[e];t.push(r[0],r[1].serialize())}return t.push(this.result.serialize()),t};var pn=function(t,e,n){this.type=t,this.index=e,this.input=n};pn.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var n=e.parse(t[1],1,Ft),r=e.parse(t[2],2,Xt(e.expectedType||Gt));return n&&r?new pn(r.type.itemType,n,r):null},pn.prototype.evaluate=function(t){var e=this.index.evaluate(t),n=this.input.evaluate(t);if(e<0)throw new pe("Array index out of bounds: "+e+" < 0.");if(e>=n.length)throw new pe("Array index out of bounds: "+e+" > "+(n.length-1)+".");if(e!==Math.floor(e))throw new pe("Array index must be an integer, but found "+e+" instead.");return n[e]},pn.prototype.eachChild=function(t){t(this.index),t(this.input)},pn.prototype.outputDefined=function(){return!1},pn.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var hn=function(t,e){this.type=jt,this.needle=t,this.haystack=e};hn.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var n=e.parse(t[1],1,Gt),r=e.parse(t[2],2,Gt);return n&&r?Jt(n.type,[jt,Bt,Ft,zt,Gt])?new hn(n,r):e.error("Expected first argument to be of type boolean, string, number or null, but found "+Yt(n.type)+" instead"):null},hn.prototype.evaluate=function(t){var e=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!n)return!1;if(!$t(e,["boolean","string","number","null"]))throw new pe("Expected first argument to be of type boolean, string, number or null, but found "+Yt(ue(e))+" instead.");if(!$t(n,["string","array"]))throw new pe("Expected second argument to be of type array or string, but found "+Yt(ue(n))+" instead.");return n.indexOf(e)>=0},hn.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},hn.prototype.outputDefined=function(){return!0},hn.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var fn=function(t,e,n){this.type=Ft,this.needle=t,this.haystack=e,this.fromIndex=n};fn.parse=function(t,e){if(t.length<=2||t.length>=5)return e.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var n=e.parse(t[1],1,Gt),r=e.parse(t[2],2,Gt);if(!n||!r)return null;if(!Jt(n.type,[jt,Bt,Ft,zt,Gt]))return e.error("Expected first argument to be of type boolean, string, number or null, but found "+Yt(n.type)+" instead");if(4===t.length){var i=e.parse(t[3],3,Ft);return i?new fn(n,r,i):null}return new fn(n,r)},fn.prototype.evaluate=function(t){var e=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!$t(e,["boolean","string","number","null"]))throw new pe("Expected first argument to be of type boolean, string, number or null, but found "+Yt(ue(e))+" instead.");if(!$t(n,["string","array"]))throw new pe("Expected second argument to be of type array or string, but found "+Yt(ue(n))+" instead.");if(this.fromIndex){var r=this.fromIndex.evaluate(t);return n.indexOf(e,r)}return n.indexOf(e)},fn.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},fn.prototype.outputDefined=function(){return!1},fn.prototype.serialize=function(){if(null!=this.fromIndex&&void 0!==this.fromIndex){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var dn=function(t,e,n,r,i,o){this.inputType=t,this.type=e,this.input=n,this.cases=r,this.outputs=i,this.otherwise=o};dn.parse=function(t,e){if(t.length<5)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return e.error("Expected an even number of arguments.");var n,r;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);for(var i={},o=[],a=2;a<t.length-1;a+=2){var s=t[a],u=t[a+1];Array.isArray(s)||(s=[s]);var l=e.concat(a);if(0===s.length)return l.error("Expected at least one branch label.");for(var c=0,p=s;c<p.length;c+=1){var h=p[c];if("number"!=typeof h&&"string"!=typeof h)return l.error("Branch labels must be numbers or strings.");if("number"==typeof h&&Math.abs(h)>Number.MAX_SAFE_INTEGER)return l.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if("number"==typeof h&&Math.floor(h)!==h)return l.error("Numeric branch labels must be integer values.");if(n){if(l.checkSubtype(n,ue(h)))return null}else n=ue(h);if(void 0!==i[String(h)])return l.error("Branch labels must be unique.");i[String(h)]=o.length}var f=e.parse(u,a,r);if(!f)return null;r=r||f.type,o.push(f)}var d=e.parse(t[1],1,Gt);if(!d)return null;var v=e.parse(t[t.length-1],t.length-1,r);return v?"value"!==d.type.kind&&e.concat(1).checkSubtype(n,d.type)?null:new dn(n,r,d,i,o,v):null},dn.prototype.evaluate=function(t){var e=this.input.evaluate(t);return(ue(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)},dn.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},dn.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))&&this.otherwise.outputDefined()},dn.prototype.serialize=function(){for(var t=this,e=["match",this.input.serialize()],n=[],r={},i=0,o=Object.keys(this.cases).sort();i<o.length;i+=1){var a=o[i];void 0===(p=r[this.cases[a]])?(r[this.cases[a]]=n.length,n.push([this.cases[a],[a]])):n[p][1].push(a)}for(var s=function(e){return"number"===t.inputType.kind?Number(e):e},u=0,l=n;u<l.length;u+=1){var c=l[u],p=c[0],h=c[1];e.push(1===h.length?s(h[0]):h.map(s)),e.push(this.outputs[outputIndex$1].serialize())}return e.push(this.otherwise.serialize()),e};var vn=function(t,e,n){this.type=t,this.branches=e,this.otherwise=n};vn.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return e.error("Expected an odd number of arguments.");var n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);for(var r=[],i=1;i<t.length-1;i+=2){var o=e.parse(t[i],i,jt);if(!o)return null;var a=e.parse(t[i+1],i+1,n);if(!a)return null;r.push([o,a]),n=n||a.type}var s=e.parse(t[t.length-1],t.length-1,n);return s?new vn(n,r,s):null},vn.prototype.evaluate=function(t){for(var e=0,n=this.branches;e<n.length;e+=1){var r=n[e],i=r[1];if(r[0].evaluate(t))return i.evaluate(t)}return this.otherwise.evaluate(t)},vn.prototype.eachChild=function(t){for(var e=0,n=this.branches;e<n.length;e+=1){var r=n[e],i=r[1];t(r[0]),t(i)}t(this.otherwise)},vn.prototype.outputDefined=function(){return this.branches.every((function(t){return t[1].outputDefined()}))&&this.otherwise.outputDefined()},vn.prototype.serialize=function(){var t=["case"];return this.eachChild((function(e){t.push(e.serialize())})),t};var mn=function(t,e,n,r){this.type=t,this.input=e,this.beginIndex=n,this.endIndex=r};function yn(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function gn(t,e,n,r){return 0===r.compare(e,n)}function _n(t,e,n){var r="=="!==t&&"!="!==t;return function(){function i(t,e,n){this.type=jt,this.lhs=t,this.rhs=e,this.collator=n,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}return i.parse=function(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");var n=t[0],o=e.parse(t[1],1,Gt);if(!o)return null;if(!yn(n,o.type))return e.concat(1).error('"'+n+"\" comparisons are not supported for type '"+Yt(o.type)+"'.");var a=e.parse(t[2],2,Gt);if(!a)return null;if(!yn(n,a.type))return e.concat(2).error('"'+n+"\" comparisons are not supported for type '"+Yt(a.type)+"'.");if(o.type.kind!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return e.error("Cannot compare types '"+Yt(o.type)+"' and '"+Yt(a.type)+"'.");r&&("value"===o.type.kind&&"value"!==a.type.kind?o=new fe(a.type,[o]):"value"!==o.type.kind&&"value"===a.type.kind&&(a=new fe(o.type,[a])));var s=null;if(4===t.length){if("string"!==o.type.kind&&"string"!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return e.error("Cannot use collator to compare non-string types.");if(!(s=e.parse(t[3],3,Ht)))return null}return new i(o,a,s)},i.prototype.evaluate=function(i){var o=this.lhs.evaluate(i),a=this.rhs.evaluate(i);if(r&&this.hasUntypedArgument){var s=ue(o),u=ue(a);if(s.kind!==u.kind||"string"!==s.kind&&"number"!==s.kind)throw new pe('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+s.kind+", "+u.kind+") instead.")}if(this.collator&&!r&&this.hasUntypedArgument){var l=ue(o),c=ue(a);if("string"!==l.kind||"string"!==c.kind)return e(i,o,a)}return this.collator?n(i,o,a,this.collator.evaluate(i)):e(i,o,a)},i.prototype.eachChild=function(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)},i.prototype.outputDefined=function(){return!0},i.prototype.serialize=function(){var e=[t];return this.eachChild((function(t){e.push(t.serialize())})),e},i}()}mn.parse=function(t,e){if(t.length<=2||t.length>=5)return e.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var n=e.parse(t[1],1,Gt),r=e.parse(t[2],2,Ft);if(!n||!r)return null;if(!Jt(n.type,[Xt(Gt),Bt,Gt]))return e.error("Expected first argument to be of type array or string, but found "+Yt(n.type)+" instead");if(4===t.length){var i=e.parse(t[3],3,Ft);return i?new mn(n.type,n,r,i):null}return new mn(n.type,n,r)},mn.prototype.evaluate=function(t){var e=this.input.evaluate(t),n=this.beginIndex.evaluate(t);if(!$t(e,["string","array"]))throw new pe("Expected first argument to be of type array or string, but found "+Yt(ue(e))+" instead.");if(this.endIndex){var r=this.endIndex.evaluate(t);return e.slice(n,r)}return e.slice(n)},mn.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},mn.prototype.outputDefined=function(){return!1},mn.prototype.serialize=function(){if(null!=this.endIndex&&void 0!==this.endIndex){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var xn=_n("==",(function(t,e,n){return e===n}),gn),bn=_n("!=",(function(t,e,n){return e!==n}),(function(t,e,n,r){return!gn(0,e,n,r)})),wn=_n("<",(function(t,e,n){return e<n}),(function(t,e,n,r){return r.compare(e,n)<0})),Sn=_n(">",(function(t,e,n){return e>n}),(function(t,e,n,r){return r.compare(e,n)>0})),En=_n("<=",(function(t,e,n){return e<=n}),(function(t,e,n,r){return r.compare(e,n)<=0})),Cn=_n(">=",(function(t,e,n){return e>=n}),(function(t,e,n,r){return r.compare(e,n)>=0})),Tn=function(t,e,n,r,i){this.type=Bt,this.number=t,this.locale=e,this.currency=n,this.minFractionDigits=r,this.maxFractionDigits=i};Tn.parse=function(t,e){if(3!==t.length)return e.error("Expected two arguments.");var n=e.parse(t[1],1,Ft);if(!n)return null;var r=t[2];if("object"!=typeof r||Array.isArray(r))return e.error("NumberFormat options argument must be an object.");var i=null;if(r.locale&&!(i=e.parse(r.locale,1,Bt)))return null;var o=null;if(r.currency&&!(o=e.parse(r.currency,1,Bt)))return null;var a=null;if(r["min-fraction-digits"]&&!(a=e.parse(r["min-fraction-digits"],1,Ft)))return null;var s=null;return r["max-fraction-digits"]&&!(s=e.parse(r["max-fraction-digits"],1,Ft))?null:new Tn(n,i,o,a,s)},Tn.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},Tn.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},Tn.prototype.outputDefined=function(){return!1},Tn.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var An=function(t){this.type=Ft,this.input=t};An.parse=function(t,e){if(2!==t.length)return e.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var n=e.parse(t[1],1);return n?"array"!==n.type.kind&&"string"!==n.type.kind&&"value"!==n.type.kind?e.error("Expected argument of type string or array, but found "+Yt(n.type)+" instead."):new An(n):null},An.prototype.evaluate=function(t){var e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new pe("Expected value to be of type string or array, but found "+Yt(ue(e))+" instead.")},An.prototype.eachChild=function(t){t(this.input)},An.prototype.outputDefined=function(){return!1},An.prototype.serialize=function(){var t=["length"];return this.eachChild((function(e){t.push(e.serialize())})),t};var Mn={"==":xn,"!=":bn,">":Sn,"<":wn,">=":Cn,"<=":En,array:fe,at:pn,boolean:fe,case:vn,coalesce:ln,collator:be,format:de,image:ve,in:hn,"index-of":fn,interpolate:sn,"interpolate-hcl":sn,"interpolate-lab":sn,length:An,let:cn,literal:ce,match:dn,number:fe,"number-format":Tn,object:fe,slice:mn,step:Ge,string:fe,"to-boolean":ye,"to-color":ye,"to-number":ye,"to-string":ye,var:je,within:Ze};function kn(t,e){var n=e[0],r=e[1],i=e[2],o=e[3];n=n.evaluate(t),r=r.evaluate(t),i=i.evaluate(t);var a=o?o.evaluate(t):1,s=ae(n,r,i,a);if(s)throw new pe(s);return new ee(n/255*a,r/255*a,i/255*a,a)}function Pn(t,e){return t in e}function On(t,e){var n=e[t];return void 0===n?null:n}function Ln(t){return{type:t}}function In(t){return{result:"success",value:t}}function Rn(t){return{result:"error",value:t}}function Dn(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function Nn(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Zn(t){return!!t.expression&&t.expression.interpolated}function zn(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function Fn(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function Bn(t){return t}function jn(t,e,n){return void 0!==t?t:void 0!==e?e:void 0!==n?n:void 0}function Un(t,e,n,r,i){return jn(typeof n===i?r[n]:void 0,t.default,e.default)}function Vn(t,e,n){if("number"!==zn(n))return jn(t.default,e.default);var r=t.stops.length;if(1===r)return t.stops[0][1];if(n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[r-1][0])return t.stops[r-1][1];var i=Ve(t.stops.map((function(t){return t[0]})),n);return t.stops[i][1]}function Gn(t,e,n){var r=void 0!==t.base?t.base:1;if("number"!==zn(n))return jn(t.default,e.default);var i=t.stops.length;if(1===i)return t.stops[0][1];if(n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[i-1][0])return t.stops[i-1][1];var o=Ve(t.stops.map((function(t){return t[0]})),n),a=function(t,e,n,r){var i=r-n,o=t-n;return 0===i?0:1===e?o/i:(Math.pow(e,o)-1)/(Math.pow(e,i)-1)}(n,r,t.stops[o][0],t.stops[o+1][0]),s=t.stops[o][1],u=t.stops[o+1][1],l=We[e.type]||Bn;if(t.colorSpace&&"rgb"!==t.colorSpace){var c=an[t.colorSpace];l=function(t,e){return c.reverse(c.interpolate(c.forward(t),c.forward(e),a))}}return"function"==typeof s.evaluate?{evaluate:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=s.evaluate.apply(void 0,t),r=u.evaluate.apply(void 0,t);if(void 0!==n&&void 0!==r)return l(n,r,a)}}:l(s,u,a)}function Hn(t,e,n){return"color"===e.type?n=ee.parse(n):"formatted"===e.type?n=ie.fromString(n.toString()):"resolvedImage"===e.type?n=oe.fromString(n.toString()):zn(n)===e.type||"enum"===e.type&&e.values[n]||(n=void 0),jn(n,t.default,e.default)}xe.register(Mn,{error:[{kind:"error"},[Bt],function(t,e){throw new pe(e[0].evaluate(t))}],typeof:[Bt,[Gt],function(t,e){return Yt(ue(e[0].evaluate(t)))}],"to-rgba":[Xt(Ft,4),[Ut],function(t,e){return e[0].evaluate(t).toArray()}],rgb:[Ut,[Ft,Ft,Ft],kn],rgba:[Ut,[Ft,Ft,Ft,Ft],kn],has:{type:jt,overloads:[[[Bt],function(t,e){return Pn(e[0].evaluate(t),t.properties())}],[[Bt,Vt],function(t,e){var n=e[1];return Pn(e[0].evaluate(t),n.evaluate(t))}]]},get:{type:Gt,overloads:[[[Bt],function(t,e){return On(e[0].evaluate(t),t.properties())}],[[Bt,Vt],function(t,e){var n=e[1];return On(e[0].evaluate(t),n.evaluate(t))}]]},"feature-state":[Gt,[Bt],function(t,e){return On(e[0].evaluate(t),t.featureState||{})}],properties:[Vt,[],function(t){return t.properties()}],"geometry-type":[Bt,[],function(t){return t.geometryType()}],id:[Gt,[],function(t){return t.id()}],zoom:[Ft,[],function(t){return t.globals.zoom}],"heatmap-density":[Ft,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[Ft,[],function(t){return t.globals.lineProgress||0}],accumulated:[Gt,[],function(t){return void 0===t.globals.accumulated?null:t.globals.accumulated}],"+":[Ft,Ln(Ft),function(t,e){for(var n=0,r=0,i=e;r<i.length;r+=1)n+=i[r].evaluate(t);return n}],"*":[Ft,Ln(Ft),function(t,e){for(var n=1,r=0,i=e;r<i.length;r+=1)n*=i[r].evaluate(t);return n}],"-":{type:Ft,overloads:[[[Ft,Ft],function(t,e){var n=e[1];return e[0].evaluate(t)-n.evaluate(t)}],[[Ft],function(t,e){return-e[0].evaluate(t)}]]},"/":[Ft,[Ft,Ft],function(t,e){var n=e[1];return e[0].evaluate(t)/n.evaluate(t)}],"%":[Ft,[Ft,Ft],function(t,e){var n=e[1];return e[0].evaluate(t)%n.evaluate(t)}],ln2:[Ft,[],function(){return Math.LN2}],pi:[Ft,[],function(){return Math.PI}],e:[Ft,[],function(){return Math.E}],"^":[Ft,[Ft,Ft],function(t,e){var n=e[1];return Math.pow(e[0].evaluate(t),n.evaluate(t))}],sqrt:[Ft,[Ft],function(t,e){return Math.sqrt(e[0].evaluate(t))}],log10:[Ft,[Ft],function(t,e){return Math.log(e[0].evaluate(t))/Math.LN10}],ln:[Ft,[Ft],function(t,e){return Math.log(e[0].evaluate(t))}],log2:[Ft,[Ft],function(t,e){return Math.log(e[0].evaluate(t))/Math.LN2}],sin:[Ft,[Ft],function(t,e){return Math.sin(e[0].evaluate(t))}],cos:[Ft,[Ft],function(t,e){return Math.cos(e[0].evaluate(t))}],tan:[Ft,[Ft],function(t,e){return Math.tan(e[0].evaluate(t))}],asin:[Ft,[Ft],function(t,e){return Math.asin(e[0].evaluate(t))}],acos:[Ft,[Ft],function(t,e){return Math.acos(e[0].evaluate(t))}],atan:[Ft,[Ft],function(t,e){return Math.atan(e[0].evaluate(t))}],min:[Ft,Ln(Ft),function(t,e){return Math.min.apply(Math,e.map((function(e){return e.evaluate(t)})))}],max:[Ft,Ln(Ft),function(t,e){return Math.max.apply(Math,e.map((function(e){return e.evaluate(t)})))}],abs:[Ft,[Ft],function(t,e){return Math.abs(e[0].evaluate(t))}],round:[Ft,[Ft],function(t,e){var n=e[0].evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[Ft,[Ft],function(t,e){return Math.floor(e[0].evaluate(t))}],ceil:[Ft,[Ft],function(t,e){return Math.ceil(e[0].evaluate(t))}],"filter-==":[jt,[Bt,Gt],function(t,e){var n=e[0],r=e[1];return t.properties()[n.value]===r.value}],"filter-id-==":[jt,[Gt],function(t,e){var n=e[0];return t.id()===n.value}],"filter-type-==":[jt,[Bt],function(t,e){var n=e[0];return t.geometryType()===n.value}],"filter-<":[jt,[Bt,Gt],function(t,e){var n=e[0],r=e[1],i=t.properties()[n.value],o=r.value;return typeof i==typeof o&&i<o}],"filter-id-<":[jt,[Gt],function(t,e){var n=e[0],r=t.id(),i=n.value;return typeof r==typeof i&&r<i}],"filter->":[jt,[Bt,Gt],function(t,e){var n=e[0],r=e[1],i=t.properties()[n.value],o=r.value;return typeof i==typeof o&&i>o}],"filter-id->":[jt,[Gt],function(t,e){var n=e[0],r=t.id(),i=n.value;return typeof r==typeof i&&r>i}],"filter-<=":[jt,[Bt,Gt],function(t,e){var n=e[0],r=e[1],i=t.properties()[n.value],o=r.value;return typeof i==typeof o&&i<=o}],"filter-id-<=":[jt,[Gt],function(t,e){var n=e[0],r=t.id(),i=n.value;return typeof r==typeof i&&r<=i}],"filter->=":[jt,[Bt,Gt],function(t,e){var n=e[0],r=e[1],i=t.properties()[n.value],o=r.value;return typeof i==typeof o&&i>=o}],"filter-id->=":[jt,[Gt],function(t,e){var n=e[0],r=t.id(),i=n.value;return typeof r==typeof i&&r>=i}],"filter-has":[jt,[Gt],function(t,e){return e[0].value in t.properties()}],"filter-has-id":[jt,[],function(t){return null!==t.id()&&void 0!==t.id()}],"filter-type-in":[jt,[Xt(Bt)],function(t,e){return e[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[jt,[Xt(Gt)],function(t,e){return e[0].value.indexOf(t.id())>=0}],"filter-in-small":[jt,[Bt,Xt(Gt)],function(t,e){var n=e[0];return e[1].value.indexOf(t.properties()[n.value])>=0}],"filter-in-large":[jt,[Bt,Xt(Gt)],function(t,e){var n=e[0],r=e[1];return function(t,e,n,r){for(;n<=r;){var i=n+r>>1;if(e[i]===t)return!0;e[i]>t?r=i-1:n=i+1}return!1}(t.properties()[n.value],r.value,0,r.value.length-1)}],all:{type:jt,overloads:[[[jt,jt],function(t,e){var n=e[1];return e[0].evaluate(t)&&n.evaluate(t)}],[Ln(jt),function(t,e){for(var n=0,r=e;n<r.length;n+=1)if(!r[n].evaluate(t))return!1;return!0}]]},any:{type:jt,overloads:[[[jt,jt],function(t,e){var n=e[1];return e[0].evaluate(t)||n.evaluate(t)}],[Ln(jt),function(t,e){for(var n=0,r=e;n<r.length;n+=1)if(r[n].evaluate(t))return!0;return!1}]]},"!":[jt,[jt],function(t,e){return!e[0].evaluate(t)}],"is-supported-script":[jt,[Bt],function(t,e){var n=t.globals&&t.globals.isSupportedScript;return!n||n(e[0].evaluate(t))}],upcase:[Bt,[Bt],function(t,e){return e[0].evaluate(t).toUpperCase()}],downcase:[Bt,[Bt],function(t,e){return e[0].evaluate(t).toLowerCase()}],concat:[Bt,Ln(Gt),function(t,e){return e.map((function(e){return le(e.evaluate(t))})).join("")}],"resolved-locale":[Bt,[Ht],function(t,e){return e[0].evaluate(t).resolvedLocale()}]});var Wn=function(t,e){this.expression=t,this._warningHistory={},this._evaluator=new _e,this._defaultValue=e?function(t){return"color"===t.type&&Fn(t.default)?new ee(0,0,0,0):"color"===t.type?ee.parse(t.default)||null:void 0===t.default?null:t.default}(e):null,this._enumValues=e&&"enum"===e.type?e.values:null};function qn(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Mn}function Xn(t,e){var n=new Ue(Mn,[],e?function(t){var e={color:Ut,string:Bt,number:Ft,enum:Bt,boolean:jt,formatted:Wt,resolvedImage:qt};return"array"===t.type?Xt(e[t.value]||Gt,t.length):e[t.type]}(e):void 0),r=n.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return r?In(new Wn(r,e)):Rn(n.errors)}Wn.prototype.evaluateWithoutErrorHandling=function(t,e,n,r,i,o){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=n,this._evaluator.canonical=r,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o,this.expression.evaluate(this._evaluator)},Wn.prototype.evaluate=function(t,e,n,i,o,a){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=n||null,this._evaluator.canonical=i,this._evaluator.availableImages=o||null,this._evaluator.formattedSection=a||null;try{var s=this.expression.evaluate(this._evaluator);if(null==s||"number"==typeof s&&s!=s)return this._defaultValue;if(this._enumValues&&!(s in this._enumValues))throw new pe("Expected value to be one of "+Object.keys(this._enumValues).map((function(t){return JSON.stringify(t)})).join(", ")+", but found "+JSON.stringify(s)+" instead.");return s}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,void 0!==r&&r.warn(t.message)),this._defaultValue}};var Yn=function(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!Fe(e.expression)};Yn.prototype.evaluateWithoutErrorHandling=function(t,e,n,r,i,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,n,r,i,o)},Yn.prototype.evaluate=function(t,e,n,r,i,o){return this._styleExpression.evaluate(t,e,n,r,i,o)};var Kn=function(t,e,n,r){this.kind=t,this.zoomStops=n,this._styleExpression=e,this.isStateDependent="camera"!==t&&!Fe(e.expression),this.interpolationType=r};function Qn(t,e){if("error"===(t=Xn(t,e)).result)return t;var n=t.value.expression,r=ze(n);if(!r&&!Dn(e))return Rn([new Nt("","data expressions not supported")]);var i=Be(n,["zoom"]);if(!i&&!Nn(e))return Rn([new Nt("","zoom expressions not supported")]);var o=function t(e){var n=null;if(e instanceof cn)n=t(e.result);else if(e instanceof ln)for(var r=0,i=e.args;r<i.length&&!(n=t(i[r]));r+=1);else(e instanceof Ge||e instanceof sn)&&e.input instanceof xe&&"zoom"===e.input.name&&(n=e);return n instanceof Nt||e.eachChild((function(e){var r=t(e);r instanceof Nt?n=r:!n&&r?n=new Nt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&r&&n!==r&&(n=new Nt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),n}(n);return o||i?o instanceof Nt?Rn([o]):o instanceof sn&&!Zn(e)?Rn([new Nt("",'"interpolate" expressions cannot be used with this property')]):In(o?new Kn(r?"camera":"composite",t.value,o.labels,o instanceof sn?o.interpolation:void 0):new Yn(r?"constant":"source",t.value)):Rn([new Nt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Kn.prototype.evaluateWithoutErrorHandling=function(t,e,n,r,i,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,n,r,i,o)},Kn.prototype.evaluate=function(t,e,n,r,i,o){return this._styleExpression.evaluate(t,e,n,r,i,o)},Kn.prototype.interpolationFactor=function(t,e,n){return this.interpolationType?sn.interpolationFactor(this.interpolationType,t,e,n):0};var Jn=function(t,e){this._parameters=t,this._specification=e,It(this,function t(e,n){var r,i,o,a="color"===n.type,s=e.stops&&"object"==typeof e.stops[0][0],u=s||!(s||void 0!==e.property),l=e.type||(Zn(n)?"exponential":"interval");if(a&&((e=It({},e)).stops&&(e.stops=e.stops.map((function(t){return[t[0],ee.parse(t[1])]}))),e.default=ee.parse(e.default?e.default:n.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!an[e.colorSpace])throw new Error("Unknown color space: "+e.colorSpace);if("exponential"===l)r=Gn;else if("interval"===l)r=Vn;else if("categorical"===l){r=Un,i=Object.create(null);for(var c=0,p=e.stops;c<p.length;c+=1){var h=p[c];i[h[0]]=h[1]}o=typeof e.stops[0][0]}else{if("identity"!==l)throw new Error('Unknown function type "'+l+'"');r=Hn}if(s){for(var f={},d=[],v=0;v<e.stops.length;v++){var m=e.stops[v],y=m[0].zoom;void 0===f[y]&&(f[y]={zoom:y,type:e.type,property:e.property,default:e.default,stops:[]},d.push(y)),f[y].stops.push([m[0].value,m[1]])}for(var g=[],_=0,x=d;_<x.length;_+=1){var b=x[_];g.push([f[b].zoom,t(f[b],n)])}var w={name:"linear"};return{kind:"composite",interpolationType:w,interpolationFactor:sn.interpolationFactor.bind(void 0,w),zoomStops:g.map((function(t){return t[0]})),evaluate:function(t,r){var i=t.zoom;return Gn({stops:g,base:e.base},n,i).evaluate(i,r)}}}if(u){var S="exponential"===l?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:sn.interpolationFactor.bind(void 0,S),zoomStops:e.stops.map((function(t){return t[0]})),evaluate:function(t){return r(e,n,t.zoom,i,o)}}}return{kind:"source",evaluate:function(t,a){var s=a&&a.properties?a.properties[e.property]:void 0;return void 0===s?jn(e.default,n.default):r(e,n,s,i,o)}}}(this._parameters,this._specification))};function $n(t){var e=t.key,n=t.value,r=t.valueSpec||{},i=t.objectElementValidators||{},o=t.style,a=t.styleSpec,s=[],u=zn(n);if("object"!==u)return[new Ot(e,n,"object expected, "+u+" found")];for(var l in n){var c=l.split(".")[0],p=r[c]||r["*"],h=void 0;if(i[c])h=i[c];else if(r[c])h=Er;else if(i["*"])h=i["*"];else{if(!r["*"]){s.push(new Ot(e,n[l],'unknown property "'+l+'"'));continue}h=Er}s=s.concat(h({key:(e?e+".":e)+l,value:n[l],valueSpec:p,style:o,styleSpec:a,object:n,objectKey:l},n))}for(var f in r)i[f]||r[f].required&&void 0===r[f].default&&void 0===n[f]&&s.push(new Ot(e,n,'missing required property "'+f+'"'));return s}function tr(t){var e=t.value,n=t.valueSpec,r=t.style,i=t.styleSpec,o=t.key,a=t.arrayElementValidator||Er;if("array"!==zn(e))return[new Ot(o,e,"array expected, "+zn(e)+" found")];if(n.length&&e.length!==n.length)return[new Ot(o,e,"array length "+n.length+" expected, length "+e.length+" found")];if(n["min-length"]&&e.length<n["min-length"])return[new Ot(o,e,"array length at least "+n["min-length"]+" expected, length "+e.length+" found")];var s={type:n.value,values:n.values};i.$version<7&&(s.function=n.function),"object"===zn(n.value)&&(s=n.value);for(var u=[],l=0;l<e.length;l++)u=u.concat(a({array:e,arrayIndex:l,value:e[l],valueSpec:s,style:r,styleSpec:i,key:o+"["+l+"]"}));return u}function er(t){var e=t.key,n=t.value,r=t.valueSpec,i=zn(n);return"number"===i&&n!=n&&(i="NaN"),"number"!==i?[new Ot(e,n,"number expected, "+i+" found")]:"minimum"in r&&n<r.minimum?[new Ot(e,n,n+" is less than the minimum value "+r.minimum)]:"maximum"in r&&n>r.maximum?[new Ot(e,n,n+" is greater than the maximum value "+r.maximum)]:[]}function nr(t){var e,n,r,i=t.valueSpec,o=Rt(t.value.type),a={},s="categorical"!==o&&void 0===t.value.property,u=!s,l="array"===zn(t.value.stops)&&"array"===zn(t.value.stops[0])&&"object"===zn(t.value.stops[0][0]),c=$n({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===o)return[new Ot(t.key,t.value,'identity function may not have a "stops" property')];var e=[],n=t.value;return e=e.concat(tr({key:t.key,value:n,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:p})),"array"===zn(n)&&0===n.length&&e.push(new Ot(t.key,n,"array must have at least one stop")),e},default:function(t){return Er({key:t.key,value:t.value,valueSpec:i,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===o&&s&&c.push(new Ot(t.key,t.value,'missing required property "property"')),"identity"===o||t.value.stops||c.push(new Ot(t.key,t.value,'missing required property "stops"')),"exponential"===o&&t.valueSpec.expression&&!Zn(t.valueSpec)&&c.push(new Ot(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(u&&!Dn(t.valueSpec)?c.push(new Ot(t.key,t.value,"property functions not supported")):s&&!Nn(t.valueSpec)&&c.push(new Ot(t.key,t.value,"zoom functions not supported"))),"categorical"!==o&&!l||void 0!==t.value.property||c.push(new Ot(t.key,t.value,'"property" property is required')),c;function p(t){var e=[],o=t.value,s=t.key;if("array"!==zn(o))return[new Ot(s,o,"array expected, "+zn(o)+" found")];if(2!==o.length)return[new Ot(s,o,"array length 2 expected, length "+o.length+" found")];if(l){if("object"!==zn(o[0]))return[new Ot(s,o,"object expected, "+zn(o[0])+" found")];if(void 0===o[0].zoom)return[new Ot(s,o,"object stop key must have zoom")];if(void 0===o[0].value)return[new Ot(s,o,"object stop key must have value")];if(r&&r>Rt(o[0].zoom))return[new Ot(s,o[0].zoom,"stop zoom values must appear in ascending order")];Rt(o[0].zoom)!==r&&(r=Rt(o[0].zoom),n=void 0,a={}),e=e.concat($n({key:s+"[0]",value:o[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:er,value:h}}))}else e=e.concat(h({key:s+"[0]",value:o[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},o));return qn(Dt(o[1]))?e.concat([new Ot(s+"[1]",o[1],"expressions are not allowed in function stops.")]):e.concat(Er({key:s+"[1]",value:o[1],valueSpec:i,style:t.style,styleSpec:t.styleSpec}))}function h(t,r){var s=zn(t.value),u=Rt(t.value),l=null!==t.value?t.value:r;if(e){if(s!==e)return[new Ot(t.key,l,s+" stop domain type must match previous stop domain type "+e)]}else e=s;if("number"!==s&&"string"!==s&&"boolean"!==s)return[new Ot(t.key,l,"stop domain value must be a number, string, or boolean")];if("number"!==s&&"categorical"!==o){var c="number expected, "+s+" found";return Dn(i)&&void 0===o&&(c+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ot(t.key,l,c)]}return"categorical"!==o||"number"!==s||isFinite(u)&&Math.floor(u)===u?"categorical"!==o&&"number"===s&&void 0!==n&&u<n?[new Ot(t.key,l,"stop domain values must appear in ascending order")]:(n=u,"categorical"===o&&u in a?[new Ot(t.key,l,"stop domain values must be unique")]:(a[u]=!0,[])):[new Ot(t.key,l,"integer expected, found "+u)]}}function rr(t){var e=("property"===t.expressionContext?Qn:Xn)(Dt(t.value),t.valueSpec);if("error"===e.result)return e.value.map((function(e){return new Ot(""+t.key+e.key,t.value,e.message)}));var n=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!n.outputDefined())return[new Ot(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if("property"===t.expressionContext&&"layout"===t.propertyType&&!Fe(n))return[new Ot(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext&&!Fe(n))return[new Ot(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!Be(n,["zoom","feature-state"]))return[new Ot(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!ze(n))return[new Ot(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ir(t){var e=t.key,n=t.value,r=t.valueSpec,i=[];return Array.isArray(r.values)?-1===r.values.indexOf(Rt(n))&&i.push(new Ot(e,n,"expected one of ["+r.values.join(", ")+"], "+JSON.stringify(n)+" found")):-1===Object.keys(r.values).indexOf(Rt(n))&&i.push(new Ot(e,n,"expected one of ["+Object.keys(r.values).join(", ")+"], "+JSON.stringify(n)+" found")),i}function or(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var e=0,n=t.slice(1);e<n.length;e+=1){var r=n[e];if(!or(r)&&"boolean"!=typeof r)return!1}return!0;default:return!0}}Jn.deserialize=function(t){return new Jn(t._parameters,t._specification)},Jn.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var ar={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function sr(t){if(null==t)return{filter:function(){return!0},needGeometry:!1};or(t)||(t=lr(t));var e=Xn(t,ar);if("error"===e.result)throw new Error(e.value.map((function(t){return t.key+": "+t.message})).join(", "));return{filter:function(t,n,r){return e.value.evaluate(t,n,{},r)},needGeometry:function t(e){if(!Array.isArray(e))return!1;if("within"===e[0])return!0;for(var n=1;n<e.length;n++)if(t(e[n]))return!0;return!1}(t)}}function ur(t,e){return t<e?-1:t>e?1:0}function lr(t){if(!t)return!0;var e,n=t[0];return t.length<=1?"any"!==n:"=="===n?cr(t[1],t[2],"=="):"!="===n?fr(cr(t[1],t[2],"==")):"<"===n||">"===n||"<="===n||">="===n?cr(t[1],t[2],n):"any"===n?(e=t.slice(1),["any"].concat(e.map(lr))):"all"===n?["all"].concat(t.slice(1).map(lr)):"none"===n?["all"].concat(t.slice(1).map(lr).map(fr)):"in"===n?pr(t[1],t.slice(2)):"!in"===n?fr(pr(t[1],t.slice(2))):"has"===n?hr(t[1]):"!has"===n?fr(hr(t[1])):"within"!==n||t}function cr(t,e,n){switch(t){case"$type":return["filter-type-"+n,e];case"$id":return["filter-id-"+n,e];default:return["filter-"+n,t,e]}}function pr(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((function(t){return typeof t!=typeof e[0]}))?["filter-in-large",t,["literal",e.sort(ur)]]:["filter-in-small",t,["literal",e]]}}function hr(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function fr(t){return["!",t]}function dr(t){return or(Dt(t.value))?rr(It({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(e){var n=e.value,r=e.key;if("array"!==zn(n))return[new Ot(r,n,"array expected, "+zn(n)+" found")];var i,o=e.styleSpec,a=[];if(n.length<1)return[new Ot(r,n,"filter array must have at least 1 element")];switch(a=a.concat(ir({key:r+"[0]",value:n[0],valueSpec:o.filter_operator,style:e.style,styleSpec:e.styleSpec})),Rt(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&"$type"===Rt(n[1])&&a.push(new Ot(r,n,'"$type" cannot be use with operator "'+n[0]+'"'));case"==":case"!=":3!==n.length&&a.push(new Ot(r,n,'filter array for operator "'+n[0]+'" must have 3 elements'));case"in":case"!in":n.length>=2&&"string"!==(i=zn(n[1]))&&a.push(new Ot(r+"[1]",n[1],"string expected, "+i+" found"));for(var s=2;s<n.length;s++)i=zn(n[s]),"$type"===Rt(n[1])?a=a.concat(ir({key:r+"["+s+"]",value:n[s],valueSpec:o.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==i&&"number"!==i&&"boolean"!==i&&a.push(new Ot(r+"["+s+"]",n[s],"string, number, or boolean expected, "+i+" found"));break;case"any":case"all":case"none":for(var u=1;u<n.length;u++)a=a.concat(t({key:r+"["+u+"]",value:n[u],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":i=zn(n[1]),2!==n.length?a.push(new Ot(r,n,'filter array for "'+n[0]+'" operator must have 2 elements')):"string"!==i&&a.push(new Ot(r+"[1]",n[1],"string expected, "+i+" found"));break;case"within":i=zn(n[1]),2!==n.length?a.push(new Ot(r,n,'filter array for "'+n[0]+'" operator must have 2 elements')):"object"!==i&&a.push(new Ot(r+"[1]",n[1],"object expected, "+i+" found"))}return a}(t)}function vr(t,e){var n=t.key,r=t.style,i=t.styleSpec,o=t.value,a=t.objectKey,s=i[e+"_"+t.layerType];if(!s)return[];var u=a.match(/^(.*)-transition$/);if("paint"===e&&u&&s[u[1]]&&s[u[1]].transition)return Er({key:n,value:o,valueSpec:i.transition,style:r,styleSpec:i});var l,c=t.valueSpec||s[a];if(!c)return[new Ot(n,o,'unknown property "'+a+'"')];if("string"===zn(o)&&Dn(c)&&!c.tokens&&(l=/^{([^}]+)}$/.exec(o)))return[new Ot(n,o,'"'+a+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(l[1])+" }`.")];var p=[];return"symbol"===t.layerType&&("text-field"===a&&r&&!r.glyphs&&p.push(new Ot(n,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&Fn(Dt(o))&&"identity"===Rt(o.type)&&p.push(new Ot(n,o,'"text-font" does not support identity functions'))),p.concat(Er({key:t.key,value:o,valueSpec:c,style:r,styleSpec:i,expressionContext:"property",propertyType:e,propertyKey:a}))}function mr(t){return vr(t,"paint")}function yr(t){return vr(t,"layout")}function gr(t){var e=[],n=t.value,r=t.key,i=t.style,o=t.styleSpec;n.type||n.ref||e.push(new Ot(r,n,'either "type" or "ref" is required'));var a,s=Rt(n.type),u=Rt(n.ref);if(n.id)for(var l=Rt(n.id),c=0;c<t.arrayIndex;c++){var p=i.layers[c];Rt(p.id)===l&&e.push(new Ot(r,n.id,'duplicate layer id "'+n.id+'", previously used at line '+p.id.__line__))}if("ref"in n)["type","source","source-layer","filter","layout"].forEach((function(t){t in n&&e.push(new Ot(r,n[t],'"'+t+'" is prohibited for ref layers'))})),i.layers.forEach((function(t){Rt(t.id)===u&&(a=t)})),a?a.ref?e.push(new Ot(r,n.ref,"ref cannot reference another ref layer")):s=Rt(a.type):e.push(new Ot(r,n.ref,'ref layer "'+u+'" not found'));else if("background"!==s)if(n.source){var h=i.sources&&i.sources[n.source],f=h&&Rt(h.type);h?"vector"===f&&"raster"===s?e.push(new Ot(r,n.source,'layer "'+n.id+'" requires a raster source')):"raster"===f&&"raster"!==s?e.push(new Ot(r,n.source,'layer "'+n.id+'" requires a vector source')):"vector"!==f||n["source-layer"]?"raster-dem"===f&&"hillshade"!==s?e.push(new Ot(r,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!n.paint||!n.paint["line-gradient"]||"geojson"===f&&h.lineMetrics||e.push(new Ot(r,n,'layer "'+n.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):e.push(new Ot(r,n,'layer "'+n.id+'" must specify a "source-layer"')):e.push(new Ot(r,n.source,'source "'+n.source+'" not found'))}else e.push(new Ot(r,n,'missing required property "source"'));return e=e.concat($n({key:r,value:n,valueSpec:o.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Er({key:r+".type",value:n.type,valueSpec:o.layer.type,style:t.style,styleSpec:t.styleSpec,object:n,objectKey:"type"})},filter:dr,layout:function(t){return $n({layer:n,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return yr(It({layerType:s},t))}}})},paint:function(t){return $n({layer:n,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return mr(It({layerType:s},t))}}})}}}))}function _r(t){var e=t.value,n=t.key,r=zn(e);return"string"!==r?[new Ot(n,e,"string expected, "+r+" found")]:[]}var xr={promoteId:function(t){var e=t.key,n=t.value;if("string"===zn(n))return _r({key:e,value:n});var r=[];for(var i in n)r.push.apply(r,_r({key:e+"."+i,value:n[i]}));return r}};function br(t){var e=t.value,n=t.key,r=t.styleSpec,i=t.style;if(!e.type)return[new Ot(n,e,'"type" is required')];var o,a=Rt(e.type);switch(a){case"vector":case"raster":case"raster-dem":return $n({key:n,value:e,valueSpec:r["source_"+a.replace("-","_")],style:t.style,styleSpec:r,objectElementValidators:xr});case"geojson":if(o=$n({key:n,value:e,valueSpec:r.source_geojson,style:i,styleSpec:r,objectElementValidators:xr}),e.cluster)for(var s in e.clusterProperties){var u=e.clusterProperties[s],l=u[0],c="string"==typeof l?[l,["accumulated"],["get",s]]:l;o.push.apply(o,rr({key:n+"."+s+".map",value:u[1],expressionContext:"cluster-map"})),o.push.apply(o,rr({key:n+"."+s+".reduce",value:c,expressionContext:"cluster-reduce"}))}return o;case"video":return $n({key:n,value:e,valueSpec:r.source_video,style:i,styleSpec:r});case"image":return $n({key:n,value:e,valueSpec:r.source_image,style:i,styleSpec:r});case"canvas":return[new Ot(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ir({key:n+".type",value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:i,styleSpec:r})}}function wr(t){var e=t.value,n=t.styleSpec,r=n.light,i=t.style,o=[],a=zn(e);if(void 0===e)return o;if("object"!==a)return o.concat([new Ot("light",e,"object expected, "+a+" found")]);for(var s in e){var u=s.match(/^(.*)-transition$/);o=o.concat(u&&r[u[1]]&&r[u[1]].transition?Er({key:s,value:e[s],valueSpec:n.transition,style:i,styleSpec:n}):r[s]?Er({key:s,value:e[s],valueSpec:r[s],style:i,styleSpec:n}):[new Ot(s,e[s],'unknown property "'+s+'"')])}return o}var Sr={"*":function(){return[]},array:tr,boolean:function(t){var e=t.value,n=t.key,r=zn(e);return"boolean"!==r?[new Ot(n,e,"boolean expected, "+r+" found")]:[]},number:er,color:function(t){var e=t.key,n=t.value,r=zn(n);return"string"!==r?[new Ot(e,n,"color expected, "+r+" found")]:null===te(n)?[new Ot(e,n,'color expected, "'+n+'" found')]:[]},constants:Lt,enum:ir,filter:dr,function:nr,layer:gr,object:$n,source:br,light:wr,string:_r,formatted:function(t){return 0===_r(t).length?[]:rr(t)},resolvedImage:function(t){return 0===_r(t).length?[]:rr(t)}};function Er(t){var e=t.value,n=t.valueSpec,r=t.styleSpec;return n.expression&&Fn(Rt(e))?nr(t):n.expression&&qn(Dt(e))?rr(t):n.type&&Sr[n.type]?Sr[n.type](t):$n(It({},t,{valueSpec:n.type?r[n.type]:n}))}function Cr(t){var e=t.value,n=t.key,r=_r(t);return r.length||(-1===e.indexOf("{fontstack}")&&r.push(new Ot(n,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&r.push(new Ot(n,e,'"glyphs" url must include a "{range}" token'))),r}function Tr(t,e){void 0===e&&(e=Pt);var n=[];return n=n.concat(Er({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Cr,"*":function(){return[]}}})),t.constants&&(n=n.concat(Lt({key:"constants",value:t.constants,style:t,styleSpec:e}))),Ar(n)}function Ar(t){return[].concat(t).sort((function(t,e){return t.line-e.line}))}function Mr(t){return function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];return Ar(t.apply(this,e))}}Tr.source=Mr(br),Tr.light=Mr(wr),Tr.layer=Mr(gr),Tr.filter=Mr(dr),Tr.paintProperty=Mr(mr),Tr.layoutProperty=Mr(yr);var kr=Tr,Pr=kr.light,Or=kr.paintProperty,Lr=kr.layoutProperty;function Ir(t,e){var n=!1;if(e&&e.length)for(var r=0,i=e;r<i.length;r+=1)t.fire(new Mt(new Error(i[r].message))),n=!0;return n}var Rr=Dr;function Dr(t,e,n){var r=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var i=new Int32Array(this.arrayBuffer);t=i[0],this.d=(e=i[1])+2*(n=i[2]);for(var o=0;o<this.d*this.d;o++){var a=i[3+o],s=i[3+o+1];r.push(a===s?null:i.subarray(a,s))}var u=i[3+r.length+1];this.keys=i.subarray(i[3+r.length],u),this.bboxes=i.subarray(u),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var l=0;l<this.d*this.d;l++)r.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var c=n/e*t;this.min=-c,this.max=t+c}Dr.prototype.insert=function(t,e,n,r,i){this._forEachCell(e,n,r,i,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)},Dr.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Dr.prototype._insertCell=function(t,e,n,r,i,o){this.cells[i].push(o)},Dr.prototype.query=function(t,e,n,r,i){var o=this.min,a=this.max;if(t<=o&&e<=o&&a<=n&&a<=r&&!i)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(t,e,n,r,this._queryCell,s,{},i),s},Dr.prototype._queryCell=function(t,e,n,r,i,o,a,s){var u=this.cells[i];if(null!==u)for(var l=this.keys,c=this.bboxes,p=0;p<u.length;p++){var h=u[p];if(void 0===a[h]){var f=4*h;(s?s(c[f+0],c[f+1],c[f+2],c[f+3]):t<=c[f+2]&&e<=c[f+3]&&n>=c[f+0]&&r>=c[f+1])?(a[h]=!0,o.push(l[h])):a[h]=!1}}},Dr.prototype._forEachCell=function(t,e,n,r,i,o,a,s){for(var u=this._convertToCellCoord(t),l=this._convertToCellCoord(e),c=this._convertToCellCoord(n),p=this._convertToCellCoord(r),h=u;h<=c;h++)for(var f=l;f<=p;f++){var d=this.d*f+h;if((!s||s(this._convertFromCellCoord(h),this._convertFromCellCoord(f),this._convertFromCellCoord(h+1),this._convertFromCellCoord(f+1)))&&i.call(this,t,e,n,r,d,o,a,s))return}},Dr.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Dr.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Dr.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,n=0,r=0;r<this.cells.length;r++)n+=this.cells[r].length;var i=new Int32Array(e+n+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;for(var o=e,a=0;a<t.length;a++){var s=t[a];i[3+a]=o,i.set(s,o),o+=s.length}return i[3+t.length]=o,i.set(this.keys,o),i[3+t.length+1]=o+=this.keys.length,i.set(this.bboxes,o),o+=this.bboxes.length,i.buffer};var Nr=s.ImageData,Zr=s.ImageBitmap,zr={};function Fr(t,e,n){void 0===n&&(n={}),Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),zr[t]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}for(var Br in Fr("Object",Object),Rr.serialize=function(t,e){var n=t.toArrayBuffer();return e&&e.push(n),{buffer:n}},Rr.deserialize=function(t){return new Rr(t.buffer)},Fr("Grid",Rr),Fr("Color",ee),Fr("Error",Error),Fr("ResolvedImage",oe),Fr("StylePropertyFunction",Jn),Fr("StyleExpression",Wn,{omit:["_evaluator"]}),Fr("ZoomDependentExpression",Kn),Fr("ZoomConstantExpression",Yn),Fr("CompoundExpression",xe,{omit:["_evaluate"]}),Mn)Mn[Br]._classRegistryKey||Fr("Expression_"+Br,Mn[Br]);function jr(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function Ur(t){return Zr&&t instanceof Zr}function Vr(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(jr(t)||Ur(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){var n=t;return e&&e.push(n.buffer),n}if(t instanceof Nr)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){for(var r=[],i=0,o=t;i<o.length;i+=1)r.push(Vr(o[i],e));return r}if("object"==typeof t){var a=t.constructor,s=a._classRegistryKey;if(!s)throw new Error("can't serialize object of unregistered class");var u=a.serialize?a.serialize(t,e):{};if(!a.serialize){for(var l in t)if(t.hasOwnProperty(l)&&!(zr[s].omit.indexOf(l)>=0)){var c=t[l];u[l]=zr[s].shallow.indexOf(l)>=0?c:Vr(c,e)}t instanceof Error&&(u.message=t.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==s&&(u.$name=s),u}throw new Error("can't serialize object of type "+typeof t)}function Gr(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||jr(t)||Ur(t)||ArrayBuffer.isView(t)||t instanceof Nr)return t;if(Array.isArray(t))return t.map(Gr);if("object"==typeof t){var e=t.$name||"Object",n=zr[e].klass;if(!n)throw new Error("can't deserialize unregistered class "+e);if(n.deserialize)return n.deserialize(t);for(var r=Object.create(n.prototype),i=0,o=Object.keys(t);i<o.length;i+=1){var a=o[i];if("$name"!==a){var s=t[a];r[a]=zr[e].shallow.indexOf(a)>=0?s:Gr(s)}}return r}throw new Error("can't deserialize object of type "+typeof t)}var Hr=function(){this.first=!0};Hr.prototype.update=function(t,e){var n=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=n,!0))};var Wr={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function qr(t){for(var e=0,n=t;e<n.length;e+=1)if(Xr(n[e].charCodeAt(0)))return!0;return!1}function Xr(t){return!(746!==t&&747!==t&&(t<4352||!(Wr["Bopomofo Extended"](t)||Wr.Bopomofo(t)||Wr["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Wr["CJK Compatibility Ideographs"](t)||Wr["CJK Compatibility"](t)||Wr["CJK Radicals Supplement"](t)||Wr["CJK Strokes"](t)||!(!Wr["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||Wr["CJK Unified Ideographs Extension A"](t)||Wr["CJK Unified Ideographs"](t)||Wr["Enclosed CJK Letters and Months"](t)||Wr["Hangul Compatibility Jamo"](t)||Wr["Hangul Jamo Extended-A"](t)||Wr["Hangul Jamo Extended-B"](t)||Wr["Hangul Jamo"](t)||Wr["Hangul Syllables"](t)||Wr.Hiragana(t)||Wr["Ideographic Description Characters"](t)||Wr.Kanbun(t)||Wr["Kangxi Radicals"](t)||Wr["Katakana Phonetic Extensions"](t)||Wr.Katakana(t)&&12540!==t||!(!Wr["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!Wr["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Wr["Unified Canadian Aboriginal Syllabics"](t)||Wr["Unified Canadian Aboriginal Syllabics Extended"](t)||Wr["Vertical Forms"](t)||Wr["Yijing Hexagram Symbols"](t)||Wr["Yi Syllables"](t)||Wr["Yi Radicals"](t))))}function Yr(t){return!(Xr(t)||function(t){return!!(Wr["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||Wr["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||Wr["Letterlike Symbols"](t)||Wr["Number Forms"](t)||Wr["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||Wr["Control Pictures"](t)&&9251!==t||Wr["Optical Character Recognition"](t)||Wr["Enclosed Alphanumerics"](t)||Wr["Geometric Shapes"](t)||Wr["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Wr["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Wr["CJK Symbols and Punctuation"](t)||Wr.Katakana(t)||Wr["Private Use Area"](t)||Wr["CJK Compatibility Forms"](t)||Wr["Small Form Variants"](t)||Wr["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function Kr(t){return t>=1424&&t<=2303||Wr["Arabic Presentation Forms-A"](t)||Wr["Arabic Presentation Forms-B"](t)}function Qr(t,e){return!(!e&&Kr(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Wr.Khmer(t))}function Jr(t){for(var e=0,n=t;e<n.length;e+=1)if(Kr(n[e].charCodeAt(0)))return!0;return!1}var $r=null,ti="unavailable",ei=null,ni=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(ti="error"),$r&&$r(t)};function ri(){ii.fire(new At("pluginStateChange",{pluginStatus:ti,pluginURL:ei}))}var ii=new kt,oi=function(){return ti},ai=function(){if("deferred"!==ti||!ei)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ti="loading",ri(),ei&&bt({url:ei},(function(t){t?ni(t):(ti="loaded",ri())}))},si={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return"loaded"===ti||null!=si.applyArabicShaping},isLoading:function(){return"loading"===ti},setState:function(t){ti=t.pluginStatus,ei=t.pluginURL},isParsed:function(){return null!=si.applyArabicShaping&&null!=si.processBidirectionalText&&null!=si.processStyledBidirectionalText},getPluginURL:function(){return ei}},ui=function(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Hr,this.transition={})};ui.prototype.isSupportedScript=function(t){return function(t,e){for(var n=0,r=t;n<r.length;n+=1)if(!Qr(r[n].charCodeAt(0),e))return!1;return!0}(t,si.isLoaded())},ui.prototype.crossFadingFactor=function(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},ui.prototype.getCrossfadeParameters=function(){var t=this.zoom,e=t-Math.floor(t),n=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:e+(1-e)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*e}};var li=function(t,e){this.property=t,this.value=e,this.expression=function(t,e){if(Fn(t))return new Jn(t,e);if(qn(t)){var n=Qn(t,e);if("error"===n.result)throw new Error(n.value.map((function(t){return t.key+": "+t.message})).join(", "));return n.value}var r=t;return"string"==typeof t&&"color"===e.type&&(r=ee.parse(t)),{kind:"constant",evaluate:function(){return r}}}(void 0===e?t.specification.default:e,t.specification)};li.prototype.isDataDriven=function(){return"source"===this.expression.kind||"composite"===this.expression.kind},li.prototype.possiblyEvaluate=function(t,e,n){return this.property.possiblyEvaluate(this,t,e,n)};var ci=function(t){this.property=t,this.value=new li(t,void 0)};ci.prototype.transitioned=function(t,e){return new hi(this.property,this.value,e,f({},t.transition,this.transition),t.now)},ci.prototype.untransitioned=function(){return new hi(this.property,this.value,null,{},0)};var pi=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};pi.prototype.getValue=function(t){return w(this._values[t].value.value)},pi.prototype.setValue=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new ci(this._values[t].property)),this._values[t].value=new li(this._values[t].property,null===e?void 0:w(e))},pi.prototype.getTransition=function(t){return w(this._values[t].transition)},pi.prototype.setTransition=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new ci(this._values[t].property)),this._values[t].transition=w(e)||void 0},pi.prototype.serialize=function(){for(var t={},e=0,n=Object.keys(this._values);e<n.length;e+=1){var r=n[e],i=this.getValue(r);void 0!==i&&(t[r]=i);var o=this.getTransition(r);void 0!==o&&(t[r+"-transition"]=o)}return t},pi.prototype.transitioned=function(t,e){for(var n=new fi(this._properties),r=0,i=Object.keys(this._values);r<i.length;r+=1){var o=i[r];n._values[o]=this._values[o].transitioned(t,e._values[o])}return n},pi.prototype.untransitioned=function(){for(var t=new fi(this._properties),e=0,n=Object.keys(this._values);e<n.length;e+=1){var r=n[e];t._values[r]=this._values[r].untransitioned()}return t};var hi=function(t,e,n,r,i){this.property=t,this.value=e,this.begin=i+r.delay||0,this.end=this.begin+r.duration||0,t.specification.transition&&(r.delay||r.duration)&&(this.prior=n)};hi.prototype.possiblyEvaluate=function(t,e,n){var r=t.now||0,i=this.value.possiblyEvaluate(t,e,n),o=this.prior;if(o){if(r>this.end)return this.prior=null,i;if(this.value.isDataDriven())return this.prior=null,i;if(r<this.begin)return o.possiblyEvaluate(t,e,n);var a=(r-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(t,e,n),i,function(t){if(t<=0)return 0;if(t>=1)return 1;var e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}(a))}return i};var fi=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};fi.prototype.possiblyEvaluate=function(t,e,n){for(var r=new mi(this._properties),i=0,o=Object.keys(this._values);i<o.length;i+=1){var a=o[i];r._values[a]=this._values[a].possiblyEvaluate(t,e,n)}return r},fi.prototype.hasTransition=function(){for(var t=0,e=Object.keys(this._values);t<e.length;t+=1)if(this._values[e[t]].prior)return!0;return!1};var di=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};di.prototype.getValue=function(t){return w(this._values[t].value)},di.prototype.setValue=function(t,e){this._values[t]=new li(this._values[t].property,null===e?void 0:w(e))},di.prototype.serialize=function(){for(var t={},e=0,n=Object.keys(this._values);e<n.length;e+=1){var r=n[e],i=this.getValue(r);void 0!==i&&(t[r]=i)}return t},di.prototype.possiblyEvaluate=function(t,e,n){for(var r=new mi(this._properties),i=0,o=Object.keys(this._values);i<o.length;i+=1){var a=o[i];r._values[a]=this._values[a].possiblyEvaluate(t,e,n)}return r};var vi=function(t,e,n){this.property=t,this.value=e,this.parameters=n};vi.prototype.isConstant=function(){return"constant"===this.value.kind},vi.prototype.constantOr=function(t){return"constant"===this.value.kind?this.value.value:t},vi.prototype.evaluate=function(t,e,n,r){return this.property.evaluate(this.value,this.parameters,t,e,n,r)};var mi=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};mi.prototype.get=function(t){return this._values[t]};var yi=function(t){this.specification=t};yi.prototype.possiblyEvaluate=function(t,e){return t.expression.evaluate(e)},yi.prototype.interpolate=function(t,e,n){var r=We[this.specification.type];return r?r(t,e,n):t};var gi=function(t,e){this.specification=t,this.overrides=e};gi.prototype.possiblyEvaluate=function(t,e,n,r){return new vi(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(e,null,{},n,r)}:t.expression,e)},gi.prototype.interpolate=function(t,e,n){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new vi(this,{kind:"constant",value:void 0},t.parameters);var r=We[this.specification.type];return r?new vi(this,{kind:"constant",value:r(t.value.value,e.value.value,n)},t.parameters):t},gi.prototype.evaluate=function(t,e,n,r,i,o){return"constant"===t.kind?t.value:t.evaluate(e,n,r,i,o)};var _i=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.possiblyEvaluate=function(t,e,n,r){if(void 0===t.value)return new vi(this,{kind:"constant",value:void 0},e);if("constant"===t.expression.kind){var i=t.expression.evaluate(e,null,{},n,r),o="resolvedImage"===t.property.specification.type&&"string"!=typeof i?i.name:i,a=this._calculate(o,o,o,e);return new vi(this,{kind:"constant",value:a},e)}if("camera"===t.expression.kind){var s=this._calculate(t.expression.evaluate({zoom:e.zoom-1}),t.expression.evaluate({zoom:e.zoom}),t.expression.evaluate({zoom:e.zoom+1}),e);return new vi(this,{kind:"constant",value:s},e)}return new vi(this,t.expression,e)},e.prototype.evaluate=function(t,e,n,r,i,o){if("source"===t.kind){var a=t.evaluate(e,n,r,i,o);return this._calculate(a,a,a,e)}return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(e.zoom)-1},n,r),t.evaluate({zoom:Math.floor(e.zoom)},n,r),t.evaluate({zoom:Math.floor(e.zoom)+1},n,r),e):t.value},e.prototype._calculate=function(t,e,n,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:n,to:e}},e.prototype.interpolate=function(t){return t},e}(gi),xi=function(t){this.specification=t};xi.prototype.possiblyEvaluate=function(t,e,n,r){if(void 0!==t.value){if("constant"===t.expression.kind){var i=t.expression.evaluate(e,null,{},n,r);return this._calculate(i,i,i,e)}return this._calculate(t.expression.evaluate(new ui(Math.floor(e.zoom-1),e)),t.expression.evaluate(new ui(Math.floor(e.zoom),e)),t.expression.evaluate(new ui(Math.floor(e.zoom+1),e)),e)}},xi.prototype._calculate=function(t,e,n,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:n,to:e}},xi.prototype.interpolate=function(t){return t};var bi=function(t){this.specification=t};bi.prototype.possiblyEvaluate=function(t,e,n,r){return!!t.expression.evaluate(e,null,{},n,r)},bi.prototype.interpolate=function(){return!1};var wi=function(t){for(var e in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var n=t[e];n.specification.overridable&&this.overridableProperties.push(e);var r=this.defaultPropertyValues[e]=new li(n,void 0),i=this.defaultTransitionablePropertyValues[e]=new ci(n);this.defaultTransitioningPropertyValues[e]=i.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=r.possiblyEvaluate({})}};Fr("DataDrivenProperty",gi),Fr("DataConstantProperty",yi),Fr("CrossFadedDataDrivenProperty",_i),Fr("CrossFadedProperty",xi),Fr("ColorRampProperty",bi);var Si=function(t){function e(e,n){if(t.call(this),this.id=e.id,this.type=e.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new di(n.layout)),n.paint)){for(var r in this._transitionablePaint=new pi(n.paint),e.paint)this.setPaintProperty(r,e.paint[r],{validate:!1});for(var i in e.layout)this.setLayoutProperty(i,e.layout[i],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new mi(n.paint)}}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},e.prototype.getLayoutProperty=function(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)},e.prototype.setLayoutProperty=function(t,e,n){void 0===n&&(n={}),null!=e&&this._validate(Lr,"layers."+this.id+".layout."+t,t,e,n)||("visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility=e)},e.prototype.getPaintProperty=function(t){return _(t,"-transition")?this._transitionablePaint.getTransition(t.slice(0,-"-transition".length)):this._transitionablePaint.getValue(t)},e.prototype.setPaintProperty=function(t,e,n){if(void 0===n&&(n={}),null!=e&&this._validate(Or,"layers."+this.id+".paint."+t,t,e,n))return!1;if(_(t,"-transition"))return this._transitionablePaint.setTransition(t.slice(0,-"-transition".length),e||void 0),!1;var r=this._transitionablePaint._values[t],i="cross-faded-data-driven"===r.property.specification["property-type"],o=r.value.isDataDriven(),a=r.value;this._transitionablePaint.setValue(t,e),this._handleSpecialPaintPropertyUpdate(t);var s=this._transitionablePaint._values[t].value;return s.isDataDriven()||o||i||this._handleOverridablePaintPropertyUpdate(t,a,s)},e.prototype._handleSpecialPaintPropertyUpdate=function(t){},e.prototype._handleOverridablePaintPropertyUpdate=function(t,e,n){return!1},e.prototype.isHidden=function(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility},e.prototype.updateTransitions=function(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)},e.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},e.prototype.recalculate=function(t,e){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,e)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,e)},e.prototype.serialize=function(){var t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),b(t,(function(t,e){return!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)}))},e.prototype._validate=function(t,e,n,r,i){return void 0===i&&(i={}),(!i||!1!==i.validate)&&Ir(this,t.call(kr,{key:e,layerType:this.type,objectKey:n,value:r,styleSpec:Pt,style:{glyphs:!0,sprite:!0}}))},e.prototype.is3D=function(){return!1},e.prototype.isTileClipped=function(){return!1},e.prototype.hasOffscreenPass=function(){return!1},e.prototype.resize=function(){},e.prototype.isStateDependent=function(){for(var t in this.paint._values){var e=this.paint.get(t);if(e instanceof vi&&Dn(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1},e}(kt),Ei={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Ci=function(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Ti=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Ai(t,e){void 0===e&&(e=1);var n=0,r=0;return{members:t.map((function(t){var i=Ei[t.type].BYTES_PER_ELEMENT,o=n=Mi(n,Math.max(e,i)),a=t.components||1;return r=Math.max(r,i),n+=i*a,{name:t.name,type:t.type,components:a,offset:o}})),size:Mi(n,Math.max(r,e)),alignment:e}}function Mi(t,e){return Math.ceil(t/e)*e}Ti.serialize=function(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},Ti.deserialize=function(t){var e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e},Ti.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Ti.prototype.clear=function(){this.length=0},Ti.prototype.resize=function(t){this.reserve(t),this.length=t},Ti.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}},Ti.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var ki=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var n=this.length;return this.resize(n+1),this.emplace(n,t,e)},e.prototype.emplace=function(t,e,n){var r=2*t;return this.int16[r+0]=e,this.int16[r+1]=n,t},e}(Ti);ki.prototype.bytesPerElement=4,Fr("StructArrayLayout2i4",ki);var Pi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,n,r)},e.prototype.emplace=function(t,e,n,r,i){var o=4*t;return this.int16[o+0]=e,this.int16[o+1]=n,this.int16[o+2]=r,this.int16[o+3]=i,t},e}(Ti);Pi.prototype.bytesPerElement=8,Fr("StructArrayLayout4i8",Pi);var Oi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,n,r,i,o)},e.prototype.emplace=function(t,e,n,r,i,o,a){var s=6*t;return this.int16[s+0]=e,this.int16[s+1]=n,this.int16[s+2]=r,this.int16[s+3]=i,this.int16[s+4]=o,this.int16[s+5]=a,t},e}(Ti);Oi.prototype.bytesPerElement=12,Fr("StructArrayLayout2i4i12",Oi);var Li=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,n,r,i,o)},e.prototype.emplace=function(t,e,n,r,i,o,a){var s=4*t,u=8*t;return this.int16[s+0]=e,this.int16[s+1]=n,this.uint8[u+4]=r,this.uint8[u+5]=i,this.uint8[u+6]=o,this.uint8[u+7]=a,t},e}(Ti);Li.prototype.bytesPerElement=8,Fr("StructArrayLayout2i4ub8",Li);var Ii=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var n=this.length;return this.resize(n+1),this.emplace(n,t,e)},e.prototype.emplace=function(t,e,n){var r=2*t;return this.float32[r+0]=e,this.float32[r+1]=n,t},e}(Ti);Ii.prototype.bytesPerElement=8,Fr("StructArrayLayout2f8",Ii);var Ri=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o,a,s,u,l){var c=this.length;return this.resize(c+1),this.emplace(c,t,e,n,r,i,o,a,s,u,l)},e.prototype.emplace=function(t,e,n,r,i,o,a,s,u,l,c){var p=10*t;return this.uint16[p+0]=e,this.uint16[p+1]=n,this.uint16[p+2]=r,this.uint16[p+3]=i,this.uint16[p+4]=o,this.uint16[p+5]=a,this.uint16[p+6]=s,this.uint16[p+7]=u,this.uint16[p+8]=l,this.uint16[p+9]=c,t},e}(Ti);Ri.prototype.bytesPerElement=20,Fr("StructArrayLayout10ui20",Ri);var Di=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o,a,s,u,l,c,p){var h=this.length;return this.resize(h+1),this.emplace(h,t,e,n,r,i,o,a,s,u,l,c,p)},e.prototype.emplace=function(t,e,n,r,i,o,a,s,u,l,c,p,h){var f=12*t;return this.int16[f+0]=e,this.int16[f+1]=n,this.int16[f+2]=r,this.int16[f+3]=i,this.uint16[f+4]=o,this.uint16[f+5]=a,this.uint16[f+6]=s,this.uint16[f+7]=u,this.int16[f+8]=l,this.int16[f+9]=c,this.int16[f+10]=p,this.int16[f+11]=h,t},e}(Ti);Di.prototype.bytesPerElement=24,Fr("StructArrayLayout4i4ui4i24",Di);var Ni=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,n)},e.prototype.emplace=function(t,e,n,r){var i=3*t;return this.float32[i+0]=e,this.float32[i+1]=n,this.float32[i+2]=r,t},e}(Ti);Ni.prototype.bytesPerElement=12,Fr("StructArrayLayout3f12",Ni);var Zi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.uint32[1*t+0]=e,t},e}(Ti);Zi.prototype.bytesPerElement=4,Fr("StructArrayLayout1ul4",Zi);var zi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o,a,s,u){var l=this.length;return this.resize(l+1),this.emplace(l,t,e,n,r,i,o,a,s,u)},e.prototype.emplace=function(t,e,n,r,i,o,a,s,u,l){var c=10*t,p=5*t;return this.int16[c+0]=e,this.int16[c+1]=n,this.int16[c+2]=r,this.int16[c+3]=i,this.int16[c+4]=o,this.int16[c+5]=a,this.uint32[p+3]=s,this.uint16[c+8]=u,this.uint16[c+9]=l,t},e}(Ti);zi.prototype.bytesPerElement=20,Fr("StructArrayLayout6i1ul2ui20",zi);var Fi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,n,r,i,o)},e.prototype.emplace=function(t,e,n,r,i,o,a){var s=6*t;return this.int16[s+0]=e,this.int16[s+1]=n,this.int16[s+2]=r,this.int16[s+3]=i,this.int16[s+4]=o,this.int16[s+5]=a,t},e}(Ti);Fi.prototype.bytesPerElement=12,Fr("StructArrayLayout2i2i2i12",Fi);var Bi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i){var o=this.length;return this.resize(o+1),this.emplace(o,t,e,n,r,i)},e.prototype.emplace=function(t,e,n,r,i,o){var a=4*t,s=8*t;return this.float32[a+0]=e,this.float32[a+1]=n,this.float32[a+2]=r,this.int16[s+6]=i,this.int16[s+7]=o,t},e}(Ti);Bi.prototype.bytesPerElement=16,Fr("StructArrayLayout2f1f2i16",Bi);var ji=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,n,r)},e.prototype.emplace=function(t,e,n,r,i){var o=12*t,a=3*t;return this.uint8[o+0]=e,this.uint8[o+1]=n,this.float32[a+1]=r,this.float32[a+2]=i,t},e}(Ti);ji.prototype.bytesPerElement=12,Fr("StructArrayLayout2ub2f12",ji);var Ui=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,n)},e.prototype.emplace=function(t,e,n,r){var i=3*t;return this.uint16[i+0]=e,this.uint16[i+1]=n,this.uint16[i+2]=r,t},e}(Ti);Ui.prototype.bytesPerElement=6,Fr("StructArrayLayout3ui6",Ui);var Vi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o,a,s,u,l,c,p,h,f,d,v,m){var y=this.length;return this.resize(y+1),this.emplace(y,t,e,n,r,i,o,a,s,u,l,c,p,h,f,d,v,m)},e.prototype.emplace=function(t,e,n,r,i,o,a,s,u,l,c,p,h,f,d,v,m,y){var g=24*t,_=12*t,x=48*t;return this.int16[g+0]=e,this.int16[g+1]=n,this.uint16[g+2]=r,this.uint16[g+3]=i,this.uint32[_+2]=o,this.uint32[_+3]=a,this.uint32[_+4]=s,this.uint16[g+10]=u,this.uint16[g+11]=l,this.uint16[g+12]=c,this.float32[_+7]=p,this.float32[_+8]=h,this.uint8[x+36]=f,this.uint8[x+37]=d,this.uint8[x+38]=v,this.uint32[_+10]=m,this.int16[g+22]=y,t},e}(Ti);Vi.prototype.bytesPerElement=48,Fr("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Vi);var Gi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o,a,s,u,l,c,p,h,f,d,v,m,y,g,_,x,b,w,S,E,C,T,A){var M=this.length;return this.resize(M+1),this.emplace(M,t,e,n,r,i,o,a,s,u,l,c,p,h,f,d,v,m,y,g,_,x,b,w,S,E,C,T,A)},e.prototype.emplace=function(t,e,n,r,i,o,a,s,u,l,c,p,h,f,d,v,m,y,g,_,x,b,w,S,E,C,T,A,M){var k=34*t,P=17*t;return this.int16[k+0]=e,this.int16[k+1]=n,this.int16[k+2]=r,this.int16[k+3]=i,this.int16[k+4]=o,this.int16[k+5]=a,this.int16[k+6]=s,this.int16[k+7]=u,this.uint16[k+8]=l,this.uint16[k+9]=c,this.uint16[k+10]=p,this.uint16[k+11]=h,this.uint16[k+12]=f,this.uint16[k+13]=d,this.uint16[k+14]=v,this.uint16[k+15]=m,this.uint16[k+16]=y,this.uint16[k+17]=g,this.uint16[k+18]=_,this.uint16[k+19]=x,this.uint16[k+20]=b,this.uint16[k+21]=w,this.uint16[k+22]=S,this.uint32[P+12]=E,this.float32[P+13]=C,this.float32[P+14]=T,this.float32[P+15]=A,this.float32[P+16]=M,t},e}(Ti);Gi.prototype.bytesPerElement=68,Fr("StructArrayLayout8i15ui1ul4f68",Gi);var Hi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.float32[1*t+0]=e,t},e}(Ti);Hi.prototype.bytesPerElement=4,Fr("StructArrayLayout1f4",Hi);var Wi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,n)},e.prototype.emplace=function(t,e,n,r){var i=3*t;return this.int16[i+0]=e,this.int16[i+1]=n,this.int16[i+2]=r,t},e}(Ti);Wi.prototype.bytesPerElement=6,Fr("StructArrayLayout3i6",Wi);var qi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,n)},e.prototype.emplace=function(t,e,n,r){var i=4*t;return this.uint32[2*t+0]=e,this.uint16[i+2]=n,this.uint16[i+3]=r,t},e}(Ti);qi.prototype.bytesPerElement=8,Fr("StructArrayLayout1ul2ui8",qi);var Xi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var n=this.length;return this.resize(n+1),this.emplace(n,t,e)},e.prototype.emplace=function(t,e,n){var r=2*t;return this.uint16[r+0]=e,this.uint16[r+1]=n,t},e}(Ti);Xi.prototype.bytesPerElement=4,Fr("StructArrayLayout2ui4",Xi);var Yi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.uint16[1*t+0]=e,t},e}(Ti);Yi.prototype.bytesPerElement=2,Fr("StructArrayLayout1ui2",Yi);var Ki=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,n,r)},e.prototype.emplace=function(t,e,n,r,i){var o=4*t;return this.float32[o+0]=e,this.float32[o+1]=n,this.float32[o+2]=r,this.float32[o+3]=i,t},e}(Ti);Ki.prototype.bytesPerElement=16,Fr("StructArrayLayout4f16",Ki);var Qi=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return n.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},n.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},n.x1.get=function(){return this._structArray.int16[this._pos2+2]},n.y1.get=function(){return this._structArray.int16[this._pos2+3]},n.x2.get=function(){return this._structArray.int16[this._pos2+4]},n.y2.get=function(){return this._structArray.int16[this._pos2+5]},n.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},n.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},n.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},n.anchorPoint.get=function(){return new o(this.anchorPointX,this.anchorPointY)},Object.defineProperties(e.prototype,n),e}(Ci);Qi.prototype.size=20;var Ji=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new Qi(this,t)},e}(zi);Fr("CollisionBoxArray",Ji);var $i=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return n.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},n.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},n.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},n.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},n.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},n.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},n.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},n.segment.get=function(){return this._structArray.uint16[this._pos2+10]},n.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},n.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},n.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},n.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},n.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},n.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},n.placedOrientation.set=function(t){this._structArray.uint8[this._pos1+37]=t},n.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},n.hidden.set=function(t){this._structArray.uint8[this._pos1+38]=t},n.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},n.crossTileID.set=function(t){this._structArray.uint32[this._pos4+10]=t},n.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(e.prototype,n),e}(Ci);$i.prototype.size=48;var to=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new $i(this,t)},e}(Vi);Fr("PlacedSymbolArray",to);var eo=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return n.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},n.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},n.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},n.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},n.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},n.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},n.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},n.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},n.key.get=function(){return this._structArray.uint16[this._pos2+8]},n.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},n.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},n.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},n.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},n.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},n.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},n.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},n.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},n.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},n.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},n.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},n.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},n.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},n.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},n.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},n.crossTileID.set=function(t){this._structArray.uint32[this._pos4+12]=t},n.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},n.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},n.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},n.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(e.prototype,n),e}(Ci);eo.prototype.size=68;var no=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new eo(this,t)},e}(Gi);Fr("SymbolInstanceArray",no);var ro=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getoffsetX=function(t){return this.float32[1*t+0]},e}(Hi);Fr("GlyphOffsetArray",ro);var io=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getx=function(t){return this.int16[3*t+0]},e.prototype.gety=function(t){return this.int16[3*t+1]},e.prototype.gettileUnitDistanceFromAnchor=function(t){return this.int16[3*t+2]},e}(Wi);Fr("SymbolLineVertexArray",io);var oo=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return n.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},n.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},n.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(e.prototype,n),e}(Ci);oo.prototype.size=8;var ao=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new oo(this,t)},e}(qi);Fr("FeatureIndexArray",ao);var so=Ai([{name:"a_pos",components:2,type:"Int16"}],4).members,uo=function(t){void 0===t&&(t=[]),this.segments=t};function lo(t,e){return 256*(t=p(Math.floor(t),0,255))+p(Math.floor(e),0,255)}uo.prototype.prepareSegment=function(t,e,n,r){var i=this.segments[this.segments.length-1];return t>uo.MAX_VERTEX_ARRAY_LENGTH&&E("Max vertices per segment is "+uo.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!i||i.vertexLength+t>uo.MAX_VERTEX_ARRAY_LENGTH||i.sortKey!==r)&&(i={vertexOffset:e.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},void 0!==r&&(i.sortKey=r),this.segments.push(i)),i},uo.prototype.get=function(){return this.segments},uo.prototype.destroy=function(){for(var t=0,e=this.segments;t<e.length;t+=1){var n=e[t];for(var r in n.vaos)n.vaos[r].destroy()}},uo.simpleSegment=function(t,e,n,r){return new uo([{vertexOffset:t,primitiveOffset:e,vertexLength:n,primitiveLength:r,vaos:{},sortKey:0}])},uo.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Fr("SegmentVector",uo);var co=Ai([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),po=e((function(t){t.exports=function(t,e){var n,r,i,o,a,s,u,l;for(r=t.length-(n=3&t.length),i=e,a=3432918353,s=461845907,l=0;l<r;)u=255&t.charCodeAt(l)|(255&t.charCodeAt(++l))<<8|(255&t.charCodeAt(++l))<<16|(255&t.charCodeAt(++l))<<24,++l,i=27492+(65535&(o=5*(65535&(i=(i^=u=(65535&(u=(u=(65535&u)*a+(((u>>>16)*a&65535)<<16)&4294967295)<<15|u>>>17))*s+(((u>>>16)*s&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(u=0,n){case 3:u^=(255&t.charCodeAt(l+2))<<16;case 2:u^=(255&t.charCodeAt(l+1))<<8;case 1:i^=u=(65535&(u=(u=(65535&(u^=255&t.charCodeAt(l)))*a+(((u>>>16)*a&65535)<<16)&4294967295)<<15|u>>>17))*s+(((u>>>16)*s&65535)<<16)&4294967295}return i^=t.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0}})),ho=e((function(t){t.exports=function(t,e){for(var n,r=t.length,i=e^r,o=0;r>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(o)|(255&t.charCodeAt(++o))<<8|(255&t.charCodeAt(++o))<<16|(255&t.charCodeAt(++o))<<24))+((1540483477*(n>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),r-=4,++o;switch(r){case 3:i^=(255&t.charCodeAt(o+2))<<16;case 2:i^=(255&t.charCodeAt(o+1))<<8;case 1:i=1540483477*(65535&(i^=255&t.charCodeAt(o)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0}})),fo=po,vo=ho;fo.murmur3=po,fo.murmur2=vo;var mo=function(){this.ids=[],this.positions=[],this.indexed=!1};mo.prototype.add=function(t,e,n,r){this.ids.push(go(t)),this.positions.push(e,n,r)},mo.prototype.getPositions=function(t){for(var e=go(t),n=0,r=this.ids.length-1;n<r;){var i=n+r>>1;this.ids[i]>=e?r=i:n=i+1}for(var o=[];this.ids[n]===e;)o.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return o},mo.serialize=function(t,e){var n=new Float64Array(t.ids),r=new Uint32Array(t.positions);return function t(e,n,r,i){for(;r<i;){for(var o=e[r+i>>1],a=r-1,s=i+1;;){do{a++}while(e[a]<o);do{s--}while(e[s]>o);if(a>=s)break;_o(e,a,s),_o(n,3*a,3*s),_o(n,3*a+1,3*s+1),_o(n,3*a+2,3*s+2)}s-r<i-s?(t(e,n,r,s),r=s+1):(t(e,n,s+1,i),i=s)}}(n,r,0,n.length-1),e&&e.push(n.buffer,r.buffer),{ids:n,positions:r}},mo.deserialize=function(t){var e=new mo;return e.ids=t.ids,e.positions=t.positions,e.indexed=!0,e};var yo=Math.pow(2,53)-1;function go(t){var e=+t;return!isNaN(e)&&e<=yo?e:fo(String(t))}function _o(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}Fr("FeaturePositionMap",mo);var xo=function(t,e){this.gl=t.gl,this.location=e},bo=function(t){function e(e,n){t.call(this,e,n),this.current=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))},e}(xo),wo=function(t){function e(e,n){t.call(this,e,n),this.current=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))},e}(xo),So=function(t){function e(e,n){t.call(this,e,n),this.current=[0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))},e}(xo),Eo=function(t){function e(e,n){t.call(this,e,n),this.current=[0,0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))},e}(xo),Co=function(t){function e(e,n){t.call(this,e,n),this.current=[0,0,0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))},e}(xo),To=function(t){function e(e,n){t.call(this,e,n),this.current=ee.transparent}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))},e}(xo),Ao=new Float32Array(16),Mo=function(t){function e(e,n){t.call(this,e,n),this.current=Ao}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(var e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}},e}(xo);function ko(t){return[lo(255*t.r,255*t.g),lo(255*t.b,255*t.a)]}var Po=function(t,e,n){this.value=t,this.uniformNames=e.map((function(t){return"u_"+t})),this.type=n};Po.prototype.setUniform=function(t,e,n){t.set(n.constantOr(this.value))},Po.prototype.getBinding=function(t,e,n){return"color"===this.type?new To(t,e):new wo(t,e)};var Oo=function(t,e){this.uniformNames=e.map((function(t){return"u_"+t})),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Oo.prototype.setConstantPatternPositions=function(t,e){this.pixelRatioFrom=e.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=e.tlbr,this.patternTo=t.tlbr},Oo.prototype.setUniform=function(t,e,n,r){var i="u_pattern_to"===r?this.patternTo:"u_pattern_from"===r?this.patternFrom:"u_pixel_ratio_to"===r?this.pixelRatioTo:"u_pixel_ratio_from"===r?this.pixelRatioFrom:null;i&&t.set(i)},Oo.prototype.getBinding=function(t,e,n){return"u_pattern"===n.substr(0,9)?new Co(t,e):new wo(t,e)};var Lo=function(t,e,n,r){this.expression=t,this.type=n,this.maxValue=0,this.paintVertexAttributes=e.map((function(t){return{name:"a_"+t,type:"Float32",components:"color"===n?2:1,offset:0}})),this.paintVertexArray=new r};Lo.prototype.populatePaintArray=function(t,e,n,r,i){var o=this.paintVertexArray.length,a=this.expression.evaluate(new ui(0),e,{},r,[],i);this.paintVertexArray.resize(t),this._setPaintValue(o,t,a)},Lo.prototype.updatePaintArray=function(t,e,n,r){var i=this.expression.evaluate({zoom:0},n,r);this._setPaintValue(t,e,i)},Lo.prototype._setPaintValue=function(t,e,n){if("color"===this.type)for(var r=ko(n),i=t;i<e;i++)this.paintVertexArray.emplace(i,r[0],r[1]);else{for(var o=t;o<e;o++)this.paintVertexArray.emplace(o,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}},Lo.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Lo.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Io=function(t,e,n,r,i,o){this.expression=t,this.uniformNames=e.map((function(t){return"u_"+t+"_t"})),this.type=n,this.useIntegerZoom=r,this.zoom=i,this.maxValue=0,this.paintVertexAttributes=e.map((function(t){return{name:"a_"+t,type:"Float32",components:"color"===n?4:2,offset:0}})),this.paintVertexArray=new o};Io.prototype.populatePaintArray=function(t,e,n,r,i){var o=this.expression.evaluate(new ui(this.zoom),e,{},r,[],i),a=this.expression.evaluate(new ui(this.zoom+1),e,{},r,[],i),s=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(s,t,o,a)},Io.prototype.updatePaintArray=function(t,e,n,r){var i=this.expression.evaluate({zoom:this.zoom},n,r),o=this.expression.evaluate({zoom:this.zoom+1},n,r);this._setPaintValue(t,e,i,o)},Io.prototype._setPaintValue=function(t,e,n,r){if("color"===this.type)for(var i=ko(n),o=ko(r),a=t;a<e;a++)this.paintVertexArray.emplace(a,i[0],i[1],o[0],o[1]);else{for(var s=t;s<e;s++)this.paintVertexArray.emplace(s,n,r);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(r))}},Io.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Io.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Io.prototype.setUniform=function(t,e){var n=this.useIntegerZoom?Math.floor(e.zoom):e.zoom,r=p(this.expression.interpolationFactor(n,this.zoom,this.zoom+1),0,1);t.set(r)},Io.prototype.getBinding=function(t,e,n){return new wo(t,e)};var Ro=function(t,e,n,r,i,o){this.expression=t,this.type=e,this.useIntegerZoom=n,this.zoom=r,this.layerId=o,this.zoomInPaintVertexArray=new i,this.zoomOutPaintVertexArray=new i};Ro.prototype.populatePaintArray=function(t,e,n){var r=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(r,t,e.patterns&&e.patterns[this.layerId],n)},Ro.prototype.updatePaintArray=function(t,e,n,r,i){this._setPaintValues(t,e,n.patterns&&n.patterns[this.layerId],i)},Ro.prototype._setPaintValues=function(t,e,n,r){if(r&&n){var i=r[n.min],o=r[n.mid],a=r[n.max];if(i&&o&&a)for(var s=t;s<e;s++)this.zoomInPaintVertexArray.emplace(s,o.tl[0],o.tl[1],o.br[0],o.br[1],i.tl[0],i.tl[1],i.br[0],i.br[1],o.pixelRatio,i.pixelRatio),this.zoomOutPaintVertexArray.emplace(s,o.tl[0],o.tl[1],o.br[0],o.br[1],a.tl[0],a.tl[1],a.br[0],a.br[1],o.pixelRatio,a.pixelRatio)}},Ro.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,co.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,co.members,this.expression.isStateDependent))},Ro.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Do=function(t,e,n){this.binders={},this._buffers=[];var r=[];for(var i in t.paint._values)if(n(i)){var o=t.paint.get(i);if(o instanceof vi&&Dn(o.property.specification)){var a=Zo(i,t.type),s=o.value,u=o.property.specification.type,l=o.property.useIntegerZoom,c=o.property.specification["property-type"],p="cross-faded"===c||"cross-faded-data-driven"===c;if("constant"===s.kind)this.binders[i]=p?new Oo(s.value,a):new Po(s.value,a,u),r.push("/u_"+i);else if("source"===s.kind||p){var h=zo(i,u,"source");this.binders[i]=p?new Ro(s,u,l,e,h,t.id):new Lo(s,a,u,h),r.push("/a_"+i)}else{var f=zo(i,u,"composite");this.binders[i]=new Io(s,a,u,l,e,f),r.push("/z_"+i)}}}this.cacheKey=r.sort().join("")};Do.prototype.getMaxValue=function(t){var e=this.binders[t];return e instanceof Lo||e instanceof Io?e.maxValue:0},Do.prototype.populatePaintArrays=function(t,e,n,r,i){for(var o in this.binders){var a=this.binders[o];(a instanceof Lo||a instanceof Io||a instanceof Ro)&&a.populatePaintArray(t,e,n,r,i)}},Do.prototype.setConstantPatternPositions=function(t,e){for(var n in this.binders){var r=this.binders[n];r instanceof Oo&&r.setConstantPatternPositions(t,e)}},Do.prototype.updatePaintArrays=function(t,e,n,r,i){var o=!1;for(var a in t)for(var s=0,u=e.getPositions(a);s<u.length;s+=1){var l=u[s],c=n.feature(l.index);for(var p in this.binders){var h=this.binders[p];if((h instanceof Lo||h instanceof Io||h instanceof Ro)&&!0===h.expression.isStateDependent){var f=r.paint.get(p);h.expression=f.value,h.updatePaintArray(l.start,l.end,c,t[a],i),o=!0}}}return o},Do.prototype.defines=function(){var t=[];for(var e in this.binders){var n=this.binders[e];(n instanceof Po||n instanceof Oo)&&t.push.apply(t,n.uniformNames.map((function(t){return"#define HAS_UNIFORM_"+t})))}return t},Do.prototype.getBinderAttributes=function(){var t=[];for(var e in this.binders){var n=this.binders[e];if(n instanceof Lo||n instanceof Io)for(var r=0;r<n.paintVertexAttributes.length;r++)t.push(n.paintVertexAttributes[r].name);else if(n instanceof Ro)for(var i=0;i<co.members.length;i++)t.push(co.members[i].name)}return t},Do.prototype.getBinderUniforms=function(){var t=[];for(var e in this.binders){var n=this.binders[e];if(n instanceof Po||n instanceof Oo||n instanceof Io)for(var r=0,i=n.uniformNames;r<i.length;r+=1)t.push(i[r])}return t},Do.prototype.getPaintVertexBuffers=function(){return this._buffers},Do.prototype.getUniforms=function(t,e){var n=[];for(var r in this.binders){var i=this.binders[r];if(i instanceof Po||i instanceof Oo||i instanceof Io)for(var o=0,a=i.uniformNames;o<a.length;o+=1){var s=a[o];if(e[s]){var u=i.getBinding(t,e[s],s);n.push({name:s,property:r,binding:u})}}}return n},Do.prototype.setUniforms=function(t,e,n,r){for(var i=0,o=e;i<o.length;i+=1){var a=o[i],s=a.name,u=a.property;this.binders[u].setUniform(a.binding,r,n.get(u),s)}},Do.prototype.updatePaintBuffers=function(t){for(var e in this._buffers=[],this.binders){var n=this.binders[e];if(t&&n instanceof Ro){var r=2===t.fromScale?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;r&&this._buffers.push(r)}else(n instanceof Lo||n instanceof Io)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}},Do.prototype.upload=function(t){for(var e in this.binders){var n=this.binders[e];(n instanceof Lo||n instanceof Io||n instanceof Ro)&&n.upload(t)}this.updatePaintBuffers()},Do.prototype.destroy=function(){for(var t in this.binders){var e=this.binders[t];(e instanceof Lo||e instanceof Io||e instanceof Ro)&&e.destroy()}};var No=function(t,e,n){void 0===n&&(n=function(){return!0}),this.programConfigurations={};for(var r=0,i=t;r<i.length;r+=1){var o=i[r];this.programConfigurations[o.id]=new Do(o,e,n)}this.needsUpload=!1,this._featureMap=new mo,this._bufferOffset=0};function Zo(t,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(e+"-","").replace(/-/g,"_")]}function zo(t,e,n){var r={color:{source:Ii,composite:Ki},number:{source:Hi,composite:Ii}},i=function(t){return{"line-pattern":{source:Ri,composite:Ri},"fill-pattern":{source:Ri,composite:Ri},"fill-extrusion-pattern":{source:Ri,composite:Ri}}[t]}(t);return i&&i[n]||r[e][n]}No.prototype.populatePaintArrays=function(t,e,n,r,i,o){for(var a in this.programConfigurations)this.programConfigurations[a].populatePaintArrays(t,e,r,i,o);void 0!==e.id&&this._featureMap.add(e.id,n,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},No.prototype.updatePaintArrays=function(t,e,n,r){for(var i=0,o=n;i<o.length;i+=1){var a=o[i];this.needsUpload=this.programConfigurations[a.id].updatePaintArrays(t,this._featureMap,e,a,r)||this.needsUpload}},No.prototype.get=function(t){return this.programConfigurations[t]},No.prototype.upload=function(t){if(this.needsUpload){for(var e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}},No.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},Fr("ConstantBinder",Po),Fr("CrossFadedConstantBinder",Oo),Fr("SourceExpressionBinder",Lo),Fr("CrossFadedCompositeBinder",Ro),Fr("CompositeExpressionBinder",Io),Fr("ProgramConfiguration",Do,{omit:["_buffers"]}),Fr("ProgramConfigurationSet",No);var Fo=Math.pow(2,14)-1,Bo=-Fo-1;function jo(t){for(var e=8192/t.extent,n=t.loadGeometry(),r=0;r<n.length;r++)for(var i=n[r],o=0;o<i.length;o++){var a=i[o],s=Math.round(a.x*e),u=Math.round(a.y*e);a.x=p(s,Bo,Fo),a.y=p(u,Bo,Fo),(s<a.x||s>a.x+1||u<a.y||u>a.y+1)&&E("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return n}function Uo(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?jo(t):[]}}function Vo(t,e,n,r,i){t.emplaceBack(2*e+(r+1)/2,2*n+(i+1)/2)}var Go=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ki,this.indexArray=new Ui,this.segments=new uo,this.programConfigurations=new No(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};function Ho(t,e){for(var n=0;n<t.length;n++)if(ta(e,t[n]))return!0;for(var r=0;r<e.length;r++)if(ta(t,e[r]))return!0;return!!Yo(t,e)}function Wo(t,e,n){return!!ta(t,e)||!!Qo(e,t,n)}function qo(t,e){if(1===t.length)return $o(e,t[0]);for(var n=0;n<e.length;n++)for(var r=e[n],i=0;i<r.length;i++)if(ta(t,r[i]))return!0;for(var o=0;o<t.length;o++)if($o(e,t[o]))return!0;for(var a=0;a<e.length;a++)if(Yo(t,e[a]))return!0;return!1}function Xo(t,e,n){if(t.length>1){if(Yo(t,e))return!0;for(var r=0;r<e.length;r++)if(Qo(e[r],t,n))return!0}for(var i=0;i<t.length;i++)if(Qo(t[i],e,n))return!0;return!1}function Yo(t,e){if(0===t.length||0===e.length)return!1;for(var n=0;n<t.length-1;n++)for(var r=t[n],i=t[n+1],o=0;o<e.length-1;o++)if(Ko(r,i,e[o],e[o+1]))return!0;return!1}function Ko(t,e,n,r){return C(t,n,r)!==C(e,n,r)&&C(t,e,n)!==C(t,e,r)}function Qo(t,e,n){var r=n*n;if(1===e.length)return t.distSqr(e[0])<r;for(var i=1;i<e.length;i++)if(Jo(t,e[i-1],e[i])<r)return!0;return!1}function Jo(t,e,n){var r=e.distSqr(n);if(0===r)return t.distSqr(e);var i=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/r;return t.distSqr(i<0?e:i>1?n:n.sub(e)._mult(i)._add(e))}function $o(t,e){for(var n,r,i,o=!1,a=0;a<t.length;a++)for(var s=0,u=(n=t[a]).length-1;s<n.length;u=s++)(r=n[s]).y>e.y!=(i=n[u]).y>e.y&&e.x<(i.x-r.x)*(e.y-r.y)/(i.y-r.y)+r.x&&(o=!o);return o}function ta(t,e){for(var n=!1,r=0,i=t.length-1;r<t.length;i=r++){var o=t[r],a=t[i];o.y>e.y!=a.y>e.y&&e.x<(a.x-o.x)*(e.y-o.y)/(a.y-o.y)+o.x&&(n=!n)}return n}function ea(t,e,n){var r=n[0],i=n[2];if(t.x<r.x&&e.x<r.x||t.x>i.x&&e.x>i.x||t.y<r.y&&e.y<r.y||t.y>i.y&&e.y>i.y)return!1;var o=C(t,e,n[0]);return o!==C(t,e,n[1])||o!==C(t,e,n[2])||o!==C(t,e,n[3])}function na(t,e,n){var r=e.paint.get(t).value;return"constant"===r.kind?r.value:n.programConfigurations.get(e.id).getMaxValue(t)}function ra(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function ia(t,e,n,r,i){if(!e[0]&&!e[1])return t;var a=o.convert(e)._mult(i);"viewport"===n&&a._rotate(-r);for(var s=[],u=0;u<t.length;u++)s.push(t[u].sub(a));return s}Go.prototype.populate=function(t,e,n){var r=this.layers[0],i=[],o=null;"circle"===r.type&&(o=r.layout.get("circle-sort-key"));for(var a=0,s=t;a<s.length;a+=1){var u=s[a],l=u.feature,c=u.id,p=u.index,h=u.sourceLayerIndex,f=this.layers[0]._featureFilter.needGeometry,d=Uo(l,f);if(this.layers[0]._featureFilter.filter(new ui(this.zoom),d,n)){var v=o?o.evaluate(d,{},n):void 0,m={id:c,properties:l.properties,type:l.type,sourceLayerIndex:h,index:p,geometry:f?d.geometry:jo(l),patterns:{},sortKey:v};i.push(m)}}o&&i.sort((function(t,e){return t.sortKey-e.sortKey}));for(var y=0,g=i;y<g.length;y+=1){var _=g[y],x=_.geometry,b=_.index,w=_.sourceLayerIndex,S=t[b].feature;this.addFeature(_,x,b,n),e.featureIndex.insert(S,x,b,w,this.index)}},Go.prototype.update=function(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)},Go.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Go.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Go.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,so),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Go.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Go.prototype.addFeature=function(t,e,n,r){for(var i=0,o=e;i<o.length;i+=1)for(var a=0,s=o[i];a<s.length;a+=1){var u=s[a],l=u.x,c=u.y;if(!(l<0||l>=8192||c<0||c>=8192)){var p=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),h=p.vertexLength;Vo(this.layoutVertexArray,l,c,-1,-1),Vo(this.layoutVertexArray,l,c,1,-1),Vo(this.layoutVertexArray,l,c,1,1),Vo(this.layoutVertexArray,l,c,-1,1),this.indexArray.emplaceBack(h,h+1,h+2),this.indexArray.emplaceBack(h,h+3,h+2),p.vertexLength+=4,p.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,{},r)},Fr("CircleBucket",Go,{omit:["layers"]});var oa=new wi({"circle-sort-key":new gi(Pt.layout_circle["circle-sort-key"])}),aa={paint:new wi({"circle-radius":new gi(Pt.paint_circle["circle-radius"]),"circle-color":new gi(Pt.paint_circle["circle-color"]),"circle-blur":new gi(Pt.paint_circle["circle-blur"]),"circle-opacity":new gi(Pt.paint_circle["circle-opacity"]),"circle-translate":new yi(Pt.paint_circle["circle-translate"]),"circle-translate-anchor":new yi(Pt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new yi(Pt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new yi(Pt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new gi(Pt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new gi(Pt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new gi(Pt.paint_circle["circle-stroke-opacity"])}),layout:oa},sa="undefined"!=typeof Float32Array?Float32Array:Array;function ua(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function la(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],p=e[8],h=e[9],f=e[10],d=e[11],v=e[12],m=e[13],y=e[14],g=e[15],_=n[0],x=n[1],b=n[2],w=n[3];return t[0]=_*r+x*s+b*p+w*v,t[1]=_*i+x*u+b*h+w*m,t[2]=_*o+x*l+b*f+w*y,t[3]=_*a+x*c+b*d+w*g,t[4]=(_=n[4])*r+(x=n[5])*s+(b=n[6])*p+(w=n[7])*v,t[5]=_*i+x*u+b*h+w*m,t[6]=_*o+x*l+b*f+w*y,t[7]=_*a+x*c+b*d+w*g,t[8]=(_=n[8])*r+(x=n[9])*s+(b=n[10])*p+(w=n[11])*v,t[9]=_*i+x*u+b*h+w*m,t[10]=_*o+x*l+b*f+w*y,t[11]=_*a+x*c+b*d+w*g,t[12]=(_=n[12])*r+(x=n[13])*s+(b=n[14])*p+(w=n[15])*v,t[13]=_*i+x*u+b*h+w*m,t[14]=_*o+x*l+b*f+w*y,t[15]=_*a+x*c+b*d+w*g,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,e=0,n=arguments.length;n--;)e+=t[n]*t[n];return Math.sqrt(e)});var ca,pa=la;function ha(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,t[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,t[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,t[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,t}ca=new sa(3),sa!=Float32Array&&(ca[0]=0,ca[1]=0,ca[2]=0),function(){var t=new sa(4);sa!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var fa=(function(){var t=new sa(2);sa!=Float32Array&&(t[0]=0,t[1]=0)}(),function(t){function e(e){t.call(this,e,aa)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new Go(t)},e.prototype.queryRadius=function(t){var e=t;return na("circle-radius",this,e)+na("circle-stroke-width",this,e)+ra(this.paint.get("circle-translate"))},e.prototype.queryIntersectsFeature=function(t,e,n,r,i,o,a,s){for(var u=ia(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,a),l=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n),c="map"===this.paint.get("circle-pitch-alignment"),p=c?u:function(t,e){return t.map((function(t){return da(t,e)}))}(u,s),h=c?l*a:l,f=0,d=r;f<d.length;f+=1)for(var v=0,m=d[f];v<m.length;v+=1){var y=m[v],g=c?y:da(y,s),_=h,x=ha([],[y.x,y.y,0,1],s);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?_*=x[3]/o.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(_*=o.cameraToCenterDistance/x[3]),Wo(p,g,_))return!0}return!1},e}(Si));function da(t,e){var n=ha([],[t.x,t.y,0,1],e);return new o(n[0]/n[3],n[1]/n[3])}var va=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Go);function ma(t,e,n,r){var i=e.width,o=e.height;if(r){if(r instanceof Uint8ClampedArray)r=new Uint8Array(r.buffer);else if(r.length!==i*o*n)throw new RangeError("mismatched image size")}else r=new Uint8Array(i*o*n);return t.width=i,t.height=o,t.data=r,t}function ya(t,e,n){var r=e.width,i=e.height;if(r!==t.width||i!==t.height){var o=ma({},{width:r,height:i},n);ga(t,o,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,r),height:Math.min(t.height,i)},n),t.width=r,t.height=i,t.data=o.data}}function ga(t,e,n,r,i,o){if(0===i.width||0===i.height)return e;if(i.width>t.width||i.height>t.height||n.x>t.width-i.width||n.y>t.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>e.width||i.height>e.height||r.x>e.width-i.width||r.y>e.height-i.height)throw new RangeError("out of range destination coordinates for image copy");for(var a=t.data,s=e.data,u=0;u<i.height;u++)for(var l=((n.y+u)*t.width+n.x)*o,c=((r.y+u)*e.width+r.x)*o,p=0;p<i.width*o;p++)s[c+p]=a[l+p];return e}Fr("HeatmapBucket",va,{omit:["layers"]});var _a=function(t,e){ma(this,t,1,e)};_a.prototype.resize=function(t){ya(this,t,1)},_a.prototype.clone=function(){return new _a({width:this.width,height:this.height},new Uint8Array(this.data))},_a.copy=function(t,e,n,r,i){ga(t,e,n,r,i,1)};var xa=function(t,e){ma(this,t,4,e)};xa.prototype.resize=function(t){ya(this,t,4)},xa.prototype.replace=function(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},xa.prototype.clone=function(){return new xa({width:this.width,height:this.height},new Uint8Array(this.data))},xa.copy=function(t,e,n,r,i){ga(t,e,n,r,i,4)},Fr("AlphaImage",_a),Fr("RGBAImage",xa);var ba={paint:new wi({"heatmap-radius":new gi(Pt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new gi(Pt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new yi(Pt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new bi(Pt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new yi(Pt.paint_heatmap["heatmap-opacity"])})};function wa(t){var e={},n=t.resolution||256,r=t.clips?t.clips.length:1,i=t.image||new xa({width:n,height:r}),o=function(n,r,o){e[t.evaluationKey]=o;var a=t.expression.evaluate(e);i.data[n+r+0]=Math.floor(255*a.r/a.a),i.data[n+r+1]=Math.floor(255*a.g/a.a),i.data[n+r+2]=Math.floor(255*a.b/a.a),i.data[n+r+3]=Math.floor(255*a.a)};if(t.clips)for(var a=0,s=0;a<r;++a,s+=4*n)for(var u=0,l=0;u<n;u++,l+=4){var c=u/(n-1),p=t.clips[a];o(s,l,p.start*(1-c)+p.end*c)}else for(var h=0,f=0;h<n;h++,f+=4)o(0,f,h/(n-1));return i}var Sa=function(t){function e(e){t.call(this,e,ba),this._updateColorRamp()}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new va(t)},e.prototype._handleSpecialPaintPropertyUpdate=function(t){"heatmap-color"===t&&this._updateColorRamp()},e.prototype._updateColorRamp=function(){this.colorRamp=wa({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},e.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility},e}(Si),Ea={paint:new wi({"hillshade-illumination-direction":new yi(Pt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new yi(Pt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new yi(Pt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new yi(Pt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new yi(Pt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new yi(Pt.paint_hillshade["hillshade-accent-color"])})},Ca=function(t){function e(e){t.call(this,e,Ea)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility},e}(Si),Ta=Ai([{name:"a_pos",components:2,type:"Int16"}],4).members,Aa=ka,Ma=ka;function ka(t,e,n){n=n||2;var r,i,o,a,s,u,l,c=e&&e.length,p=c?e[0]*n:t.length,h=Pa(t,0,p,n,!0),f=[];if(!h||h.next===h.prev)return f;if(c&&(h=function(t,e,n,r){var i,o,a,s=[];for(i=0,o=e.length;i<o;i++)(a=Pa(t,e[i]*r,i<o-1?e[i+1]*r:t.length,r,!1))===a.next&&(a.steiner=!0),s.push(ja(a));for(s.sort(Za),i=0;i<s.length;i++)za(s[i],n),n=Oa(n,n.next);return n}(t,e,h,n)),t.length>80*n){r=o=t[0],i=a=t[1];for(var d=n;d<p;d+=n)(s=t[d])<r&&(r=s),(u=t[d+1])<i&&(i=u),s>o&&(o=s),u>a&&(a=u);l=0!==(l=Math.max(o-r,a-i))?1/l:0}return La(h,f,n,r,i,l),f}function Pa(t,e,n,r,i){var o,a;if(i===ts(t,e,n,r)>0)for(o=e;o<n;o+=r)a=Qa(o,t[o],t[o+1],a);else for(o=n-r;o>=e;o-=r)a=Qa(o,t[o],t[o+1],a);return a&&Ha(a,a.next)&&(Ja(a),a=a.next),a}function Oa(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!Ha(r,r.next)&&0!==Ga(r.prev,r,r.next))r=r.next;else{if(Ja(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function La(t,e,n,r,i,o,a){if(t){!a&&o&&function(t,e,n,r){var i=t;do{null===i.z&&(i.z=Ba(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,n,r,i,o,a,s,u,l=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,r=n,s=0,e=0;e<l&&(s++,r=r.nextZ);e++);for(u=l;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,l*=2}while(a>1)}(i)}(t,r,i,o);for(var s,u,l=t;t.prev!==t.next;)if(s=t.prev,u=t.next,o?Ra(t,r,i,o):Ia(t))e.push(s.i/n),e.push(t.i/n),e.push(u.i/n),Ja(t),t=u.next,l=u.next;else if((t=u)===l){a?1===a?La(t=Da(Oa(t),e,n),e,n,r,i,o,2):2===a&&Na(t,e,n,r,i,o):La(Oa(t),e,n,r,i,o,1);break}}}function Ia(t){var e=t.prev,n=t,r=t.next;if(Ga(e,n,r)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(Ua(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&Ga(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Ra(t,e,n,r){var i=t.prev,o=t,a=t.next;if(Ga(i,o,a)>=0)return!1;for(var s=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,u=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,l=Ba(i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,e,n,r),c=Ba(s,u,e,n,r),p=t.prevZ,h=t.nextZ;p&&p.z>=l&&h&&h.z<=c;){if(p!==t.prev&&p!==t.next&&Ua(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&Ga(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,h!==t.prev&&h!==t.next&&Ua(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&Ga(h.prev,h,h.next)>=0)return!1;h=h.nextZ}for(;p&&p.z>=l;){if(p!==t.prev&&p!==t.next&&Ua(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&Ga(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;h&&h.z<=c;){if(h!==t.prev&&h!==t.next&&Ua(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&Ga(h.prev,h,h.next)>=0)return!1;h=h.nextZ}return!0}function Da(t,e,n){var r=t;do{var i=r.prev,o=r.next.next;!Ha(i,o)&&Wa(i,r,r.next,o)&&Ya(i,o)&&Ya(o,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(o.i/n),Ja(r),Ja(r.next),r=t=o),r=r.next}while(r!==t);return Oa(r)}function Na(t,e,n,r,i,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&Va(a,s)){var u=Ka(a,s);return a=Oa(a,a.next),u=Oa(u,u.next),La(a,e,n,r,i,o),void La(u,e,n,r,i,o)}s=s.next}a=a.next}while(a!==t)}function Za(t,e){return t.x-e.x}function za(t,e){if(e=function(t,e){var n,r=e,i=t.x,o=t.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a){if(a=s,s===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!n)return null;if(i===a)return n;var u,l=n,c=n.x,p=n.y,h=1/0;r=n;do{i>=r.x&&r.x>=c&&i!==r.x&&Ua(o<p?i:a,o,c,p,o<p?a:i,o,r.x,r.y)&&(u=Math.abs(o-r.y)/(i-r.x),Ya(r,t)&&(u<h||u===h&&(r.x>n.x||r.x===n.x&&Fa(n,r)))&&(n=r,h=u)),r=r.next}while(r!==l);return n}(t,e)){var n=Ka(e,t);Oa(e,e.next),Oa(n,n.next)}}function Fa(t,e){return Ga(t.prev,t,e.prev)<0&&Ga(e.next,t,t.next)<0}function Ba(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function ja(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function Ua(t,e,n,r,i,o,a,s){return(i-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(r-s)-(n-a)*(e-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function Va(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Wa(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(Ya(t,e)&&Ya(e,t)&&function(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(Ga(t.prev,t,e.prev)||Ga(t,e.prev,e))||Ha(t,e)&&Ga(t.prev,t,t.next)>0&&Ga(e.prev,e,e.next)>0)}function Ga(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Ha(t,e){return t.x===e.x&&t.y===e.y}function Wa(t,e,n,r){var i=Xa(Ga(t,e,n)),o=Xa(Ga(t,e,r)),a=Xa(Ga(n,r,t)),s=Xa(Ga(n,r,e));return i!==o&&a!==s||!(0!==i||!qa(t,n,e))||!(0!==o||!qa(t,r,e))||!(0!==a||!qa(n,t,r))||!(0!==s||!qa(n,e,r))}function qa(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Xa(t){return t>0?1:t<0?-1:0}function Ya(t,e){return Ga(t.prev,t,t.next)<0?Ga(t,e,t.next)>=0&&Ga(t,t.prev,e)>=0:Ga(t,e,t.prev)<0||Ga(t,t.next,e)<0}function Ka(t,e){var n=new $a(t.i,t.x,t.y),r=new $a(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function Qa(t,e,n,r){var i=new $a(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Ja(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function $a(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ts(t,e,n,r){for(var i=0,o=e,a=n-r;o<n;o+=r)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}function es(t,e,n,r,i){!function t(e,n,r,i,o){for(;i>r;){if(i-r>600){var a=i-r+1,s=n-r+1,u=Math.log(a),l=.5*Math.exp(2*u/3),c=.5*Math.sqrt(u*l*(a-l)/a)*(s-a/2<0?-1:1);t(e,n,Math.max(r,Math.floor(n-s*l/a+c)),Math.min(i,Math.floor(n+(a-s)*l/a+c)),o)}var p=e[n],h=r,f=i;for(ns(e,r,n),o(e[i],p)>0&&ns(e,r,i);h<f;){for(ns(e,h,f),h++,f--;o(e[h],p)<0;)h++;for(;o(e[f],p)>0;)f--}0===o(e[r],p)?ns(e,r,f):ns(e,++f,i),f<=n&&(r=f+1),n<=f&&(i=f-1)}}(t,e,n||0,r||t.length-1,i||rs)}function ns(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function rs(t,e){return t<e?-1:t>e?1:0}function is(t,e){var n=t.length;if(n<=1)return[t];for(var r,i,o=[],a=0;a<n;a++){var s=T(t[a]);0!==s&&(t[a].area=Math.abs(s),void 0===i&&(i=s<0),i===s<0?(r&&o.push(r),r=[t[a]]):r.push(t[a]))}if(r&&o.push(r),e>1)for(var u=0;u<o.length;u++)o[u].length<=e||(es(o[u],e,1,o[u].length-1,os),o[u]=o[u].slice(0,e));return o}function os(t,e){return e.area-t.area}function as(t,e,n){for(var r=n.patternDependencies,i=!1,o=0,a=e;o<a.length;o+=1){var s=a[o].paint.get(t+"-pattern");s.isConstant()||(i=!0);var u=s.constantOr(null);u&&(i=!0,r[u.to]=!0,r[u.from]=!0)}return i}function ss(t,e,n,r,i){for(var o=i.patternDependencies,a=0,s=e;a<s.length;a+=1){var u=s[a],l=u.paint.get(t+"-pattern").value;if("constant"!==l.kind){var c=l.evaluate({zoom:r-1},n,{},i.availableImages),p=l.evaluate({zoom:r},n,{},i.availableImages),h=l.evaluate({zoom:r+1},n,{},i.availableImages);p=p&&p.name?p.name:p,h=h&&h.name?h.name:h,o[c=c&&c.name?c.name:c]=!0,o[p]=!0,o[h]=!0,n.patterns[u.id]={min:c,mid:p,max:h}}}return n}ka.deviation=function(t,e,n,r){var i=e&&e.length,o=Math.abs(ts(t,0,i?e[0]*n:t.length,n));if(i)for(var a=0,s=e.length;a<s;a++)o-=Math.abs(ts(t,e[a]*n,a<s-1?e[a+1]*n:t.length,n));var u=0;for(a=0;a<r.length;a+=3){var l=r[a]*n,c=r[a+1]*n,p=r[a+2]*n;u+=Math.abs((t[l]-t[p])*(t[c+1]-t[l+1])-(t[l]-t[c])*(t[p+1]-t[l+1]))}return 0===o&&0===u?0:Math.abs((u-o)/o)},ka.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)n.vertices.push(t[i][o][a]);i>0&&n.holes.push(r+=t[i-1].length)}return n},Aa.default=Ma;var us=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ki,this.indexArray=new Ui,this.indexArray2=new Xi,this.programConfigurations=new No(t.layers,t.zoom),this.segments=new uo,this.segments2=new uo,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};us.prototype.populate=function(t,e,n){this.hasPattern=as("fill",this.layers,e);for(var r=this.layers[0].layout.get("fill-sort-key"),i=[],o=0,a=t;o<a.length;o+=1){var s=a[o],u=s.feature,l=s.id,c=s.index,p=s.sourceLayerIndex,h=this.layers[0]._featureFilter.needGeometry,f=Uo(u,h);if(this.layers[0]._featureFilter.filter(new ui(this.zoom),f,n)){var d=r?r.evaluate(f,{},n,e.availableImages):void 0,v={id:l,properties:u.properties,type:u.type,sourceLayerIndex:p,index:c,geometry:h?f.geometry:jo(u),patterns:{},sortKey:d};i.push(v)}}r&&i.sort((function(t,e){return t.sortKey-e.sortKey}));for(var m=0,y=i;m<y.length;m+=1){var g=y[m],_=g.geometry,x=g.index,b=g.sourceLayerIndex;if(this.hasPattern){var w=ss("fill",this.layers,g,this.zoom,e);this.patternFeatures.push(w)}else this.addFeature(g,_,x,n,{});e.featureIndex.insert(t[x].feature,_,x,b,this.index)}},us.prototype.update=function(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)},us.prototype.addFeatures=function(t,e,n){for(var r=0,i=this.patternFeatures;r<i.length;r+=1){var o=i[r];this.addFeature(o,o.geometry,o.index,e,n)}},us.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},us.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},us.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ta),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},us.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},us.prototype.addFeature=function(t,e,n,r,i){for(var o=0,a=is(e,500);o<a.length;o+=1){for(var s=a[o],u=0,l=0,c=s;l<c.length;l+=1)u+=c[l].length;for(var p=this.segments.prepareSegment(u,this.layoutVertexArray,this.indexArray),h=p.vertexLength,f=[],d=[],v=0,m=s;v<m.length;v+=1){var y=m[v];if(0!==y.length){y!==s[0]&&d.push(f.length/2);var g=this.segments2.prepareSegment(y.length,this.layoutVertexArray,this.indexArray2),_=g.vertexLength;this.layoutVertexArray.emplaceBack(y[0].x,y[0].y),this.indexArray2.emplaceBack(_+y.length-1,_),f.push(y[0].x),f.push(y[0].y);for(var x=1;x<y.length;x++)this.layoutVertexArray.emplaceBack(y[x].x,y[x].y),this.indexArray2.emplaceBack(_+x-1,_+x),f.push(y[x].x),f.push(y[x].y);g.vertexLength+=y.length,g.primitiveLength+=y.length}}for(var b=Aa(f,d),w=0;w<b.length;w+=3)this.indexArray.emplaceBack(h+b[w],h+b[w+1],h+b[w+2]);p.vertexLength+=u,p.primitiveLength+=b.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,i,r)},Fr("FillBucket",us,{omit:["layers","patternFeatures"]});var ls=new wi({"fill-sort-key":new gi(Pt.layout_fill["fill-sort-key"])}),cs={paint:new wi({"fill-antialias":new yi(Pt.paint_fill["fill-antialias"]),"fill-opacity":new gi(Pt.paint_fill["fill-opacity"]),"fill-color":new gi(Pt.paint_fill["fill-color"]),"fill-outline-color":new gi(Pt.paint_fill["fill-outline-color"]),"fill-translate":new yi(Pt.paint_fill["fill-translate"]),"fill-translate-anchor":new yi(Pt.paint_fill["fill-translate-anchor"]),"fill-pattern":new _i(Pt.paint_fill["fill-pattern"])}),layout:ls},ps=function(t){function e(e){t.call(this,e,cs)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.recalculate=function(e,n){t.prototype.recalculate.call(this,e,n);var r=this.paint._values["fill-outline-color"];"constant"===r.value.kind&&void 0===r.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},e.prototype.createBucket=function(t){return new us(t)},e.prototype.queryRadius=function(){return ra(this.paint.get("fill-translate"))},e.prototype.queryIntersectsFeature=function(t,e,n,r,i,o,a){return qo(ia(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,a),r)},e.prototype.isTileClipped=function(){return!0},e}(Si),hs=Ai([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,fs=ds;function ds(t,e,n,r,i){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=i,t.readFields(vs,this,e)}function vs(t,e,n){1==t?e.id=n.readVarint():2==t?function(t,e){for(var n=t.readVarint()+t.pos;t.pos<n;){var r=e._keys[t.readVarint()],i=e._values[t.readVarint()];e.properties[r]=i}}(n,e):3==t?e.type=n.readVarint():4==t&&(e._geometry=n.pos)}function ms(t){for(var e,n,r=0,i=0,o=t.length,a=o-1;i<o;a=i++)r+=((n=t[a]).x-(e=t[i]).x)*(e.y+n.y);return r}ds.types=["Unknown","Point","LineString","Polygon"],ds.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,r=1,i=0,a=0,s=0,u=[];t.pos<n;){if(i<=0){var l=t.readVarint();r=7&l,i=l>>3}if(i--,1===r||2===r)a+=t.readSVarint(),s+=t.readSVarint(),1===r&&(e&&u.push(e),e=[]),e.push(new o(a,s));else{if(7!==r)throw new Error("unknown command "+r);e&&e.push(e[0].clone())}}return e&&u.push(e),u},ds.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,r=0,i=0,o=0,a=1/0,s=-1/0,u=1/0,l=-1/0;t.pos<e;){if(r<=0){var c=t.readVarint();n=7&c,r=c>>3}if(r--,1===n||2===n)(i+=t.readSVarint())<a&&(a=i),i>s&&(s=i),(o+=t.readSVarint())<u&&(u=o),o>l&&(l=o);else if(7!==n)throw new Error("unknown command "+n)}return[a,u,s,l]},ds.prototype.toGeoJSON=function(t,e,n){var r,i,o=this.extent*Math.pow(2,n),a=this.extent*t,s=this.extent*e,u=this.loadGeometry(),l=ds.types[this.type];function c(t){for(var e=0;e<t.length;e++){var n=t[e];t[e]=[360*(n.x+a)/o-180,360/Math.PI*Math.atan(Math.exp((180-360*(n.y+s)/o)*Math.PI/180))-90]}}switch(this.type){case 1:var p=[];for(r=0;r<u.length;r++)p[r]=u[r][0];c(u=p);break;case 2:for(r=0;r<u.length;r++)c(u[r]);break;case 3:for(u=function(t){var e=t.length;if(e<=1)return[t];for(var n,r,i=[],o=0;o<e;o++){var a=ms(t[o]);0!==a&&(void 0===r&&(r=a<0),r===a<0?(n&&i.push(n),n=[t[o]]):n.push(t[o]))}return n&&i.push(n),i}(u),r=0;r<u.length;r++)for(i=0;i<u[r].length;i++)c(u[r][i])}1===u.length?u=u[0]:l="Multi"+l;var h={type:"Feature",geometry:{type:l,coordinates:u},properties:this.properties};return"id"in this&&(h.id=this.id),h};var ys=gs;function gs(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(_s,this,e),this.length=this._features.length}function _s(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():5===t?e.extent=n.readVarint():2===t?e._features.push(n.pos):3===t?e._keys.push(n.readString()):4===t&&e._values.push(function(t){for(var e=null,n=t.readVarint()+t.pos;t.pos<n;){var r=t.readVarint()>>3;e=1===r?t.readString():2===r?t.readFloat():3===r?t.readDouble():4===r?t.readVarint64():5===r?t.readVarint():6===r?t.readSVarint():7===r?t.readBoolean():null}return e}(n))}function xs(t,e,n){if(3===t){var r=new ys(n,n.readVarint()+n.pos);r.length&&(e[r.name]=r)}}gs.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new fs(this._pbf,e,this.extent,this._keys,this._values)};var bs={VectorTile:function(t,e){this.layers=t.readFields(xs,{},e)},VectorTileFeature:fs,VectorTileLayer:ys},ws=bs.VectorTileFeature.types,Ss=Math.pow(2,13);function Es(t,e,n,r,i,o,a,s){t.emplaceBack(e,n,2*Math.floor(r*Ss)+a,i*Ss*2,o*Ss*2,Math.round(s))}var Cs=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Oi,this.indexArray=new Ui,this.programConfigurations=new No(t.layers,t.zoom),this.segments=new uo,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};function Ts(t,e){return t.x===e.x&&(t.x<0||t.x>8192)||t.y===e.y&&(t.y<0||t.y>8192)}Cs.prototype.populate=function(t,e,n){this.features=[],this.hasPattern=as("fill-extrusion",this.layers,e);for(var r=0,i=t;r<i.length;r+=1){var o=i[r],a=o.feature,s=o.id,u=o.index,l=o.sourceLayerIndex,c=this.layers[0]._featureFilter.needGeometry,p=Uo(a,c);if(this.layers[0]._featureFilter.filter(new ui(this.zoom),p,n)){var h={id:s,sourceLayerIndex:l,index:u,geometry:c?p.geometry:jo(a),properties:a.properties,type:a.type,patterns:{}};this.hasPattern?this.features.push(ss("fill-extrusion",this.layers,h,this.zoom,e)):this.addFeature(h,h.geometry,u,n,{}),e.featureIndex.insert(a,h.geometry,u,l,this.index,!0)}}},Cs.prototype.addFeatures=function(t,e,n){for(var r=0,i=this.features;r<i.length;r+=1){var o=i[r];this.addFeature(o,o.geometry,o.index,e,n)}},Cs.prototype.update=function(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)},Cs.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Cs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Cs.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,hs),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Cs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Cs.prototype.addFeature=function(t,e,n,r,i){for(var o=0,a=is(e,500);o<a.length;o+=1){for(var s=a[o],u=0,l=0,c=s;l<c.length;l+=1)u+=c[l].length;for(var p=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),h=0,f=s;h<f.length;h+=1){var d=f[h];if(0!==d.length&&!((L=d).every((function(t){return t.x<0}))||L.every((function(t){return t.x>8192}))||L.every((function(t){return t.y<0}))||L.every((function(t){return t.y>8192}))))for(var v=0,m=0;m<d.length;m++){var y=d[m];if(m>=1){var g=d[m-1];if(!Ts(y,g)){p.vertexLength+4>uo.MAX_VERTEX_ARRAY_LENGTH&&(p=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var _=y.sub(g)._perp()._unit(),x=g.dist(y);v+x>32768&&(v=0),Es(this.layoutVertexArray,y.x,y.y,_.x,_.y,0,0,v),Es(this.layoutVertexArray,y.x,y.y,_.x,_.y,0,1,v),Es(this.layoutVertexArray,g.x,g.y,_.x,_.y,0,0,v+=x),Es(this.layoutVertexArray,g.x,g.y,_.x,_.y,0,1,v);var b=p.vertexLength;this.indexArray.emplaceBack(b,b+2,b+1),this.indexArray.emplaceBack(b+1,b+2,b+3),p.vertexLength+=4,p.primitiveLength+=2}}}}if(p.vertexLength+u>uo.MAX_VERTEX_ARRAY_LENGTH&&(p=this.segments.prepareSegment(u,this.layoutVertexArray,this.indexArray)),"Polygon"===ws[t.type]){for(var w=[],S=[],E=p.vertexLength,C=0,T=s;C<T.length;C+=1){var A=T[C];if(0!==A.length){A!==s[0]&&S.push(w.length/2);for(var M=0;M<A.length;M++){var k=A[M];Es(this.layoutVertexArray,k.x,k.y,0,0,1,1,0),w.push(k.x),w.push(k.y)}}}for(var P=Aa(w,S),O=0;O<P.length;O+=3)this.indexArray.emplaceBack(E+P[O],E+P[O+2],E+P[O+1]);p.primitiveLength+=P.length/3,p.vertexLength+=u}}var L;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,i,r)},Fr("FillExtrusionBucket",Cs,{omit:["layers","features"]});var As={paint:new wi({"fill-extrusion-opacity":new yi(Pt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new gi(Pt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new yi(Pt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new yi(Pt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new _i(Pt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new gi(Pt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new gi(Pt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new yi(Pt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Ms=function(t){function e(e){t.call(this,e,As)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new Cs(t)},e.prototype.queryRadius=function(){return ra(this.paint.get("fill-extrusion-translate"))},e.prototype.is3D=function(){return!0},e.prototype.queryIntersectsFeature=function(t,e,n,r,i,a,s,u){var l=ia(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),a.angle,s),c=this.paint.get("fill-extrusion-height").evaluate(e,n),p=this.paint.get("fill-extrusion-base").evaluate(e,n),h=function(t,e,n,r){for(var i=[],a=0,s=t;a<s.length;a+=1){var u=s[a],l=[u.x,u.y,0,1];ha(l,l,e),i.push(new o(l[0]/l[3],l[1]/l[3]))}return i}(l,u),f=function(t,e,n,r){for(var i=[],a=[],s=r[8]*e,u=r[9]*e,l=r[10]*e,c=r[11]*e,p=r[8]*n,h=r[9]*n,f=r[10]*n,d=r[11]*n,v=0,m=t;v<m.length;v+=1){for(var y=[],g=[],_=0,x=m[v];_<x.length;_+=1){var b=x[_],w=b.x,S=b.y,E=r[0]*w+r[4]*S+r[12],C=r[1]*w+r[5]*S+r[13],T=r[2]*w+r[6]*S+r[14],A=r[3]*w+r[7]*S+r[15],M=T+l,k=A+c,P=E+p,O=C+h,L=T+f,I=A+d,R=new o((E+s)/k,(C+u)/k);R.z=M/k,y.push(R);var D=new o(P/I,O/I);D.z=L/I,g.push(D)}i.push(y),a.push(g)}return[i,a]}(r,p,c,u);return function(t,e,n){var r=1/0;qo(n,e)&&(r=Ps(n,e[0]));for(var i=0;i<e.length;i++)for(var o=e[i],a=t[i],s=0;s<o.length-1;s++){var u=o[s],l=[u,o[s+1],a[s+1],a[s],u];Ho(n,l)&&(r=Math.min(r,Ps(n,l)))}return r!==1/0&&r}(f[0],f[1],h)},e}(Si);function ks(t,e){return t.x*e.x+t.y*e.y}function Ps(t,e){if(1===t.length){for(var n,r=0,i=e[r++];!n||i.equals(n);)if(!(n=e[r++]))return 1/0;for(;r<e.length;r++){var o=e[r],a=t[0],s=n.sub(i),u=o.sub(i),l=a.sub(i),c=ks(s,s),p=ks(s,u),h=ks(u,u),f=ks(l,s),d=ks(l,u),v=c*h-p*p,m=(h*f-p*d)/v,y=(c*d-p*f)/v,g=i.z*(1-m-y)+n.z*m+o.z*y;if(isFinite(g))return g}return 1/0}for(var _=1/0,x=0,b=e;x<b.length;x+=1)_=Math.min(_,b[x].z);return _}var Os=Ai([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Ls=Ai([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Is=bs.VectorTileFeature.types,Rs=Math.cos(Math.PI/180*37.5),Ds=Math.pow(2,14)/.5,Ns=function(t){var e=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((function(t){e.gradients[t.id]={}})),this.layoutVertexArray=new Li,this.layoutVertexArray2=new Ii,this.indexArray=new Ui,this.programConfigurations=new No(t.layers,t.zoom),this.segments=new uo,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};Ns.prototype.populate=function(t,e,n){this.hasPattern=as("line",this.layers,e);for(var r=this.layers[0].layout.get("line-sort-key"),i=[],o=0,a=t;o<a.length;o+=1){var s=a[o],u=s.feature,l=s.id,c=s.index,p=s.sourceLayerIndex,h=this.layers[0]._featureFilter.needGeometry,f=Uo(u,h);if(this.layers[0]._featureFilter.filter(new ui(this.zoom),f,n)){var d=r?r.evaluate(f,{},n):void 0,v={id:l,properties:u.properties,type:u.type,sourceLayerIndex:p,index:c,geometry:h?f.geometry:jo(u),patterns:{},sortKey:d};i.push(v)}}r&&i.sort((function(t,e){return t.sortKey-e.sortKey}));for(var m=0,y=i;m<y.length;m+=1){var g=y[m],_=g.geometry,x=g.index,b=g.sourceLayerIndex;if(this.hasPattern){var w=ss("line",this.layers,g,this.zoom,e);this.patternFeatures.push(w)}else this.addFeature(g,_,x,n,{});e.featureIndex.insert(t[x].feature,_,x,b,this.index)}},Ns.prototype.update=function(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)},Ns.prototype.addFeatures=function(t,e,n){for(var r=0,i=this.patternFeatures;r<i.length;r+=1){var o=i[r];this.addFeature(o,o.geometry,o.index,e,n)}},Ns.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Ns.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ns.prototype.upload=function(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Ls)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Os),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Ns.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ns.prototype.lineFeatureClips=function(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}},Ns.prototype.addFeature=function(t,e,n,r,i){var o=this.layers[0].layout,a=o.get("line-join").evaluate(t,{}),s=o.get("line-cap"),u=o.get("line-miter-limit"),l=o.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(var c=0,p=e;c<p.length;c+=1)this.addLine(p[c],t,a,s,u,l);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,i,r)},Ns.prototype.addLine=function(t,e,n,r,i,o){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var a=0;a<t.length-1;a++)this.totalDistance+=t[a].dist(t[a+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var s="Polygon"===Is[e.type],u=t.length;u>=2&&t[u-1].equals(t[u-2]);)u--;for(var l=0;l<u-1&&t[l].equals(t[l+1]);)l++;if(!(u<(s?3:2))){"bevel"===n&&(i=1.05);var c,p=this.overscaling<=16?122880/(512*this.overscaling):0,h=this.segments.prepareSegment(10*u,this.layoutVertexArray,this.indexArray),f=void 0,d=void 0,v=void 0,m=void 0;this.e1=this.e2=-1,s&&(m=t[l].sub(c=t[u-2])._unit()._perp());for(var y=l;y<u;y++)if(!(d=y===u-1?s?t[l+1]:void 0:t[y+1])||!t[y].equals(d)){m&&(v=m),c&&(f=c),c=t[y],m=d?d.sub(c)._unit()._perp():v;var g=(v=v||m).add(m);0===g.x&&0===g.y||g._unit();var _=v.x*m.x+v.y*m.y,x=g.x*m.x+g.y*m.y,b=0!==x?1/x:1/0,w=2*Math.sqrt(2-2*x),S=x<Rs&&f&&d,E=v.x*m.y-v.y*m.x>0;if(S&&y>l){var C=c.dist(f);if(C>2*p){var T=c.sub(c.sub(f)._mult(p/C)._round());this.updateDistance(f,T),this.addCurrentVertex(T,v,0,0,h),f=T}}var A=f&&d,M=A?n:s?"butt":r;if(A&&"round"===M&&(b<o?M="miter":b<=2&&(M="fakeround")),"miter"===M&&b>i&&(M="bevel"),"bevel"===M&&(b>2&&(M="flipbevel"),b<i&&(M="miter")),f&&this.updateDistance(f,c),"miter"===M)g._mult(b),this.addCurrentVertex(c,g,0,0,h);else if("flipbevel"===M){if(b>100)g=m.mult(-1);else{var k=b*v.add(m).mag()/v.sub(m).mag();g._perp()._mult(k*(E?-1:1))}this.addCurrentVertex(c,g,0,0,h),this.addCurrentVertex(c,g.mult(-1),0,0,h)}else if("bevel"===M||"fakeround"===M){var P=-Math.sqrt(b*b-1),O=E?P:0,L=E?0:P;if(f&&this.addCurrentVertex(c,v,O,L,h),"fakeround"===M)for(var I=Math.round(180*w/Math.PI/20),R=1;R<I;R++){var D=R/I;if(.5!==D){var N=D-.5;D+=D*N*(D-1)*((1.0904+_*(_*(3.55645-1.43519*_)-3.2452))*N*N+(.848013+_*(.215638*_-1.06021)))}var Z=m.sub(v)._mult(D)._add(v)._unit()._mult(E?-1:1);this.addHalfVertex(c,Z.x,Z.y,!1,E,0,h)}d&&this.addCurrentVertex(c,m,-O,-L,h)}else if("butt"===M)this.addCurrentVertex(c,g,0,0,h);else if("square"===M){var z=f?1:-1;this.addCurrentVertex(c,g,z,z,h)}else"round"===M&&(f&&(this.addCurrentVertex(c,v,0,0,h),this.addCurrentVertex(c,v,1,1,h,!0)),d&&(this.addCurrentVertex(c,m,-1,-1,h,!0),this.addCurrentVertex(c,m,0,0,h)));if(S&&y<u-1){var F=c.dist(d);if(F>2*p){var B=c.add(d.sub(c)._mult(p/F)._round());this.updateDistance(c,B),this.addCurrentVertex(B,m,0,0,h),c=B}}}}},Ns.prototype.addCurrentVertex=function(t,e,n,r,i,o){void 0===o&&(o=!1);var a=e.y*r-e.x,s=-e.y-e.x*r;this.addHalfVertex(t,e.x+e.y*n,e.y-e.x*n,o,!1,n,i),this.addHalfVertex(t,a,s,o,!0,-r,i),this.distance>Ds/2&&0===this.totalDistance&&(this.distance=0,this.addCurrentVertex(t,e,n,r,i,o))},Ns.prototype.addHalfVertex=function(t,e,n,r,i,o,a){var s=.5*(this.lineClips?this.scaledDistance*(Ds-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t.x<<1)+(r?1:0),(t.y<<1)+(i?1:0),Math.round(63*e)+128,Math.round(63*n)+128,1+(0===o?0:o<0?-1:1)|(63&s)<<2,s>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var u=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,u),a.primitiveLength++),i?this.e2=u:this.e1=u},Ns.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Ns.prototype.updateDistance=function(t,e){this.distance+=t.dist(e),this.updateScaledDistance()},Fr("LineBucket",Ns,{omit:["layers","patternFeatures"]});var Zs=new wi({"line-cap":new yi(Pt.layout_line["line-cap"]),"line-join":new gi(Pt.layout_line["line-join"]),"line-miter-limit":new yi(Pt.layout_line["line-miter-limit"]),"line-round-limit":new yi(Pt.layout_line["line-round-limit"]),"line-sort-key":new gi(Pt.layout_line["line-sort-key"])}),zs={paint:new wi({"line-opacity":new gi(Pt.paint_line["line-opacity"]),"line-color":new gi(Pt.paint_line["line-color"]),"line-translate":new yi(Pt.paint_line["line-translate"]),"line-translate-anchor":new yi(Pt.paint_line["line-translate-anchor"]),"line-width":new gi(Pt.paint_line["line-width"]),"line-gap-width":new gi(Pt.paint_line["line-gap-width"]),"line-offset":new gi(Pt.paint_line["line-offset"]),"line-blur":new gi(Pt.paint_line["line-blur"]),"line-dasharray":new xi(Pt.paint_line["line-dasharray"]),"line-pattern":new _i(Pt.paint_line["line-pattern"]),"line-gradient":new bi(Pt.paint_line["line-gradient"])}),layout:Zs},Fs=new(function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.possiblyEvaluate=function(e,n){return n=new ui(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),t.prototype.possiblyEvaluate.call(this,e,n)},e.prototype.evaluate=function(e,n,r,i){return n=f({},n,{zoom:Math.floor(n.zoom)}),t.prototype.evaluate.call(this,e,n,r,i)},e}(gi))(zs.paint.properties["line-width"].specification);Fs.useIntegerZoom=!0;var Bs=function(t){function e(e){t.call(this,e,zs),this.gradientVersion=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._handleSpecialPaintPropertyUpdate=function(t){"line-gradient"===t&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Ge,this.gradientVersion=(this.gradientVersion+1)%u)},e.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},e.prototype.recalculate=function(e,n){t.prototype.recalculate.call(this,e,n),this.paint._values["line-floorwidth"]=Fs.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)},e.prototype.createBucket=function(t){return new Ns(t)},e.prototype.queryRadius=function(t){var e=t,n=js(na("line-width",this,e),na("line-gap-width",this,e)),r=na("line-offset",this,e);return n/2+Math.abs(r)+ra(this.paint.get("line-translate"))},e.prototype.queryIntersectsFeature=function(t,e,n,r,i,a,s){var u=ia(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),a.angle,s),l=s/2*js(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),c=this.paint.get("line-offset").evaluate(e,n);return c&&(r=function(t,e){for(var n=[],r=new o(0,0),i=0;i<t.length;i++){for(var a=t[i],s=[],u=0;u<a.length;u++){var l=a[u],c=a[u+1],p=0===u?r:l.sub(a[u-1])._unit()._perp(),h=u===a.length-1?r:c.sub(l)._unit()._perp(),f=p._add(h)._unit();f._mult(1/(f.x*h.x+f.y*h.y)),s.push(f._mult(e)._add(l))}n.push(s)}return n}(r,c*s)),function(t,e,n){for(var r=0;r<e.length;r++){var i=e[r];if(t.length>=3)for(var o=0;o<i.length;o++)if(ta(t,i[o]))return!0;if(Xo(t,i,n))return!0}return!1}(u,r,l)},e.prototype.isTileClipped=function(){return!0},e}(Si);function js(t,e){return e>0?e+2*t:t}var Us=Ai([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Vs=Ai([{name:"a_projected_pos",components:3,type:"Float32"}],4),Gs=(Ai([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Ai([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Hs=(Ai([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Ai([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Ws=Ai([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function qs(t,e,n){return t.sections.forEach((function(t){t.text=function(t,e,n){var r=e.layout.get("text-transform").evaluate(n,{});return"uppercase"===r?t=t.toLocaleUpperCase():"lowercase"===r&&(t=t.toLocaleLowerCase()),si.applyArabicShaping&&(t=si.applyArabicShaping(t)),t}(t.text,e,n)})),t}Ai([{name:"triangle",components:3,type:"Uint16"}]),Ai([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ai([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ai([{type:"Float32",name:"offsetX"}]),Ai([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Xs={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"},Ys=function(t,e,n,r,i){var o,a,s=8*i-r-1,u=(1<<s)-1,l=u>>1,c=-7,p=n?i-1:0,h=n?-1:1,f=t[e+p];for(p+=h,o=f&(1<<-c)-1,f>>=-c,c+=s;c>0;o=256*o+t[e+p],p+=h,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=r;c>0;a=256*a+t[e+p],p+=h,c-=8);if(0===o)o=1-l;else{if(o===u)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,r),o-=l}return(f?-1:1)*a*Math.pow(2,o-r)},Ks=function(t,e,n,r,i,o){var a,s,u,l=8*o-i-1,c=(1<<l)-1,p=c>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:o-1,d=r?1:-1,v=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=c):(a=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-a))<1&&(a--,u*=2),(e+=a+p>=1?h/u:h*Math.pow(2,1-p))*u>=2&&(a++,u/=2),a+p>=c?(s=0,a=c):a+p>=1?(s=(e*u-1)*Math.pow(2,i),a+=p):(s=e*Math.pow(2,p-1)*Math.pow(2,i),a=0));i>=8;t[n+f]=255&s,f+=d,s/=256,i-=8);for(a=a<<i|s,l+=i;l>0;t[n+f]=255&a,f+=d,a/=256,l-=8);t[n+f-d]|=128*v},Qs=Js;function Js(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Js.Varint=0,Js.Fixed64=1,Js.Bytes=2,Js.Fixed32=5;var $s="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function tu(t){return t.type===Js.Bytes?t.readVarint()+t.pos:t.pos+1}function eu(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function nu(t,e,n){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(r);for(var i=n.pos-1;i>=t;i--)n.buf[i+r]=n.buf[i]}function ru(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function iu(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function ou(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function au(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function su(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function uu(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function lu(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function cu(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function pu(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function hu(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function fu(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function du(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function vu(t,e,n){1===t&&n.readMessage(mu,e)}function mu(t,e,n){if(3===t){var r=n.readMessage(yu,{}),i=r.width,o=r.height,a=r.left,s=r.top,u=r.advance;e.push({id:r.id,bitmap:new _a({width:i+6,height:o+6},r.bitmap),metrics:{width:i,height:o,left:a,top:s,advance:u}})}}function yu(t,e,n){1===t?e.id=n.readVarint():2===t?e.bitmap=n.readBytes():3===t?e.width=n.readVarint():4===t?e.height=n.readVarint():5===t?e.left=n.readSVarint():6===t?e.top=n.readSVarint():7===t&&(e.advance=n.readVarint())}function gu(t){for(var e=0,n=0,r=0,i=t;r<i.length;r+=1){var o=i[r];e+=o.w*o.h,n=Math.max(n,o.w)}t.sort((function(t,e){return e.h-t.h}));for(var a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}],s=0,u=0,l=0,c=t;l<c.length;l+=1)for(var p=c[l],h=a.length-1;h>=0;h--){var f=a[h];if(!(p.w>f.w||p.h>f.h)){if(p.x=f.x,p.y=f.y,u=Math.max(u,p.y+p.h),s=Math.max(s,p.x+p.w),p.w===f.w&&p.h===f.h){var d=a.pop();h<a.length&&(a[h]=d)}else p.h===f.h?(f.x+=p.w,f.w-=p.w):p.w===f.w?(f.y+=p.h,f.h-=p.h):(a.push({x:f.x+p.w,y:f.y,w:f.w-p.w,h:p.h}),f.y+=p.h,f.h-=p.h);break}}return{w:s,h:u,fill:e/(s*u)||0}}Js.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var r=this.readVarint(),i=r>>3,o=this.pos;this.type=7&r,t(i,e,this),this.pos===o&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=hu(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=du(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=hu(this.buf,this.pos)+4294967296*hu(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=hu(this.buf,this.pos)+4294967296*du(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=Ys(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Ys(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,r=this.buf;return e=127&(n=r[this.pos++]),n<128?e:(e|=(127&(n=r[this.pos++]))<<7,n<128?e:(e|=(127&(n=r[this.pos++]))<<14,n<128?e:(e|=(127&(n=r[this.pos++]))<<21,n<128?e:function(t,e,n){var r,i,o=n.buf;if(r=(112&(i=o[n.pos++]))>>4,i<128)return eu(t,r,e);if(r|=(127&(i=o[n.pos++]))<<3,i<128)return eu(t,r,e);if(r|=(127&(i=o[n.pos++]))<<10,i<128)return eu(t,r,e);if(r|=(127&(i=o[n.pos++]))<<17,i<128)return eu(t,r,e);if(r|=(127&(i=o[n.pos++]))<<24,i<128)return eu(t,r,e);if(r|=(1&(i=o[n.pos++]))<<31,i<128)return eu(t,r,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&$s?function(t,e,n){return $s.decode(t.subarray(e,n))}(this.buf,e,t):function(t,e,n){for(var r="",i=e;i<n;){var o,a,s,u=t[i],l=null,c=u>239?4:u>223?3:u>191?2:1;if(i+c>n)break;1===c?u<128&&(l=u):2===c?128==(192&(o=t[i+1]))&&(l=(31&u)<<6|63&o)<=127&&(l=null):3===c?(a=t[i+2],128==(192&(o=t[i+1]))&&128==(192&a)&&((l=(15&u)<<12|(63&o)<<6|63&a)<=2047||l>=55296&&l<=57343)&&(l=null)):4===c&&(a=t[i+2],s=t[i+3],128==(192&(o=t[i+1]))&&128==(192&a)&&128==(192&s)&&((l=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||l>=1114112)&&(l=null)),null===l?(l=65533,c=1):l>65535&&(l-=65536,r+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),r+=String.fromCharCode(l),i+=c}return r}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Js.Bytes)return t.push(this.readVarint(e));var n=tu(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Js.Bytes)return t.push(this.readSVarint());var e=tu(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Js.Bytes)return t.push(this.readBoolean());var e=tu(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Js.Bytes)return t.push(this.readFloat());var e=tu(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Js.Bytes)return t.push(this.readDouble());var e=tu(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Js.Bytes)return t.push(this.readFixed32());var e=tu(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Js.Bytes)return t.push(this.readSFixed32());var e=tu(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Js.Bytes)return t.push(this.readFixed64());var e=tu(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Js.Bytes)return t.push(this.readSFixed64());var e=tu(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Js.Varint)for(;this.buf[this.pos++]>127;);else if(e===Js.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Js.Fixed32)this.pos+=4;else{if(e!==Js.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),fu(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),fu(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),fu(this.buf,-1&t,this.pos),fu(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),fu(this.buf,-1&t,this.pos),fu(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var n,r;if(t>=0?(n=t%4294967296|0,r=t/4294967296|0):(r=~(-t/4294967296),4294967295^(n=~(-t%4294967296))?n=n+1|0:(n=0,r=r+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,n){n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,n.buf[n.pos]=127&(t>>>=7)}(n,0,e),function(t,e){var n=(7&t)<<4;e.buf[e.pos++]|=n|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(r,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,n){for(var r,i,o=0;o<e.length;o++){if((r=e.charCodeAt(o))>55295&&r<57344){if(!i){r>56319||o+1===e.length?(t[n++]=239,t[n++]=191,t[n++]=189):i=r;continue}if(r<56320){t[n++]=239,t[n++]=191,t[n++]=189,i=r;continue}r=i-55296<<10|r-56320|65536,i=null}else i&&(t[n++]=239,t[n++]=191,t[n++]=189,i=null);r<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:(r<65536?t[n++]=r>>12|224:(t[n++]=r>>18|240,t[n++]=r>>12&63|128),t[n++]=r>>6&63|128),t[n++]=63&r|128)}return n}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&nu(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),Ks(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Ks(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var r=this.pos-n;r>=128&&nu(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,n){this.writeTag(t,Js.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,ru,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,iu,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,su,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,ou,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,au,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,uu,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,lu,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,cu,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,pu,e)},writeBytesField:function(t,e){this.writeTag(t,Js.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Js.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Js.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Js.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Js.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Js.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Js.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Js.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Js.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Js.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var _u=function(t,e){var n=e.pixelRatio,r=e.version,i=e.stretchX,o=e.stretchY,a=e.content;this.paddedRect=t,this.pixelRatio=n,this.stretchX=i,this.stretchY=o,this.content=a,this.version=r},xu={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};xu.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},xu.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},xu.tlbr.get=function(){return this.tl.concat(this.br)},xu.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(_u.prototype,xu);var bu=function(t,e){var n={},r={};this.haveRenderCallbacks=[];var i=[];this.addImages(t,n,i),this.addImages(e,r,i);var o=gu(i),a=new xa({width:o.w||1,height:o.h||1});for(var s in t){var u=t[s],l=n[s].paddedRect;xa.copy(u.data,a,{x:0,y:0},{x:l.x+1,y:l.y+1},u.data)}for(var c in e){var p=e[c],h=r[c].paddedRect,f=h.x+1,d=h.y+1,v=p.data.width,m=p.data.height;xa.copy(p.data,a,{x:0,y:0},{x:f,y:d},p.data),xa.copy(p.data,a,{x:0,y:m-1},{x:f,y:d-1},{width:v,height:1}),xa.copy(p.data,a,{x:0,y:0},{x:f,y:d+m},{width:v,height:1}),xa.copy(p.data,a,{x:v-1,y:0},{x:f-1,y:d},{width:1,height:m}),xa.copy(p.data,a,{x:0,y:0},{x:f+v,y:d},{width:1,height:m})}this.image=a,this.iconPositions=n,this.patternPositions=r};bu.prototype.addImages=function(t,e,n){for(var r in t){var i=t[r],o={x:0,y:0,w:i.data.width+2,h:i.data.height+2};n.push(o),e[r]=new _u(o,i),i.hasRenderCallback&&this.haveRenderCallbacks.push(r)}},bu.prototype.patchUpdatedImages=function(t,e){for(var n in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[n],t.getImage(n),e),this.patchUpdatedImage(this.patternPositions[n],t.getImage(n),e)},bu.prototype.patchUpdatedImage=function(t,e,n){if(t&&e&&t.version!==e.version){t.version=e.version;var r=t.tl;n.update(e.data,void 0,{x:r[0],y:r[1]})}},Fr("ImagePosition",_u),Fr("ImageAtlas",bu);var wu={horizontal:1,vertical:2,horizontalOnly:3},Su=function(){this.scale=1,this.fontStack="",this.imageName=null};Su.forText=function(t,e){var n=new Su;return n.scale=t||1,n.fontStack=e,n},Su.forImage=function(t){var e=new Su;return e.imageName=t,e};var Eu=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Cu(t,e,n,r,i,o,a,s,u,l,c,p,h,f,d,v){var m,y=Eu.fromFeature(t,i);p===wu.vertical&&y.verticalizePunctuation();var g=si.processBidirectionalText,_=si.processStyledBidirectionalText;if(g&&1===y.sections.length){m=[];for(var x=0,b=g(y.toString(),Lu(y,l,o,e,r,f,d));x<b.length;x+=1){var w=b[x],S=new Eu;S.text=w,S.sections=y.sections;for(var E=0;E<w.length;E++)S.sectionIndex.push(0);m.push(S)}}else if(_){m=[];for(var C=0,T=_(y.text,y.sectionIndex,Lu(y,l,o,e,r,f,d));C<T.length;C+=1){var A=T[C],M=new Eu;M.text=A[0],M.sectionIndex=A[1],M.sections=y.sections,m.push(M)}}else m=function(t,e){for(var n=[],r=t.text,i=0,o=0,a=e;o<a.length;o+=1){var s=a[o];n.push(t.substring(i,s)),i=s}return i<r.length&&n.push(t.substring(i,r.length)),n}(y,Lu(y,l,o,e,r,f,d));var k=[],P={positionedLines:k,text:y.toString(),top:c[1],bottom:c[1],left:c[0],right:c[0],writingMode:p,iconsInText:!1,verticalizable:!1};return function(t,e,n,r,i,o,a,s,u,l,c,p){for(var h=0,f=-17,d=0,v=0,m="right"===s?1:"left"===s?0:.5,y=0,g=0,_=i;g<_.length;g+=1){var x=_[g];x.trim();var b=x.getMaxScale(),w=24*(b-1),S={positionedGlyphs:[],lineOffset:0};t.positionedLines[y]=S;var E=S.positionedGlyphs,C=0;if(x.length()){for(var T=0;T<x.length();T++){var A=x.getSection(T),M=x.getSectionIndex(T),k=x.getCharCode(T),P=0,O=null,L=null,I=null,R=24,D=!(u===wu.horizontal||!c&&!Xr(k)||c&&(Tu[k]||(G=k,Wr.Arabic(G)||Wr["Arabic Supplement"](G)||Wr["Arabic Extended-A"](G)||Wr["Arabic Presentation Forms-A"](G)||Wr["Arabic Presentation Forms-B"](G))));if(A.imageName){var N=r[A.imageName];if(!N)continue;I=A.imageName,t.iconsInText=t.iconsInText||!0,L=N.paddedRect;var Z=N.displaySize;A.scale=24*A.scale/p,P=w+(24-Z[1]*A.scale),R=(O={width:Z[0],height:Z[1],left:1,top:-3,advance:D?Z[1]:Z[0]}).advance;var z=D?Z[0]*A.scale-24*b:Z[1]*A.scale-24*b;z>0&&z>C&&(C=z)}else{var F=n[A.fontStack],B=F&&F[k];if(B&&B.rect)L=B.rect,O=B.metrics;else{var j=e[A.fontStack],U=j&&j[k];if(!U)continue;O=U.metrics}P=24*(b-A.scale)}D?(t.verticalizable=!0,E.push({glyph:k,imageName:I,x:h,y:f+P,vertical:D,scale:A.scale,fontStack:A.fontStack,sectionIndex:M,metrics:O,rect:L}),h+=R*A.scale+l):(E.push({glyph:k,imageName:I,x:h,y:f+P,vertical:D,scale:A.scale,fontStack:A.fontStack,sectionIndex:M,metrics:O,rect:L}),h+=O.advance*A.scale+l)}0!==E.length&&(d=Math.max(h-l,d),Ru(E,0,E.length-1,m,C)),h=0;var V=o*b+C;S.lineOffset=Math.max(C,w),f+=V,v=Math.max(V,v),++y}else f+=o,++y}var G,H=f- -17,W=Iu(a),q=W.horizontalAlign,X=W.verticalAlign;(function(t,e,n,r,i,o,a,s,u){var l,c=(e-n)*i;l=o!==a?-s*r- -17:(-r*u+.5)*a;for(var p=0,h=t;p<h.length;p+=1)for(var f=0,d=h[p].positionedGlyphs;f<d.length;f+=1){var v=d[f];v.x+=c,v.y+=l}})(t.positionedLines,m,q,X,d,v,o,H,i.length),t.top+=-X*H,t.bottom=t.top+H,t.left+=-q*d,t.right=t.left+d}(P,e,n,r,m,a,s,u,p,l,h,v),!function(t){for(var e=0,n=t;e<n.length;e+=1)if(0!==n[e].positionedGlyphs.length)return!1;return!0}(k)&&P}Eu.fromFeature=function(t,e){for(var n=new Eu,r=0;r<t.sections.length;r++){var i=t.sections[r];i.image?n.addImageSection(i):n.addTextSection(i,e)}return n},Eu.prototype.length=function(){return this.text.length},Eu.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},Eu.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},Eu.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},Eu.prototype.verticalizePunctuation=function(){this.text=function(t){for(var e="",n=0;n<t.length;n++){var r=t.charCodeAt(n+1)||null,i=t.charCodeAt(n-1)||null;e+=r&&Yr(r)&&!Xs[t[n+1]]||i&&Yr(i)&&!Xs[t[n-1]]||!Xs[t[n]]?t[n]:Xs[t[n]]}return e}(this.text)},Eu.prototype.trim=function(){for(var t=0,e=0;e<this.text.length&&Tu[this.text.charCodeAt(e)];e++)t++;for(var n=this.text.length,r=this.text.length-1;r>=0&&r>=t&&Tu[this.text.charCodeAt(r)];r--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)},Eu.prototype.substring=function(t,e){var n=new Eu;return n.text=this.text.substring(t,e),n.sectionIndex=this.sectionIndex.slice(t,e),n.sections=this.sections,n},Eu.prototype.toString=function(){return this.text},Eu.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce((function(e,n){return Math.max(e,t.sections[n].scale)}),0)},Eu.prototype.addTextSection=function(t,e){this.text+=t.text,this.sections.push(Su.forText(t.scale,t.fontStack||e));for(var n=this.sections.length-1,r=0;r<t.text.length;++r)this.sectionIndex.push(n)},Eu.prototype.addImageSection=function(t){var e=t.image?t.image.name:"";if(0!==e.length){var n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(Su.forImage(e)),this.sectionIndex.push(this.sections.length-1)):E("Reached maximum number of images 6401")}else E("Can't add FormattedSection with an empty image.")},Eu.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Tu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Au={};function Mu(t,e,n,r,i,o){if(e.imageName){var a=r[e.imageName];return a?a.displaySize[0]*e.scale*24/o+i:0}var s=n[e.fontStack],u=s&&s[t];return u?u.metrics.advance*e.scale+i:0}function ku(t,e,n,r){var i=Math.pow(t-e,2);return r?t<e?i/2:2*i:i+Math.abs(n)*n}function Pu(t,e,n){var r=0;return 10===t&&(r-=1e4),n&&(r+=150),40!==t&&65288!==t||(r+=50),41!==e&&65289!==e||(r+=50),r}function Ou(t,e,n,r,i,o){for(var a=null,s=ku(e,n,i,o),u=0,l=r;u<l.length;u+=1){var c=l[u],p=ku(e-c.x,n,i,o)+c.badness;p<=s&&(a=c,s=p)}return{index:t,x:e,priorBreak:a,badness:s}}function Lu(t,e,n,r,i,o,a){if("point"!==o)return[];if(!t)return[];for(var s,u=[],l=function(t,e,n,r,i,o){for(var a=0,s=0;s<t.length();s++){var u=t.getSection(s);a+=Mu(t.getCharCode(s),u,r,i,e,o)}return a/Math.max(1,Math.ceil(a/n))}(t,e,n,r,i,a),c=t.text.indexOf("​")>=0,p=0,h=0;h<t.length();h++){var f=t.getSection(h),d=t.getCharCode(h);if(Tu[d]||(p+=Mu(d,f,r,i,e,a)),h<t.length()-1){var v=!((s=d)<11904||!(Wr["Bopomofo Extended"](s)||Wr.Bopomofo(s)||Wr["CJK Compatibility Forms"](s)||Wr["CJK Compatibility Ideographs"](s)||Wr["CJK Compatibility"](s)||Wr["CJK Radicals Supplement"](s)||Wr["CJK Strokes"](s)||Wr["CJK Symbols and Punctuation"](s)||Wr["CJK Unified Ideographs Extension A"](s)||Wr["CJK Unified Ideographs"](s)||Wr["Enclosed CJK Letters and Months"](s)||Wr["Halfwidth and Fullwidth Forms"](s)||Wr.Hiragana(s)||Wr["Ideographic Description Characters"](s)||Wr["Kangxi Radicals"](s)||Wr["Katakana Phonetic Extensions"](s)||Wr.Katakana(s)||Wr["Vertical Forms"](s)||Wr["Yi Radicals"](s)||Wr["Yi Syllables"](s)));(Au[d]||v||f.imageName)&&u.push(Ou(h+1,p,l,u,Pu(d,t.getCharCode(h+1),v&&c),!1))}}return function t(e){return e?t(e.priorBreak).concat(e.index):[]}(Ou(t.length(),p,l,u,0,!0))}function Iu(t){var e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function Ru(t,e,n,r,i){if(r||i)for(var o=t[n],a=(t[n].x+o.metrics.advance*o.scale)*r,s=e;s<=n;s++)t[s].x-=a,t[s].y+=i}function Du(t,e,n,r,i,o){var a,s=t.image;if(s.content){var u=s.content,l=s.pixelRatio||1;a=[u[0]/l,u[1]/l,s.displaySize[0]-u[2]/l,s.displaySize[1]-u[3]/l]}var c,p,h,f,d=e.left*o,v=e.right*o;"width"===n||"both"===n?(f=i[0]+d-r[3],p=i[0]+v+r[1]):p=(f=i[0]+(d+v-s.displaySize[0])/2)+s.displaySize[0];var m=e.top*o,y=e.bottom*o;return"height"===n||"both"===n?(c=i[1]+m-r[0],h=i[1]+y+r[2]):h=(c=i[1]+(m+y-s.displaySize[1])/2)+s.displaySize[1],{image:s,top:c,right:p,bottom:h,left:f,collisionPadding:a}}Au[10]=!0,Au[32]=!0,Au[38]=!0,Au[40]=!0,Au[41]=!0,Au[43]=!0,Au[45]=!0,Au[47]=!0,Au[173]=!0,Au[183]=!0,Au[8203]=!0,Au[8208]=!0,Au[8211]=!0,Au[8231]=!0;var Nu=function(t){function e(e,n,r,i){t.call(this,e,n),this.angle=r,void 0!==i&&(this.segment=i)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.clone=function(){return new e(this.x,this.y,this.angle,this.segment)},e}(o);function Zu(t,e){var n=e.expression;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new ui(t+1))};if("source"===n.kind)return{kind:"source"};for(var r=n.zoomStops,i=n.interpolationType,o=0;o<r.length&&r[o]<=t;)o++;for(var a=o=Math.max(0,o-1);a<r.length&&r[a]<t+1;)a++;a=Math.min(r.length-1,a);var s=r[o],u=r[a];return"composite"===n.kind?{kind:"composite",minZoom:s,maxZoom:u,interpolationType:i}:{kind:"camera",minZoom:s,maxZoom:u,minSize:n.evaluate(new ui(s)),maxSize:n.evaluate(new ui(u)),interpolationType:i}}function zu(t,e,n){var r=e.uSize,i=n.lowerSize;return"source"===t.kind?i/128:"composite"===t.kind?He(i/128,n.upperSize/128,e.uSizeT):r}function Fu(t,e){var n=0,r=0;if("constant"===t.kind)r=t.layoutSize;else if("source"!==t.kind){var i=t.interpolationType,o=i?p(sn.interpolationFactor(i,e,t.minZoom,t.maxZoom),0,1):0;"camera"===t.kind?r=He(t.minSize,t.maxSize,o):n=o}return{uSizeT:n,uSize:r}}Fr("Anchor",Nu);var Bu=Object.freeze({__proto__:null,getSizeData:Zu,evaluateSizeForFeature:zu,evaluateSizeForZoom:Fu,SIZE_PACK_FACTOR:128});function ju(t,e,n,r,i){if(void 0===e.segment)return!0;for(var o=e,a=e.segment+1,s=0;s>-n/2;){if(--a<0)return!1;s-=t[a].dist(o),o=t[a]}s+=t[a].dist(t[a+1]),a++;for(var u=[],l=0;s<n/2;){var c=t[a],p=t[a+1];if(!p)return!1;var h=t[a-1].angleTo(c)-c.angleTo(p);for(h=Math.abs((h+3*Math.PI)%(2*Math.PI)-Math.PI),u.push({distance:s,angleDelta:h}),l+=h;s-u[0].distance>r;)l-=u.shift().angleDelta;if(l>i)return!1;a++,s+=c.dist(p)}return!0}function Uu(t){for(var e=0,n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function Vu(t,e,n){return t?.6*e*n:0}function Gu(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function Hu(t,e,n,r,i,o){for(var a=Vu(n,i,o),s=Gu(n,r)*o,u=0,l=Uu(t)/2,c=0;c<t.length-1;c++){var p=t[c],h=t[c+1],f=p.dist(h);if(u+f>l){var d=(l-u)/f,v=He(p.x,h.x,d),m=He(p.y,h.y,d),y=new Nu(v,m,h.angleTo(p),c);return y._round(),!a||ju(t,y,s,a,e)?y:void 0}u+=f}}function Wu(t,e,n,r,i,o,a,s,u){var l=Vu(r,o,a),c=Gu(r,i),p=c*a,h=0===t[0].x||t[0].x===u||0===t[0].y||t[0].y===u;return e-p<e/4&&(e=p+e/4),function t(e,n,r,i,o,a,s,u,l){for(var c=a/2,p=Uu(e),h=0,f=n-r,d=[],v=0;v<e.length-1;v++){for(var m=e[v],y=e[v+1],g=m.dist(y),_=y.angleTo(m);f+r<h+g;){var x=((f+=r)-h)/g,b=He(m.x,y.x,x),w=He(m.y,y.y,x);if(b>=0&&b<l&&w>=0&&w<l&&f-c>=0&&f+c<=p){var S=new Nu(b,w,_,v);S._round(),i&&!ju(e,S,a,i,o)||d.push(S)}}h+=g}return u||d.length||s||(d=t(e,h/2,r,i,o,a,s,!0,l)),d}(t,h?e/2*s%e:(c/2+2*o)*a*s%e,e,l,n,p,h,!1,u)}function qu(t,e,n,r,i){for(var a=[],s=0;s<t.length;s++)for(var u=t[s],l=void 0,c=0;c<u.length-1;c++){var p=u[c],h=u[c+1];p.x<e&&h.x<e||(p.x<e?p=new o(e,p.y+(e-p.x)/(h.x-p.x)*(h.y-p.y))._round():h.x<e&&(h=new o(e,p.y+(e-p.x)/(h.x-p.x)*(h.y-p.y))._round()),p.y<n&&h.y<n||(p.y<n?p=new o(p.x+(n-p.y)/(h.y-p.y)*(h.x-p.x),n)._round():h.y<n&&(h=new o(p.x+(n-p.y)/(h.y-p.y)*(h.x-p.x),n)._round()),p.x>=r&&h.x>=r||(p.x>=r?p=new o(r,p.y+(r-p.x)/(h.x-p.x)*(h.y-p.y))._round():h.x>=r&&(h=new o(r,p.y+(r-p.x)/(h.x-p.x)*(h.y-p.y))._round()),p.y>=i&&h.y>=i||(p.y>=i?p=new o(p.x+(i-p.y)/(h.y-p.y)*(h.x-p.x),i)._round():h.y>=i&&(h=new o(p.x+(i-p.y)/(h.y-p.y)*(h.x-p.x),i)._round()),l&&p.equals(l[l.length-1])||a.push(l=[p]),l.push(h)))))}return a}function Xu(t,e,n,r){var i=[],a=t.image,s=a.pixelRatio,u=a.paddedRect.w-2,l=a.paddedRect.h-2,c=t.right-t.left,p=t.bottom-t.top,h=a.stretchX||[[0,u]],f=a.stretchY||[[0,l]],d=function(t,e){return t+e[1]-e[0]},v=h.reduce(d,0),m=f.reduce(d,0),y=u-v,g=l-m,_=0,x=v,b=0,w=m,S=0,E=y,C=0,T=g;if(a.content&&r){var A=a.content;_=Yu(h,0,A[0]),b=Yu(f,0,A[1]),x=Yu(h,A[0],A[2]),w=Yu(f,A[1],A[3]),S=A[0]-_,C=A[1]-b,E=A[2]-A[0]-x,T=A[3]-A[1]-w}var M=function(r,i,u,l){var h=Qu(r.stretch-_,x,c,t.left),f=Ju(r.fixed-S,E,r.stretch,v),d=Qu(i.stretch-b,w,p,t.top),y=Ju(i.fixed-C,T,i.stretch,m),g=Qu(u.stretch-_,x,c,t.left),A=Ju(u.fixed-S,E,u.stretch,v),M=Qu(l.stretch-b,w,p,t.top),k=Ju(l.fixed-C,T,l.stretch,m),P=new o(h,d),O=new o(g,d),L=new o(g,M),I=new o(h,M),R=new o(f/s,y/s),D=new o(A/s,k/s),N=e*Math.PI/180;if(N){var Z=Math.sin(N),z=Math.cos(N),F=[z,-Z,Z,z];P._matMult(F),O._matMult(F),I._matMult(F),L._matMult(F)}var B=r.stretch+r.fixed,j=i.stretch+i.fixed;return{tl:P,tr:O,bl:I,br:L,tex:{x:a.paddedRect.x+1+B,y:a.paddedRect.y+1+j,w:u.stretch+u.fixed-B,h:l.stretch+l.fixed-j},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:R,pixelOffsetBR:D,minFontScaleX:E/s/c,minFontScaleY:T/s/p,isSDF:n}};if(r&&(a.stretchX||a.stretchY))for(var k=Ku(h,y,v),P=Ku(f,g,m),O=0;O<k.length-1;O++)for(var L=k[O],I=k[O+1],R=0;R<P.length-1;R++)i.push(M(L,P[R],I,P[R+1]));else i.push(M({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:u+1},{fixed:0,stretch:l+1}));return i}function Yu(t,e,n){for(var r=0,i=0,o=t;i<o.length;i+=1){var a=o[i];r+=Math.max(e,Math.min(n,a[1]))-Math.max(e,Math.min(n,a[0]))}return r}function Ku(t,e,n){for(var r=[{fixed:-1,stretch:0}],i=0,o=t;i<o.length;i+=1){var a=o[i],s=a[0],u=a[1],l=r[r.length-1];r.push({fixed:s-l.stretch,stretch:l.stretch}),r.push({fixed:s-l.stretch,stretch:l.stretch+(u-s)})}return r.push({fixed:e+1,stretch:n}),r}function Qu(t,e,n,r){return t/e*n+r}function Ju(t,e,n,r){return t-e*n/r}var $u=function(t,e,n,r,i,a,s,u,l,c){if(this.boxStartIndex=t.length,l){var p=a.top,h=a.bottom,f=a.collisionPadding;f&&(p-=f[1],h+=f[3]);var d=h-p;d>0&&(d=Math.max(10,d),this.circleDiameter=d)}else{var v=a.top*s-u,m=a.bottom*s+u,y=a.left*s-u,g=a.right*s+u,_=a.collisionPadding;if(_&&(y-=_[0]*s,v-=_[1]*s,g+=_[2]*s,m+=_[3]*s),c){var x=new o(y,v),b=new o(g,v),w=new o(y,m),S=new o(g,m),E=c*Math.PI/180;x._rotate(E),b._rotate(E),w._rotate(E),S._rotate(E),y=Math.min(x.x,b.x,w.x,S.x),g=Math.max(x.x,b.x,w.x,S.x),v=Math.min(x.y,b.y,w.y,S.y),m=Math.max(x.y,b.y,w.y,S.y)}t.emplaceBack(e.x,e.y,y,v,g,m,n,r,i)}this.boxEndIndex=t.length},tl=function(t,e){if(void 0===t&&(t=[]),void 0===e&&(e=el),this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)};function el(t,e){return t<e?-1:t>e?1:0}function nl(t,e,n){void 0===e&&(e=1),void 0===n&&(n=!1);for(var i=1/0,a=1/0,s=-1/0,u=-1/0,l=t[0],c=0;c<l.length;c++){var p=l[c];(!c||p.x<i)&&(i=p.x),(!c||p.y<a)&&(a=p.y),(!c||p.x>s)&&(s=p.x),(!c||p.y>u)&&(u=p.y)}var h=Math.min(s-i,u-a),f=h/2,d=new tl([],rl);if(0===h)return new o(i,a);for(var v=i;v<s;v+=h)for(var m=a;m<u;m+=h)d.push(new il(v+f,m+f,f,t));for(var y=function(t){for(var e=0,n=0,r=0,i=t[0],o=0,a=i.length,s=a-1;o<a;s=o++){var u=i[o],l=i[s],c=u.x*l.y-l.x*u.y;n+=(u.x+l.x)*c,r+=(u.y+l.y)*c,e+=3*c}return new il(n/e,r/e,0,t)}(t),g=d.length;d.length;){var _=d.pop();(_.d>y.d||!y.d)&&(y=_,n&&r.log("found best %d after %d probes",Math.round(1e4*_.d)/1e4,g)),_.max-y.d<=e||(d.push(new il(_.p.x-(f=_.h/2),_.p.y-f,f,t)),d.push(new il(_.p.x+f,_.p.y-f,f,t)),d.push(new il(_.p.x-f,_.p.y+f,f,t)),d.push(new il(_.p.x+f,_.p.y+f,f,t)),g+=4)}return n&&(r.log("num probes: "+g),r.log("best distance: "+y.d)),y.p}function rl(t,e){return e.max-t.max}function il(t,e,n,r){this.p=new o(t,e),this.h=n,this.d=function(t,e){for(var n=!1,r=1/0,i=0;i<e.length;i++)for(var o=e[i],a=0,s=o.length,u=s-1;a<s;u=a++){var l=o[a],c=o[u];l.y>t.y!=c.y>t.y&&t.x<(c.x-l.x)*(t.y-l.y)/(c.y-l.y)+l.x&&(n=!n),r=Math.min(r,Jo(t,l,c))}return(n?1:-1)*Math.sqrt(r)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}tl.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},tl.prototype.pop=function(){if(0!==this.length){var t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}},tl.prototype.peek=function(){return this.data[0]},tl.prototype._up=function(t){for(var e=this.data,n=this.compare,r=e[t];t>0;){var i=t-1>>1,o=e[i];if(n(r,o)>=0)break;e[t]=o,t=i}e[t]=r},tl.prototype._down=function(t){for(var e=this.data,n=this.compare,r=this.length>>1,i=e[t];t<r;){var o=1+(t<<1),a=e[o],s=o+1;if(s<this.length&&n(e[s],a)<0&&(o=s,a=e[s]),n(a,i)>=0)break;e[t]=a,t=o}e[t]=i};var ol=Number.POSITIVE_INFINITY;function al(t,e){return e[1]!==ol?function(t,e,n){var r=0,i=0;switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":i=n-7;break;case"bottom-right":case"bottom-left":case"bottom":i=7-n}switch(t){case"top-right":case"bottom-right":case"right":r=-e;break;case"top-left":case"bottom-left":case"left":r=e}return[r,i]}(t,e[0],e[1]):function(t,e){var n=0,r=0;e<0&&(e=0);var i=e/Math.sqrt(2);switch(t){case"top-right":case"top-left":r=i-7;break;case"bottom-right":case"bottom-left":r=7-i;break;case"bottom":r=7-e;break;case"top":r=e-7}switch(t){case"top-right":case"bottom-right":n=-i;break;case"top-left":case"bottom-left":n=i;break;case"left":n=e;break;case"right":n=-e}return[n,r]}(t,e[0])}function sl(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function ul(t,e,n,r,i,a,s,u,l,c,p,h,f,d,v){var m=function(t,e,n,r,i,a,s,u){for(var l=r.layout.get("text-rotate").evaluate(a,{})*Math.PI/180,c=[],p=0,h=e.positionedLines;p<h.length;p+=1)for(var f=h[p],d=0,v=f.positionedGlyphs;d<v.length;d+=1){var m=v[d];if(m.rect){var y=m.rect||{},g=4,_=!0,x=1,b=0,w=(i||u)&&m.vertical,S=m.metrics.advance*m.scale/2;if(u&&e.verticalizable&&(b=f.lineOffset/2-(m.imageName?-(24-m.metrics.width*m.scale)/2:24*(m.scale-1))),m.imageName){var E=s[m.imageName];_=E.sdf,g=1/(x=E.pixelRatio)}var C=i?[m.x+S,m.y]:[0,0],T=i?[0,0]:[m.x+S+n[0],m.y+n[1]-b],A=[0,0];w&&(A=T,T=[0,0]);var M=(m.metrics.left-g)*m.scale-S+T[0],k=(-m.metrics.top-g)*m.scale+T[1],P=M+y.w*m.scale/x,O=k+y.h*m.scale/x,L=new o(M,k),I=new o(P,k),R=new o(M,O),D=new o(P,O);if(w){var N=new o(-S,S- -17),Z=-Math.PI/2,z=12-S,F=new o(22-z,-(m.imageName?z:0)),B=new(Function.prototype.bind.apply(o,[null].concat(A)));L._rotateAround(Z,N)._add(F)._add(B),I._rotateAround(Z,N)._add(F)._add(B),R._rotateAround(Z,N)._add(F)._add(B),D._rotateAround(Z,N)._add(F)._add(B)}if(l){var j=Math.sin(l),U=Math.cos(l),V=[U,-j,j,U];L._matMult(V),I._matMult(V),R._matMult(V),D._matMult(V)}var G=new o(0,0),H=new o(0,0);c.push({tl:L,tr:I,bl:R,br:D,tex:y,writingMode:e.writingMode,glyphOffset:C,sectionIndex:m.sectionIndex,isSDF:_,pixelOffsetTL:G,pixelOffsetBR:H,minFontScaleX:0,minFontScaleY:0})}}return c}(0,n,u,i,a,s,r,t.allowVerticalPlacement),y=t.textSizeData,g=null;"source"===y.kind?(g=[128*i.layout.get("text-size").evaluate(s,{})])[0]>32640&&E(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):"composite"===y.kind&&((g=[128*d.compositeTextSizes[0].evaluate(s,{},v),128*d.compositeTextSizes[1].evaluate(s,{},v)])[0]>32640||g[1]>32640)&&E(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,m,g,u,a,s,c,e,l.lineStartIndex,l.lineLength,f,v);for(var _=0,x=p;_<x.length;_+=1)h[x[_]]=t.text.placedSymbolArray.length-1;return 4*m.length}function ll(t){for(var e in t)return t[e];return null}function cl(t,e,n,r){var i=t.compareText;if(e in i){for(var o=i[e],a=o.length-1;a>=0;a--)if(r.dist(o[a])<n)return!0}else i[e]=[];return i[e].push(r),!1}var pl=bs.VectorTileFeature.types,hl=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function fl(t,e,n,r,i,o,a,s,u,l,c,p,h){var f=s?Math.min(32640,Math.round(s[0])):0,d=s?Math.min(32640,Math.round(s[1])):0;t.emplaceBack(e,n,Math.round(32*r),Math.round(32*i),o,a,(f<<1)+(u?1:0),d,16*l,16*c,256*p,256*h)}function dl(t,e,n){t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n)}function vl(t){for(var e=0,n=t.sections;e<n.length;e+=1)if(Jr(n[e].text))return!0;return!1}var ml=function(t){this.layoutVertexArray=new Di,this.indexArray=new Ui,this.programConfigurations=t,this.segments=new uo,this.dynamicLayoutVertexArray=new Ni,this.opacityVertexArray=new Zi,this.placedSymbolArray=new to};ml.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length},ml.prototype.upload=function(t,e,n,r){this.isEmpty()||(n&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Us.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Vs.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,hl,!0),this.opacityVertexBuffer.itemSize=1),(n||r)&&this.programConfigurations.upload(t))},ml.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Fr("SymbolBuffers",ml);var yl=function(t,e,n){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new n,this.segments=new uo,this.collisionVertexArray=new ji};yl.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Gs.members,!0)},yl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Fr("CollisionBuffers",yl);var gl=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ua([]),this.placementViewportMatrix=ua([]);var e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Zu(this.zoom,e["text-size"]),this.iconSizeData=Zu(this.zoom,e["icon-size"]);var n=this.layers[0].layout,r=n.get("symbol-sort-key"),i=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==i&&void 0!==r.constantOr(1),this.sortFeaturesByY=("viewport-y"===i||"auto"===i&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===n.get("symbol-placement")&&(this.writingModes=n.get("text-writing-mode").map((function(t){return wu[t]}))),this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id})),this.sourceID=t.sourceID};gl.prototype.createArrays=function(){this.text=new ml(new No(this.layers,this.zoom,(function(t){return/^text/.test(t)}))),this.icon=new ml(new No(this.layers,this.zoom,(function(t){return/^icon/.test(t)}))),this.glyphOffsetArray=new ro,this.lineVertexArray=new io,this.symbolInstances=new no},gl.prototype.calculateGlyphDependencies=function(t,e,n,r,i){for(var o=0;o<t.length;o++)if(e[t.charCodeAt(o)]=!0,(n||r)&&i){var a=Xs[t.charAt(o)];a&&(e[a.charCodeAt(0)]=!0)}},gl.prototype.populate=function(t,e,n){var r=this.layers[0],i=r.layout,o=i.get("text-font"),a=i.get("text-field"),s=i.get("icon-image"),u=("constant"!==a.value.kind||a.value.value instanceof ie&&!a.value.value.isEmpty()||a.value.value.toString().length>0)&&("constant"!==o.value.kind||o.value.value.length>0),l="constant"!==s.value.kind||!!s.value.value||Object.keys(s.parameters).length>0,c=i.get("symbol-sort-key");if(this.features=[],u||l){for(var p=e.iconDependencies,h=e.glyphDependencies,f=e.availableImages,d=new ui(this.zoom),v=0,m=t;v<m.length;v+=1){var y=m[v],g=y.feature,_=y.id,x=y.index,b=y.sourceLayerIndex,w=r._featureFilter.needGeometry,S=Uo(g,w);if(r._featureFilter.filter(d,S,n)){w||(S.geometry=jo(g));var E=void 0;if(u){var C=r.getValueAndResolveTokens("text-field",S,n,f),T=ie.factory(C);vl(T)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===oi()||this.hasRTLText&&si.isParsed())&&(E=qs(T,r,S))}var A=void 0;if(l){var M=r.getValueAndResolveTokens("icon-image",S,n,f);A=M instanceof oe?M:oe.fromString(M)}if(E||A){var k=this.sortFeaturesByKey?c.evaluate(S,{},n):void 0;if(this.features.push({id:_,text:E,icon:A,index:x,sourceLayerIndex:b,geometry:S.geometry,properties:g.properties,type:pl[g.type],sortKey:k}),A&&(p[A.name]=!0),E){var P=o.evaluate(S,{},n).join(","),O="map"===i.get("text-rotation-alignment")&&"point"!==i.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(wu.vertical)>=0;for(var L=0,I=E.sections;L<I.length;L+=1){var R=I[L];if(R.image)p[R.image.name]=!0;else{var D=qr(E.toString()),N=R.fontStack||P,Z=h[N]=h[N]||{};this.calculateGlyphDependencies(R.text,Z,O,this.allowVerticalPlacement,D)}}}}}}"line"===i.get("symbol-placement")&&(this.features=function(t){var e={},n={},r=[],i=0;function o(e){r.push(t[e]),i++}function a(t,e,i){var o=n[t];return delete n[t],n[e]=o,r[o].geometry[0].pop(),r[o].geometry[0]=r[o].geometry[0].concat(i[0]),o}function s(t,n,i){var o=e[n];return delete e[n],e[t]=o,r[o].geometry[0].shift(),r[o].geometry[0]=i[0].concat(r[o].geometry[0]),o}function u(t,e,n){var r=n?e[0][e[0].length-1]:e[0][0];return t+":"+r.x+":"+r.y}for(var l=0;l<t.length;l++){var c=t[l],p=c.geometry,h=c.text?c.text.toString():null;if(h){var f=u(h,p),d=u(h,p,!0);if(f in n&&d in e&&n[f]!==e[d]){var v=s(f,d,p),m=a(f,d,r[v].geometry);delete e[f],delete n[d],n[u(h,r[m].geometry,!0)]=m,r[v].geometry=null}else f in n?a(f,d,p):d in e?s(f,d,p):(o(l),e[f]=i-1,n[d]=i-1)}else o(l)}return r.filter((function(t){return t.geometry}))}(this.features)),this.sortFeaturesByKey&&this.features.sort((function(t,e){return t.sortKey-e.sortKey}))}},gl.prototype.update=function(t,e,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers,n),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers,n))},gl.prototype.isEmpty=function(){return 0===this.symbolInstances.length&&!this.hasRTLText},gl.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},gl.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},gl.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},gl.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},gl.prototype.addToLineVertexArray=function(t,e){var n=this.lineVertexArray.length;if(void 0!==t.segment){for(var r=t.dist(e[t.segment+1]),i=t.dist(e[t.segment]),o={},a=t.segment+1;a<e.length;a++)o[a]={x:e[a].x,y:e[a].y,tileUnitDistanceFromAnchor:r},a<e.length-1&&(r+=e[a+1].dist(e[a]));for(var s=t.segment||0;s>=0;s--)o[s]={x:e[s].x,y:e[s].y,tileUnitDistanceFromAnchor:i},s>0&&(i+=e[s-1].dist(e[s]));for(var u=0;u<e.length;u++){var l=o[u];this.lineVertexArray.emplaceBack(l.x,l.y,l.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}},gl.prototype.addSymbols=function(t,e,n,r,i,o,a,s,u,l,c,p){for(var h=t.indexArray,f=t.layoutVertexArray,d=t.segments.prepareSegment(4*e.length,f,h,this.canOverlap?o.sortKey:void 0),v=this.glyphOffsetArray.length,m=d.vertexLength,y=this.allowVerticalPlacement&&a===wu.vertical?Math.PI/2:0,g=o.text&&o.text.sections,_=0;_<e.length;_++){var x=e[_],b=x.tl,w=x.tr,S=x.bl,E=x.br,C=x.tex,T=x.pixelOffsetTL,A=x.pixelOffsetBR,M=x.minFontScaleX,k=x.minFontScaleY,P=x.glyphOffset,O=x.isSDF,L=x.sectionIndex,I=d.vertexLength,R=P[1];fl(f,s.x,s.y,b.x,R+b.y,C.x,C.y,n,O,T.x,T.y,M,k),fl(f,s.x,s.y,w.x,R+w.y,C.x+C.w,C.y,n,O,A.x,T.y,M,k),fl(f,s.x,s.y,S.x,R+S.y,C.x,C.y+C.h,n,O,T.x,A.y,M,k),fl(f,s.x,s.y,E.x,R+E.y,C.x+C.w,C.y+C.h,n,O,A.x,A.y,M,k),dl(t.dynamicLayoutVertexArray,s,y),h.emplaceBack(I,I+1,I+2),h.emplaceBack(I+1,I+2,I+3),d.vertexLength+=4,d.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(P[0]),_!==e.length-1&&L===e[_+1].sectionIndex||t.programConfigurations.populatePaintArrays(f.length,o,o.index,{},p,g&&g[L])}t.placedSymbolArray.emplaceBack(s.x,s.y,v,this.glyphOffsetArray.length-v,m,u,l,s.segment,n?n[0]:0,n?n[1]:0,r[0],r[1],a,0,!1,0,c)},gl.prototype._addCollisionDebugVertex=function(t,e,n,r,i,o){return e.emplaceBack(0,0),t.emplaceBack(n.x,n.y,r,i,Math.round(o.x),Math.round(o.y))},gl.prototype.addCollisionDebugVertices=function(t,e,n,r,i,a,s){var u=i.segments.prepareSegment(4,i.layoutVertexArray,i.indexArray),l=u.vertexLength,c=i.layoutVertexArray,p=i.collisionVertexArray,h=s.anchorX,f=s.anchorY;this._addCollisionDebugVertex(c,p,a,h,f,new o(t,e)),this._addCollisionDebugVertex(c,p,a,h,f,new o(n,e)),this._addCollisionDebugVertex(c,p,a,h,f,new o(n,r)),this._addCollisionDebugVertex(c,p,a,h,f,new o(t,r)),u.vertexLength+=4;var d=i.indexArray;d.emplaceBack(l,l+1),d.emplaceBack(l+1,l+2),d.emplaceBack(l+2,l+3),d.emplaceBack(l+3,l),u.primitiveLength+=4},gl.prototype.addDebugCollisionBoxes=function(t,e,n,r){for(var i=t;i<e;i++){var o=this.collisionBoxArray.get(i);this.addCollisionDebugVertices(o.x1,o.y1,o.x2,o.y2,r?this.textCollisionBox:this.iconCollisionBox,o.anchorPoint,n)}},gl.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new yl(Fi,Hs.members,Xi),this.iconCollisionBox=new yl(Fi,Hs.members,Xi);for(var t=0;t<this.symbolInstances.length;t++){var e=this.symbolInstances.get(t);this.addDebugCollisionBoxes(e.textBoxStartIndex,e.textBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.verticalTextBoxStartIndex,e.verticalTextBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.iconBoxStartIndex,e.iconBoxEndIndex,e,!1),this.addDebugCollisionBoxes(e.verticalIconBoxStartIndex,e.verticalIconBoxEndIndex,e,!1)}},gl.prototype._deserializeCollisionBoxesForSymbol=function(t,e,n,r,i,o,a,s,u){for(var l={},c=e;c<n;c++){var p=t.get(c);l.textBox={x1:p.x1,y1:p.y1,x2:p.x2,y2:p.y2,anchorPointX:p.anchorPointX,anchorPointY:p.anchorPointY},l.textFeatureIndex=p.featureIndex;break}for(var h=r;h<i;h++){var f=t.get(h);l.verticalTextBox={x1:f.x1,y1:f.y1,x2:f.x2,y2:f.y2,anchorPointX:f.anchorPointX,anchorPointY:f.anchorPointY},l.verticalTextFeatureIndex=f.featureIndex;break}for(var d=o;d<a;d++){var v=t.get(d);l.iconBox={x1:v.x1,y1:v.y1,x2:v.x2,y2:v.y2,anchorPointX:v.anchorPointX,anchorPointY:v.anchorPointY},l.iconFeatureIndex=v.featureIndex;break}for(var m=s;m<u;m++){var y=t.get(m);l.verticalIconBox={x1:y.x1,y1:y.y1,x2:y.x2,y2:y.y2,anchorPointX:y.anchorPointX,anchorPointY:y.anchorPointY},l.verticalIconFeatureIndex=y.featureIndex;break}return l},gl.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var e=0;e<this.symbolInstances.length;e++){var n=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}},gl.prototype.hasTextData=function(){return this.text.segments.get().length>0},gl.prototype.hasIconData=function(){return this.icon.segments.get().length>0},gl.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},gl.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},gl.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},gl.prototype.addIndicesForPlacedSymbol=function(t,e){for(var n=t.placedSymbolArray.get(e),r=n.vertexStartIndex+4*n.numGlyphs,i=n.vertexStartIndex;i<r;i+=4)t.indexArray.emplaceBack(i,i+1,i+2),t.indexArray.emplaceBack(i+1,i+2,i+3)},gl.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;for(var e=Math.sin(t),n=Math.cos(t),r=[],i=[],o=[],a=0;a<this.symbolInstances.length;++a){o.push(a);var s=this.symbolInstances.get(a);r.push(0|Math.round(e*s.anchorX+n*s.anchorY)),i.push(s.featureIndex)}return o.sort((function(t,e){return r[t]-r[e]||i[e]-i[t]})),o},gl.prototype.addToSortKeyRanges=function(t,e){var n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===e?n.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:e,symbolInstanceStart:t,symbolInstanceEnd:t+1})},gl.prototype.sortFeatures=function(t){var e=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var n=0,r=this.symbolInstanceIndexes;n<r.length;n+=1){var i=this.symbolInstances.get(r[n]);this.featureSortOrder.push(i.featureIndex),[i.rightJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.leftJustifiedTextSymbolIndex].forEach((function(t,n,r){t>=0&&r.indexOf(t)===n&&e.addIndicesForPlacedSymbol(e.text,t)})),i.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,i.verticalPlacedTextSymbolIndex),i.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,i.placedIconSymbolIndex),i.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,i.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Fr("SymbolBucket",gl,{omit:["layers","collisionBoxArray","features","compareText"]}),gl.MAX_GLYPHS=65535,gl.addDynamicAttributes=dl;var _l=new wi({"symbol-placement":new yi(Pt.layout_symbol["symbol-placement"]),"symbol-spacing":new yi(Pt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new yi(Pt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new gi(Pt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new yi(Pt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new yi(Pt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new yi(Pt.layout_symbol["icon-ignore-placement"]),"icon-optional":new yi(Pt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new yi(Pt.layout_symbol["icon-rotation-alignment"]),"icon-size":new gi(Pt.layout_symbol["icon-size"]),"icon-text-fit":new yi(Pt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new yi(Pt.layout_symbol["icon-text-fit-padding"]),"icon-image":new gi(Pt.layout_symbol["icon-image"]),"icon-rotate":new gi(Pt.layout_symbol["icon-rotate"]),"icon-padding":new yi(Pt.layout_symbol["icon-padding"]),"icon-keep-upright":new yi(Pt.layout_symbol["icon-keep-upright"]),"icon-offset":new gi(Pt.layout_symbol["icon-offset"]),"icon-anchor":new gi(Pt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new yi(Pt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new yi(Pt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new yi(Pt.layout_symbol["text-rotation-alignment"]),"text-field":new gi(Pt.layout_symbol["text-field"]),"text-font":new gi(Pt.layout_symbol["text-font"]),"text-size":new gi(Pt.layout_symbol["text-size"]),"text-max-width":new gi(Pt.layout_symbol["text-max-width"]),"text-line-height":new yi(Pt.layout_symbol["text-line-height"]),"text-letter-spacing":new gi(Pt.layout_symbol["text-letter-spacing"]),"text-justify":new gi(Pt.layout_symbol["text-justify"]),"text-radial-offset":new gi(Pt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new yi(Pt.layout_symbol["text-variable-anchor"]),"text-anchor":new gi(Pt.layout_symbol["text-anchor"]),"text-max-angle":new yi(Pt.layout_symbol["text-max-angle"]),"text-writing-mode":new yi(Pt.layout_symbol["text-writing-mode"]),"text-rotate":new gi(Pt.layout_symbol["text-rotate"]),"text-padding":new yi(Pt.layout_symbol["text-padding"]),"text-keep-upright":new yi(Pt.layout_symbol["text-keep-upright"]),"text-transform":new gi(Pt.layout_symbol["text-transform"]),"text-offset":new gi(Pt.layout_symbol["text-offset"]),"text-allow-overlap":new yi(Pt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new yi(Pt.layout_symbol["text-ignore-placement"]),"text-optional":new yi(Pt.layout_symbol["text-optional"])}),xl={paint:new wi({"icon-opacity":new gi(Pt.paint_symbol["icon-opacity"]),"icon-color":new gi(Pt.paint_symbol["icon-color"]),"icon-halo-color":new gi(Pt.paint_symbol["icon-halo-color"]),"icon-halo-width":new gi(Pt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new gi(Pt.paint_symbol["icon-halo-blur"]),"icon-translate":new yi(Pt.paint_symbol["icon-translate"]),"icon-translate-anchor":new yi(Pt.paint_symbol["icon-translate-anchor"]),"text-opacity":new gi(Pt.paint_symbol["text-opacity"]),"text-color":new gi(Pt.paint_symbol["text-color"],{runtimeType:Ut,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new gi(Pt.paint_symbol["text-halo-color"]),"text-halo-width":new gi(Pt.paint_symbol["text-halo-width"]),"text-halo-blur":new gi(Pt.paint_symbol["text-halo-blur"]),"text-translate":new yi(Pt.paint_symbol["text-translate"]),"text-translate-anchor":new yi(Pt.paint_symbol["text-translate-anchor"])}),layout:_l},bl=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:zt,this.defaultValue=t};bl.prototype.evaluate=function(t){if(t.formattedSection){var e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},bl.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},bl.prototype.outputDefined=function(){return!1},bl.prototype.serialize=function(){return null},Fr("FormatSectionOverride",bl,{omit:["defaultValue"]});var wl=function(t){function e(e){t.call(this,e,xl)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.recalculate=function(e,n){if(t.prototype.recalculate.call(this,e,n),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){var r=this.layout.get("text-writing-mode");if(r){for(var i=[],o=0,a=r;o<a.length;o+=1){var s=a[o];i.indexOf(s)<0&&i.push(s)}this.layout._values["text-writing-mode"]=i}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},e.prototype.getValueAndResolveTokens=function(t,e,n,r){var i=this.layout.get(t).evaluate(e,{},n,r),o=this._unevaluatedLayout._values[t];return o.isDataDriven()||qn(o.value)||!i?i:function(t,e){return e.replace(/{([^{}]+)}/g,(function(e,n){return n in t?String(t[n]):""}))}(e.properties,i)},e.prototype.createBucket=function(t){return new gl(t)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype._setPaintOverrides=function(){for(var t=0,n=xl.paint.overridableProperties;t<n.length;t+=1){var r=n[t];if(e.hasPaintOverride(this.layout,r)){var i,o=this.paint.get(r),a=new bl(o),s=new Wn(a,o.property.specification);i="constant"===o.value.kind||"source"===o.value.kind?new Yn("source",s):new Kn("composite",s,o.value.zoomStops,o.value._interpolationType),this.paint._values[r]=new vi(o.property,i,o.parameters)}}},e.prototype._handleOverridablePaintPropertyUpdate=function(t,n,r){return!(!this.layout||n.isDataDriven()||r.isDataDriven())&&e.hasPaintOverride(this.layout,t)},e.hasPaintOverride=function(t,e){var n=t.get("text-field"),r=xl.paint.properties[e],i=!1,o=function(t){for(var e=0,n=t;e<n.length;e+=1)if(r.overrides&&r.overrides.hasOverride(n[e]))return void(i=!0)};if("constant"===n.value.kind&&n.value.value instanceof ie)o(n.value.value.sections);else if("source"===n.value.kind){var a=function(t){i||(t instanceof ce&&ue(t.value)===Wt?o(t.value.sections):t instanceof de?o(t.sections):t.eachChild(a))},s=n.value;s._styleExpression&&a(s._styleExpression.expression)}return i},e}(Si),Sl={paint:new wi({"background-color":new yi(Pt.paint_background["background-color"]),"background-pattern":new xi(Pt.paint_background["background-pattern"]),"background-opacity":new yi(Pt.paint_background["background-opacity"])})},El=function(t){function e(e){t.call(this,e,Sl)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Si),Cl={paint:new wi({"raster-opacity":new yi(Pt.paint_raster["raster-opacity"]),"raster-hue-rotate":new yi(Pt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new yi(Pt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new yi(Pt.paint_raster["raster-brightness-max"]),"raster-saturation":new yi(Pt.paint_raster["raster-saturation"]),"raster-contrast":new yi(Pt.paint_raster["raster-contrast"]),"raster-resampling":new yi(Pt.paint_raster["raster-resampling"]),"raster-fade-duration":new yi(Pt.paint_raster["raster-fade-duration"])})},Tl=function(t){function e(e){t.call(this,e,Cl)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Si),Al=function(t){function e(e){t.call(this,e,{}),this.implementation=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.is3D=function(){return"3d"===this.implementation.renderingMode},e.prototype.hasOffscreenPass=function(){return void 0!==this.implementation.prerender},e.prototype.recalculate=function(){},e.prototype.updateTransitions=function(){},e.prototype.hasTransition=function(){},e.prototype.serialize=function(){},e.prototype.onAdd=function(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)},e.prototype.onRemove=function(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)},e}(Si),Ml={circle:fa,heatmap:Sa,hillshade:Ca,fill:ps,"fill-extrusion":Ms,line:Bs,symbol:wl,background:El,raster:Tl},kl=s.HTMLImageElement,Pl=s.HTMLCanvasElement,Ol=s.HTMLVideoElement,Ll=s.ImageData,Il=s.ImageBitmap,Rl=function(t,e,n,r){this.context=t,this.format=n,this.texture=t.gl.createTexture(),this.update(e,r)};Rl.prototype.update=function(t,e,n){var r=t.width,i=t.height,o=!(this.size&&this.size[0]===r&&this.size[1]===i||n),a=this.context,s=a.gl;if(this.useMipmap=Boolean(e&&e.useMipmap),s.bindTexture(s.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA&&(!e||!1!==e.premultiply)),o)this.size=[r,i],t instanceof kl||t instanceof Pl||t instanceof Ol||t instanceof Ll||Il&&t instanceof Il?s.texImage2D(s.TEXTURE_2D,0,this.format,this.format,s.UNSIGNED_BYTE,t):s.texImage2D(s.TEXTURE_2D,0,this.format,r,i,0,this.format,s.UNSIGNED_BYTE,t.data);else{var u=n||{x:0,y:0},l=u.x,c=u.y;t instanceof kl||t instanceof Pl||t instanceof Ol||t instanceof Ll||Il&&t instanceof Il?s.texSubImage2D(s.TEXTURE_2D,0,l,c,s.RGBA,s.UNSIGNED_BYTE,t):s.texSubImage2D(s.TEXTURE_2D,0,l,c,r,i,s.RGBA,s.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&s.generateMipmap(s.TEXTURE_2D)},Rl.prototype.bind=function(t,e,n){var r=this.context.gl;r.bindTexture(r.TEXTURE_2D,this.texture),n!==r.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(n=r.LINEAR),t!==this.filter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,n||t),this.filter=t),e!==this.wrap&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,e),this.wrap=e)},Rl.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Rl.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Dl=function(t){var e=this;this._callback=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){e._triggered=!1,e._callback()})};Dl.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((function(){t._triggered=!1,t._callback()}),0))},Dl.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Nl=function(t,e,n){this.target=t,this.parent=e,this.mapId=n,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},g(["receive","process"],this),this.invoker=new Dl(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=A()?t:s};function Zl(t,e,n){var r=2*Math.PI*6378137/256/Math.pow(2,n);return[t*r-2*Math.PI*6378137/2,e*r-2*Math.PI*6378137/2]}Nl.prototype.send=function(t,e,n,r,i){var o=this;void 0===i&&(i=!1);var a=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(this.callbacks[a]=n);var s=P(this.globalScope)?void 0:[];return this.target.postMessage({id:a,type:t,hasCallback:!!n,targetMapId:r,mustQueue:i,sourceMapId:this.mapId,data:Vr(e,s)},s),{cancel:function(){n&&delete o.callbacks[a],o.target.postMessage({id:a,type:"<cancel>",targetMapId:r,sourceMapId:o.mapId})}}},Nl.prototype.receive=function(t){var e=t.data,n=e.id;if(n&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){delete this.tasks[n];var r=this.cancelCallbacks[n];delete this.cancelCallbacks[n],r&&r()}else A()||e.mustQueue?(this.tasks[n]=e,this.taskQueue.push(n),this.invoker.trigger()):this.processTask(n,e)},Nl.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),e=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),e&&this.processTask(t,e)}},Nl.prototype.processTask=function(t,e){var n=this;if("<response>"===e.type){var r=this.callbacks[t];delete this.callbacks[t],r&&(e.error?r(Gr(e.error)):r(null,Gr(e.data)))}else{var i=!1,o=P(this.globalScope)?void 0:[],a=e.hasCallback?function(e,r){i=!0,delete n.cancelCallbacks[t],n.target.postMessage({id:t,type:"<response>",sourceMapId:n.mapId,error:e?Vr(e):null,data:Vr(r,o)},o)}:function(t){i=!0},s=null,u=Gr(e.data);if(this.parent[e.type])s=this.parent[e.type](e.sourceMapId,u,a);else if(this.parent.getWorkerSource){var l=e.type.split(".");s=this.parent.getWorkerSource(e.sourceMapId,l[0],u.source)[l[1]](u,a)}else a(new Error("Could not find function "+e.type));!i&&s&&s.cancel&&(this.cancelCallbacks[t]=s.cancel)}},Nl.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var zl=function(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};zl.prototype.setNorthEast=function(t){return this._ne=t instanceof Fl?new Fl(t.lng,t.lat):Fl.convert(t),this},zl.prototype.setSouthWest=function(t){return this._sw=t instanceof Fl?new Fl(t.lng,t.lat):Fl.convert(t),this},zl.prototype.extend=function(t){var e,n,r=this._sw,i=this._ne;if(t instanceof Fl)e=t,n=t;else{if(!(t instanceof zl))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(zl.convert(t)):this.extend(Fl.convert(t)):this;if(n=t._ne,!(e=t._sw)||!n)return this}return r||i?(r.lng=Math.min(e.lng,r.lng),r.lat=Math.min(e.lat,r.lat),i.lng=Math.max(n.lng,i.lng),i.lat=Math.max(n.lat,i.lat)):(this._sw=new Fl(e.lng,e.lat),this._ne=new Fl(n.lng,n.lat)),this},zl.prototype.getCenter=function(){return new Fl((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},zl.prototype.getSouthWest=function(){return this._sw},zl.prototype.getNorthEast=function(){return this._ne},zl.prototype.getNorthWest=function(){return new Fl(this.getWest(),this.getNorth())},zl.prototype.getSouthEast=function(){return new Fl(this.getEast(),this.getSouth())},zl.prototype.getWest=function(){return this._sw.lng},zl.prototype.getSouth=function(){return this._sw.lat},zl.prototype.getEast=function(){return this._ne.lng},zl.prototype.getNorth=function(){return this._ne.lat},zl.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},zl.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},zl.prototype.isEmpty=function(){return!(this._sw&&this._ne)},zl.prototype.contains=function(t){var e=Fl.convert(t),n=e.lng,r=e.lat,i=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(i=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&i},zl.convert=function(t){return!t||t instanceof zl?t:new zl(t)};var Fl=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid LngLat object: ("+t+", "+e+")");if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Fl.prototype.wrap=function(){return new Fl(h(this.lng,-180,180),this.lat)},Fl.prototype.toArray=function(){return[this.lng,this.lat]},Fl.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Fl.prototype.distanceTo=function(t){var e=Math.PI/180,n=this.lat*e,r=t.lat*e,i=Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos((t.lng-this.lng)*e);return 6371008.8*Math.acos(Math.min(i,1))},Fl.prototype.toBounds=function(t){void 0===t&&(t=0);var e=360*t/40075017,n=e/Math.cos(Math.PI/180*this.lat);return new zl(new Fl(this.lng-n,this.lat-e),new Fl(this.lng+n,this.lat+e))},Fl.convert=function(t){if(t instanceof Fl)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new Fl(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new Fl(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Bl=2*Math.PI*6371008.8;function jl(t){return Bl*Math.cos(t*Math.PI/180)}function Ul(t){return(180+t)/360}function Vl(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Gl(t,e){return t/jl(e)}function Hl(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var Wl=function(t,e,n){void 0===n&&(n=0),this.x=+t,this.y=+e,this.z=+n};Wl.fromLngLat=function(t,e){void 0===e&&(e=0);var n=Fl.convert(t);return new Wl(Ul(n.lng),Vl(n.lat),Gl(e,n.lat))},Wl.prototype.toLngLat=function(){return new Fl(360*this.x-180,Hl(this.y))},Wl.prototype.toAltitude=function(){return this.z*jl(Hl(this.y))},Wl.prototype.meterInMercatorCoordinateUnits=function(){return 1/Bl*(t=Hl(this.y),1/Math.cos(t*Math.PI/180));var t};var ql=function(t,e,n){this.z=t,this.x=e,this.y=n,this.key=Kl(0,t,t,e,n)};ql.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},ql.prototype.url=function(t,e){var n,r,i,o,a,s=(r=this.y,i=this.z,o=Zl(256*(n=this.x),256*(r=Math.pow(2,i)-r-1),i),a=Zl(256*(n+1),256*(r+1),i),o[0]+","+o[1]+","+a[0]+","+a[1]),u=function(t,e,n){for(var r,i="",o=t;o>0;o--)i+=(e&(r=1<<o-1)?1:0)+(n&r?2:0);return i}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===e?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",s)},ql.prototype.getTilePoint=function(t){var e=Math.pow(2,this.z);return new o(8192*(t.x*e-this.x),8192*(t.y*e-this.y))},ql.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Xl=function(t,e){this.wrap=t,this.canonical=e,this.key=Kl(t,e.z,e.z,e.x,e.y)},Yl=function(t,e,n,r,i){this.overscaledZ=t,this.wrap=e,this.canonical=new ql(n,+r,+i),this.key=Kl(e,t,n,r,i)};function Kl(t,e,n,r,i){(t*=2)<0&&(t=-1*t-1);var o=1<<n;return(o*o*t+o*i+r).toString(36)+n.toString(36)+e.toString(36)}Yl.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},Yl.prototype.scaledTo=function(t){var e=this.canonical.z-t;return t>this.canonical.z?new Yl(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Yl(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)},Yl.prototype.calculateScaledKey=function(t,e){var n=this.canonical.z-t;return t>this.canonical.z?Kl(this.wrap*+e,t,this.canonical.z,this.canonical.x,this.canonical.y):Kl(this.wrap*+e,t,t,this.canonical.x>>n,this.canonical.y>>n)},Yl.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e},Yl.prototype.children=function(t){if(this.overscaledZ>=t)return[new Yl(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var e=this.canonical.z+1,n=2*this.canonical.x,r=2*this.canonical.y;return[new Yl(e,this.wrap,e,n,r),new Yl(e,this.wrap,e,n+1,r),new Yl(e,this.wrap,e,n,r+1),new Yl(e,this.wrap,e,n+1,r+1)]},Yl.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},Yl.prototype.wrapped=function(){return new Yl(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Yl.prototype.unwrapTo=function(t){return new Yl(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},Yl.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Yl.prototype.toUnwrapped=function(){return new Xl(this.wrap,this.canonical)},Yl.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Yl.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new Wl(t.x-this.wrap,t.y))},Fr("CanonicalTileID",ql),Fr("OverscaledTileID",Yl,{omit:["posMatrix"]});var Ql=function(t,e,n){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(n&&"mapbox"!==n&&"terrarium"!==n)return E('"'+n+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=e.height;var r=this.dim=e.height-2;this.data=new Uint32Array(e.data.buffer),this.encoding=n||"mapbox";for(var i=0;i<r;i++)this.data[this._idx(-1,i)]=this.data[this._idx(0,i)],this.data[this._idx(r,i)]=this.data[this._idx(r-1,i)],this.data[this._idx(i,-1)]=this.data[this._idx(i,0)],this.data[this._idx(i,r)]=this.data[this._idx(i,r-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(r,-1)]=this.data[this._idx(r-1,0)],this.data[this._idx(-1,r)]=this.data[this._idx(0,r-1)],this.data[this._idx(r,r)]=this.data[this._idx(r-1,r-1)]};Ql.prototype.get=function(t,e){var n=new Uint8Array(this.data.buffer),r=4*this._idx(t,e);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(n[r],n[r+1],n[r+2])},Ql.prototype.getUnpackVector=function(){return"terrarium"===this.encoding?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Ql.prototype._idx=function(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)},Ql.prototype._unpackMapbox=function(t,e,n){return(256*t*256+256*e+n)/10-1e4},Ql.prototype._unpackTerrarium=function(t,e,n){return 256*t+e+n/256-32768},Ql.prototype.getPixels=function(){return new xa({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Ql.prototype.backfillBorder=function(t,e,n){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var r=e*this.dim,i=e*this.dim+this.dim,o=n*this.dim,a=n*this.dim+this.dim;switch(e){case-1:r=i-1;break;case 1:i=r+1}switch(n){case-1:o=a-1;break;case 1:a=o+1}for(var s=-e*this.dim,u=-n*this.dim,l=o;l<a;l++)for(var c=r;c<i;c++)this.data[this._idx(c,l)]=t.data[this._idx(c+s,l+u)]},Fr("DEMData",Ql);var Jl=function(t){this._stringToNumber={},this._numberToString=[];for(var e=0;e<t.length;e++){var n=t[e];this._stringToNumber[n]=e,this._numberToString[e]=n}};Jl.prototype.encode=function(t){return this._stringToNumber[t]},Jl.prototype.decode=function(t){return this._numberToString[t]};var $l=function(t,e,n,r,i){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=n,t._y=r,this.properties=t.properties,this.id=i},tc={geometry:{configurable:!0}};tc.geometry.get=function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},tc.geometry.set=function(t){this._geometry=t},$l.prototype.toJSON=function(){var t={geometry:this.geometry};for(var e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t},Object.defineProperties($l.prototype,tc);var ec=function(){this.state={},this.stateChanges={},this.deletedStates={}};ec.prototype.updateState=function(t,e,n){var r=String(e);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][r]=this.stateChanges[t][r]||{},f(this.stateChanges[t][r],n),null===this.deletedStates[t])for(var i in this.deletedStates[t]={},this.state[t])i!==r&&(this.deletedStates[t][i]=null);else if(this.deletedStates[t]&&null===this.deletedStates[t][r])for(var o in this.deletedStates[t][r]={},this.state[t][r])n[o]||(this.deletedStates[t][r][o]=null);else for(var a in n)this.deletedStates[t]&&this.deletedStates[t][r]&&null===this.deletedStates[t][r][a]&&delete this.deletedStates[t][r][a]},ec.prototype.removeFeatureState=function(t,e,n){if(null!==this.deletedStates[t]){var r=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},n&&void 0!==e)null!==this.deletedStates[t][r]&&(this.deletedStates[t][r]=this.deletedStates[t][r]||{},this.deletedStates[t][r][n]=null);else if(void 0!==e)if(this.stateChanges[t]&&this.stateChanges[t][r])for(n in this.deletedStates[t][r]={},this.stateChanges[t][r])this.deletedStates[t][r][n]=null;else this.deletedStates[t][r]=null;else this.deletedStates[t]=null}},ec.prototype.getState=function(t,e){var n=String(e),r=f({},(this.state[t]||{})[n],(this.stateChanges[t]||{})[n]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){var i=this.deletedStates[t][e];if(null===i)return{};for(var o in i)delete r[o]}return r},ec.prototype.initializeTileState=function(t,e){t.setFeatureState(this.state,e)},ec.prototype.coalesceChanges=function(t,e){var n={};for(var r in this.stateChanges){this.state[r]=this.state[r]||{};var i={};for(var o in this.stateChanges[r])this.state[r][o]||(this.state[r][o]={}),f(this.state[r][o],this.stateChanges[r][o]),i[o]=this.state[r][o];n[r]=i}for(var a in this.deletedStates){this.state[a]=this.state[a]||{};var s={};if(null===this.deletedStates[a])for(var u in this.state[a])s[u]={},this.state[a][u]={};else for(var l in this.deletedStates[a]){if(null===this.deletedStates[a][l])this.state[a][l]={};else for(var c=0,p=Object.keys(this.deletedStates[a][l]);c<p.length;c+=1)delete this.state[a][l][p[c]];s[l]=this.state[a][l]}n[a]=n[a]||{},f(n[a],s)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(n).length)for(var h in t)t[h].setFeatureState(n,e)};var nc=function(t,e){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Rr(8192,16,0),this.grid3D=new Rr(8192,16,0),this.featureIndexArray=new ao,this.promoteId=e};function rc(t,e,n,r,i){return x(t,(function(t,o){var a=e instanceof mi?e.get(o):null;return a&&a.evaluate?a.evaluate(n,r,i):a}))}function ic(t){for(var e=1/0,n=1/0,r=-1/0,i=-1/0,o=0,a=t;o<a.length;o+=1){var s=a[o];e=Math.min(e,s.x),n=Math.min(n,s.y),r=Math.max(r,s.x),i=Math.max(i,s.y)}return{minX:e,minY:n,maxX:r,maxY:i}}function oc(t,e){return e-t}nc.prototype.insert=function(t,e,n,r,i,o){var a=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,r,i);for(var s=o?this.grid3D:this.grid,u=0;u<e.length;u++){for(var l=e[u],c=[1/0,1/0,-1/0,-1/0],p=0;p<l.length;p++){var h=l[p];c[0]=Math.min(c[0],h.x),c[1]=Math.min(c[1],h.y),c[2]=Math.max(c[2],h.x),c[3]=Math.max(c[3],h.y)}c[0]<8192&&c[1]<8192&&c[2]>=0&&c[3]>=0&&s.insert(a,c[0],c[1],c[2],c[3])}},nc.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new bs.VectorTile(new Qs(this.rawTileData)).layers,this.sourceLayerCoder=new Jl(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},nc.prototype.query=function(t,e,n,r){var i=this;this.loadVTLayers();for(var a=t.params||{},s=8192/t.tileSize/t.scale,u=sr(a.filter),l=t.queryGeometry,c=t.queryPadding*s,p=ic(l),h=this.grid.query(p.minX-c,p.minY-c,p.maxX+c,p.maxY+c),f=ic(t.cameraQueryGeometry),d=this.grid3D.query(f.minX-c,f.minY-c,f.maxX+c,f.maxY+c,(function(e,n,r,i){return function(t,e,n,r,i){for(var a=0,s=t;a<s.length;a+=1){var u=s[a];if(e<=u.x&&n<=u.y&&r>=u.x&&i>=u.y)return!0}var l=[new o(e,n),new o(e,i),new o(r,i),new o(r,n)];if(t.length>2)for(var c=0,p=l;c<p.length;c+=1)if(ta(t,p[c]))return!0;for(var h=0;h<t.length-1;h++)if(ea(t[h],t[h+1],l))return!0;return!1}(t.cameraQueryGeometry,e-c,n-c,r+c,i+c)})),v=0,m=d;v<m.length;v+=1)h.push(m[v]);h.sort(oc);for(var y,g={},_=function(o){var c=h[o];if(c!==y){y=c;var p=i.featureIndexArray.get(c),f=null;i.loadMatchingFeature(g,p.bucketIndex,p.sourceLayerIndex,p.featureIndex,u,a.layers,a.availableImages,e,n,r,(function(e,n,r){return f||(f=jo(e)),n.queryIntersectsFeature(l,e,r,f,i.z,t.transform,s,t.pixelPosMatrix)}))}},x=0;x<h.length;x++)_(x);return g},nc.prototype.loadMatchingFeature=function(t,e,n,r,i,o,a,s,u,l,c){var p=this.bucketLayerIDs[e];if(!o||function(t,e){for(var n=0;n<t.length;n++)if(e.indexOf(t[n])>=0)return!0;return!1}(o,p)){var h=this.sourceLayerCoder.decode(n),d=this.vtLayers[h].feature(r);if(i.needGeometry){var v=Uo(d,!0);if(!i.filter(new ui(this.tileID.overscaledZ),v,this.tileID.canonical))return}else if(!i.filter(new ui(this.tileID.overscaledZ),d))return;for(var m=this.getId(d,h),y=0;y<p.length;y++){var g=p[y];if(!(o&&o.indexOf(g)<0)){var _=s[g];if(_){var x={};void 0!==m&&l&&(x=l.getState(_.sourceLayer||"_geojsonTileLayer",m));var b=f({},u[g]);b.paint=rc(b.paint,_.paint,d,x,a),b.layout=rc(b.layout,_.layout,d,x,a);var w=!c||c(d,_,x);if(w){var S=new $l(d,this.z,this.x,this.y,m);S.layer=b;var E=t[g];void 0===E&&(E=t[g]=[]),E.push({featureIndex:r,feature:S,intersectionZ:w})}}}}}},nc.prototype.lookupSymbolFeatures=function(t,e,n,r,i,o,a,s){var u={};this.loadVTLayers();for(var l=sr(i),c=0,p=t;c<p.length;c+=1)this.loadMatchingFeature(u,n,r,p[c],l,o,a,s,e);return u},nc.prototype.hasLayer=function(t){for(var e=0,n=this.bucketLayerIDs;e<n.length;e+=1)for(var r=0,i=n[e];r<i.length;r+=1)if(t===i[r])return!0;return!1},nc.prototype.getId=function(t,e){var n=t.id;return this.promoteId&&"boolean"==typeof(n=t.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[e]])&&(n=Number(n)),n},Fr("FeatureIndex",nc,{omit:["rawTileData","sourceLayerCoder"]});var ac=function(t,e){this.tileID=t,this.uid=v(),this.uses=0,this.tileSize=e,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};ac.prototype.registerFadeDuration=function(t){var e=t+this.timeAdded;e<F.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e)},ac.prototype.wasRequested=function(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state},ac.prototype.loadVectorData=function(t,e,n){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var r in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(t,e){var n={};if(!e)return n;for(var r=function(){var t=o[i],r=t.layerIds.map((function(t){return e.getLayer(t)})).filter(Boolean);if(0!==r.length){t.layers=r,t.stateDependentLayerIds&&(t.stateDependentLayers=t.stateDependentLayerIds.map((function(t){return r.filter((function(e){return e.id===t}))[0]})));for(var a=0,s=r;a<s.length;a+=1)n[s[a].id]=t}},i=0,o=t;i<o.length;i+=1)r();return n}(t.buckets,e.style),this.hasSymbolBuckets=!1,this.buckets){var i=this.buckets[r];if(i instanceof gl){if(this.hasSymbolBuckets=!0,!n)break;i.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var o in this.buckets){var a=this.buckets[o];if(a instanceof gl&&a.hasRTLText){this.hasRTLText=!0,si.isLoading()||si.isLoaded()||"deferred"!==oi()||ai();break}}for(var s in this.queryPadding=0,this.buckets){var u=this.buckets[s];this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(s).queryRadius(u))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new Ji},ac.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},ac.prototype.getBucket=function(t){return this.buckets[t.id]},ac.prototype.upload=function(t){for(var e in this.buckets){var n=this.buckets[e];n.uploadPending()&&n.upload(t)}var r=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Rl(t,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Rl(t,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null)},ac.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},ac.prototype.queryRenderedFeatures=function(t,e,n,r,i,o,a,s,u,l){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:r,cameraQueryGeometry:i,scale:o,tileSize:this.tileSize,pixelPosMatrix:l,transform:s,params:a,queryPadding:this.queryPadding*u},t,e,n):{}},ac.prototype.querySourceFeatures=function(t,e){var n=this.latestFeatureIndex;if(n&&n.rawTileData){var r=n.loadVTLayers(),i=e?e.sourceLayer:"",o=r._geojsonTileLayer||r[i];if(o)for(var a=sr(e&&e.filter),s=this.tileID.canonical,u=s.z,l=s.x,c=s.y,p={z:u,x:l,y:c},h=0;h<o.length;h++){var f=o.feature(h);if(a.needGeometry){var d=Uo(f,!0);if(!a.filter(new ui(this.tileID.overscaledZ),d,this.tileID.canonical))continue}else if(!a.filter(new ui(this.tileID.overscaledZ),f))continue;var v=n.getId(f,i),m=new $l(f,u,l,c,v);m.tile=p,t.push(m)}}},ac.prototype.hasData=function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state},ac.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},ac.prototype.setExpiryData=function(t){var e=this.expirationTime;if(t.cacheControl){var n=M(t.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var r=Date.now(),i=!1;if(this.expirationTime>r)i=!1;else if(e)if(this.expirationTime<e)i=!0;else{var o=this.expirationTime-e;o?this.expirationTime=r+Math.max(o,3e4):i=!0}else i=!0;i?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},ac.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)},ac.prototype.setFeatureState=function(t,e){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(t).length){var n=this.latestFeatureIndex.loadVTLayers();for(var r in this.buckets)if(e.style.hasLayer(r)){var i=this.buckets[r],o=i.layers[0].sourceLayer||"_geojsonTileLayer",a=n[o],s=t[o];if(a&&s&&0!==Object.keys(s).length){i.update(s,a,this.imageAtlas&&this.imageAtlas.patternPositions||{});var u=e&&e.style&&e.style.getLayer(r);u&&(this.queryPadding=Math.max(this.queryPadding,u.queryRadius(i)))}}}},ac.prototype.holdingForFade=function(){return void 0!==this.symbolFadeHoldUntil},ac.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<F.now()},ac.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},ac.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=F.now()+t},ac.prototype.setDependencies=function(t,e){for(var n={},r=0,i=e;r<i.length;r+=1)n[i[r]]=!0;this.dependencies[t]=n},ac.prototype.hasDependency=function(t,e){for(var n=0,r=t;n<r.length;n+=1){var i=this.dependencies[r[n]];if(i)for(var o=0,a=e;o<a.length;o+=1)if(i[a[o]])return!0}return!1};var sc=s.performance,uc=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},sc.mark(this._marks.start)};uc.prototype.finish=function(){sc.mark(this._marks.end);var t=sc.getEntriesByName(this._marks.measure);return 0===t.length&&(sc.measure(this._marks.measure,this._marks.start,this._marks.end),t=sc.getEntriesByName(this._marks.measure),sc.clearMarks(this._marks.start),sc.clearMarks(this._marks.end),sc.clearMeasures(this._marks.measure)),t},t.Actor=Nl,t.AlphaImage=_a,t.CanonicalTileID=ql,t.CollisionBoxArray=Ji,t.Color=ee,t.DEMData=Ql,t.DataConstantProperty=yi,t.DictionaryCoder=Jl,t.EXTENT=8192,t.ErrorEvent=Mt,t.EvaluationParameters=ui,t.Event=At,t.Evented=kt,t.FeatureIndex=nc,t.FillBucket=us,t.FillExtrusionBucket=Cs,t.ImageAtlas=bu,t.ImagePosition=_u,t.LineBucket=Ns,t.LngLat=Fl,t.LngLatBounds=zl,t.MercatorCoordinate=Wl,t.ONE_EM=24,t.OverscaledTileID=Yl,t.Point=o,t.Point$1=o,t.Properties=wi,t.Protobuf=Qs,t.RGBAImage=xa,t.RequestManager=W,t.RequestPerformance=uc,t.ResourceType=vt,t.SegmentVector=uo,t.SourceFeatureState=ec,t.StructArrayLayout1ui2=Yi,t.StructArrayLayout2f1f2i16=Bi,t.StructArrayLayout2i4=ki,t.StructArrayLayout3ui6=Ui,t.StructArrayLayout4i8=Pi,t.SymbolBucket=gl,t.Texture=Rl,t.Tile=ac,t.Transitionable=pi,t.Uniform1f=wo,t.Uniform1i=bo,t.Uniform2f=So,t.Uniform3f=Eo,t.Uniform4f=Co,t.UniformColor=To,t.UniformMatrix4f=Mo,t.UnwrappedTileID=Xl,t.ValidationError=Ot,t.WritingMode=wu,t.ZoomHistory=Hr,t.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},t.addDynamicAttributes=dl,t.asyncAll=function(t,e,n){if(!t.length)return n(null,[]);var r=t.length,i=new Array(t.length),o=null;t.forEach((function(t,a){e(t,(function(t,e){t&&(o=t),i[a]=e,0==--r&&n(o,i)}))}))},t.bezier=l,t.bindAll=g,t.browser=F,t.cacheEntryPossiblyAdded=function(t){++ft>lt&&(t.getActor().send("enforceCacheSizeLimit",ut),ft=0)},t.clamp=p,t.clearTileCache=function(t){var e=s.caches.delete("mapbox-tiles");t&&e.catch(t).then((function(){return t()}))},t.clipLine=qu,t.clone=function(t){var e=new sa(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.clone$1=w,t.clone$2=function(t){var e=new sa(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},t.collisionCircleLayout=Ws,t.config=B,t.create=function(){var t=new sa(16);return sa!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},t.create$1=function(){var t=new sa(9);return sa!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},t.create$2=function(){var t=new sa(4);return sa!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},t.createCommonjsModule=e,t.createExpression=Xn,t.createLayout=Ai,t.createStyleLayer=function(t){return"custom"===t.type?new Al(t):new Ml[t.type](t)},t.cross=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],u=n[2];return t[0]=i*u-o*s,t[1]=o*a-r*u,t[2]=r*s-i*a,t},t.deepEqual=function t(e,n){if(Array.isArray(e)){if(!Array.isArray(n)||e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(!t(e[r],n[r]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==n){if("object"!=typeof n)return!1;if(Object.keys(e).length!==Object.keys(n).length)return!1;for(var i in e)if(!t(e[i],n[i]))return!1;return!0}return e===n},t.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},t.dot$1=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},t.ease=c,t.emitValidationErrors=Ir,t.endsWith=_,t.enforceCacheSizeLimit=function(t){ct(),et&&et.then((function(e){e.keys().then((function(n){for(var r=0;r<n.length-t;r++)e.delete(n[r])}))}))},t.evaluateSizeForFeature=zu,t.evaluateSizeForZoom=Fu,t.evaluateVariableOffset=al,t.evented=ii,t.extend=f,t.featureFilter=sr,t.filterObject=b,t.fromRotation=function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=-n,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},t.getAnchorAlignment=Iu,t.getAnchorJustification=sl,t.getArrayBuffer=bt,t.getImage=Et,t.getJSON=function(t,e){return xt(f(t,{type:"json"}),e)},t.getRTLTextPluginStatus=oi,t.getReferrer=_t,t.getVideo=function(t,e){var n,r,i=s.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(var o=0;o<t.length;o++){var a=s.document.createElement("source");n=t[o],r=void 0,(r=s.document.createElement("a")).href=n,(r.protocol!==s.document.location.protocol||r.host!==s.document.location.host)&&(i.crossOrigin="Anonymous"),a.src=t[o],i.appendChild(a)}return{cancel:function(){}}},t.identity=ua,t.invert=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],p=e[9],h=e[10],f=e[11],d=e[12],v=e[13],m=e[14],y=e[15],g=n*s-r*a,_=n*u-i*a,x=n*l-o*a,b=r*u-i*s,w=r*l-o*s,S=i*l-o*u,E=c*v-p*d,C=c*m-h*d,T=c*y-f*d,A=p*m-h*v,M=p*y-f*v,k=h*y-f*m,P=g*k-_*M+x*A+b*T-w*C+S*E;return P?(t[0]=(s*k-u*M+l*A)*(P=1/P),t[1]=(i*M-r*k-o*A)*P,t[2]=(v*S-m*w+y*b)*P,t[3]=(h*w-p*S-f*b)*P,t[4]=(u*T-a*k-l*C)*P,t[5]=(n*k-i*T+o*C)*P,t[6]=(m*x-d*S-y*_)*P,t[7]=(c*S-h*x+f*_)*P,t[8]=(a*M-s*T+l*E)*P,t[9]=(r*T-n*M-o*E)*P,t[10]=(d*w-v*x+y*g)*P,t[11]=(p*x-c*w-f*g)*P,t[12]=(s*C-a*A-u*E)*P,t[13]=(n*A-r*C+i*E)*P,t[14]=(v*_-d*b-m*g)*P,t[15]=(c*b-p*_+h*g)*P,t):null},t.isChar=Wr,t.isMapboxURL=q,t.keysDifference=function(t,e){var n=[];for(var r in t)r in e||n.push(r);return n},t.makeRequest=xt,t.mapObject=x,t.mercatorXfromLng=Ul,t.mercatorYfromLat=Vl,t.mercatorZfromAltitude=Gl,t.mul=pa,t.multiply=la,t.mvt=bs,t.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},t.normalize=function(t,e){var n=e[0],r=e[1],i=e[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t},t.number=He,t.offscreenCanvasSupported=dt,t.ortho=function(t,e,n,r,i,o,a){var s=1/(e-n),u=1/(r-i),l=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*u,t[14]=(a+o)*l,t[15]=1,t},t.parseGlyphPBF=function(t){return new Qs(t).readFields(vu,[])},t.pbf=Qs,t.performSymbolLayout=function(t,e,n,r,i,o,a){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var s=t.layers[0].layout,u=t.layers[0]._unevaluatedLayout._values,l={};if("composite"===t.textSizeData.kind){var c=t.textSizeData,p=c.maxZoom;l.compositeTextSizes=[u["text-size"].possiblyEvaluate(new ui(c.minZoom),a),u["text-size"].possiblyEvaluate(new ui(p),a)]}if("composite"===t.iconSizeData.kind){var h=t.iconSizeData,f=h.maxZoom;l.compositeIconSizes=[u["icon-size"].possiblyEvaluate(new ui(h.minZoom),a),u["icon-size"].possiblyEvaluate(new ui(f),a)]}l.layoutTextSize=u["text-size"].possiblyEvaluate(new ui(t.zoom+1),a),l.layoutIconSize=u["icon-size"].possiblyEvaluate(new ui(t.zoom+1),a),l.textMaxSize=u["text-size"].possiblyEvaluate(new ui(18));for(var d=24*s.get("text-line-height"),v="map"===s.get("text-rotation-alignment")&&"point"!==s.get("symbol-placement"),m=s.get("text-keep-upright"),y=s.get("text-size"),g=function(){var o=x[_],u=s.get("text-font").evaluate(o,{},a).join(","),c=y.evaluate(o,{},a),p=l.layoutTextSize.evaluate(o,{},a),h=l.layoutIconSize.evaluate(o,{},a),f={horizontal:{},vertical:void 0},g=o.text,b=[0,0];if(g){var w=g.toString(),S=24*s.get("text-letter-spacing").evaluate(o,{},a),C=function(t){for(var e=0,n=t;e<n.length;e+=1)if(r=n[e].charCodeAt(0),Wr.Arabic(r)||Wr["Arabic Supplement"](r)||Wr["Arabic Extended-A"](r)||Wr["Arabic Presentation Forms-A"](r)||Wr["Arabic Presentation Forms-B"](r))return!1;var r;return!0}(w)?S:0,T=s.get("text-anchor").evaluate(o,{},a),A=s.get("text-variable-anchor");if(!A){var M=s.get("text-radial-offset").evaluate(o,{},a);b=M?al(T,[24*M,ol]):s.get("text-offset").evaluate(o,{},a).map((function(t){return 24*t}))}var k=v?"center":s.get("text-justify").evaluate(o,{},a),P=s.get("symbol-placement"),O="point"===P?24*s.get("text-max-width").evaluate(o,{},a):0,L=function(){t.allowVerticalPlacement&&qr(w)&&(f.vertical=Cu(g,e,n,i,u,O,d,T,"left",C,b,wu.vertical,!0,P,p,c))};if(!v&&A){for(var I="auto"===k?A.map((function(t){return sl(t)})):[k],R=!1,D=0;D<I.length;D++){var N=I[D];if(!f.horizontal[N])if(R)f.horizontal[N]=f.horizontal[0];else{var Z=Cu(g,e,n,i,u,O,d,"center",N,C,b,wu.horizontal,!1,P,p,c);Z&&(f.horizontal[N]=Z,R=1===Z.positionedLines.length)}}L()}else{"auto"===k&&(k=sl(T));var z=Cu(g,e,n,i,u,O,d,T,k,C,b,wu.horizontal,!1,P,p,c);z&&(f.horizontal[k]=z),L(),qr(w)&&v&&m&&(f.vertical=Cu(g,e,n,i,u,O,d,T,k,C,b,wu.vertical,!1,P,p,c))}}var F=void 0,B=!1;if(o.icon&&o.icon.name){var j=r[o.icon.name];j&&(F=function(t,e,n){var r=Iu(n),i=e[0]-t.displaySize[0]*r.horizontalAlign,o=e[1]-t.displaySize[1]*r.verticalAlign;return{image:t,top:o,bottom:o+t.displaySize[1],left:i,right:i+t.displaySize[0]}}(i[o.icon.name],s.get("icon-offset").evaluate(o,{},a),s.get("icon-anchor").evaluate(o,{},a)),B=j.sdf,void 0===t.sdfIcons?t.sdfIcons=j.sdf:t.sdfIcons!==j.sdf&&E("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(j.pixelRatio!==t.pixelRatio||0!==s.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}var U=ll(f.horizontal)||f.vertical;t.iconsInText=!!U&&U.iconsInText,(U||F)&&function(t,e,n,r,i,o,a,s,u,l,c){var p=o.textMaxSize.evaluate(e,{});void 0===p&&(p=a);var h,f=t.layers[0].layout,d=f.get("icon-offset").evaluate(e,{},c),v=ll(n.horizontal),m=a/24,y=t.tilePixelRatio*m,g=t.tilePixelRatio*p/24,_=t.tilePixelRatio*s,x=t.tilePixelRatio*f.get("symbol-spacing"),b=f.get("text-padding")*t.tilePixelRatio,w=f.get("icon-padding")*t.tilePixelRatio,S=f.get("text-max-angle")/180*Math.PI,C="map"===f.get("text-rotation-alignment")&&"point"!==f.get("symbol-placement"),T="map"===f.get("icon-rotation-alignment")&&"point"!==f.get("symbol-placement"),A=f.get("symbol-placement"),M=x/2,k=f.get("icon-text-fit");r&&"none"!==k&&(t.allowVerticalPlacement&&n.vertical&&(h=Du(r,n.vertical,k,f.get("icon-text-fit-padding"),d,m)),v&&(r=Du(r,v,k,f.get("icon-text-fit-padding"),d,m)));var P=function(s,p){p.x<0||p.x>=8192||p.y<0||p.y>=8192||function(t,e,n,r,i,o,a,s,u,l,c,p,h,f,d,v,m,y,g,_,x,b,w,S,C){var T,A,M,k,P,O=t.addToLineVertexArray(e,n),L=0,I=0,R=0,D=0,N=-1,Z=-1,z={},F=fo(""),B=0,j=0;if(void 0===s._unevaluatedLayout.getValue("text-radial-offset")?(B=(T=s.layout.get("text-offset").evaluate(x,{},S).map((function(t){return 24*t})))[0],j=T[1]):(B=24*s.layout.get("text-radial-offset").evaluate(x,{},S),j=ol),t.allowVerticalPlacement&&r.vertical){var U=s.layout.get("text-rotate").evaluate(x,{},S)+90;k=new $u(u,e,l,c,p,r.vertical,h,f,d,U),a&&(P=new $u(u,e,l,c,p,a,m,y,d,U))}if(i){var V=s.layout.get("icon-rotate").evaluate(x,{}),G="none"!==s.layout.get("icon-text-fit"),H=Xu(i,V,w,G),W=a?Xu(a,V,w,G):void 0;M=new $u(u,e,l,c,p,i,m,y,!1,V),L=4*H.length;var q=t.iconSizeData,X=null;"source"===q.kind?(X=[128*s.layout.get("icon-size").evaluate(x,{})])[0]>32640&&E(t.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):"composite"===q.kind&&((X=[128*b.compositeIconSizes[0].evaluate(x,{},S),128*b.compositeIconSizes[1].evaluate(x,{},S)])[0]>32640||X[1]>32640)&&E(t.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),t.addSymbols(t.icon,H,X,_,g,x,!1,e,O.lineStartIndex,O.lineLength,-1,S),N=t.icon.placedSymbolArray.length-1,W&&(I=4*W.length,t.addSymbols(t.icon,W,X,_,g,x,wu.vertical,e,O.lineStartIndex,O.lineLength,-1,S),Z=t.icon.placedSymbolArray.length-1)}for(var Y in r.horizontal){var K=r.horizontal[Y];if(!A){F=fo(K.text);var Q=s.layout.get("text-rotate").evaluate(x,{},S);A=new $u(u,e,l,c,p,K,h,f,d,Q)}var J=1===K.positionedLines.length;if(R+=ul(t,e,K,o,s,d,x,v,O,r.vertical?wu.horizontal:wu.horizontalOnly,J?Object.keys(r.horizontal):[Y],z,N,b,S),J)break}r.vertical&&(D+=ul(t,e,r.vertical,o,s,d,x,v,O,wu.vertical,["vertical"],z,Z,b,S));var $=A?A.boxStartIndex:t.collisionBoxArray.length,tt=A?A.boxEndIndex:t.collisionBoxArray.length,et=k?k.boxStartIndex:t.collisionBoxArray.length,nt=k?k.boxEndIndex:t.collisionBoxArray.length,rt=M?M.boxStartIndex:t.collisionBoxArray.length,it=M?M.boxEndIndex:t.collisionBoxArray.length,ot=P?P.boxStartIndex:t.collisionBoxArray.length,at=P?P.boxEndIndex:t.collisionBoxArray.length,st=-1,ut=function(t,e){return t&&t.circleDiameter?Math.max(t.circleDiameter,e):e};st=ut(A,st),st=ut(k,st),st=ut(M,st);var lt=(st=ut(P,st))>-1?1:0;lt&&(st*=C/24),t.glyphOffsetArray.length>=gl.MAX_GLYPHS&&E("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==x.sortKey&&t.addToSortKeyRanges(t.symbolInstances.length,x.sortKey),t.symbolInstances.emplaceBack(e.x,e.y,z.right>=0?z.right:-1,z.center>=0?z.center:-1,z.left>=0?z.left:-1,z.vertical||-1,N,Z,F,$,tt,et,nt,rt,it,ot,at,l,R,D,L,I,lt,0,h,B,j,st)}(t,p,s,n,r,i,h,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,y,b,C,u,_,w,T,d,e,o,l,c,a)};if("line"===A)for(var O=0,L=qu(e.geometry,0,0,8192,8192);O<L.length;O+=1)for(var I=L[O],R=0,D=Wu(I,x,S,n.vertical||v,r,24,g,t.overscaling,8192);R<D.length;R+=1){var N=D[R];v&&cl(t,v.text,M,N)||P(I,N)}else if("line-center"===A)for(var Z=0,z=e.geometry;Z<z.length;Z+=1){var F=z[Z];if(F.length>1){var B=Hu(F,S,n.vertical||v,r,24,g);B&&P(F,B)}}else if("Polygon"===e.type)for(var j=0,U=is(e.geometry,0);j<U.length;j+=1){var V=U[j],G=nl(V,16);P(V[0],new Nu(G.x,G.y,0))}else if("LineString"===e.type)for(var H=0,W=e.geometry;H<W.length;H+=1){var q=W[H];P(q,new Nu(q[0].x,q[0].y,0))}else if("Point"===e.type)for(var X=0,Y=e.geometry;X<Y.length;X+=1)for(var K=0,Q=Y[X];K<Q.length;K+=1){var J=Q[K];P([J],new Nu(J.x,J.y,0))}}(t,o,f,F,r,l,p,h,b,B,a)},_=0,x=t.features;_<x.length;_+=1)g();o&&t.generateCollisionDebugBuffers()},t.perspective=function(t,e,n,r,i){var o,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(t[10]=(i+r)*(o=1/(r-i)),t[14]=2*i*r*o):(t[10]=-1,t[14]=-2*r),t},t.pick=function(t,e){for(var n={},r=0;r<e.length;r++){var i=e[r];i in t&&(n[i]=t[i])}return n},t.plugin=si,t.polygonIntersectsPolygon=Ho,t.postMapLoadEvent=st,t.postTurnstileEvent=ot,t.potpack=gu,t.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.register=Fr,t.registerForPluginStateChange=function(t){return t({pluginStatus:ti,pluginURL:ei}),ii.on("pluginStateChange",t),t},t.renderColorRamp=wa,t.rotate=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+o*s,t[1]=i*u+a*s,t[2]=r*-s+o*u,t[3]=i*-s+a*u,t},t.rotateX=function(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[4],a=e[5],s=e[6],u=e[7],l=e[8],c=e[9],p=e[10],h=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+l*r,t[5]=a*i+c*r,t[6]=s*i+p*r,t[7]=u*i+h*r,t[8]=l*i-o*r,t[9]=c*i-a*r,t[10]=p*i-s*r,t[11]=h*i-u*r,t},t.rotateZ=function(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],l=e[4],c=e[5],p=e[6],h=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+l*r,t[1]=a*i+c*r,t[2]=s*i+p*r,t[3]=u*i+h*r,t[4]=l*i-o*r,t[5]=c*i-a*r,t[6]=p*i-s*r,t[7]=h*i-u*r,t},t.scale=function(t,e,n){var r=n[0],i=n[1],o=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.scale$1=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},t.scale$2=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},t.setCacheLimits=function(t,e){ut=t,lt=e},t.setRTLTextPlugin=function(t,e,n){if(void 0===n&&(n=!1),"deferred"===ti||"loading"===ti||"loaded"===ti)throw new Error("setRTLTextPlugin cannot be called multiple times.");ei=F.resolveURL(t),ti="deferred",$r=e,ri(),n||ai()},t.sphericalToCartesian=function(t){var e=t[0],n=t[1],r=t[2];return n+=90,n*=Math.PI/180,r*=Math.PI/180,{x:e*Math.cos(n)*Math.sin(r),y:e*Math.sin(n)*Math.sin(r),z:e*Math.cos(r)}},t.sqrLen=function(t){var e=t[0],n=t[1];return e*e+n*n},t.styleSpec=Pt,t.sub=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t},t.symbolSize=Bu,t.transformMat3=function(t,e,n){var r=e[0],i=e[1],o=e[2];return t[0]=r*n[0]+i*n[3]+o*n[6],t[1]=r*n[1]+i*n[4]+o*n[7],t[2]=r*n[2]+i*n[5]+o*n[8],t},t.transformMat4=ha,t.translate=function(t,e,n){var r,i,o,a,s,u,l,c,p,h,f,d,v=n[0],m=n[1],y=n[2];return e===t?(t[12]=e[0]*v+e[4]*m+e[8]*y+e[12],t[13]=e[1]*v+e[5]*m+e[9]*y+e[13],t[14]=e[2]*v+e[6]*m+e[10]*y+e[14],t[15]=e[3]*v+e[7]*m+e[11]*y+e[15]):(i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],p=e[8],h=e[9],f=e[10],d=e[11],t[0]=r=e[0],t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=l,t[7]=c,t[8]=p,t[9]=h,t[10]=f,t[11]=d,t[12]=r*v+s*m+p*y+e[12],t[13]=i*v+u*m+h*y+e[13],t[14]=o*v+l*m+f*y+e[14],t[15]=a*v+c*m+d*y+e[15]),t},t.triggerPluginCompletionEvent=ni,t.uniqueId=v,t.validateCustomStyleLayer=function(t){var e=[],n=t.id;return void 0===n&&e.push({message:"layers."+n+': missing required property "id"'}),void 0===t.render&&e.push({message:"layers."+n+': missing required method "render"'}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:"layers."+n+': property "renderingMode" must be either "2d" or "3d"'}),e},t.validateLight=Pr,t.validateStyle=kr,t.values=function(t){var e=[];for(var n in t)e.push(t[n]);return e},t.vectorTile=bs,t.version="1.13.2",t.warnOnce=E,t.webpSupported=j,t.window=s,t.wrap=h})),i(["./shared"],(function(t){function e(t){var n=typeof t;if("number"===n||"boolean"===n||"string"===n||null==t)return JSON.stringify(t);if(Array.isArray(t)){for(var r="[",i=0,o=t;i<o.length;i+=1)r+=e(o[i])+",";return r+"]"}for(var a=Object.keys(t).sort(),s="{",u=0;u<a.length;u++)s+=JSON.stringify(a[u])+":"+e(t[a[u]])+",";return s+"}"}function n(n){for(var r="",i=0,o=t.refProperties;i<o.length;i+=1)r+="/"+e(n[o[i]]);return r}var i=function(t){this.keyCache={},t&&this.replace(t)};i.prototype.replace=function(t){this._layerConfigs={},this._layers={},this.update(t,[])},i.prototype.update=function(e,r){for(var i=this,o=0,a=e;o<a.length;o+=1){var s=a[o];this._layerConfigs[s.id]=s;var u=this._layers[s.id]=t.createStyleLayer(s);u._featureFilter=t.featureFilter(u.filter),this.keyCache[s.id]&&delete this.keyCache[s.id]}for(var l=0,c=r;l<c.length;l+=1){var p=c[l];delete this.keyCache[p],delete this._layerConfigs[p],delete this._layers[p]}this.familiesBySource={};for(var h=0,f=function(t,e){for(var r={},i=0;i<t.length;i++){var o=e&&e[t[i].id]||n(t[i]);e&&(e[t[i].id]=o);var a=r[o];a||(a=r[o]=[]),a.push(t[i])}var s=[];for(var u in r)s.push(r[u]);return s}(t.values(this._layerConfigs),this.keyCache);h<f.length;h+=1){var d=f[h].map((function(t){return i._layers[t.id]})),v=d[0];if("none"!==v.visibility){var m=v.source||"",y=this.familiesBySource[m];y||(y=this.familiesBySource[m]={});var g=v.sourceLayer||"_geojsonTileLayer",_=y[g];_||(_=y[g]=[]),_.push(d)}}};var o=function(e){var n={},r=[];for(var i in e){var o=e[i],a=n[i]={};for(var s in o){var u=o[+s];if(u&&0!==u.bitmap.width&&0!==u.bitmap.height){var l={x:0,y:0,w:u.bitmap.width+2,h:u.bitmap.height+2};r.push(l),a[s]={rect:l,metrics:u.metrics}}}}var c=t.potpack(r),p=new t.AlphaImage({width:c.w||1,height:c.h||1});for(var h in e){var f=e[h];for(var d in f){var v=f[+d];if(v&&0!==v.bitmap.width&&0!==v.bitmap.height){var m=n[h][d].rect;t.AlphaImage.copy(v.bitmap,p,{x:0,y:0},{x:m.x+1,y:m.y+1},v.bitmap)}}}this.image=p,this.positions=n};t.register("GlyphAtlas",o);var a=function(e){this.tileID=new t.OverscaledTileID(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId};function s(e,n,r){for(var i=new t.EvaluationParameters(n),o=0,a=e;o<a.length;o+=1)a[o].recalculate(i,r)}function u(e,n){var r=t.getArrayBuffer(e.request,(function(e,r,i,o){e?n(e):r&&n(null,{vectorTile:new t.vectorTile.VectorTile(new t.pbf(r)),rawData:r,cacheControl:i,expires:o})}));return function(){r.cancel(),n()}}a.prototype.parse=function(e,n,r,i,a){var u=this;this.status="parsing",this.data=e,this.collisionBoxArray=new t.CollisionBoxArray;var l=new t.DictionaryCoder(Object.keys(e.layers).sort()),c=new t.FeatureIndex(this.tileID,this.promoteId);c.bucketLayerIDs=[];var p,h,f,d,v={},m={featureIndex:c,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:r},y=n.familiesBySource[this.source];for(var g in y){var _=e.layers[g];if(_){1===_.version&&t.warnOnce('Vector tile source "'+this.source+'" layer "'+g+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var x=l.encode(g),b=[],w=0;w<_.length;w++){var S=_.feature(w),E=c.getId(S,g);b.push({feature:S,id:E,index:w,sourceLayerIndex:x})}for(var C=0,T=y[g];C<T.length;C+=1){var A=T[C],M=A[0];M.minzoom&&this.zoom<Math.floor(M.minzoom)||M.maxzoom&&this.zoom>=M.maxzoom||"none"!==M.visibility&&(s(A,this.zoom,r),(v[M.id]=M.createBucket({index:c.bucketLayerIDs.length,layers:A,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:x,sourceID:this.source})).populate(b,m,this.tileID.canonical),c.bucketLayerIDs.push(A.map((function(t){return t.id}))))}}}var k=t.mapObject(m.glyphDependencies,(function(t){return Object.keys(t).map(Number)}));Object.keys(k).length?i.send("getGlyphs",{uid:this.uid,stacks:k},(function(t,e){p||(p=t,h=e,L.call(u))})):h={};var P=Object.keys(m.iconDependencies);P.length?i.send("getImages",{icons:P,source:this.source,tileID:this.tileID,type:"icons"},(function(t,e){p||(p=t,f=e,L.call(u))})):f={};var O=Object.keys(m.patternDependencies);function L(){if(p)return a(p);if(h&&f&&d){var e=new o(h),n=new t.ImageAtlas(f,d);for(var i in v){var u=v[i];u instanceof t.SymbolBucket?(s(u.layers,this.zoom,r),t.performSymbolLayout(u,h,e.positions,f,n.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):u.hasPattern&&(u instanceof t.LineBucket||u instanceof t.FillBucket||u instanceof t.FillExtrusionBucket)&&(s(u.layers,this.zoom,r),u.addFeatures(m,this.tileID.canonical,n.patternPositions))}this.status="done",a(null,{buckets:t.values(v).filter((function(t){return!t.isEmpty()})),featureIndex:c,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,imageAtlas:n,glyphMap:this.returnDependencies?h:null,iconMap:this.returnDependencies?f:null,glyphPositions:this.returnDependencies?e.positions:null})}}O.length?i.send("getImages",{icons:O,source:this.source,tileID:this.tileID,type:"patterns"},(function(t,e){p||(p=t,d=e,L.call(u))})):d={},L.call(this)};var l=function(t,e,n,r){this.actor=t,this.layerIndex=e,this.availableImages=n,this.loadVectorData=r||u,this.loading={},this.loaded={}};l.prototype.loadTile=function(e,n){var r=this,i=e.uid;this.loading||(this.loading={});var o=!!(e&&e.request&&e.request.collectResourceTiming)&&new t.RequestPerformance(e.request),s=this.loading[i]=new a(e);s.abort=this.loadVectorData(e,(function(e,a){if(delete r.loading[i],e||!a)return s.status="done",r.loaded[i]=s,n(e);var u=a.rawData,l={};a.expires&&(l.expires=a.expires),a.cacheControl&&(l.cacheControl=a.cacheControl);var c={};if(o){var p=o.finish();p&&(c.resourceTiming=JSON.parse(JSON.stringify(p)))}s.vectorTile=a.vectorTile,s.parse(a.vectorTile,r.layerIndex,r.availableImages,r.actor,(function(e,r){if(e||!r)return n(e);n(null,t.extend({rawTileData:u.slice(0)},r,l,c))})),r.loaded=r.loaded||{},r.loaded[i]=s}))},l.prototype.reloadTile=function(t,e){var n=this,r=this.loaded,i=t.uid,o=this;if(r&&r[i]){var a=r[i];a.showCollisionBoxes=t.showCollisionBoxes;var s=function(t,r){var i=a.reloadCallback;i&&(delete a.reloadCallback,a.parse(a.vectorTile,o.layerIndex,n.availableImages,o.actor,i)),e(t,r)};"parsing"===a.status?a.reloadCallback=s:"done"===a.status&&(a.vectorTile?a.parse(a.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}},l.prototype.abortTile=function(t,e){var n=this.loading,r=t.uid;n&&n[r]&&n[r].abort&&(n[r].abort(),delete n[r]),e()},l.prototype.removeTile=function(t,e){var n=this.loaded,r=t.uid;n&&n[r]&&delete n[r],e()};var c=t.window.ImageBitmap,p=function(){this.loaded={}};function h(t,e){if(0!==t.length){f(t[0],e);for(var n=1;n<t.length;n++)f(t[n],!e)}}function f(t,e){for(var n=0,r=0,i=t.length,o=i-1;r<i;o=r++)n+=(t[r][0]-t[o][0])*(t[o][1]+t[r][1]);n>=0!=!!e&&t.reverse()}p.prototype.loadTile=function(e,n){var r=e.uid,i=e.encoding,o=e.rawImageData,a=c&&o instanceof c?this.getImageData(o):o,s=new t.DEMData(r,a,i);this.loaded=this.loaded||{},this.loaded[r]=s,n(null,s)},p.prototype.getImageData=function(e){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);var n=this.offscreenCanvasContext.getImageData(-1,-1,e.width+2,e.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new t.RGBAImage({width:n.width,height:n.height},n.data)},p.prototype.removeTile=function(t){var e=this.loaded,n=t.uid;e&&e[n]&&delete e[n]};var d=t.vectorTile.VectorTileFeature.prototype.toGeoJSON,v=function(e){this._feature=e,this.extent=t.EXTENT,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))};v.prototype.loadGeometry=function(){if(1===this._feature.type){for(var e=[],n=0,r=this._feature.geometry;n<r.length;n+=1){var i=r[n];e.push([new t.Point$1(i[0],i[1])])}return e}for(var o=[],a=0,s=this._feature.geometry;a<s.length;a+=1){for(var u=[],l=0,c=s[a];l<c.length;l+=1){var p=c[l];u.push(new t.Point$1(p[0],p[1]))}o.push(u)}return o},v.prototype.toGeoJSON=function(t,e,n){return d.call(this,t,e,n)};var m=function(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.EXTENT,this.length=e.length,this._features=e};m.prototype.feature=function(t){return new v(this._features[t])};var y=t.vectorTile.VectorTileFeature,g=_;function _(t,e){this.options=e||{},this.features=t,this.length=t.length}function x(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}_.prototype.feature=function(t){return new x(this.features[t],this.options.extent)},x.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var n=0;n<e.length;n++){for(var r=e[n],i=[],o=0;o<r.length;o++)i.push(new t.Point$1(r[o][0],r[o][1]));this.geometry.push(i)}return this.geometry},x.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,n=-1/0,r=1/0,i=-1/0,o=0;o<t.length;o++)for(var a=t[o],s=0;s<a.length;s++){var u=a[s];e=Math.min(e,u.x),n=Math.max(n,u.x),r=Math.min(r,u.y),i=Math.max(i,u.y)}return[e,r,n,i]},x.prototype.toGeoJSON=y.prototype.toGeoJSON;var b=S,w=g;function S(e){var n=new t.pbf;return function(t,e){for(var n in t.layers)e.writeMessage(3,E,t.layers[n])}(e,n),n.finish()}function E(t,e){var n;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var r={keys:[],values:[],keycache:{},valuecache:{}};for(n=0;n<t.length;n++)r.feature=t.feature(n),e.writeMessage(2,C,r);var i=r.keys;for(n=0;n<i.length;n++)e.writeStringField(3,i[n]);var o=r.values;for(n=0;n<o.length;n++)e.writeMessage(4,P,o[n])}function C(t,e){var n=t.feature;void 0!==n.id&&e.writeVarintField(1,n.id),e.writeMessage(2,T,t),e.writeVarintField(3,n.type),e.writeMessage(4,k,n)}function T(t,e){var n=t.feature,r=t.keys,i=t.values,o=t.keycache,a=t.valuecache;for(var s in n.properties){var u=o[s];void 0===u&&(r.push(s),o[s]=u=r.length-1),e.writeVarint(u);var l=n.properties[s],c=typeof l;"string"!==c&&"boolean"!==c&&"number"!==c&&(l=JSON.stringify(l));var p=c+":"+l,h=a[p];void 0===h&&(i.push(l),a[p]=h=i.length-1),e.writeVarint(h)}}function A(t,e){return(e<<3)+(7&t)}function M(t){return t<<1^t>>31}function k(t,e){for(var n=t.loadGeometry(),r=t.type,i=0,o=0,a=n.length,s=0;s<a;s++){var u=n[s],l=1;1===r&&(l=u.length),e.writeVarint(A(1,l));for(var c=3===r?u.length-1:u.length,p=0;p<c;p++){1===p&&1!==r&&e.writeVarint(A(2,c-1));var h=u[p].x-i,f=u[p].y-o;e.writeVarint(M(h)),e.writeVarint(M(f)),i+=h,o+=f}3===r&&e.writeVarint(A(7,1))}}function P(t,e){var n=typeof t;"string"===n?e.writeStringField(1,t):"boolean"===n?e.writeBooleanField(7,t):"number"===n&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}function O(t,e,n,r){L(t,n,r),L(e,2*n,2*r),L(e,2*n+1,2*r+1)}function L(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function I(t,e,n,r){var i=t-n,o=e-r;return i*i+o*o}b.fromVectorTileJs=S,b.fromGeojsonVt=function(t,e){e=e||{};var n={};for(var r in t)n[r]=new g(t[r].features,e),n[r].name=r,n[r].version=e.version,n[r].extent=e.extent;return S({layers:n})},b.GeoJSONWrapper=w;var R=function(t){return t[0]},D=function(t){return t[1]},N=function(t,e,n,r,i){void 0===e&&(e=R),void 0===n&&(n=D),void 0===r&&(r=64),void 0===i&&(i=Float64Array),this.nodeSize=r,this.points=t;for(var o=t.length<65536?Uint16Array:Uint32Array,a=this.ids=new o(t.length),s=this.coords=new i(2*t.length),u=0;u<t.length;u++)a[u]=u,s[2*u]=e(t[u]),s[2*u+1]=n(t[u]);!function t(e,n,r,i,o,a){if(!(o-i<=r)){var s=i+o>>1;!function t(e,n,r,i,o,a){for(;o>i;){if(o-i>600){var s=o-i+1,u=r-i+1,l=Math.log(s),c=.5*Math.exp(2*l/3),p=.5*Math.sqrt(l*c*(s-c)/s)*(u-s/2<0?-1:1);t(e,n,r,Math.max(i,Math.floor(r-u*c/s+p)),Math.min(o,Math.floor(r+(s-u)*c/s+p)),a)}var h=n[2*r+a],f=i,d=o;for(O(e,n,i,r),n[2*o+a]>h&&O(e,n,i,o);f<d;){for(O(e,n,f,d),f++,d--;n[2*f+a]<h;)f++;for(;n[2*d+a]>h;)d--}n[2*i+a]===h?O(e,n,i,d):O(e,n,++d,o),d<=r&&(i=d+1),r<=d&&(o=d-1)}}(e,n,s,i,o,a%2),t(e,n,r,i,s-1,a+1),t(e,n,r,s+1,o,a+1)}}(a,s,r,0,a.length-1,0)};N.prototype.range=function(t,e,n,r){return function(t,e,n,r,i,o,a){for(var s,u,l=[0,t.length-1,0],c=[];l.length;){var p=l.pop(),h=l.pop(),f=l.pop();if(h-f<=a)for(var d=f;d<=h;d++)u=e[2*d+1],(s=e[2*d])>=n&&s<=i&&u>=r&&u<=o&&c.push(t[d]);else{var v=Math.floor((f+h)/2);u=e[2*v+1],(s=e[2*v])>=n&&s<=i&&u>=r&&u<=o&&c.push(t[v]);var m=(p+1)%2;(0===p?n<=s:r<=u)&&(l.push(f),l.push(v-1),l.push(m)),(0===p?i>=s:o>=u)&&(l.push(v+1),l.push(h),l.push(m))}}return c}(this.ids,this.coords,t,e,n,r,this.nodeSize)},N.prototype.within=function(t,e,n){return function(t,e,n,r,i,o){for(var a=[0,t.length-1,0],s=[],u=i*i;a.length;){var l=a.pop(),c=a.pop(),p=a.pop();if(c-p<=o)for(var h=p;h<=c;h++)I(e[2*h],e[2*h+1],n,r)<=u&&s.push(t[h]);else{var f=Math.floor((p+c)/2),d=e[2*f],v=e[2*f+1];I(d,v,n,r)<=u&&s.push(t[f]);var m=(l+1)%2;(0===l?n-i<=d:r-i<=v)&&(a.push(p),a.push(f-1),a.push(m)),(0===l?n+i>=d:r+i>=v)&&(a.push(f+1),a.push(c),a.push(m))}}return s}(this.ids,this.coords,t,e,n,this.nodeSize)};var Z={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(t){return t}},z=function(t){this.options=H(Object.create(Z),t),this.trees=new Array(this.options.maxZoom+1)};function F(t,e,n,r,i){return{x:t,y:e,zoom:1/0,id:n,parentId:-1,numPoints:r,properties:i}}function B(t,e){var n=t.geometry.coordinates,r=n[1];return{x:V(n[0]),y:G(r),zoom:1/0,index:e,parentId:-1}}function j(t){return{type:"Feature",id:t.id,properties:U(t),geometry:{type:"Point",coordinates:[(r=t.x,360*(r-.5)),(e=t.y,n=(180-360*e)*Math.PI/180,360*Math.atan(Math.exp(n))/Math.PI-90)]}};var e,n,r}function U(t){var e=t.numPoints,n=e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e;return H(H({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:n})}function V(t){return t/360+.5}function G(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function H(t,e){for(var n in e)t[n]=e[n];return t}function W(t){return t.x}function q(t){return t.y}function X(t,e,n,r,i,o){var a=i-n,s=o-r;if(0!==a||0!==s){var u=((t-n)*a+(e-r)*s)/(a*a+s*s);u>1?(n=i,r=o):u>0&&(n+=a*u,r+=s*u)}return(a=t-n)*a+(s=e-r)*s}function Y(t,e,n,r){var i={id:void 0===t?null:t,type:e,geometry:n,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,n=t.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)K(t,e);else if("Polygon"===n||"MultiLineString"===n)for(var r=0;r<e.length;r++)K(t,e[r]);else if("MultiPolygon"===n)for(r=0;r<e.length;r++)for(var i=0;i<e[r].length;i++)K(t,e[r][i])}(i),i}function K(t,e){for(var n=0;n<e.length;n+=3)t.minX=Math.min(t.minX,e[n]),t.minY=Math.min(t.minY,e[n+1]),t.maxX=Math.max(t.maxX,e[n]),t.maxY=Math.max(t.maxY,e[n+1])}function Q(t,e,n,r){if(e.geometry){var i=e.geometry.coordinates,o=e.geometry.type,a=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),s=[],u=e.id;if(n.promoteId?u=e.properties[n.promoteId]:n.generateId&&(u=r||0),"Point"===o)J(i,s);else if("MultiPoint"===o)for(var l=0;l<i.length;l++)J(i[l],s);else if("LineString"===o)$(i,s,a,!1);else if("MultiLineString"===o){if(n.lineMetrics){for(l=0;l<i.length;l++)$(i[l],s=[],a,!1),t.push(Y(u,"LineString",s,e.properties));return}tt(i,s,a,!1)}else if("Polygon"===o)tt(i,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(l=0;l<e.geometry.geometries.length;l++)Q(t,{id:u,geometry:e.geometry.geometries[l],properties:e.properties},n,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(l=0;l<i.length;l++){var c=[];tt(i[l],c,a,!0),s.push(c)}}t.push(Y(u,o,s,e.properties))}}function J(t,e){e.push(et(t[0])),e.push(nt(t[1])),e.push(0)}function $(t,e,n,r){for(var i,o,a=0,s=0;s<t.length;s++){var u=et(t[s][0]),l=nt(t[s][1]);e.push(u),e.push(l),e.push(0),s>0&&(a+=r?(i*l-u*o)/2:Math.sqrt(Math.pow(u-i,2)+Math.pow(l-o,2))),i=u,o=l}var c=e.length-3;e[2]=1,function t(e,n,r,i){for(var o,a=i,s=r-n>>1,u=r-n,l=e[n],c=e[n+1],p=e[r],h=e[r+1],f=n+3;f<r;f+=3){var d=X(e[f],e[f+1],l,c,p,h);if(d>a)o=f,a=d;else if(d===a){var v=Math.abs(f-s);v<u&&(o=f,u=v)}}a>i&&(o-n>3&&t(e,n,o,i),e[o+2]=a,r-o>3&&t(e,o,r,i))}(e,0,c,n),e[c+2]=1,e.size=Math.abs(a),e.start=0,e.end=e.size}function tt(t,e,n,r){for(var i=0;i<t.length;i++){var o=[];$(t[i],o,n,r),e.push(o)}}function et(t){return t/360+.5}function nt(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function rt(t,e,n,r,i,o,a,s){if(r/=e,o>=(n/=e)&&a<r)return t;if(a<n||o>=r)return null;for(var u=[],l=0;l<t.length;l++){var c=t[l],p=c.geometry,h=c.type,f=0===i?c.minX:c.minY,d=0===i?c.maxX:c.maxY;if(f>=n&&d<r)u.push(c);else if(!(d<n||f>=r)){var v=[];if("Point"===h||"MultiPoint"===h)it(p,v,n,r,i);else if("LineString"===h)ot(p,v,n,r,i,!1,s.lineMetrics);else if("MultiLineString"===h)st(p,v,n,r,i,!1);else if("Polygon"===h)st(p,v,n,r,i,!0);else if("MultiPolygon"===h)for(var m=0;m<p.length;m++){var y=[];st(p[m],y,n,r,i,!0),y.length&&v.push(y)}if(v.length){if(s.lineMetrics&&"LineString"===h){for(m=0;m<v.length;m++)u.push(Y(c.id,h,v[m],c.tags));continue}"LineString"!==h&&"MultiLineString"!==h||(1===v.length?(h="LineString",v=v[0]):h="MultiLineString"),"Point"!==h&&"MultiPoint"!==h||(h=3===v.length?"Point":"MultiPoint"),u.push(Y(c.id,h,v,c.tags))}}}return u.length?u:null}function it(t,e,n,r,i){for(var o=0;o<t.length;o+=3){var a=t[o+i];a>=n&&a<=r&&(e.push(t[o]),e.push(t[o+1]),e.push(t[o+2]))}}function ot(t,e,n,r,i,o,a){for(var s,u,l=at(t),c=0===i?lt:ct,p=t.start,h=0;h<t.length-3;h+=3){var f=t[h],d=t[h+1],v=t[h+2],m=t[h+3],y=t[h+4],g=0===i?f:d,_=0===i?m:y,x=!1;a&&(s=Math.sqrt(Math.pow(f-m,2)+Math.pow(d-y,2))),g<n?_>n&&(u=c(l,f,d,m,y,n),a&&(l.start=p+s*u)):g>r?_<r&&(u=c(l,f,d,m,y,r),a&&(l.start=p+s*u)):ut(l,f,d,v),_<n&&g>=n&&(u=c(l,f,d,m,y,n),x=!0),_>r&&g<=r&&(u=c(l,f,d,m,y,r),x=!0),!o&&x&&(a&&(l.end=p+s*u),e.push(l),l=at(t)),a&&(p+=s)}var b=t.length-3;f=t[b],d=t[b+1],v=t[b+2],(g=0===i?f:d)>=n&&g<=r&&ut(l,f,d,v),b=l.length-3,o&&b>=3&&(l[b]!==l[0]||l[b+1]!==l[1])&&ut(l,l[0],l[1],l[2]),l.length&&e.push(l)}function at(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function st(t,e,n,r,i,o){for(var a=0;a<t.length;a++)ot(t[a],e,n,r,i,o,!1)}function ut(t,e,n,r){t.push(e),t.push(n),t.push(r)}function lt(t,e,n,r,i,o){var a=(o-e)/(r-e);return t.push(o),t.push(n+(i-n)*a),t.push(1),a}function ct(t,e,n,r,i,o){var a=(o-n)/(i-n);return t.push(e+(r-e)*a),t.push(o),t.push(1),a}function pt(t,e){for(var n=[],r=0;r<t.length;r++){var i,o=t[r],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)i=ht(o.geometry,e);else if("MultiLineString"===a||"Polygon"===a){i=[];for(var s=0;s<o.geometry.length;s++)i.push(ht(o.geometry[s],e))}else if("MultiPolygon"===a)for(i=[],s=0;s<o.geometry.length;s++){for(var u=[],l=0;l<o.geometry[s].length;l++)u.push(ht(o.geometry[s][l],e));i.push(u)}n.push(Y(o.id,a,i,o.tags))}return n}function ht(t,e){var n=[];n.size=t.size,void 0!==t.start&&(n.start=t.start,n.end=t.end);for(var r=0;r<t.length;r+=3)n.push(t[r]+e,t[r+1],t[r+2]);return n}function ft(t,e){if(t.transformed)return t;var n,r,i,o=1<<t.z,a=t.x,s=t.y;for(n=0;n<t.features.length;n++){var u=t.features[n],l=u.geometry,c=u.type;if(u.geometry=[],1===c)for(r=0;r<l.length;r+=2)u.geometry.push(dt(l[r],l[r+1],e,o,a,s));else for(r=0;r<l.length;r++){var p=[];for(i=0;i<l[r].length;i+=2)p.push(dt(l[r][i],l[r][i+1],e,o,a,s));u.geometry.push(p)}}return t.transformed=!0,t}function dt(t,e,n,r,i,o){return[Math.round(n*(t*r-i)),Math.round(n*(e*r-o))]}function vt(t,e,n,r,i){for(var o=e===i.maxZoom?0:i.tolerance/((1<<e)*i.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:r,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<t.length;s++){a.numFeatures++,mt(a,t[s],o,i);var u=t[s].minX,l=t[s].minY,c=t[s].maxX,p=t[s].maxY;u<a.minX&&(a.minX=u),l<a.minY&&(a.minY=l),c>a.maxX&&(a.maxX=c),p>a.maxY&&(a.maxY=p)}return a}function mt(t,e,n,r){var i=e.geometry,o=e.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<i.length;s+=3)a.push(i[s]),a.push(i[s+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)yt(a,i,t,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<i.length;s++)yt(a,i[s],t,n,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var u=0;u<i.length;u++){var l=i[u];for(s=0;s<l.length;s++)yt(a,l[s],t,n,!0,0===s)}if(a.length){var c=e.tags||null;if("LineString"===o&&r.lineMetrics){for(var p in c={},e.tags)c[p]=e.tags[p];c.mapbox_clip_start=i.start/i.size,c.mapbox_clip_end=i.end/i.size}var h={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:c};null!==e.id&&(h.id=e.id),t.features.push(h)}}function yt(t,e,n,r,i,o){var a=r*r;if(r>0&&e.size<(i?a:r))n.numPoints+=e.length/3;else{for(var s=[],u=0;u<e.length;u+=3)(0===r||e[u+2]>a)&&(n.numSimplified++,s.push(e[u]),s.push(e[u+1])),n.numPoints++;i&&function(t,e){for(var n=0,r=0,i=t.length,o=i-2;r<i;o=r,r+=2)n+=(t[r]-t[o])*(t[r+1]+t[o+1]);if(n>0===e)for(r=0,i=t.length;r<i/2;r+=2){var a=t[r],s=t[r+1];t[r]=t[i-2-r],t[r+1]=t[i-1-r],t[i-2-r]=a,t[i-1-r]=s}}(s,o),t.push(s)}}function gt(t,e){var n=(e=this.options=function(t,e){for(var n in e)t[n]=e[n];return t}(Object.create(this.options),e)).debug;if(n&&r.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var i=function(t,e){var n=[];if("FeatureCollection"===t.type)for(var r=0;r<t.features.length;r++)Q(n,t.features[r],e,r);else Q(n,"Feature"===t.type?t:{geometry:t},e);return n}(t,e);this.tiles={},this.tileCoords=[],n&&(r.timeEnd("preprocess data"),r.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),r.time("generate tiles"),this.stats={},this.total=0),(i=function(t,e){var n=e.buffer/e.extent,r=t,i=rt(t,1,-1-n,n,0,-1,2,e),o=rt(t,1,1-n,2+n,0,-1,2,e);return(i||o)&&(r=rt(t,1,-n,1+n,0,-1,2,e)||[],i&&(r=pt(i,1).concat(r)),o&&(r=r.concat(pt(o,-1)))),r}(i,e)).length&&this.splitTile(i,0,0,0),n&&(i.length&&r.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),r.timeEnd("generate tiles"),r.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function _t(t,e,n){return 32*((1<<t)*n+e)+t}function xt(t,e){var n=t.tileID.canonical;if(!this._geoJSONIndex)return e(null,null);var r=this._geoJSONIndex.getTile(n.z,n.x,n.y);if(!r)return e(null,null);var i=new m(r.features),o=b(i);0===o.byteOffset&&o.byteLength===o.buffer.byteLength||(o=new Uint8Array(o)),e(null,{vectorTile:i,rawData:o.buffer})}z.prototype.load=function(t){var e=this.options,n=e.log,i=e.minZoom,o=e.maxZoom,a=e.nodeSize;n&&r.time("total time");var s="prepare "+t.length+" points";n&&r.time(s),this.points=t;for(var u=[],l=0;l<t.length;l++)t[l].geometry&&u.push(B(t[l],l));this.trees[o+1]=new N(u,W,q,a,Float32Array),n&&r.timeEnd(s);for(var c=o;c>=i;c--){var p=+Date.now();u=this._cluster(u,c),this.trees[c]=new N(u,W,q,a,Float32Array),n&&r.log("z%d: %d clusters in %dms",c,u.length,+Date.now()-p)}return n&&r.timeEnd("total time"),this},z.prototype.getClusters=function(t,e){var n=((t[0]+180)%360+360)%360-180,r=Math.max(-90,Math.min(90,t[1])),i=180===t[2]?180:((t[2]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)n=-180,i=180;else if(n>i){var a=this.getClusters([n,r,180,o],e),s=this.getClusters([-180,r,i,o],e);return a.concat(s)}for(var u=this.trees[this._limitZoom(e)],l=[],c=0,p=u.range(V(n),G(o),V(i),G(r));c<p.length;c+=1){var h=u.points[p[c]];l.push(h.numPoints?j(h):this.points[h.index])}return l},z.prototype.getChildren=function(t){var e=this._getOriginId(t),n=this._getOriginZoom(t),r="No cluster with the specified id.",i=this.trees[n];if(!i)throw new Error(r);var o=i.points[e];if(!o)throw new Error(r);for(var a=this.options.radius/(this.options.extent*Math.pow(2,n-1)),s=[],u=0,l=i.within(o.x,o.y,a);u<l.length;u+=1){var c=i.points[l[u]];c.parentId===t&&s.push(c.numPoints?j(c):this.points[c.index])}if(0===s.length)throw new Error(r);return s},z.prototype.getLeaves=function(t,e,n){var r=[];return this._appendLeaves(r,t,e=e||10,n=n||0,0),r},z.prototype.getTile=function(t,e,n){var r=this.trees[this._limitZoom(t)],i=Math.pow(2,t),o=this.options,a=o.radius/o.extent,s=(n-a)/i,u=(n+1+a)/i,l={features:[]};return this._addTileFeatures(r.range((e-a)/i,s,(e+1+a)/i,u),r.points,e,n,i,l),0===e&&this._addTileFeatures(r.range(1-a/i,s,1,u),r.points,i,n,i,l),e===i-1&&this._addTileFeatures(r.range(0,s,a/i,u),r.points,-1,n,i,l),l.features.length?l:null},z.prototype.getClusterExpansionZoom=function(t){for(var e=this._getOriginZoom(t)-1;e<=this.options.maxZoom;){var n=this.getChildren(t);if(e++,1!==n.length)break;t=n[0].properties.cluster_id}return e},z.prototype._appendLeaves=function(t,e,n,r,i){for(var o=0,a=this.getChildren(e);o<a.length;o+=1){var s=a[o],u=s.properties;if(u&&u.cluster?i+u.point_count<=r?i+=u.point_count:i=this._appendLeaves(t,u.cluster_id,n,r,i):i<r?i++:t.push(s),t.length===n)break}return i},z.prototype._addTileFeatures=function(t,e,n,r,i,o){for(var a=0,s=t;a<s.length;a+=1){var u=e[s[a]],l=u.numPoints,c={type:1,geometry:[[Math.round(this.options.extent*(u.x*i-n)),Math.round(this.options.extent*(u.y*i-r))]],tags:l?U(u):this.points[u.index].properties},p=void 0;l?p=u.id:this.options.generateId?p=u.index:this.points[u.index].id&&(p=this.points[u.index].id),void 0!==p&&(c.id=p),o.features.push(c)}},z.prototype._limitZoom=function(t){return Math.max(this.options.minZoom,Math.min(+t,this.options.maxZoom+1))},z.prototype._cluster=function(t,e){for(var n=[],r=this.options,i=r.reduce,o=r.minPoints,a=r.radius/(r.extent*Math.pow(2,e)),s=0;s<t.length;s++){var u=t[s];if(!(u.zoom<=e)){u.zoom=e;for(var l=this.trees[e+1],c=l.within(u.x,u.y,a),p=u.numPoints||1,h=p,f=0,d=c;f<d.length;f+=1){var v=l.points[d[f]];v.zoom>e&&(h+=v.numPoints||1)}if(h>=o){for(var m=u.x*p,y=u.y*p,g=i&&p>1?this._map(u,!0):null,_=(s<<5)+(e+1)+this.points.length,x=0,b=c;x<b.length;x+=1){var w=l.points[b[x]];if(!(w.zoom<=e)){w.zoom=e;var S=w.numPoints||1;m+=w.x*S,y+=w.y*S,w.parentId=_,i&&(g||(g=this._map(u,!0)),i(g,this._map(w)))}}u.parentId=_,n.push(F(m/h,y/h,_,h,g))}else if(n.push(u),h>1)for(var E=0,C=c;E<C.length;E+=1){var T=l.points[C[E]];T.zoom<=e||(T.zoom=e,n.push(T))}}}return n},z.prototype._getOriginId=function(t){return t-this.points.length>>5},z.prototype._getOriginZoom=function(t){return(t-this.points.length)%32},z.prototype._map=function(t,e){if(t.numPoints)return e?H({},t.properties):t.properties;var n=this.points[t.index].properties,r=this.options.map(n);return e&&r===n?H({},r):r},gt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},gt.prototype.splitTile=function(t,e,n,i,o,a,s){for(var u=[t,e,n,i],l=this.options,c=l.debug;u.length;){i=u.pop(),n=u.pop(),e=u.pop(),t=u.pop();var p=1<<e,h=_t(e,n,i),f=this.tiles[h];if(!f&&(c>1&&r.time("creation"),f=this.tiles[h]=vt(t,e,n,i,l),this.tileCoords.push({z:e,x:n,y:i}),c)){c>1&&(r.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,n,i,f.numFeatures,f.numPoints,f.numSimplified),r.timeEnd("creation"));var d="z"+e;this.stats[d]=(this.stats[d]||0)+1,this.total++}if(f.source=t,o){if(e===l.maxZoom||e===o)continue;var v=1<<o-e;if(n!==Math.floor(a/v)||i!==Math.floor(s/v))continue}else if(e===l.indexMaxZoom||f.numPoints<=l.indexMaxPoints)continue;if(f.source=null,0!==t.length){c>1&&r.time("clipping");var m,y,g,_,x,b,w=.5*l.buffer/l.extent,S=.5-w,E=.5+w,C=1+w;m=y=g=_=null,x=rt(t,p,n-w,n+E,0,f.minX,f.maxX,l),b=rt(t,p,n+S,n+C,0,f.minX,f.maxX,l),t=null,x&&(m=rt(x,p,i-w,i+E,1,f.minY,f.maxY,l),y=rt(x,p,i+S,i+C,1,f.minY,f.maxY,l),x=null),b&&(g=rt(b,p,i-w,i+E,1,f.minY,f.maxY,l),_=rt(b,p,i+S,i+C,1,f.minY,f.maxY,l),b=null),c>1&&r.timeEnd("clipping"),u.push(m||[],e+1,2*n,2*i),u.push(y||[],e+1,2*n,2*i+1),u.push(g||[],e+1,2*n+1,2*i),u.push(_||[],e+1,2*n+1,2*i+1)}}},gt.prototype.getTile=function(t,e,n){var i=this.options,o=i.extent,a=i.debug;if(t<0||t>24)return null;var s=1<<t,u=_t(t,e=(e%s+s)%s,n);if(this.tiles[u])return ft(this.tiles[u],o);a>1&&r.log("drilling down to z%d-%d-%d",t,e,n);for(var l,c=t,p=e,h=n;!l&&c>0;)c--,p=Math.floor(p/2),h=Math.floor(h/2),l=this.tiles[_t(c,p,h)];return l&&l.source?(a>1&&r.log("found parent tile z%d-%d-%d",c,p,h),a>1&&r.time("drilling down"),this.splitTile(l.source,c,p,h,t,e,n),a>1&&r.timeEnd("drilling down"),this.tiles[u]?ft(this.tiles[u],o):null):null};var bt=function(e){function n(t,n,r,i){e.call(this,t,n,r,xt),i&&(this.loadGeoJSON=i)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.loadData=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=e,this._pendingLoadDataParams=t,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},n.prototype._loadData=function(){var e=this;if(this._pendingCallback&&this._pendingLoadDataParams){var n=this._pendingCallback,r=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var i=!!(r&&r.request&&r.request.collectResourceTiming)&&new t.RequestPerformance(r.request);this.loadGeoJSON(r,(function(o,a){if(o||!a)return n(o);if("object"!=typeof a)return n(new Error("Input data given to '"+r.source+"' is not a valid GeoJSON object."));!function t(e,n){var r,i=e&&e.type;if("FeatureCollection"===i)for(r=0;r<e.features.length;r++)t(e.features[r],n);else if("GeometryCollection"===i)for(r=0;r<e.geometries.length;r++)t(e.geometries[r],n);else if("Feature"===i)t(e.geometry,n);else if("Polygon"===i)h(e.coordinates,n);else if("MultiPolygon"===i)for(r=0;r<e.coordinates.length;r++)h(e.coordinates[r],n);return e}(a,!0);try{if(r.filter){var s=t.createExpression(r.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===s.result)throw new Error(s.value.map((function(t){return t.key+": "+t.message})).join(", "));var u=a.features.filter((function(t){return s.value.evaluate({zoom:0},t)}));a={type:"FeatureCollection",features:u}}e._geoJSONIndex=r.cluster?new z(function(e){var n=e.superclusterOptions,r=e.clusterProperties;if(!r||!n)return n;for(var i={},o={},a={accumulated:null,zoom:0},s={properties:null},u=Object.keys(r),l=0,c=u;l<c.length;l+=1){var p=c[l],h=r[p],f=h[0],d=t.createExpression(h[1]),v=t.createExpression("string"==typeof f?[f,["accumulated"],["get",p]]:f);i[p]=d.value,o[p]=v.value}return n.map=function(t){s.properties=t;for(var e={},n=0,r=u;n<r.length;n+=1){var o=r[n];e[o]=i[o].evaluate(a,s)}return e},n.reduce=function(t,e){s.properties=e;for(var n=0,r=u;n<r.length;n+=1){var i=r[n];a.accumulated=t[i],t[i]=o[i].evaluate(a,s)}},n}(r)).load(a.features):function(t,e){return new gt(t,e)}(a,r.geojsonVtOptions)}catch(o){return n(o)}e.loaded={};var l={};if(i){var c=i.finish();c&&(l.resourceTiming={},l.resourceTiming[r.source]=JSON.parse(JSON.stringify(c)))}n(null,l)}))}},n.prototype.coalesce=function(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData())},n.prototype.reloadTile=function(t,n){var r=this.loaded;return r&&r[t.uid]?e.prototype.reloadTile.call(this,t,n):this.loadTile(t,n)},n.prototype.loadGeoJSON=function(e,n){if(e.request)t.getJSON(e.request,n);else{if("string"!=typeof e.data)return n(new Error("Input data given to '"+e.source+"' is not a valid GeoJSON object."));try{return n(null,JSON.parse(e.data))}catch(t){return n(new Error("Input data given to '"+e.source+"' is not a valid GeoJSON object."))}}},n.prototype.removeSource=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),e()},n.prototype.getClusterExpansionZoom=function(t,e){try{e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId))}catch(t){e(t)}},n.prototype.getClusterChildren=function(t,e){try{e(null,this._geoJSONIndex.getChildren(t.clusterId))}catch(t){e(t)}},n.prototype.getClusterLeaves=function(t,e){try{e(null,this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset))}catch(t){e(t)}},n}(l),wt=function(e){var n=this;this.self=e,this.actor=new t.Actor(e,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:l,geojson:bt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(t,e){if(n.workerSourceTypes[t])throw new Error('Worker source with name "'+t+'" already registered.');n.workerSourceTypes[t]=e},this.self.registerRTLTextPlugin=function(e){if(t.plugin.isParsed())throw new Error("RTL text plugin already registered.");t.plugin.applyArabicShaping=e.applyArabicShaping,t.plugin.processBidirectionalText=e.processBidirectionalText,t.plugin.processStyledBidirectionalText=e.processStyledBidirectionalText}};return wt.prototype.setReferrer=function(t,e){this.referrer=e},wt.prototype.setImages=function(t,e,n){for(var r in this.availableImages[t]=e,this.workerSources[t]){var i=this.workerSources[t][r];for(var o in i)i[o].availableImages=e}n()},wt.prototype.setLayers=function(t,e,n){this.getLayerIndex(t).replace(e),n()},wt.prototype.updateLayers=function(t,e,n){this.getLayerIndex(t).update(e.layers,e.removedIds),n()},wt.prototype.loadTile=function(t,e,n){this.getWorkerSource(t,e.type,e.source).loadTile(e,n)},wt.prototype.loadDEMTile=function(t,e,n){this.getDEMWorkerSource(t,e.source).loadTile(e,n)},wt.prototype.reloadTile=function(t,e,n){this.getWorkerSource(t,e.type,e.source).reloadTile(e,n)},wt.prototype.abortTile=function(t,e,n){this.getWorkerSource(t,e.type,e.source).abortTile(e,n)},wt.prototype.removeTile=function(t,e,n){this.getWorkerSource(t,e.type,e.source).removeTile(e,n)},wt.prototype.removeDEMTile=function(t,e){this.getDEMWorkerSource(t,e.source).removeTile(e)},wt.prototype.removeSource=function(t,e,n){if(this.workerSources[t]&&this.workerSources[t][e.type]&&this.workerSources[t][e.type][e.source]){var r=this.workerSources[t][e.type][e.source];delete this.workerSources[t][e.type][e.source],void 0!==r.removeSource?r.removeSource(e,n):n()}},wt.prototype.loadWorkerSource=function(t,e,n){try{this.self.importScripts(e.url),n()}catch(t){n(t.toString())}},wt.prototype.syncRTLPluginState=function(e,n,r){try{t.plugin.setState(n);var i=t.plugin.getPluginURL();if(t.plugin.isLoaded()&&!t.plugin.isParsed()&&null!=i){this.self.importScripts(i);var o=t.plugin.isParsed();r(o?void 0:new Error("RTL Text Plugin failed to import scripts from "+i),o)}}catch(t){r(t.toString())}},wt.prototype.getAvailableImages=function(t){var e=this.availableImages[t];return e||(e=[]),e},wt.prototype.getLayerIndex=function(t){var e=this.layerIndexes[t];return e||(e=this.layerIndexes[t]=new i),e},wt.prototype.getWorkerSource=function(t,e,n){var r=this;return this.workerSources[t]||(this.workerSources[t]={}),this.workerSources[t][e]||(this.workerSources[t][e]={}),this.workerSources[t][e][n]||(this.workerSources[t][e][n]=new this.workerSourceTypes[e]({send:function(e,n,i){r.actor.send(e,n,i,t)}},this.getLayerIndex(t),this.getAvailableImages(t))),this.workerSources[t][e][n]},wt.prototype.getDEMWorkerSource=function(t,e){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][e]||(this.demWorkerSources[t][e]=new p),this.demWorkerSources[t][e]},wt.prototype.enforceCacheSizeLimit=function(e,n){t.enforceCacheSizeLimit(n)},"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new wt(self)),wt})),i(["./shared"],(function(t){var e=t.createCommonjsModule((function(t){function e(t){return!n(t)}function n(t){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var t,e,n=new Blob([""],{type:"text/javascript"}),r=URL.createObjectURL(n);try{e=new Worker(r),t=!0}catch(e){t=!1}return e&&e.terminate(),URL.revokeObjectURL(r),t}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var t=document.createElement("canvas");t.width=t.height=1;var e=t.getContext("2d");if(!e)return!1;var n=e.getImageData(0,0,1,1);return n&&n.width===t.width}()?(void 0===r[n=t&&t.failIfMajorPerformanceCaveat]&&(r[n]=function(t){var n=function(t){var n=document.createElement("canvas"),r=Object.create(e.webGLContextAttributes);return r.failIfMajorPerformanceCaveat=t,n.probablySupportsContext?n.probablySupportsContext("webgl",r)||n.probablySupportsContext("experimental-webgl",r):n.supportsContext?n.supportsContext("webgl",r)||n.supportsContext("experimental-webgl",r):n.getContext("webgl",r)||n.getContext("experimental-webgl",r)}(t);if(!n)return!1;var r=n.createShader(n.VERTEX_SHADER);return!(!r||n.isContextLost())&&(n.shaderSource(r,"void main() {}"),n.compileShader(r),!0===n.getShaderParameter(r,n.COMPILE_STATUS))}(n)),r[n]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var n}t.exports?t.exports=e:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=e,window.mapboxgl.notSupportedReason=n);var r={};e.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}})),n={create:function(e,n,r){var i=t.window.document.createElement(e);return void 0!==n&&(i.className=n),r&&r.appendChild(i),i},createNS:function(e,n){return t.window.document.createElementNS(e,n)}},i=t.window.document&&t.window.document.documentElement.style;function o(t){if(!i)return t[0];for(var e=0;e<t.length;e++)if(t[e]in i)return t[e];return t[0]}var a,s=o(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);n.disableDrag=function(){i&&s&&(a=i[s],i[s]="none")},n.enableDrag=function(){i&&s&&(i[s]=a)};var u=o(["transform","WebkitTransform"]);n.setTransform=function(t,e){t.style[u]=e};var l=!1;try{var c=Object.defineProperty({},"passive",{get:function(){l=!0}});t.window.addEventListener("test",c,c),t.window.removeEventListener("test",c,c)}catch(t){l=!1}n.addEventListener=function(t,e,n,r){void 0===r&&(r={}),t.addEventListener(e,n,"passive"in r&&l?r:r.capture)},n.removeEventListener=function(t,e,n,r){void 0===r&&(r={}),t.removeEventListener(e,n,"passive"in r&&l?r:r.capture)};var p=function(e){e.preventDefault(),e.stopPropagation(),t.window.removeEventListener("click",p,!0)};function h(t){var e=t.userImage;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}n.suppressClick=function(){t.window.addEventListener("click",p,!0),t.window.setTimeout((function(){t.window.removeEventListener("click",p,!0)}),0)},n.mousePos=function(e,n){var r=e.getBoundingClientRect();return new t.Point(n.clientX-r.left-e.clientLeft,n.clientY-r.top-e.clientTop)},n.touchPos=function(e,n){for(var r=e.getBoundingClientRect(),i=[],o=0;o<n.length;o++)i.push(new t.Point(n[o].clientX-r.left-e.clientLeft,n[o].clientY-r.top-e.clientTop));return i},n.mouseButton=function(e){return void 0!==t.window.InstallTrigger&&2===e.button&&e.ctrlKey&&t.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button},n.remove=function(t){t.parentNode&&t.parentNode.removeChild(t)};var f=function(e){function n(){e.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new t.RGBAImage({width:1,height:1}),this.dirty=!0}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.isLoaded=function(){return this.loaded},n.prototype.setLoaded=function(t){if(this.loaded!==t&&(this.loaded=t,t)){for(var e=0,n=this.requestors;e<n.length;e+=1){var r=n[e];this._notify(r.ids,r.callback)}this.requestors=[]}},n.prototype.getImage=function(t){return this.images[t]},n.prototype.addImage=function(t,e){this._validate(t,e)&&(this.images[t]=e)},n.prototype._validate=function(e,n){var r=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new t.ErrorEvent(new Error('Image "'+e+'" has invalid "stretchX" value'))),r=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new t.ErrorEvent(new Error('Image "'+e+'" has invalid "stretchY" value'))),r=!1),this._validateContent(n.content,n)||(this.fire(new t.ErrorEvent(new Error('Image "'+e+'" has invalid "content" value'))),r=!1),r},n.prototype._validateStretch=function(t,e){if(!t)return!0;for(var n=0,r=0,i=t;r<i.length;r+=1){var o=i[r];if(o[0]<n||o[1]<o[0]||e<o[1])return!1;n=o[1]}return!0},n.prototype._validateContent=function(t,e){return!(t&&(4!==t.length||t[0]<0||e.data.width<t[0]||t[1]<0||e.data.height<t[1]||t[2]<0||e.data.width<t[2]||t[3]<0||e.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))},n.prototype.updateImage=function(t,e){e.version=this.images[t].version+1,this.images[t]=e,this.updatedImages[t]=!0},n.prototype.removeImage=function(t){var e=this.images[t];delete this.images[t],delete this.patterns[t],e.userImage&&e.userImage.onRemove&&e.userImage.onRemove()},n.prototype.listImages=function(){return Object.keys(this.images)},n.prototype.getImages=function(t,e){var n=!0;if(!this.isLoaded())for(var r=0,i=t;r<i.length;r+=1)this.images[i[r]]||(n=!1);this.isLoaded()||n?this._notify(t,e):this.requestors.push({ids:t,callback:e})},n.prototype._notify=function(e,n){for(var r={},i=0,o=e;i<o.length;i+=1){var a=o[i];this.images[a]||this.fire(new t.Event("styleimagemissing",{id:a}));var s=this.images[a];s?r[a]={data:s.data.clone(),pixelRatio:s.pixelRatio,sdf:s.sdf,version:s.version,stretchX:s.stretchX,stretchY:s.stretchY,content:s.content,hasRenderCallback:Boolean(s.userImage&&s.userImage.render)}:t.warnOnce('Image "'+a+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}n(null,r)},n.prototype.getPixelSize=function(){var t=this.atlasImage;return{width:t.width,height:t.height}},n.prototype.getPattern=function(e){var n=this.patterns[e],r=this.getImage(e);if(!r)return null;if(n&&n.position.version===r.version)return n.position;if(n)n.position.version=r.version;else{var i={w:r.data.width+2,h:r.data.height+2,x:0,y:0},o=new t.ImagePosition(i,r);this.patterns[e]={bin:i,position:o}}return this._updatePatternAtlas(),this.patterns[e].position},n.prototype.bind=function(e){var n=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new t.Texture(e,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)},n.prototype._updatePatternAtlas=function(){var e=[];for(var n in this.patterns)e.push(this.patterns[n].bin);var r=t.potpack(e),i=r.w,o=r.h,a=this.atlasImage;for(var s in a.resize({width:i||1,height:o||1}),this.patterns){var u=this.patterns[s].bin,l=u.x+1,c=u.y+1,p=this.images[s].data,h=p.width,f=p.height;t.RGBAImage.copy(p,a,{x:0,y:0},{x:l,y:c},{width:h,height:f}),t.RGBAImage.copy(p,a,{x:0,y:f-1},{x:l,y:c-1},{width:h,height:1}),t.RGBAImage.copy(p,a,{x:0,y:0},{x:l,y:c+f},{width:h,height:1}),t.RGBAImage.copy(p,a,{x:h-1,y:0},{x:l-1,y:c},{width:1,height:f}),t.RGBAImage.copy(p,a,{x:0,y:0},{x:l+h,y:c},{width:1,height:f})}this.dirty=!0},n.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},n.prototype.dispatchRenderCallbacks=function(t){for(var e=0,n=t;e<n.length;e+=1){var r=n[e];if(!this.callbackDispatchedThisFrame[r]){this.callbackDispatchedThisFrame[r]=!0;var i=this.images[r];h(i)&&this.updateImage(r,i)}}},n}(t.Evented),d=y,v=y,m=1e20;function y(t,e,n,r,i,o){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=r||.25,this.fontFamily=i||"sans-serif",this.fontWeight=o||"normal",this.radius=n||8;var a=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.d=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Int16Array(a),this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function g(t,e,n,r,i,o,a){for(var s=0;s<e;s++){for(var u=0;u<n;u++)r[u]=t[u*e+s];for(_(r,i,o,a,n),u=0;u<n;u++)t[u*e+s]=i[u]}for(u=0;u<n;u++){for(s=0;s<e;s++)r[s]=t[u*e+s];for(_(r,i,o,a,e),s=0;s<e;s++)t[u*e+s]=Math.sqrt(i[s])}}function _(t,e,n,r,i){n[0]=0,r[0]=-m,r[1]=+m;for(var o=1,a=0;o<i;o++){for(var s=(t[o]+o*o-(t[n[a]]+n[a]*n[a]))/(2*o-2*n[a]);s<=r[a];)a--,s=(t[o]+o*o-(t[n[a]]+n[a]*n[a]))/(2*o-2*n[a]);n[++a]=o,r[a]=s,r[a+1]=+m}for(o=0,a=0;o<i;o++){for(;r[a+1]<o;)a++;e[o]=(o-n[a])*(o-n[a])+t[n[a]]}}y.prototype.draw=function(t){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(t,this.buffer,this.middle);for(var e=this.ctx.getImageData(0,0,this.size,this.size),n=new Uint8ClampedArray(this.size*this.size),r=0;r<this.size*this.size;r++){var i=e.data[4*r+3]/255;this.gridOuter[r]=1===i?0:0===i?m:Math.pow(Math.max(0,.5-i),2),this.gridInner[r]=1===i?m:0===i?0:Math.pow(Math.max(0,i-.5),2)}for(g(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),g(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),r=0;r<this.size*this.size;r++)n[r]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[r]-this.gridInner[r])/this.radius+this.cutoff))));return n},d.default=v;var x=function(t,e){this.requestManager=t,this.localIdeographFontFamily=e,this.entries={}};x.prototype.setURL=function(t){this.url=t},x.prototype.getGlyphs=function(e,n){var r=this,i=[];for(var o in e)for(var a=0,s=e[o];a<s.length;a+=1)i.push({stack:o,id:s[a]});t.asyncAll(i,(function(t,e){var n=t.stack,i=t.id,o=r.entries[n];o||(o=r.entries[n]={glyphs:{},requests:{},ranges:{}});var a=o.glyphs[i];if(void 0===a){if(a=r._tinySDF(o,n,i))return o.glyphs[i]=a,void e(null,{stack:n,id:i,glyph:a});var s=Math.floor(i/256);if(256*s>65535)e(new Error("glyphs > 65535 not supported"));else if(o.ranges[s])e(null,{stack:n,id:i,glyph:a});else{var u=o.requests[s];u||(u=o.requests[s]=[],x.loadGlyphRange(n,s,r.url,r.requestManager,(function(t,e){if(e){for(var n in e)r._doesCharSupportLocalGlyph(+n)||(o.glyphs[+n]=e[+n]);o.ranges[s]=!0}for(var i=0,a=u;i<a.length;i+=1)(0,a[i])(t,e);delete o.requests[s]}))),u.push((function(t,r){t?e(t):r&&e(null,{stack:n,id:i,glyph:r[i]||null})}))}}else e(null,{stack:n,id:i,glyph:a})}),(function(t,e){if(t)n(t);else if(e){for(var r={},i=0,o=e;i<o.length;i+=1){var a=o[i],s=a.stack,u=a.id,l=a.glyph;(r[s]||(r[s]={}))[u]=l&&{id:l.id,bitmap:l.bitmap.clone(),metrics:l.metrics}}n(null,r)}}))},x.prototype._doesCharSupportLocalGlyph=function(e){return!!this.localIdeographFontFamily&&(t.isChar["CJK Unified Ideographs"](e)||t.isChar["Hangul Syllables"](e)||t.isChar.Hiragana(e)||t.isChar.Katakana(e))},x.prototype._tinySDF=function(e,n,r){var i=this.localIdeographFontFamily;if(i&&this._doesCharSupportLocalGlyph(r)){var o=e.tinySDF;if(!o){var a="400";/bold/i.test(n)?a="900":/medium/i.test(n)?a="500":/light/i.test(n)&&(a="200"),o=e.tinySDF=new x.TinySDF(24,3,8,.25,i,a)}return{id:r,bitmap:new t.AlphaImage({width:30,height:30},o.draw(String.fromCharCode(r))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},x.loadGlyphRange=function(e,n,r,i,o){var a=256*n,s=a+255,u=i.transformRequest(i.normalizeGlyphsURL(r).replace("{fontstack}",e).replace("{range}",a+"-"+s),t.ResourceType.Glyphs);t.getArrayBuffer(u,(function(e,n){if(e)o(e);else if(n){for(var r={},i=0,a=t.parseGlyphPBF(n);i<a.length;i+=1){var s=a[i];r[s.id]=s}o(null,r)}}))},x.TinySDF=d;var b=function(){this.specification=t.styleSpec.light.position};b.prototype.possiblyEvaluate=function(e,n){return t.sphericalToCartesian(e.expression.evaluate(n))},b.prototype.interpolate=function(e,n,r){return{x:t.number(e.x,n.x,r),y:t.number(e.y,n.y,r),z:t.number(e.z,n.z,r)}};var w=new t.Properties({anchor:new t.DataConstantProperty(t.styleSpec.light.anchor),position:new b,color:new t.DataConstantProperty(t.styleSpec.light.color),intensity:new t.DataConstantProperty(t.styleSpec.light.intensity)}),S=function(e){function n(n){e.call(this),this._transitionable=new t.Transitionable(w),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.getLight=function(){return this._transitionable.serialize()},n.prototype.setLight=function(e,n){if(void 0===n&&(n={}),!this._validate(t.validateLight,e,n))for(var r in e){var i=e[r];t.endsWith(r,"-transition")?this._transitionable.setTransition(r.slice(0,-"-transition".length),i):this._transitionable.setValue(r,i)}},n.prototype.updateTransitions=function(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)},n.prototype.hasTransition=function(){return this._transitioning.hasTransition()},n.prototype.recalculate=function(t){this.properties=this._transitioning.possiblyEvaluate(t)},n.prototype._validate=function(e,n,r){return(!r||!1!==r.validate)&&t.emitValidationErrors(this,e.call(t.validateStyle,t.extend({value:n,style:{glyphs:!0,sprite:!0},styleSpec:t.styleSpec})))},n}(t.Evented),E=function(t,e){this.width=t,this.height=e,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};E.prototype.getDash=function(t,e){var n=t.join(",")+String(e);return this.dashEntry[n]||(this.dashEntry[n]=this.addDash(t,e)),this.dashEntry[n]},E.prototype.getDashRanges=function(t,e,n){var r=[],i=t.length%2==1?-t[t.length-1]*n:0,o=t[0]*n,a=!0;r.push({left:i,right:o,isDash:a,zeroLength:0===t[0]});for(var s=t[0],u=1;u<t.length;u++){var l=t[u];r.push({left:i=s*n,right:o=(s+=l)*n,isDash:a=!a,zeroLength:0===l})}return r},E.prototype.addRoundDash=function(t,e,n){for(var r=e/2,i=-n;i<=n;i++)for(var o=this.width*(this.nextRow+n+i),a=0,s=t[a],u=0;u<this.width;u++){u/s.right>1&&(s=t[++a]);var l=Math.abs(u-s.left),c=Math.abs(u-s.right),p=Math.min(l,c),h=void 0,f=i/n*(r+1);if(s.isDash){var d=r-Math.abs(f);h=Math.sqrt(p*p+d*d)}else h=r-Math.sqrt(p*p+f*f);this.data[o+u]=Math.max(0,Math.min(255,h+128))}},E.prototype.addRegularDash=function(t){for(var e=t.length-1;e>=0;--e){var n=t[e],r=t[e+1];n.zeroLength?t.splice(e,1):r&&r.isDash===n.isDash&&(r.left=n.left,t.splice(e,1))}var i=t[0],o=t[t.length-1];i.isDash===o.isDash&&(i.left=o.left-this.width,o.right=i.right+this.width);for(var a=this.width*this.nextRow,s=0,u=t[s],l=0;l<this.width;l++){l/u.right>1&&(u=t[++s]);var c=Math.abs(l-u.left),p=Math.abs(l-u.right),h=Math.min(c,p);this.data[a+l]=Math.max(0,Math.min(255,(u.isDash?h:-h)+128))}},E.prototype.addDash=function(e,n){var r=n?7:0,i=2*r+1;if(this.nextRow+i>this.height)return t.warnOnce("LineAtlas out of space"),null;for(var o=0,a=0;a<e.length;a++)o+=e[a];if(0!==o){var s=this.width/o,u=this.getDashRanges(e,this.width,s);n?this.addRoundDash(u,s,r):this.addRegularDash(u)}var l={y:(this.nextRow+r+.5)/this.height,height:2*r/this.height,width:o};return this.nextRow+=i,this.dirty=!0,l},E.prototype.bind=function(t){var e=t.gl;this.texture?(e.bindTexture(e.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,e.texSubImage2D(e.TEXTURE_2D,0,0,0,this.width,this.height,e.ALPHA,e.UNSIGNED_BYTE,this.data))):(this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.ALPHA,this.width,this.height,0,e.ALPHA,e.UNSIGNED_BYTE,this.data))};var C=function e(n,r){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=t.uniqueId();for(var i=this.workerPool.acquire(this.id),o=0;o<i.length;o++){var a=new e.Actor(i[o],r,this.id);a.name="Worker "+o,this.actors.push(a)}};function T(e,n,r){var i=function(i,o){if(i)return r(i);if(o){var a=t.pick(t.extend(o,e),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);o.vector_layers&&(a.vectorLayers=o.vector_layers,a.vectorLayerIds=a.vectorLayers.map((function(t){return t.id}))),a.tiles=n.canonicalizeTileset(a,e.url),r(null,a)}};return e.url?t.getJSON(n.transformRequest(n.normalizeSourceURL(e.url),t.ResourceType.Source),i):t.browser.frame((function(){return i(null,e)}))}C.prototype.broadcast=function(e,n,r){t.asyncAll(this.actors,(function(t,r){t.send(e,n,r)}),r=r||function(){})},C.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},C.prototype.remove=function(){this.actors.forEach((function(t){t.remove()})),this.actors=[],this.workerPool.release(this.id)},C.Actor=t.Actor;var A=function(e,n,r){this.bounds=t.LngLatBounds.convert(this.validateBounds(e)),this.minzoom=n||0,this.maxzoom=r||24};A.prototype.validateBounds=function(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]},A.prototype.contains=function(e){var n=Math.pow(2,e.z),r=Math.floor(t.mercatorXfromLng(this.bounds.getWest())*n),i=Math.floor(t.mercatorYfromLat(this.bounds.getNorth())*n),o=Math.ceil(t.mercatorXfromLng(this.bounds.getEast())*n),a=Math.ceil(t.mercatorYfromLat(this.bounds.getSouth())*n);return e.x>=r&&e.x<o&&e.y>=i&&e.y<a};var M=function(e){function n(n,r,i,o){if(e.call(this),this.id=n,this.dispatcher=i,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.extend(this,t.pick(r,["url","scheme","tileSize","promoteId"])),this._options=t.extend({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(o)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.load=function(){var e=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=T(this._options,this.map._requestManager,(function(n,r){e._tileJSONRequest=null,e._loaded=!0,n?e.fire(new t.ErrorEvent(n)):r&&(t.extend(e,r),r.bounds&&(e.tileBounds=new A(r.bounds,e.minzoom,e.maxzoom)),t.postTurnstileEvent(r.tiles,e.map._requestManager._customAccessToken),t.postMapLoadEvent(r.tiles,e.map._getMapId(),e.map._requestManager._skuToken,e.map._requestManager._customAccessToken),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))}))},n.prototype.loaded=function(){return this._loaded},n.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},n.prototype.onAdd=function(t){this.map=t,this.load()},n.prototype.setSourceProperty=function(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},n.prototype.setTiles=function(t){var e=this;return this.setSourceProperty((function(){e._options.tiles=t})),this},n.prototype.setUrl=function(t){var e=this;return this.setSourceProperty((function(){e.url=t,e._options.url=t})),this},n.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},n.prototype.serialize=function(){return t.extend({},this._options)},n.prototype.loadTile=function(e,n){var r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),i={request:this.map._requestManager.transformRequest(r,t.ResourceType.Tile),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:t.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function o(r,i){return delete e.request,e.aborted?n(null):r&&404!==r.status?n(r):(i&&i.resourceTiming&&(e.resourceTiming=i.resourceTiming),this.map._refreshExpiredTiles&&i&&e.setExpiryData(i),e.loadVectorData(i,this.map.painter),t.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}i.request.collectResourceTiming=this._collectResourceTiming,e.actor&&"expired"!==e.state?"loading"===e.state?e.reloadCallback=n:e.request=e.actor.send("reloadTile",i,o.bind(this)):(e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",i,o.bind(this)))},n.prototype.abortTile=function(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)},n.prototype.unloadTile=function(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)},n.prototype.hasTransition=function(){return!1},n}(t.Evented),k=function(e){function n(n,r,i,o){e.call(this),this.id=n,this.dispatcher=i,this.setEventedParent(o),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.extend({type:"raster"},r),t.extend(this,t.pick(r,["url","scheme","tileSize"]))}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.load=function(){var e=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=T(this._options,this.map._requestManager,(function(n,r){e._tileJSONRequest=null,e._loaded=!0,n?e.fire(new t.ErrorEvent(n)):r&&(t.extend(e,r),r.bounds&&(e.tileBounds=new A(r.bounds,e.minzoom,e.maxzoom)),t.postTurnstileEvent(r.tiles),t.postMapLoadEvent(r.tiles,e.map._getMapId(),e.map._requestManager._skuToken),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))}))},n.prototype.loaded=function(){return this._loaded},n.prototype.onAdd=function(t){this.map=t,this.load()},n.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},n.prototype.serialize=function(){return t.extend({},this._options)},n.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},n.prototype.loadTile=function(e,n){var r=this,i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);e.request=t.getImage(this.map._requestManager.transformRequest(i,t.ResourceType.Tile),(function(i,o){if(delete e.request,e.aborted)e.state="unloaded",n(null);else if(i)e.state="errored",n(i);else if(o){r.map._refreshExpiredTiles&&e.setExpiryData(o),delete o.cacheControl,delete o.expires;var a=r.map.painter.context,s=a.gl;e.texture=r.map.painter.getTileTexture(o.width),e.texture?e.texture.update(o,{useMipmap:!0}):(e.texture=new t.Texture(a,o,s.RGBA,{useMipmap:!0}),e.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST),a.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax)),e.state="loaded",t.cacheEntryPossiblyAdded(r.dispatcher),n(null)}}))},n.prototype.abortTile=function(t,e){t.request&&(t.request.cancel(),delete t.request),e()},n.prototype.unloadTile=function(t,e){t.texture&&this.map.painter.saveTileTexture(t.texture),e()},n.prototype.hasTransition=function(){return!1},n}(t.Evented),P=function(e){function n(n,r,i,o){e.call(this,n,r,i,o),this.type="raster-dem",this.maxzoom=22,this._options=t.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},n.prototype.loadTile=function(e,n){var r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function i(t,r){t&&(e.state="errored",n(t)),r&&(e.dem=r,e.needsHillshadePrepare=!0,e.state="loaded",n(null))}e.request=t.getImage(this.map._requestManager.transformRequest(r,t.ResourceType.Tile),function(r,o){if(delete e.request,e.aborted)e.state="unloaded",n(null);else if(r)e.state="errored",n(r);else if(o){this.map._refreshExpiredTiles&&e.setExpiryData(o),delete o.cacheControl,delete o.expires;var a=t.window.ImageBitmap&&o instanceof t.window.ImageBitmap&&t.offscreenCanvasSupported()?o:t.browser.getImageData(o,1),s={uid:e.uid,coord:e.tileID,source:this.id,rawImageData:a,encoding:this.encoding};e.actor&&"expired"!==e.state||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",s,i.bind(this)))}}.bind(this)),e.neighboringTiles=this._getNeighboringTiles(e.tileID)},n.prototype._getNeighboringTiles=function(e){var n=e.canonical,r=Math.pow(2,n.z),i=(n.x-1+r)%r,o=0===n.x?e.wrap-1:e.wrap,a=(n.x+1+r)%r,s=n.x+1===r?e.wrap+1:e.wrap,u={};return u[new t.OverscaledTileID(e.overscaledZ,o,n.z,i,n.y).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,s,n.z,a,n.y).key]={backfilled:!1},n.y>0&&(u[new t.OverscaledTileID(e.overscaledZ,o,n.z,i,n.y-1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,e.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,s,n.z,a,n.y-1).key]={backfilled:!1}),n.y+1<r&&(u[new t.OverscaledTileID(e.overscaledZ,o,n.z,i,n.y+1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,e.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,s,n.z,a,n.y+1).key]={backfilled:!1}),u},n.prototype.unloadTile=function(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})},n}(k),O=function(e){function n(n,r,i,o){e.call(this),this.id=n,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=i.getActor(),this.setEventedParent(o),this._data=r.data,this._options=t.extend({},r),this._collectResourceTiming=r.collectResourceTiming,this._resourceTiming=[],void 0!==r.maxzoom&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;var a=t.EXTENT/this.tileSize;this.workerOptions=t.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(void 0!==r.buffer?r.buffer:128)*a,tolerance:(void 0!==r.tolerance?r.tolerance:.375)*a,extent:t.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:void 0!==r.clusterMaxZoom?Math.min(r.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:t.EXTENT,radius:(r.clusterRadius||50)*a,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.load=function(){var e=this;this.fire(new t.Event("dataloading",{dataType:"source"})),this._updateWorkerData((function(n){if(n)e.fire(new t.ErrorEvent(n));else{var r={dataType:"source",sourceDataType:"metadata"};e._collectResourceTiming&&e._resourceTiming&&e._resourceTiming.length>0&&(r.resourceTiming=e._resourceTiming,e._resourceTiming=[]),e.fire(new t.Event("data",r))}}))},n.prototype.onAdd=function(t){this.map=t,this.load()},n.prototype.setData=function(e){var n=this;return this._data=e,this.fire(new t.Event("dataloading",{dataType:"source"})),this._updateWorkerData((function(e){if(e)n.fire(new t.ErrorEvent(e));else{var r={dataType:"source",sourceDataType:"content"};n._collectResourceTiming&&n._resourceTiming&&n._resourceTiming.length>0&&(r.resourceTiming=n._resourceTiming,n._resourceTiming=[]),n.fire(new t.Event("data",r))}})),this},n.prototype.getClusterExpansionZoom=function(t,e){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},e),this},n.prototype.getClusterChildren=function(t,e){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},e),this},n.prototype.getClusterLeaves=function(t,e,n,r){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:e,offset:n},r),this},n.prototype._updateWorkerData=function(e){var n=this;this._loaded=!1;var r=t.extend({},this.workerOptions),i=this._data;"string"==typeof i?(r.request=this.map._requestManager.transformRequest(t.browser.resolveURL(i),t.ResourceType.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(i),this.actor.send(this.type+".loadData",r,(function(t,i){n._removed||i&&i.abandoned||(n._loaded=!0,i&&i.resourceTiming&&i.resourceTiming[n.id]&&(n._resourceTiming=i.resourceTiming[n.id].slice(0)),n.actor.send(n.type+".coalesce",{source:r.source},null),e(t))}))},n.prototype.loaded=function(){return this._loaded},n.prototype.loadTile=function(e,n){var r=this,i=e.actor?"reloadTile":"loadTile";e.actor=this.actor,e.request=this.actor.send(i,{type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:t.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(function(t,o){return delete e.request,e.unloadVectorData(),e.aborted?n(null):t?n(t):(e.loadVectorData(o,r.map.painter,"reloadTile"===i),n(null))}))},n.prototype.abortTile=function(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0},n.prototype.unloadTile=function(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})},n.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},n.prototype.serialize=function(){return t.extend({},this._options,{type:this.type,data:this._data})},n.prototype.hasTransition=function(){return!1},n}(t.Evented),L=t.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),I=function(e){function n(t,n,r,i){e.call(this),this.id=t,this.dispatcher=r,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(i),this.options=n}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.load=function(e,n){var r=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this.url=this.options.url,t.getImage(this.map._requestManager.transformRequest(this.url,t.ResourceType.Image),(function(i,o){r._loaded=!0,i?r.fire(new t.ErrorEvent(i)):o&&(r.image=o,e&&(r.coordinates=e),n&&n(),r._finishLoading())}))},n.prototype.loaded=function(){return this._loaded},n.prototype.updateImage=function(t){var e=this;return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,(function(){e.texture=null})),this):this},n.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})))},n.prototype.onAdd=function(t){this.map=t,this.load()},n.prototype.setCoordinates=function(e){var n=this;this.coordinates=e;var r=e.map(t.MercatorCoordinate.fromLngLat);this.tileID=function(e){for(var n=1/0,r=1/0,i=-1/0,o=-1/0,a=0,s=e;a<s.length;a+=1){var u=s[a];n=Math.min(n,u.x),r=Math.min(r,u.y),i=Math.max(i,u.x),o=Math.max(o,u.y)}var l=Math.max(i-n,o-r),c=Math.max(0,Math.floor(-Math.log(l)/Math.LN2)),p=Math.pow(2,c);return new t.CanonicalTileID(c,Math.floor((n+i)/2*p),Math.floor((r+o)/2*p))}(r),this.minzoom=this.maxzoom=this.tileID.z;var i=r.map((function(t){return n.tileID.getTilePoint(t)._round()}));return this._boundsArray=new t.StructArrayLayout4i8,this._boundsArray.emplaceBack(i[0].x,i[0].y,0,0),this._boundsArray.emplaceBack(i[1].x,i[1].y,t.EXTENT,0),this._boundsArray.emplaceBack(i[3].x,i[3].y,0,t.EXTENT),this._boundsArray.emplaceBack(i[2].x,i[2].y,t.EXTENT,t.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})),this},n.prototype.prepare=function(){if(0!==Object.keys(this.tiles).length&&this.image){var e=this.map.painter.context,n=e.gl;for(var r in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,L.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new t.Texture(e,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this.tiles){var i=this.tiles[r];"loaded"!==i.state&&(i.state="loaded",i.texture=this.texture)}}},n.prototype.loadTile=function(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},e(null)):(t.state="errored",e(null))},n.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},n.prototype.hasTransition=function(){return!1},n}(t.Evented),R=function(e){function n(t,n,r,i){e.call(this,t,n,r,i),this.roundZoom=!0,this.type="video",this.options=n}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.load=function(){var e=this;this._loaded=!1;var n=this.options;this.urls=[];for(var r=0,i=n.urls;r<i.length;r+=1)this.urls.push(this.map._requestManager.transformRequest(i[r],t.ResourceType.Source).url);t.getVideo(this.urls,(function(n,r){e._loaded=!0,n?e.fire(new t.ErrorEvent(n)):r&&(e.video=r,e.video.loop=!0,e.video.addEventListener("playing",(function(){e.map.triggerRepaint()})),e.map&&e.video.play(),e._finishLoading())}))},n.prototype.pause=function(){this.video&&this.video.pause()},n.prototype.play=function(){this.video&&this.video.play()},n.prototype.seek=function(e){if(this.video){var n=this.video.seekable;e<n.start(0)||e>n.end(0)?this.fire(new t.ErrorEvent(new t.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+n.start(0)+" and "+n.end(0)+"-second mark."))):this.video.currentTime=e}},n.prototype.getVideo=function(){return this.video},n.prototype.onAdd=function(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},n.prototype.prepare=function(){if(!(0===Object.keys(this.tiles).length||this.video.readyState<2)){var e=this.map.painter.context,n=e.gl;for(var r in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,L.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new t.Texture(e,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this.tiles){var i=this.tiles[r];"loaded"!==i.state&&(i.state="loaded",i.texture=this.texture)}}},n.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},n.prototype.hasTransition=function(){return this.video&&!this.video.paused},n}(I),D=function(e){function n(n,r,i,o){e.call(this,n,r,i,o),r.coordinates?Array.isArray(r.coordinates)&&4===r.coordinates.length&&!r.coordinates.some((function(t){return!Array.isArray(t)||2!==t.length||t.some((function(t){return"number"!=typeof t}))}))||this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'missing required property "coordinates"'))),r.animate&&"boolean"!=typeof r.animate&&this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'optional "animate" property must be a boolean value'))),r.canvas?"string"==typeof r.canvas||r.canvas instanceof t.window.HTMLCanvasElement||this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'missing required property "canvas"'))),this.options=r,this.animate=void 0===r.animate||r.animate}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof t.window.HTMLCanvasElement?this.options.canvas:t.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},n.prototype.getCanvas=function(){return this.canvas},n.prototype.onAdd=function(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()},n.prototype.onRemove=function(){this.pause()},n.prototype.prepare=function(){var e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),!this._hasInvalidDimensions()&&0!==Object.keys(this.tiles).length){var n=this.map.painter.context,r=n.gl;for(var i in this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,L.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.Texture(n,this.canvas,r.RGBA,{premultiply:!0}),this.tiles){var o=this.tiles[i];"loaded"!==o.state&&(o.state="loaded",o.texture=this.texture)}}},n.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},n.prototype.hasTransition=function(){return this._playing},n.prototype._hasInvalidDimensions=function(){for(var t=0,e=[this.canvas.width,this.canvas.height];t<e.length;t+=1){var n=e[t];if(isNaN(n)||n<=0)return!0}return!1},n}(I),N={vector:M,raster:k,"raster-dem":P,geojson:O,video:R,image:I,canvas:D};function Z(e,n){var r=t.identity([]);return t.translate(r,r,[1,1,0]),t.scale(r,r,[.5*e.width,.5*e.height,1]),t.multiply(r,r,e.calculatePosMatrix(n.toUnwrapped()))}function z(t,e,n,r,i,o){var a=function(t,e,n){if(t)for(var r=0,i=t;r<i.length;r+=1){var o=e[i[r]];if(o&&o.source===n&&"fill-extrusion"===o.type)return!0}else for(var a in e){var s=e[a];if(s.source===n&&"fill-extrusion"===s.type)return!0}return!1}(i&&i.layers,e,t.id),s=o.maxPitchScaleFactor(),u=t.tilesIn(r,s,a);u.sort(F);for(var l=[],c=0,p=u;c<p.length;c+=1){var h=p[c];l.push({wrappedTileID:h.tileID.wrapped().key,queryResults:h.tile.queryRenderedFeatures(e,n,t._state,h.queryGeometry,h.cameraQueryGeometry,h.scale,i,o,s,Z(t.transform,h.tileID))})}var f=function(t){for(var e={},n={},r=0,i=t;r<i.length;r+=1){var o=i[r],a=o.queryResults,s=o.wrappedTileID,u=n[s]=n[s]||{};for(var l in a)for(var c=a[l],p=u[l]=u[l]||{},h=e[l]=e[l]||[],f=0,d=c;f<d.length;f+=1){var v=d[f];p[v.featureIndex]||(p[v.featureIndex]=!0,h.push(v))}}return e}(l);for(var d in f)f[d].forEach((function(e){var n=e.feature,r=t.getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=r}));return f}function F(t,e){var n=t.tileID,r=e.tileID;return n.overscaledZ-r.overscaledZ||n.canonical.y-r.canonical.y||n.wrap-r.wrap||n.canonical.x-r.canonical.x}var B=function(t,e){this.max=t,this.onRemove=e,this.reset()};B.prototype.reset=function(){for(var t in this.data)for(var e=0,n=this.data[t];e<n.length;e+=1){var r=n[e];r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value)}return this.data={},this.order=[],this},B.prototype.add=function(t,e,n){var r=this,i=t.wrapped().key;void 0===this.data[i]&&(this.data[i]=[]);var o={value:e,timeout:void 0};if(void 0!==n&&(o.timeout=setTimeout((function(){r.remove(t,o)}),n)),this.data[i].push(o),this.order.push(i),this.order.length>this.max){var a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this},B.prototype.has=function(t){return t.wrapped().key in this.data},B.prototype.getAndRemove=function(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null},B.prototype._getAndRemoveByKey=function(t){var e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value},B.prototype.getByKey=function(t){var e=this.data[t];return e?e[0].value:null},B.prototype.get=function(t){return this.has(t)?this.data[t.wrapped().key][0].value:null},B.prototype.remove=function(t,e){if(!this.has(t))return this;var n=t.wrapped().key,r=void 0===e?0:this.data[n].indexOf(e),i=this.data[n][r];return this.data[n].splice(r,1),i.timeout&&clearTimeout(i.timeout),0===this.data[n].length&&delete this.data[n],this.onRemove(i.value),this.order.splice(this.order.indexOf(n),1),this},B.prototype.setMaxSize=function(t){for(this.max=t;this.order.length>this.max;){var e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this},B.prototype.filter=function(t){var e=[];for(var n in this.data)for(var r=0,i=this.data[n];r<i.length;r+=1){var o=i[r];t(o.value)||e.push(o)}for(var a=0,s=e;a<s.length;a+=1){var u=s[a];this.remove(u.value.tileID,u)}};var j=function(t,e,n){this.context=t;var r=t.gl;this.buffer=r.createBuffer(),this.dynamicDraw=Boolean(n),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};j.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},j.prototype.updateData=function(t){var e=this.context.gl;this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)},j.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var U={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},V=function(t,e,n,r){this.length=e.length,this.attributes=n,this.itemSize=e.bytesPerElement,this.dynamicDraw=r,this.context=t;var i=t.gl;this.buffer=i.createBuffer(),t.bindVertexBuffer.set(this.buffer),i.bufferData(i.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};V.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},V.prototype.updateData=function(t){var e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)},V.prototype.enableAttributes=function(t,e){for(var n=0;n<this.attributes.length;n++){var r=e.attributes[this.attributes[n].name];void 0!==r&&t.enableVertexAttribArray(r)}},V.prototype.setVertexAttribPointers=function(t,e,n){for(var r=0;r<this.attributes.length;r++){var i=this.attributes[r],o=e.attributes[i.name];void 0!==o&&t.vertexAttribPointer(o,i.components,t[U[i.type]],!1,this.itemSize,i.offset+this.itemSize*(n||0))}},V.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var G=function(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};G.prototype.get=function(){return this.current},G.prototype.set=function(t){},G.prototype.getDefault=function(){return this.default},G.prototype.setDefault=function(){this.set(this.default)};var H=function(e){function n(){e.apply(this,arguments)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.getDefault=function(){return t.Color.transparent},n.prototype.set=function(t){var e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)},n}(G),W=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 1},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)},e}(G),q=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)},e}(G),X=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return[!0,!0,!0,!0]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)},e}(G),Y=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)},e}(G),K=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 255},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)},e}(G),Q=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},e.prototype.set=function(t){var e=this.current;(t.func!==e.func||t.ref!==e.ref||t.mask!==e.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)},e}(G),J=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)},e}(G),$=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1}},e}(G),tt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return[0,1]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)},e}(G),et=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1}},e}(G),nt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.LESS},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)},e}(G),rt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1}},e}(G),it=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[t.ONE,t.ZERO]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)},e}(G),ot=function(e){function n(){e.apply(this,arguments)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.getDefault=function(){return t.Color.transparent},n.prototype.set=function(t){var e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)},n}(G),at=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.FUNC_ADD},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)},e}(G),st=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1}},e}(G),ut=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.BACK},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)},e}(G),lt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.CCW},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)},e}(G),ct=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)},e}(G),pt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.TEXTURE0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)},e}(G),ht=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)},e}(G),ft=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1}},e}(G),dt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1}},e}(G),vt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1}},e}(G),mt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}},e}(G),yt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){var e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1},e}(G),gt=function(t){function e(e){t.call(this,e),this.vao=e.extVertexArrayObject}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)},e}(G),_t=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 4},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}},e}(G),xt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}},e}(G),bt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}},e}(G),wt=function(t){function e(e,n){t.call(this,e),this.context=e,this.parent=n}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e}(G),St=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.setDirty=function(){this.dirty=!0},e.prototype.set=function(t){if(t!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}},e}(wt),Et=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){if(t!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t),this.current=t,this.dirty=!1}},e}(wt),Ct=function(t,e,n,r){this.context=t,this.width=e,this.height=n;var i=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new St(t,i),r&&(this.depthAttachment=new Et(t,i))};Ct.prototype.destroy=function(){var t=this.context.gl,e=this.colorAttachment.get();if(e&&t.deleteTexture(e),this.depthAttachment){var n=this.depthAttachment.get();n&&t.deleteRenderbuffer(n)}t.deleteFramebuffer(this.framebuffer)};var Tt=function(t,e,n){this.func=t,this.mask=e,this.range=n};Tt.ReadOnly=!1,Tt.ReadWrite=!0,Tt.disabled=new Tt(519,Tt.ReadOnly,[0,1]);var At=function(t,e,n,r,i,o){this.test=t,this.ref=e,this.mask=n,this.fail=r,this.depthFail=i,this.pass=o};At.disabled=new At({func:519,mask:0},0,0,7680,7680,7680);var Mt=function(t,e,n){this.blendFunction=t,this.blendColor=e,this.mask=n};Mt.disabled=new Mt(Mt.Replace=[1,0],t.Color.transparent,[!1,!1,!1,!1]),Mt.unblended=new Mt(Mt.Replace,t.Color.transparent,[!0,!0,!0,!0]),Mt.alphaBlended=new Mt([1,771],t.Color.transparent,[!0,!0,!0,!0]);var kt=function(t,e,n){this.enable=t,this.mode=e,this.frontFace=n};kt.disabled=new kt(!1,1029,2305),kt.backCCW=new kt(!0,1029,2305);var Pt=function(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new H(this),this.clearDepth=new W(this),this.clearStencil=new q(this),this.colorMask=new X(this),this.depthMask=new Y(this),this.stencilMask=new K(this),this.stencilFunc=new Q(this),this.stencilOp=new J(this),this.stencilTest=new $(this),this.depthRange=new tt(this),this.depthTest=new et(this),this.depthFunc=new nt(this),this.blend=new rt(this),this.blendFunc=new it(this),this.blendColor=new ot(this),this.blendEquation=new at(this),this.cullFace=new st(this),this.cullFaceSide=new ut(this),this.frontFace=new lt(this),this.program=new ct(this),this.activeTexture=new pt(this),this.viewport=new ht(this),this.bindFramebuffer=new ft(this),this.bindRenderbuffer=new dt(this),this.bindTexture=new vt(this),this.bindVertexBuffer=new mt(this),this.bindElementBuffer=new yt(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new gt(this),this.pixelStoreUnpack=new _t(this),this.pixelStoreUnpackPremultiplyAlpha=new xt(this),this.pixelStoreUnpackFlipY=new bt(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)};Pt.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},Pt.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},Pt.prototype.createIndexBuffer=function(t,e){return new j(this,t,e)},Pt.prototype.createVertexBuffer=function(t,e,n){return new V(this,t,e,n)},Pt.prototype.createRenderbuffer=function(t,e,n){var r=this.gl,i=r.createRenderbuffer();return this.bindRenderbuffer.set(i),r.renderbufferStorage(r.RENDERBUFFER,t,e,n),this.bindRenderbuffer.set(null),i},Pt.prototype.createFramebuffer=function(t,e,n){return new Ct(this,t,e,n)},Pt.prototype.clear=function(t){var e=t.color,n=t.depth,r=this.gl,i=0;e&&(i|=r.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==n&&(i|=r.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),r.clear(i)},Pt.prototype.setCullFace=function(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))},Pt.prototype.setDepthMode=function(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)},Pt.prototype.setStencilMode=function(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)},Pt.prototype.setColorMode=function(e){t.deepEqual(e.blendFunction,Mt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)},Pt.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Ot=function(e){function n(n,r,i){var o=this;e.call(this),this.id=n,this.dispatcher=i,this.on("data",(function(t){"source"===t.dataType&&"metadata"===t.sourceDataType&&(o._sourceLoaded=!0),o._sourceLoaded&&!o._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(o.reload(),o.transform&&o.update(o.transform))})),this.on("error",(function(){o._sourceErrored=!0})),this._source=function(e,n,r,i){var o=new N[n.type](e,n,r,i);if(o.id!==e)throw new Error("Expected Source id to be "+e+" instead of "+o.id);return t.bindAll(["load","abort","unload","serialize","prepare"],o),o}(n,r,i,this),this._tiles={},this._cache=new B(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new t.SourceFeatureState}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.onAdd=function(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)},n.prototype.onRemove=function(t){this._source&&this._source.onRemove&&this._source.onRemove(t)},n.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(var t in this._tiles){var e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0},n.prototype.getSource=function(){return this._source},n.prototype.pause=function(){this._paused=!0},n.prototype.resume=function(){if(this._paused){var t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}},n.prototype._loadTile=function(t,e){return this._source.loadTile(t,e)},n.prototype._unloadTile=function(t){if(this._source.unloadTile)return this._source.unloadTile(t,(function(){}))},n.prototype._abortTile=function(t){if(this._source.abortTile)return this._source.abortTile(t,(function(){}))},n.prototype.serialize=function(){return this._source.serialize()},n.prototype.prepare=function(t){for(var e in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var n=this._tiles[e];n.upload(t),n.prepare(this.map.style.imageManager)}},n.prototype.getIds=function(){return t.values(this._tiles).map((function(t){return t.tileID})).sort(Lt).map((function(t){return t.key}))},n.prototype.getRenderableIds=function(e){var n=this,r=[];for(var i in this._tiles)this._isIdRenderable(i,e)&&r.push(this._tiles[i]);return e?r.sort((function(e,r){var i=e.tileID,o=r.tileID,a=new t.Point(i.canonical.x,i.canonical.y)._rotate(n.transform.angle),s=new t.Point(o.canonical.x,o.canonical.y)._rotate(n.transform.angle);return i.overscaledZ-o.overscaledZ||s.y-a.y||s.x-a.x})).map((function(t){return t.tileID.key})):r.map((function(t){return t.tileID})).sort(Lt).map((function(t){return t.key}))},n.prototype.hasRenderableParent=function(t){var e=this.findLoadedParent(t,0);return!!e&&this._isIdRenderable(e.tileID.key)},n.prototype._isIdRenderable=function(t,e){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())},n.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var t in this._cache.reset(),this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(t,"reloading")},n.prototype._reloadTile=function(t,e){var n=this._tiles[t];n&&("loading"!==n.state&&(n.state=e),this._loadTile(n,this._tileLoaded.bind(this,n,t,e)))},n.prototype._tileLoaded=function(e,n,r,i){if(i)return e.state="errored",void(404!==i.status?this._source.fire(new t.ErrorEvent(i,{tile:e})):this.update(this.transform));e.timeAdded=t.browser.now(),"expired"===r&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),"raster-dem"===this.getSource().type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new t.Event("data",{dataType:"source",tile:e,coord:e.tileID}))},n.prototype._backfillDEM=function(t){for(var e=this.getRenderableIds(),n=0;n<e.length;n++){var r=e[n];if(t.neighboringTiles&&t.neighboringTiles[r]){var i=this.getTileByID(r);o(t,i),o(i,t)}}function o(t,e){t.needsHillshadePrepare=!0;var n=e.tileID.canonical.x-t.tileID.canonical.x,r=e.tileID.canonical.y-t.tileID.canonical.y,i=Math.pow(2,t.tileID.canonical.z),o=e.tileID.key;0===n&&0===r||Math.abs(r)>1||(Math.abs(n)>1&&(1===Math.abs(n+i)?n+=i:1===Math.abs(n-i)&&(n-=i)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,n,r),t.neighboringTiles&&t.neighboringTiles[o]&&(t.neighboringTiles[o].backfilled=!0)))}},n.prototype.getTile=function(t){return this.getTileByID(t.key)},n.prototype.getTileByID=function(t){return this._tiles[t]},n.prototype._retainLoadedChildren=function(t,e,n,r){for(var i in this._tiles){var o=this._tiles[i];if(!(r[i]||!o.hasData()||o.tileID.overscaledZ<=e||o.tileID.overscaledZ>n)){for(var a=o.tileID;o&&o.tileID.overscaledZ>e+1;){var s=o.tileID.scaledTo(o.tileID.overscaledZ-1);(o=this._tiles[s.key])&&o.hasData()&&(a=s)}for(var u=a;u.overscaledZ>e;)if(t[(u=u.scaledTo(u.overscaledZ-1)).key]){r[a.key]=a;break}}}},n.prototype.findLoadedParent=function(t,e){if(t.key in this._loadedParentTiles){var n=this._loadedParentTiles[t.key];return n&&n.tileID.overscaledZ>=e?n:null}for(var r=t.overscaledZ-1;r>=e;r--){var i=t.scaledTo(r),o=this._getLoadedTile(i);if(o)return o}},n.prototype._getLoadedTile=function(t){var e=this._tiles[t.key];return e&&e.hasData()?e:this._cache.getByKey(t.wrapped().key)},n.prototype.updateCacheSize=function(t){var e=Math.ceil(t.width/this._source.tileSize)+1,n=Math.ceil(t.height/this._source.tileSize)+1,r=Math.floor(e*n*5),i="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,r):r;this._cache.setMaxSize(i)},n.prototype.handleWrapJump=function(t){var e=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,e){var n={};for(var r in this._tiles){var i=this._tiles[r];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+e),n[i.tileID.key]=i}for(var o in this._tiles=n,this._timers)clearTimeout(this._timers[o]),delete this._timers[o];for(var a in this._tiles)this._setTileReloadTimer(a,this._tiles[a])}},n.prototype.update=function(e){var r=this;if(this.transform=e,this._sourceLoaded&&!this._paused){var i;this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?i=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((function(e){return new t.OverscaledTileID(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y)})):(i=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(i=i.filter((function(t){return r._source.hasTile(t)})))):i=[];var o=e.coveringZoomLevel(this._source),a=Math.max(o-n.maxOverzooming,this._source.minzoom),s=Math.max(o+n.maxUnderzooming,this._source.minzoom),u=this._updateRetainedTiles(i,o);if(It(this._source.type)){for(var l={},c={},p=0,h=Object.keys(u);p<h.length;p+=1){var f=h[p],d=u[f],v=this._tiles[f];if(v&&!(v.fadeEndTime&&v.fadeEndTime<=t.browser.now())){var m=this.findLoadedParent(d,a);m&&(this._addTile(m.tileID),l[m.tileID.key]=m.tileID),c[f]=d}}for(var y in this._retainLoadedChildren(c,o,s,u),l)u[y]||(this._coveredTiles[y]=!0,u[y]=l[y])}for(var g in u)this._tiles[g].clearFadeHold();for(var _=0,x=t.keysDifference(this._tiles,u);_<x.length;_+=1){var b=x[_],w=this._tiles[b];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(b)}this._updateLoadedParentTileCache()}},n.prototype.releaseSymbolFadeTiles=function(){for(var t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)},n.prototype._updateRetainedTiles=function(t,e){for(var r={},i={},o=Math.max(e-n.maxOverzooming,this._source.minzoom),a=Math.max(e+n.maxUnderzooming,this._source.minzoom),s={},u=0,l=t;u<l.length;u+=1){var c=l[u],p=this._addTile(c);r[c.key]=c,p.hasData()||e<this._source.maxzoom&&(s[c.key]=c)}this._retainLoadedChildren(s,e,a,r);for(var h=0,f=t;h<f.length;h+=1){var d=f[h],v=this._tiles[d.key];if(!v.hasData()){if(e+1>this._source.maxzoom){var m=d.children(this._source.maxzoom)[0],y=this.getTile(m);if(y&&y.hasData()){r[m.key]=m;continue}}else{var g=d.children(this._source.maxzoom);if(r[g[0].key]&&r[g[1].key]&&r[g[2].key]&&r[g[3].key])continue}for(var _=v.wasRequested(),x=d.overscaledZ-1;x>=o;--x){var b=d.scaledTo(x);if(i[b.key])break;if(i[b.key]=!0,!(v=this.getTile(b))&&_&&(v=this._addTile(b)),v&&(r[b.key]=b,_=v.wasRequested(),v.hasData()))break}}}return r},n.prototype._updateLoadedParentTileCache=function(){for(var t in this._loadedParentTiles={},this._tiles){for(var e=[],n=void 0,r=this._tiles[t].tileID;r.overscaledZ>0;){if(r.key in this._loadedParentTiles){n=this._loadedParentTiles[r.key];break}e.push(r.key);var i=r.scaledTo(r.overscaledZ-1);if(n=this._getLoadedTile(i))break;r=i}for(var o=0,a=e;o<a.length;o+=1)this._loadedParentTiles[a[o]]=n}},n.prototype._addTile=function(e){var n=this._tiles[e.key];if(n)return n;(n=this._cache.getAndRemove(e))&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));var r=Boolean(n);return r||(n=new t.Tile(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))),n?(n.uses++,this._tiles[e.key]=n,r||this._source.fire(new t.Event("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null},n.prototype._setTileReloadTimer=function(t,e){var n=this;t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);var r=e.getExpiryTimeout();r&&(this._timers[t]=setTimeout((function(){n._reloadTile(t,"expired"),delete n._timers[t]}),r))},n.prototype._removeTile=function(t){var e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()&&"reloading"!==e.state?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))},n.prototype.clearTiles=function(){for(var t in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(t);this._cache.reset()},n.prototype.tilesIn=function(e,n,r){var i=this,o=[],a=this.transform;if(!a)return o;for(var s=r?a.getCameraQueryGeometry(e):e,u=e.map((function(t){return a.pointCoordinate(t)})),l=s.map((function(t){return a.pointCoordinate(t)})),c=this.getIds(),p=1/0,h=1/0,f=-1/0,d=-1/0,v=0,m=l;v<m.length;v+=1){var y=m[v];p=Math.min(p,y.x),h=Math.min(h,y.y),f=Math.max(f,y.x),d=Math.max(d,y.y)}for(var g=function(e){var r=i._tiles[c[e]];if(!r.holdingForFade()){var s=r.tileID,v=Math.pow(2,a.zoom-r.tileID.overscaledZ),m=n*r.queryPadding*t.EXTENT/r.tileSize/v,y=[s.getTilePoint(new t.MercatorCoordinate(p,h)),s.getTilePoint(new t.MercatorCoordinate(f,d))];if(y[0].x-m<t.EXTENT&&y[0].y-m<t.EXTENT&&y[1].x+m>=0&&y[1].y+m>=0){var g=u.map((function(t){return s.getTilePoint(t)})),_=l.map((function(t){return s.getTilePoint(t)}));o.push({tile:r,tileID:s,queryGeometry:g,cameraQueryGeometry:_,scale:v})}}},_=0;_<c.length;_++)g(_);return o},n.prototype.getVisibleCoordinates=function(t){for(var e=this,n=this.getRenderableIds(t).map((function(t){return e._tiles[t].tileID})),r=0,i=n;r<i.length;r+=1){var o=i[r];o.posMatrix=this.transform.calculatePosMatrix(o.toUnwrapped())}return n},n.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(It(this._source.type))for(var e in this._tiles){var n=this._tiles[e];if(void 0!==n.fadeEndTime&&n.fadeEndTime>=t.browser.now())return!0}return!1},n.prototype.setFeatureState=function(t,e,n){this._state.updateState(t=t||"_geojsonTileLayer",e,n)},n.prototype.removeFeatureState=function(t,e,n){this._state.removeFeatureState(t=t||"_geojsonTileLayer",e,n)},n.prototype.getFeatureState=function(t,e){return this._state.getState(t=t||"_geojsonTileLayer",e)},n.prototype.setDependencies=function(t,e,n){var r=this._tiles[t];r&&r.setDependencies(e,n)},n.prototype.reloadTilesForDependencies=function(t,e){for(var n in this._tiles)this._tiles[n].hasDependency(t,e)&&this._reloadTile(n,"reloading");this._cache.filter((function(n){return!n.hasDependency(t,e)}))},n}(t.Evented);function Lt(t,e){var n=Math.abs(2*t.wrap)-+(t.wrap<0),r=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||r-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function It(t){return"raster"===t||"image"===t||"video"===t}function Rt(){return new t.window.Worker(Ki.workerUrl)}Ot.maxOverzooming=10,Ot.maxUnderzooming=3;var Dt="mapboxgl_preloaded_worker_pool",Nt=function(){this.active={}};Nt.prototype.acquire=function(t){if(!this.workers)for(this.workers=[];this.workers.length<Nt.workerCount;)this.workers.push(new Rt);return this.active[t]=!0,this.workers.slice()},Nt.prototype.release=function(t){delete this.active[t],0===this.numActive()&&(this.workers.forEach((function(t){t.terminate()})),this.workers=null)},Nt.prototype.isPreloaded=function(){return!!this.active[Dt]},Nt.prototype.numActive=function(){return Object.keys(this.active).length};var Zt,zt=Math.floor(t.browser.hardwareConcurrency/2);function Ft(){return Zt||(Zt=new Nt),Zt}function Bt(e,n){var r={};for(var i in e)"ref"!==i&&(r[i]=e[i]);return t.refProperties.forEach((function(t){t in n&&(r[t]=n[t])})),r}function jt(t){t=t.slice();for(var e=Object.create(null),n=0;n<t.length;n++)e[t[n].id]=t[n];for(var r=0;r<t.length;r++)"ref"in t[r]&&(t[r]=Bt(t[r],e[t[r].ref]));return t}Nt.workerCount=Math.max(Math.min(zt,6),1);var Ut={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Vt(t,e,n){n.push({command:Ut.addSource,args:[t,e[t]]})}function Gt(t,e,n){e.push({command:Ut.removeSource,args:[t]}),n[t]=!0}function Ht(t,e,n,r){Gt(t,n,r),Vt(t,e,n)}function Wt(e,n,r){var i;for(i in e[r])if(e[r].hasOwnProperty(i)&&"data"!==i&&!t.deepEqual(e[r][i],n[r][i]))return!1;for(i in n[r])if(n[r].hasOwnProperty(i)&&"data"!==i&&!t.deepEqual(e[r][i],n[r][i]))return!1;return!0}function qt(e,n,r,i,o,a){var s;for(s in n=n||{},e=e||{})e.hasOwnProperty(s)&&(t.deepEqual(e[s],n[s])||r.push({command:a,args:[i,s,n[s],o]}));for(s in n)n.hasOwnProperty(s)&&!e.hasOwnProperty(s)&&(t.deepEqual(e[s],n[s])||r.push({command:a,args:[i,s,n[s],o]}))}function Xt(t){return t.id}function Yt(t,e){return t[e.id]=e,t}var Kt=function(t,e){this.reset(t,e)};Kt.prototype.reset=function(t,e){this.points=t||[],this._distances=[0];for(var n=1;n<this.points.length;n++)this._distances[n]=this._distances[n-1]+this.points[n].dist(this.points[n-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(e||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Kt.prototype.lerp=function(e){if(1===this.points.length)return this.points[0];e=t.clamp(e,0,1);for(var n=1,r=this._distances[n],i=e*this.paddedLength+this.padding;r<i&&n<this._distances.length;)r=this._distances[++n];var o=n-1,a=this._distances[o],s=r-a,u=s>0?(i-a)/s:0;return this.points[o].mult(1-u).add(this.points[n].mult(u))};var Qt=function(t,e,n){var r=this.boxCells=[],i=this.circleCells=[];this.xCellCount=Math.ceil(t/n),this.yCellCount=Math.ceil(e/n);for(var o=0;o<this.xCellCount*this.yCellCount;o++)r.push([]),i.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0};function Jt(e,n,r,i,o){var a=t.create();return n?(t.scale(a,a,[1/o,1/o,1]),r||t.rotateZ(a,a,i.angle)):t.multiply(a,i.labelPlaneMatrix,e),a}function $t(e,n,r,i,o){if(n){var a=t.clone(e);return t.scale(a,a,[o,o,1]),r||t.rotateZ(a,a,-i.angle),a}return i.glCoordMatrix}function te(e,n){var r=[e.x,e.y,0,1];pe(r,r,n);var i=r[3];return{point:new t.Point(r[0]/i,r[1]/i),signedDistanceFromCamera:i}}function ee(t,e){return.5+t/e*.5}function ne(t,e){var n=t[0]/t[3],r=t[1]/t[3];return n>=-e[0]&&n<=e[0]&&r>=-e[1]&&r<=e[1]}function re(e,n,r,i,o,a,s,u){var l=i?e.textSizeData:e.iconSizeData,c=t.evaluateSizeForZoom(l,r.transform.zoom),p=[256/r.width*2+1,256/r.height*2+1],h=i?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;h.clear();for(var f=e.lineVertexArray,d=i?e.text.placedSymbolArray:e.icon.placedSymbolArray,v=r.transform.width/r.transform.height,m=!1,y=0;y<d.length;y++){var g=d.get(y);if(g.hidden||g.writingMode===t.WritingMode.vertical&&!m)ce(g.numGlyphs,h);else{m=!1;var _=[g.anchorX,g.anchorY,0,1];if(t.transformMat4(_,_,n),ne(_,p)){var x=ee(r.transform.cameraToCenterDistance,_[3]),b=t.evaluateSizeForFeature(l,c,g),w=s?b/x:b*x,S=new t.Point(g.anchorX,g.anchorY),E=te(S,o).point,C={},T=ae(g,w,!1,u,n,o,a,e.glyphOffsetArray,f,h,E,S,C,v);m=T.useVertical,(T.notEnoughRoom||m||T.needsFlipping&&ae(g,w,!0,u,n,o,a,e.glyphOffsetArray,f,h,E,S,C,v).notEnoughRoom)&&ce(g.numGlyphs,h)}else ce(g.numGlyphs,h)}}i?e.text.dynamicLayoutVertexBuffer.updateData(h):e.icon.dynamicLayoutVertexBuffer.updateData(h)}function ie(t,e,n,r,i,o,a,s,u,l,c){var p=s.glyphStartIndex+s.numGlyphs,h=s.lineStartIndex,f=s.lineStartIndex+s.lineLength,d=e.getoffsetX(s.glyphStartIndex),v=e.getoffsetX(p-1),m=ue(t*d,n,r,i,o,a,s.segment,h,f,u,l,c);if(!m)return null;var y=ue(t*v,n,r,i,o,a,s.segment,h,f,u,l,c);return y?{first:m,last:y}:null}function oe(e,n,r,i){return e===t.WritingMode.horizontal&&Math.abs(r.y-n.y)>Math.abs(r.x-n.x)*i?{useVertical:!0}:(e===t.WritingMode.vertical?n.y<r.y:n.x>r.x)?{needsFlipping:!0}:null}function ae(e,n,r,i,o,a,s,u,l,c,p,h,f,d){var v,m=n/24,y=e.lineOffsetX*m,g=e.lineOffsetY*m;if(e.numGlyphs>1){var _=e.glyphStartIndex+e.numGlyphs,x=e.lineStartIndex,b=e.lineStartIndex+e.lineLength,w=ie(m,u,y,g,r,p,h,e,l,a,f);if(!w)return{notEnoughRoom:!0};var S=te(w.first.point,s).point,E=te(w.last.point,s).point;if(i&&!r){var C=oe(e.writingMode,S,E,d);if(C)return C}v=[w.first];for(var T=e.glyphStartIndex+1;T<_-1;T++)v.push(ue(m*u.getoffsetX(T),y,g,r,p,h,e.segment,x,b,l,a,f));v.push(w.last)}else{if(i&&!r){var A=te(h,o).point,M=e.lineStartIndex+e.segment+1,k=new t.Point(l.getx(M),l.gety(M)),P=te(k,o),O=P.signedDistanceFromCamera>0?P.point:se(h,k,A,1,o),L=oe(e.writingMode,A,O,d);if(L)return L}var I=ue(m*u.getoffsetX(e.glyphStartIndex),y,g,r,p,h,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,l,a,f);if(!I)return{notEnoughRoom:!0};v=[I]}for(var R=0,D=v;R<D.length;R+=1){var N=D[R];t.addDynamicAttributes(c,N.point,N.angle)}return{}}function se(t,e,n,r,i){var o=te(t.add(t.sub(e)._unit()),i).point,a=n.sub(o);return n.add(a._mult(r/a.mag()))}function ue(e,n,r,i,o,a,s,u,l,c,p,h){var f=i?e-n:e+n,d=f>0?1:-1,v=0;i&&(d*=-1,v=Math.PI),d<0&&(v+=Math.PI);for(var m=d>0?u+s:u+s+1,y=o,g=o,_=0,x=0,b=Math.abs(f),w=[];_+x<=b;){if((m+=d)<u||m>=l)return null;if(g=y,w.push(y),void 0===(y=h[m])){var S=new t.Point(c.getx(m),c.gety(m)),E=te(S,p);if(E.signedDistanceFromCamera>0)y=h[m]=E.point;else{var C=m-d;y=se(0===_?a:new t.Point(c.getx(C),c.gety(C)),S,g,b-_+1,p)}}_+=x,x=g.dist(y)}var T=(b-_)/x,A=y.sub(g),M=A.mult(T)._add(g);M._add(A._unit()._perp()._mult(r*d));var k=v+Math.atan2(y.y-g.y,y.x-g.x);return w.push(M),{point:M,angle:k,path:w}}Qt.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Qt.prototype.insert=function(t,e,n,r,i){this._forEachCell(e,n,r,i,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)},Qt.prototype.insertCircle=function(t,e,n,r){this._forEachCell(e-r,n-r,e+r,n+r,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(n),this.circles.push(r)},Qt.prototype._insertBoxCell=function(t,e,n,r,i,o){this.boxCells[i].push(o)},Qt.prototype._insertCircleCell=function(t,e,n,r,i,o){this.circleCells[i].push(o)},Qt.prototype._query=function(t,e,n,r,i,o){if(n<0||t>this.width||r<0||e>this.height)return!i&&[];var a=[];if(t<=0&&e<=0&&this.width<=n&&this.height<=r){if(i)return!0;for(var s=0;s<this.boxKeys.length;s++)a.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});for(var u=0;u<this.circleKeys.length;u++){var l=this.circles[3*u],c=this.circles[3*u+1],p=this.circles[3*u+2];a.push({key:this.circleKeys[u],x1:l-p,y1:c-p,x2:l+p,y2:c+p})}return o?a.filter(o):a}return this._forEachCell(t,e,n,r,this._queryCell,a,{hitTest:i,seenUids:{box:{},circle:{}}},o),i?a.length>0:a},Qt.prototype._queryCircle=function(t,e,n,r,i){var o=t-n,a=t+n,s=e-n,u=e+n;if(a<0||o>this.width||u<0||s>this.height)return!r&&[];var l=[];return this._forEachCell(o,s,a,u,this._queryCellCircle,l,{hitTest:r,circle:{x:t,y:e,radius:n},seenUids:{box:{},circle:{}}},i),r?l.length>0:l},Qt.prototype.query=function(t,e,n,r,i){return this._query(t,e,n,r,!1,i)},Qt.prototype.hitTest=function(t,e,n,r,i){return this._query(t,e,n,r,!0,i)},Qt.prototype.hitTestCircle=function(t,e,n,r){return this._queryCircle(t,e,n,!0,r)},Qt.prototype._queryCell=function(t,e,n,r,i,o,a,s){var u=a.seenUids,l=this.boxCells[i];if(null!==l)for(var c=this.bboxes,p=0,h=l;p<h.length;p+=1){var f=h[p];if(!u.box[f]){u.box[f]=!0;var d=4*f;if(t<=c[d+2]&&e<=c[d+3]&&n>=c[d+0]&&r>=c[d+1]&&(!s||s(this.boxKeys[f]))){if(a.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[f],x1:c[d],y1:c[d+1],x2:c[d+2],y2:c[d+3]})}}}var v=this.circleCells[i];if(null!==v)for(var m=this.circles,y=0,g=v;y<g.length;y+=1){var _=g[y];if(!u.circle[_]){u.circle[_]=!0;var x=3*_;if(this._circleAndRectCollide(m[x],m[x+1],m[x+2],t,e,n,r)&&(!s||s(this.circleKeys[_]))){if(a.hitTest)return o.push(!0),!0;var b=m[x],w=m[x+1],S=m[x+2];o.push({key:this.circleKeys[_],x1:b-S,y1:w-S,x2:b+S,y2:w+S})}}}},Qt.prototype._queryCellCircle=function(t,e,n,r,i,o,a,s){var u=a.circle,l=a.seenUids,c=this.boxCells[i];if(null!==c)for(var p=this.bboxes,h=0,f=c;h<f.length;h+=1){var d=f[h];if(!l.box[d]){l.box[d]=!0;var v=4*d;if(this._circleAndRectCollide(u.x,u.y,u.radius,p[v+0],p[v+1],p[v+2],p[v+3])&&(!s||s(this.boxKeys[d])))return o.push(!0),!0}}var m=this.circleCells[i];if(null!==m)for(var y=this.circles,g=0,_=m;g<_.length;g+=1){var x=_[g];if(!l.circle[x]){l.circle[x]=!0;var b=3*x;if(this._circlesCollide(y[b],y[b+1],y[b+2],u.x,u.y,u.radius)&&(!s||s(this.circleKeys[x])))return o.push(!0),!0}}},Qt.prototype._forEachCell=function(t,e,n,r,i,o,a,s){for(var u=this._convertToXCellCoord(t),l=this._convertToYCellCoord(e),c=this._convertToXCellCoord(n),p=this._convertToYCellCoord(r),h=u;h<=c;h++)for(var f=l;f<=p;f++)if(i.call(this,t,e,n,r,this.xCellCount*f+h,o,a,s))return},Qt.prototype._convertToXCellCoord=function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))},Qt.prototype._convertToYCellCoord=function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))},Qt.prototype._circlesCollide=function(t,e,n,r,i,o){var a=r-t,s=i-e,u=n+o;return u*u>a*a+s*s},Qt.prototype._circleAndRectCollide=function(t,e,n,r,i,o,a){var s=(o-r)/2,u=Math.abs(t-(r+s));if(u>s+n)return!1;var l=(a-i)/2,c=Math.abs(e-(i+l));if(c>l+n)return!1;if(u<=s||c<=l)return!0;var p=u-s,h=c-l;return p*p+h*h<=n*n};var le=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ce(t,e){for(var n=0;n<t;n++){var r=e.length;e.resize(r+4),e.float32.set(le,3*r)}}function pe(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t[3]=n[3]*r+n[7]*i+n[15],t}var he=function(t,e,n){void 0===e&&(e=new Qt(t.width+200,t.height+200,25)),void 0===n&&(n=new Qt(t.width+200,t.height+200,25)),this.transform=t,this.grid=e,this.ignoredGrid=n,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+100,this.screenBottomBoundary=t.height+100,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200};function fe(e,n,r){return n*(t.EXTENT/(e.tileSize*Math.pow(2,r-e.tileID.overscaledZ)))}he.prototype.placeCollisionBox=function(t,e,n,r,i){var o=this.projectAndGetPerspectiveRatio(r,t.anchorPointX,t.anchorPointY),a=n*o.perspectiveRatio,s=t.x1*a+o.point.x,u=t.y1*a+o.point.y,l=t.x2*a+o.point.x,c=t.y2*a+o.point.y;return!this.isInsideGrid(s,u,l,c)||!e&&this.grid.hitTest(s,u,l,c,i)?{box:[],offscreen:!1}:{box:[s,u,l,c],offscreen:this.isOffscreen(s,u,l,c)}},he.prototype.placeCollisionCircles=function(e,n,r,i,o,a,s,u,l,c,p,h,f){var d=[],v=new t.Point(n.anchorX,n.anchorY),m=te(v,a),y=ee(this.transform.cameraToCenterDistance,m.signedDistanceFromCamera),g=(c?o/y:o*y)/t.ONE_EM,_=te(v,s).point,x=ie(g,i,n.lineOffsetX*g,n.lineOffsetY*g,!1,_,v,n,r,s,{}),b=!1,w=!1,S=!0;if(x){for(var E=.5*h*y+f,C=new t.Point(-100,-100),T=new t.Point(this.screenRightBoundary,this.screenBottomBoundary),A=new Kt,M=x.first,k=x.last,P=[],O=M.path.length-1;O>=1;O--)P.push(M.path[O]);for(var L=1;L<k.path.length;L++)P.push(k.path[L]);var I=2.5*E;if(u){var R=P.map((function(t){return te(t,u)}));P=R.some((function(t){return t.signedDistanceFromCamera<=0}))?[]:R.map((function(t){return t.point}))}var D=[];if(P.length>0){for(var N=P[0].clone(),Z=P[0].clone(),z=1;z<P.length;z++)N.x=Math.min(N.x,P[z].x),N.y=Math.min(N.y,P[z].y),Z.x=Math.max(Z.x,P[z].x),Z.y=Math.max(Z.y,P[z].y);D=N.x>=C.x&&Z.x<=T.x&&N.y>=C.y&&Z.y<=T.y?[P]:Z.x<C.x||N.x>T.x||Z.y<C.y||N.y>T.y?[]:t.clipLine([P],C.x,C.y,T.x,T.y)}for(var F=0,B=D;F<B.length;F+=1){var j;A.reset(B[F],.25*E),j=A.length<=.5*E?1:Math.ceil(A.paddedLength/I)+1;for(var U=0;U<j;U++){var V=U/Math.max(j-1,1),G=A.lerp(V),H=G.x+100,W=G.y+100;d.push(H,W,E,0);var q=H-E,X=W-E,Y=H+E,K=W+E;if(S=S&&this.isOffscreen(q,X,Y,K),w=w||this.isInsideGrid(q,X,Y,K),!e&&this.grid.hitTestCircle(H,W,E,p)&&(b=!0,!l))return{circles:[],offscreen:!1,collisionDetected:b}}}}return{circles:!l&&b||!w?[]:d,offscreen:S,collisionDetected:b}},he.prototype.queryRenderedSymbols=function(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};for(var n=[],r=1/0,i=1/0,o=-1/0,a=-1/0,s=0,u=e;s<u.length;s+=1){var l=u[s],c=new t.Point(l.x+100,l.y+100);r=Math.min(r,c.x),i=Math.min(i,c.y),o=Math.max(o,c.x),a=Math.max(a,c.y),n.push(c)}for(var p={},h={},f=0,d=this.grid.query(r,i,o,a).concat(this.ignoredGrid.query(r,i,o,a));f<d.length;f+=1){var v=d[f],m=v.key;if(void 0===p[m.bucketInstanceId]&&(p[m.bucketInstanceId]={}),!p[m.bucketInstanceId][m.featureIndex]){var y=[new t.Point(v.x1,v.y1),new t.Point(v.x2,v.y1),new t.Point(v.x2,v.y2),new t.Point(v.x1,v.y2)];t.polygonIntersectsPolygon(n,y)&&(p[m.bucketInstanceId][m.featureIndex]=!0,void 0===h[m.bucketInstanceId]&&(h[m.bucketInstanceId]=[]),h[m.bucketInstanceId].push(m.featureIndex))}}return h},he.prototype.insertCollisionBox=function(t,e,n,r,i){(e?this.ignoredGrid:this.grid).insert({bucketInstanceId:n,featureIndex:r,collisionGroupID:i},t[0],t[1],t[2],t[3])},he.prototype.insertCollisionCircles=function(t,e,n,r,i){for(var o=e?this.ignoredGrid:this.grid,a={bucketInstanceId:n,featureIndex:r,collisionGroupID:i},s=0;s<t.length;s+=4)o.insertCircle(a,t[s],t[s+1],t[s+2])},he.prototype.projectAndGetPerspectiveRatio=function(e,n,r){var i=[n,r,0,1];return pe(i,i,e),{point:new t.Point((i[0]/i[3]+1)/2*this.transform.width+100,(-i[1]/i[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/i[3]*.5}},he.prototype.isOffscreen=function(t,e,n,r){return n<100||t>=this.screenRightBoundary||r<100||e>this.screenBottomBoundary},he.prototype.isInsideGrid=function(t,e,n,r){return n>=0&&t<this.gridRightBoundary&&r>=0&&e<this.gridBottomBoundary},he.prototype.getViewportMatrix=function(){var e=t.identity([]);return t.translate(e,e,[-100,-100,0]),e};var de=function(t,e,n,r){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):r&&n?1:0,this.placed=n};de.prototype.isHidden=function(){return 0===this.opacity&&!this.placed};var ve=function(t,e,n,r,i){this.text=new de(t?t.text:null,e,n,i),this.icon=new de(t?t.icon:null,e,r,i)};ve.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var me=function(t,e,n){this.text=t,this.icon=e,this.skipFade=n},ye=function(){this.invProjMatrix=t.create(),this.viewportMatrix=t.create(),this.circles=[]},ge=function(t,e,n,r,i){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=n,this.bucketIndex=r,this.tileID=i},_e=function(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}};function xe(e,n,r,i,o){var a=t.getAnchorAlignment(e),s=-(a.horizontalAlign-.5)*n,u=-(a.verticalAlign-.5)*r,l=t.evaluateVariableOffset(e,i);return new t.Point(s+l[0]*o,u+l[1]*o)}function be(e,n,r,i,o,a){var s=e.x1,u=e.x2,l=e.y1,c=e.y2,p=e.anchorPointX,h=e.anchorPointY,f=new t.Point(n,r);return i&&f._rotate(o?a:-a),{x1:s+f.x,y1:l+f.y,x2:u+f.x,y2:c+f.y,anchorPointX:p,anchorPointY:h}}_e.prototype.get=function(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){var e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:function(t){return t.collisionGroupID===e}}}return this.collisionGroups[t]};var we=function(t,e,n,r){this.transform=t.clone(),this.collisionIndex=new he(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=e,this.retainedQueryData={},this.collisionGroups=new _e(n),this.collisionCircleArrays={},this.prevPlacement=r,r&&(r.prevPlacement=void 0),this.placedOrientations={}};function Se(t,e,n,r,i){t.emplaceBack(e?1:0,n?1:0,r||0,i||0),t.emplaceBack(e?1:0,n?1:0,r||0,i||0),t.emplaceBack(e?1:0,n?1:0,r||0,i||0),t.emplaceBack(e?1:0,n?1:0,r||0,i||0)}we.prototype.getBucketParts=function(e,n,r,i){var o=r.getBucket(n),a=r.latestFeatureIndex;if(o&&a&&n.id===o.layerIds[0]){var s=r.collisionBoxArray,u=o.layers[0].layout,l=Math.pow(2,this.transform.zoom-r.tileID.overscaledZ),c=r.tileSize/t.EXTENT,p=this.transform.calculatePosMatrix(r.tileID.toUnwrapped()),h="map"===u.get("text-pitch-alignment"),f="map"===u.get("text-rotation-alignment"),d=fe(r,1,this.transform.zoom),v=Jt(p,h,f,this.transform,d),m=null;if(h){var y=$t(p,h,f,this.transform,d);m=t.multiply([],this.transform.labelPlaneMatrix,y)}this.retainedQueryData[o.bucketInstanceId]=new ge(o.bucketInstanceId,a,o.sourceLayerIndex,o.index,r.tileID);var g={bucket:o,layout:u,posMatrix:p,textLabelPlaneMatrix:v,labelToScreenMatrix:m,scale:l,textPixelRatio:c,holdingForFade:r.holdingForFade(),collisionBoxArray:s,partiallyEvaluatedTextSize:t.evaluateSizeForZoom(o.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(o.sourceID)};if(i)for(var _=0,x=o.sortKeyRanges;_<x.length;_+=1){var b=x[_];e.push({sortKey:b.sortKey,symbolInstanceStart:b.symbolInstanceStart,symbolInstanceEnd:b.symbolInstanceEnd,parameters:g})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:o.symbolInstances.length,parameters:g})}},we.prototype.attemptAnchorPlacement=function(t,e,n,r,i,o,a,s,u,l,c,p,h,f,d){var v,m=[p.textOffset0,p.textOffset1],y=xe(t,n,r,m,i),g=this.collisionIndex.placeCollisionBox(be(e,y.x,y.y,o,a,this.transform.angle),c,s,u,l.predicate);if(!d||0!==this.collisionIndex.placeCollisionBox(be(d,y.x,y.y,o,a,this.transform.angle),c,s,u,l.predicate).box.length)return g.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[p.crossTileID]&&this.prevPlacement.placements[p.crossTileID]&&this.prevPlacement.placements[p.crossTileID].text&&(v=this.prevPlacement.variableOffsets[p.crossTileID].anchor),this.variableOffsets[p.crossTileID]={textOffset:m,width:n,height:r,anchor:t,textBoxScale:i,prevAnchor:v},this.markUsedJustification(h,t,p,f),h.allowVerticalPlacement&&(this.markUsedOrientation(h,f,p),this.placedOrientations[p.crossTileID]=f),{shift:y,placedGlyphBoxes:g}):void 0},we.prototype.placeLayerBucketPart=function(e,n,r){var i=this,o=e.parameters,a=o.bucket,s=o.layout,u=o.posMatrix,l=o.textLabelPlaneMatrix,c=o.labelToScreenMatrix,p=o.textPixelRatio,h=o.holdingForFade,f=o.collisionBoxArray,d=o.partiallyEvaluatedTextSize,v=o.collisionGroup,m=s.get("text-optional"),y=s.get("icon-optional"),g=s.get("text-allow-overlap"),_=s.get("icon-allow-overlap"),x="map"===s.get("text-rotation-alignment"),b="map"===s.get("text-pitch-alignment"),w="none"!==s.get("icon-text-fit"),S="viewport-y"===s.get("symbol-z-order"),E=g&&(_||!a.hasIconData()||y),C=_&&(g||!a.hasTextData()||m);!a.collisionArrays&&f&&a.deserializeCollisionBoxes(f);var T=function(e,o){if(!n[e.crossTileID])if(h)i.placements[e.crossTileID]=new me(!1,!1,!1);else{var f,S=!1,T=!1,A=!0,M=null,k={box:null,offscreen:null},P={box:null,offscreen:null},O=null,L=null,I=0,R=0,D=0;o.textFeatureIndex?I=o.textFeatureIndex:e.useRuntimeCollisionCircles&&(I=e.featureIndex),o.verticalTextFeatureIndex&&(R=o.verticalTextFeatureIndex);var N=o.textBox;if(N){var Z=function(n){var r=t.WritingMode.horizontal;if(a.allowVerticalPlacement&&!n&&i.prevPlacement){var o=i.prevPlacement.placedOrientations[e.crossTileID];o&&(i.placedOrientations[e.crossTileID]=o,i.markUsedOrientation(a,r=o,e))}return r},z=function(n,r){if(a.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&o.verticalTextBox)for(var i=0,s=a.writingModes;i<s.length&&(s[i]===t.WritingMode.vertical?(k=r(),P=k):k=n(),!(k&&k.box&&k.box.length));i+=1);else k=n()};if(s.get("text-variable-anchor")){var F=s.get("text-variable-anchor");if(i.prevPlacement&&i.prevPlacement.variableOffsets[e.crossTileID]){var B=i.prevPlacement.variableOffsets[e.crossTileID];F.indexOf(B.anchor)>0&&(F=F.filter((function(t){return t!==B.anchor}))).unshift(B.anchor)}var j=function(t,n,r){for(var o=t.x2-t.x1,s=t.y2-t.y1,l=e.textBoxScale,c=w&&!_?n:null,h={box:[],offscreen:!1},f=g?2*F.length:F.length,d=0;d<f;++d){var m=i.attemptAnchorPlacement(F[d%F.length],t,o,s,l,x,b,p,u,v,d>=F.length,e,a,r,c);if(m&&(h=m.placedGlyphBoxes)&&h.box&&h.box.length){S=!0,M=m.shift;break}}return h};z((function(){return j(N,o.iconBox,t.WritingMode.horizontal)}),(function(){var n=o.verticalTextBox;return a.allowVerticalPlacement&&!(k&&k.box&&k.box.length)&&e.numVerticalGlyphVertices>0&&n?j(n,o.verticalIconBox,t.WritingMode.vertical):{box:null,offscreen:null}})),k&&(S=k.box,A=k.offscreen);var U=Z(k&&k.box);if(!S&&i.prevPlacement){var V=i.prevPlacement.variableOffsets[e.crossTileID];V&&(i.variableOffsets[e.crossTileID]=V,i.markUsedJustification(a,V.anchor,e,U))}}else{var G=function(t,n){var r=i.collisionIndex.placeCollisionBox(t,g,p,u,v.predicate);return r&&r.box&&r.box.length&&(i.markUsedOrientation(a,n,e),i.placedOrientations[e.crossTileID]=n),r};z((function(){return G(N,t.WritingMode.horizontal)}),(function(){var n=o.verticalTextBox;return a.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&n?G(n,t.WritingMode.vertical):{box:null,offscreen:null}})),Z(k&&k.box&&k.box.length)}}if(S=(f=k)&&f.box&&f.box.length>0,A=f&&f.offscreen,e.useRuntimeCollisionCircles){var H=a.text.placedSymbolArray.get(e.centerJustifiedTextSymbolIndex),W=t.evaluateSizeForFeature(a.textSizeData,d,H),q=s.get("text-padding");O=i.collisionIndex.placeCollisionCircles(g,H,a.lineVertexArray,a.glyphOffsetArray,W,u,l,c,r,b,v.predicate,e.collisionCircleDiameter,q),S=g||O.circles.length>0&&!O.collisionDetected,A=A&&O.offscreen}if(o.iconFeatureIndex&&(D=o.iconFeatureIndex),o.iconBox){var X=function(t){var e=w&&M?be(t,M.x,M.y,x,b,i.transform.angle):t;return i.collisionIndex.placeCollisionBox(e,_,p,u,v.predicate)};T=P&&P.box&&P.box.length&&o.verticalIconBox?(L=X(o.verticalIconBox)).box.length>0:(L=X(o.iconBox)).box.length>0,A=A&&L.offscreen}var Y=m||0===e.numHorizontalGlyphVertices&&0===e.numVerticalGlyphVertices,K=y||0===e.numIconVertices;if(Y||K?K?Y||(T=T&&S):S=T&&S:T=S=T&&S,S&&f&&f.box&&i.collisionIndex.insertCollisionBox(f.box,s.get("text-ignore-placement"),a.bucketInstanceId,P&&P.box&&R?R:I,v.ID),T&&L&&i.collisionIndex.insertCollisionBox(L.box,s.get("icon-ignore-placement"),a.bucketInstanceId,D,v.ID),O&&(S&&i.collisionIndex.insertCollisionCircles(O.circles,s.get("text-ignore-placement"),a.bucketInstanceId,I,v.ID),r)){var Q=a.bucketInstanceId,J=i.collisionCircleArrays[Q];void 0===J&&(J=i.collisionCircleArrays[Q]=new ye);for(var $=0;$<O.circles.length;$+=4)J.circles.push(O.circles[$+0]),J.circles.push(O.circles[$+1]),J.circles.push(O.circles[$+2]),J.circles.push(O.collisionDetected?1:0)}i.placements[e.crossTileID]=new me(S||E,T||C,A||a.justReloaded),n[e.crossTileID]=!0}};if(S)for(var A=a.getSortedSymbolIndexes(this.transform.angle),M=A.length-1;M>=0;--M){var k=A[M];T(a.symbolInstances.get(k),a.collisionArrays[k])}else for(var P=e.symbolInstanceStart;P<e.symbolInstanceEnd;P++)T(a.symbolInstances.get(P),a.collisionArrays[P]);if(r&&a.bucketInstanceId in this.collisionCircleArrays){var O=this.collisionCircleArrays[a.bucketInstanceId];t.invert(O.invProjMatrix,u),O.viewportMatrix=this.collisionIndex.getViewportMatrix()}a.justReloaded=!1},we.prototype.markUsedJustification=function(e,n,r,i){var o;o=i===t.WritingMode.vertical?r.verticalPlacedTextSymbolIndex:{left:r.leftJustifiedTextSymbolIndex,center:r.centerJustifiedTextSymbolIndex,right:r.rightJustifiedTextSymbolIndex}[t.getAnchorJustification(n)];for(var a=0,s=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex,r.verticalPlacedTextSymbolIndex];a<s.length;a+=1){var u=s[a];u>=0&&(e.text.placedSymbolArray.get(u).crossTileID=o>=0&&u!==o?0:r.crossTileID)}},we.prototype.markUsedOrientation=function(e,n,r){for(var i=n===t.WritingMode.horizontal||n===t.WritingMode.horizontalOnly?n:0,o=n===t.WritingMode.vertical?n:0,a=0,s=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex];a<s.length;a+=1)e.text.placedSymbolArray.get(s[a]).placedOrientation=i;r.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(r.verticalPlacedTextSymbolIndex).placedOrientation=o)},we.prototype.commit=function(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;var e=this.prevPlacement,n=!1;this.prevZoomAdjustment=e?e.zoomAdjustment(this.transform.zoom):0;var r=e?e.symbolFadeChange(t):1,i=e?e.opacities:{},o=e?e.variableOffsets:{},a=e?e.placedOrientations:{};for(var s in this.placements){var u=this.placements[s],l=i[s];l?(this.opacities[s]=new ve(l,r,u.text,u.icon),n=n||u.text!==l.text.placed||u.icon!==l.icon.placed):(this.opacities[s]=new ve(null,r,u.text,u.icon,u.skipFade),n=n||u.text||u.icon)}for(var c in i){var p=i[c];if(!this.opacities[c]){var h=new ve(p,r,!1,!1);h.isHidden()||(this.opacities[c]=h,n=n||p.text.placed||p.icon.placed)}}for(var f in o)this.variableOffsets[f]||!this.opacities[f]||this.opacities[f].isHidden()||(this.variableOffsets[f]=o[f]);for(var d in a)this.placedOrientations[d]||!this.opacities[d]||this.opacities[d].isHidden()||(this.placedOrientations[d]=a[d]);n?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t)},we.prototype.updateLayerOpacities=function(t,e){for(var n={},r=0,i=e;r<i.length;r+=1){var o=i[r],a=o.getBucket(t);a&&o.latestFeatureIndex&&t.id===a.layerIds[0]&&this.updateBucketOpacities(a,n,o.collisionBoxArray)}},we.prototype.updateBucketOpacities=function(e,n,r){var i=this;e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();var o=e.layers[0].layout,a=new ve(null,0,!1,!1,!0),s=o.get("text-allow-overlap"),u=o.get("icon-allow-overlap"),l=o.get("text-variable-anchor"),c="map"===o.get("text-rotation-alignment"),p="map"===o.get("text-pitch-alignment"),h="none"!==o.get("icon-text-fit"),f=new ve(null,0,s&&(u||!e.hasIconData()||o.get("icon-optional")),u&&(s||!e.hasTextData()||o.get("text-optional")),!0);!e.collisionArrays&&r&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(r);for(var d=function(t,e,n){for(var r=0;r<e/4;r++)t.opacityVertexArray.emplaceBack(n)},v=function(r){var o=e.symbolInstances.get(r),s=o.numHorizontalGlyphVertices,u=o.numVerticalGlyphVertices,v=o.crossTileID,m=i.opacities[v];n[v]?m=a:m||(i.opacities[v]=m=f),n[v]=!0;var y=o.numIconVertices>0,g=i.placedOrientations[o.crossTileID],_=g===t.WritingMode.vertical,x=g===t.WritingMode.horizontal||g===t.WritingMode.horizontalOnly;if(s>0||u>0){var b=Oe(m.text);d(e.text,s,_?Le:b),d(e.text,u,x?Le:b);var w=m.text.isHidden();[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((function(t){t>=0&&(e.text.placedSymbolArray.get(t).hidden=w||_?1:0)})),o.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(o.verticalPlacedTextSymbolIndex).hidden=w||x?1:0);var S=i.variableOffsets[o.crossTileID];S&&i.markUsedJustification(e,S.anchor,o,g);var E=i.placedOrientations[o.crossTileID];E&&(i.markUsedJustification(e,"left",o,E),i.markUsedOrientation(e,E,o))}if(y){var C=Oe(m.icon),T=!(h&&o.verticalPlacedIconSymbolIndex&&_);o.placedIconSymbolIndex>=0&&(d(e.icon,o.numIconVertices,T?C:Le),e.icon.placedSymbolArray.get(o.placedIconSymbolIndex).hidden=m.icon.isHidden()),o.verticalPlacedIconSymbolIndex>=0&&(d(e.icon,o.numVerticalIconVertices,T?Le:C),e.icon.placedSymbolArray.get(o.verticalPlacedIconSymbolIndex).hidden=m.icon.isHidden())}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){var A=e.collisionArrays[r];if(A){var M=new t.Point(0,0);if(A.textBox||A.verticalTextBox){var k=!0;if(l){var P=i.variableOffsets[v];P?(M=xe(P.anchor,P.width,P.height,P.textOffset,P.textBoxScale),c&&M._rotate(p?i.transform.angle:-i.transform.angle)):k=!1}A.textBox&&Se(e.textCollisionBox.collisionVertexArray,m.text.placed,!k||_,M.x,M.y),A.verticalTextBox&&Se(e.textCollisionBox.collisionVertexArray,m.text.placed,!k||x,M.x,M.y)}var O=Boolean(!x&&A.verticalIconBox);A.iconBox&&Se(e.iconCollisionBox.collisionVertexArray,m.icon.placed,O,h?M.x:0,h?M.y:0),A.verticalIconBox&&Se(e.iconCollisionBox.collisionVertexArray,m.icon.placed,!O,h?M.x:0,h?M.y:0)}}},m=0;m<e.symbolInstances.length;m++)v(m);if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.bucketInstanceId in this.collisionCircleArrays){var y=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=y.invProjMatrix,e.placementViewportMatrix=y.viewportMatrix,e.collisionCircleArray=y.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}},we.prototype.symbolFadeChange=function(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},we.prototype.zoomAdjustment=function(t){return Math.max(0,(this.transform.zoom-t)/1.5)},we.prototype.hasTransitions=function(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration},we.prototype.stillRecent=function(t,e){var n=this.zoomAtLastRecencyCheck===e?1-this.zoomAdjustment(e):1;return this.zoomAtLastRecencyCheck=e,this.commitTime+this.fadeDuration*n>t},we.prototype.setStale=function(){this.stale=!0};var Ee=Math.pow(2,25),Ce=Math.pow(2,24),Te=Math.pow(2,17),Ae=Math.pow(2,16),Me=Math.pow(2,9),ke=Math.pow(2,8),Pe=Math.pow(2,1);function Oe(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;var e=t.placed?1:0,n=Math.floor(127*t.opacity);return n*Ee+e*Ce+n*Te+e*Ae+n*Me+e*ke+n*Pe+e}var Le=0,Ie=function(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&void 0!==t.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Ie.prototype.continuePlacement=function(t,e,n,r,i){for(var o=this._bucketParts;this._currentTileIndex<t.length;)if(e.getBucketParts(o,r,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,i())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort((function(t,e){return t.sortKey-e.sortKey})));this._currentPartIndex<o.length;)if(e.placeLayerBucketPart(o[this._currentPartIndex],this._seenCrossTileIDs,n),this._currentPartIndex++,i())return!0;return!1};var Re=function(t,e,n,r,i,o,a){this.placement=new we(t,i,o,a),this._currentPlacementIndex=e.length-1,this._forceFullPlacement=n,this._showCollisionBoxes=r,this._done=!1};Re.prototype.isDone=function(){return this._done},Re.prototype.continuePlacement=function(e,n,r){for(var i=this,o=t.browser.now(),a=function(){var e=t.browser.now()-o;return!i._forceFullPlacement&&e>2};this._currentPlacementIndex>=0;){var s=n[e[this._currentPlacementIndex]],u=this.placement.collisionIndex.transform.zoom;if("symbol"===s.type&&(!s.minzoom||s.minzoom<=u)&&(!s.maxzoom||s.maxzoom>u)){if(this._inProgressLayer||(this._inProgressLayer=new Ie(s)),this._inProgressLayer.continuePlacement(r[s.source],this.placement,this._showCollisionBoxes,s,a))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Re.prototype.commit=function(t){return this.placement.commit(t),this.placement};var De=512/t.EXTENT/2,Ne=function(t,e,n){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=n;for(var r=0;r<e.length;r++){var i=e.get(r),o=i.key;this.indexedSymbolInstances[o]||(this.indexedSymbolInstances[o]=[]),this.indexedSymbolInstances[o].push({crossTileID:i.crossTileID,coord:this.getScaledCoordinates(i,t)})}};Ne.prototype.getScaledCoordinates=function(e,n){var r=De/Math.pow(2,n.canonical.z-this.tileID.canonical.z);return{x:Math.floor((n.canonical.x*t.EXTENT+e.anchorX)*r),y:Math.floor((n.canonical.y*t.EXTENT+e.anchorY)*r)}},Ne.prototype.findMatches=function(t,e,n){for(var r=this.tileID.canonical.z<e.canonical.z?1:Math.pow(2,this.tileID.canonical.z-e.canonical.z),i=0;i<t.length;i++){var o=t.get(i);if(!o.crossTileID){var a=this.indexedSymbolInstances[o.key];if(a)for(var s=this.getScaledCoordinates(o,e),u=0,l=a;u<l.length;u+=1){var c=l[u];if(Math.abs(c.coord.x-s.x)<=r&&Math.abs(c.coord.y-s.y)<=r&&!n[c.crossTileID]){n[c.crossTileID]=!0,o.crossTileID=c.crossTileID;break}}}}};var Ze=function(){this.maxCrossTileID=0};Ze.prototype.generate=function(){return++this.maxCrossTileID};var ze=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};ze.prototype.handleWrapJump=function(t){var e=Math.round((t-this.lng)/360);if(0!==e)for(var n in this.indexes){var r=this.indexes[n],i={};for(var o in r){var a=r[o];a.tileID=a.tileID.unwrapTo(a.tileID.wrap+e),i[a.tileID.key]=a}this.indexes[n]=i}this.lng=t},ze.prototype.addBucket=function(t,e,n){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(var r=0;r<e.symbolInstances.length;r++)e.symbolInstances.get(r).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});var i=this.usedCrossTileIDs[t.overscaledZ];for(var o in this.indexes){var a=this.indexes[o];if(Number(o)>t.overscaledZ)for(var s in a){var u=a[s];u.tileID.isChildOf(t)&&u.findMatches(e.symbolInstances,t,i)}else{var l=a[t.scaledTo(Number(o)).key];l&&l.findMatches(e.symbolInstances,t,i)}}for(var c=0;c<e.symbolInstances.length;c++){var p=e.symbolInstances.get(c);p.crossTileID||(p.crossTileID=n.generate(),i[p.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Ne(t,e.symbolInstances,e.bucketInstanceId),!0},ze.prototype.removeBucketCrossTileIDs=function(t,e){for(var n in e.indexedSymbolInstances)for(var r=0,i=e.indexedSymbolInstances[n];r<i.length;r+=1)delete this.usedCrossTileIDs[t][i[r].crossTileID]},ze.prototype.removeStaleBuckets=function(t){var e=!1;for(var n in this.indexes){var r=this.indexes[n];for(var i in r)t[r[i].bucketInstanceId]||(this.removeBucketCrossTileIDs(n,r[i]),delete r[i],e=!0)}return e};var Fe=function(){this.layerIndexes={},this.crossTileIDs=new Ze,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Fe.prototype.addLayer=function(t,e,n){var r=this.layerIndexes[t.id];void 0===r&&(r=this.layerIndexes[t.id]=new ze);var i=!1,o={};r.handleWrapJump(n);for(var a=0,s=e;a<s.length;a+=1){var u=s[a],l=u.getBucket(t);l&&t.id===l.layerIds[0]&&(l.bucketInstanceId||(l.bucketInstanceId=++this.maxBucketInstanceId),r.addBucket(u.tileID,l,this.crossTileIDs)&&(i=!0),o[l.bucketInstanceId]=!0)}return r.removeStaleBuckets(o)&&(i=!0),i},Fe.prototype.pruneUnusedLayers=function(t){var e={};for(var n in t.forEach((function(t){e[t]=!0})),this.layerIndexes)e[n]||delete this.layerIndexes[n]};var Be=function(e,n){return t.emitValidationErrors(e,n&&n.filter((function(t){return"source.canvas"!==t.identifier})))},je=t.pick(Ut,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Ue=t.pick(Ut,["setCenter","setZoom","setBearing","setPitch"]),Ve=function(){var e={},n=t.styleSpec.$version;for(var r in t.styleSpec.$root){var i,o=t.styleSpec.$root[r];o.required&&null!=(i="version"===r?n:"array"===o.type?[]:{})&&(e[r]=i)}return e}(),Ge=function(e){function n(r,i){var o=this;void 0===i&&(i={}),e.call(this),this.map=r,this.dispatcher=new C(Ft(),this),this.imageManager=new f,this.imageManager.setEventedParent(this),this.glyphManager=new x(r._requestManager,i.localIdeographFontFamily),this.lineAtlas=new E(256,512),this.crossTileSymbolIndex=new Fe,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new t.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",t.getReferrer());var a=this;this._rtlTextPluginCallback=n.registerForPluginStateChange((function(e){a.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:e.pluginStatus,pluginURL:e.pluginURL},(function(e,n){if(t.triggerPluginCompletionEvent(e),n&&n.every((function(t){return t})))for(var r in a.sourceCaches)a.sourceCaches[r].reload()}))})),this.on("data",(function(t){if("source"===t.dataType&&"metadata"===t.sourceDataType){var e=o.sourceCaches[t.sourceId];if(e){var n=e.getSource();if(n&&n.vectorLayerIds)for(var r in o._layers){var i=o._layers[r];i.source===n.id&&o._validateLayer(i)}}}}))}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.loadURL=function(e,n){var r=this;void 0===n&&(n={}),this.fire(new t.Event("dataloading",{dataType:"style"}));var i="boolean"==typeof n.validate?n.validate:!t.isMapboxURL(e);e=this.map._requestManager.normalizeStyleURL(e,n.accessToken);var o=this.map._requestManager.transformRequest(e,t.ResourceType.Style);this._request=t.getJSON(o,(function(e,n){r._request=null,e?r.fire(new t.ErrorEvent(e)):n&&r._load(n,i)}))},n.prototype.loadJSON=function(e,n){var r=this;void 0===n&&(n={}),this.fire(new t.Event("dataloading",{dataType:"style"})),this._request=t.browser.frame((function(){r._request=null,r._load(e,!1!==n.validate)}))},n.prototype.loadEmpty=function(){this.fire(new t.Event("dataloading",{dataType:"style"})),this._load(Ve,!1)},n.prototype._load=function(e,n){if(!n||!Be(this,t.validateStyle(e))){for(var r in this._loaded=!0,this.stylesheet=e,e.sources)this.addSource(r,e.sources[r],{validate:!1});e.sprite?this._loadSprite(e.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(e.glyphs);var i=jt(this.stylesheet.layers);this._order=i.map((function(t){return t.id})),this._layers={},this._serializedLayers={};for(var o=0,a=i;o<a.length;o+=1){var s=a[o];(s=t.createStyleLayer(s)).setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=s,this._serializedLayers[s.id]=s.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new S(this.stylesheet.light),this.fire(new t.Event("data",{dataType:"style"})),this.fire(new t.Event("style.load"))}},n.prototype._loadSprite=function(e){var n=this;this._spriteRequest=function(e,n,r){var i,o,a,s=t.browser.devicePixelRatio>1?"@2x":"",u=t.getJSON(n.transformRequest(n.normalizeSpriteURL(e,s,".json"),t.ResourceType.SpriteJSON),(function(t,e){u=null,a||(a=t,i=e,c())})),l=t.getImage(n.transformRequest(n.normalizeSpriteURL(e,s,".png"),t.ResourceType.SpriteImage),(function(t,e){l=null,a||(a=t,o=e,c())}));function c(){if(a)r(a);else if(i&&o){var e=t.browser.getImageData(o),n={};for(var s in i){var u=i[s],l=u.width,c=u.height,p=u.x,h=u.y,f=u.sdf,d=u.pixelRatio,v=u.stretchX,m=u.stretchY,y=u.content,g=new t.RGBAImage({width:l,height:c});t.RGBAImage.copy(e,g,{x:p,y:h},{x:0,y:0},{width:l,height:c}),n[s]={data:g,pixelRatio:d,sdf:f,stretchX:v,stretchY:m,content:y}}r(null,n)}}return{cancel:function(){u&&(u.cancel(),u=null),l&&(l.cancel(),l=null)}}}(e,this.map._requestManager,(function(e,r){if(n._spriteRequest=null,e)n.fire(new t.ErrorEvent(e));else if(r)for(var i in r)n.imageManager.addImage(i,r[i]);n.imageManager.setLoaded(!0),n._availableImages=n.imageManager.listImages(),n.dispatcher.broadcast("setImages",n._availableImages),n.fire(new t.Event("data",{dataType:"style"}))}))},n.prototype._validateLayer=function(e){var n=this.sourceCaches[e.source];if(n){var r=e.sourceLayer;if(r){var i=n.getSource();("geojson"===i.type||i.vectorLayerIds&&-1===i.vectorLayerIds.indexOf(r))&&this.fire(new t.ErrorEvent(new Error('Source layer "'+r+'" does not exist on source "'+i.id+'" as specified by style layer "'+e.id+'"')))}}},n.prototype.loaded=function(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(var t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()},n.prototype._serializeLayers=function(t){for(var e=[],n=0,r=t;n<r.length;n+=1){var i=this._layers[r[n]];"custom"!==i.type&&e.push(i.serialize())}return e},n.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(var e in this._layers)if(this._layers[e].hasTransition())return!0;return!1},n.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},n.prototype.update=function(e){if(this._loaded){var n=this._changed;if(this._changed){var r=Object.keys(this._updatedLayers),i=Object.keys(this._removedLayers);for(var o in(r.length||i.length)&&this._updateWorkerLayers(r,i),this._updatedSources){var a=this._updatedSources[o];"reload"===a?this._reloadSource(o):"clear"===a&&this._clearSource(o)}for(var s in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[s].updateTransitions(e);this.light.updateTransitions(e),this._resetUpdates()}var u={};for(var l in this.sourceCaches){var c=this.sourceCaches[l];u[l]=c.used,c.used=!1}for(var p=0,h=this._order;p<h.length;p+=1){var f=this._layers[h[p]];f.recalculate(e,this._availableImages),!f.isHidden(e.zoom)&&f.source&&(this.sourceCaches[f.source].used=!0)}for(var d in u){var v=this.sourceCaches[d];u[d]!==v.used&&v.fire(new t.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:d}))}this.light.recalculate(e),this.z=e.zoom,n&&this.fire(new t.Event("data",{dataType:"style"}))}},n.prototype._updateTilesForChangedImages=function(){var t=Object.keys(this._changedImages);if(t.length){for(var e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}},n.prototype._updateWorkerLayers=function(t,e){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:e})},n.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},n.prototype.setState=function(e){var n=this;if(this._checkLoaded(),Be(this,t.validateStyle(e)))return!1;(e=t.clone$1(e)).layers=jt(e.layers);var i=function(e,n){if(!e)return[{command:Ut.setStyle,args:[n]}];var i=[];try{if(!t.deepEqual(e.version,n.version))return[{command:Ut.setStyle,args:[n]}];t.deepEqual(e.center,n.center)||i.push({command:Ut.setCenter,args:[n.center]}),t.deepEqual(e.zoom,n.zoom)||i.push({command:Ut.setZoom,args:[n.zoom]}),t.deepEqual(e.bearing,n.bearing)||i.push({command:Ut.setBearing,args:[n.bearing]}),t.deepEqual(e.pitch,n.pitch)||i.push({command:Ut.setPitch,args:[n.pitch]}),t.deepEqual(e.sprite,n.sprite)||i.push({command:Ut.setSprite,args:[n.sprite]}),t.deepEqual(e.glyphs,n.glyphs)||i.push({command:Ut.setGlyphs,args:[n.glyphs]}),t.deepEqual(e.transition,n.transition)||i.push({command:Ut.setTransition,args:[n.transition]}),t.deepEqual(e.light,n.light)||i.push({command:Ut.setLight,args:[n.light]});var o={},a=[];!function(e,n,r,i){var o;for(o in n=n||{},e=e||{})e.hasOwnProperty(o)&&(n.hasOwnProperty(o)||Gt(o,r,i));for(o in n)n.hasOwnProperty(o)&&(e.hasOwnProperty(o)?t.deepEqual(e[o],n[o])||("geojson"===e[o].type&&"geojson"===n[o].type&&Wt(e,n,o)?r.push({command:Ut.setGeoJSONSourceData,args:[o,n[o].data]}):Ht(o,n,r,i)):Vt(o,n,r))}(e.sources,n.sources,a,o);var s=[];e.layers&&e.layers.forEach((function(t){o[t.source]?i.push({command:Ut.removeLayer,args:[t.id]}):s.push(t)})),i=i.concat(a),function(e,n,r){n=n||[];var i,o,a,s,u,l,c,p=(e=e||[]).map(Xt),h=n.map(Xt),f=e.reduce(Yt,{}),d=n.reduce(Yt,{}),v=p.slice(),m=Object.create(null);for(i=0,o=0;i<p.length;i++)d.hasOwnProperty(a=p[i])?o++:(r.push({command:Ut.removeLayer,args:[a]}),v.splice(v.indexOf(a,o),1));for(i=0,o=0;i<h.length;i++)v[v.length-1-i]!==(a=h[h.length-1-i])&&(f.hasOwnProperty(a)?(r.push({command:Ut.removeLayer,args:[a]}),v.splice(v.lastIndexOf(a,v.length-o),1)):o++,r.push({command:Ut.addLayer,args:[d[a],l=v[v.length-i]]}),v.splice(v.length-i,0,a),m[a]=!0);for(i=0;i<h.length;i++)if(s=f[a=h[i]],u=d[a],!m[a]&&!t.deepEqual(s,u))if(t.deepEqual(s.source,u.source)&&t.deepEqual(s["source-layer"],u["source-layer"])&&t.deepEqual(s.type,u.type)){for(c in qt(s.layout,u.layout,r,a,null,Ut.setLayoutProperty),qt(s.paint,u.paint,r,a,null,Ut.setPaintProperty),t.deepEqual(s.filter,u.filter)||r.push({command:Ut.setFilter,args:[a,u.filter]}),t.deepEqual(s.minzoom,u.minzoom)&&t.deepEqual(s.maxzoom,u.maxzoom)||r.push({command:Ut.setLayerZoomRange,args:[a,u.minzoom,u.maxzoom]}),s)s.hasOwnProperty(c)&&"layout"!==c&&"paint"!==c&&"filter"!==c&&"metadata"!==c&&"minzoom"!==c&&"maxzoom"!==c&&(0===c.indexOf("paint.")?qt(s[c],u[c],r,a,c.slice(6),Ut.setPaintProperty):t.deepEqual(s[c],u[c])||r.push({command:Ut.setLayerProperty,args:[a,c,u[c]]}));for(c in u)u.hasOwnProperty(c)&&!s.hasOwnProperty(c)&&"layout"!==c&&"paint"!==c&&"filter"!==c&&"metadata"!==c&&"minzoom"!==c&&"maxzoom"!==c&&(0===c.indexOf("paint.")?qt(s[c],u[c],r,a,c.slice(6),Ut.setPaintProperty):t.deepEqual(s[c],u[c])||r.push({command:Ut.setLayerProperty,args:[a,c,u[c]]}))}else r.push({command:Ut.removeLayer,args:[a]}),l=v[v.lastIndexOf(a)+1],r.push({command:Ut.addLayer,args:[u,l]})}(s,n.layers,i)}catch(t){r.warn("Unable to compute style diff:",t),i=[{command:Ut.setStyle,args:[n]}]}return i}(this.serialize(),e).filter((function(t){return!(t.command in Ue)}));if(0===i.length)return!1;var o=i.filter((function(t){return!(t.command in je)}));if(o.length>0)throw new Error("Unimplemented: "+o.map((function(t){return t.command})).join(", ")+".");return i.forEach((function(t){"setTransition"!==t.command&&n[t.command].apply(n,t.args)})),this.stylesheet=e,!0},n.prototype.addImage=function(e,n){if(this.getImage(e))return this.fire(new t.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(e,n),this._afterImageUpdated(e)},n.prototype.updateImage=function(t,e){this.imageManager.updateImage(t,e)},n.prototype.getImage=function(t){return this.imageManager.getImage(t)},n.prototype.removeImage=function(e){if(!this.getImage(e))return this.fire(new t.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(e),this._afterImageUpdated(e)},n.prototype._afterImageUpdated=function(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new t.Event("data",{dataType:"style"}))},n.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},n.prototype.addSource=function(e,n,r){var i=this;if(void 0===r&&(r={}),this._checkLoaded(),void 0!==this.sourceCaches[e])throw new Error("There is already a source with this ID");if(!n.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(n).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(t.validateStyle.source,"sources."+e,n,null,r))){this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);var o=this.sourceCaches[e]=new Ot(e,n,this.dispatcher);o.style=this,o.setEventedParent(this,(function(){return{isSourceLoaded:i.loaded(),source:o.serialize(),sourceId:e}})),o.onAdd(this.map),this._changed=!0}},n.prototype.removeSource=function(e){if(this._checkLoaded(),void 0===this.sourceCaches[e])throw new Error("There is no source with this ID");for(var n in this._layers)if(this._layers[n].source===e)return this.fire(new t.ErrorEvent(new Error('Source "'+e+'" cannot be removed while layer "'+n+'" is using it.')));var r=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],r.fire(new t.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),r.setEventedParent(null),r.clearTiles(),r.onRemove&&r.onRemove(this.map),this._changed=!0},n.prototype.setGeoJSONSourceData=function(t,e){this._checkLoaded(),this.sourceCaches[t].getSource().setData(e),this._changed=!0},n.prototype.getSource=function(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()},n.prototype.addLayer=function(e,n,r){void 0===r&&(r={}),this._checkLoaded();var i=e.id;if(this.getLayer(i))this.fire(new t.ErrorEvent(new Error('Layer with id "'+i+'" already exists on this map')));else{var o;if("custom"===e.type){if(Be(this,t.validateCustomStyleLayer(e)))return;o=t.createStyleLayer(e)}else{if("object"==typeof e.source&&(this.addSource(i,e.source),e=t.clone$1(e),e=t.extend(e,{source:i})),this._validate(t.validateStyle.layer,"layers."+i,e,{arrayIndex:-1},r))return;o=t.createStyleLayer(e),this._validateLayer(o),o.setEventedParent(this,{layer:{id:i}}),this._serializedLayers[o.id]=o.serialize()}var a=n?this._order.indexOf(n):this._order.length;if(n&&-1===a)this.fire(new t.ErrorEvent(new Error('Layer with id "'+n+'" does not exist on this map.')));else{if(this._order.splice(a,0,i),this._layerOrderChanged=!0,this._layers[i]=o,this._removedLayers[i]&&o.source&&"custom"!==o.type){var s=this._removedLayers[i];delete this._removedLayers[i],s.type!==o.type?this._updatedSources[o.source]="clear":(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map)}}},n.prototype.moveLayer=function(e,n){if(this._checkLoaded(),this._changed=!0,this._layers[e]){if(e!==n){var r=this._order.indexOf(e);this._order.splice(r,1);var i=n?this._order.indexOf(n):this._order.length;n&&-1===i?this.fire(new t.ErrorEvent(new Error('Layer with id "'+n+'" does not exist on this map.'))):(this._order.splice(i,0,e),this._layerOrderChanged=!0)}}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be moved.")))},n.prototype.removeLayer=function(e){this._checkLoaded();var n=this._layers[e];if(n){n.setEventedParent(null);var r=this._order.indexOf(e);this._order.splice(r,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=n,delete this._layers[e],delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],n.onRemove&&n.onRemove(this.map)}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be removed.")))},n.prototype.getLayer=function(t){return this._layers[t]},n.prototype.hasLayer=function(t){return t in this._layers},n.prototype.setLayerZoomRange=function(e,n,r){this._checkLoaded();var i=this.getLayer(e);i?i.minzoom===n&&i.maxzoom===r||(null!=n&&(i.minzoom=n),null!=r&&(i.maxzoom=r),this._updateLayer(i)):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot have zoom extent.")))},n.prototype.setFilter=function(e,n,r){void 0===r&&(r={}),this._checkLoaded();var i=this.getLayer(e);if(i){if(!t.deepEqual(i.filter,n))return null==n?(i.filter=void 0,void this._updateLayer(i)):void(this._validate(t.validateStyle.filter,"layers."+i.id+".filter",n,null,r)||(i.filter=t.clone$1(n),this._updateLayer(i)))}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be filtered.")))},n.prototype.getFilter=function(e){return t.clone$1(this.getLayer(e).filter)},n.prototype.setLayoutProperty=function(e,n,r,i){void 0===i&&(i={}),this._checkLoaded();var o=this.getLayer(e);o?t.deepEqual(o.getLayoutProperty(n),r)||(o.setLayoutProperty(n,r,i),this._updateLayer(o)):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")))},n.prototype.getLayoutProperty=function(e,n){var r=this.getLayer(e);if(r)return r.getLayoutProperty(n);this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style.")))},n.prototype.setPaintProperty=function(e,n,r,i){void 0===i&&(i={}),this._checkLoaded();var o=this.getLayer(e);o?t.deepEqual(o.getPaintProperty(n),r)||(o.setPaintProperty(n,r,i)&&this._updateLayer(o),this._changed=!0,this._updatedPaintProps[e]=!0):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")))},n.prototype.getPaintProperty=function(t,e){return this.getLayer(t).getPaintProperty(e)},n.prototype.setFeatureState=function(e,n){this._checkLoaded();var r=e.source,i=e.sourceLayer,o=this.sourceCaches[r];if(void 0!==o){var a=o.getSource().type;"geojson"===a&&i?this.fire(new t.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==a||i?(void 0===e.id&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided."))),o.setFeatureState(i,e.id,n)):this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+r+"' does not exist in the map's style.")))},n.prototype.removeFeatureState=function(e,n){this._checkLoaded();var r=e.source,i=this.sourceCaches[r];if(void 0!==i){var o=i.getSource().type,a="vector"===o?e.sourceLayer:void 0;"vector"!==o||a?n&&"string"!=typeof e.id&&"number"!=typeof e.id?this.fire(new t.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):i.removeFeatureState(a,e.id,n):this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+r+"' does not exist in the map's style.")))},n.prototype.getFeatureState=function(e){this._checkLoaded();var n=e.source,r=e.sourceLayer,i=this.sourceCaches[n];if(void 0!==i){if("vector"!==i.getSource().type||r)return void 0===e.id&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided."))),i.getFeatureState(r,e.id);this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+n+"' does not exist in the map's style.")))},n.prototype.getTransition=function(){return t.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},n.prototype.serialize=function(){return t.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:t.mapObject(this.sourceCaches,(function(t){return t.serialize()})),layers:this._serializeLayers(this._order)},(function(t){return void 0!==t}))},n.prototype._updateLayer=function(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&"raster"!==this.sourceCaches[t.source].getSource().type&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0},n.prototype._flattenAndSortRenderedFeatures=function(t){for(var e=this,n=function(t){return"fill-extrusion"===e._layers[t].type},r={},i=[],o=this._order.length-1;o>=0;o--){var a=this._order[o];if(n(a)){r[a]=o;for(var s=0,u=t;s<u.length;s+=1){var l=u[s][a];if(l)for(var c=0,p=l;c<p.length;c+=1)i.push(p[c])}}}i.sort((function(t,e){return e.intersectionZ-t.intersectionZ}));for(var h=[],f=this._order.length-1;f>=0;f--){var d=this._order[f];if(n(d))for(var v=i.length-1;v>=0;v--){var m=i[v].feature;if(r[m.layer.id]<f)break;h.push(m),i.pop()}else for(var y=0,g=t;y<g.length;y+=1){var _=g[y][d];if(_)for(var x=0,b=_;x<b.length;x+=1)h.push(b[x].feature)}}return h},n.prototype.queryRenderedFeatures=function(e,n,r){n&&n.filter&&this._validate(t.validateStyle.filter,"queryRenderedFeatures.filter",n.filter,null,n);var i={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new t.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var o=0,a=n.layers;o<a.length;o+=1){var s=a[o],u=this._layers[s];if(!u)return this.fire(new t.ErrorEvent(new Error("The layer '"+s+"' does not exist in the map's style and cannot be queried for features."))),[];i[u.source]=!0}}var l=[];for(var c in n.availableImages=this._availableImages,this.sourceCaches)n.layers&&!i[c]||l.push(z(this.sourceCaches[c],this._layers,this._serializedLayers,e,n,r));return this.placement&&l.push(function(t,e,n,r,i,o,a){for(var s={},u=o.queryRenderedSymbols(r),l=[],c=0,p=Object.keys(u).map(Number);c<p.length;c+=1)l.push(a[p[c]]);l.sort(F);for(var h=function(){var n=d[f],r=n.featureIndex.lookupSymbolFeatures(u[n.bucketInstanceId],e,n.bucketIndex,n.sourceLayerIndex,i.filter,i.layers,i.availableImages,t);for(var o in r){var a=s[o]=s[o]||[],l=r[o];l.sort((function(t,e){var r=n.featureSortOrder;if(r){var i=r.indexOf(t.featureIndex);return r.indexOf(e.featureIndex)-i}return e.featureIndex-t.featureIndex}));for(var c=0,p=l;c<p.length;c+=1)a.push(p[c])}},f=0,d=l;f<d.length;f+=1)h();var v=function(e){s[e].forEach((function(r){var i=r.feature,o=n[t[e].source].getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=o}))};for(var m in s)v(m);return s}(this._layers,this._serializedLayers,this.sourceCaches,e,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(l)},n.prototype.querySourceFeatures=function(e,n){n&&n.filter&&this._validate(t.validateStyle.filter,"querySourceFeatures.filter",n.filter,null,n);var r=this.sourceCaches[e];return r?function(t,e){for(var n=t.getRenderableIds().map((function(e){return t.getTileByID(e)})),r=[],i={},o=0;o<n.length;o++){var a=n[o],s=a.tileID.canonical.key;i[s]||(i[s]=!0,a.querySourceFeatures(r,e))}return r}(r,n):[]},n.prototype.addSourceType=function(t,e,r){return n.getSourceType(t)?r(new Error('A source type called "'+t+'" already exists.')):(n.setSourceType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},r):r(null,null))},n.prototype.getLight=function(){return this.light.getLight()},n.prototype.setLight=function(e,n){void 0===n&&(n={}),this._checkLoaded();var r=this.light.getLight(),i=!1;for(var o in e)if(!t.deepEqual(e[o],r[o])){i=!0;break}if(i){var a={now:t.browser.now(),transition:t.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,n),this.light.updateTransitions(a)}},n.prototype._validate=function(e,n,r,i,o){return void 0===o&&(o={}),(!o||!1!==o.validate)&&Be(this,e.call(t.validateStyle,t.extend({key:n,style:this.serialize(),value:r,styleSpec:t.styleSpec},i)))},n.prototype._remove=function(){for(var e in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[e].setEventedParent(null);for(var n in this.sourceCaches)this.sourceCaches[n].clearTiles(),this.sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},n.prototype._clearSource=function(t){this.sourceCaches[t].clearTiles()},n.prototype._reloadSource=function(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()},n.prototype._updateSources=function(t){for(var e in this.sourceCaches)this.sourceCaches[e].update(t)},n.prototype._generateCollisionBoxes=function(){for(var t in this.sourceCaches)this._reloadSource(t)},n.prototype._updatePlacement=function(e,n,r,i,o){void 0===o&&(o=!1);for(var a=!1,s=!1,u={},l=0,c=this._order;l<c.length;l+=1){var p=this._layers[c[l]];if("symbol"===p.type){if(!u[p.source]){var h=this.sourceCaches[p.source];u[p.source]=h.getRenderableIds(!0).map((function(t){return h.getTileByID(t)})).sort((function(t,e){return e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1)}))}var f=this.crossTileSymbolIndex.addLayer(p,u[p.source],e.center.lng);a=a||f}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((o=o||this._layerOrderChanged||0===r)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.browser.now(),e.zoom))&&(this.pauseablePlacement=new Re(e,this._order,o,n,r,i,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,u),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.browser.now()),s=!0),a&&this.pauseablePlacement.placement.setStale()),s||a)for(var d=0,v=this._order;d<v.length;d+=1){var m=this._layers[v[d]];"symbol"===m.type&&this.placement.updateLayerOpacities(m,u[m.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.browser.now())},n.prototype._releaseSymbolFadeTiles=function(){for(var t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()},n.prototype.getImages=function(t,e,n){this.imageManager.getImages(e.icons,n),this._updateTilesForChangedImages();var r=this.sourceCaches[e.source];r&&r.setDependencies(e.tileID.key,e.type,e.icons)},n.prototype.getGlyphs=function(t,e,n){this.glyphManager.getGlyphs(e.stacks,n)},n.prototype.getResource=function(e,n,r){return t.makeRequest(n,r)},n}(t.Evented);Ge.getSourceType=function(t){return N[t]},Ge.setSourceType=function(t,e){N[t]=e},Ge.registerForPluginStateChange=t.registerForPluginStateChange;var He=t.createLayout([{name:"a_pos",type:"Int16",components:2}]),We=_n("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}"),qe=_n("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Xe=_n("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Ye=_n("varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),Ke=_n("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Qe=_n("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),Je=_n("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),$e=_n("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),tn=_n("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),en=_n("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),nn=_n("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),rn=_n("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),on=_n("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),an=_n("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),sn=_n("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),un=_n("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),ln=_n("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),cn=_n("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),pn=_n("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),hn=_n("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),fn=_n("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),dn=_n("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),vn=_n("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),mn=_n("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}"),yn=_n("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),gn=_n("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}");function _n(t,e){var n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,r=e.match(/attribute ([\w]+) ([\w]+)/g),i=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),o=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),a=o?o.concat(i):i,s={};return{fragmentSource:t=t.replace(n,(function(t,e,n,r,i){return s[i]=!0,"define"===e?"\n#ifndef HAS_UNIFORM_u_"+i+"\nvarying "+n+" "+r+" "+i+";\n#else\nuniform "+n+" "+r+" u_"+i+";\n#endif\n":"\n#ifdef HAS_UNIFORM_u_"+i+"\n    "+n+" "+r+" "+i+" = u_"+i+";\n#endif\n"})),vertexSource:e=e.replace(n,(function(t,e,n,r,i){var o="float"===r?"vec2":"vec4",a=i.match(/color/)?"color":o;return s[i]?"define"===e?"\n#ifndef HAS_UNIFORM_u_"+i+"\nuniform lowp float u_"+i+"_t;\nattribute "+n+" "+o+" a_"+i+";\nvarying "+n+" "+r+" "+i+";\n#else\nuniform "+n+" "+r+" u_"+i+";\n#endif\n":"vec4"===a?"\n#ifndef HAS_UNIFORM_u_"+i+"\n    "+i+" = a_"+i+";\n#else\n    "+n+" "+r+" "+i+" = u_"+i+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+i+"\n    "+i+" = unpack_mix_"+a+"(a_"+i+", u_"+i+"_t);\n#else\n    "+n+" "+r+" "+i+" = u_"+i+";\n#endif\n":"define"===e?"\n#ifndef HAS_UNIFORM_u_"+i+"\nuniform lowp float u_"+i+"_t;\nattribute "+n+" "+o+" a_"+i+";\n#else\nuniform "+n+" "+r+" u_"+i+";\n#endif\n":"vec4"===a?"\n#ifndef HAS_UNIFORM_u_"+i+"\n    "+n+" "+r+" "+i+" = a_"+i+";\n#else\n    "+n+" "+r+" "+i+" = u_"+i+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+i+"\n    "+n+" "+r+" "+i+" = unpack_mix_"+a+"(a_"+i+", u_"+i+"_t);\n#else\n    "+n+" "+r+" "+i+" = u_"+i+";\n#endif\n"})),staticAttributes:r,staticUniforms:a}}var xn=Object.freeze({__proto__:null,prelude:We,background:qe,backgroundPattern:Xe,circle:Ye,clippingMask:Ke,heatmap:Qe,heatmapTexture:Je,collisionBox:$e,collisionCircle:tn,debug:en,fill:nn,fillOutline:rn,fillOutlinePattern:on,fillPattern:an,fillExtrusion:sn,fillExtrusionPattern:un,hillshadePrepare:ln,hillshade:cn,line:pn,lineGradient:hn,linePattern:fn,lineSDF:dn,raster:vn,symbolIcon:mn,symbolSDF:yn,symbolTextAndIcon:gn}),bn=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function wn(t){for(var e=[],n=0;n<t.length;n++)if(null!==t[n]){var r=t[n].split(" ");e.push(r.pop())}return e}bn.prototype.bind=function(t,e,n,r,i,o,a,s){this.context=t;for(var u=this.boundPaintVertexBuffers.length!==r.length,l=0;!u&&l<r.length;l++)this.boundPaintVertexBuffers[l]!==r[l]&&(u=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===e&&this.boundLayoutVertexBuffer===n&&!u&&this.boundIndexBuffer===i&&this.boundVertexOffset===o&&this.boundDynamicVertexBuffer===a&&this.boundDynamicVertexBuffer2===s?(t.bindVertexArrayOES.set(this.vao),a&&a.bind(),i&&i.dynamicDraw&&i.bind(),s&&s.bind()):this.freshBind(e,n,r,i,o,a,s)},bn.prototype.freshBind=function(t,e,n,r,i,o,a){var s,u=t.numAttributes,l=this.context,c=l.gl;if(l.extVertexArrayObject)this.vao&&this.destroy(),this.vao=l.extVertexArrayObject.createVertexArrayOES(),l.bindVertexArrayOES.set(this.vao),s=0,this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=n,this.boundIndexBuffer=r,this.boundVertexOffset=i,this.boundDynamicVertexBuffer=o,this.boundDynamicVertexBuffer2=a;else{s=l.currentNumAttributes||0;for(var p=u;p<s;p++)c.disableVertexAttribArray(p)}e.enableAttributes(c,t);for(var h=0,f=n;h<f.length;h+=1)f[h].enableAttributes(c,t);o&&o.enableAttributes(c,t),a&&a.enableAttributes(c,t),e.bind(),e.setVertexAttribPointers(c,t,i);for(var d=0,v=n;d<v.length;d+=1){var m=v[d];m.bind(),m.setVertexAttribPointers(c,t,i)}o&&(o.bind(),o.setVertexAttribPointers(c,t,i)),r&&r.bind(),a&&(a.bind(),a.setVertexAttribPointers(c,t,i)),l.currentNumAttributes=u},bn.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var Sn=function(t,e,n,r,i,o){var a=t.gl;this.program=a.createProgram();for(var s=wn(n.staticAttributes),u=r?r.getBinderAttributes():[],l=s.concat(u),c=n.staticUniforms?wn(n.staticUniforms):[],p=r?r.getBinderUniforms():[],h=[],f=0,d=c.concat(p);f<d.length;f+=1){var v=d[f];h.indexOf(v)<0&&h.push(v)}var m=r?r.defines():[];o&&m.push("#define OVERDRAW_INSPECTOR;");var y=m.concat(We.fragmentSource,n.fragmentSource).join("\n"),g=m.concat(We.vertexSource,n.vertexSource).join("\n"),_=a.createShader(a.FRAGMENT_SHADER);if(a.isContextLost())this.failedToCreate=!0;else{a.shaderSource(_,y),a.compileShader(_),a.attachShader(this.program,_);var x=a.createShader(a.VERTEX_SHADER);if(a.isContextLost())this.failedToCreate=!0;else{a.shaderSource(x,g),a.compileShader(x),a.attachShader(this.program,x),this.attributes={};var b={};this.numAttributes=l.length;for(var w=0;w<this.numAttributes;w++)l[w]&&(a.bindAttribLocation(this.program,w,l[w]),this.attributes[l[w]]=w);a.linkProgram(this.program),a.deleteShader(x),a.deleteShader(_);for(var S=0;S<h.length;S++){var E=h[S];if(E&&!b[E]){var C=a.getUniformLocation(this.program,E);C&&(b[E]=C)}}this.fixedUniforms=i(t,b),this.binderUniforms=r?r.getUniforms(t,b):[]}}};function En(t,e,n){var r=1/fe(n,1,e.transform.tileZoom),i=Math.pow(2,n.tileID.overscaledZ),o=n.tileSize*Math.pow(2,e.transform.tileZoom)/i,a=o*(n.tileID.canonical.x+n.tileID.wrap*i),s=o*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[r,t.fromScale,t.toScale],u_fade:t.t,u_pixel_coord_upper:[a>>16,s>>16],u_pixel_coord_lower:[65535&a,65535&s]}}Sn.prototype.draw=function(t,e,n,r,i,o,a,s,u,l,c,p,h,f,d,v){var m,y=t.gl;if(!this.failedToCreate){for(var g in t.program.set(this.program),t.setDepthMode(n),t.setStencilMode(r),t.setColorMode(i),t.setCullFace(o),this.fixedUniforms)this.fixedUniforms[g].set(a[g]);f&&f.setUniforms(t,this.binderUniforms,p,{zoom:h});for(var _=(m={},m[y.LINES]=2,m[y.TRIANGLES]=3,m[y.LINE_STRIP]=1,m)[e],x=0,b=c.get();x<b.length;x+=1){var w=b[x],S=w.vaos||(w.vaos={});(S[s]||(S[s]=new bn)).bind(t,this,u,f?f.getPaintVertexBuffers():[],l,w.vertexOffset,d,v),y.drawElements(e,w.primitiveLength*_,y.UNSIGNED_SHORT,w.primitiveOffset*_*2)}}};var Cn=function(e,n,r,i){var o=n.style.light,a=o.properties.get("position"),s=[a.x,a.y,a.z],u=t.create$1();"viewport"===o.properties.get("anchor")&&t.fromRotation(u,-n.transform.angle),t.transformMat3(s,s,u);var l=o.properties.get("color");return{u_matrix:e,u_lightpos:s,u_lightintensity:o.properties.get("intensity"),u_lightcolor:[l.r,l.g,l.b],u_vertical_gradient:+r,u_opacity:i}},Tn=function(e,n,r,i,o,a,s){return t.extend(Cn(e,n,r,i),En(a,n,s),{u_height_factor:-Math.pow(2,o.overscaledZ)/s.tileSize/8})},An=function(t){return{u_matrix:t}},Mn=function(e,n,r,i){return t.extend(An(e),En(r,n,i))},kn=function(t,e){return{u_matrix:t,u_world:e}},Pn=function(e,n,r,i,o){return t.extend(Mn(e,n,r,i),{u_world:o})},On=function(e,n,r,i){var o,a,s=e.transform;if("map"===i.paint.get("circle-pitch-alignment")){var u=fe(r,1,s.zoom);o=!0,a=[u,u]}else o=!1,a=s.pixelsToGLUnits;return{u_camera_to_center_distance:s.cameraToCenterDistance,u_scale_with_map:+("map"===i.paint.get("circle-pitch-scale")),u_matrix:e.translatePosMatrix(n.posMatrix,r,i.paint.get("circle-translate"),i.paint.get("circle-translate-anchor")),u_pitch_with_map:+o,u_device_pixel_ratio:t.browser.devicePixelRatio,u_extrude_scale:a}},Ln=function(t,e,n){var r=fe(n,1,e.zoom),i=Math.pow(2,e.zoom-n.tileID.overscaledZ),o=n.tileID.overscaleFactor();return{u_matrix:t,u_camera_to_center_distance:e.cameraToCenterDistance,u_pixels_to_tile_units:r,u_extrude_scale:[e.pixelsToGLUnits[0]/(r*i),e.pixelsToGLUnits[1]/(r*i)],u_overscale_factor:o}},In=function(t,e,n){return{u_matrix:t,u_inv_matrix:e,u_camera_to_center_distance:n.cameraToCenterDistance,u_viewport_size:[n.width,n.height]}},Rn=function(t,e,n){return void 0===n&&(n=1),{u_matrix:t,u_color:e,u_overlay:0,u_overlay_scale:n}},Dn=function(t){return{u_matrix:t}},Nn=function(t,e,n,r){return{u_matrix:t,u_extrude_scale:fe(e,1,n),u_intensity:r}},Zn=function(e,n,r){var i=e.transform;return{u_matrix:Un(e,n,r),u_ratio:1/fe(n,1,i.zoom),u_device_pixel_ratio:t.browser.devicePixelRatio,u_units_to_pixels:[1/i.pixelsToGLUnits[0],1/i.pixelsToGLUnits[1]]}},zn=function(e,n,r,i){return t.extend(Zn(e,n,r),{u_image:0,u_image_height:i})},Fn=function(e,n,r,i){var o=e.transform,a=jn(n,o);return{u_matrix:Un(e,n,r),u_texsize:n.imageAtlasTexture.size,u_ratio:1/fe(n,1,o.zoom),u_device_pixel_ratio:t.browser.devicePixelRatio,u_image:0,u_scale:[a,i.fromScale,i.toScale],u_fade:i.t,u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]]}},Bn=function(e,n,r,i,o){var a=e.lineAtlas,s=jn(n,e.transform),u="round"===r.layout.get("line-cap"),l=a.getDash(i.from,u),c=a.getDash(i.to,u),p=l.width*o.fromScale,h=c.width*o.toScale;return t.extend(Zn(e,n,r),{u_patternscale_a:[s/p,-l.height/2],u_patternscale_b:[s/h,-c.height/2],u_sdfgamma:a.width/(256*Math.min(p,h)*t.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:l.y,u_tex_y_b:c.y,u_mix:o.t})};function jn(t,e){return 1/fe(t,1,e.tileZoom)}function Un(t,e,n){return t.translatePosMatrix(e.tileID.posMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}var Vn=function(t,e,n,r,i){return{u_matrix:t,u_tl_parent:e,u_scale_parent:n,u_buffer_scale:1,u_fade_t:r.mix,u_opacity:r.opacity*i.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:i.paint.get("raster-brightness-min"),u_brightness_high:i.paint.get("raster-brightness-max"),u_saturation_factor:(a=i.paint.get("raster-saturation"),a>0?1-1/(1.001-a):-a),u_contrast_factor:(o=i.paint.get("raster-contrast"),o>0?1/(1-o):1+o),u_spin_weights:Gn(i.paint.get("raster-hue-rotate"))};var o,a};function Gn(t){t*=Math.PI/180;var e=Math.sin(t),n=Math.cos(t);return[(2*n+1)/3,(-Math.sqrt(3)*e-n+1)/3,(Math.sqrt(3)*e-n+1)/3]}var Hn,Wn=function(t,e,n,r,i,o,a,s,u,l){var c=i.transform;return{u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:c.cameraToCenterDistance,u_pitch:c.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:c.width/c.height,u_fade_change:i.options.fadeDuration?i.symbolFadeChange:1,u_matrix:o,u_label_plane_matrix:a,u_coord_matrix:s,u_is_text:+u,u_pitch_with_map:+r,u_texsize:l,u_texture:0}},qn=function(e,n,r,i,o,a,s,u,l,c,p){var h=o.transform;return t.extend(Wn(e,n,r,i,o,a,s,u,l,c),{u_gamma_scale:i?Math.cos(h._pitch)*h.cameraToCenterDistance:1,u_device_pixel_ratio:t.browser.devicePixelRatio,u_is_halo:+p})},Xn=function(e,n,r,i,o,a,s,u,l,c){return t.extend(qn(e,n,r,i,o,a,s,u,!0,l,!0),{u_texsize_icon:c,u_texture_icon:1})},Yn=function(t,e,n){return{u_matrix:t,u_opacity:e,u_color:n}},Kn=function(e,n,r,i,o,a){return t.extend(function(t,e,n,r){var i=n.imageManager.getPattern(t.from.toString()),o=n.imageManager.getPattern(t.to.toString()),a=n.imageManager.getPixelSize(),s=a.width,u=a.height,l=Math.pow(2,r.tileID.overscaledZ),c=r.tileSize*Math.pow(2,n.transform.tileZoom)/l,p=c*(r.tileID.canonical.x+r.tileID.wrap*l),h=c*r.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:i.tl,u_pattern_br_a:i.br,u_pattern_tl_b:o.tl,u_pattern_br_b:o.br,u_texsize:[s,u],u_mix:e.t,u_pattern_size_a:i.displaySize,u_pattern_size_b:o.displaySize,u_scale_a:e.fromScale,u_scale_b:e.toScale,u_tile_units_to_pixels:1/fe(r,1,n.transform.tileZoom),u_pixel_coord_upper:[p>>16,h>>16],u_pixel_coord_lower:[65535&p,65535&h]}}(i,a,r,o),{u_matrix:e,u_opacity:n})},Qn={fillExtrusion:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_lightpos:new t.Uniform3f(e,n.u_lightpos),u_lightintensity:new t.Uniform1f(e,n.u_lightintensity),u_lightcolor:new t.Uniform3f(e,n.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,n.u_vertical_gradient),u_opacity:new t.Uniform1f(e,n.u_opacity)}},fillExtrusionPattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_lightpos:new t.Uniform3f(e,n.u_lightpos),u_lightintensity:new t.Uniform1f(e,n.u_lightintensity),u_lightcolor:new t.Uniform3f(e,n.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,n.u_vertical_gradient),u_height_factor:new t.Uniform1f(e,n.u_height_factor),u_image:new t.Uniform1i(e,n.u_image),u_texsize:new t.Uniform2f(e,n.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade),u_opacity:new t.Uniform1f(e,n.u_opacity)}},fill:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}},fillPattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image:new t.Uniform1i(e,n.u_image),u_texsize:new t.Uniform2f(e,n.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade)}},fillOutline:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_world:new t.Uniform2f(e,n.u_world)}},fillOutlinePattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_world:new t.Uniform2f(e,n.u_world),u_image:new t.Uniform1i(e,n.u_image),u_texsize:new t.Uniform2f(e,n.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade)}},circle:function(e,n){return{u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_scale_with_map:new t.Uniform1i(e,n.u_scale_with_map),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_extrude_scale:new t.Uniform2f(e,n.u_extrude_scale),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}},collisionBox:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pixels_to_tile_units:new t.Uniform1f(e,n.u_pixels_to_tile_units),u_extrude_scale:new t.Uniform2f(e,n.u_extrude_scale),u_overscale_factor:new t.Uniform1f(e,n.u_overscale_factor)}},collisionCircle:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_inv_matrix:new t.UniformMatrix4f(e,n.u_inv_matrix),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_viewport_size:new t.Uniform2f(e,n.u_viewport_size)}},debug:function(e,n){return{u_color:new t.UniformColor(e,n.u_color),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_overlay:new t.Uniform1i(e,n.u_overlay),u_overlay_scale:new t.Uniform1f(e,n.u_overlay_scale)}},clippingMask:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}},heatmap:function(e,n){return{u_extrude_scale:new t.Uniform1f(e,n.u_extrude_scale),u_intensity:new t.Uniform1f(e,n.u_intensity),u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}},heatmapTexture:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_world:new t.Uniform2f(e,n.u_world),u_image:new t.Uniform1i(e,n.u_image),u_color_ramp:new t.Uniform1i(e,n.u_color_ramp),u_opacity:new t.Uniform1f(e,n.u_opacity)}},hillshade:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image:new t.Uniform1i(e,n.u_image),u_latrange:new t.Uniform2f(e,n.u_latrange),u_light:new t.Uniform2f(e,n.u_light),u_shadow:new t.UniformColor(e,n.u_shadow),u_highlight:new t.UniformColor(e,n.u_highlight),u_accent:new t.UniformColor(e,n.u_accent)}},hillshadePrepare:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image:new t.Uniform1i(e,n.u_image),u_dimension:new t.Uniform2f(e,n.u_dimension),u_zoom:new t.Uniform1f(e,n.u_zoom),u_unpack:new t.Uniform4f(e,n.u_unpack)}},line:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_ratio:new t.Uniform1f(e,n.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels)}},lineGradient:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_ratio:new t.Uniform1f(e,n.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels),u_image:new t.Uniform1i(e,n.u_image),u_image_height:new t.Uniform1f(e,n.u_image_height)}},linePattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_texsize:new t.Uniform2f(e,n.u_texsize),u_ratio:new t.Uniform1f(e,n.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_image:new t.Uniform1i(e,n.u_image),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels),u_scale:new t.Uniform3f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade)}},lineSDF:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_ratio:new t.Uniform1f(e,n.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels),u_patternscale_a:new t.Uniform2f(e,n.u_patternscale_a),u_patternscale_b:new t.Uniform2f(e,n.u_patternscale_b),u_sdfgamma:new t.Uniform1f(e,n.u_sdfgamma),u_image:new t.Uniform1i(e,n.u_image),u_tex_y_a:new t.Uniform1f(e,n.u_tex_y_a),u_tex_y_b:new t.Uniform1f(e,n.u_tex_y_b),u_mix:new t.Uniform1f(e,n.u_mix)}},raster:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_tl_parent:new t.Uniform2f(e,n.u_tl_parent),u_scale_parent:new t.Uniform1f(e,n.u_scale_parent),u_buffer_scale:new t.Uniform1f(e,n.u_buffer_scale),u_fade_t:new t.Uniform1f(e,n.u_fade_t),u_opacity:new t.Uniform1f(e,n.u_opacity),u_image0:new t.Uniform1i(e,n.u_image0),u_image1:new t.Uniform1i(e,n.u_image1),u_brightness_low:new t.Uniform1f(e,n.u_brightness_low),u_brightness_high:new t.Uniform1f(e,n.u_brightness_high),u_saturation_factor:new t.Uniform1f(e,n.u_saturation_factor),u_contrast_factor:new t.Uniform1f(e,n.u_contrast_factor),u_spin_weights:new t.Uniform3f(e,n.u_spin_weights)}},symbolIcon:function(e,n){return{u_is_size_zoom_constant:new t.Uniform1i(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,n.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,n.u_size_t),u_size:new t.Uniform1f(e,n.u_size),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,n.u_pitch),u_rotate_symbol:new t.Uniform1i(e,n.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,n.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,n.u_fade_change),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,n.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,n.u_coord_matrix),u_is_text:new t.Uniform1i(e,n.u_is_text),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_texsize:new t.Uniform2f(e,n.u_texsize),u_texture:new t.Uniform1i(e,n.u_texture)}},symbolSDF:function(e,n){return{u_is_size_zoom_constant:new t.Uniform1i(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,n.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,n.u_size_t),u_size:new t.Uniform1f(e,n.u_size),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,n.u_pitch),u_rotate_symbol:new t.Uniform1i(e,n.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,n.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,n.u_fade_change),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,n.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,n.u_coord_matrix),u_is_text:new t.Uniform1i(e,n.u_is_text),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_texsize:new t.Uniform2f(e,n.u_texsize),u_texture:new t.Uniform1i(e,n.u_texture),u_gamma_scale:new t.Uniform1f(e,n.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_is_halo:new t.Uniform1i(e,n.u_is_halo)}},symbolTextAndIcon:function(e,n){return{u_is_size_zoom_constant:new t.Uniform1i(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,n.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,n.u_size_t),u_size:new t.Uniform1f(e,n.u_size),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,n.u_pitch),u_rotate_symbol:new t.Uniform1i(e,n.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,n.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,n.u_fade_change),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,n.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,n.u_coord_matrix),u_is_text:new t.Uniform1i(e,n.u_is_text),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_texsize:new t.Uniform2f(e,n.u_texsize),u_texsize_icon:new t.Uniform2f(e,n.u_texsize_icon),u_texture:new t.Uniform1i(e,n.u_texture),u_texture_icon:new t.Uniform1i(e,n.u_texture_icon),u_gamma_scale:new t.Uniform1f(e,n.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_is_halo:new t.Uniform1i(e,n.u_is_halo)}},background:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_opacity:new t.Uniform1f(e,n.u_opacity),u_color:new t.UniformColor(e,n.u_color)}},backgroundPattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_opacity:new t.Uniform1f(e,n.u_opacity),u_image:new t.Uniform1i(e,n.u_image),u_pattern_tl_a:new t.Uniform2f(e,n.u_pattern_tl_a),u_pattern_br_a:new t.Uniform2f(e,n.u_pattern_br_a),u_pattern_tl_b:new t.Uniform2f(e,n.u_pattern_tl_b),u_pattern_br_b:new t.Uniform2f(e,n.u_pattern_br_b),u_texsize:new t.Uniform2f(e,n.u_texsize),u_mix:new t.Uniform1f(e,n.u_mix),u_pattern_size_a:new t.Uniform2f(e,n.u_pattern_size_a),u_pattern_size_b:new t.Uniform2f(e,n.u_pattern_size_b),u_scale_a:new t.Uniform1f(e,n.u_scale_a),u_scale_b:new t.Uniform1f(e,n.u_scale_b),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_tile_units_to_pixels:new t.Uniform1f(e,n.u_tile_units_to_pixels)}}};function Jn(e,n,r,i,o,a,s){for(var u=e.context,l=u.gl,c=e.useProgram("collisionBox"),p=[],h=0,f=0,d=0;d<i.length;d++){var v=i[d],m=n.getTile(v),y=m.getBucket(r);if(y){var g=v.posMatrix;0===o[0]&&0===o[1]||(g=e.translatePosMatrix(v.posMatrix,m,o,a));var _=s?y.textCollisionBox:y.iconCollisionBox,x=y.collisionCircleArray;if(x.length>0){var b=t.create(),w=g;t.mul(b,y.placementInvProjMatrix,e.transform.glCoordMatrix),t.mul(b,b,y.placementViewportMatrix),p.push({circleArray:x,circleOffset:f,transform:w,invTransform:b}),f=h+=x.length/4}_&&c.draw(u,l.LINES,Tt.disabled,At.disabled,e.colorModeForRenderPass(),kt.disabled,Ln(g,e.transform,m),r.id,_.layoutVertexBuffer,_.indexBuffer,_.segments,null,e.transform.zoom,null,null,_.collisionVertexBuffer)}}if(s&&p.length){var S=e.useProgram("collisionCircle"),E=new t.StructArrayLayout2f1f2i16;E.resize(4*h),E._trim();for(var C=0,T=0,A=p;T<A.length;T+=1)for(var M=A[T],k=0;k<M.circleArray.length/4;k++){var P=4*k,O=M.circleArray[P+0],L=M.circleArray[P+1],I=M.circleArray[P+2],R=M.circleArray[P+3];E.emplace(C++,O,L,I,R,0),E.emplace(C++,O,L,I,R,1),E.emplace(C++,O,L,I,R,2),E.emplace(C++,O,L,I,R,3)}(!Hn||Hn.length<2*h)&&(Hn=function(e){var n=2*e,r=new t.StructArrayLayout3ui6;r.resize(n),r._trim();for(var i=0;i<n;i++){var o=6*i;r.uint16[o+0]=4*i+0,r.uint16[o+1]=4*i+1,r.uint16[o+2]=4*i+2,r.uint16[o+3]=4*i+2,r.uint16[o+4]=4*i+3,r.uint16[o+5]=4*i+0}return r}(h));for(var D=u.createIndexBuffer(Hn,!0),N=u.createVertexBuffer(E,t.collisionCircleLayout.members,!0),Z=0,z=p;Z<z.length;Z+=1){var F=z[Z],B=In(F.transform,F.invTransform,e.transform);S.draw(u,l.TRIANGLES,Tt.disabled,At.disabled,e.colorModeForRenderPass(),kt.disabled,B,r.id,N,D,t.SegmentVector.simpleSegment(0,2*F.circleOffset,F.circleArray.length,F.circleArray.length/2),null,e.transform.zoom,null,null,null)}N.destroy(),D.destroy()}}var $n=t.identity(new Float32Array(16));function tr(e,n,r,i,o,a){var s=t.getAnchorAlignment(e),u=-(s.horizontalAlign-.5)*n,l=-(s.verticalAlign-.5)*r,c=t.evaluateVariableOffset(e,i);return new t.Point((u/o+c[0])*a,(l/o+c[1])*a)}function er(e,n,r,i,o,a,s,u,l,c,p){var h=e.text.placedSymbolArray,f=e.text.dynamicLayoutVertexArray,d=e.icon.dynamicLayoutVertexArray,v={};f.clear();for(var m=0;m<h.length;m++){var y=h.get(m),g=y.hidden||!y.crossTileID||e.allowVerticalPlacement&&!y.placedOrientation?null:i[y.crossTileID];if(g){var _=new t.Point(y.anchorX,y.anchorY),x=te(_,r?u:s),b=ee(a.cameraToCenterDistance,x.signedDistanceFromCamera),w=o.evaluateSizeForFeature(e.textSizeData,c,y)*b/t.ONE_EM;r&&(w*=e.tilePixelRatio/l);for(var S=tr(g.anchor,g.width,g.height,g.textOffset,g.textBoxScale,w),E=r?te(_.add(S),s).point:x.point.add(n?S.rotate(-a.angle):S),C=e.allowVerticalPlacement&&y.placedOrientation===t.WritingMode.vertical?Math.PI/2:0,T=0;T<y.numGlyphs;T++)t.addDynamicAttributes(f,E,C);p&&y.associatedIconIndex>=0&&(v[y.associatedIconIndex]={shiftedAnchor:E,angle:C})}else ce(y.numGlyphs,f)}if(p){d.clear();for(var A=e.icon.placedSymbolArray,M=0;M<A.length;M++){var k=A.get(M);if(k.hidden)ce(k.numGlyphs,d);else{var P=v[M];if(P)for(var O=0;O<k.numGlyphs;O++)t.addDynamicAttributes(d,P.shiftedAnchor,P.angle);else ce(k.numGlyphs,d)}}e.icon.dynamicLayoutVertexBuffer.updateData(d)}e.text.dynamicLayoutVertexBuffer.updateData(f)}function nr(t,e,n){return n.iconsInText&&e?"symbolTextAndIcon":t?"symbolSDF":"symbolIcon"}function rr(e,n,r,i,o,a,s,u,l,c,p,h){for(var f=e.context,d=f.gl,v=e.transform,m="map"===u,y="map"===l,g=m&&"point"!==r.layout.get("symbol-placement"),_=m&&!y&&!g,x=void 0!==r.layout.get("symbol-sort-key").constantOr(1),b=!1,w=e.depthModeForSublayer(0,Tt.ReadOnly),S=r.layout.get("text-variable-anchor"),E=[],C=0,T=i;C<T.length;C+=1){var A=T[C],M=n.getTile(A),k=M.getBucket(r);if(k){var P=o?k.text:k.icon;if(P&&P.segments.get().length){var O=P.programConfigurations.get(r.id),L=o||k.sdfIcons,I=o?k.textSizeData:k.iconSizeData,R=y||0!==v.pitch,D=e.useProgram(nr(L,o,k),O),N=t.evaluateSizeForZoom(I,v.zoom),Z=void 0,z=[0,0],F=void 0,B=void 0,j=null,U=void 0;if(o)F=M.glyphAtlasTexture,B=d.LINEAR,Z=M.glyphAtlasTexture.size,k.iconsInText&&(z=M.imageAtlasTexture.size,j=M.imageAtlasTexture,U=R||e.options.rotating||e.options.zooming||"composite"===I.kind||"camera"===I.kind?d.LINEAR:d.NEAREST);else{var V=1!==r.layout.get("icon-size").constantOr(0)||k.iconsNeedLinear;F=M.imageAtlasTexture,B=L||e.options.rotating||e.options.zooming||V||R?d.LINEAR:d.NEAREST,Z=M.imageAtlasTexture.size}var G=fe(M,1,e.transform.zoom),H=Jt(A.posMatrix,y,m,e.transform,G),W=$t(A.posMatrix,y,m,e.transform,G),q=S&&k.hasTextData(),X="none"!==r.layout.get("icon-text-fit")&&q&&k.hasIconData();g&&re(k,A.posMatrix,e,o,H,W,y,c);var Y=e.translatePosMatrix(A.posMatrix,M,a,s),K=g||o&&S||X?$n:H,Q=e.translatePosMatrix(W,M,a,s,!0),J=L&&0!==r.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1),$={program:D,buffers:P,uniformValues:L?k.iconsInText?Xn(I.kind,N,_,y,e,Y,K,Q,Z,z):qn(I.kind,N,_,y,e,Y,K,Q,o,Z,!0):Wn(I.kind,N,_,y,e,Y,K,Q,o,Z),atlasTexture:F,atlasTextureIcon:j,atlasInterpolation:B,atlasInterpolationIcon:U,isSDF:L,hasHalo:J};if(x&&k.canOverlap){b=!0;for(var tt=0,et=P.segments.get();tt<et.length;tt+=1){var nt=et[tt];E.push({segments:new t.SegmentVector([nt]),sortKey:nt.sortKey,state:$})}}else E.push({segments:P.segments,sortKey:0,state:$})}}}b&&E.sort((function(t,e){return t.sortKey-e.sortKey}));for(var rt=0,it=E;rt<it.length;rt+=1){var ot=it[rt],at=ot.state;if(f.activeTexture.set(d.TEXTURE0),at.atlasTexture.bind(at.atlasInterpolation,d.CLAMP_TO_EDGE),at.atlasTextureIcon&&(f.activeTexture.set(d.TEXTURE1),at.atlasTextureIcon&&at.atlasTextureIcon.bind(at.atlasInterpolationIcon,d.CLAMP_TO_EDGE)),at.isSDF){var st=at.uniformValues;at.hasHalo&&(st.u_is_halo=1,ir(at.buffers,ot.segments,r,e,at.program,w,p,h,st)),st.u_is_halo=0}ir(at.buffers,ot.segments,r,e,at.program,w,p,h,at.uniformValues)}}function ir(t,e,n,r,i,o,a,s,u){var l=r.context;i.draw(l,l.gl.TRIANGLES,o,a,s,kt.disabled,u,n.id,t.layoutVertexBuffer,t.indexBuffer,e,n.paint,r.transform.zoom,t.programConfigurations.get(n.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer)}function or(t,e,n,r,i,o,a){var s,u,l,c,p,h=t.context.gl,f=n.paint.get("fill-pattern"),d=f&&f.constantOr(1),v=n.getCrossfadeParameters();a?(u=d&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",s=h.LINES):(u=d?"fillPattern":"fill",s=h.TRIANGLES);for(var m=0,y=r;m<y.length;m+=1){var g=y[m],_=e.getTile(g);if(!d||_.patternsLoaded()){var x=_.getBucket(n);if(x){var b=x.programConfigurations.get(n.id),w=t.useProgram(u,b);d&&(t.context.activeTexture.set(h.TEXTURE0),_.imageAtlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE),b.updatePaintBuffers(v));var S=f.constantOr(null);if(S&&_.imageAtlas){var E=_.imageAtlas,C=E.patternPositions[S.to.toString()],T=E.patternPositions[S.from.toString()];C&&T&&b.setConstantPatternPositions(C,T)}var A=t.translatePosMatrix(g.posMatrix,_,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(a){c=x.indexBuffer2,p=x.segments2;var M=[h.drawingBufferWidth,h.drawingBufferHeight];l="fillOutlinePattern"===u&&d?Pn(A,t,v,_,M):kn(A,M)}else c=x.indexBuffer,p=x.segments,l=d?Mn(A,t,v,_):An(A);w.draw(t.context,s,i,t.stencilModeForClipping(g),o,kt.disabled,l,n.id,x.layoutVertexBuffer,c,p,n.paint,t.transform.zoom,b)}}}}function ar(t,e,n,r,i,o,a){for(var s=t.context,u=s.gl,l=n.paint.get("fill-extrusion-pattern"),c=l.constantOr(1),p=n.getCrossfadeParameters(),h=n.paint.get("fill-extrusion-opacity"),f=0,d=r;f<d.length;f+=1){var v=d[f],m=e.getTile(v),y=m.getBucket(n);if(y){var g=y.programConfigurations.get(n.id),_=t.useProgram(c?"fillExtrusionPattern":"fillExtrusion",g);c&&(t.context.activeTexture.set(u.TEXTURE0),m.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),g.updatePaintBuffers(p));var x=l.constantOr(null);if(x&&m.imageAtlas){var b=m.imageAtlas,w=b.patternPositions[x.to.toString()],S=b.patternPositions[x.from.toString()];w&&S&&g.setConstantPatternPositions(w,S)}var E=t.translatePosMatrix(v.posMatrix,m,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),C=n.paint.get("fill-extrusion-vertical-gradient"),T=c?Tn(E,t,C,h,v,p,m):Cn(E,t,C,h);_.draw(s,s.gl.TRIANGLES,i,o,a,kt.backCCW,T,n.id,y.layoutVertexBuffer,y.indexBuffer,y.segments,n.paint,t.transform.zoom,g)}}}function sr(e,n,r,i,o,a){var s=e.context,u=s.gl,l=n.fbo;if(l){var c=e.useProgram("hillshade");s.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,l.colorAttachment.get());var p=function(e,n,r){var i=r.paint.get("hillshade-shadow-color"),o=r.paint.get("hillshade-highlight-color"),a=r.paint.get("hillshade-accent-color"),s=r.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===r.paint.get("hillshade-illumination-anchor")&&(s-=e.transform.angle);var u,l,c,p=!e.options.moving;return{u_matrix:e.transform.calculatePosMatrix(n.tileID.toUnwrapped(),p),u_image:0,u_latrange:(u=n.tileID,l=Math.pow(2,u.canonical.z),c=u.canonical.y,[new t.MercatorCoordinate(0,c/l).toLngLat().lat,new t.MercatorCoordinate(0,(c+1)/l).toLngLat().lat]),u_light:[r.paint.get("hillshade-exaggeration"),s],u_shadow:i,u_highlight:o,u_accent:a}}(e,n,r);c.draw(s,u.TRIANGLES,i,o,a,kt.disabled,p,r.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments)}}function ur(e,n,r,i,o,a){var s=e.context,u=s.gl,l=n.dem;if(l&&l.data){var c=l.dim,p=l.stride,h=l.getPixels();if(s.activeTexture.set(u.TEXTURE1),s.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||e.getTileTexture(p),n.demTexture){var f=n.demTexture;f.update(h,{premultiply:!1}),f.bind(u.NEAREST,u.CLAMP_TO_EDGE)}else n.demTexture=new t.Texture(s,h,u.RGBA,{premultiply:!1}),n.demTexture.bind(u.NEAREST,u.CLAMP_TO_EDGE);s.activeTexture.set(u.TEXTURE0);var d=n.fbo;if(!d){var v=new t.Texture(s,{width:c,height:c,data:null},u.RGBA);v.bind(u.LINEAR,u.CLAMP_TO_EDGE),(d=n.fbo=s.createFramebuffer(c,c,!0)).colorAttachment.set(v.texture)}s.bindFramebuffer.set(d.framebuffer),s.viewport.set([0,0,c,c]),e.useProgram("hillshadePrepare").draw(s,u.TRIANGLES,i,o,a,kt.disabled,function(e,n){var r=n.stride,i=t.create();return t.ortho(i,0,t.EXTENT,-t.EXTENT,0,0,1),t.translate(i,i,[0,-t.EXTENT,0]),{u_matrix:i,u_image:1,u_dimension:[r,r],u_zoom:e.overscaledZ,u_unpack:n.getUnpackVector()}}(n.tileID,l),r.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments),n.needsHillshadePrepare=!1}}function lr(e,n,r,i,o){var a=i.paint.get("raster-fade-duration");if(a>0){var s=t.browser.now(),u=(s-e.timeAdded)/a,l=n?(s-n.timeAdded)/a:-1,c=r.getSource(),p=o.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),h=!n||Math.abs(n.tileID.overscaledZ-p)>Math.abs(e.tileID.overscaledZ-p),f=h&&e.refreshedUponExpiration?1:t.clamp(h?u:1-l,0,1);return e.refreshedUponExpiration&&u>=1&&(e.refreshedUponExpiration=!1),n?{opacity:1,mix:1-f}:{opacity:f,mix:0}}return{opacity:1,mix:0}}var cr=new t.Color(1,0,0,1),pr=new t.Color(0,1,0,1),hr=new t.Color(0,0,1,1),fr=new t.Color(1,0,1,1),dr=new t.Color(0,1,1,1);function vr(t,e,n,r){yr(t,0,e+n/2,t.transform.width,n,r)}function mr(t,e,n,r){yr(t,e-n/2,0,n,t.transform.height,r)}function yr(e,n,r,i,o,a){var s=e.context,u=s.gl;u.enable(u.SCISSOR_TEST),u.scissor(n*t.browser.devicePixelRatio,r*t.browser.devicePixelRatio,i*t.browser.devicePixelRatio,o*t.browser.devicePixelRatio),s.clear({color:a}),u.disable(u.SCISSOR_TEST)}function gr(e,n,r){var i=e.context,o=i.gl,a=r.posMatrix,s=e.useProgram("debug"),u=Tt.disabled,l=At.disabled,c=e.colorModeForRenderPass();i.activeTexture.set(o.TEXTURE0),e.emptyTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE),s.draw(i,o.LINE_STRIP,u,l,c,kt.disabled,Rn(a,t.Color.red),"$debug",e.debugBuffer,e.tileBorderIndexBuffer,e.debugSegments);var p=n.getTileByID(r.key).latestRawTileData,h=Math.floor((p&&p.byteLength||0)/1024),f=n.getTile(r).tileSize,d=512/Math.min(f,512)*(r.overscaledZ/e.transform.zoom)*.5,v=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(v+=" => "+r.overscaledZ),function(t,e){t.initDebugOverlayCanvas();var n=t.debugOverlayCanvas,r=t.context.gl,i=t.debugOverlayCanvas.getContext("2d");i.clearRect(0,0,n.width,n.height),i.shadowColor="white",i.shadowBlur=2,i.lineWidth=1.5,i.strokeStyle="white",i.textBaseline="top",i.font="bold 36px Open Sans, sans-serif",i.fillText(e,5,5),i.strokeText(e,5,5),t.debugOverlayTexture.update(n),t.debugOverlayTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}(e,v+" "+h+"kb"),s.draw(i,o.TRIANGLES,u,l,Mt.alphaBlended,kt.disabled,Rn(a,t.Color.transparent,d),"$debug",e.debugBuffer,e.quadTriangleIndexBuffer,e.debugSegments)}var _r={symbol:function(e,n,r,i,o){if("translucent"===e.renderPass){var a=At.disabled,s=e.colorModeForRenderPass();r.layout.get("text-variable-anchor")&&function(e,n,r,i,o,a,s){for(var u=n.transform,l="map"===o,c="map"===a,p=0,h=e;p<h.length;p+=1){var f=h[p],d=i.getTile(f),v=d.getBucket(r);if(v&&v.text&&v.text.segments.get().length){var m=t.evaluateSizeForZoom(v.textSizeData,u.zoom),y=fe(d,1,n.transform.zoom),g=Jt(f.posMatrix,c,l,n.transform,y),_="none"!==r.layout.get("icon-text-fit")&&v.hasIconData();if(m){var x=Math.pow(2,u.zoom-d.tileID.overscaledZ);er(v,l,c,s,t.symbolSize,u,g,f.posMatrix,x,m,_)}}}}(i,e,r,n,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),o),0!==r.paint.get("icon-opacity").constantOr(1)&&rr(e,n,r,i,!1,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),r.layout.get("icon-rotation-alignment"),r.layout.get("icon-pitch-alignment"),r.layout.get("icon-keep-upright"),a,s),0!==r.paint.get("text-opacity").constantOr(1)&&rr(e,n,r,i,!0,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.layout.get("text-keep-upright"),a,s),n.map.showCollisionBoxes&&(Jn(e,n,r,i,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),Jn(e,n,r,i,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))}},circle:function(e,n,r,i){if("translucent"===e.renderPass){var o=r.paint.get("circle-opacity"),a=r.paint.get("circle-stroke-width"),s=r.paint.get("circle-stroke-opacity"),u=void 0!==r.layout.get("circle-sort-key").constantOr(1);if(0!==o.constantOr(1)||0!==a.constantOr(1)&&0!==s.constantOr(1)){for(var l=e.context,c=l.gl,p=e.depthModeForSublayer(0,Tt.ReadOnly),h=At.disabled,f=e.colorModeForRenderPass(),d=[],v=0;v<i.length;v++){var m=i[v],y=n.getTile(m),g=y.getBucket(r);if(g){var _=g.programConfigurations.get(r.id),x={programConfiguration:_,program:e.useProgram("circle",_),layoutVertexBuffer:g.layoutVertexBuffer,indexBuffer:g.indexBuffer,uniformValues:On(e,m,y,r)};if(u)for(var b=0,w=g.segments.get();b<w.length;b+=1){var S=w[b];d.push({segments:new t.SegmentVector([S]),sortKey:S.sortKey,state:x})}else d.push({segments:g.segments,sortKey:0,state:x})}}u&&d.sort((function(t,e){return t.sortKey-e.sortKey}));for(var E=0,C=d;E<C.length;E+=1){var T=C[E],A=T.state;A.program.draw(l,c.TRIANGLES,p,h,f,kt.disabled,A.uniformValues,r.id,A.layoutVertexBuffer,A.indexBuffer,T.segments,r.paint,e.transform.zoom,A.programConfiguration)}}}},heatmap:function(e,n,r,i){if(0!==r.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){var o=e.context,a=o.gl,s=At.disabled,u=new Mt([a.ONE,a.ONE],t.Color.transparent,[!0,!0,!0,!0]);!function(t,e,n){var r=t.gl;t.activeTexture.set(r.TEXTURE1),t.viewport.set([0,0,e.width/4,e.height/4]);var i=n.heatmapFbo;if(i)r.bindTexture(r.TEXTURE_2D,i.colorAttachment.get()),t.bindFramebuffer.set(i.framebuffer);else{var o=r.createTexture();r.bindTexture(r.TEXTURE_2D,o),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),i=n.heatmapFbo=t.createFramebuffer(e.width/4,e.height/4,!1),function(t,e,n,r){var i=t.gl;i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e.width/4,e.height/4,0,i.RGBA,t.extRenderToTextureHalfFloat?t.extTextureHalfFloat.HALF_FLOAT_OES:i.UNSIGNED_BYTE,null),r.colorAttachment.set(n)}(t,e,o,i)}}(o,e,r),o.clear({color:t.Color.transparent});for(var l=0;l<i.length;l++){var c=i[l];if(!n.hasRenderableParent(c)){var p=n.getTile(c),h=p.getBucket(r);if(h){var f=h.programConfigurations.get(r.id);e.useProgram("heatmap",f).draw(o,a.TRIANGLES,Tt.disabled,s,u,kt.disabled,Nn(c.posMatrix,p,e.transform.zoom,r.paint.get("heatmap-intensity")),r.id,h.layoutVertexBuffer,h.indexBuffer,h.segments,r.paint,e.transform.zoom,f)}}}o.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(e,n){var r=e.context,i=r.gl,o=n.heatmapFbo;if(o){r.activeTexture.set(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,o.colorAttachment.get()),r.activeTexture.set(i.TEXTURE1);var a=n.colorRampTexture;a||(a=n.colorRampTexture=new t.Texture(r,n.colorRamp,i.RGBA)),a.bind(i.LINEAR,i.CLAMP_TO_EDGE),e.useProgram("heatmapTexture").draw(r,i.TRIANGLES,Tt.disabled,At.disabled,e.colorModeForRenderPass(),kt.disabled,function(e,n,r,i){var o=t.create();t.ortho(o,0,e.width,e.height,0,0,1);var a=e.context.gl;return{u_matrix:o,u_world:[a.drawingBufferWidth,a.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:n.paint.get("heatmap-opacity")}}(e,n),n.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,n.paint,e.transform.zoom)}}(e,r))},line:function(e,n,r,i){if("translucent"===e.renderPass){var o=r.paint.get("line-opacity"),a=r.paint.get("line-width");if(0!==o.constantOr(1)&&0!==a.constantOr(1))for(var s=e.depthModeForSublayer(0,Tt.ReadOnly),u=e.colorModeForRenderPass(),l=r.paint.get("line-dasharray"),c=r.paint.get("line-pattern"),p=c.constantOr(1),h=r.paint.get("line-gradient"),f=r.getCrossfadeParameters(),d=p?"linePattern":l?"lineSDF":h?"lineGradient":"line",v=e.context,m=v.gl,y=!0,g=0,_=i;g<_.length;g+=1){var x=_[g],b=n.getTile(x);if(!p||b.patternsLoaded()){var w=b.getBucket(r);if(w){var S=w.programConfigurations.get(r.id),E=e.context.program.get(),C=e.useProgram(d,S),T=y||C.program!==E,A=c.constantOr(null);if(A&&b.imageAtlas){var M=b.imageAtlas,k=M.patternPositions[A.to.toString()],P=M.patternPositions[A.from.toString()];k&&P&&S.setConstantPatternPositions(k,P)}var O=p?Fn(e,b,r,f):l?Bn(e,b,r,l,f):h?zn(e,b,r,w.lineClipsArray.length):Zn(e,b,r);if(p)v.activeTexture.set(m.TEXTURE0),b.imageAtlasTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE),S.updatePaintBuffers(f);else if(l&&(T||e.lineAtlas.dirty))v.activeTexture.set(m.TEXTURE0),e.lineAtlas.bind(v);else if(h){var L=w.gradients[r.id],I=L.texture;if(r.gradientVersion!==L.version){var R=256;if(r.stepInterpolant){var D=n.getSource().maxzoom,N=x.canonical.z===D?Math.ceil(1<<e.transform.maxZoom-x.canonical.z):1;R=t.clamp(t.nextPowerOfTwo(w.maxLineLength/t.EXTENT*1024*N),256,v.maxTextureSize)}L.gradient=t.renderColorRamp({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:R,image:L.gradient||void 0,clips:w.lineClipsArray}),L.texture?L.texture.update(L.gradient):L.texture=new t.Texture(v,L.gradient,m.RGBA),L.version=r.gradientVersion,I=L.texture}v.activeTexture.set(m.TEXTURE0),I.bind(r.stepInterpolant?m.NEAREST:m.LINEAR,m.CLAMP_TO_EDGE)}C.draw(v,m.TRIANGLES,s,e.stencilModeForClipping(x),u,kt.disabled,O,r.id,w.layoutVertexBuffer,w.indexBuffer,w.segments,r.paint,e.transform.zoom,S,w.layoutVertexBuffer2),y=!1}}}}},fill:function(e,n,r,i){var o=r.paint.get("fill-color"),a=r.paint.get("fill-opacity");if(0!==a.constantOr(1)){var s=e.colorModeForRenderPass(),u=r.paint.get("fill-pattern"),l=e.opaquePassEnabledForLayer()&&!u.constantOr(1)&&1===o.constantOr(t.Color.transparent).a&&1===a.constantOr(0)?"opaque":"translucent";if(e.renderPass===l){var c=e.depthModeForSublayer(1,"opaque"===e.renderPass?Tt.ReadWrite:Tt.ReadOnly);or(e,n,r,i,c,s,!1)}if("translucent"===e.renderPass&&r.paint.get("fill-antialias")){var p=e.depthModeForSublayer(r.getPaintProperty("fill-outline-color")?2:0,Tt.ReadOnly);or(e,n,r,i,p,s,!0)}}},"fill-extrusion":function(t,e,n,r){var i=n.paint.get("fill-extrusion-opacity");if(0!==i&&"translucent"===t.renderPass){var o=new Tt(t.context.gl.LEQUAL,Tt.ReadWrite,t.depthRangeFor3D);if(1!==i||n.paint.get("fill-extrusion-pattern").constantOr(1))ar(t,e,n,r,o,At.disabled,Mt.disabled),ar(t,e,n,r,o,t.stencilModeFor3D(),t.colorModeForRenderPass());else{var a=t.colorModeForRenderPass();ar(t,e,n,r,o,At.disabled,a)}}},hillshade:function(t,e,n,r){if("offscreen"===t.renderPass||"translucent"===t.renderPass){for(var i=t.context,o=t.depthModeForSublayer(0,Tt.ReadOnly),a=t.colorModeForRenderPass(),s="translucent"===t.renderPass?t.stencilConfigForOverlap(r):[{},r],u=s[0],l=0,c=s[1];l<c.length;l+=1){var p=c[l],h=e.getTile(p);h.needsHillshadePrepare&&"offscreen"===t.renderPass?ur(t,h,n,o,At.disabled,a):"translucent"===t.renderPass&&sr(t,h,n,o,u[p.overscaledZ],a)}i.viewport.set([0,0,t.width,t.height])}},raster:function(t,e,n,r){if("translucent"===t.renderPass&&0!==n.paint.get("raster-opacity")&&r.length)for(var i=t.context,o=i.gl,a=e.getSource(),s=t.useProgram("raster"),u=t.colorModeForRenderPass(),l=a instanceof I?[{},r]:t.stencilConfigForOverlap(r),c=l[0],p=l[1],h=p[p.length-1].overscaledZ,f=!t.options.moving,d=0,v=p;d<v.length;d+=1){var m=v[d],y=t.depthModeForSublayer(m.overscaledZ-h,1===n.paint.get("raster-opacity")?Tt.ReadWrite:Tt.ReadOnly,o.LESS),g=e.getTile(m),_=t.transform.calculatePosMatrix(m.toUnwrapped(),f);g.registerFadeDuration(n.paint.get("raster-fade-duration"));var x=e.findLoadedParent(m,0),b=lr(g,x,e,n,t.transform),w=void 0,S=void 0,E="nearest"===n.paint.get("raster-resampling")?o.NEAREST:o.LINEAR;i.activeTexture.set(o.TEXTURE0),g.texture.bind(E,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),i.activeTexture.set(o.TEXTURE1),x?(x.texture.bind(E,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),w=Math.pow(2,x.tileID.overscaledZ-g.tileID.overscaledZ),S=[g.tileID.canonical.x*w%1,g.tileID.canonical.y*w%1]):g.texture.bind(E,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST);var C=Vn(_,S||[0,0],w||1,b,n);a instanceof I?s.draw(i,o.TRIANGLES,y,At.disabled,u,kt.disabled,C,n.id,a.boundsBuffer,t.quadTriangleIndexBuffer,a.boundsSegments):s.draw(i,o.TRIANGLES,y,c[m.overscaledZ],u,kt.disabled,C,n.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}},background:function(t,e,n){var r=n.paint.get("background-color"),i=n.paint.get("background-opacity");if(0!==i){var o=t.context,a=o.gl,s=t.transform,u=s.tileSize,l=n.paint.get("background-pattern");if(!t.isPatternMissing(l)){var c=!l&&1===r.a&&1===i&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass===c){var p=At.disabled,h=t.depthModeForSublayer(0,"opaque"===c?Tt.ReadWrite:Tt.ReadOnly),f=t.colorModeForRenderPass(),d=t.useProgram(l?"backgroundPattern":"background"),v=s.coveringTiles({tileSize:u});l&&(o.activeTexture.set(a.TEXTURE0),t.imageManager.bind(t.context));for(var m=n.getCrossfadeParameters(),y=0,g=v;y<g.length;y+=1){var _=g[y],x=t.transform.calculatePosMatrix(_.toUnwrapped()),b=l?Kn(x,i,t,l,{tileID:_,tileSize:u},m):Yn(x,i,r);d.draw(o,a.TRIANGLES,h,p,f,kt.disabled,b,n.id,t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments)}}}}},debug:function(t,e,n){for(var r=0;r<n.length;r++)gr(t,e,n[r])},custom:function(t,e,n){var r=t.context,i=n.implementation;if("offscreen"===t.renderPass){var o=i.prerender;o&&(t.setCustomLayerDefaults(),r.setColorMode(t.colorModeForRenderPass()),o.call(i,r.gl,t.transform.customLayerMatrix()),r.setDirty(),t.setBaseState())}else if("translucent"===t.renderPass){t.setCustomLayerDefaults(),r.setColorMode(t.colorModeForRenderPass()),r.setStencilMode(At.disabled);var a="3d"===i.renderingMode?new Tt(t.context.gl.LEQUAL,Tt.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,Tt.ReadOnly);r.setDepthMode(a),i.render(r.gl,t.transform.customLayerMatrix()),r.setDirty(),t.setBaseState(),r.bindFramebuffer.set(null)}}},xr=function(t,e){this.context=new Pt(t),this.transform=e,this._tileTextures={},this.setup(),this.numSublayers=Ot.maxUnderzooming+Ot.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Fe,this.gpuTimers={}};xr.prototype.resize=function(e,n){if(this.width=e*t.browser.devicePixelRatio,this.height=n*t.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var r=0,i=this.style._order;r<i.length;r+=1)this.style._layers[i[r]].resize()},xr.prototype.setup=function(){var e=this.context,n=new t.StructArrayLayout2i4;n.emplaceBack(0,0),n.emplaceBack(t.EXTENT,0),n.emplaceBack(0,t.EXTENT),n.emplaceBack(t.EXTENT,t.EXTENT),this.tileExtentBuffer=e.createVertexBuffer(n,He.members),this.tileExtentSegments=t.SegmentVector.simpleSegment(0,0,4,2);var r=new t.StructArrayLayout2i4;r.emplaceBack(0,0),r.emplaceBack(t.EXTENT,0),r.emplaceBack(0,t.EXTENT),r.emplaceBack(t.EXTENT,t.EXTENT),this.debugBuffer=e.createVertexBuffer(r,He.members),this.debugSegments=t.SegmentVector.simpleSegment(0,0,4,5);var i=new t.StructArrayLayout4i8;i.emplaceBack(0,0,0,0),i.emplaceBack(t.EXTENT,0,t.EXTENT,0),i.emplaceBack(0,t.EXTENT,0,t.EXTENT),i.emplaceBack(t.EXTENT,t.EXTENT,t.EXTENT,t.EXTENT),this.rasterBoundsBuffer=e.createVertexBuffer(i,L.members),this.rasterBoundsSegments=t.SegmentVector.simpleSegment(0,0,4,2);var o=new t.StructArrayLayout2i4;o.emplaceBack(0,0),o.emplaceBack(1,0),o.emplaceBack(0,1),o.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(o,He.members),this.viewportSegments=t.SegmentVector.simpleSegment(0,0,4,2);var a=new t.StructArrayLayout1ui2;a.emplaceBack(0),a.emplaceBack(1),a.emplaceBack(3),a.emplaceBack(2),a.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(a);var s=new t.StructArrayLayout3ui6;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(s),this.emptyTexture=new t.Texture(e,{width:1,height:1,data:new Uint8Array([0,0,0,0])},e.gl.RGBA);var u=this.context.gl;this.stencilClearMode=new At({func:u.ALWAYS,mask:0},0,255,u.ZERO,u.ZERO,u.ZERO)},xr.prototype.clearStencil=function(){var e=this.context,n=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var r=t.create();t.ortho(r,0,this.width,this.height,0,0,1),t.scale(r,r,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,n.TRIANGLES,Tt.disabled,this.stencilClearMode,Mt.disabled,kt.disabled,Dn(r),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},xr.prototype._renderTileClippingMasks=function(t,e){if(this.currentStencilSource!==t.source&&t.isTileClipped()&&e&&e.length){this.currentStencilSource=t.source;var n=this.context,r=n.gl;this.nextStencilID+e.length>256&&this.clearStencil(),n.setColorMode(Mt.disabled),n.setDepthMode(Tt.disabled);var i=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var o=0,a=e;o<a.length;o+=1){var s=a[o],u=this._tileClippingMaskIDs[s.key]=this.nextStencilID++;i.draw(n,r.TRIANGLES,Tt.disabled,new At({func:r.ALWAYS,mask:0},u,255,r.KEEP,r.KEEP,r.REPLACE),Mt.disabled,kt.disabled,Dn(s.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},xr.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var t=this.nextStencilID++,e=this.context.gl;return new At({func:e.NOTEQUAL,mask:255},t,255,e.KEEP,e.KEEP,e.REPLACE)},xr.prototype.stencilModeForClipping=function(t){var e=this.context.gl;return new At({func:e.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,e.KEEP,e.KEEP,e.REPLACE)},xr.prototype.stencilConfigForOverlap=function(t){var e,n=this.context.gl,r=t.sort((function(t,e){return e.overscaledZ-t.overscaledZ})),i=r[r.length-1].overscaledZ,o=r[0].overscaledZ-i+1;if(o>1){this.currentStencilSource=void 0,this.nextStencilID+o>256&&this.clearStencil();for(var a={},s=0;s<o;s++)a[s+i]=new At({func:n.GEQUAL,mask:255},s+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=o,[a,r]}return[(e={},e[i]=At.disabled,e),r]},xr.prototype.colorModeForRenderPass=function(){var e=this.context.gl;return this._showOverdrawInspector?new Mt([e.CONSTANT_COLOR,e.ONE],new t.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?Mt.unblended:Mt.alphaBlended},xr.prototype.depthModeForSublayer=function(t,e,n){if(!this.opaquePassEnabledForLayer())return Tt.disabled;var r=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Tt(n||this.context.gl.LEQUAL,e,[r,r])},xr.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},xr.prototype.render=function(e,n){var r=this;this.style=e,this.options=n,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(t.browser.now()),this.imageManager.beginFrame();var i=this.style._order,o=this.style.sourceCaches;for(var a in o){var s=o[a];s.used&&s.prepare(this.context)}var u,l,c={},p={},h={};for(var f in o){var d=o[f];c[f]=d.getVisibleCoordinates(),p[f]=c[f].slice().reverse(),h[f]=d.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var v=0;v<i.length;v++)if(this.style._layers[i[v]].is3D()){this.opaquePassCutoff=v;break}this.renderPass="offscreen";for(var m=0,y=i;m<y.length;m+=1){var g=this.style._layers[y[m]];if(g.hasOffscreenPass()&&!g.isHidden(this.transform.zoom)){var _=p[g.source];("custom"===g.type||_.length)&&this.renderLayer(this,o[g.source],g,_)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?t.Color.black:t.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=i.length-1;this.currentLayer>=0;this.currentLayer--){var x=this.style._layers[i[this.currentLayer]],b=o[x.source],w=c[x.source];this._renderTileClippingMasks(x,w),this.renderLayer(this,b,x,w)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<i.length;this.currentLayer++){var S=this.style._layers[i[this.currentLayer]],E=o[S.source],C=("symbol"===S.type?h:p)[S.source];this._renderTileClippingMasks(S,c[S.source]),this.renderLayer(this,E,S,C)}this.options.showTileBoundaries&&(t.values(this.style._layers).forEach((function(t){t.source&&!t.isHidden(r.transform.zoom)&&(t.source!==(l&&l.id)&&(l=r.style.sourceCaches[t.source]),(!u||u.getSource().maxzoom<l.getSource().maxzoom)&&(u=l))})),u&&_r.debug(this,u,u.getVisibleCoordinates())),this.options.showPadding&&function(t){var e=t.transform.padding;vr(t,t.transform.height-(e.top||0),3,cr),vr(t,e.bottom||0,3,pr),mr(t,e.left||0,3,hr),mr(t,t.transform.width-(e.right||0),3,fr);var n=t.transform.centerPoint;!function(t,e,n,r){yr(t,e-1,n-10,2,20,r),yr(t,e-10,n-1,20,2,r)}(t,n.x,t.transform.height-n.y,dr)}(this),this.context.setDefault()},xr.prototype.renderLayer=function(t,e,n,r){n.isHidden(this.transform.zoom)||("background"===n.type||"custom"===n.type||r.length)&&(this.id=n.id,this.gpuTimingStart(n),_r[n.type](t,e,n,r,this.style.placement.variableOffsets),this.gpuTimingEnd())},xr.prototype.gpuTimingStart=function(t){if(this.options.gpuTiming){var e=this.context.extTimerQuery,n=this.gpuTimers[t.id];n||(n=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:e.createQueryEXT()}),n.calls++,e.beginQueryEXT(e.TIME_ELAPSED_EXT,n.query)}},xr.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}},xr.prototype.collectGpuTimers=function(){var t=this.gpuTimers;return this.gpuTimers={},t},xr.prototype.queryGpuTimers=function(t){var e={};for(var n in t){var r=t[n],i=this.context.extTimerQuery,o=i.getQueryObjectEXT(r.query,i.QUERY_RESULT_EXT)/1e6;i.deleteQueryEXT(r.query),e[n]=o}return e},xr.prototype.translatePosMatrix=function(e,n,r,i,o){if(!r[0]&&!r[1])return e;var a=o?"map"===i?this.transform.angle:0:"viewport"===i?-this.transform.angle:0;if(a){var s=Math.sin(a),u=Math.cos(a);r=[r[0]*u-r[1]*s,r[0]*s+r[1]*u]}var l=[o?r[0]:fe(n,r[0],this.transform.zoom),o?r[1]:fe(n,r[1],this.transform.zoom),0],c=new Float32Array(16);return t.translate(c,e,l),c},xr.prototype.saveTileTexture=function(t){var e=this._tileTextures[t.size[0]];e?e.push(t):this._tileTextures[t.size[0]]=[t]},xr.prototype.getTileTexture=function(t){var e=this._tileTextures[t];return e&&e.length>0?e.pop():null},xr.prototype.isPatternMissing=function(t){if(!t)return!1;if(!t.from||!t.to)return!0;var e=this.imageManager.getPattern(t.from.toString()),n=this.imageManager.getPattern(t.to.toString());return!e||!n},xr.prototype.useProgram=function(t,e){this.cache=this.cache||{};var n=""+t+(e?e.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[n]||(this.cache[n]=new Sn(this.context,t,xn[t],e,Qn[t],this._showOverdrawInspector)),this.cache[n]},xr.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},xr.prototype.setBaseState=function(){var t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)},xr.prototype.initDebugOverlayCanvas=function(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=t.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new t.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},xr.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var br=function(t,e){this.points=t,this.planes=e};br.fromInvProjectionMatrix=function(e,n,r){var i=Math.pow(2,r),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((function(n){return t.transformMat4([],n,e)})).map((function(e){return t.scale$1([],e,1/e[3]/n*i)})),a=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((function(e){var n=t.sub([],o[e[0]],o[e[1]]),r=t.sub([],o[e[2]],o[e[1]]),i=t.normalize([],t.cross([],n,r)),a=-t.dot(i,o[e[1]]);return i.concat(a)}));return new br(o,a)};var wr=function(e,n){this.min=e,this.max=n,this.center=t.scale$2([],t.add([],this.min,this.max),.5)};wr.prototype.quadrant=function(e){for(var n=[e%2==0,e<2],r=t.clone$2(this.min),i=t.clone$2(this.max),o=0;o<n.length;o++)r[o]=n[o]?this.min[o]:this.center[o],i[o]=n[o]?this.center[o]:this.max[o];return i[2]=this.max[2],new wr(r,i)},wr.prototype.distanceX=function(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]},wr.prototype.distanceY=function(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]},wr.prototype.intersects=function(e){for(var n=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],r=!0,i=0;i<e.planes.length;i++){for(var o=e.planes[i],a=0,s=0;s<n.length;s++)a+=t.dot$1(o,n[s])>=0;if(0===a)return 0;a!==n.length&&(r=!1)}if(r)return 2;for(var u=0;u<3;u++){for(var l=Number.MAX_VALUE,c=-Number.MAX_VALUE,p=0;p<e.points.length;p++){var h=e.points[p][u]-this.min[u];l=Math.min(l,h),c=Math.max(c,h)}if(c<0||l>this.max[u]-this.min[u])return 0}return 1};var Sr=function(t,e,n,r){if(void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=0),isNaN(t)||t<0||isNaN(e)||e<0||isNaN(n)||n<0||isNaN(r)||r<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=e,this.left=n,this.right=r};Sr.prototype.interpolate=function(e,n,r){return null!=n.top&&null!=e.top&&(this.top=t.number(e.top,n.top,r)),null!=n.bottom&&null!=e.bottom&&(this.bottom=t.number(e.bottom,n.bottom,r)),null!=n.left&&null!=e.left&&(this.left=t.number(e.left,n.left,r)),null!=n.right&&null!=e.right&&(this.right=t.number(e.right,n.right,r)),this},Sr.prototype.getCenter=function(e,n){var r=t.clamp((this.left+e-this.right)/2,0,e),i=t.clamp((this.top+n-this.bottom)/2,0,n);return new t.Point(r,i)},Sr.prototype.equals=function(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right},Sr.prototype.clone=function(){return new Sr(this.top,this.bottom,this.left,this.right)},Sr.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Er=function(e,n,r,i,o){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===o||o,this._minZoom=e||0,this._maxZoom=n||22,this._minPitch=null==r?0:r,this._maxPitch=null==i?60:i,this.setMaxBounds(),this.width=0,this.height=0,this._center=new t.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Sr,this._posMatrixCache={},this._alignedPosMatrixCache={}},Cr={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Er.prototype.clone=function(){var t=new Er(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._calcMatrices(),t},Cr.minZoom.get=function(){return this._minZoom},Cr.minZoom.set=function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))},Cr.maxZoom.get=function(){return this._maxZoom},Cr.maxZoom.set=function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))},Cr.minPitch.get=function(){return this._minPitch},Cr.minPitch.set=function(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))},Cr.maxPitch.get=function(){return this._maxPitch},Cr.maxPitch.set=function(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))},Cr.renderWorldCopies.get=function(){return this._renderWorldCopies},Cr.renderWorldCopies.set=function(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t},Cr.worldSize.get=function(){return this.tileSize*this.scale},Cr.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Cr.size.get=function(){return new t.Point(this.width,this.height)},Cr.bearing.get=function(){return-this.angle/Math.PI*180},Cr.bearing.set=function(e){var n=-t.wrap(e,-180,180)*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=t.create$2(),t.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Cr.pitch.get=function(){return this._pitch/Math.PI*180},Cr.pitch.set=function(e){var n=t.clamp(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())},Cr.fov.get=function(){return this._fov/Math.PI*180},Cr.fov.set=function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())},Cr.zoom.get=function(){return this._zoom},Cr.zoom.set=function(t){var e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom,this._constrain(),this._calcMatrices())},Cr.center.get=function(){return this._center},Cr.center.set=function(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())},Cr.padding.get=function(){return this._edgeInsets.toJSON()},Cr.padding.set=function(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())},Cr.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Er.prototype.isPaddingEqual=function(t){return this._edgeInsets.equals(t)},Er.prototype.interpolatePadding=function(t,e,n){this._unmodified=!1,this._edgeInsets.interpolate(t,e,n),this._constrain(),this._calcMatrices()},Er.prototype.coveringZoomLevel=function(t){var e=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,e)},Er.prototype.getVisibleUnwrappedCoordinates=function(e){var n=[new t.UnwrappedTileID(0,e)];if(this._renderWorldCopies)for(var r=this.pointCoordinate(new t.Point(0,0)),i=this.pointCoordinate(new t.Point(this.width,0)),o=this.pointCoordinate(new t.Point(this.width,this.height)),a=this.pointCoordinate(new t.Point(0,this.height)),s=Math.floor(Math.min(r.x,i.x,o.x,a.x)),u=Math.floor(Math.max(r.x,i.x,o.x,a.x)),l=s-1;l<=u+1;l++)0!==l&&n.push(new t.UnwrappedTileID(l,e));return n},Er.prototype.coveringTiles=function(e){var n=this.coveringZoomLevel(e),r=n;if(void 0!==e.minzoom&&n<e.minzoom)return[];void 0!==e.maxzoom&&n>e.maxzoom&&(n=e.maxzoom);var i=t.MercatorCoordinate.fromLngLat(this.center),o=Math.pow(2,n),a=[o*i.x,o*i.y,0],s=br.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n),u=e.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(u=n);var l=function(t){return{aabb:new wr([t*o,0,0],[(t+1)*o,o,0]),zoom:0,x:0,y:0,wrap:t,fullyVisible:!1}},c=[],p=[],h=n,f=e.reparseOverscaled?r:n;if(this._renderWorldCopies)for(var d=1;d<=3;d++)c.push(l(-d)),c.push(l(d));for(c.push(l(0));c.length>0;){var v=c.pop(),m=v.x,y=v.y,g=v.fullyVisible;if(!g){var _=v.aabb.intersects(s);if(0===_)continue;g=2===_}var x=v.aabb.distanceX(a),b=v.aabb.distanceY(a),w=Math.max(Math.abs(x),Math.abs(b));if(v.zoom===h||w>3+(1<<h-v.zoom)-2&&v.zoom>=u)p.push({tileID:new t.OverscaledTileID(v.zoom===h?f:v.zoom,v.wrap,v.zoom,m,y),distanceSq:t.sqrLen([a[0]-.5-m,a[1]-.5-y])});else for(var S=0;S<4;S++){var E=(m<<1)+S%2,C=(y<<1)+(S>>1);c.push({aabb:v.aabb.quadrant(S),zoom:v.zoom+1,x:E,y:C,wrap:v.wrap,fullyVisible:g})}}return p.sort((function(t,e){return t.distanceSq-e.distanceSq})).map((function(t){return t.tileID}))},Er.prototype.resize=function(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()},Cr.unmodified.get=function(){return this._unmodified},Er.prototype.zoomScale=function(t){return Math.pow(2,t)},Er.prototype.scaleZoom=function(t){return Math.log(t)/Math.LN2},Er.prototype.project=function(e){var n=t.clamp(e.lat,-this.maxValidLatitude,this.maxValidLatitude);return new t.Point(t.mercatorXfromLng(e.lng)*this.worldSize,t.mercatorYfromLat(n)*this.worldSize)},Er.prototype.unproject=function(e){return new t.MercatorCoordinate(e.x/this.worldSize,e.y/this.worldSize).toLngLat()},Cr.point.get=function(){return this.project(this.center)},Er.prototype.setLocationAtPoint=function(e,n){var r=this.pointCoordinate(n),i=this.pointCoordinate(this.centerPoint),o=this.locationCoordinate(e),a=new t.MercatorCoordinate(o.x-(r.x-i.x),o.y-(r.y-i.y));this.center=this.coordinateLocation(a),this._renderWorldCopies&&(this.center=this.center.wrap())},Er.prototype.locationPoint=function(t){return this.coordinatePoint(this.locationCoordinate(t))},Er.prototype.pointLocation=function(t){return this.coordinateLocation(this.pointCoordinate(t))},Er.prototype.locationCoordinate=function(e){return t.MercatorCoordinate.fromLngLat(e)},Er.prototype.coordinateLocation=function(t){return t.toLngLat()},Er.prototype.pointCoordinate=function(e){var n=[e.x,e.y,0,1],r=[e.x,e.y,1,1];t.transformMat4(n,n,this.pixelMatrixInverse),t.transformMat4(r,r,this.pixelMatrixInverse);var i=n[3],o=r[3],a=n[1]/i,s=r[1]/o,u=n[2]/i,l=r[2]/o,c=u===l?0:(0-u)/(l-u);return new t.MercatorCoordinate(t.number(n[0]/i,r[0]/o,c)/this.worldSize,t.number(a,s,c)/this.worldSize)},Er.prototype.coordinatePoint=function(e){var n=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.transformMat4(n,n,this.pixelMatrix),new t.Point(n[0]/n[3],n[1]/n[3])},Er.prototype.getBounds=function(){return(new t.LngLatBounds).extend(this.pointLocation(new t.Point(0,0))).extend(this.pointLocation(new t.Point(this.width,0))).extend(this.pointLocation(new t.Point(this.width,this.height))).extend(this.pointLocation(new t.Point(0,this.height)))},Er.prototype.getMaxBounds=function(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new t.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Er.prototype.setMaxBounds=function(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Er.prototype.calculatePosMatrix=function(e,n){void 0===n&&(n=!1);var r=e.key,i=n?this._alignedPosMatrixCache:this._posMatrixCache;if(i[r])return i[r];var o=e.canonical,a=this.worldSize/this.zoomScale(o.z),s=o.x+Math.pow(2,o.z)*e.wrap,u=t.identity(new Float64Array(16));return t.translate(u,u,[s*a,o.y*a,0]),t.scale(u,u,[a/t.EXTENT,a/t.EXTENT,1]),t.multiply(u,n?this.alignedProjMatrix:this.projMatrix,u),i[r]=new Float32Array(u),i[r]},Er.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Er.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var e,n,r,i,o=-90,a=90,s=-180,u=180,l=this.size,c=this._unmodified;if(this.latRange){var p=this.latRange;o=t.mercatorYfromLat(p[1])*this.worldSize,e=(a=t.mercatorYfromLat(p[0])*this.worldSize)-o<l.y?l.y/(a-o):0}if(this.lngRange){var h=this.lngRange;s=t.mercatorXfromLng(h[0])*this.worldSize,n=(u=t.mercatorXfromLng(h[1])*this.worldSize)-s<l.x?l.x/(u-s):0}var f=this.point,d=Math.max(n||0,e||0);if(d)return this.center=this.unproject(new t.Point(n?(u+s)/2:f.x,e?(a+o)/2:f.y)),this.zoom+=this.scaleZoom(d),this._unmodified=c,void(this._constraining=!1);if(this.latRange){var v=f.y,m=l.y/2;v-m<o&&(i=o+m),v+m>a&&(i=a-m)}if(this.lngRange){var y=f.x,g=l.x/2;y-g<s&&(r=s+g),y+g>u&&(r=u-g)}void 0===r&&void 0===i||(this.center=this.unproject(new t.Point(void 0!==r?r:f.x,void 0!==i?i:f.y))),this._unmodified=c,this._constraining=!1}},Er.prototype._calcMatrices=function(){if(this.height){var e=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var n=Math.PI/2+this._pitch,r=this._fov*(.5+e.y/this.height),i=Math.sin(r)*this.cameraToCenterDistance/Math.sin(t.clamp(Math.PI-n-r,.01,Math.PI-.01)),o=this.point,a=o.x,s=o.y,u=1.01*(Math.cos(Math.PI/2-this._pitch)*i+this.cameraToCenterDistance),l=this.height/50,c=new Float64Array(16);t.perspective(c,this._fov,this.width/this.height,l,u),c[8]=2*-e.x/this.width,c[9]=2*e.y/this.height,t.scale(c,c,[1,-1,1]),t.translate(c,c,[0,0,-this.cameraToCenterDistance]),t.rotateX(c,c,this._pitch),t.rotateZ(c,c,this.angle),t.translate(c,c,[-a,-s,0]),this.mercatorMatrix=t.scale([],c,[this.worldSize,this.worldSize,this.worldSize]),t.scale(c,c,[1,1,t.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=c,this.invProjMatrix=t.invert([],this.projMatrix);var p=this.width%2/2,h=this.height%2/2,f=Math.cos(this.angle),d=Math.sin(this.angle),v=a-Math.round(a)+f*p+d*h,m=s-Math.round(s)+f*h+d*p,y=new Float64Array(c);if(t.translate(y,y,[v>.5?v-1:v,m>.5?m-1:m,0]),this.alignedProjMatrix=y,c=t.create(),t.scale(c,c,[this.width/2,-this.height/2,1]),t.translate(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=t.create(),t.scale(c,c,[1,-1,1]),t.translate(c,c,[-1,-1,0]),t.scale(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c,this.pixelMatrix=t.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(c=t.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=c,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Er.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var e=this.pointCoordinate(new t.Point(0,0)),n=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.transformMat4(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance},Er.prototype.getCameraPoint=function(){var e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.Point(0,e))},Er.prototype.getCameraQueryGeometry=function(e){var n=this.getCameraPoint();if(1===e.length)return[e[0],n];for(var r=n.x,i=n.y,o=n.x,a=n.y,s=0,u=e;s<u.length;s+=1){var l=u[s];r=Math.min(r,l.x),i=Math.min(i,l.y),o=Math.max(o,l.x),a=Math.max(a,l.y)}return[new t.Point(r,i),new t.Point(o,i),new t.Point(o,a),new t.Point(r,a),new t.Point(r,i)]},Object.defineProperties(Er.prototype,Cr);var Tr=function(e){var n,r,i,o;this._hashName=e&&encodeURIComponent(e),t.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(n=this._updateHashUnthrottled.bind(this),r=!1,i=null,o=function(){i=null,r&&(n(),i=setTimeout(o,300),r=!1)},function(){return r=!0,i||o(),i})};Tr.prototype.addTo=function(e){return this._map=e,t.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Tr.prototype.remove=function(){return t.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Tr.prototype.getHashString=function(e){var n=this._map.getCenter(),r=Math.round(100*this._map.getZoom())/100,i=Math.ceil((r*Math.LN2+Math.log(512/360/.5))/Math.LN10),o=Math.pow(10,i),a=Math.round(n.lng*o)/o,s=Math.round(n.lat*o)/o,u=this._map.getBearing(),l=this._map.getPitch(),c="";if(c+=e?"/"+a+"/"+s+"/"+r:r+"/"+s+"/"+a,(u||l)&&(c+="/"+Math.round(10*u)/10),l&&(c+="/"+Math.round(l)),this._hashName){var p=this._hashName,h=!1,f=t.window.location.hash.slice(1).split("&").map((function(t){var e=t.split("=")[0];return e===p?(h=!0,e+"="+c):t})).filter((function(t){return t}));return h||f.push(p+"="+c),"#"+f.join("&")}return"#"+c},Tr.prototype._getCurrentHash=function(){var e,n=this,r=t.window.location.hash.replace("#","");return this._hashName?(r.split("&").map((function(t){return t.split("=")})).forEach((function(t){t[0]===n._hashName&&(e=t)})),(e&&e[1]||"").split("/")):r.split("/")},Tr.prototype._onHashChange=function(){var t=this._getCurrentHash();if(t.length>=3&&!t.some((function(t){return isNaN(t)}))){var e=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:e,pitch:+(t[4]||0)}),!0}return!1},Tr.prototype._updateHashUnthrottled=function(){var e=t.window.location.href.replace(/(#.+)?$/,this.getHashString());try{t.window.history.replaceState(t.window.history.state,null,e)}catch(t){}};var Ar={linearity:.3,easing:t.bezier(0,0,.3,1)},Mr=t.extend({deceleration:2500,maxSpeed:1400},Ar),kr=t.extend({deceleration:20,maxSpeed:1400},Ar),Pr=t.extend({deceleration:1e3,maxSpeed:360},Ar),Or=t.extend({deceleration:1e3,maxSpeed:90},Ar),Lr=function(t){this._map=t,this.clear()};function Ir(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function Rr(e,n,r){var i=r.maxSpeed,o=r.linearity,a=r.deceleration,s=t.clamp(e*o/(n/1e3),-i,i),u=Math.abs(s)/(a*o);return{easing:r.easing,duration:1e3*u,amount:s*(u/2)}}Lr.prototype.clear=function(){this._inertiaBuffer=[]},Lr.prototype.record=function(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:t.browser.now(),settings:e})},Lr.prototype._drainInertiaBuffer=function(){for(var e=this._inertiaBuffer,n=t.browser.now();e.length>0&&n-e[0].time>160;)e.shift()},Lr.prototype._onMoveEnd=function(e){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var n={zoom:0,bearing:0,pitch:0,pan:new t.Point(0,0),pinchAround:void 0,around:void 0},r=0,i=this._inertiaBuffer;r<i.length;r+=1){var o=i[r].settings;n.zoom+=o.zoomDelta||0,n.bearing+=o.bearingDelta||0,n.pitch+=o.pitchDelta||0,o.panDelta&&n.pan._add(o.panDelta),o.around&&(n.around=o.around),o.pinchAround&&(n.pinchAround=o.pinchAround)}var a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,s={};if(n.pan.mag()){var u=Rr(n.pan.mag(),a,t.extend({},Mr,e||{}));s.offset=n.pan.mult(u.amount/n.pan.mag()),s.center=this._map.transform.center,Ir(s,u)}if(n.zoom){var l=Rr(n.zoom,a,kr);s.zoom=this._map.transform.zoom+l.amount,Ir(s,l)}if(n.bearing){var c=Rr(n.bearing,a,Pr);s.bearing=this._map.transform.bearing+t.clamp(c.amount,-179,179),Ir(s,c)}if(n.pitch){var p=Rr(n.pitch,a,Or);s.pitch=this._map.transform.pitch+p.amount,Ir(s,p)}if(s.zoom||s.bearing){var h=void 0===n.pinchAround?n.around:n.pinchAround;s.around=h?this._map.unproject(h):this._map.getCenter()}return this.clear(),t.extend(s,{noMoveStart:!0})}};var Dr=function(e){function r(r,i,o,a){void 0===a&&(a={});var s=n.mousePos(i.getCanvasContainer(),o),u=i.unproject(s);e.call(this,r,t.extend({point:s,lngLat:u,originalEvent:o},a)),this._defaultPrevented=!1,this.target=i}e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r;var i={defaultPrevented:{configurable:!0}};return r.prototype.preventDefault=function(){this._defaultPrevented=!0},i.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(r.prototype,i),r}(t.Event),Nr=function(e){function r(r,i,o){var a="touchend"===r?o.changedTouches:o.touches,s=n.touchPos(i.getCanvasContainer(),a),u=s.map((function(t){return i.unproject(t)})),l=s.reduce((function(t,e,n,r){return t.add(e.div(r.length))}),new t.Point(0,0)),c=i.unproject(l);e.call(this,r,{points:s,point:l,lngLats:u,lngLat:c,originalEvent:o}),this._defaultPrevented=!1}e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r;var i={defaultPrevented:{configurable:!0}};return r.prototype.preventDefault=function(){this._defaultPrevented=!0},i.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(r.prototype,i),r}(t.Event),Zr=function(t){function e(e,n,r){t.call(this,e,{originalEvent:r}),this._defaultPrevented=!1}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={defaultPrevented:{configurable:!0}};return e.prototype.preventDefault=function(){this._defaultPrevented=!0},n.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(e.prototype,n),e}(t.Event),zr=function(t,e){this._map=t,this._clickTolerance=e.clickTolerance};zr.prototype.reset=function(){delete this._mousedownPos},zr.prototype.wheel=function(t){return this._firePreventable(new Zr(t.type,this._map,t))},zr.prototype.mousedown=function(t,e){return this._mousedownPos=e,this._firePreventable(new Dr(t.type,this._map,t))},zr.prototype.mouseup=function(t){this._map.fire(new Dr(t.type,this._map,t))},zr.prototype.click=function(t,e){this._mousedownPos&&this._mousedownPos.dist(e)>=this._clickTolerance||this._map.fire(new Dr(t.type,this._map,t))},zr.prototype.dblclick=function(t){return this._firePreventable(new Dr(t.type,this._map,t))},zr.prototype.mouseover=function(t){this._map.fire(new Dr(t.type,this._map,t))},zr.prototype.mouseout=function(t){this._map.fire(new Dr(t.type,this._map,t))},zr.prototype.touchstart=function(t){return this._firePreventable(new Nr(t.type,this._map,t))},zr.prototype.touchmove=function(t){this._map.fire(new Nr(t.type,this._map,t))},zr.prototype.touchend=function(t){this._map.fire(new Nr(t.type,this._map,t))},zr.prototype.touchcancel=function(t){this._map.fire(new Nr(t.type,this._map,t))},zr.prototype._firePreventable=function(t){if(this._map.fire(t),t.defaultPrevented)return{}},zr.prototype.isEnabled=function(){return!0},zr.prototype.isActive=function(){return!1},zr.prototype.enable=function(){},zr.prototype.disable=function(){};var Fr=function(t){this._map=t};Fr.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Fr.prototype.mousemove=function(t){this._map.fire(new Dr(t.type,this._map,t))},Fr.prototype.mousedown=function(){this._delayContextMenu=!0},Fr.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Dr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Fr.prototype.contextmenu=function(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Dr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()},Fr.prototype.isEnabled=function(){return!0},Fr.prototype.isActive=function(){return!1},Fr.prototype.enable=function(){},Fr.prototype.disable=function(){};var Br=function(t,e){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=e.clickTolerance||1};function jr(t,e){for(var n={},r=0;r<t.length;r++)n[t[r].identifier]=e[r];return n}Br.prototype.isEnabled=function(){return!!this._enabled},Br.prototype.isActive=function(){return!!this._active},Br.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Br.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Br.prototype.mousedown=function(t,e){this.isEnabled()&&t.shiftKey&&0===t.button&&(n.disableDrag(),this._startPos=this._lastPos=e,this._active=!0)},Br.prototype.mousemoveWindow=function(t,e){if(this._active){var r=e;if(!(this._lastPos.equals(r)||!this._box&&r.dist(this._startPos)<this._clickTolerance)){var i=this._startPos;this._lastPos=r,this._box||(this._box=n.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));var o=Math.min(i.x,r.x),a=Math.max(i.x,r.x),s=Math.min(i.y,r.y),u=Math.max(i.y,r.y);n.setTransform(this._box,"translate("+o+"px,"+s+"px)"),this._box.style.width=a-o+"px",this._box.style.height=u-s+"px"}}},Br.prototype.mouseupWindow=function(e,r){var i=this;if(this._active&&0===e.button){var o=this._startPos,a=r;if(this.reset(),n.suppressClick(),o.x!==a.x||o.y!==a.y)return this._map.fire(new t.Event("boxzoomend",{originalEvent:e})),{cameraAnimation:function(t){return t.fitScreenCoordinates(o,a,i._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",e)}},Br.prototype.keydown=function(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))},Br.prototype.blur=function(){this.reset()},Br.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(n.remove(this._box),this._box=null),n.enableDrag(),delete this._startPos,delete this._lastPos},Br.prototype._fireEvent=function(e,n){return this._map.fire(new t.Event(e,{originalEvent:n}))};var Ur=function(t){this.reset(),this.numTouches=t.numTouches};Ur.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Ur.prototype.touchstart=function(e,n,r){(this.centroid||r.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=e.timeStamp),r.length===this.numTouches&&(this.centroid=function(e){for(var n=new t.Point(0,0),r=0,i=e;r<i.length;r+=1)n._add(i[r]);return n.div(e.length)}(n),this.touches=jr(r,n)))},Ur.prototype.touchmove=function(t,e,n){if(!this.aborted&&this.centroid){var r=jr(n,e);for(var i in this.touches){var o=r[i];(!o||o.dist(this.touches[i])>30)&&(this.aborted=!0)}}},Ur.prototype.touchend=function(t,e,n){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){var r=!this.aborted&&this.centroid;if(this.reset(),r)return r}};var Vr=function(t){this.singleTap=new Ur(t),this.numTaps=t.numTaps,this.reset()};Vr.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Vr.prototype.touchstart=function(t,e,n){this.singleTap.touchstart(t,e,n)},Vr.prototype.touchmove=function(t,e,n){this.singleTap.touchmove(t,e,n)},Vr.prototype.touchend=function(t,e,n){var r=this.singleTap.touchend(t,e,n);if(r){var i=t.timeStamp-this.lastTime<500,o=!this.lastTap||this.lastTap.dist(r)<30;if(i&&o||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}};var Gr=function(){this._zoomIn=new Vr({numTouches:1,numTaps:2}),this._zoomOut=new Vr({numTouches:2,numTaps:1}),this.reset()};Gr.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Gr.prototype.touchstart=function(t,e,n){this._zoomIn.touchstart(t,e,n),this._zoomOut.touchstart(t,e,n)},Gr.prototype.touchmove=function(t,e,n){this._zoomIn.touchmove(t,e,n),this._zoomOut.touchmove(t,e,n)},Gr.prototype.touchend=function(t,e,n){var r=this,i=this._zoomIn.touchend(t,e,n),o=this._zoomOut.touchend(t,e,n);return i?(this._active=!0,t.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(e){return e.easeTo({duration:300,zoom:e.getZoom()+1,around:e.unproject(i)},{originalEvent:t})}}):o?(this._active=!0,t.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(e){return e.easeTo({duration:300,zoom:e.getZoom()-1,around:e.unproject(o)},{originalEvent:t})}}):void 0},Gr.prototype.touchcancel=function(){this.reset()},Gr.prototype.enable=function(){this._enabled=!0},Gr.prototype.disable=function(){this._enabled=!1,this.reset()},Gr.prototype.isEnabled=function(){return this._enabled},Gr.prototype.isActive=function(){return this._active};var Hr={0:1,2:2},Wr=function(t){this.reset(),this._clickTolerance=t.clickTolerance||1};Wr.prototype.blur=function(){this.reset()},Wr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Wr.prototype._correctButton=function(t,e){return!1},Wr.prototype._move=function(t,e){return{}},Wr.prototype.mousedown=function(t,e){if(!this._lastPoint){var r=n.mouseButton(t);this._correctButton(t,r)&&(this._lastPoint=e,this._eventButton=r)}},Wr.prototype.mousemoveWindow=function(t,e){var n=this._lastPoint;if(n)if(t.preventDefault(),function(t,e){var n=Hr[e];return void 0===t.buttons||(t.buttons&n)!==n}(t,this._eventButton))this.reset();else if(this._moved||!(e.dist(n)<this._clickTolerance))return this._moved=!0,this._lastPoint=e,this._move(n,e)},Wr.prototype.mouseupWindow=function(t){this._lastPoint&&n.mouseButton(t)===this._eventButton&&(this._moved&&n.suppressClick(),this.reset())},Wr.prototype.enable=function(){this._enabled=!0},Wr.prototype.disable=function(){this._enabled=!1,this.reset()},Wr.prototype.isEnabled=function(){return this._enabled},Wr.prototype.isActive=function(){return this._active};var qr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.mousedown=function(e,n){t.prototype.mousedown.call(this,e,n),this._lastPoint&&(this._active=!0)},e.prototype._correctButton=function(t,e){return 0===e&&!t.ctrlKey},e.prototype._move=function(t,e){return{around:e,panDelta:e.sub(t)}},e}(Wr),Xr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._correctButton=function(t,e){return 0===e&&t.ctrlKey||2===e},e.prototype._move=function(t,e){var n=.8*(e.x-t.x);if(n)return this._active=!0,{bearingDelta:n}},e.prototype.contextmenu=function(t){t.preventDefault()},e}(Wr),Yr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._correctButton=function(t,e){return 0===e&&t.ctrlKey||2===e},e.prototype._move=function(t,e){var n=-.5*(e.y-t.y);if(n)return this._active=!0,{pitchDelta:n}},e.prototype.contextmenu=function(t){t.preventDefault()},e}(Wr),Kr=function(t){this._minTouches=1,this._clickTolerance=t.clickTolerance||1,this.reset()};Kr.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new t.Point(0,0)},Kr.prototype.touchstart=function(t,e,n){return this._calculateTransform(t,e,n)},Kr.prototype.touchmove=function(t,e,n){if(this._active&&!(n.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,e,n)},Kr.prototype.touchend=function(t,e,n){this._calculateTransform(t,e,n),this._active&&n.length<this._minTouches&&this.reset()},Kr.prototype.touchcancel=function(){this.reset()},Kr.prototype._calculateTransform=function(e,n,r){r.length>0&&(this._active=!0);var i=jr(r,n),o=new t.Point(0,0),a=new t.Point(0,0),s=0;for(var u in i){var l=i[u],c=this._touches[u];c&&(o._add(l),a._add(l.sub(c)),s++,i[u]=l)}if(this._touches=i,!(s<this._minTouches)&&a.mag()){var p=a.div(s);if(this._sum._add(p),!(this._sum.mag()<this._clickTolerance))return{around:o.div(s),panDelta:p}}},Kr.prototype.enable=function(){this._enabled=!0},Kr.prototype.disable=function(){this._enabled=!1,this.reset()},Kr.prototype.isEnabled=function(){return this._enabled},Kr.prototype.isActive=function(){return this._active};var Qr=function(){this.reset()};function Jr(t,e,n){for(var r=0;r<t.length;r++)if(t[r].identifier===n)return e[r]}function $r(t,e){return Math.log(t/e)/Math.LN2}Qr.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Qr.prototype._start=function(t){},Qr.prototype._move=function(t,e,n){return{}},Qr.prototype.touchstart=function(t,e,n){this._firstTwoTouches||n.length<2||(this._firstTwoTouches=[n[0].identifier,n[1].identifier],this._start([e[0],e[1]]))},Qr.prototype.touchmove=function(t,e,n){if(this._firstTwoTouches){t.preventDefault();var r=this._firstTwoTouches,i=r[1],o=Jr(n,e,r[0]),a=Jr(n,e,i);if(o&&a){var s=this._aroundCenter?null:o.add(a).div(2);return this._move([o,a],s,t)}}},Qr.prototype.touchend=function(t,e,r){if(this._firstTwoTouches){var i=this._firstTwoTouches,o=i[1],a=Jr(r,e,i[0]),s=Jr(r,e,o);a&&s||(this._active&&n.suppressClick(),this.reset())}},Qr.prototype.touchcancel=function(){this.reset()},Qr.prototype.enable=function(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around},Qr.prototype.disable=function(){this._enabled=!1,this.reset()},Qr.prototype.isEnabled=function(){return this._enabled},Qr.prototype.isActive=function(){return this._active};var ti=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.reset=function(){t.prototype.reset.call(this),delete this._distance,delete this._startDistance},e.prototype._start=function(t){this._startDistance=this._distance=t[0].dist(t[1])},e.prototype._move=function(t,e){var n=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs($r(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:$r(this._distance,n),pinchAround:e}},e}(Qr);function ei(t,e){return 180*t.angleWith(e)/Math.PI}var ni=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.reset=function(){t.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},e.prototype._start=function(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])},e.prototype._move=function(t,e){var n=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ei(this._vector,n),pinchAround:e}},e.prototype._isBelowThreshold=function(t){this._minDiameter=Math.min(this._minDiameter,t.mag());var e=25/(Math.PI*this._minDiameter)*360,n=ei(t,this._startVector);return Math.abs(n)<e},e}(Qr);function ri(t){return Math.abs(t.y)>Math.abs(t.x)}var ii=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.reset=function(){t.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},e.prototype._start=function(t){this._lastPoints=t,ri(t[0].sub(t[1]))&&(this._valid=!1)},e.prototype._move=function(t,e,n){var r=t[0].sub(this._lastPoints[0]),i=t[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(r,i,n.timeStamp),this._valid)return this._lastPoints=t,this._active=!0,{pitchDelta:(r.y+i.y)/2*-.5}},e.prototype.gestureBeginsVertically=function(t,e,n){if(void 0!==this._valid)return this._valid;var r=t.mag()>=2,i=e.mag()>=2;if(r||i){if(!r||!i)return void 0===this._firstMove&&(this._firstMove=n),n-this._firstMove<100&&void 0;var o=t.y>0==e.y>0;return ri(t)&&ri(e)&&o}},e}(Qr),oi={panStep:100,bearingStep:15,pitchStep:10},ai=function(){var t=oi;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1};function si(t){return t*(2-t)}ai.prototype.blur=function(){this.reset()},ai.prototype.reset=function(){this._active=!1},ai.prototype.keydown=function(t){var e=this;if(!(t.altKey||t.ctrlKey||t.metaKey)){var n=0,r=0,i=0,o=0,a=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?r=-1:(t.preventDefault(),o=-1);break;case 39:t.shiftKey?r=1:(t.preventDefault(),o=1);break;case 38:t.shiftKey?i=1:(t.preventDefault(),a=-1);break;case 40:t.shiftKey?i=-1:(t.preventDefault(),a=1);break;default:return}return this._rotationDisabled&&(r=0,i=0),{cameraAnimation:function(s){var u=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:si,zoom:n?Math.round(u)+n*(t.shiftKey?2:1):u,bearing:s.getBearing()+r*e._bearingStep,pitch:s.getPitch()+i*e._pitchStep,offset:[-o*e._panStep,-a*e._panStep],center:s.getCenter()},{originalEvent:t})}}}},ai.prototype.enable=function(){this._enabled=!0},ai.prototype.disable=function(){this._enabled=!1,this.reset()},ai.prototype.isEnabled=function(){return this._enabled},ai.prototype.isActive=function(){return this._active},ai.prototype.disableRotation=function(){this._rotationDisabled=!0},ai.prototype.enableRotation=function(){this._rotationDisabled=!1};var ui=function(e,n){this._map=e,this._el=e.getCanvasContainer(),this._handler=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,t.bindAll(["_onTimeout"],this)};ui.prototype.setZoomRate=function(t){this._defaultZoomRate=t},ui.prototype.setWheelZoomRate=function(t){this._wheelZoomRate=t},ui.prototype.isEnabled=function(){return!!this._enabled},ui.prototype.isActive=function(){return!!this._active||void 0!==this._finishTimeout},ui.prototype.isZooming=function(){return!!this._zooming},ui.prototype.enable=function(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&"center"===t.around)},ui.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ui.prototype.wheel=function(e){if(this.isEnabled()){var n=e.deltaMode===t.window.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,r=t.browser.now(),i=r-(this._lastWheelEventTime||0);this._lastWheelEventTime=r,0!==n&&n%4.000244140625==0?this._type="wheel":0!==n&&Math.abs(n)<4?this._type="trackpad":i>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(i*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),e.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=e,this._delta-=n,this._active||this._start(e)),e.preventDefault()}},ui.prototype._onTimeout=function(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)},ui.prototype._start=function(e){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var r=n.mousePos(this._el,e);this._around=t.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(r)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},ui.prototype.renderFrame=function(){var e=this;if(this._frameId&&(this._frameId=null,this.isActive())){var n=this._map.transform;if(0!==this._delta){var r="wheel"===this._type&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,i=2/(1+Math.exp(-Math.abs(this._delta*r)));this._delta<0&&0!==i&&(i=1/i);var o="number"==typeof this._targetZoom?n.zoomScale(this._targetZoom):n.scale;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(o*i))),"wheel"===this._type&&(this._startZoom=n.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var a,s="number"==typeof this._targetZoom?this._targetZoom:n.zoom,u=this._startZoom,l=this._easing,c=!1;if("wheel"===this._type&&u&&l){var p=Math.min((t.browser.now()-this._lastWheelEventTime)/200,1),h=l(p);a=t.number(u,s,h),p<1?this._frameId||(this._frameId=!0):c=!0}else a=s,c=!0;return this._active=!0,c&&(this._active=!1,this._finishTimeout=setTimeout((function(){e._zooming=!1,e._handler._triggerRenderFrame(),delete e._targetZoom,delete e._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!c,zoomDelta:a-n.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},ui.prototype._smoothOutEasing=function(e){var n=t.ease;if(this._prevEase){var r=this._prevEase,i=(t.browser.now()-r.start)/r.duration,o=r.easing(i+.01)-r.easing(i),a=.27/Math.sqrt(o*o+1e-4)*.01,s=Math.sqrt(.0729-a*a);n=t.bezier(a,s,.25,1)}return this._prevEase={start:t.browser.now(),duration:e,easing:n},n},ui.prototype.blur=function(){this.reset()},ui.prototype.reset=function(){this._active=!1};var li=function(t,e){this._clickZoom=t,this._tapZoom=e};li.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},li.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},li.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},li.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var ci=function(){this.reset()};ci.prototype.reset=function(){this._active=!1},ci.prototype.blur=function(){this.reset()},ci.prototype.dblclick=function(t,e){return t.preventDefault(),{cameraAnimation:function(n){n.easeTo({duration:300,zoom:n.getZoom()+(t.shiftKey?-1:1),around:n.unproject(e)},{originalEvent:t})}}},ci.prototype.enable=function(){this._enabled=!0},ci.prototype.disable=function(){this._enabled=!1,this.reset()},ci.prototype.isEnabled=function(){return this._enabled},ci.prototype.isActive=function(){return this._active};var pi=function(){this._tap=new Vr({numTouches:1,numTaps:1}),this.reset()};pi.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},pi.prototype.touchstart=function(t,e,n){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?n.length>0&&(this._swipePoint=e[0],this._swipeTouch=n[0].identifier):this._tap.touchstart(t,e,n))},pi.prototype.touchmove=function(t,e,n){if(this._tapTime){if(this._swipePoint){if(n[0].identifier!==this._swipeTouch)return;var r=e[0],i=r.y-this._swipePoint.y;return this._swipePoint=r,t.preventDefault(),this._active=!0,{zoomDelta:i/128}}}else this._tap.touchmove(t,e,n)},pi.prototype.touchend=function(t,e,n){this._tapTime?this._swipePoint&&0===n.length&&this.reset():this._tap.touchend(t,e,n)&&(this._tapTime=t.timeStamp)},pi.prototype.touchcancel=function(){this.reset()},pi.prototype.enable=function(){this._enabled=!0},pi.prototype.disable=function(){this._enabled=!1,this.reset()},pi.prototype.isEnabled=function(){return this._enabled},pi.prototype.isActive=function(){return this._active};var hi=function(t,e,n){this._el=t,this._mousePan=e,this._touchPan=n};hi.prototype.enable=function(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},hi.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},hi.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},hi.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var fi=function(t,e,n){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=e,this._mousePitch=n};fi.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},fi.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},fi.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},fi.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var di=function(t,e,n,r){this._el=t,this._touchZoom=e,this._touchRotate=n,this._tapDragZoom=r,this._rotationDisabled=!1,this._enabled=!0};di.prototype.enable=function(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},di.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},di.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},di.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},di.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},di.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var vi=function(t){return t.zoom||t.drag||t.pitch||t.rotate},mi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(t.Event);function yi(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}var gi=function(e,r){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Lr(e),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(r),t.bindAll(["handleEvent","handleWindowEvent"],this);var i=this._el;this._listeners=[[i,"touchstart",{passive:!0}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[t.window.document,"mousemove",{capture:!0}],[t.window.document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[t.window,"blur",void 0]];for(var o=0,a=this._listeners;o<a.length;o+=1){var s=a[o],u=s[0];n.addEventListener(u,s[1],u===t.window.document?this.handleWindowEvent:this.handleEvent,s[2])}};gi.prototype.destroy=function(){for(var e=0,r=this._listeners;e<r.length;e+=1){var i=r[e],o=i[0];n.removeEventListener(o,i[1],o===t.window.document?this.handleWindowEvent:this.handleEvent,i[2])}},gi.prototype._addDefaultHandlers=function(t){var e=this._map,n=e.getCanvasContainer();this._add("mapEvent",new zr(e,t));var r=e.boxZoom=new Br(e,t);this._add("boxZoom",r);var i=new Gr,o=new ci;e.doubleClickZoom=new li(o,i),this._add("tapZoom",i),this._add("clickZoom",o);var a=new pi;this._add("tapDragZoom",a);var s=e.touchPitch=new ii;this._add("touchPitch",s);var u=new Xr(t),l=new Yr(t);e.dragRotate=new fi(t,u,l),this._add("mouseRotate",u,["mousePitch"]),this._add("mousePitch",l,["mouseRotate"]);var c=new qr(t),p=new Kr(t);e.dragPan=new hi(n,c,p),this._add("mousePan",c),this._add("touchPan",p,["touchZoom","touchRotate"]);var h=new ni,f=new ti;e.touchZoomRotate=new di(n,f,h,a),this._add("touchRotate",h,["touchPan","touchZoom"]),this._add("touchZoom",f,["touchPan","touchRotate"]);var d=e.scrollZoom=new ui(e,this);this._add("scrollZoom",d,["mousePan"]);var v=e.keyboard=new ai;this._add("keyboard",v),this._add("blockableMapEvent",new Fr(e));for(var m=0,y=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];m<y.length;m+=1){var g=y[m];t.interactive&&t[g]&&e[g].enable(t[g])}},gi.prototype._add=function(t,e,n){this._handlers.push({handlerName:t,handler:e,allowed:n}),this._handlersById[t]=e},gi.prototype.stop=function(t){if(!this._updatingCamera){for(var e=0,n=this._handlers;e<n.length;e+=1)n[e].handler.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}},gi.prototype.isActive=function(){for(var t=0,e=this._handlers;t<e.length;t+=1)if(e[t].handler.isActive())return!0;return!1},gi.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},gi.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},gi.prototype.isMoving=function(){return Boolean(vi(this._eventsInProgress))||this.isZooming()},gi.prototype._blockedByActive=function(t,e,n){for(var r in t)if(r!==n&&(!e||e.indexOf(r)<0))return!0;return!1},gi.prototype.handleWindowEvent=function(t){this.handleEvent(t,t.type+"Window")},gi.prototype._getMapTouches=function(t){for(var e=[],n=0,r=t;n<r.length;n+=1){var i=r[n];this._el.contains(i.target)&&e.push(i)}return e},gi.prototype.handleEvent=function(t,e){this._updatingCamera=!0;for(var r="renderFrame"===t.type?void 0:t,i={needsRenderFrame:!1},o={},a={},s=t.touches?this._getMapTouches(t.touches):void 0,u=s?n.touchPos(this._el,s):n.mousePos(this._el,t),l=0,c=this._handlers;l<c.length;l+=1){var p=c[l],h=p.handlerName,f=p.handler,d=p.allowed;if(f.isEnabled()){var v=void 0;this._blockedByActive(a,d,h)?f.reset():f[e||t.type]&&(v=f[e||t.type](t,u,s),this.mergeHandlerResult(i,o,v,h,r),v&&v.needsRenderFrame&&this._triggerRenderFrame()),(v||f.isActive())&&(a[h]=f)}}var m={};for(var y in this._previousActiveHandlers)a[y]||(m[y]=r);this._previousActiveHandlers=a,(Object.keys(m).length||yi(i))&&(this._changes.push([i,o,m]),this._triggerRenderFrame()),(Object.keys(a).length||yi(i))&&this._map._stop(!0),this._updatingCamera=!1;var g=i.cameraAnimation;g&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],g(this._map))},gi.prototype.mergeHandlerResult=function(e,n,r,i,o){if(r){t.extend(e,r);var a={handlerName:i,originalEvent:r.originalEvent||o};void 0!==r.zoomDelta&&(n.zoom=a),void 0!==r.panDelta&&(n.drag=a),void 0!==r.pitchDelta&&(n.pitch=a),void 0!==r.bearingDelta&&(n.rotate=a)}},gi.prototype._applyChanges=function(){for(var e={},n={},r={},i=0,o=this._changes;i<o.length;i+=1){var a=o[i],s=a[0],u=a[1],l=a[2];s.panDelta&&(e.panDelta=(e.panDelta||new t.Point(0,0))._add(s.panDelta)),s.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+s.zoomDelta),s.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+s.bearingDelta),s.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+s.pitchDelta),void 0!==s.around&&(e.around=s.around),void 0!==s.pinchAround&&(e.pinchAround=s.pinchAround),s.noInertia&&(e.noInertia=s.noInertia),t.extend(n,u),t.extend(r,l)}this._updateMapTransform(e,n,r),this._changes=[]},gi.prototype._updateMapTransform=function(t,e,n){var r=this._map,i=r.transform;if(!yi(t))return this._fireEvents(e,n,!0);var o=t.panDelta,a=t.zoomDelta,s=t.bearingDelta,u=t.pitchDelta,l=t.around,c=t.pinchAround;void 0!==c&&(l=c),r._stop(!0),l=l||r.transform.centerPoint;var p=i.pointLocation(o?l.sub(o):l);s&&(i.bearing+=s),u&&(i.pitch+=u),a&&(i.zoom+=a),i.setLocationAtPoint(p,l),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(e,n,!0)},gi.prototype._fireEvents=function(e,n,r){var i=this,o=vi(this._eventsInProgress),a=vi(e),s={};for(var u in e)this._eventsInProgress[u]||(s[u+"start"]=e[u].originalEvent),this._eventsInProgress[u]=e[u];for(var l in!o&&a&&this._fireEvent("movestart",a.originalEvent),s)this._fireEvent(l,s[l]);for(var c in a&&this._fireEvent("move",a.originalEvent),e)this._fireEvent(c,e[c].originalEvent);var p,h={};for(var f in this._eventsInProgress){var d=this._eventsInProgress[f],v=d.handlerName,m=d.originalEvent;this._handlersById[v].isActive()||(delete this._eventsInProgress[f],h[f+"end"]=p=n[v]||m)}for(var y in h)this._fireEvent(y,h[y]);var g=vi(this._eventsInProgress);if(r&&(o||a)&&!g){this._updatingCamera=!0;var _=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),x=function(t){return 0!==t&&-i._bearingSnap<t&&t<i._bearingSnap};_?(x(_.bearing||this._map.getBearing())&&(_.bearing=0),this._map.easeTo(_,{originalEvent:p})):(this._map.fire(new t.Event("moveend",{originalEvent:p})),x(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},gi.prototype._fireEvent=function(e,n){this._map.fire(new t.Event(e,n?{originalEvent:n}:{}))},gi.prototype._requestFrame=function(){var t=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add((function(e){delete t._frameId,t.handleEvent(new mi("renderFrame",{timeStamp:e})),t._applyChanges()}))},gi.prototype._triggerRenderFrame=function(){void 0===this._frameId&&(this._frameId=this._requestFrame())};var _i=function(e){function n(n,r){e.call(this),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=r.bearingSnap,t.bindAll(["_renderFrameCallback"],this)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.getCenter=function(){return new t.LngLat(this.transform.center.lng,this.transform.center.lat)},n.prototype.setCenter=function(t,e){return this.jumpTo({center:t},e)},n.prototype.panBy=function(e,n,r){return e=t.Point.convert(e).mult(-1),this.panTo(this.transform.center,t.extend({offset:e},n),r)},n.prototype.panTo=function(e,n,r){return this.easeTo(t.extend({center:e},n),r)},n.prototype.getZoom=function(){return this.transform.zoom},n.prototype.setZoom=function(t,e){return this.jumpTo({zoom:t},e),this},n.prototype.zoomTo=function(e,n,r){return this.easeTo(t.extend({zoom:e},n),r)},n.prototype.zoomIn=function(t,e){return this.zoomTo(this.getZoom()+1,t,e),this},n.prototype.zoomOut=function(t,e){return this.zoomTo(this.getZoom()-1,t,e),this},n.prototype.getBearing=function(){return this.transform.bearing},n.prototype.setBearing=function(t,e){return this.jumpTo({bearing:t},e),this},n.prototype.getPadding=function(){return this.transform.padding},n.prototype.setPadding=function(t,e){return this.jumpTo({padding:t},e),this},n.prototype.rotateTo=function(e,n,r){return this.easeTo(t.extend({bearing:e},n),r)},n.prototype.resetNorth=function(e,n){return this.rotateTo(0,t.extend({duration:1e3},e),n),this},n.prototype.resetNorthPitch=function(e,n){return this.easeTo(t.extend({bearing:0,pitch:0,duration:1e3},e),n),this},n.prototype.snapToNorth=function(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this},n.prototype.getPitch=function(){return this.transform.pitch},n.prototype.setPitch=function(t,e){return this.jumpTo({pitch:t},e),this},n.prototype.cameraForBounds=function(e,n){e=t.LngLatBounds.convert(e);var r=n&&n.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),r,n)},n.prototype._cameraForBoxAndBearing=function(e,n,r,i){var o={top:0,bottom:0,right:0,left:0};if("number"==typeof(i=t.extend({padding:o,offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding){var a=i.padding;i.padding={top:a,bottom:a,right:a,left:a}}i.padding=t.extend(o,i.padding);var s=this.transform,u=s.padding,l=s.project(t.LngLat.convert(e)),c=s.project(t.LngLat.convert(n)),p=l.rotate(-r*Math.PI/180),h=c.rotate(-r*Math.PI/180),f=new t.Point(Math.max(p.x,h.x),Math.max(p.y,h.y)),d=new t.Point(Math.min(p.x,h.x),Math.min(p.y,h.y)),v=f.sub(d),m=(s.width-(u.left+u.right+i.padding.left+i.padding.right))/v.x,y=(s.height-(u.top+u.bottom+i.padding.top+i.padding.bottom))/v.y;if(!(y<0||m<0)){var g=Math.min(s.scaleZoom(s.scale*Math.min(m,y)),i.maxZoom),_="number"==typeof i.offset.x?new t.Point(i.offset.x,i.offset.y):t.Point.convert(i.offset),x=new t.Point((i.padding.left-i.padding.right)/2,(i.padding.top-i.padding.bottom)/2).rotate(r*Math.PI/180),b=_.add(x).mult(s.scale/s.zoomScale(g));return{center:s.unproject(l.add(c).div(2).sub(b)),zoom:g,bearing:r}}t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},n.prototype.fitBounds=function(t,e,n){return this._fitInternal(this.cameraForBounds(t,e),e,n)},n.prototype.fitScreenCoordinates=function(e,n,r,i,o){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(t.Point.convert(e)),this.transform.pointLocation(t.Point.convert(n)),r,i),i,o)},n.prototype._fitInternal=function(e,n,r){return e?(delete(n=t.extend(e,n)).padding,n.linear?this.easeTo(n,r):this.flyTo(n,r)):this},n.prototype.jumpTo=function(e,n){this.stop();var r=this.transform,i=!1,o=!1,a=!1;return"zoom"in e&&r.zoom!==+e.zoom&&(i=!0,r.zoom=+e.zoom),void 0!==e.center&&(r.center=t.LngLat.convert(e.center)),"bearing"in e&&r.bearing!==+e.bearing&&(o=!0,r.bearing=+e.bearing),"pitch"in e&&r.pitch!==+e.pitch&&(a=!0,r.pitch=+e.pitch),null==e.padding||r.isPaddingEqual(e.padding)||(r.padding=e.padding),this.fire(new t.Event("movestart",n)).fire(new t.Event("move",n)),i&&this.fire(new t.Event("zoomstart",n)).fire(new t.Event("zoom",n)).fire(new t.Event("zoomend",n)),o&&this.fire(new t.Event("rotatestart",n)).fire(new t.Event("rotate",n)).fire(new t.Event("rotateend",n)),a&&this.fire(new t.Event("pitchstart",n)).fire(new t.Event("pitch",n)).fire(new t.Event("pitchend",n)),this.fire(new t.Event("moveend",n))},n.prototype.easeTo=function(e,n){var r=this;this._stop(!1,e.easeId),(!1===(e=t.extend({offset:[0,0],duration:500,easing:t.ease},e)).animate||!e.essential&&t.browser.prefersReducedMotion)&&(e.duration=0);var i=this.transform,o=this.getZoom(),a=this.getBearing(),s=this.getPitch(),u=this.getPadding(),l="zoom"in e?+e.zoom:o,c="bearing"in e?this._normalizeBearing(e.bearing,a):a,p="pitch"in e?+e.pitch:s,h="padding"in e?e.padding:i.padding,f=t.Point.convert(e.offset),d=i.centerPoint.add(f),v=i.pointLocation(d),m=t.LngLat.convert(e.center||v);this._normalizeCenter(m);var y,g,_=i.project(v),x=i.project(m).sub(_),b=i.zoomScale(l-o);e.around&&(y=t.LngLat.convert(e.around),g=i.locationPoint(y));var w={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||l!==o,this._rotating=this._rotating||a!==c,this._pitching=this._pitching||p!==s,this._padding=!i.isPaddingEqual(h),this._easeId=e.easeId,this._prepareEase(n,e.noMoveStart,w),this._ease((function(e){if(r._zooming&&(i.zoom=t.number(o,l,e)),r._rotating&&(i.bearing=t.number(a,c,e)),r._pitching&&(i.pitch=t.number(s,p,e)),r._padding&&(i.interpolatePadding(u,h,e),d=i.centerPoint.add(f)),y)i.setLocationAtPoint(y,g);else{var v=i.zoomScale(i.zoom-o),m=l>o?Math.min(2,b):Math.max(.5,b),w=Math.pow(m,1-e),S=i.unproject(_.add(x.mult(e*w)).mult(v));i.setLocationAtPoint(i.renderWorldCopies?S.wrap():S,d)}r._fireMoveEvents(n)}),(function(t){r._afterEase(n,t)}),e),this},n.prototype._prepareEase=function(e,n,r){void 0===r&&(r={}),this._moving=!0,n||r.moving||this.fire(new t.Event("movestart",e)),this._zooming&&!r.zooming&&this.fire(new t.Event("zoomstart",e)),this._rotating&&!r.rotating&&this.fire(new t.Event("rotatestart",e)),this._pitching&&!r.pitching&&this.fire(new t.Event("pitchstart",e))},n.prototype._fireMoveEvents=function(e){this.fire(new t.Event("move",e)),this._zooming&&this.fire(new t.Event("zoom",e)),this._rotating&&this.fire(new t.Event("rotate",e)),this._pitching&&this.fire(new t.Event("pitch",e))},n.prototype._afterEase=function(e,n){if(!this._easeId||!n||this._easeId!==n){delete this._easeId;var r=this._zooming,i=this._rotating,o=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,r&&this.fire(new t.Event("zoomend",e)),i&&this.fire(new t.Event("rotateend",e)),o&&this.fire(new t.Event("pitchend",e)),this.fire(new t.Event("moveend",e))}},n.prototype.flyTo=function(e,n){var r=this;if(!e.essential&&t.browser.prefersReducedMotion){var i=t.pick(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(i,n)}this.stop(),e=t.extend({offset:[0,0],speed:1.2,curve:1.42,easing:t.ease},e);var o=this.transform,a=this.getZoom(),s=this.getBearing(),u=this.getPitch(),l=this.getPadding(),c="zoom"in e?t.clamp(+e.zoom,o.minZoom,o.maxZoom):a,p="bearing"in e?this._normalizeBearing(e.bearing,s):s,h="pitch"in e?+e.pitch:u,f="padding"in e?e.padding:o.padding,d=o.zoomScale(c-a),v=t.Point.convert(e.offset),m=o.centerPoint.add(v),y=o.pointLocation(m),g=t.LngLat.convert(e.center||y);this._normalizeCenter(g);var _=o.project(y),x=o.project(g).sub(_),b=e.curve,w=Math.max(o.width,o.height),S=w/d,E=x.mag();if("minZoom"in e){var C=t.clamp(Math.min(e.minZoom,a,c),o.minZoom,o.maxZoom),T=w/o.zoomScale(C-a);b=Math.sqrt(T/E*2)}var A=b*b;function M(t){var e=(S*S-w*w+(t?-1:1)*A*A*E*E)/(2*(t?S:w)*A*E);return Math.log(Math.sqrt(e*e+1)-e)}function k(t){return(Math.exp(t)-Math.exp(-t))/2}function P(t){return(Math.exp(t)+Math.exp(-t))/2}var O=M(0),L=function(t){return P(O)/P(O+b*t)},I=function(t){return w*((P(O)*(k(e=O+b*t)/P(e))-k(O))/A)/E;var e},R=(M(1)-O)/b;if(Math.abs(E)<1e-6||!isFinite(R)){if(Math.abs(w-S)<1e-6)return this.easeTo(e,n);var D=S<w?-1:1;R=Math.abs(Math.log(S/w))/b,I=function(){return 0},L=function(t){return Math.exp(D*b*t)}}return e.duration="duration"in e?+e.duration:1e3*R/("screenSpeed"in e?+e.screenSpeed/b:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=s!==p,this._pitching=h!==u,this._padding=!o.isPaddingEqual(f),this._prepareEase(n,!1),this._ease((function(e){var i=e*R,d=1/L(i);o.zoom=1===e?c:a+o.scaleZoom(d),r._rotating&&(o.bearing=t.number(s,p,e)),r._pitching&&(o.pitch=t.number(u,h,e)),r._padding&&(o.interpolatePadding(l,f,e),m=o.centerPoint.add(v));var y=1===e?g:o.unproject(_.add(x.mult(I(i))).mult(d));o.setLocationAtPoint(o.renderWorldCopies?y.wrap():y,m),r._fireMoveEvents(n)}),(function(){return r._afterEase(n)}),e),this},n.prototype.isEasing=function(){return!!this._easeFrameId},n.prototype.stop=function(){return this._stop()},n.prototype._stop=function(t,e){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var n=this._onEaseEnd;delete this._onEaseEnd,n.call(this,e)}if(!t){var r=this.handlers;r&&r.stop(!1)}return this},n.prototype._ease=function(e,n,r){!1===r.animate||0===r.duration?(e(1),n()):(this._easeStart=t.browser.now(),this._easeOptions=r,this._onEaseFrame=e,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},n.prototype._renderFrameCallback=function(){var e=Math.min((t.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},n.prototype._normalizeBearing=function(e,n){e=t.wrap(e,-180,180);var r=Math.abs(e-n);return Math.abs(e-360-n)<r&&(e-=360),Math.abs(e+360-n)<r&&(e+=360),e},n.prototype._normalizeCenter=function(t){var e=this.transform;if(e.renderWorldCopies&&!e.lngRange){var n=t.lng-e.center.lng;t.lng+=n>180?-360:n<-180?360:0}},n}(t.Evented),xi=function(e){void 0===e&&(e={}),this.options=e,t.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};xi.prototype.getDefaultPosition=function(){return"bottom-right"},xi.prototype.onAdd=function(t){var e=this.options&&this.options.compact;return this._map=t,this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=n.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=n.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),e&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},xi.prototype.onRemove=function(){n.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},xi.prototype._setElementTitle=function(t,e){var n=this._map._getUIString("AttributionControl."+e);t.title=n,t.setAttribute("aria-label",n)},xi.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},xi.prototype._updateEditLink=function(){var e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));var n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||t.config.ACCESS_TOKEN}];if(e){var r=n.reduce((function(t,e,r){return e.value&&(t+=e.key+"="+e.value+(r<n.length-1?"&":"")),t}),"?");e.href=t.config.FEEDBACK_URL+"/"+r+(this._map._hash?this._map._hash.getHashString(!0):""),e.rel="noopener nofollow",this._setElementTitle(e,"MapFeedback")}},xi.prototype._updateData=function(t){!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())},xi.prototype._updateAttributions=function(){if(this._map.style){var t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((function(t){return"string"!=typeof t?"":t}))):"string"==typeof this.options.customAttribution&&t.push(this.options.customAttribution)),this._map.style.stylesheet){var e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}var n=this._map.style.sourceCaches;for(var r in n){var i=n[r];if(i.used){var o=i.getSource();o.attribution&&t.indexOf(o.attribution)<0&&t.push(o.attribution)}}t.sort((function(t,e){return t.length-e.length}));var a=(t=t.filter((function(e,n){for(var r=n+1;r<t.length;r++)if(t[r].indexOf(e)>=0)return!1;return!0}))).join(" | ");a!==this._attribHTML&&(this._attribHTML=a,t.length?(this._innerContainer.innerHTML=a,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},xi.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var bi=function(){t.bindAll(["_updateLogo"],this),t.bindAll(["_updateCompact"],this)};bi.prototype.onAdd=function(t){this._map=t,this._container=n.create("div","mapboxgl-ctrl");var e=n.create("a","mapboxgl-ctrl-logo");return e.target="_blank",e.rel="noopener nofollow",e.href="https://www.mapbox.com/",e.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),e.setAttribute("rel","noopener nofollow"),this._container.appendChild(e),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},bi.prototype.onRemove=function(){n.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},bi.prototype.getDefaultPosition=function(){return"bottom-left"},bi.prototype._updateLogo=function(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")},bi.prototype._logoRequired=function(){if(this._map.style){var t=this._map.style.sourceCaches;for(var e in t)if(t[e].getSource().mapbox_logo)return!0;return!1}},bi.prototype._updateCompact=function(){var t=this._container.children;if(t.length){var e=t[0];this._map.getCanvasContainer().offsetWidth<250?e.classList.add("mapboxgl-compact"):e.classList.remove("mapboxgl-compact")}};var wi=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};wi.prototype.add=function(t){var e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e},wi.prototype.remove=function(t){for(var e=this._currentlyRunning,n=0,r=e?this._queue.concat(e):this._queue;n<r.length;n+=1){var i=r[n];if(i.id===t)return void(i.cancelled=!0)}},wi.prototype.run=function(t){void 0===t&&(t=0);var e=this._currentlyRunning=this._queue;this._queue=[];for(var n=0,r=e;n<r.length;n+=1){var i=r[n];if(!i.cancelled&&(i.callback(t),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},wi.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Si={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Ei=t.window.HTMLImageElement,Ci=t.window.HTMLElement,Ti=t.window.ImageBitmap,Ai={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Mi=function(r){function i(e){var n=this;if(null!=(e=t.extend({},Ai,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=e.minPitch&&null!=e.maxPitch&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=e.minPitch&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=e.maxPitch&&e.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var i=new Er(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies);if(r.call(this,i,e),this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=e.collectResourceTiming,this._renderTaskQueue=new wi,this._controls=[],this._mapId=t.uniqueId(),this._locale=t.extend({},Si,e.locale),this._clickTolerance=e.clickTolerance,this._requestManager=new t.RequestManager(e.transformRequest,e.accessToken),"string"==typeof e.container){if(this._container=t.window.document.getElementById(e.container),!this._container)throw new Error("Container '"+e.container+"' not found.")}else{if(!(e.container instanceof Ci))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),t.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",(function(){return n._update(!1)})),this.on("moveend",(function(){return n._update(!1)})),this.on("zoom",(function(){return n._update(!0)})),void 0!==t.window&&(t.window.addEventListener("online",this._onWindowOnline,!1),t.window.addEventListener("resize",this._onWindowResize,!1),t.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new gi(this,e),this._hash=e.hash&&new Tr("string"==typeof e.hash&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,t.extend({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new xi({customAttribution:e.customAttribution})),this.addControl(new bi,e.logoPosition),this.on("style.load",(function(){n.transform.unmodified&&n.jumpTo(n.style.stylesheet)})),this.on("data",(function(e){n._update("style"===e.dataType),n.fire(new t.Event(e.dataType+"data",e))})),this.on("dataloading",(function(e){n.fire(new t.Event(e.dataType+"dataloading",e))}))}r&&(i.__proto__=r),(i.prototype=Object.create(r&&r.prototype)).constructor=i;var o={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return i.prototype._getMapId=function(){return this._mapId},i.prototype.addControl=function(e,n){if(void 0===n&&(n=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var r=e.onAdd(this);this._controls.push(e);var i=this._controlPositions[n];return-1!==n.indexOf("bottom")?i.insertBefore(r,i.firstChild):i.appendChild(r),this},i.prototype.removeControl=function(e){if(!e||!e.onRemove)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var n=this._controls.indexOf(e);return n>-1&&this._controls.splice(n,1),e.onRemove(this),this},i.prototype.hasControl=function(t){return this._controls.indexOf(t)>-1},i.prototype.resize=function(e){var n=this._containerDimensions(),r=n[0],i=n[1];if(r===this.transform.width&&i===this.transform.height)return this;this._resizeCanvas(r,i),this.transform.resize(r,i),this.painter.resize(r,i);var o=!this._moving;return o&&this.fire(new t.Event("movestart",e)).fire(new t.Event("move",e)),this.fire(new t.Event("resize",e)),o&&this.fire(new t.Event("moveend",e)),this},i.prototype.getBounds=function(){return this.transform.getBounds()},i.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},i.prototype.setMaxBounds=function(e){return this.transform.setMaxBounds(t.LngLatBounds.convert(e)),this._update()},i.prototype.setMinZoom=function(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},i.prototype.getMinZoom=function(){return this.transform.minZoom},i.prototype.setMaxZoom=function(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")},i.prototype.getMaxZoom=function(){return this.transform.maxZoom},i.prototype.setMinPitch=function(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t&&this.setPitch(t),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},i.prototype.getMinPitch=function(){return this.transform.minPitch},i.prototype.setMaxPitch=function(t){if((t=null==t?60:t)>60)throw new Error("maxPitch must be less than or equal to 60");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")},i.prototype.getMaxPitch=function(){return this.transform.maxPitch},i.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},i.prototype.setRenderWorldCopies=function(t){return this.transform.renderWorldCopies=t,this._update()},i.prototype.project=function(e){return this.transform.locationPoint(t.LngLat.convert(e))},i.prototype.unproject=function(e){return this.transform.pointLocation(t.Point.convert(e))},i.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},i.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},i.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},i.prototype._createDelegatedListener=function(t,e,n){var r,i=this;if("mouseenter"===t||"mouseover"===t){var o=!1;return{layer:e,listener:n,delegates:{mousemove:function(r){var a=i.getLayer(e)?i.queryRenderedFeatures(r.point,{layers:[e]}):[];a.length?o||(o=!0,n.call(i,new Dr(t,i,r.originalEvent,{features:a}))):o=!1},mouseout:function(){o=!1}}}}if("mouseleave"===t||"mouseout"===t){var a=!1;return{layer:e,listener:n,delegates:{mousemove:function(r){(i.getLayer(e)?i.queryRenderedFeatures(r.point,{layers:[e]}):[]).length?a=!0:a&&(a=!1,n.call(i,new Dr(t,i,r.originalEvent)))},mouseout:function(e){a&&(a=!1,n.call(i,new Dr(t,i,e.originalEvent)))}}}}return{layer:e,listener:n,delegates:(r={},r[t]=function(t){var r=i.getLayer(e)?i.queryRenderedFeatures(t.point,{layers:[e]}):[];r.length&&(t.features=r,n.call(i,t),delete t.features)},r)}},i.prototype.on=function(t,e,n){if(void 0===n)return r.prototype.on.call(this,t,e);var i=this._createDelegatedListener(t,e,n);for(var o in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(i),i.delegates)this.on(o,i.delegates[o]);return this},i.prototype.once=function(t,e,n){if(void 0===n)return r.prototype.once.call(this,t,e);var i=this._createDelegatedListener(t,e,n);for(var o in i.delegates)this.once(o,i.delegates[o]);return this},i.prototype.off=function(t,e,n){var i=this;return void 0===n?r.prototype.off.call(this,t,e):(this._delegatedListeners&&this._delegatedListeners[t]&&function(r){for(var o=r[t],a=0;a<o.length;a++){var s=o[a];if(s.layer===e&&s.listener===n){for(var u in s.delegates)i.off(u,s.delegates[u]);return o.splice(a,1),i}}}(this._delegatedListeners),this)},i.prototype.queryRenderedFeatures=function(e,n){if(!this.style)return[];var r;if(void 0!==n||void 0===e||e instanceof t.Point||Array.isArray(e)||(n=e,e=void 0),n=n||{},(e=e||[[0,0],[this.transform.width,this.transform.height]])instanceof t.Point||"number"==typeof e[0])r=[t.Point.convert(e)];else{var i=t.Point.convert(e[0]),o=t.Point.convert(e[1]);r=[i,new t.Point(o.x,i.y),o,new t.Point(i.x,o.y),i]}return this.style.queryRenderedFeatures(r,n,this.transform)},i.prototype.querySourceFeatures=function(t,e){return this.style.querySourceFeatures(t,e)},i.prototype.setStyle=function(e,n){return!1!==(n=t.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&e?(this._diffStyle(e,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._updateStyle(e,n))},i.prototype._getUIString=function(t){var e=this._locale[t];if(null==e)throw new Error("Missing UI string '"+t+"'");return e},i.prototype._updateStyle=function(t,e){return this.style&&(this.style.setEventedParent(null),this.style._remove()),t?(this.style=new Ge(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t):this.style.loadJSON(t),this):(delete this.style,this)},i.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Ge(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},i.prototype._diffStyle=function(e,n){var r=this;if("string"==typeof e){var i=this._requestManager.normalizeStyleURL(e),o=this._requestManager.transformRequest(i,t.ResourceType.Style);t.getJSON(o,(function(e,i){e?r.fire(new t.ErrorEvent(e)):i&&r._updateDiff(i,n)}))}else"object"==typeof e&&this._updateDiff(e,n)},i.prototype._updateDiff=function(e,n){try{this.style.setState(e)&&this._update(!0)}catch(r){t.warnOnce("Unable to perform style diff: "+(r.message||r.error||r)+".  Rebuilding the style from scratch."),this._updateStyle(e,n)}},i.prototype.getStyle=function(){if(this.style)return this.style.serialize()},i.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():t.warnOnce("There is no style added to the map.")},i.prototype.addSource=function(t,e){return this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)},i.prototype.isSourceLoaded=function(e){var n=this.style&&this.style.sourceCaches[e];if(void 0!==n)return n.loaded();this.fire(new t.ErrorEvent(new Error("There is no source with ID '"+e+"'")))},i.prototype.areTilesLoaded=function(){var t=this.style&&this.style.sourceCaches;for(var e in t){var n=t[e]._tiles;for(var r in n){var i=n[r];if("loaded"!==i.state&&"errored"!==i.state)return!1}}return!0},i.prototype.addSourceType=function(t,e,n){return this._lazyInitEmptyStyle(),this.style.addSourceType(t,e,n)},i.prototype.removeSource=function(t){return this.style.removeSource(t),this._update(!0)},i.prototype.getSource=function(t){return this.style.getSource(t)},i.prototype.addImage=function(e,n,r){void 0===r&&(r={});var i=r.pixelRatio;void 0===i&&(i=1);var o=r.sdf;void 0===o&&(o=!1);var a=r.stretchX,s=r.stretchY,u=r.content;if(this._lazyInitEmptyStyle(),n instanceof Ei||Ti&&n instanceof Ti){var l=t.browser.getImageData(n);this.style.addImage(e,{data:new t.RGBAImage({width:l.width,height:l.height},l.data),pixelRatio:i,stretchX:a,stretchY:s,content:u,sdf:o,version:0})}else{if(void 0===n.width||void 0===n.height)return this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var c=n;this.style.addImage(e,{data:new t.RGBAImage({width:n.width,height:n.height},new Uint8Array(n.data)),pixelRatio:i,stretchX:a,stretchY:s,content:u,sdf:o,version:0,userImage:c}),c.onAdd&&c.onAdd(this,e)}},i.prototype.updateImage=function(e,n){var r=this.style.getImage(e);if(!r)return this.fire(new t.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var i=n instanceof Ei||Ti&&n instanceof Ti?t.browser.getImageData(n):n,o=i.width,a=i.height,s=i.data;return void 0===o||void 0===a?this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):o!==r.data.width||a!==r.data.height?this.fire(new t.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(r.data.replace(s,!(n instanceof Ei||Ti&&n instanceof Ti)),void this.style.updateImage(e,r))},i.prototype.hasImage=function(e){return e?!!this.style.getImage(e):(this.fire(new t.ErrorEvent(new Error("Missing required image id"))),!1)},i.prototype.removeImage=function(t){this.style.removeImage(t)},i.prototype.loadImage=function(e,n){t.getImage(this._requestManager.transformRequest(e,t.ResourceType.Image),n)},i.prototype.listImages=function(){return this.style.listImages()},i.prototype.addLayer=function(t,e){return this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)},i.prototype.moveLayer=function(t,e){return this.style.moveLayer(t,e),this._update(!0)},i.prototype.removeLayer=function(t){return this.style.removeLayer(t),this._update(!0)},i.prototype.getLayer=function(t){return this.style.getLayer(t)},i.prototype.setLayerZoomRange=function(t,e,n){return this.style.setLayerZoomRange(t,e,n),this._update(!0)},i.prototype.setFilter=function(t,e,n){return void 0===n&&(n={}),this.style.setFilter(t,e,n),this._update(!0)},i.prototype.getFilter=function(t){return this.style.getFilter(t)},i.prototype.setPaintProperty=function(t,e,n,r){return void 0===r&&(r={}),this.style.setPaintProperty(t,e,n,r),this._update(!0)},i.prototype.getPaintProperty=function(t,e){return this.style.getPaintProperty(t,e)},i.prototype.setLayoutProperty=function(t,e,n,r){return void 0===r&&(r={}),this.style.setLayoutProperty(t,e,n,r),this._update(!0)},i.prototype.getLayoutProperty=function(t,e){return this.style.getLayoutProperty(t,e)},i.prototype.setLight=function(t,e){return void 0===e&&(e={}),this._lazyInitEmptyStyle(),this.style.setLight(t,e),this._update(!0)},i.prototype.getLight=function(){return this.style.getLight()},i.prototype.setFeatureState=function(t,e){return this.style.setFeatureState(t,e),this._update()},i.prototype.removeFeatureState=function(t,e){return this.style.removeFeatureState(t,e),this._update()},i.prototype.getFeatureState=function(t){return this.style.getFeatureState(t)},i.prototype.getContainer=function(){return this._container},i.prototype.getCanvasContainer=function(){return this._canvasContainer},i.prototype.getCanvas=function(){return this._canvas},i.prototype._containerDimensions=function(){var t=0,e=0;return this._container&&(t=this._container.clientWidth||400,e=this._container.clientHeight||300),[t,e]},i.prototype._detectMissingCSS=function(){"rgb(250, 128, 114)"!==t.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&t.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},i.prototype._setupContainer=function(){var t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSCanary=n.create("div","mapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();var e=this._canvasContainer=n.create("div","mapboxgl-canvas-container",t);this._interactive&&e.classList.add("mapboxgl-interactive"),this._canvas=n.create("canvas","mapboxgl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var r=this._containerDimensions();this._resizeCanvas(r[0],r[1]);var i=this._controlContainer=n.create("div","mapboxgl-control-container",t),o=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((function(t){o[t]=n.create("div","mapboxgl-ctrl-"+t,i)})),this._container.addEventListener("scroll",this._onMapScroll,!1)},i.prototype._resizeCanvas=function(e,n){var r=t.browser.devicePixelRatio||1;this._canvas.width=r*e,this._canvas.height=r*n,this._canvas.style.width=e+"px",this._canvas.style.height=n+"px"},i.prototype._setupPainter=function(){var n=t.extend({},e.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl",n)||this._canvas.getContext("experimental-webgl",n);r?(this.painter=new xr(r,this.transform),t.webpSupported.testSupport(r)):this.fire(new t.ErrorEvent(new Error("Failed to initialize WebGL")))},i.prototype._contextLost=function(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.Event("webglcontextlost",{originalEvent:e}))},i.prototype._contextRestored=function(e){this._setupPainter(),this.resize(),this._update(),this.fire(new t.Event("webglcontextrestored",{originalEvent:e}))},i.prototype._onMapScroll=function(t){if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},i.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},i.prototype._update=function(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this},i.prototype._requestRenderFrame=function(t){return this._update(),this._renderTaskQueue.add(t)},i.prototype._cancelRenderFrame=function(t){this._renderTaskQueue.remove(t)},i.prototype._render=function(e){var n,r=this,i=0,o=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(n=o.createQueryEXT(),o.beginQueryEXT(o.TIME_ELAPSED_EXT,n),i=t.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(e),!this._removed){var a=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var s=this.transform.zoom,u=t.browser.now();this.style.zoomHistory.update(s,u);var l=new t.EvaluationParameters(s,{now:u,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),c=l.crossFadingFactor();1===c&&c===this._crossFadingFactor||(a=!0,this._crossFadingFactor=c),this.style.update(l)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new t.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new t.Event("load"))),this.style&&(this.style.hasTransitions()||a)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var p=t.browser.now()-i;o.endQueryEXT(o.TIME_ELAPSED_EXT,n),setTimeout((function(){var e=o.getQueryObjectEXT(n,o.QUERY_RESULT_EXT)/1e6;o.deleteQueryEXT(n),r.fire(new t.Event("gpu-timing-frame",{cpuTime:p,gpuTime:e}))}),50)}if(this.listens("gpu-timing-layer")){var h=this.painter.collectGpuTimers();setTimeout((function(){var e=r.painter.queryGpuTimers(h);r.fire(new t.Event("gpu-timing-layer",{layerTimes:e}))}),50)}var f=this._sourcesDirty||this._styleDirty||this._placementDirty;return f||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new t.Event("idle")),!this._loaded||this._fullyLoaded||f||(this._fullyLoaded=!0),this}},i.prototype.remove=function(){this._hash&&this._hash.remove();for(var e=0,n=this._controls;e<n.length;e+=1)n[e].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==t.window&&(t.window.removeEventListener("resize",this._onWindowResize,!1),t.window.removeEventListener("orientationchange",this._onWindowResize,!1),t.window.removeEventListener("online",this._onWindowOnline,!1));var r=this.painter.context.gl.getExtension("WEBGL_lose_context");r&&r.loseContext(),ki(this._canvasContainer),ki(this._controlContainer),ki(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new t.Event("remove"))},i.prototype.triggerRepaint=function(){var e=this;this.style&&!this._frame&&(this._frame=t.browser.frame((function(t){e._frame=null,e._render(t)})))},i.prototype._onWindowOnline=function(){this._update()},i.prototype._onWindowResize=function(t){this._trackResize&&this.resize({originalEvent:t})._update()},o.showTileBoundaries.get=function(){return!!this._showTileBoundaries},o.showTileBoundaries.set=function(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())},o.showPadding.get=function(){return!!this._showPadding},o.showPadding.set=function(t){this._showPadding!==t&&(this._showPadding=t,this._update())},o.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},o.showCollisionBoxes.set=function(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())},o.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},o.showOverdrawInspector.set=function(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())},o.repaint.get=function(){return!!this._repaint},o.repaint.set=function(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())},o.vertices.get=function(){return!!this._vertices},o.vertices.set=function(t){this._vertices=t,this._update()},i.prototype._setCacheLimits=function(e,n){t.setCacheLimits(e,n)},o.version.get=function(){return t.version},Object.defineProperties(i.prototype,o),i}(_i);function ki(t){t.parentNode&&t.parentNode.removeChild(t)}var Pi={showCompass:!0,showZoom:!0,visualizePitch:!1},Oi=function(e){var r=this;this.options=t.extend({},Pi,e),this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(function(t){return t.preventDefault()})),this.options.showZoom&&(t.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(function(t){return r._map.zoomIn({},{originalEvent:t})})),n.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(function(t){return r._map.zoomOut({},{originalEvent:t})})),n.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(t.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(function(t){r.options.visualizePitch?r._map.resetNorthPitch({},{originalEvent:t}):r._map.resetNorth({},{originalEvent:t})})),this._compassIcon=n.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Oi.prototype._updateZoomButtons=function(){var t=this._map.getZoom(),e=t===this._map.getMaxZoom(),n=t===this._map.getMinZoom();this._zoomInButton.disabled=e,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",e.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())},Oi.prototype._rotateCompassArrow=function(){var t=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=t},Oi.prototype.onAdd=function(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Li(this._map,this._compass,this.options.visualizePitch)),this._container},Oi.prototype.onRemove=function(){n.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Oi.prototype._createButton=function(t,e){var r=n.create("button",t,this._container);return r.type="button",r.addEventListener("click",e),r},Oi.prototype._setButtonTitle=function(t,e){var n=this._map._getUIString("NavigationControl."+e);t.title=n,t.setAttribute("aria-label",n)};var Li=function(e,r,i){void 0===i&&(i=!1),this._clickTolerance=10,this.element=r,this.mouseRotate=new Xr({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,i&&(this.mousePitch=new Yr({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),t.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),n.addEventListener(r,"mousedown",this.mousedown),n.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),n.addEventListener(r,"touchmove",this.touchmove),n.addEventListener(r,"touchend",this.touchend),n.addEventListener(r,"touchcancel",this.reset)};function Ii(e,n,r){if(e=new t.LngLat(e.lng,e.lat),n){var i=new t.LngLat(e.lng-360,e.lat),o=new t.LngLat(e.lng+360,e.lat),a=r.locationPoint(e).distSqr(n);r.locationPoint(i).distSqr(n)<a?e=i:r.locationPoint(o).distSqr(n)<a&&(e=o)}for(;Math.abs(e.lng-r.center.lng)>180;){var s=r.locationPoint(e);if(s.x>=0&&s.y>=0&&s.x<=r.width&&s.y<=r.height)break;e.lng>r.center.lng?e.lng-=360:e.lng+=360}return e}Li.prototype.down=function(t,e){this.mouseRotate.mousedown(t,e),this.mousePitch&&this.mousePitch.mousedown(t,e),n.disableDrag()},Li.prototype.move=function(t,e){var n=this.map,r=this.mouseRotate.mousemoveWindow(t,e);if(r&&r.bearingDelta&&n.setBearing(n.getBearing()+r.bearingDelta),this.mousePitch){var i=this.mousePitch.mousemoveWindow(t,e);i&&i.pitchDelta&&n.setPitch(n.getPitch()+i.pitchDelta)}},Li.prototype.off=function(){var t=this.element;n.removeEventListener(t,"mousedown",this.mousedown),n.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),n.removeEventListener(t,"touchmove",this.touchmove),n.removeEventListener(t,"touchend",this.touchend),n.removeEventListener(t,"touchcancel",this.reset),this.offTemp()},Li.prototype.offTemp=function(){n.enableDrag(),n.removeEventListener(t.window,"mousemove",this.mousemove),n.removeEventListener(t.window,"mouseup",this.mouseup)},Li.prototype.mousedown=function(e){this.down(t.extend({},e,{ctrlKey:!0,preventDefault:function(){return e.preventDefault()}}),n.mousePos(this.element,e)),n.addEventListener(t.window,"mousemove",this.mousemove),n.addEventListener(t.window,"mouseup",this.mouseup)},Li.prototype.mousemove=function(t){this.move(t,n.mousePos(this.element,t))},Li.prototype.mouseup=function(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()},Li.prototype.touchstart=function(t){1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=n.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return t.preventDefault()}},this._startPos))},Li.prototype.touchmove=function(t){1!==t.targetTouches.length?this.reset():(this._lastPos=n.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:function(){return t.preventDefault()}},this._lastPos))},Li.prototype.touchend=function(t){0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Li.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Ri={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Di(t,e,n){var r=t.classList;for(var i in Ri)r.remove("mapboxgl-"+n+"-anchor-"+i);r.add("mapboxgl-"+n+"-anchor-"+e)}var Ni,Zi=function(e){function r(r,i){if(e.call(this),(r instanceof t.window.HTMLElement||i)&&(r=t.extend({element:r},i)),t.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&"auto"!==r.pitchAlignment?r.pitchAlignment:this._rotationAlignment,r&&r.element)this._element=r.element,this._offset=t.Point.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=n.create("div"),this._element.setAttribute("aria-label","Map marker");var o=n.createNS("http://www.w3.org/2000/svg","svg");o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height","41px"),o.setAttributeNS(null,"width","27px"),o.setAttributeNS(null,"viewBox","0 0 27 41");var a=n.createNS("http://www.w3.org/2000/svg","g");a.setAttributeNS(null,"stroke","none"),a.setAttributeNS(null,"stroke-width","1"),a.setAttributeNS(null,"fill","none"),a.setAttributeNS(null,"fill-rule","evenodd");var s=n.createNS("http://www.w3.org/2000/svg","g");s.setAttributeNS(null,"fill-rule","nonzero");var u=n.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"transform","translate(3.0, 29.0)"),u.setAttributeNS(null,"fill","#000000");for(var l=0,c=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];l<c.length;l+=1){var p=c[l],h=n.createNS("http://www.w3.org/2000/svg","ellipse");h.setAttributeNS(null,"opacity","0.04"),h.setAttributeNS(null,"cx","10.5"),h.setAttributeNS(null,"cy","5.80029008"),h.setAttributeNS(null,"rx",p.rx),h.setAttributeNS(null,"ry",p.ry),u.appendChild(h)}var f=n.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"fill",this._color);var d=n.createNS("http://www.w3.org/2000/svg","path");d.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),f.appendChild(d);var v=n.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"opacity","0.25"),v.setAttributeNS(null,"fill","#000000");var m=n.createNS("http://www.w3.org/2000/svg","path");m.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),v.appendChild(m);var y=n.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"transform","translate(6.0, 7.0)"),y.setAttributeNS(null,"fill","#FFFFFF");var g=n.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"transform","translate(8.0, 8.0)");var _=n.createNS("http://www.w3.org/2000/svg","circle");_.setAttributeNS(null,"fill","#000000"),_.setAttributeNS(null,"opacity","0.25"),_.setAttributeNS(null,"cx","5.5"),_.setAttributeNS(null,"cy","5.5"),_.setAttributeNS(null,"r","5.4999962");var x=n.createNS("http://www.w3.org/2000/svg","circle");x.setAttributeNS(null,"fill","#FFFFFF"),x.setAttributeNS(null,"cx","5.5"),x.setAttributeNS(null,"cy","5.5"),x.setAttributeNS(null,"r","5.4999962"),g.appendChild(_),g.appendChild(x),s.appendChild(u),s.appendChild(f),s.appendChild(v),s.appendChild(y),s.appendChild(g),o.appendChild(s),o.setAttributeNS(null,"height",41*this._scale+"px"),o.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(o),this._offset=t.Point.convert(r&&r.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(function(t){t.preventDefault()})),this._element.addEventListener("mousedown",(function(t){t.preventDefault()})),Di(this._element,this._anchor,"marker"),this._popup=null}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.addTo=function(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},r.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),n.remove(this._element),this._popup&&this._popup.remove(),this},r.prototype.getLngLat=function(){return this._lngLat},r.prototype.setLngLat=function(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},r.prototype.getElement=function(){return this._element},r.prototype.setPopup=function(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){var e=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[e,-1*(24.6+e)],"bottom-right":[-e,-1*(24.6+e)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},r.prototype._onKeyPress=function(t){var e=t.code,n=t.charCode||t.keyCode;"Space"!==e&&"Enter"!==e&&32!==n&&13!==n||this.togglePopup()},r.prototype._onMapClick=function(t){var e=t.originalEvent.target,n=this._element;this._popup&&(e===n||n.contains(e))&&this.togglePopup()},r.prototype.getPopup=function(){return this._popup},r.prototype.togglePopup=function(){var t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this},r.prototype._update=function(t){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Ii(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var e="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?e="rotateZ("+this._rotation+"deg)":"map"===this._rotationAlignment&&(e="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var r="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?r="rotateX(0deg)":"map"===this._pitchAlignment&&(r="rotateX("+this._map.getPitch()+"deg)"),t&&"moveend"!==t.type||(this._pos=this._pos.round()),n.setTransform(this._element,Ri[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+r+" "+e)}},r.prototype.getOffset=function(){return this._offset},r.prototype.setOffset=function(e){return this._offset=t.Point.convert(e),this._update(),this},r.prototype._onMove=function(e){if(!this._isDragging){var n=this._clickTolerance||this._map._clickTolerance;this._isDragging=e.point.dist(this._pointerdownPos)>=n}this._isDragging&&(this._pos=e.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new t.Event("dragstart"))),this.fire(new t.Event("drag")))},r.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new t.Event("dragend")),this._state="inactive"},r.prototype._addDragHandler=function(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},r.prototype.setDraggable=function(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},r.prototype.isDraggable=function(){return this._draggable},r.prototype.setRotation=function(t){return this._rotation=t||0,this._update(),this},r.prototype.getRotation=function(){return this._rotation},r.prototype.setRotationAlignment=function(t){return this._rotationAlignment=t||"auto",this._update(),this},r.prototype.getRotationAlignment=function(){return this._rotationAlignment},r.prototype.setPitchAlignment=function(t){return this._pitchAlignment=t&&"auto"!==t?t:this._rotationAlignment,this._update(),this},r.prototype.getPitchAlignment=function(){return this._pitchAlignment},r}(t.Evented),zi={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Fi=0,Bi=!1,ji=function(e){function r(n){e.call(this),this.options=t.extend({},zi,n),t.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.onAdd=function(e){var r;return this._map=e,this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),r=this._setupUI,void 0!==Ni?r(Ni):void 0!==t.window.navigator.permissions?t.window.navigator.permissions.query({name:"geolocation"}).then((function(t){r(Ni="denied"!==t.state)})):r(Ni=!!t.window.navigator.geolocation),this._container},r.prototype.onRemove=function(){void 0!==this._geolocationWatchID&&(t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),n.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Fi=0,Bi=!1},r.prototype._isOutOfMapMaxBounds=function(t){var e=this._map.getMaxBounds(),n=t.coords;return e&&(n.longitude<e.getWest()||n.longitude>e.getEast()||n.latitude<e.getSouth()||n.latitude>e.getNorth())},r.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},r.prototype._onSuccess=function(e){if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new t.Event("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("geolocate",e)),this._finish()}},r.prototype._updateCamera=function(e){var n=new t.LngLat(e.coords.longitude,e.coords.latitude),r=e.coords.accuracy,i=this._map.getBearing(),o=t.extend({bearing:i},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(r),o,{geolocateSource:!0})},r.prototype._updateMarker=function(e){if(e){var n=new t.LngLat(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},r.prototype._updateCircleRadius=function(){var t=this._map._container.clientHeight/2,e=this._map.unproject([0,t]),n=this._map.unproject([1,t]),r=e.distanceTo(n),i=Math.ceil(2*this._accuracy/r);this._circleElement.style.width=i+"px",this._circleElement.style.height=i+"px"},r.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},r.prototype._onError=function(e){if(this._map){if(this.options.trackUserLocation)if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&Bi)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("error",e)),this._finish()}},r.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},r.prototype._setupUI=function(e){var r=this;if(this._container.addEventListener("contextmenu",(function(t){return t.preventDefault()})),this._geolocateButton=n.create("button","mapboxgl-ctrl-geolocate",this._container),n.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===e){t.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}else{var o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=n.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Zi(this._dotElement),this._circleElement=n.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Zi({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(function(e){e.geolocateSource||"ACTIVE_LOCK"!==r._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(r._watchState="BACKGROUND",r._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),r._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),r.fire(new t.Event("trackuserlocationend")))}))},r.prototype.trigger=function(){if(!this._setup)return t.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Fi--,Bi=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){var e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Fi>1?(e={maximumAge:6e5,timeout:0},Bi=!0):(e=this.options.positionOptions,Bi=!1),this._geolocationWatchID=t.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,e)}}else t.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},r.prototype._clearWatch=function(){t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},r}(t.Evented),Ui={maxWidth:100,unit:"metric"},Vi=function(e){this.options=t.extend({},Ui,e),t.bindAll(["_onMove","setUnit"],this)};function Gi(t,e,n){var r=n&&n.maxWidth||100,i=t._container.clientHeight/2,o=t.unproject([0,i]),a=t.unproject([r,i]),s=o.distanceTo(a);if(n&&"imperial"===n.unit){var u=3.2808*s;u>5280?Hi(e,r,u/5280,t._getUIString("ScaleControl.Miles")):Hi(e,r,u,t._getUIString("ScaleControl.Feet"))}else n&&"nautical"===n.unit?Hi(e,r,s/1852,t._getUIString("ScaleControl.NauticalMiles")):s>=1e3?Hi(e,r,s/1e3,t._getUIString("ScaleControl.Kilometers")):Hi(e,r,s,t._getUIString("ScaleControl.Meters"))}function Hi(t,e,n,r){var i,o,a,s=(i=n,(o=Math.pow(10,(""+Math.floor(i)).length-1))*(a=(a=i/o)>=10?10:a>=5?5:a>=3?3:a>=2?2:a>=1?1:function(t){var e=Math.pow(10,Math.ceil(-Math.log(t)/Math.LN10));return Math.round(t*e)/e}(a)));t.style.width=e*(s/n)+"px",t.innerHTML=s+"&nbsp;"+r}Vi.prototype.getDefaultPosition=function(){return"bottom-left"},Vi.prototype._onMove=function(){Gi(this._map,this._container,this.options)},Vi.prototype.onAdd=function(t){return this._map=t,this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Vi.prototype.onRemove=function(){n.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Vi.prototype.setUnit=function(t){this.options.unit=t,Gi(this._map,this._container,this.options)};var Wi=function(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof t.window.HTMLElement?this._container=e.container:t.warnOnce("Full screen control 'container' must be a DOM element.")),t.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in t.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in t.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in t.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in t.window.document&&(this._fullscreenchange="MSFullscreenChange")};Wi.prototype.onAdd=function(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Wi.prototype.onRemove=function(){n.remove(this._controlContainer),this._map=null,t.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Wi.prototype._checkFullscreenSupport=function(){return!!(t.window.document.fullscreenEnabled||t.window.document.mozFullScreenEnabled||t.window.document.msFullscreenEnabled||t.window.document.webkitFullscreenEnabled)},Wi.prototype._setupUI=function(){var e=this._fullscreenButton=n.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);n.create("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden",!0),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),t.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Wi.prototype._updateTitle=function(){var t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.title=t},Wi.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Wi.prototype._isFullscreen=function(){return this._fullscreen},Wi.prototype._changeIcon=function(){(t.window.document.fullscreenElement||t.window.document.mozFullScreenElement||t.window.document.webkitFullscreenElement||t.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Wi.prototype._onClickFullscreen=function(){this._isFullscreen()?t.window.document.exitFullscreen?t.window.document.exitFullscreen():t.window.document.mozCancelFullScreen?t.window.document.mozCancelFullScreen():t.window.document.msExitFullscreen?t.window.document.msExitFullscreen():t.window.document.webkitCancelFullScreen&&t.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var qi={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Xi=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Yi=function(e){function r(n){e.call(this),this.options=t.extend(Object.create(qi),n),t.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.addTo=function(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new t.Event("open")),this},r.prototype.isOpen=function(){return!!this._map},r.prototype.remove=function(){return this._content&&n.remove(this._content),this._container&&(n.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new t.Event("close")),this},r.prototype.getLngLat=function(){return this._lngLat},r.prototype.setLngLat=function(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},r.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},r.prototype.getElement=function(){return this._container},r.prototype.setText=function(e){return this.setDOMContent(t.window.document.createTextNode(e))},r.prototype.setHTML=function(e){var n,r=t.window.document.createDocumentFragment(),i=t.window.document.createElement("body");for(i.innerHTML=e;n=i.firstChild;)r.appendChild(n);return this.setDOMContent(r)},r.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},r.prototype.setMaxWidth=function(t){return this.options.maxWidth=t,this._update(),this},r.prototype.setDOMContent=function(t){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=n.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(t),this._createCloseButton(),this._update(),this._focusFirstElement(),this},r.prototype.addClassName=function(t){this._container&&this._container.classList.add(t)},r.prototype.removeClassName=function(t){this._container&&this._container.classList.remove(t)},r.prototype.setOffset=function(t){return this.options.offset=t,this._update(),this},r.prototype.toggleClassName=function(t){if(this._container)return this._container.classList.toggle(t)},r.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=n.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},r.prototype._onMouseUp=function(t){this._update(t.point)},r.prototype._onMouseMove=function(t){this._update(t.point)},r.prototype._onDrag=function(t){this._update(t.point)},r.prototype._update=function(e){var r=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=n.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=n.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach((function(t){return r._container.classList.add(t)})),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ii(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||e)){var i=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat),o=this.options.anchor,a=function e(n){if(n){if("number"==typeof n){var r=Math.round(Math.sqrt(.5*Math.pow(n,2)));return{center:new t.Point(0,0),top:new t.Point(0,n),"top-left":new t.Point(r,r),"top-right":new t.Point(-r,r),bottom:new t.Point(0,-n),"bottom-left":new t.Point(r,-r),"bottom-right":new t.Point(-r,-r),left:new t.Point(n,0),right:new t.Point(-n,0)}}if(n instanceof t.Point||Array.isArray(n)){var i=t.Point.convert(n);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:t.Point.convert(n.center||[0,0]),top:t.Point.convert(n.top||[0,0]),"top-left":t.Point.convert(n["top-left"]||[0,0]),"top-right":t.Point.convert(n["top-right"]||[0,0]),bottom:t.Point.convert(n.bottom||[0,0]),"bottom-left":t.Point.convert(n["bottom-left"]||[0,0]),"bottom-right":t.Point.convert(n["bottom-right"]||[0,0]),left:t.Point.convert(n.left||[0,0]),right:t.Point.convert(n.right||[0,0])}}return e(new t.Point(0,0))}(this.options.offset);if(!o){var s,u=this._container.offsetWidth,l=this._container.offsetHeight;s=i.y+a.bottom.y<l?["top"]:i.y>this._map.transform.height-l?["bottom"]:[],i.x<u/2?s.push("left"):i.x>this._map.transform.width-u/2&&s.push("right"),o=0===s.length?"bottom":s.join("-")}var c=i.add(a[o]).round();n.setTransform(this._container,Ri[o]+" translate("+c.x+"px,"+c.y+"px)"),Di(this._container,o,"popup")}},r.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var t=this._container.querySelector(Xi);t&&t.focus()}},r.prototype._onClose=function(){this.remove()},r}(t.Evented),Ki={version:t.version,supported:e,setRTLTextPlugin:t.setRTLTextPlugin,getRTLTextPluginStatus:t.getRTLTextPluginStatus,Map:Mi,NavigationControl:Oi,GeolocateControl:ji,AttributionControl:xi,ScaleControl:Vi,FullscreenControl:Wi,Popup:Yi,Marker:Zi,Style:Ge,LngLat:t.LngLat,LngLatBounds:t.LngLatBounds,Point:t.Point,MercatorCoordinate:t.MercatorCoordinate,Evented:t.Evented,config:t.config,prewarm:function(){Ft().acquire(Dt)},clearPrewarmedResources:function(){var t=Zt;t&&(t.isPreloaded()&&1===t.numActive()?(t.release(Dt),Zt=null):r.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return t.config.ACCESS_TOKEN},set accessToken(e){t.config.ACCESS_TOKEN=e},get baseApiUrl(){return t.config.API_URL},set baseApiUrl(e){t.config.API_URL=e},get workerCount(){return Nt.workerCount},set workerCount(t){Nt.workerCount=t},get maxParallelImageRequests(){return t.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){t.config.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage:function(e){t.clearTileCache(e)},workerUrl:""};return Ki})),n}()},28660:function(t,e,n){var r,i=n(34155);!function(t){!function(e){var r="object"==typeof n.g?n.g:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),o=a(t);function a(t,e){return function(n,r){"function"!=typeof t[n]&&Object.defineProperty(t,n,{configurable:!0,writable:!0,value:r}),e&&e(n,r)}}void 0===r.Reflect?r.Reflect=t:o=a(r.Reflect,o),function(t){var e=Object.prototype.hasOwnProperty,n="function"==typeof Symbol,r=n&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",o=n&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",a="function"==typeof Object.create,s={__proto__:[]}instanceof Array,u=!a&&!s,l={create:a?function(){return it(Object.create(null))}:s?function(){return it({__proto__:null})}:function(){return it({})},has:u?function(t,n){return e.call(t,n)}:function(t,e){return e in t},get:u?function(t,n){return e.call(t,n)?t[n]:void 0}:function(t,e){return t[e]}},c=Object.getPrototypeOf(Function),p="object"==typeof i&&"true"==="MISSING_ENV_VAR".REFLECT_METADATA_USE_MAP_POLYFILL,h=p||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?et():Map,f=p||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?nt():Set,d=new(p||"function"!=typeof WeakMap?rt():WeakMap);function v(t,e,n,r){if(N(n)){if(!H(t))throw new TypeError;if(!q(e))throw new TypeError;return C(t,e)}if(!H(t))throw new TypeError;if(!F(e))throw new TypeError;if(!F(r)&&!N(r)&&!Z(r))throw new TypeError;return Z(r)&&(r=void 0),T(t,e,n=G(n),r)}function m(t,e){function n(n,r){if(!F(n))throw new TypeError;if(!N(r)&&!X(r))throw new TypeError;L(t,e,n,r)}return n}function y(t,e,n,r){if(!F(n))throw new TypeError;return N(r)||(r=G(r)),L(t,e,n,r)}function g(t,e,n){if(!F(e))throw new TypeError;return N(n)||(n=G(n)),M(t,e,n)}function _(t,e,n){if(!F(e))throw new TypeError;return N(n)||(n=G(n)),k(t,e,n)}function x(t,e,n){if(!F(e))throw new TypeError;return N(n)||(n=G(n)),P(t,e,n)}function b(t,e,n){if(!F(e))throw new TypeError;return N(n)||(n=G(n)),O(t,e,n)}function w(t,e){if(!F(t))throw new TypeError;return N(e)||(e=G(e)),I(t,e)}function S(t,e){if(!F(t))throw new TypeError;return N(e)||(e=G(e)),R(t,e)}function E(t,e,n){if(!F(e))throw new TypeError;N(n)||(n=G(n));var r=A(e,n,!1);if(N(r))return!1;if(!r.delete(t))return!1;if(r.size>0)return!0;var i=d.get(e);return i.delete(n),i.size>0||d.delete(e),!0}function C(t,e){for(var n=t.length-1;n>=0;--n){var r=(0,t[n])(e);if(!N(r)&&!Z(r)){if(!q(r))throw new TypeError;e=r}}return e}function T(t,e,n,r){for(var i=t.length-1;i>=0;--i){var o=(0,t[i])(e,n,r);if(!N(o)&&!Z(o)){if(!F(o))throw new TypeError;r=o}}return r}function A(t,e,n){var r=d.get(t);if(N(r)){if(!n)return;r=new h,d.set(t,r)}var i=r.get(e);if(N(i)){if(!n)return;i=new h,r.set(e,i)}return i}function M(t,e,n){if(k(t,e,n))return!0;var r=tt(e);return!Z(r)&&M(t,r,n)}function k(t,e,n){var r=A(e,n,!1);return!N(r)&&U(r.has(t))}function P(t,e,n){if(k(t,e,n))return O(t,e,n);var r=tt(e);return Z(r)?void 0:P(t,r,n)}function O(t,e,n){var r=A(e,n,!1);if(!N(r))return r.get(t)}function L(t,e,n,r){A(n,r,!0).set(t,e)}function I(t,e){var n=R(t,e),r=tt(t);if(null===r)return n;var i=I(r,e);if(i.length<=0)return n;if(n.length<=0)return i;for(var o=new f,a=[],s=0,u=n;s<u.length;s++){var l=u[s];o.has(l)||(o.add(l),a.push(l))}for(var c=0,p=i;c<p.length;c++){l=p[c];o.has(l)||(o.add(l),a.push(l))}return a}function R(t,e){var n=[],r=A(t,e,!1);if(N(r))return n;for(var i=K(r.keys()),o=0;;){var a=J(i);if(!a)return n.length=o,n;var s=Q(a);try{n[o]=s}catch(t){try{$(i)}finally{throw t}}o++}}function D(t){if(null===t)return 1;switch(typeof t){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===t?1:6;default:return 6}}function N(t){return void 0===t}function Z(t){return null===t}function z(t){return"symbol"==typeof t}function F(t){return"object"==typeof t?null!==t:"function"==typeof t}function B(t,e){switch(D(t)){case 0:case 1:case 2:case 3:case 4:case 5:return t}var n=3===e?"string":5===e?"number":"default",i=Y(t,r);if(void 0!==i){var o=i.call(t,n);if(F(o))throw new TypeError;return o}return j(t,"default"===n?"number":n)}function j(t,e){if("string"===e){var n=t.toString;if(W(n))if(!F(i=n.call(t)))return i;if(W(r=t.valueOf))if(!F(i=r.call(t)))return i}else{var r;if(W(r=t.valueOf))if(!F(i=r.call(t)))return i;var i,o=t.toString;if(W(o))if(!F(i=o.call(t)))return i}throw new TypeError}function U(t){return!!t}function V(t){return""+t}function G(t){var e=B(t,3);return z(e)?e:V(e)}function H(t){return Array.isArray?Array.isArray(t):t instanceof Object?t instanceof Array:"[object Array]"===Object.prototype.toString.call(t)}function W(t){return"function"==typeof t}function q(t){return"function"==typeof t}function X(t){switch(D(t)){case 3:case 4:return!0;default:return!1}}function Y(t,e){var n=t[e];if(null!=n){if(!W(n))throw new TypeError;return n}}function K(t){var e=Y(t,o);if(!W(e))throw new TypeError;var n=e.call(t);if(!F(n))throw new TypeError;return n}function Q(t){return t.value}function J(t){var e=t.next();return!e.done&&e}function $(t){var e=t.return;e&&e.call(t)}function tt(t){var e=Object.getPrototypeOf(t);if("function"!=typeof t||t===c)return e;if(e!==c)return e;var n=t.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return e;var i=r.constructor;return"function"!=typeof i||i===t?e:i}function et(){var t={},e=[],n=function(){function t(t,e,n){this._index=0,this._keys=t,this._values=e,this._selector=n}return t.prototype["@@iterator"]=function(){return this},t.prototype[o]=function(){return this},t.prototype.next=function(){var t=this._index;if(t>=0&&t<this._keys.length){var n=this._selector(this._keys[t],this._values[t]);return t+1>=this._keys.length?(this._index=-1,this._keys=e,this._values=e):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},t.prototype.throw=function(t){throw this._index>=0&&(this._index=-1,this._keys=e,this._values=e),t},t.prototype.return=function(t){return this._index>=0&&(this._index=-1,this._keys=e,this._values=e),{value:t,done:!0}},t}();return function(){function e(){this._keys=[],this._values=[],this._cacheKey=t,this._cacheIndex=-2}return Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),e.prototype.has=function(t){return this._find(t,!1)>=0},e.prototype.get=function(t){var e=this._find(t,!1);return e>=0?this._values[e]:void 0},e.prototype.set=function(t,e){var n=this._find(t,!0);return this._values[n]=e,this},e.prototype.delete=function(e){var n=this._find(e,!1);if(n>=0){for(var r=this._keys.length,i=n+1;i<r;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,e===this._cacheKey&&(this._cacheKey=t,this._cacheIndex=-2),!0}return!1},e.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=t,this._cacheIndex=-2},e.prototype.keys=function(){return new n(this._keys,this._values,r)},e.prototype.values=function(){return new n(this._keys,this._values,i)},e.prototype.entries=function(){return new n(this._keys,this._values,a)},e.prototype["@@iterator"]=function(){return this.entries()},e.prototype[o]=function(){return this.entries()},e.prototype._find=function(t,e){return this._cacheKey!==t&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=t)),this._cacheIndex<0&&e&&(this._cacheIndex=this._keys.length,this._keys.push(t),this._values.push(void 0)),this._cacheIndex},e}();function r(t,e){return t}function i(t,e){return e}function a(t,e){return[t,e]}}function nt(){return function(){function t(){this._map=new h}return Object.defineProperty(t.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),t.prototype.has=function(t){return this._map.has(t)},t.prototype.add=function(t){return this._map.set(t,t),this},t.prototype.delete=function(t){return this._map.delete(t)},t.prototype.clear=function(){this._map.clear()},t.prototype.keys=function(){return this._map.keys()},t.prototype.values=function(){return this._map.values()},t.prototype.entries=function(){return this._map.entries()},t.prototype["@@iterator"]=function(){return this.keys()},t.prototype[o]=function(){return this.keys()},t}()}function rt(){var t=16,n=l.create(),r=i();return function(){function t(){this._key=i()}return t.prototype.has=function(t){var e=o(t,!1);return void 0!==e&&l.has(e,this._key)},t.prototype.get=function(t){var e=o(t,!1);return void 0!==e?l.get(e,this._key):void 0},t.prototype.set=function(t,e){return o(t,!0)[this._key]=e,this},t.prototype.delete=function(t){var e=o(t,!1);return void 0!==e&&delete e[this._key]},t.prototype.clear=function(){this._key=i()},t}();function i(){var t;do{t="@@WeakMap@@"+u()}while(l.has(n,t));return n[t]=!0,t}function o(t,n){if(!e.call(t,r)){if(!n)return;Object.defineProperty(t,r,{value:l.create()})}return t[r]}function a(t,e){for(var n=0;n<e;++n)t[n]=255*Math.random()|0;return t}function s(t){return"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(t)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(t)):a(new Uint8Array(t),t):a(new Array(t),t)}function u(){var e=s(t);e[6]=79&e[6]|64,e[8]=191&e[8]|128;for(var n="",r=0;r<t;++r){var i=e[r];4!==r&&6!==r&&8!==r||(n+="-"),i<16&&(n+="0"),n+=i.toString(16).toLowerCase()}return n}}function it(t){return t.__=void 0,delete t.__,t}t("decorate",v),t("metadata",m),t("defineMetadata",y),t("hasMetadata",g),t("hasOwnMetadata",_),t("getMetadata",x),t("getOwnMetadata",b),t("getMetadataKeys",w),t("getOwnMetadataKeys",S),t("deleteMetadata",E)}(o)}()}(r||(r={}))},69848:function(t,e,n){var r=n(25108);t.exports=function(){"use strict";function t(n,r,i,o,a,s){if(!(a-o<=i)){var u=o+a>>1;e(n,r,u,o,a,s%2),t(n,r,i,o,u-1,s+1),t(n,r,i,u+1,a,s+1)}}function e(t,r,i,o,a,s){for(;a>o;){if(a-o>600){var u=a-o+1,l=i-o+1,c=Math.log(u),p=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*p*(u-p)/u)*(l-u/2<0?-1:1);e(t,r,i,Math.max(o,Math.floor(i-l*p/u+h)),Math.min(a,Math.floor(i+(u-l)*p/u+h)),s)}var f=r[2*i+s],d=o,v=a;for(n(t,r,o,i),r[2*a+s]>f&&n(t,r,o,a);d<v;){for(n(t,r,d,v),d++,v--;r[2*d+s]<f;)d++;for(;r[2*v+s]>f;)v--}r[2*o+s]===f?n(t,r,o,v):n(t,r,++v,a),v<=i&&(o=v+1),i<=v&&(a=v-1)}}function n(t,e,n,r){i(t,n,r),i(e,2*n,2*r),i(e,2*n+1,2*r+1)}function i(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function o(t,e,n,r,i,o,a){for(var s,u,l=[0,t.length-1,0],c=[];l.length;){var p=l.pop(),h=l.pop(),f=l.pop();if(h-f<=a)for(var d=f;d<=h;d++)s=e[2*d],u=e[2*d+1],s>=n&&s<=i&&u>=r&&u<=o&&c.push(t[d]);else{var v=Math.floor((f+h)/2);s=e[2*v],u=e[2*v+1],s>=n&&s<=i&&u>=r&&u<=o&&c.push(t[v]);var m=(p+1)%2;(0===p?n<=s:r<=u)&&(l.push(f),l.push(v-1),l.push(m)),(0===p?i>=s:o>=u)&&(l.push(v+1),l.push(h),l.push(m))}}return c}function a(t,e,n,r,i,o){for(var a=[0,t.length-1,0],u=[],l=i*i;a.length;){var c=a.pop(),p=a.pop(),h=a.pop();if(p-h<=o)for(var f=h;f<=p;f++)s(e[2*f],e[2*f+1],n,r)<=l&&u.push(t[f]);else{var d=Math.floor((h+p)/2),v=e[2*d],m=e[2*d+1];s(v,m,n,r)<=l&&u.push(t[d]);var y=(c+1)%2;(0===c?n-i<=v:r-i<=m)&&(a.push(h),a.push(d-1),a.push(y)),(0===c?n+i>=v:r+i>=m)&&(a.push(d+1),a.push(p),a.push(y))}}return u}function s(t,e,n,r){var i=t-n,o=e-r;return i*i+o*o}var u=function(t){return t[0]},l=function(t){return t[1]},c=function(e,n,r,i,o){void 0===n&&(n=u),void 0===r&&(r=l),void 0===i&&(i=64),void 0===o&&(o=Float64Array),this.nodeSize=i,this.points=e;for(var a=e.length<65536?Uint16Array:Uint32Array,s=this.ids=new a(e.length),c=this.coords=new o(2*e.length),p=0;p<e.length;p++)s[p]=p,c[2*p]=n(e[p]),c[2*p+1]=r(e[p]);t(s,c,i,0,s.length-1,0)};c.prototype.range=function(t,e,n,r){return o(this.ids,this.coords,t,e,n,r,this.nodeSize)},c.prototype.within=function(t,e,n){return a(this.ids,this.coords,t,e,n,this.nodeSize)};var p,h={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(t){return t}},f=Math.fround||(p=new Float32Array(1),function(t){return p[0]=+t,p[0]}),d=function(t){this.options=S(Object.create(h),t),this.trees=new Array(this.options.maxZoom+1)};function v(t,e,n,r,i){return{x:f(t),y:f(e),zoom:1/0,id:n,parentId:-1,numPoints:r,properties:i}}function m(t,e){var n=t.geometry.coordinates,r=n[0],i=n[1];return{x:f(_(r)),y:f(x(i)),zoom:1/0,index:e,parentId:-1}}function y(t){return{type:"Feature",id:t.id,properties:g(t),geometry:{type:"Point",coordinates:[b(t.x),w(t.y)]}}}function g(t){var e=t.numPoints,n=e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e;return S(S({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:n})}function _(t){return t/360+.5}function x(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function b(t){return 360*(t-.5)}function w(t){var e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function S(t,e){for(var n in e)t[n]=e[n];return t}function E(t){return t.x}function C(t){return t.y}return d.prototype.load=function(t){var e=this.options,n=e.log,i=e.minZoom,o=e.maxZoom,a=e.nodeSize;n&&r.time("total time");var s="prepare "+t.length+" points";n&&r.time(s),this.points=t;for(var u=[],l=0;l<t.length;l++)t[l].geometry&&u.push(m(t[l],l));this.trees[o+1]=new c(u,E,C,a,Float32Array),n&&r.timeEnd(s);for(var p=o;p>=i;p--){var h=+Date.now();u=this._cluster(u,p),this.trees[p]=new c(u,E,C,a,Float32Array),n&&r.log("z%d: %d clusters in %dms",p,u.length,+Date.now()-h)}return n&&r.timeEnd("total time"),this},d.prototype.getClusters=function(t,e){var n=((t[0]+180)%360+360)%360-180,r=Math.max(-90,Math.min(90,t[1])),i=180===t[2]?180:((t[2]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)n=-180,i=180;else if(n>i){var a=this.getClusters([n,r,180,o],e),s=this.getClusters([-180,r,i,o],e);return a.concat(s)}for(var u=this.trees[this._limitZoom(e)],l=[],c=0,p=u.range(_(n),x(o),_(i),x(r));c<p.length;c+=1){var h=p[c],f=u.points[h];l.push(f.numPoints?y(f):this.points[f.index])}return l},d.prototype.getChildren=function(t){var e=this._getOriginId(t),n=this._getOriginZoom(t),r="No cluster with the specified id.",i=this.trees[n];if(!i)throw new Error(r);var o=i.points[e];if(!o)throw new Error(r);for(var a=this.options.radius/(this.options.extent*Math.pow(2,n-1)),s=[],u=0,l=i.within(o.x,o.y,a);u<l.length;u+=1){var c=l[u],p=i.points[c];p.parentId===t&&s.push(p.numPoints?y(p):this.points[p.index])}if(0===s.length)throw new Error(r);return s},d.prototype.getLeaves=function(t,e,n){e=e||10,n=n||0;var r=[];return this._appendLeaves(r,t,e,n,0),r},d.prototype.getTile=function(t,e,n){var r=this.trees[this._limitZoom(t)],i=Math.pow(2,t),o=this.options,a=o.extent,s=o.radius/a,u=(n-s)/i,l=(n+1+s)/i,c={features:[]};return this._addTileFeatures(r.range((e-s)/i,u,(e+1+s)/i,l),r.points,e,n,i,c),0===e&&this._addTileFeatures(r.range(1-s/i,u,1,l),r.points,i,n,i,c),e===i-1&&this._addTileFeatures(r.range(0,u,s/i,l),r.points,-1,n,i,c),c.features.length?c:null},d.prototype.getClusterExpansionZoom=function(t){for(var e=this._getOriginZoom(t)-1;e<=this.options.maxZoom;){var n=this.getChildren(t);if(e++,1!==n.length)break;t=n[0].properties.cluster_id}return e},d.prototype._appendLeaves=function(t,e,n,r,i){for(var o=0,a=this.getChildren(e);o<a.length;o+=1){var s=a[o],u=s.properties;if(u&&u.cluster?i+u.point_count<=r?i+=u.point_count:i=this._appendLeaves(t,u.cluster_id,n,r,i):i<r?i++:t.push(s),t.length===n)break}return i},d.prototype._addTileFeatures=function(t,e,n,r,i,o){for(var a=0,s=t;a<s.length;a+=1){var u=e[s[a]],l=u.numPoints,c=void 0,p=void 0,h=void 0;if(l)c=g(u),p=u.x,h=u.y;else{var f=this.points[u.index];c=f.properties,p=_(f.geometry.coordinates[0]),h=x(f.geometry.coordinates[1])}var d={type:1,geometry:[[Math.round(this.options.extent*(p*i-n)),Math.round(this.options.extent*(h*i-r))]],tags:c},v=void 0;l?v=u.id:this.options.generateId?v=u.index:this.points[u.index].id&&(v=this.points[u.index].id),void 0!==v&&(d.id=v),o.features.push(d)}},d.prototype._limitZoom=function(t){return Math.max(this.options.minZoom,Math.min(Math.floor(+t),this.options.maxZoom+1))},d.prototype._cluster=function(t,e){for(var n=[],r=this.options,i=r.radius,o=r.extent,a=r.reduce,s=r.minPoints,u=i/(o*Math.pow(2,e)),l=0;l<t.length;l++){var c=t[l];if(!(c.zoom<=e)){c.zoom=e;for(var p=this.trees[e+1],h=p.within(c.x,c.y,u),f=c.numPoints||1,d=f,m=0,y=h;m<y.length;m+=1){var g=y[m],_=p.points[g];_.zoom>e&&(d+=_.numPoints||1)}if(d>f&&d>=s){for(var x=c.x*f,b=c.y*f,w=a&&f>1?this._map(c,!0):null,S=(l<<5)+(e+1)+this.points.length,E=0,C=h;E<C.length;E+=1){var T=C[E],A=p.points[T];if(!(A.zoom<=e)){A.zoom=e;var M=A.numPoints||1;x+=A.x*M,b+=A.y*M,A.parentId=S,a&&(w||(w=this._map(c,!0)),a(w,this._map(A)))}}c.parentId=S,n.push(v(x/d,b/d,S,d,w))}else if(n.push(c),d>1)for(var k=0,P=h;k<P.length;k+=1){var O=P[k],L=p.points[O];L.zoom<=e||(L.zoom=e,n.push(L))}}}return n},d.prototype._getOriginId=function(t){return t-this.points.length>>5},d.prototype._getOriginZoom=function(t){return(t-this.points.length)%32},d.prototype._map=function(t,e){if(t.numPoints)return e?S({},t.properties):t.properties;var n=this.points[t.index].properties,r=this.options.map(n);return e&&r===n?S({},r):r},d}()},18146:function(t,e,n){"use strict";function r(t){return t}function i(t){if(null==t)return r;var e,n,i=t.scale[0],o=t.scale[1],a=t.translate[0],s=t.translate[1];return function(t,r){r||(e=n=0);var u=2,l=t.length,c=new Array(l);for(c[0]=(e+=t[0])*i+a,c[1]=(n+=t[1])*o+s;u<l;)c[u]=t[u],++u;return c}}function o(t){var e,n=i(t.transform),r=1/0,o=r,a=-r,s=-r;function u(t){(t=n(t))[0]<r&&(r=t[0]),t[0]>a&&(a=t[0]),t[1]<o&&(o=t[1]),t[1]>s&&(s=t[1])}function l(t){switch(t.type){case"GeometryCollection":t.geometries.forEach(l);break;case"Point":u(t.coordinates);break;case"MultiPoint":t.coordinates.forEach(u)}}for(e in t.arcs.forEach((function(t){for(var e,i=-1,u=t.length;++i<u;)(e=n(t[i],i))[0]<r&&(r=e[0]),e[0]>a&&(a=e[0]),e[1]<o&&(o=e[1]),e[1]>s&&(s=e[1])})),t.objects)l(t.objects[e]);return[r,o,a,s]}function a(t,e){return"string"==typeof e&&(e=t.objects[e]),"GeometryCollection"===e.type?{type:"FeatureCollection",features:e.geometries.map((function(e){return s(t,e)}))}:s(t,e)}function s(t,e){var n=e.id,r=e.bbox,i=null==e.properties?{}:e.properties,o=u(t,e);return null==n&&null==r?{type:"Feature",properties:i,geometry:o}:null==r?{type:"Feature",id:n,properties:i,geometry:o}:{type:"Feature",id:n,bbox:r,properties:i,geometry:o}}function u(t,e){var n=i(t.transform),r=t.arcs;function o(t,e){e.length&&e.pop();for(var i=r[t<0?~t:t],o=0,a=i.length;o<a;++o)e.push(n(i[o],o));t<0&&function(t,e){for(var n,r=t.length,i=r-e;i<--r;)n=t[i],t[i++]=t[r],t[r]=n}(e,a)}function a(t){return n(t)}function s(t){for(var e=[],n=0,r=t.length;n<r;++n)o(t[n],e);return e.length<2&&e.push(e[0]),e}function u(t){for(var e=s(t);e.length<4;)e.push(e[0]);return e}function l(t){return t.map(u)}return function t(e){var n,r=e.type;switch(r){case"GeometryCollection":return{type:r,geometries:e.geometries.map(t)};case"Point":n=a(e.coordinates);break;case"MultiPoint":n=e.coordinates.map(a);break;case"LineString":n=s(e.arcs);break;case"MultiLineString":n=e.arcs.map(s);break;case"Polygon":n=l(e.arcs);break;case"MultiPolygon":n=e.arcs.map(l);break;default:return null}return{type:r,coordinates:n}}(e)}function l(t,e){var n={},r={},i={},o=[],a=-1;function s(t,e){for(var r in t){var i=t[r];delete e[i.start],delete i.start,delete i.end,i.forEach((function(t){n[t<0?~t:t]=1})),o.push(i)}}return e.forEach((function(n,r){var i,o=t.arcs[n<0?~n:n];o.length<3&&!o[1][0]&&!o[1][1]&&(i=e[++a],e[a]=n,e[r]=i)})),e.forEach((function(e){var n,o,a=function(e){var n,r=t.arcs[e<0?~e:e],i=r[0];t.transform?(n=[0,0],r.forEach((function(t){n[0]+=t[0],n[1]+=t[1]}))):n=r[r.length-1];return e<0?[n,i]:[i,n]}(e),s=a[0],u=a[1];if(n=i[s])if(delete i[n.end],n.push(e),n.end=u,o=r[u]){delete r[o.start];var l=o===n?n:n.concat(o);r[l.start=n.start]=i[l.end=o.end]=l}else r[n.start]=i[n.end]=n;else if(n=r[u])if(delete r[n.start],n.unshift(e),n.start=s,o=i[s]){delete i[o.end];var c=o===n?n:o.concat(n);r[c.start=o.start]=i[c.end=n.end]=c}else r[n.start]=i[n.end]=n;else r[(n=[e]).start=s]=i[n.end=u]=n})),s(i,r),s(r,i),e.forEach((function(t){n[t<0?~t:t]||o.push([t])})),o}function c(t){return u(t,p.apply(this,arguments))}function p(t,e,n){var r,i,o;if(arguments.length>1)r=h(t,e,n);else for(i=0,r=new Array(o=t.arcs.length);i<o;++i)r[i]=i;return{type:"MultiLineString",arcs:l(t,r)}}function h(t,e,n){var r,i=[],o=[];function a(t){var e=t<0?~t:t;(o[e]||(o[e]=[])).push({i:t,g:r})}function s(t){t.forEach(a)}function u(t){t.forEach(s)}return function t(e){switch(r=e,e.type){case"GeometryCollection":e.geometries.forEach(t);break;case"LineString":s(e.arcs);break;case"MultiLineString":case"Polygon":u(e.arcs);break;case"MultiPolygon":!function(t){t.forEach(u)}(e.arcs)}}(e),o.forEach(null==n?function(t){i.push(t[0].i)}:function(t){n(t[0].g,t[t.length-1].g)&&i.push(t[0].i)}),i}function f(t){return u(t,d.apply(this,arguments))}function d(t,e){var n={},r=[],i=[];function o(t){t.forEach((function(e){e.forEach((function(e){(n[e=e<0?~e:e]||(n[e]=[])).push(t)}))})),r.push(t)}function a(e){return function(t){for(var e,n=-1,r=t.length,i=t[r-1],o=0;++n<r;)e=i,i=t[n],o+=e[0]*i[1]-e[1]*i[0];return Math.abs(o)}(u(t,{type:"Polygon",arcs:[e]}).coordinates[0])}return e.forEach((function t(e){switch(e.type){case"GeometryCollection":e.geometries.forEach(t);break;case"Polygon":o(e.arcs);break;case"MultiPolygon":e.arcs.forEach(o)}})),r.forEach((function(t){if(!t._){var e=[],r=[t];for(t._=1,i.push(e);t=r.pop();)e.push(t),t.forEach((function(t){t.forEach((function(t){n[t<0?~t:t].forEach((function(t){t._||(t._=1,r.push(t))}))}))}))}})),r.forEach((function(t){delete t._})),{type:"MultiPolygon",arcs:i.map((function(e){var r,i=[];if(e.forEach((function(t){t.forEach((function(t){t.forEach((function(t){n[t<0?~t:t].length<2&&i.push(t)}))}))})),(r=(i=l(t,i)).length)>1)for(var o,s,u=1,c=a(i[0]);u<r;++u)(o=a(i[u]))>c&&(s=i[0],i[0]=i[u],i[u]=s,c=o);return i})).filter((function(t){return t.length>0}))}}function v(t,e){for(var n=0,r=t.length;n<r;){var i=n+r>>>1;t[i]<e?n=i+1:r=i}return n}function m(t){var e={},n=t.map((function(){return[]}));function r(t,n){t.forEach((function(t){t<0&&(t=~t);var r=e[t];r?r.push(n):e[t]=[n]}))}function i(t,e){t.forEach((function(t){r(t,e)}))}var o={LineString:r,MultiLineString:i,Polygon:i,MultiPolygon:function(t,e){t.forEach((function(t){i(t,e)}))}};for(var a in t.forEach((function t(e,n){"GeometryCollection"===e.type?e.geometries.forEach((function(e){t(e,n)})):e.type in o&&o[e.type](e.arcs,n)})),e)for(var s=e[a],u=s.length,l=0;l<u;++l)for(var c=l+1;c<u;++c){var p,h=s[l],f=s[c];(p=n[h])[a=v(p,f)]!==f&&p.splice(a,0,f),(p=n[f])[a=v(p,h)]!==h&&p.splice(a,0,h)}return n}function y(t){if(null==t)return r;var e,n,i=t.scale[0],o=t.scale[1],a=t.translate[0],s=t.translate[1];return function(t,r){r||(e=n=0);var u=2,l=t.length,c=new Array(l),p=Math.round((t[0]-a)/i),h=Math.round((t[1]-s)/o);for(c[0]=p-e,e=p,c[1]=h-n,n=h;u<l;)c[u]=t[u],++u;return c}}function g(t,e){if(t.transform)throw new Error("already quantized");if(e&&e.scale)u=t.bbox;else{if(!((n=Math.floor(e))>=2))throw new Error("n must be ≥2");var n,r=(u=t.bbox||o(t))[0],i=u[1],a=u[2],s=u[3];e={scale:[a-r?(a-r)/(n-1):1,s-i?(s-i)/(n-1):1],translate:[r,i]}}var u,l,c=y(e),p=t.objects,h={};function f(t){return c(t)}function d(t){var e;switch(t.type){case"GeometryCollection":e={type:"GeometryCollection",geometries:t.geometries.map(d)};break;case"Point":e={type:"Point",coordinates:f(t.coordinates)};break;case"MultiPoint":e={type:"MultiPoint",coordinates:t.coordinates.map(f)};break;default:return t}return null!=t.id&&(e.id=t.id),null!=t.bbox&&(e.bbox=t.bbox),null!=t.properties&&(e.properties=t.properties),e}for(l in p)h[l]=d(p[l]);return{type:"Topology",bbox:u,transform:e,objects:h,arcs:t.arcs.map((function(t){var e,n=0,r=1,i=t.length,o=new Array(i);for(o[0]=c(t[0],0);++n<i;)((e=c(t[n],n))[0]||e[1])&&(o[r++]=e);return 1===r&&(o[r++]=[0,0]),o.length=r,o}))}}n.r(e),n.d(e,{bbox:function(){return o},feature:function(){return a},merge:function(){return f},mergeArcs:function(){return d},mesh:function(){return c},meshArcs:function(){return p},neighbors:function(){return m},quantize:function(){return g},transform:function(){return i},untransform:function(){return y}})},70655:function(t,e,n){"use strict";n.r(e),n.d(e,{__assign:function(){return o},__asyncDelegator:function(){return x},__asyncGenerator:function(){return _},__asyncValues:function(){return b},__await:function(){return g},__awaiter:function(){return c},__classPrivateFieldGet:function(){return C},__classPrivateFieldSet:function(){return T},__createBinding:function(){return h},__decorate:function(){return s},__exportStar:function(){return f},__extends:function(){return i},__generator:function(){return p},__importDefault:function(){return E},__importStar:function(){return S},__makeTemplateObject:function(){return w},__metadata:function(){return l},__param:function(){return u},__read:function(){return v},__rest:function(){return a},__spread:function(){return m},__spreadArrays:function(){return y},__values:function(){return d}});var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},r(t,e)};function i(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var o=function(){return o=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},o.apply(this,arguments)};function a(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n}function s(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}function u(t,e){return function(n,r){e(n,r,t)}}function l(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function c(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))}function p(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function h(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}function f(t,e){for(var n in t)"default"===n||e.hasOwnProperty(n)||(e[n]=t[n])}function d(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function v(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function m(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(v(arguments[e]));return t}function y(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}function g(t){return this instanceof g?(this.v=t,this):new g(t)}function _(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(t,e||[]),o=[];return r={},a("next"),a("throw"),a("return"),r[Symbol.asyncIterator]=function(){return this},r;function a(t){i[t]&&(r[t]=function(e){return new Promise((function(n,r){o.push([t,e,n,r])>1||s(t,e)}))})}function s(t,e){try{(n=i[t](e)).value instanceof g?Promise.resolve(n.value.v).then(u,l):c(o[0][2],n)}catch(t){c(o[0][3],t)}var n}function u(t){s("next",t)}function l(t){s("throw",t)}function c(t,e){t(e),o.shift(),o.length&&s(o[0][0],o[0][1])}}function x(t){var e,n;return e={},r("next"),r("throw",(function(t){throw t})),r("return"),e[Symbol.iterator]=function(){return this},e;function r(r,i){e[r]=t[r]?function(e){return(n=!n)?{value:g(t[r](e)),done:"return"===r}:i?i(e):e}:i}}function b(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t=d(t),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(n){e[n]=t[n]&&function(e){return new Promise((function(r,i){(function(t,e,n,r){Promise.resolve(r).then((function(e){t({value:e,done:n})}),e)})(r,i,(e=t[n](e)).done,e.value)}))}}}function w(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function S(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function E(t){return t&&t.__esModule?t:{default:t}}function C(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function T(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,n),n}},75752:function(t){t.exports.RADIUS=6378137,t.exports.FLATTENING=1/298.257223563,t.exports.POLAR_RADIUS=6356752.3142},53229:function(t,e,n){"use strict";function r(t,e,n,r,i){var o={};return Object.keys(r).forEach((function(t){o[t]=r[t]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce((function(n,r){return r(t,e,n)||n}),o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(t,e,o),o=null),o}n.d(e,{Z:function(){return r}})},5647:function(t,e,n){"use strict";n.d(e,{Z:function(){return o}});var r=n(89611),i=n(78814);function o(t,e,n){return o=(0,i.Z)()?Reflect.construct.bind():function(t,e,n){var i=[null];i.push.apply(i,e);var o=new(Function.bind.apply(t,i));return n&&(0,r.Z)(o,n.prototype),o},o.apply(null,arguments)}},11752:function(t,e,n){"use strict";n.d(e,{Z:function(){return o}});var r=n(61120);function i(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=(0,r.Z)(t)););return t}function o(){return o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=i(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},o.apply(this,arguments)}},43269:function(t,e,n){"use strict";function r(t,e,n,r){n&&Object.defineProperty(t,e,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}n.d(e,{Z:function(){return r}})},1449:function(t,e,n){"use strict";n.d(e,{DL:function(){return s},Ht:function(){return u},yu:function(){return a},zL:function(){return o}});var r=6371008.8,i={centimeters:637100880,centimetres:637100880,degrees:57.22891354143274,feet:20902260.511392,inches:39.37*r,kilometers:6371.0088,kilometres:6371.0088,meters:r,metres:r,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:r/1852,radians:1,yards:6967335.223679999};function o(t,e,n){void 0===n&&(n={});var r={type:"Feature"};return(0===n.id||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}function a(t,e,n){void 0===n&&(n={});for(var r=0,i=t;r<i.length;r++){var a=i[r];if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<a[a.length-1].length;s++)if(a[a.length-1][s]!==a[0][s])throw new Error("First and last Position are not equivalent.")}return o({type:"Polygon",coordinates:t},e,n)}function s(t,e){void 0===e&&(e="kilometers");var n=i[e];if(!n)throw new Error(e+" units is invalid");return t*n}function u(t){return t%360*Math.PI/180}},54503:function(t,e,n){"use strict";n.r(e),n.d(e,{add:function(){return C},after:function(){return F},ary:function(){return xe},assign:function(){return hn},assignIn:function(){return gn},assignInWith:function(){return xn},assignWith:function(){return wn},at:function(){return xr},attempt:function(){return Pr},before:function(){return Or},bind:function(){return Ir},bindAll:function(){return Rr},bindKey:function(){return Nr},camelCase:function(){return Bi},capitalize:function(){return ri},castArray:function(){return ji},ceil:function(){return Hi},chain:function(){return Wi},chunk:function(){return Yi},clamp:function(){return Qi},clone:function(){return ca},cloneDeep:function(){return pa},cloneDeepWith:function(){return ha},cloneWith:function(){return fa},commit:function(){return da},compact:function(){return va},concat:function(){return ma},cond:function(){return Ka},conforms:function(){return $a},conformsTo:function(){return ts},constant:function(){return Vt},countBy:function(){return ps},create:function(){return hs},curry:function(){return ds},curryRight:function(){return ms},debounce:function(){return xs},deburr:function(){return li},default:function(){return am},defaultTo:function(){return bs},defaults:function(){return Cs},defaultsDeep:function(){return Ds},defer:function(){return zs},delay:function(){return Bs},difference:function(){return Gs},differenceBy:function(){return qs},differenceWith:function(){return Ys},divide:function(){return Ks},drop:function(){return Qs},dropRight:function(){return Js},dropRightWhile:function(){return tu},dropWhile:function(){return eu},each:function(){return ru},eachRight:function(){return uu},endsWith:function(){return lu},entries:function(){return fu},entriesIn:function(){return du},eq:function(){return we},escape:function(){return gu},escapeRegExp:function(){return bu},every:function(){return Eu},extend:function(){return gn},extendWith:function(){return xn},fill:function(){return Au},filter:function(){return ku},find:function(){return Iu},findIndex:function(){return Lu},findKey:function(){return Du},findLast:function(){return Fu},findLastIndex:function(){return zu},findLastKey:function(){return Bu},first:function(){return ju},flatMap:function(){return Gu},flatMapDeep:function(){return Hu},flatMapDepth:function(){return Wu},flatten:function(){return gr},flattenDeep:function(){return qu},flattenDepth:function(){return Xu},flip:function(){return Yu},floor:function(){return Ku},flow:function(){return Ju},flowRight:function(){return $u},forEach:function(){return ru},forEachRight:function(){return uu},forIn:function(){return tl},forInRight:function(){return el},forOwn:function(){return nl},forOwnRight:function(){return rl},fromPairs:function(){return il},functions:function(){return al},functionsIn:function(){return sl},get:function(){return hr},groupBy:function(){return cl},gt:function(){return fl},gte:function(){return dl},has:function(){return yl},hasIn:function(){return Ga},head:function(){return ju},identity:function(){return B},inRange:function(){return bl},includes:function(){return Tl},indexOf:function(){return Ml},initial:function(){return kl},intersection:function(){return Il},intersectionBy:function(){return Dl},intersectionWith:function(){return Nl},invert:function(){return jl},invertBy:function(){return Wl},invoke:function(){return Yl},invokeMap:function(){return Ql},isArguments:function(){return je},isArray:function(){return x},isArrayBuffer:function(){return tc},isArrayLike:function(){return Pe},isArrayLikeObject:function(){return As},isBoolean:function(){return ec},isBuffer:function(){return We},isDate:function(){return ic},isElement:function(){return oc},isEmpty:function(){return sc},isEqual:function(){return uc},isEqualWith:function(){return lc},isError:function(){return Mr},isFinite:function(){return pc},isFunction:function(){return U},isInteger:function(){return hc},isLength:function(){return ke},isMap:function(){return ea},isMatch:function(){return fc},isMatchWith:function(){return dc},isNaN:function(){return mc},isNative:function(){return gc},isNil:function(){return _c},isNull:function(){return xc},isNumber:function(){return vc},isObject:function(){return P},isObjectLike:function(){return m},isPlainObject:function(){return Ar},isRegExp:function(){return Sc},isSafeInteger:function(){return Cc},isSet:function(){return ia},isString:function(){return wl},isSymbol:function(){return y},isTypedArray:function(){return en},isUndefined:function(){return Tc},isWeakMap:function(){return Ac},isWeakSet:function(){return Mc},iteratee:function(){return kc},join:function(){return Oc},kebabCase:function(){return Ic},keyBy:function(){return Dc},keys:function(){return ln},keysIn:function(){return mn},last:function(){return Hs},lastIndexOf:function(){return Fc},lodash:function(){return It},lowerCase:function(){return jc},lowerFirst:function(){return Uc},lt:function(){return Gc},lte:function(){return Hc},map:function(){return Vu},mapKeys:function(){return Wc},mapValues:function(){return qc},matches:function(){return Xc},matchesProperty:function(){return Yc},max:function(){return Qc},maxBy:function(){return Jc},mean:function(){return ep},meanBy:function(){return np},memoize:function(){return nr},merge:function(){return ip},mergeWith:function(){return Rs},method:function(){return op},methodOf:function(){return ap},min:function(){return sp},minBy:function(){return up},mixin:function(){return lp},multiply:function(){return cp},negate:function(){return pp},next:function(){return vp},noop:function(){return bt},now:function(){return ys},nth:function(){return yp},nthArg:function(){return gp},omit:function(){return wp},omitBy:function(){return Tp},once:function(){return Ap},orderBy:function(){return Lp},over:function(){return Rp},overArgs:function(){return zp},overEvery:function(){return Fp},overSome:function(){return Bp},pad:function(){return sh},padEnd:function(){return uh},padStart:function(){return lh},parseInt:function(){return hh},partial:function(){return dh},partialRight:function(){return mh},partition:function(){return gh},pick:function(){return xh},pickBy:function(){return Cp},plant:function(){return bh},property:function(){return Xa},propertyOf:function(){return wh},pull:function(){return Ah},pullAll:function(){return Th},pullAllBy:function(){return Mh},pullAllWith:function(){return kh},pullAt:function(){return Ih},random:function(){return Bh},range:function(){return Hh},rangeRight:function(){return Wh},rearg:function(){return Xh},reduce:function(){return Kh},reduceRight:function(){return Jh},reject:function(){return $h},remove:function(){return tf},repeat:function(){return ef},replace:function(){return nf},rest:function(){return rf},result:function(){return of},reverse:function(){return sf},round:function(){return uf},sample:function(){return pf},sampleSize:function(){return vf},set:function(){return mf},setWith:function(){return yf},shuffle:function(){return xf},size:function(){return bf},slice:function(){return wf},snakeCase:function(){return Ef},some:function(){return Tf},sortBy:function(){return Af},sortedIndex:function(){return Lf},sortedIndexBy:function(){return If},sortedIndexOf:function(){return Rf},sortedLastIndex:function(){return Df},sortedLastIndexBy:function(){return Nf},sortedLastIndexOf:function(){return Zf},sortedUniq:function(){return Ff},sortedUniqBy:function(){return Bf},split:function(){return jf},spread:function(){return Vf},startCase:function(){return Hf},startsWith:function(){return Wf},stubArray:function(){return fo},stubFalse:function(){return Ue},stubObject:function(){return qf},stubString:function(){return Xf},stubTrue:function(){return Yf},subtract:function(){return Kf},sum:function(){return Qf},sumBy:function(){return Jf},tail:function(){return $f},take:function(){return td},takeRight:function(){return ed},takeRightWhile:function(){return nd},takeWhile:function(){return rd},tap:function(){return id},template:function(){return xd},templateSettings:function(){return pd},throttle:function(){return bd},thru:function(){return wd},times:function(){return Cd},toArray:function(){return dp},toFinite:function(){return Z},toInteger:function(){return z},toIterator:function(){return Td},toJSON:function(){return Md},toLength:function(){return Cu},toLower:function(){return kd},toNumber:function(){return D},toPairs:function(){return fu},toPairsIn:function(){return du},toPath:function(){return Pd},toPlainObject:function(){return ks},toSafeInteger:function(){return Ld},toString:function(){return ur},toUpper:function(){return Id},transform:function(){return Rd},trim:function(){return Zd},trimEnd:function(){return zd},trimStart:function(){return Bd},truncate:function(){return Ud},unary:function(){return Vd},unescape:function(){return qd},union:function(){return Qd},unionBy:function(){return $d},unionWith:function(){return tv},uniq:function(){return ev},uniqBy:function(){return nv},uniqWith:function(){return rv},uniqueId:function(){return ov},unset:function(){return av},unzip:function(){return uv},unzipWith:function(){return lv},update:function(){return pv},updateWith:function(){return hv},upperCase:function(){return dv},upperFirst:function(){return ni},value:function(){return Md},valueOf:function(){return Md},values:function(){return El},valuesIn:function(){return vv},without:function(){return yv},words:function(){return Ni},wrap:function(){return gv},wrapperAt:function(){return _v},wrapperChain:function(){return xv},wrapperCommit:function(){return da},wrapperLodash:function(){return It},wrapperNext:function(){return vp},wrapperPlant:function(){return bh},wrapperReverse:function(){return bv},wrapperToIterator:function(){return Td},wrapperValue:function(){return Md},xor:function(){return Sv},xorBy:function(){return Cv},xorWith:function(){return Tv},zip:function(){return Av},zipObject:function(){return kv},zipObjectDeep:function(){return Pv},zipWith:function(){return Lv}});var r="object"==typeof global&&global&&global.Object===Object&&global,i="object"==typeof self&&self&&self.Object===Object&&self,o=r||i||Function("return this")(),a=o.Symbol,s=Object.prototype,u=s.hasOwnProperty,l=s.toString,c=a?a.toStringTag:void 0;var p=function(t){var e=u.call(t,c),n=t[c];try{t[c]=void 0;var r=!0}catch(t){}var i=l.call(t);return r&&(e?t[c]=n:delete t[c]),i},h=Object.prototype.toString;var f=function(t){return h.call(t)},d=a?a.toStringTag:void 0;var v=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":d&&d in Object(t)?p(t):f(t)};var m=function(t){return null!=t&&"object"==typeof t};var y=function(t){return"symbol"==typeof t||m(t)&&"[object Symbol]"==v(t)};var g=function(t){return"number"==typeof t?t:y(t)?NaN:+t};var _=function(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i},x=Array.isArray,b=a?a.prototype:void 0,w=b?b.toString:void 0;var S=function t(e){if("string"==typeof e)return e;if(x(e))return _(e,t)+"";if(y(e))return w?w.call(e):"";var n=e+"";return"0"==n&&1/e==-Infinity?"-0":n};var E=function(t,e){return function(n,r){var i;if(void 0===n&&void 0===r)return e;if(void 0!==n&&(i=n),void 0!==r){if(void 0===i)return r;"string"==typeof n||"string"==typeof r?(n=S(n),r=S(r)):(n=g(n),r=g(r)),i=t(n,r)}return i}},C=E((function(t,e){return t+e}),0),T=/\s/;var A=function(t){for(var e=t.length;e--&&T.test(t.charAt(e)););return e},M=/^\s+/;var k=function(t){return t?t.slice(0,A(t)+1).replace(M,""):t};var P=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},O=/^[-+]0x[0-9a-f]+$/i,L=/^0b[01]+$/i,I=/^0o[0-7]+$/i,R=parseInt;var D=function(t){if("number"==typeof t)return t;if(y(t))return NaN;if(P(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=P(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=k(t);var n=L.test(t);return n||I.test(t)?R(t.slice(2),n?2:8):O.test(t)?NaN:+t},N=1/0;var Z=function(t){return t?(t=D(t))===N||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0};var z=function(t){var e=Z(t),n=e%1;return e==e?n?e-n:e:0};var F=function(t,e){if("function"!=typeof e)throw new TypeError("Expected a function");return t=z(t),function(){if(--t<1)return e.apply(this,arguments)}};var B=function(t){return t};var j,U=function(t){if(!P(t))return!1;var e=v(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},V=o["__core-js_shared__"],G=(j=/[^.]+$/.exec(V&&V.keys&&V.keys.IE_PROTO||""))?"Symbol(src)_1."+j:"";var H=function(t){return!!G&&G in t},W=Function.prototype.toString;var q=function(t){if(null!=t){try{return W.call(t)}catch(t){}try{return t+""}catch(t){}}return""},X=/^\[object .+?Constructor\]$/,Y=Function.prototype,K=Object.prototype,Q=Y.toString,J=K.hasOwnProperty,$=RegExp("^"+Q.call(J).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var tt=function(t){return!(!P(t)||H(t))&&(U(t)?$:X).test(q(t))};var et=function(t,e){return null==t?void 0:t[e]};var nt=function(t,e){var n=et(t,e);return tt(n)?n:void 0},rt=nt(o,"WeakMap"),it=rt&&new rt,ot=it?function(t,e){return it.set(t,e),t}:B,at=ot,st=Object.create,ut=function(){function t(){}return function(e){if(!P(e))return{};if(st)return st(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}(),lt=ut;var ct=function(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=lt(t.prototype),r=t.apply(n,e);return P(r)?r:n}};var pt=function(t,e,n){var r=1&e,i=ct(t);return function e(){var a=this&&this!==o&&this instanceof e?i:t;return a.apply(r?n:this,arguments)}};var ht=function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)},ft=Math.max;var dt=function(t,e,n,r){for(var i=-1,o=t.length,a=n.length,s=-1,u=e.length,l=ft(o-a,0),c=Array(u+l),p=!r;++s<u;)c[s]=e[s];for(;++i<a;)(p||i<o)&&(c[n[i]]=t[i]);for(;l--;)c[s++]=t[i++];return c},vt=Math.max;var mt=function(t,e,n,r){for(var i=-1,o=t.length,a=-1,s=n.length,u=-1,l=e.length,c=vt(o-s,0),p=Array(c+l),h=!r;++i<c;)p[i]=t[i];for(var f=i;++u<l;)p[f+u]=e[u];for(;++a<s;)(h||i<o)&&(p[f+n[a]]=t[i++]);return p};var yt=function(t,e){for(var n=t.length,r=0;n--;)t[n]===e&&++r;return r};var gt=function(){};function _t(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=4294967295,this.__views__=[]}_t.prototype=lt(gt.prototype),_t.prototype.constructor=_t;var xt=_t;var bt=function(){},wt=it?function(t){return it.get(t)}:bt,St=wt,Et={},Ct=Object.prototype.hasOwnProperty;var Tt=function(t){for(var e=t.name+"",n=Et[e],r=Ct.call(Et,e)?n.length:0;r--;){var i=n[r],o=i.func;if(null==o||o==t)return i.name}return e};function At(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=void 0}At.prototype=lt(gt.prototype),At.prototype.constructor=At;var Mt=At;var kt=function(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e};var Pt=function(t){if(t instanceof xt)return t.clone();var e=new Mt(t.__wrapped__,t.__chain__);return e.__actions__=kt(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e},Ot=Object.prototype.hasOwnProperty;function Lt(t){if(m(t)&&!x(t)&&!(t instanceof xt)){if(t instanceof Mt)return t;if(Ot.call(t,"__wrapped__"))return Pt(t)}return new Mt(t)}Lt.prototype=gt.prototype,Lt.prototype.constructor=Lt;var It=Lt;var Rt=function(t){var e=Tt(t),n=It[e];if("function"!=typeof n||!(e in xt.prototype))return!1;if(t===n)return!0;var r=St(n);return!!r&&t===r[0]},Dt=Date.now;var Nt=function(t){var e=0,n=0;return function(){var r=Dt(),i=16-(r-n);if(n=r,i>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}},Zt=Nt(at),zt=/\{\n\/\* \[wrapped with (.+)\] \*/,Ft=/,? & /;var Bt=function(t){var e=t.match(zt);return e?e[1].split(Ft):[]},jt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/;var Ut=function(t,e){var n=e.length;if(!n)return t;var r=n-1;return e[r]=(n>1?"& ":"")+e[r],e=e.join(n>2?", ":" "),t.replace(jt,"{\n/* [wrapped with "+e+"] */\n")};var Vt=function(t){return function(){return t}},Gt=function(){try{var t=nt(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),Ht=Gt,Wt=Ht?function(t,e){return Ht(t,"toString",{configurable:!0,enumerable:!1,value:Vt(e),writable:!0})}:B,qt=Nt(Wt);var Xt=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t};var Yt=function(t,e,n,r){for(var i=t.length,o=n+(r?1:-1);r?o--:++o<i;)if(e(t[o],o,t))return o;return-1};var Kt=function(t){return t!=t};var Qt=function(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1};var Jt=function(t,e,n){return e==e?Qt(t,e,n):Yt(t,Kt,n)};var $t=function(t,e){return!!(null==t?0:t.length)&&Jt(t,e,0)>-1},te=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]];var ee=function(t,e){return Xt(te,(function(n){var r="_."+n[0];e&n[1]&&!$t(t,r)&&t.push(r)})),t.sort()};var ne=function(t,e,n){var r=e+"";return qt(t,Ut(r,ee(Bt(r),n)))};var re=function(t,e,n,r,i,o,a,s,u,l){var c=8&e;e|=c?32:64,4&(e&=~(c?64:32))||(e&=-4);var p=[t,e,i,c?o:void 0,c?a:void 0,c?void 0:o,c?void 0:a,s,u,l],h=n.apply(void 0,p);return Rt(t)&&Zt(h,p),h.placeholder=r,ne(h,t,e)};var ie=function(t){return t.placeholder},oe=/^(?:0|[1-9]\d*)$/;var ae=function(t,e){var n=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==n||"symbol"!=n&&oe.test(t))&&t>-1&&t%1==0&&t<e},se=Math.min;var ue=function(t,e){for(var n=t.length,r=se(e.length,n),i=kt(t);r--;){var o=e[r];t[r]=ae(o,n)?i[o]:void 0}return t},le="__lodash_placeholder__";var ce=function(t,e){for(var n=-1,r=t.length,i=0,o=[];++n<r;){var a=t[n];a!==e&&a!==le||(t[n]=le,o[i++]=n)}return o};var pe=function t(e,n,r,i,a,s,u,l,c,p){var h=128&n,f=1&n,d=2&n,v=24&n,m=512&n,y=d?void 0:ct(e);return function g(){for(var _=arguments.length,x=Array(_),b=_;b--;)x[b]=arguments[b];if(v)var w=ie(g),S=yt(x,w);if(i&&(x=dt(x,i,a,v)),s&&(x=mt(x,s,u,v)),_-=S,v&&_<p){var E=ce(x,w);return re(e,n,t,g.placeholder,r,x,E,l,c,p-_)}var C=f?r:this,T=d?C[e]:e;return _=x.length,l?x=ue(x,l):m&&_>1&&x.reverse(),h&&c<_&&(x.length=c),this&&this!==o&&this instanceof g&&(T=y||ct(T)),T.apply(C,x)}};var he=function(t,e,n){var r=ct(t);return function i(){for(var a=arguments.length,s=Array(a),u=a,l=ie(i);u--;)s[u]=arguments[u];var c=a<3&&s[0]!==l&&s[a-1]!==l?[]:ce(s,l);if((a-=c.length)<n)return re(t,e,pe,i.placeholder,void 0,s,c,void 0,void 0,n-a);var p=this&&this!==o&&this instanceof i?r:t;return ht(p,this,s)}};var fe=function(t,e,n,r){var i=1&e,a=ct(t);return function e(){for(var s=-1,u=arguments.length,l=-1,c=r.length,p=Array(c+u),h=this&&this!==o&&this instanceof e?a:t;++l<c;)p[l]=r[l];for(;u--;)p[l++]=arguments[++s];return ht(h,i?n:this,p)}},de="__lodash_placeholder__",ve=128,me=Math.min;var ye=function(t,e){var n=t[1],r=e[1],i=n|r,o=i<131,a=r==ve&&8==n||r==ve&&256==n&&t[7].length<=e[8]||384==r&&e[7].length<=e[8]&&8==n;if(!o&&!a)return t;1&r&&(t[2]=e[2],i|=1&n?0:4);var s=e[3];if(s){var u=t[3];t[3]=u?dt(u,s,e[4]):s,t[4]=u?ce(t[3],de):e[4]}return(s=e[5])&&(u=t[5],t[5]=u?mt(u,s,e[6]):s,t[6]=u?ce(t[5],de):e[6]),(s=e[7])&&(t[7]=s),r&ve&&(t[8]=null==t[8]?e[8]:me(t[8],e[8])),null==t[9]&&(t[9]=e[9]),t[0]=e[0],t[1]=i,t},ge=Math.max;var _e=function(t,e,n,r,i,o,a,s){var u=2&e;if(!u&&"function"!=typeof t)throw new TypeError("Expected a function");var l=r?r.length:0;if(l||(e&=-97,r=i=void 0),a=void 0===a?a:ge(z(a),0),s=void 0===s?s:z(s),l-=i?i.length:0,64&e){var c=r,p=i;r=i=void 0}var h=u?void 0:St(t),f=[t,e,n,r,i,c,p,o,a,s];if(h&&ye(f,h),t=f[0],e=f[1],n=f[2],r=f[3],i=f[4],!(s=f[9]=void 0===f[9]?u?0:t.length:ge(f[9]-l,0))&&24&e&&(e&=-25),e&&1!=e)d=8==e||16==e?he(t,e,s):32!=e&&33!=e||i.length?pe.apply(void 0,f):fe(t,e,n,r);else var d=pt(t,e,n);return ne((h?at:Zt)(d,f),t,e)};var xe=function(t,e,n){return e=n?void 0:e,e=t&&null==e?t.length:e,_e(t,128,void 0,void 0,void 0,void 0,e)};var be=function(t,e,n){"__proto__"==e&&Ht?Ht(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n};var we=function(t,e){return t===e||t!=t&&e!=e},Se=Object.prototype.hasOwnProperty;var Ee=function(t,e,n){var r=t[e];Se.call(t,e)&&we(r,n)&&(void 0!==n||e in t)||be(t,e,n)};var Ce=function(t,e,n,r){var i=!n;n||(n={});for(var o=-1,a=e.length;++o<a;){var s=e[o],u=r?r(n[s],t[s],s,n,t):void 0;void 0===u&&(u=t[s]),i?be(n,s,u):Ee(n,s,u)}return n},Te=Math.max;var Ae=function(t,e,n){return e=Te(void 0===e?t.length-1:e,0),function(){for(var r=arguments,i=-1,o=Te(r.length-e,0),a=Array(o);++i<o;)a[i]=r[e+i];i=-1;for(var s=Array(e+1);++i<e;)s[i]=r[i];return s[e]=n(a),ht(t,this,s)}};var Me=function(t,e){return qt(Ae(t,e,B),t+"")};var ke=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991};var Pe=function(t){return null!=t&&ke(t.length)&&!U(t)};var Oe=function(t,e,n){if(!P(n))return!1;var r=typeof e;return!!("number"==r?Pe(n)&&ae(e,n.length):"string"==r&&e in n)&&we(n[e],t)};var Le=function(t){return Me((function(e,n){var r=-1,i=n.length,o=i>1?n[i-1]:void 0,a=i>2?n[2]:void 0;for(o=t.length>3&&"function"==typeof o?(i--,o):void 0,a&&Oe(n[0],n[1],a)&&(o=i<3?void 0:o,i=1),e=Object(e);++r<i;){var s=n[r];s&&t(e,s,r,o)}return e}))},Ie=Object.prototype;var Re=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Ie)};var De=function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r};var Ne=function(t){return m(t)&&"[object Arguments]"==v(t)},Ze=Object.prototype,ze=Ze.hasOwnProperty,Fe=Ze.propertyIsEnumerable,Be=Ne(function(){return arguments}())?Ne:function(t){return m(t)&&ze.call(t,"callee")&&!Fe.call(t,"callee")},je=Be;var Ue=function(){return!1},Ve="object"==typeof exports&&exports&&!exports.nodeType&&exports,Ge=Ve&&"object"==typeof module&&module&&!module.nodeType&&module,He=Ge&&Ge.exports===Ve?o.Buffer:void 0,We=(He?He.isBuffer:void 0)||Ue,qe={};qe["[object Float32Array]"]=qe["[object Float64Array]"]=qe["[object Int8Array]"]=qe["[object Int16Array]"]=qe["[object Int32Array]"]=qe["[object Uint8Array]"]=qe["[object Uint8ClampedArray]"]=qe["[object Uint16Array]"]=qe["[object Uint32Array]"]=!0,qe["[object Arguments]"]=qe["[object Array]"]=qe["[object ArrayBuffer]"]=qe["[object Boolean]"]=qe["[object DataView]"]=qe["[object Date]"]=qe["[object Error]"]=qe["[object Function]"]=qe["[object Map]"]=qe["[object Number]"]=qe["[object Object]"]=qe["[object RegExp]"]=qe["[object Set]"]=qe["[object String]"]=qe["[object WeakMap]"]=!1;var Xe=function(t){return m(t)&&ke(t.length)&&!!qe[v(t)]};var Ye=function(t){return function(e){return t(e)}},Ke="object"==typeof exports&&exports&&!exports.nodeType&&exports,Qe=Ke&&"object"==typeof module&&module&&!module.nodeType&&module,Je=Qe&&Qe.exports===Ke&&r.process,$e=function(){try{var t=Qe&&Qe.require&&Qe.require("util").types;return t||Je&&Je.binding&&Je.binding("util")}catch(t){}}(),tn=$e&&$e.isTypedArray,en=tn?Ye(tn):Xe,nn=Object.prototype.hasOwnProperty;var rn=function(t,e){var n=x(t),r=!n&&je(t),i=!n&&!r&&We(t),o=!n&&!r&&!i&&en(t),a=n||r||i||o,s=a?De(t.length,String):[],u=s.length;for(var l in t)!e&&!nn.call(t,l)||a&&("length"==l||i&&("offset"==l||"parent"==l)||o&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||ae(l,u))||s.push(l);return s};var on=function(t,e){return function(n){return t(e(n))}},an=on(Object.keys,Object),sn=Object.prototype.hasOwnProperty;var un=function(t){if(!Re(t))return an(t);var e=[];for(var n in Object(t))sn.call(t,n)&&"constructor"!=n&&e.push(n);return e};var ln=function(t){return Pe(t)?rn(t):un(t)},cn=Object.prototype.hasOwnProperty,pn=Le((function(t,e){if(Re(e)||Pe(e))Ce(e,ln(e),t);else for(var n in e)cn.call(e,n)&&Ee(t,n,e[n])})),hn=pn;var fn=function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e},dn=Object.prototype.hasOwnProperty;var vn=function(t){if(!P(t))return fn(t);var e=Re(t),n=[];for(var r in t)("constructor"!=r||!e&&dn.call(t,r))&&n.push(r);return n};var mn=function(t){return Pe(t)?rn(t,!0):vn(t)},yn=Le((function(t,e){Ce(e,mn(e),t)})),gn=yn,_n=Le((function(t,e,n,r){Ce(e,mn(e),t,r)})),xn=_n,bn=Le((function(t,e,n,r){Ce(e,ln(e),t,r)})),wn=bn,Sn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,En=/^\w*$/;var Cn=function(t,e){if(x(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!y(t))||(En.test(t)||!Sn.test(t)||null!=e&&t in Object(e))},Tn=nt(Object,"create");var An=function(){this.__data__=Tn?Tn(null):{},this.size=0};var Mn=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},kn=Object.prototype.hasOwnProperty;var Pn=function(t){var e=this.__data__;if(Tn){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return kn.call(e,t)?e[t]:void 0},On=Object.prototype.hasOwnProperty;var Ln=function(t){var e=this.__data__;return Tn?void 0!==e[t]:On.call(e,t)};var In=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=Tn&&void 0===e?"__lodash_hash_undefined__":e,this};function Rn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Rn.prototype.clear=An,Rn.prototype.delete=Mn,Rn.prototype.get=Pn,Rn.prototype.has=Ln,Rn.prototype.set=In;var Dn=Rn;var Nn=function(){this.__data__=[],this.size=0};var Zn=function(t,e){for(var n=t.length;n--;)if(we(t[n][0],e))return n;return-1},zn=Array.prototype.splice;var Fn=function(t){var e=this.__data__,n=Zn(e,t);return!(n<0)&&(n==e.length-1?e.pop():zn.call(e,n,1),--this.size,!0)};var Bn=function(t){var e=this.__data__,n=Zn(e,t);return n<0?void 0:e[n][1]};var jn=function(t){return Zn(this.__data__,t)>-1};var Un=function(t,e){var n=this.__data__,r=Zn(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this};function Vn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Vn.prototype.clear=Nn,Vn.prototype.delete=Fn,Vn.prototype.get=Bn,Vn.prototype.has=jn,Vn.prototype.set=Un;var Gn=Vn,Hn=nt(o,"Map");var Wn=function(){this.size=0,this.__data__={hash:new Dn,map:new(Hn||Gn),string:new Dn}};var qn=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var Xn=function(t,e){var n=t.__data__;return qn(e)?n["string"==typeof e?"string":"hash"]:n.map};var Yn=function(t){var e=Xn(this,t).delete(t);return this.size-=e?1:0,e};var Kn=function(t){return Xn(this,t).get(t)};var Qn=function(t){return Xn(this,t).has(t)};var Jn=function(t,e){var n=Xn(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this};function $n(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}$n.prototype.clear=Wn,$n.prototype.delete=Yn,$n.prototype.get=Kn,$n.prototype.has=Qn,$n.prototype.set=Jn;var tr=$n;function er(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=t.apply(this,r);return n.cache=o.set(i,a)||o,a};return n.cache=new(er.Cache||tr),n}er.Cache=tr;var nr=er;var rr=function(t){var e=nr(t,(function(t){return 500===n.size&&n.clear(),t})),n=e.cache;return e},ir=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,or=/\\(\\)?/g,ar=rr((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(ir,(function(t,n,r,i){e.push(r?i.replace(or,"$1"):n||t)})),e})),sr=ar;var ur=function(t){return null==t?"":S(t)};var lr=function(t,e){return x(t)?t:Cn(t,e)?[t]:sr(ur(t))};var cr=function(t){if("string"==typeof t||y(t))return t;var e=t+"";return"0"==e&&1/t==-Infinity?"-0":e};var pr=function(t,e){for(var n=0,r=(e=lr(e,t)).length;null!=t&&n<r;)t=t[cr(e[n++])];return n&&n==r?t:void 0};var hr=function(t,e,n){var r=null==t?void 0:pr(t,e);return void 0===r?n:r};var fr=function(t,e){for(var n=-1,r=e.length,i=Array(r),o=null==t;++n<r;)i[n]=o?void 0:hr(t,e[n]);return i};var dr=function(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t},vr=a?a.isConcatSpreadable:void 0;var mr=function(t){return x(t)||je(t)||!!(vr&&t&&t[vr])};var yr=function t(e,n,r,i,o){var a=-1,s=e.length;for(r||(r=mr),o||(o=[]);++a<s;){var u=e[a];n>0&&r(u)?n>1?t(u,n-1,r,i,o):dr(o,u):i||(o[o.length]=u)}return o};var gr=function(t){return(null==t?0:t.length)?yr(t,1):[]};var _r=function(t){return qt(Ae(t,void 0,gr),t+"")},xr=_r(fr),br=on(Object.getPrototypeOf,Object),wr=Function.prototype,Sr=Object.prototype,Er=wr.toString,Cr=Sr.hasOwnProperty,Tr=Er.call(Object);var Ar=function(t){if(!m(t)||"[object Object]"!=v(t))return!1;var e=br(t);if(null===e)return!0;var n=Cr.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&Er.call(n)==Tr};var Mr=function(t){if(!m(t))return!1;var e=v(t);return"[object Error]"==e||"[object DOMException]"==e||"string"==typeof t.message&&"string"==typeof t.name&&!Ar(t)},kr=Me((function(t,e){try{return ht(t,void 0,e)}catch(t){return Mr(t)?t:new Error(t)}})),Pr=kr;var Or=function(t,e){var n;if("function"!=typeof e)throw new TypeError("Expected a function");return t=z(t),function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=void 0),n}},Lr=Me((function(t,e,n){var r=1;if(n.length){var i=ce(n,ie(Lr));r|=32}return _e(t,r,e,n,i)}));Lr.placeholder={};var Ir=Lr,Rr=_r((function(t,e){return Xt(e,(function(e){e=cr(e),be(t,e,Ir(t[e],t))})),t})),Dr=Me((function(t,e,n){var r=3;if(n.length){var i=ce(n,ie(Dr));r|=32}return _e(e,r,t,n,i)}));Dr.placeholder={};var Nr=Dr;var Zr=function(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),(n=n>i?i:n)<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var o=Array(i);++r<i;)o[r]=t[r+e];return o};var zr=function(t,e,n){var r=t.length;return n=void 0===n?r:n,!e&&n>=r?t:Zr(t,e,n)},Fr=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var Br=function(t){return Fr.test(t)};var jr=function(t){return t.split("")},Ur="[\\ud800-\\udfff]",Vr="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",Gr="\\ud83c[\\udffb-\\udfff]",Hr="[^\\ud800-\\udfff]",Wr="(?:\\ud83c[\\udde6-\\uddff]){2}",qr="[\\ud800-\\udbff][\\udc00-\\udfff]",Xr="(?:"+Vr+"|"+Gr+")"+"?",Yr="[\\ufe0e\\ufe0f]?",Kr=Yr+Xr+("(?:\\u200d(?:"+[Hr,Wr,qr].join("|")+")"+Yr+Xr+")*"),Qr="(?:"+[Hr+Vr+"?",Vr,Wr,qr,Ur].join("|")+")",Jr=RegExp(Gr+"(?="+Gr+")|"+Qr+Kr,"g");var $r=function(t){return t.match(Jr)||[]};var ti=function(t){return Br(t)?$r(t):jr(t)};var ei=function(t){return function(e){e=ur(e);var n=Br(e)?ti(e):void 0,r=n?n[0]:e.charAt(0),i=n?zr(n,1).join(""):e.slice(1);return r[t]()+i}},ni=ei("toUpperCase");var ri=function(t){return ni(ur(t).toLowerCase())};var ii=function(t,e,n,r){var i=-1,o=null==t?0:t.length;for(r&&o&&(n=t[++i]);++i<o;)n=e(n,t[i],i,t);return n};var oi=function(t){return function(e){return null==t?void 0:t[e]}},ai=oi({À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"}),si=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ui=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g");var li=function(t){return(t=ur(t))&&t.replace(si,ai).replace(ui,"")},ci=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;var pi=function(t){return t.match(ci)||[]},hi=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;var fi=function(t){return hi.test(t)},di="\\u2700-\\u27bf",vi="a-z\\xdf-\\xf6\\xf8-\\xff",mi="A-Z\\xc0-\\xd6\\xd8-\\xde",yi="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",gi="["+yi+"]",_i="\\d+",xi="[\\u2700-\\u27bf]",bi="["+vi+"]",wi="[^\\ud800-\\udfff"+yi+_i+di+vi+mi+"]",Si="(?:\\ud83c[\\udde6-\\uddff]){2}",Ei="[\\ud800-\\udbff][\\udc00-\\udfff]",Ci="["+mi+"]",Ti="(?:"+bi+"|"+wi+")",Ai="(?:"+Ci+"|"+wi+")",Mi="(?:['’](?:d|ll|m|re|s|t|ve))?",ki="(?:['’](?:D|LL|M|RE|S|T|VE))?",Pi="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",Oi="[\\ufe0e\\ufe0f]?",Li=Oi+Pi+("(?:\\u200d(?:"+["[^\\ud800-\\udfff]",Si,Ei].join("|")+")"+Oi+Pi+")*"),Ii="(?:"+[xi,Si,Ei].join("|")+")"+Li,Ri=RegExp([Ci+"?"+bi+"+"+Mi+"(?="+[gi,Ci,"$"].join("|")+")",Ai+"+"+ki+"(?="+[gi,Ci+Ti,"$"].join("|")+")",Ci+"?"+Ti+"+"+Mi,Ci+"+"+ki,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",_i,Ii].join("|"),"g");var Di=function(t){return t.match(Ri)||[]};var Ni=function(t,e,n){return t=ur(t),void 0===(e=n?void 0:e)?fi(t)?Di(t):pi(t):t.match(e)||[]},Zi=RegExp("['’]","g");var zi=function(t){return function(e){return ii(Ni(li(e).replace(Zi,"")),t,"")}},Fi=zi((function(t,e,n){return e=e.toLowerCase(),t+(n?ri(e):e)})),Bi=Fi;var ji=function(){if(!arguments.length)return[];var t=arguments[0];return x(t)?t:[t]},Ui=o.isFinite,Vi=Math.min;var Gi=function(t){var e=Math[t];return function(t,n){if(t=D(t),(n=null==n?0:Vi(z(n),292))&&Ui(t)){var r=(ur(t)+"e").split("e"),i=e(r[0]+"e"+(+r[1]+n));return+((r=(ur(i)+"e").split("e"))[0]+"e"+(+r[1]-n))}return e(t)}},Hi=Gi("ceil");var Wi=function(t){var e=It(t);return e.__chain__=!0,e},qi=Math.ceil,Xi=Math.max;var Yi=function(t,e,n){e=(n?Oe(t,e,n):void 0===e)?1:Xi(z(e),0);var r=null==t?0:t.length;if(!r||e<1)return[];for(var i=0,o=0,a=Array(qi(r/e));i<r;)a[o++]=Zr(t,i,i+=e);return a};var Ki=function(t,e,n){return t==t&&(void 0!==n&&(t=t<=n?t:n),void 0!==e&&(t=t>=e?t:e)),t};var Qi=function(t,e,n){return void 0===n&&(n=e,e=void 0),void 0!==n&&(n=(n=D(n))==n?n:0),void 0!==e&&(e=(e=D(e))==e?e:0),Ki(D(t),e,n)};var Ji=function(){this.__data__=new Gn,this.size=0};var $i=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n};var to=function(t){return this.__data__.get(t)};var eo=function(t){return this.__data__.has(t)};var no=function(t,e){var n=this.__data__;if(n instanceof Gn){var r=n.__data__;if(!Hn||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new tr(r)}return n.set(t,e),this.size=n.size,this};function ro(t){var e=this.__data__=new Gn(t);this.size=e.size}ro.prototype.clear=Ji,ro.prototype.delete=$i,ro.prototype.get=to,ro.prototype.has=eo,ro.prototype.set=no;var io=ro;var oo=function(t,e){return t&&Ce(e,ln(e),t)};var ao=function(t,e){return t&&Ce(e,mn(e),t)},so="object"==typeof exports&&exports&&!exports.nodeType&&exports,uo=so&&"object"==typeof module&&module&&!module.nodeType&&module,lo=uo&&uo.exports===so?o.Buffer:void 0,co=lo?lo.allocUnsafe:void 0;var po=function(t,e){if(e)return t.slice();var n=t.length,r=co?co(n):new t.constructor(n);return t.copy(r),r};var ho=function(t,e){for(var n=-1,r=null==t?0:t.length,i=0,o=[];++n<r;){var a=t[n];e(a,n,t)&&(o[i++]=a)}return o};var fo=function(){return[]},vo=Object.prototype.propertyIsEnumerable,mo=Object.getOwnPropertySymbols,yo=mo?function(t){return null==t?[]:(t=Object(t),ho(mo(t),(function(e){return vo.call(t,e)})))}:fo;var go=function(t,e){return Ce(t,yo(t),e)},_o=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)dr(e,yo(t)),t=br(t);return e}:fo,xo=_o;var bo=function(t,e){return Ce(t,xo(t),e)};var wo=function(t,e,n){var r=e(t);return x(t)?r:dr(r,n(t))};var So=function(t){return wo(t,ln,yo)};var Eo=function(t){return wo(t,mn,xo)},Co=nt(o,"DataView"),To=nt(o,"Promise"),Ao=nt(o,"Set"),Mo="[object Map]",ko="[object Promise]",Po="[object Set]",Oo="[object WeakMap]",Lo="[object DataView]",Io=q(Co),Ro=q(Hn),Do=q(To),No=q(Ao),Zo=q(rt),zo=v;(Co&&zo(new Co(new ArrayBuffer(1)))!=Lo||Hn&&zo(new Hn)!=Mo||To&&zo(To.resolve())!=ko||Ao&&zo(new Ao)!=Po||rt&&zo(new rt)!=Oo)&&(zo=function(t){var e=v(t),n="[object Object]"==e?t.constructor:void 0,r=n?q(n):"";if(r)switch(r){case Io:return Lo;case Ro:return Mo;case Do:return ko;case No:return Po;case Zo:return Oo}return e});var Fo=zo,Bo=Object.prototype.hasOwnProperty;var jo=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&Bo.call(t,"index")&&(n.index=t.index,n.input=t.input),n},Uo=o.Uint8Array;var Vo=function(t){var e=new t.constructor(t.byteLength);return new Uo(e).set(new Uo(t)),e};var Go=function(t,e){var n=e?Vo(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)},Ho=/\w*$/;var Wo=function(t){var e=new t.constructor(t.source,Ho.exec(t));return e.lastIndex=t.lastIndex,e},qo=a?a.prototype:void 0,Xo=qo?qo.valueOf:void 0;var Yo=function(t){return Xo?Object(Xo.call(t)):{}};var Ko=function(t,e){var n=e?Vo(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)};var Qo=function(t,e,n){var r=t.constructor;switch(e){case"[object ArrayBuffer]":return Vo(t);case"[object Boolean]":case"[object Date]":return new r(+t);case"[object DataView]":return Go(t,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return Ko(t,n);case"[object Map]":case"[object Set]":return new r;case"[object Number]":case"[object String]":return new r(t);case"[object RegExp]":return Wo(t);case"[object Symbol]":return Yo(t)}};var Jo=function(t){return"function"!=typeof t.constructor||Re(t)?{}:lt(br(t))};var $o=function(t){return m(t)&&"[object Map]"==Fo(t)},ta=$e&&$e.isMap,ea=ta?Ye(ta):$o;var na=function(t){return m(t)&&"[object Set]"==Fo(t)},ra=$e&&$e.isSet,ia=ra?Ye(ra):na,oa="[object Arguments]",aa="[object Function]",sa="[object Object]",ua={};ua[oa]=ua["[object Array]"]=ua["[object ArrayBuffer]"]=ua["[object DataView]"]=ua["[object Boolean]"]=ua["[object Date]"]=ua["[object Float32Array]"]=ua["[object Float64Array]"]=ua["[object Int8Array]"]=ua["[object Int16Array]"]=ua["[object Int32Array]"]=ua["[object Map]"]=ua["[object Number]"]=ua["[object Object]"]=ua["[object RegExp]"]=ua["[object Set]"]=ua["[object String]"]=ua["[object Symbol]"]=ua["[object Uint8Array]"]=ua["[object Uint8ClampedArray]"]=ua["[object Uint16Array]"]=ua["[object Uint32Array]"]=!0,ua["[object Error]"]=ua[aa]=ua["[object WeakMap]"]=!1;var la=function t(e,n,r,i,o,a){var s,u=1&n,l=2&n,c=4&n;if(r&&(s=o?r(e,i,o,a):r(e)),void 0!==s)return s;if(!P(e))return e;var p=x(e);if(p){if(s=jo(e),!u)return kt(e,s)}else{var h=Fo(e),f=h==aa||"[object GeneratorFunction]"==h;if(We(e))return po(e,u);if(h==sa||h==oa||f&&!o){if(s=l||f?{}:Jo(e),!u)return l?bo(e,ao(s,e)):go(e,oo(s,e))}else{if(!ua[h])return o?e:{};s=Qo(e,h,u)}}a||(a=new io);var d=a.get(e);if(d)return d;a.set(e,s),ia(e)?e.forEach((function(i){s.add(t(i,n,r,i,e,a))})):ea(e)&&e.forEach((function(i,o){s.set(o,t(i,n,r,o,e,a))}));var v=p?void 0:(c?l?Eo:So:l?mn:ln)(e);return Xt(v||e,(function(i,o){v&&(i=e[o=i]),Ee(s,o,t(i,n,r,o,e,a))})),s};var ca=function(t){return la(t,4)};var pa=function(t){return la(t,5)};var ha=function(t,e){return la(t,5,e="function"==typeof e?e:void 0)};var fa=function(t,e){return la(t,4,e="function"==typeof e?e:void 0)};var da=function(){return new Mt(this.value(),this.__chain__)};var va=function(t){for(var e=-1,n=null==t?0:t.length,r=0,i=[];++e<n;){var o=t[e];o&&(i[r++]=o)}return i};var ma=function(){var t=arguments.length;if(!t)return[];for(var e=Array(t-1),n=arguments[0],r=t;r--;)e[r-1]=arguments[r];return dr(x(n)?kt(n):[n],yr(e,1))};var ya=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this};var ga=function(t){return this.__data__.has(t)};function _a(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new tr;++e<n;)this.add(t[e])}_a.prototype.add=_a.prototype.push=ya,_a.prototype.has=ga;var xa=_a;var ba=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1};var wa=function(t,e){return t.has(e)};var Sa=function(t,e,n,r,i,o){var a=1&n,s=t.length,u=e.length;if(s!=u&&!(a&&u>s))return!1;var l=o.get(t),c=o.get(e);if(l&&c)return l==e&&c==t;var p=-1,h=!0,f=2&n?new xa:void 0;for(o.set(t,e),o.set(e,t);++p<s;){var d=t[p],v=e[p];if(r)var m=a?r(v,d,p,e,t,o):r(d,v,p,t,e,o);if(void 0!==m){if(m)continue;h=!1;break}if(f){if(!ba(e,(function(t,e){if(!wa(f,e)&&(d===t||i(d,t,n,r,o)))return f.push(e)}))){h=!1;break}}else if(d!==v&&!i(d,v,n,r,o)){h=!1;break}}return o.delete(t),o.delete(e),h};var Ea=function(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n};var Ca=function(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n},Ta=a?a.prototype:void 0,Aa=Ta?Ta.valueOf:void 0;var Ma=function(t,e,n,r,i,o,a){switch(n){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!o(new Uo(t),new Uo(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return we(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var s=Ea;case"[object Set]":var u=1&r;if(s||(s=Ca),t.size!=e.size&&!u)return!1;var l=a.get(t);if(l)return l==e;r|=2,a.set(t,e);var c=Sa(s(t),s(e),r,i,o,a);return a.delete(t),c;case"[object Symbol]":if(Aa)return Aa.call(t)==Aa.call(e)}return!1},ka=Object.prototype.hasOwnProperty;var Pa=function(t,e,n,r,i,o){var a=1&n,s=So(t),u=s.length;if(u!=So(e).length&&!a)return!1;for(var l=u;l--;){var c=s[l];if(!(a?c in e:ka.call(e,c)))return!1}var p=o.get(t),h=o.get(e);if(p&&h)return p==e&&h==t;var f=!0;o.set(t,e),o.set(e,t);for(var d=a;++l<u;){var v=t[c=s[l]],m=e[c];if(r)var y=a?r(m,v,c,e,t,o):r(v,m,c,t,e,o);if(!(void 0===y?v===m||i(v,m,n,r,o):y)){f=!1;break}d||(d="constructor"==c)}if(f&&!d){var g=t.constructor,_=e.constructor;g==_||!("constructor"in t)||!("constructor"in e)||"function"==typeof g&&g instanceof g&&"function"==typeof _&&_ instanceof _||(f=!1)}return o.delete(t),o.delete(e),f},Oa="[object Arguments]",La="[object Array]",Ia="[object Object]",Ra=Object.prototype.hasOwnProperty;var Da=function(t,e,n,r,i,o){var a=x(t),s=x(e),u=a?La:Fo(t),l=s?La:Fo(e),c=(u=u==Oa?Ia:u)==Ia,p=(l=l==Oa?Ia:l)==Ia,h=u==l;if(h&&We(t)){if(!We(e))return!1;a=!0,c=!1}if(h&&!c)return o||(o=new io),a||en(t)?Sa(t,e,n,r,i,o):Ma(t,e,u,n,r,i,o);if(!(1&n)){var f=c&&Ra.call(t,"__wrapped__"),d=p&&Ra.call(e,"__wrapped__");if(f||d){var v=f?t.value():t,m=d?e.value():e;return o||(o=new io),i(v,m,n,r,o)}}return!!h&&(o||(o=new io),Pa(t,e,n,r,i,o))};var Na=function t(e,n,r,i,o){return e===n||(null==e||null==n||!m(e)&&!m(n)?e!=e&&n!=n:Da(e,n,r,i,t,o))};var Za=function(t,e,n,r){var i=n.length,o=i,a=!r;if(null==t)return!o;for(t=Object(t);i--;){var s=n[i];if(a&&s[2]?s[1]!==t[s[0]]:!(s[0]in t))return!1}for(;++i<o;){var u=(s=n[i])[0],l=t[u],c=s[1];if(a&&s[2]){if(void 0===l&&!(u in t))return!1}else{var p=new io;if(r)var h=r(l,c,u,t,e,p);if(!(void 0===h?Na(c,l,3,r,p):h))return!1}}return!0};var za=function(t){return t==t&&!P(t)};var Fa=function(t){for(var e=ln(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,za(i)]}return e};var Ba=function(t,e){return function(n){return null!=n&&(n[t]===e&&(void 0!==e||t in Object(n)))}};var ja=function(t){var e=Fa(t);return 1==e.length&&e[0][2]?Ba(e[0][0],e[0][1]):function(n){return n===t||Za(n,t,e)}};var Ua=function(t,e){return null!=t&&e in Object(t)};var Va=function(t,e,n){for(var r=-1,i=(e=lr(e,t)).length,o=!1;++r<i;){var a=cr(e[r]);if(!(o=null!=t&&n(t,a)))break;t=t[a]}return o||++r!=i?o:!!(i=null==t?0:t.length)&&ke(i)&&ae(a,i)&&(x(t)||je(t))};var Ga=function(t,e){return null!=t&&Va(t,e,Ua)};var Ha=function(t,e){return Cn(t)&&za(e)?Ba(cr(t),e):function(n){var r=hr(n,t);return void 0===r&&r===e?Ga(n,t):Na(e,r,3)}};var Wa=function(t){return function(e){return null==e?void 0:e[t]}};var qa=function(t){return function(e){return pr(e,t)}};var Xa=function(t){return Cn(t)?Wa(cr(t)):qa(t)};var Ya=function(t){return"function"==typeof t?t:null==t?B:"object"==typeof t?x(t)?Ha(t[0],t[1]):ja(t):Xa(t)};var Ka=function(t){var e=null==t?0:t.length,n=Ya;return t=e?_(t,(function(t){if("function"!=typeof t[1])throw new TypeError("Expected a function");return[n(t[0]),t[1]]})):[],Me((function(n){for(var r=-1;++r<e;){var i=t[r];if(ht(i[0],this,n))return ht(i[1],this,n)}}))};var Qa=function(t,e,n){var r=n.length;if(null==t)return!r;for(t=Object(t);r--;){var i=n[r],o=e[i],a=t[i];if(void 0===a&&!(i in t)||!o(a))return!1}return!0};var Ja=function(t){var e=ln(t);return function(n){return Qa(n,t,e)}};var $a=function(t){return Ja(la(t,1))};var ts=function(t,e){return null==e||Qa(t,e,ln(e))};var es=function(t,e,n,r){for(var i=-1,o=null==t?0:t.length;++i<o;){var a=t[i];e(r,a,n(a),t)}return r};var ns=function(t){return function(e,n,r){for(var i=-1,o=Object(e),a=r(e),s=a.length;s--;){var u=a[t?s:++i];if(!1===n(o[u],u,o))break}return e}},rs=ns();var is=function(t,e){return t&&rs(t,e,ln)};var os=function(t,e){return function(n,r){if(null==n)return n;if(!Pe(n))return t(n,r);for(var i=n.length,o=e?i:-1,a=Object(n);(e?o--:++o<i)&&!1!==r(a[o],o,a););return n}},as=os(is);var ss=function(t,e,n,r){return as(t,(function(t,i,o){e(r,t,n(t),o)})),r};var us=function(t,e){return function(n,r){var i=x(n)?es:ss,o=e?e():{};return i(n,t,Ya(r,2),o)}},ls=Object.prototype.hasOwnProperty,cs=us((function(t,e,n){ls.call(t,n)?++t[n]:be(t,n,1)})),ps=cs;var hs=function(t,e){var n=lt(t);return null==e?n:oo(n,e)};function fs(t,e,n){var r=_e(t,8,void 0,void 0,void 0,void 0,void 0,e=n?void 0:e);return r.placeholder=fs.placeholder,r}fs.placeholder={};var ds=fs;function vs(t,e,n){var r=_e(t,16,void 0,void 0,void 0,void 0,void 0,e=n?void 0:e);return r.placeholder=vs.placeholder,r}vs.placeholder={};var ms=vs,ys=function(){return o.Date.now()},gs=Math.max,_s=Math.min;var xs=function(t,e,n){var r,i,o,a,s,u,l=0,c=!1,p=!1,h=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function f(e){var n=r,o=i;return r=i=void 0,l=e,a=t.apply(o,n)}function d(t){return l=t,s=setTimeout(m,e),c?f(t):a}function v(t){var n=t-u;return void 0===u||n>=e||n<0||p&&t-l>=o}function m(){var t=ys();if(v(t))return y(t);s=setTimeout(m,function(t){var n=e-(t-u);return p?_s(n,o-(t-l)):n}(t))}function y(t){return s=void 0,h&&r?f(t):(r=i=void 0,a)}function g(){var t=ys(),n=v(t);if(r=arguments,i=this,u=t,n){if(void 0===s)return d(u);if(p)return clearTimeout(s),s=setTimeout(m,e),f(u)}return void 0===s&&(s=setTimeout(m,e)),a}return e=D(e)||0,P(n)&&(c=!!n.leading,o=(p="maxWait"in n)?gs(D(n.maxWait)||0,e):o,h="trailing"in n?!!n.trailing:h),g.cancel=function(){void 0!==s&&clearTimeout(s),l=0,r=u=i=s=void 0},g.flush=function(){return void 0===s?a:y(ys())},g};var bs=function(t,e){return null==t||t!=t?e:t},ws=Object.prototype,Ss=ws.hasOwnProperty,Es=Me((function(t,e){t=Object(t);var n=-1,r=e.length,i=r>2?e[2]:void 0;for(i&&Oe(e[0],e[1],i)&&(r=1);++n<r;)for(var o=e[n],a=mn(o),s=-1,u=a.length;++s<u;){var l=a[s],c=t[l];(void 0===c||we(c,ws[l])&&!Ss.call(t,l))&&(t[l]=o[l])}return t})),Cs=Es;var Ts=function(t,e,n){(void 0!==n&&!we(t[e],n)||void 0===n&&!(e in t))&&be(t,e,n)};var As=function(t){return m(t)&&Pe(t)};var Ms=function(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]};var ks=function(t){return Ce(t,mn(t))};var Ps=function(t,e,n,r,i,o,a){var s=Ms(t,n),u=Ms(e,n),l=a.get(u);if(l)Ts(t,n,l);else{var c=o?o(s,u,n+"",t,e,a):void 0,p=void 0===c;if(p){var h=x(u),f=!h&&We(u),d=!h&&!f&&en(u);c=u,h||f||d?x(s)?c=s:As(s)?c=kt(s):f?(p=!1,c=po(u,!0)):d?(p=!1,c=Ko(u,!0)):c=[]:Ar(u)||je(u)?(c=s,je(s)?c=ks(s):P(s)&&!U(s)||(c=Jo(u))):p=!1}p&&(a.set(u,c),i(c,u,r,o,a),a.delete(u)),Ts(t,n,c)}};var Os=function t(e,n,r,i,o){e!==n&&rs(n,(function(a,s){if(o||(o=new io),P(a))Ps(e,n,s,r,t,i,o);else{var u=i?i(Ms(e,s),a,s+"",e,n,o):void 0;void 0===u&&(u=a),Ts(e,s,u)}}),mn)};var Ls=function t(e,n,r,i,o,a){return P(e)&&P(n)&&(a.set(n,e),Os(e,n,void 0,t,a),a.delete(n)),e},Is=Le((function(t,e,n,r){Os(t,e,n,r)})),Rs=Is,Ds=Me((function(t){return t.push(void 0,Ls),ht(Rs,void 0,t)}));var Ns=function(t,e,n){if("function"!=typeof t)throw new TypeError("Expected a function");return setTimeout((function(){t.apply(void 0,n)}),e)},Zs=Me((function(t,e){return Ns(t,1,e)})),zs=Zs,Fs=Me((function(t,e,n){return Ns(t,D(e)||0,n)})),Bs=Fs;var js=function(t,e,n){for(var r=-1,i=null==t?0:t.length;++r<i;)if(n(e,t[r]))return!0;return!1};var Us=function(t,e,n,r){var i=-1,o=$t,a=!0,s=t.length,u=[],l=e.length;if(!s)return u;n&&(e=_(e,Ye(n))),r?(o=js,a=!1):e.length>=200&&(o=wa,a=!1,e=new xa(e));t:for(;++i<s;){var c=t[i],p=null==n?c:n(c);if(c=r||0!==c?c:0,a&&p==p){for(var h=l;h--;)if(e[h]===p)continue t;u.push(c)}else o(e,p,r)||u.push(c)}return u},Vs=Me((function(t,e){return As(t)?Us(t,yr(e,1,As,!0)):[]})),Gs=Vs;var Hs=function(t){var e=null==t?0:t.length;return e?t[e-1]:void 0},Ws=Me((function(t,e){var n=Hs(e);return As(n)&&(n=void 0),As(t)?Us(t,yr(e,1,As,!0),Ya(n,2)):[]})),qs=Ws,Xs=Me((function(t,e){var n=Hs(e);return As(n)&&(n=void 0),As(t)?Us(t,yr(e,1,As,!0),void 0,n):[]})),Ys=Xs,Ks=E((function(t,e){return t/e}),1);var Qs=function(t,e,n){var r=null==t?0:t.length;return r?(e=n||void 0===e?1:z(e),Zr(t,e<0?0:e,r)):[]};var Js=function(t,e,n){var r=null==t?0:t.length;return r?(e=n||void 0===e?1:z(e),Zr(t,0,(e=r-e)<0?0:e)):[]};var $s=function(t,e,n,r){for(var i=t.length,o=r?i:-1;(r?o--:++o<i)&&e(t[o],o,t););return n?Zr(t,r?0:o,r?o+1:i):Zr(t,r?o+1:0,r?i:o)};var tu=function(t,e){return t&&t.length?$s(t,Ya(e,3),!0,!0):[]};var eu=function(t,e){return t&&t.length?$s(t,Ya(e,3),!0):[]};var nu=function(t){return"function"==typeof t?t:B};var ru=function(t,e){return(x(t)?Xt:as)(t,nu(e))};var iu=function(t,e){for(var n=null==t?0:t.length;n--&&!1!==e(t[n],n,t););return t},ou=ns(!0);var au=function(t,e){return t&&ou(t,e,ln)},su=os(au,!0);var uu=function(t,e){return(x(t)?iu:su)(t,nu(e))};var lu=function(t,e,n){t=ur(t),e=S(e);var r=t.length,i=n=void 0===n?r:Ki(z(n),0,r);return(n-=e.length)>=0&&t.slice(n,i)==e};var cu=function(t,e){return _(e,(function(e){return[e,t[e]]}))};var pu=function(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=[t,t]})),n};var hu=function(t){return function(e){var n=Fo(e);return"[object Map]"==n?Ea(e):"[object Set]"==n?pu(e):cu(e,t(e))}},fu=hu(ln),du=hu(mn),vu=oi({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}),mu=/[&<>"']/g,yu=RegExp(mu.source);var gu=function(t){return(t=ur(t))&&yu.test(t)?t.replace(mu,vu):t},_u=/[\\^$.*+?()[\]{}|]/g,xu=RegExp(_u.source);var bu=function(t){return(t=ur(t))&&xu.test(t)?t.replace(_u,"\\$&"):t};var wu=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0};var Su=function(t,e){var n=!0;return as(t,(function(t,r,i){return n=!!e(t,r,i)})),n};var Eu=function(t,e,n){var r=x(t)?wu:Su;return n&&Oe(t,e,n)&&(e=void 0),r(t,Ya(e,3))};var Cu=function(t){return t?Ki(z(t),0,4294967295):0};var Tu=function(t,e,n,r){var i=t.length;for((n=z(n))<0&&(n=-n>i?0:i+n),(r=void 0===r||r>i?i:z(r))<0&&(r+=i),r=n>r?0:Cu(r);n<r;)t[n++]=e;return t};var Au=function(t,e,n,r){var i=null==t?0:t.length;return i?(n&&"number"!=typeof n&&Oe(t,e,n)&&(n=0,r=i),Tu(t,e,n,r)):[]};var Mu=function(t,e){var n=[];return as(t,(function(t,r,i){e(t,r,i)&&n.push(t)})),n};var ku=function(t,e){return(x(t)?ho:Mu)(t,Ya(e,3))};var Pu=function(t){return function(e,n,r){var i=Object(e);if(!Pe(e)){var o=Ya(n,3);e=ln(e),n=function(t){return o(i[t],t,i)}}var a=t(e,n,r);return a>-1?i[o?e[a]:a]:void 0}},Ou=Math.max;var Lu=function(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:z(n);return i<0&&(i=Ou(r+i,0)),Yt(t,Ya(e,3),i)},Iu=Pu(Lu);var Ru=function(t,e,n){var r;return n(t,(function(t,n,i){if(e(t,n,i))return r=n,!1})),r};var Du=function(t,e){return Ru(t,Ya(e,3),is)},Nu=Math.max,Zu=Math.min;var zu=function(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=r-1;return void 0!==n&&(i=z(n),i=n<0?Nu(r+i,0):Zu(i,r-1)),Yt(t,Ya(e,3),i,!0)},Fu=Pu(zu);var Bu=function(t,e){return Ru(t,Ya(e,3),au)};var ju=function(t){return t&&t.length?t[0]:void 0};var Uu=function(t,e){var n=-1,r=Pe(t)?Array(t.length):[];return as(t,(function(t,i,o){r[++n]=e(t,i,o)})),r};var Vu=function(t,e){return(x(t)?_:Uu)(t,Ya(e,3))};var Gu=function(t,e){return yr(Vu(t,e),1)};var Hu=function(t,e){return yr(Vu(t,e),Infinity)};var Wu=function(t,e,n){return n=void 0===n?1:z(n),yr(Vu(t,e),n)};var qu=function(t){return(null==t?0:t.length)?yr(t,Infinity):[]};var Xu=function(t,e){return(null==t?0:t.length)?(e=void 0===e?1:z(e),yr(t,e)):[]};var Yu=function(t){return _e(t,512)},Ku=Gi("floor");var Qu=function(t){return _r((function(e){var n=e.length,r=n,i=Mt.prototype.thru;for(t&&e.reverse();r--;){var o=e[r];if("function"!=typeof o)throw new TypeError("Expected a function");if(i&&!a&&"wrapper"==Tt(o))var a=new Mt([],!0)}for(r=a?r:n;++r<n;){o=e[r];var s=Tt(o),u="wrapper"==s?St(o):void 0;a=u&&Rt(u[0])&&424==u[1]&&!u[4].length&&1==u[9]?a[Tt(u[0])].apply(a,u[3]):1==o.length&&Rt(o)?a[s]():a.thru(o)}return function(){var t=arguments,r=t[0];if(a&&1==t.length&&x(r))return a.plant(r).value();for(var i=0,o=n?e[i].apply(this,t):r;++i<n;)o=e[i].call(this,o);return o}}))},Ju=Qu(),$u=Qu(!0);var tl=function(t,e){return null==t?t:rs(t,nu(e),mn)};var el=function(t,e){return null==t?t:ou(t,nu(e),mn)};var nl=function(t,e){return t&&is(t,nu(e))};var rl=function(t,e){return t&&au(t,nu(e))};var il=function(t){for(var e=-1,n=null==t?0:t.length,r={};++e<n;){var i=t[e];r[i[0]]=i[1]}return r};var ol=function(t,e){return ho(e,(function(e){return U(t[e])}))};var al=function(t){return null==t?[]:ol(t,ln(t))};var sl=function(t){return null==t?[]:ol(t,mn(t))},ul=Object.prototype.hasOwnProperty,ll=us((function(t,e,n){ul.call(t,n)?t[n].push(e):be(t,n,[e])})),cl=ll;var pl=function(t,e){return t>e};var hl=function(t){return function(e,n){return"string"==typeof e&&"string"==typeof n||(e=D(e),n=D(n)),t(e,n)}},fl=hl(pl),dl=hl((function(t,e){return t>=e})),vl=Object.prototype.hasOwnProperty;var ml=function(t,e){return null!=t&&vl.call(t,e)};var yl=function(t,e){return null!=t&&Va(t,e,ml)},gl=Math.max,_l=Math.min;var xl=function(t,e,n){return t>=_l(e,n)&&t<gl(e,n)};var bl=function(t,e,n){return e=Z(e),void 0===n?(n=e,e=0):n=Z(n),t=D(t),xl(t,e,n)};var wl=function(t){return"string"==typeof t||!x(t)&&m(t)&&"[object String]"==v(t)};var Sl=function(t,e){return _(e,(function(e){return t[e]}))};var El=function(t){return null==t?[]:Sl(t,ln(t))},Cl=Math.max;var Tl=function(t,e,n,r){t=Pe(t)?t:El(t),n=n&&!r?z(n):0;var i=t.length;return n<0&&(n=Cl(i+n,0)),wl(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&Jt(t,e,n)>-1},Al=Math.max;var Ml=function(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:z(n);return i<0&&(i=Al(r+i,0)),Jt(t,e,i)};var kl=function(t){return(null==t?0:t.length)?Zr(t,0,-1):[]},Pl=Math.min;var Ol=function(t,e,n){for(var r=n?js:$t,i=t[0].length,o=t.length,a=o,s=Array(o),u=1/0,l=[];a--;){var c=t[a];a&&e&&(c=_(c,Ye(e))),u=Pl(c.length,u),s[a]=!n&&(e||i>=120&&c.length>=120)?new xa(a&&c):void 0}c=t[0];var p=-1,h=s[0];t:for(;++p<i&&l.length<u;){var f=c[p],d=e?e(f):f;if(f=n||0!==f?f:0,!(h?wa(h,d):r(l,d,n))){for(a=o;--a;){var v=s[a];if(!(v?wa(v,d):r(t[a],d,n)))continue t}h&&h.push(d),l.push(f)}}return l};var Ll=function(t){return As(t)?t:[]},Il=Me((function(t){var e=_(t,Ll);return e.length&&e[0]===t[0]?Ol(e):[]})),Rl=Me((function(t){var e=Hs(t),n=_(t,Ll);return e===Hs(n)?e=void 0:n.pop(),n.length&&n[0]===t[0]?Ol(n,Ya(e,2)):[]})),Dl=Rl,Nl=Me((function(t){var e=Hs(t),n=_(t,Ll);return(e="function"==typeof e?e:void 0)&&n.pop(),n.length&&n[0]===t[0]?Ol(n,void 0,e):[]}));var Zl=function(t,e,n,r){return is(t,(function(t,i,o){e(r,n(t),i,o)})),r};var zl=function(t,e){return function(n,r){return Zl(n,t,e(r),{})}},Fl=Object.prototype.toString,Bl=zl((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=Fl.call(e)),t[e]=n}),Vt(B)),jl=Bl,Ul=Object.prototype,Vl=Ul.hasOwnProperty,Gl=Ul.toString,Hl=zl((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=Gl.call(e)),Vl.call(t,e)?t[e].push(n):t[e]=[n]}),Ya),Wl=Hl;var ql=function(t,e){return e.length<2?t:pr(t,Zr(e,0,-1))};var Xl=function(t,e,n){e=lr(e,t);var r=null==(t=ql(t,e))?t:t[cr(Hs(e))];return null==r?void 0:ht(r,t,n)},Yl=Me(Xl),Kl=Me((function(t,e,n){var r=-1,i="function"==typeof e,o=Pe(t)?Array(t.length):[];return as(t,(function(t){o[++r]=i?ht(e,t,n):Xl(t,e,n)})),o})),Ql=Kl;var Jl=function(t){return m(t)&&"[object ArrayBuffer]"==v(t)},$l=$e&&$e.isArrayBuffer,tc=$l?Ye($l):Jl;var ec=function(t){return!0===t||!1===t||m(t)&&"[object Boolean]"==v(t)};var nc=function(t){return m(t)&&"[object Date]"==v(t)},rc=$e&&$e.isDate,ic=rc?Ye(rc):nc;var oc=function(t){return m(t)&&1===t.nodeType&&!Ar(t)},ac=Object.prototype.hasOwnProperty;var sc=function(t){if(null==t)return!0;if(Pe(t)&&(x(t)||"string"==typeof t||"function"==typeof t.splice||We(t)||en(t)||je(t)))return!t.length;var e=Fo(t);if("[object Map]"==e||"[object Set]"==e)return!t.size;if(Re(t))return!un(t).length;for(var n in t)if(ac.call(t,n))return!1;return!0};var uc=function(t,e){return Na(t,e)};var lc=function(t,e,n){var r=(n="function"==typeof n?n:void 0)?n(t,e):void 0;return void 0===r?Na(t,e,void 0,n):!!r},cc=o.isFinite;var pc=function(t){return"number"==typeof t&&cc(t)};var hc=function(t){return"number"==typeof t&&t==z(t)};var fc=function(t,e){return t===e||Za(t,e,Fa(e))};var dc=function(t,e,n){return n="function"==typeof n?n:void 0,Za(t,e,Fa(e),n)};var vc=function(t){return"number"==typeof t||m(t)&&"[object Number]"==v(t)};var mc=function(t){return vc(t)&&t!=+t},yc=V?U:Ue;var gc=function(t){if(yc(t))throw new Error("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return tt(t)};var _c=function(t){return null==t};var xc=function(t){return null===t};var bc=function(t){return m(t)&&"[object RegExp]"==v(t)},wc=$e&&$e.isRegExp,Sc=wc?Ye(wc):bc,Ec=9007199254740991;var Cc=function(t){return hc(t)&&t>=-9007199254740991&&t<=Ec};var Tc=function(t){return void 0===t};var Ac=function(t){return m(t)&&"[object WeakMap]"==Fo(t)};var Mc=function(t){return m(t)&&"[object WeakSet]"==v(t)};var kc=function(t){return Ya("function"==typeof t?t:la(t,1))},Pc=Array.prototype.join;var Oc=function(t,e){return null==t?"":Pc.call(t,e)},Lc=zi((function(t,e,n){return t+(n?"-":"")+e.toLowerCase()})),Ic=Lc,Rc=us((function(t,e,n){be(t,n,e)})),Dc=Rc;var Nc=function(t,e,n){for(var r=n+1;r--;)if(t[r]===e)return r;return r},Zc=Math.max,zc=Math.min;var Fc=function(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=r;return void 0!==n&&(i=(i=z(n))<0?Zc(r+i,0):zc(i,r-1)),e==e?Nc(t,e,i):Yt(t,Kt,i,!0)},Bc=zi((function(t,e,n){return t+(n?" ":"")+e.toLowerCase()})),jc=Bc,Uc=ei("toLowerCase");var Vc=function(t,e){return t<e},Gc=hl(Vc),Hc=hl((function(t,e){return t<=e}));var Wc=function(t,e){var n={};return e=Ya(e,3),is(t,(function(t,r,i){be(n,e(t,r,i),t)})),n};var qc=function(t,e){var n={};return e=Ya(e,3),is(t,(function(t,r,i){be(n,r,e(t,r,i))})),n};var Xc=function(t){return ja(la(t,1))};var Yc=function(t,e){return Ha(t,la(e,1))};var Kc=function(t,e,n){for(var r=-1,i=t.length;++r<i;){var o=t[r],a=e(o);if(null!=a&&(void 0===s?a==a&&!y(a):n(a,s)))var s=a,u=o}return u};var Qc=function(t){return t&&t.length?Kc(t,B,pl):void 0};var Jc=function(t,e){return t&&t.length?Kc(t,Ya(e,2),pl):void 0};var $c=function(t,e){for(var n,r=-1,i=t.length;++r<i;){var o=e(t[r]);void 0!==o&&(n=void 0===n?o:n+o)}return n};var tp=function(t,e){var n=null==t?0:t.length;return n?$c(t,e)/n:NaN};var ep=function(t){return tp(t,B)};var np=function(t,e){return tp(t,Ya(e,2))},rp=Le((function(t,e,n){Os(t,e,n)})),ip=rp,op=Me((function(t,e){return function(n){return Xl(n,t,e)}})),ap=Me((function(t,e){return function(n){return Xl(t,n,e)}}));var sp=function(t){return t&&t.length?Kc(t,B,Vc):void 0};var up=function(t,e){return t&&t.length?Kc(t,Ya(e,2),Vc):void 0};var lp=function(t,e,n){var r=ln(e),i=ol(e,r),o=!(P(n)&&"chain"in n&&!n.chain),a=U(t);return Xt(i,(function(n){var r=e[n];t[n]=r,a&&(t.prototype[n]=function(){var e=this.__chain__;if(o||e){var n=t(this.__wrapped__),i=n.__actions__=kt(this.__actions__);return i.push({func:r,args:arguments,thisArg:t}),n.__chain__=e,n}return r.apply(t,dr([this.value()],arguments))})})),t},cp=E((function(t,e){return t*e}),1);var pp=function(t){if("function"!=typeof t)throw new TypeError("Expected a function");return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}};var hp=function(t){for(var e,n=[];!(e=t.next()).done;)n.push(e.value);return n},fp=a?a.iterator:void 0;var dp=function(t){if(!t)return[];if(Pe(t))return wl(t)?ti(t):kt(t);if(fp&&t[fp])return hp(t[fp]());var e=Fo(t);return("[object Map]"==e?Ea:"[object Set]"==e?Ca:El)(t)};var vp=function(){void 0===this.__values__&&(this.__values__=dp(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?void 0:this.__values__[this.__index__++]}};var mp=function(t,e){var n=t.length;if(n)return ae(e+=e<0?n:0,n)?t[e]:void 0};var yp=function(t,e){return t&&t.length?mp(t,z(e)):void 0};var gp=function(t){return t=z(t),Me((function(e){return mp(e,t)}))};var _p=function(t,e){return e=lr(e,t),null==(t=ql(t,e))||delete t[cr(Hs(e))]};var xp=function(t){return Ar(t)?void 0:t},bp=_r((function(t,e){var n={};if(null==t)return n;var r=!1;e=_(e,(function(e){return e=lr(e,t),r||(r=e.length>1),e})),Ce(t,Eo(t),n),r&&(n=la(n,7,xp));for(var i=e.length;i--;)_p(n,e[i]);return n})),wp=bp;var Sp=function(t,e,n,r){if(!P(t))return t;for(var i=-1,o=(e=lr(e,t)).length,a=o-1,s=t;null!=s&&++i<o;){var u=cr(e[i]),l=n;if("__proto__"===u||"constructor"===u||"prototype"===u)return t;if(i!=a){var c=s[u];void 0===(l=r?r(c,u,s):void 0)&&(l=P(c)?c:ae(e[i+1])?[]:{})}Ee(s,u,l),s=s[u]}return t};var Ep=function(t,e,n){for(var r=-1,i=e.length,o={};++r<i;){var a=e[r],s=pr(t,a);n(s,a)&&Sp(o,lr(a,t),s)}return o};var Cp=function(t,e){if(null==t)return{};var n=_(Eo(t),(function(t){return[t]}));return e=Ya(e),Ep(t,n,(function(t,n){return e(t,n[0])}))};var Tp=function(t,e){return Cp(t,pp(Ya(e)))};var Ap=function(t){return Or(2,t)};var Mp=function(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t};var kp=function(t,e){if(t!==e){var n=void 0!==t,r=null===t,i=t==t,o=y(t),a=void 0!==e,s=null===e,u=e==e,l=y(e);if(!s&&!l&&!o&&t>e||o&&a&&u&&!s&&!l||r&&a&&u||!n&&u||!i)return 1;if(!r&&!o&&!l&&t<e||l&&n&&i&&!r&&!o||s&&n&&i||!a&&i||!u)return-1}return 0};var Pp=function(t,e,n){for(var r=-1,i=t.criteria,o=e.criteria,a=i.length,s=n.length;++r<a;){var u=kp(i[r],o[r]);if(u)return r>=s?u:u*("desc"==n[r]?-1:1)}return t.index-e.index};var Op=function(t,e,n){e=e.length?_(e,(function(t){return x(t)?function(e){return pr(e,1===t.length?t[0]:t)}:t})):[B];var r=-1;e=_(e,Ye(Ya));var i=Uu(t,(function(t,n,i){var o=_(e,(function(e){return e(t)}));return{criteria:o,index:++r,value:t}}));return Mp(i,(function(t,e){return Pp(t,e,n)}))};var Lp=function(t,e,n,r){return null==t?[]:(x(e)||(e=null==e?[]:[e]),x(n=r?void 0:n)||(n=null==n?[]:[n]),Op(t,e,n))};var Ip=function(t){return _r((function(e){return e=_(e,Ye(Ya)),Me((function(n){var r=this;return t(e,(function(t){return ht(t,r,n)}))}))}))},Rp=Ip(_),Dp=Me,Np=Math.min,Zp=Dp((function(t,e){var n=(e=1==e.length&&x(e[0])?_(e[0],Ye(Ya)):_(yr(e,1),Ye(Ya))).length;return Me((function(r){for(var i=-1,o=Np(r.length,n);++i<o;)r[i]=e[i].call(this,r[i]);return ht(t,this,r)}))})),zp=Zp,Fp=Ip(wu),Bp=Ip(ba),jp=Math.floor;var Up=function(t,e){var n="";if(!t||e<1||e>9007199254740991)return n;do{e%2&&(n+=t),(e=jp(e/2))&&(t+=t)}while(e);return n},Vp=Wa("length"),Gp="[\\ud800-\\udfff]",Hp="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",Wp="\\ud83c[\\udffb-\\udfff]",qp="[^\\ud800-\\udfff]",Xp="(?:\\ud83c[\\udde6-\\uddff]){2}",Yp="[\\ud800-\\udbff][\\udc00-\\udfff]",Kp="(?:"+Hp+"|"+Wp+")"+"?",Qp="[\\ufe0e\\ufe0f]?",Jp=Qp+Kp+("(?:\\u200d(?:"+[qp,Xp,Yp].join("|")+")"+Qp+Kp+")*"),$p="(?:"+[qp+Hp+"?",Hp,Xp,Yp,Gp].join("|")+")",th=RegExp("\\ud83c[\\udffb-\\udfff](?=\\ud83c[\\udffb-\\udfff])|"+$p+Jp,"g");var eh=function(t){for(var e=th.lastIndex=0;th.test(t);)++e;return e};var nh=function(t){return Br(t)?eh(t):Vp(t)},rh=Math.ceil;var ih=function(t,e){var n=(e=void 0===e?" ":S(e)).length;if(n<2)return n?Up(e,t):e;var r=Up(e,rh(t/nh(e)));return Br(e)?zr(ti(r),0,t).join(""):r.slice(0,t)},oh=Math.ceil,ah=Math.floor;var sh=function(t,e,n){t=ur(t);var r=(e=z(e))?nh(t):0;if(!e||r>=e)return t;var i=(e-r)/2;return ih(ah(i),n)+t+ih(oh(i),n)};var uh=function(t,e,n){t=ur(t);var r=(e=z(e))?nh(t):0;return e&&r<e?t+ih(e-r,n):t};var lh=function(t,e,n){t=ur(t);var r=(e=z(e))?nh(t):0;return e&&r<e?ih(e-r,n)+t:t},ch=/^\s+/,ph=o.parseInt;var hh=function(t,e,n){return n||null==e?e=0:e&&(e=+e),ph(ur(t).replace(ch,""),e||0)},fh=Me((function(t,e){var n=ce(e,ie(fh));return _e(t,32,void 0,e,n)}));fh.placeholder={};var dh=fh,vh=Me((function(t,e){var n=ce(e,ie(vh));return _e(t,64,void 0,e,n)}));vh.placeholder={};var mh=vh,yh=us((function(t,e,n){t[n?0:1].push(e)}),(function(){return[[],[]]})),gh=yh;var _h=function(t,e){return Ep(t,e,(function(e,n){return Ga(t,n)}))},xh=_r((function(t,e){return null==t?{}:_h(t,e)}));var bh=function(t){for(var e,n=this;n instanceof gt;){var r=Pt(n);r.__index__=0,r.__values__=void 0,e?i.__wrapped__=r:e=r;var i=r;n=n.__wrapped__}return i.__wrapped__=t,e};var wh=function(t){return function(e){return null==t?void 0:pr(t,e)}};var Sh=function(t,e,n,r){for(var i=n-1,o=t.length;++i<o;)if(r(t[i],e))return i;return-1},Eh=Array.prototype.splice;var Ch=function(t,e,n,r){var i=r?Sh:Jt,o=-1,a=e.length,s=t;for(t===e&&(e=kt(e)),n&&(s=_(t,Ye(n)));++o<a;)for(var u=0,l=e[o],c=n?n(l):l;(u=i(s,c,u,r))>-1;)s!==t&&Eh.call(s,u,1),Eh.call(t,u,1);return t};var Th=function(t,e){return t&&t.length&&e&&e.length?Ch(t,e):t},Ah=Me(Th);var Mh=function(t,e,n){return t&&t.length&&e&&e.length?Ch(t,e,Ya(n,2)):t};var kh=function(t,e,n){return t&&t.length&&e&&e.length?Ch(t,e,void 0,n):t},Ph=Array.prototype.splice;var Oh=function(t,e){for(var n=t?e.length:0,r=n-1;n--;){var i=e[n];if(n==r||i!==o){var o=i;ae(i)?Ph.call(t,i,1):_p(t,i)}}return t},Lh=_r((function(t,e){var n=null==t?0:t.length,r=fr(t,e);return Oh(t,_(e,(function(t){return ae(t,n)?+t:t})).sort(kp)),r})),Ih=Lh,Rh=Math.floor,Dh=Math.random;var Nh=function(t,e){return t+Rh(Dh()*(e-t+1))},Zh=parseFloat,zh=Math.min,Fh=Math.random;var Bh=function(t,e,n){if(n&&"boolean"!=typeof n&&Oe(t,e,n)&&(e=n=void 0),void 0===n&&("boolean"==typeof e?(n=e,e=void 0):"boolean"==typeof t&&(n=t,t=void 0)),void 0===t&&void 0===e?(t=0,e=1):(t=Z(t),void 0===e?(e=t,t=0):e=Z(e)),t>e){var r=t;t=e,e=r}if(n||t%1||e%1){var i=Fh();return zh(t+i*(e-t+Zh("1e-"+((i+"").length-1))),e)}return Nh(t,e)},jh=Math.ceil,Uh=Math.max;var Vh=function(t,e,n,r){for(var i=-1,o=Uh(jh((e-t)/(n||1)),0),a=Array(o);o--;)a[r?o:++i]=t,t+=n;return a};var Gh=function(t){return function(e,n,r){return r&&"number"!=typeof r&&Oe(e,n,r)&&(n=r=void 0),e=Z(e),void 0===n?(n=e,e=0):n=Z(n),r=void 0===r?e<n?1:-1:Z(r),Vh(e,n,r,t)}},Hh=Gh(),Wh=Gh(!0),qh=_r((function(t,e){return _e(t,256,void 0,void 0,void 0,e)})),Xh=qh;var Yh=function(t,e,n,r,i){return i(t,(function(t,i,o){n=r?(r=!1,t):e(n,t,i,o)})),n};var Kh=function(t,e,n){var r=x(t)?ii:Yh,i=arguments.length<3;return r(t,Ya(e,4),n,i,as)};var Qh=function(t,e,n,r){var i=null==t?0:t.length;for(r&&i&&(n=t[--i]);i--;)n=e(n,t[i],i,t);return n};var Jh=function(t,e,n){var r=x(t)?Qh:Yh,i=arguments.length<3;return r(t,Ya(e,4),n,i,su)};var $h=function(t,e){return(x(t)?ho:Mu)(t,pp(Ya(e,3)))};var tf=function(t,e){var n=[];if(!t||!t.length)return n;var r=-1,i=[],o=t.length;for(e=Ya(e,3);++r<o;){var a=t[r];e(a,r,t)&&(n.push(a),i.push(r))}return Oh(t,i),n};var ef=function(t,e,n){return e=(n?Oe(t,e,n):void 0===e)?1:z(e),Up(ur(t),e)};var nf=function(){var t=arguments,e=ur(t[0]);return t.length<3?e:e.replace(t[1],t[2])};var rf=function(t,e){if("function"!=typeof t)throw new TypeError("Expected a function");return e=void 0===e?e:z(e),Me(t,e)};var of=function(t,e,n){var r=-1,i=(e=lr(e,t)).length;for(i||(i=1,t=void 0);++r<i;){var o=null==t?void 0:t[cr(e[r])];void 0===o&&(r=i,o=n),t=U(o)?o.call(t):o}return t},af=Array.prototype.reverse;var sf=function(t){return null==t?t:af.call(t)},uf=Gi("round");var lf=function(t){var e=t.length;return e?t[Nh(0,e-1)]:void 0};var cf=function(t){return lf(El(t))};var pf=function(t){return(x(t)?lf:cf)(t)};var hf=function(t,e){var n=-1,r=t.length,i=r-1;for(e=void 0===e?r:e;++n<e;){var o=Nh(n,i),a=t[o];t[o]=t[n],t[n]=a}return t.length=e,t};var ff=function(t,e){return hf(kt(t),Ki(e,0,t.length))};var df=function(t,e){var n=El(t);return hf(n,Ki(e,0,n.length))};var vf=function(t,e,n){return e=(n?Oe(t,e,n):void 0===e)?1:z(e),(x(t)?ff:df)(t,e)};var mf=function(t,e,n){return null==t?t:Sp(t,e,n)};var yf=function(t,e,n,r){return r="function"==typeof r?r:void 0,null==t?t:Sp(t,e,n,r)};var gf=function(t){return hf(kt(t))};var _f=function(t){return hf(El(t))};var xf=function(t){return(x(t)?gf:_f)(t)};var bf=function(t){if(null==t)return 0;if(Pe(t))return wl(t)?nh(t):t.length;var e=Fo(t);return"[object Map]"==e||"[object Set]"==e?t.size:un(t).length};var wf=function(t,e,n){var r=null==t?0:t.length;return r?(n&&"number"!=typeof n&&Oe(t,e,n)?(e=0,n=r):(e=null==e?0:z(e),n=void 0===n?r:z(n)),Zr(t,e,n)):[]},Sf=zi((function(t,e,n){return t+(n?"_":"")+e.toLowerCase()})),Ef=Sf;var Cf=function(t,e){var n;return as(t,(function(t,r,i){return!(n=e(t,r,i))})),!!n};var Tf=function(t,e,n){var r=x(t)?ba:Cf;return n&&Oe(t,e,n)&&(e=void 0),r(t,Ya(e,3))},Af=Me((function(t,e){if(null==t)return[];var n=e.length;return n>1&&Oe(t,e[0],e[1])?e=[]:n>2&&Oe(e[0],e[1],e[2])&&(e=[e[0]]),Op(t,yr(e,1),[])})),Mf=Math.floor,kf=Math.min;var Pf=function(t,e,n,r){var i=0,o=null==t?0:t.length;if(0===o)return 0;for(var a=(e=n(e))!=e,s=null===e,u=y(e),l=void 0===e;i<o;){var c=Mf((i+o)/2),p=n(t[c]),h=void 0!==p,f=null===p,d=p==p,v=y(p);if(a)var m=r||d;else m=l?d&&(r||h):s?d&&h&&(r||!f):u?d&&h&&!f&&(r||!v):!f&&!v&&(r?p<=e:p<e);m?i=c+1:o=c}return kf(o,4294967294)};var Of=function(t,e,n){var r=0,i=null==t?r:t.length;if("number"==typeof e&&e==e&&i<=2147483647){for(;r<i;){var o=r+i>>>1,a=t[o];null!==a&&!y(a)&&(n?a<=e:a<e)?r=o+1:i=o}return i}return Pf(t,e,B,n)};var Lf=function(t,e){return Of(t,e)};var If=function(t,e,n){return Pf(t,e,Ya(n,2))};var Rf=function(t,e){var n=null==t?0:t.length;if(n){var r=Of(t,e);if(r<n&&we(t[r],e))return r}return-1};var Df=function(t,e){return Of(t,e,!0)};var Nf=function(t,e,n){return Pf(t,e,Ya(n,2),!0)};var Zf=function(t,e){if(null==t?0:t.length){var n=Of(t,e,!0)-1;if(we(t[n],e))return n}return-1};var zf=function(t,e){for(var n=-1,r=t.length,i=0,o=[];++n<r;){var a=t[n],s=e?e(a):a;if(!n||!we(s,u)){var u=s;o[i++]=0===a?0:a}}return o};var Ff=function(t){return t&&t.length?zf(t):[]};var Bf=function(t,e){return t&&t.length?zf(t,Ya(e,2)):[]};var jf=function(t,e,n){return n&&"number"!=typeof n&&Oe(t,e,n)&&(e=n=void 0),(n=void 0===n?4294967295:n>>>0)?(t=ur(t))&&("string"==typeof e||null!=e&&!Sc(e))&&!(e=S(e))&&Br(t)?zr(ti(t),0,n):t.split(e,n):[]},Uf=Math.max;var Vf=function(t,e){if("function"!=typeof t)throw new TypeError("Expected a function");return e=null==e?0:Uf(z(e),0),Me((function(n){var r=n[e],i=zr(n,0,e);return r&&dr(i,r),ht(t,this,i)}))},Gf=zi((function(t,e,n){return t+(n?" ":"")+ni(e)})),Hf=Gf;var Wf=function(t,e,n){return t=ur(t),n=null==n?0:Ki(z(n),0,t.length),e=S(e),t.slice(n,n+e.length)==e};var qf=function(){return{}};var Xf=function(){return""};var Yf=function(){return!0},Kf=E((function(t,e){return t-e}),0);var Qf=function(t){return t&&t.length?$c(t,B):0};var Jf=function(t,e){return t&&t.length?$c(t,Ya(e,2)):0};var $f=function(t){var e=null==t?0:t.length;return e?Zr(t,1,e):[]};var td=function(t,e,n){return t&&t.length?(e=n||void 0===e?1:z(e),Zr(t,0,e<0?0:e)):[]};var ed=function(t,e,n){var r=null==t?0:t.length;return r?(e=n||void 0===e?1:z(e),Zr(t,(e=r-e)<0?0:e,r)):[]};var nd=function(t,e){return t&&t.length?$s(t,Ya(e,3),!1,!0):[]};var rd=function(t,e){return t&&t.length?$s(t,Ya(e,3)):[]};var id=function(t,e){return e(t),t},od=Object.prototype,ad=od.hasOwnProperty;var sd=function(t,e,n,r){return void 0===t||we(t,od[n])&&!ad.call(r,n)?e:t},ud={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"};var ld=function(t){return"\\"+ud[t]},cd=/<%=([\s\S]+?)%>/g,pd={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:cd,variable:"",imports:{_:{escape:gu}}},hd=/\b__p \+= '';/g,fd=/\b(__p \+=) '' \+/g,dd=/(__e\(.*?\)|\b__t\)) \+\n'';/g,vd=/[()=,{}\[\]\/\s]/,md=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,yd=/($^)/,gd=/['\n\r\u2028\u2029\\]/g,_d=Object.prototype.hasOwnProperty;var xd=function(t,e,n){var r=pd.imports._.templateSettings||pd;n&&Oe(t,e,n)&&(e=void 0),t=ur(t),e=xn({},e,r,sd);var i,o,a=xn({},e.imports,r.imports,sd),s=ln(a),u=Sl(a,s),l=0,c=e.interpolate||yd,p="__p += '",h=RegExp((e.escape||yd).source+"|"+c.source+"|"+(c===cd?md:yd).source+"|"+(e.evaluate||yd).source+"|$","g"),f=_d.call(e,"sourceURL")?"//# sourceURL="+(e.sourceURL+"").replace(/\s/g," ")+"\n":"";t.replace(h,(function(e,n,r,a,s,u){return r||(r=a),p+=t.slice(l,u).replace(gd,ld),n&&(i=!0,p+="' +\n__e("+n+") +\n'"),s&&(o=!0,p+="';\n"+s+";\n__p += '"),r&&(p+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),l=u+e.length,e})),p+="';\n";var d=_d.call(e,"variable")&&e.variable;if(d){if(vd.test(d))throw new Error("Invalid `variable` option passed into `_.template`")}else p="with (obj) {\n"+p+"\n}\n";p=(o?p.replace(hd,""):p).replace(fd,"$1").replace(dd,"$1;"),p="function("+(d||"obj")+") {\n"+(d?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(i?", __e = _.escape":"")+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+p+"return __p\n}";var v=Pr((function(){return Function(s,f+"return "+p).apply(void 0,u)}));if(v.source=p,Mr(v))throw v;return v};var bd=function(t,e,n){var r=!0,i=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return P(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),xs(t,e,{leading:r,maxWait:e,trailing:i})};var wd=function(t,e){return e(t)},Sd=4294967295,Ed=Math.min;var Cd=function(t,e){if((t=z(t))<1||t>9007199254740991)return[];var n=Sd,r=Ed(t,Sd);e=nu(e),t-=Sd;for(var i=De(r,e);++n<t;)e(n);return i};var Td=function(){return this};var Ad=function(t,e){var n=t;return n instanceof xt&&(n=n.value()),ii(e,(function(t,e){return e.func.apply(e.thisArg,dr([t],e.args))}),n)};var Md=function(){return Ad(this.__wrapped__,this.__actions__)};var kd=function(t){return ur(t).toLowerCase()};var Pd=function(t){return x(t)?_(t,cr):y(t)?[t]:kt(sr(ur(t)))},Od=9007199254740991;var Ld=function(t){return t?Ki(z(t),-9007199254740991,Od):0===t?t:0};var Id=function(t){return ur(t).toUpperCase()};var Rd=function(t,e,n){var r=x(t),i=r||We(t)||en(t);if(e=Ya(e,4),null==n){var o=t&&t.constructor;n=i?r?new o:[]:P(t)&&U(o)?lt(br(t)):{}}return(i?Xt:is)(t,(function(t,r,i){return e(n,t,r,i)})),n};var Dd=function(t,e){for(var n=t.length;n--&&Jt(e,t[n],0)>-1;);return n};var Nd=function(t,e){for(var n=-1,r=t.length;++n<r&&Jt(e,t[n],0)>-1;);return n};var Zd=function(t,e,n){if((t=ur(t))&&(n||void 0===e))return k(t);if(!t||!(e=S(e)))return t;var r=ti(t),i=ti(e),o=Nd(r,i),a=Dd(r,i)+1;return zr(r,o,a).join("")};var zd=function(t,e,n){if((t=ur(t))&&(n||void 0===e))return t.slice(0,A(t)+1);if(!t||!(e=S(e)))return t;var r=ti(t),i=Dd(r,ti(e))+1;return zr(r,0,i).join("")},Fd=/^\s+/;var Bd=function(t,e,n){if((t=ur(t))&&(n||void 0===e))return t.replace(Fd,"");if(!t||!(e=S(e)))return t;var r=ti(t),i=Nd(r,ti(e));return zr(r,i).join("")},jd=/\w*$/;var Ud=function(t,e){var n=30,r="...";if(P(e)){var i="separator"in e?e.separator:i;n="length"in e?z(e.length):n,r="omission"in e?S(e.omission):r}var o=(t=ur(t)).length;if(Br(t)){var a=ti(t);o=a.length}if(n>=o)return t;var s=n-nh(r);if(s<1)return r;var u=a?zr(a,0,s).join(""):t.slice(0,s);if(void 0===i)return u+r;if(a&&(s+=u.length-s),Sc(i)){if(t.slice(s).search(i)){var l,c=u;for(i.global||(i=RegExp(i.source,ur(jd.exec(i))+"g")),i.lastIndex=0;l=i.exec(c);)var p=l.index;u=u.slice(0,void 0===p?s:p)}}else if(t.indexOf(S(i),s)!=s){var h=u.lastIndexOf(i);h>-1&&(u=u.slice(0,h))}return u+r};var Vd=function(t){return xe(t,1)},Gd=oi({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),Hd=/&(?:amp|lt|gt|quot|#39);/g,Wd=RegExp(Hd.source);var qd=function(t){return(t=ur(t))&&Wd.test(t)?t.replace(Hd,Gd):t},Xd=Ao&&1/Ca(new Ao([,-0]))[1]==1/0?function(t){return new Ao(t)}:bt,Yd=Xd;var Kd=function(t,e,n){var r=-1,i=$t,o=t.length,a=!0,s=[],u=s;if(n)a=!1,i=js;else if(o>=200){var l=e?null:Yd(t);if(l)return Ca(l);a=!1,i=wa,u=new xa}else u=e?[]:s;t:for(;++r<o;){var c=t[r],p=e?e(c):c;if(c=n||0!==c?c:0,a&&p==p){for(var h=u.length;h--;)if(u[h]===p)continue t;e&&u.push(p),s.push(c)}else i(u,p,n)||(u!==s&&u.push(p),s.push(c))}return s},Qd=Me((function(t){return Kd(yr(t,1,As,!0))})),Jd=Me((function(t){var e=Hs(t);return As(e)&&(e=void 0),Kd(yr(t,1,As,!0),Ya(e,2))})),$d=Jd,tv=Me((function(t){var e=Hs(t);return e="function"==typeof e?e:void 0,Kd(yr(t,1,As,!0),void 0,e)}));var ev=function(t){return t&&t.length?Kd(t):[]};var nv=function(t,e){return t&&t.length?Kd(t,Ya(e,2)):[]};var rv=function(t,e){return e="function"==typeof e?e:void 0,t&&t.length?Kd(t,void 0,e):[]},iv=0;var ov=function(t){var e=++iv;return ur(t)+e};var av=function(t,e){return null==t||_p(t,e)},sv=Math.max;var uv=function(t){if(!t||!t.length)return[];var e=0;return t=ho(t,(function(t){if(As(t))return e=sv(t.length,e),!0})),De(e,(function(e){return _(t,Wa(e))}))};var lv=function(t,e){if(!t||!t.length)return[];var n=uv(t);return null==e?n:_(n,(function(t){return ht(e,void 0,t)}))};var cv=function(t,e,n,r){return Sp(t,e,n(pr(t,e)),r)};var pv=function(t,e,n){return null==t?t:cv(t,e,nu(n))};var hv=function(t,e,n,r){return r="function"==typeof r?r:void 0,null==t?t:cv(t,e,nu(n),r)},fv=zi((function(t,e,n){return t+(n?" ":"")+e.toUpperCase()})),dv=fv;var vv=function(t){return null==t?[]:Sl(t,mn(t))},mv=Me((function(t,e){return As(t)?Us(t,e):[]})),yv=mv;var gv=function(t,e){return dh(nu(e),t)},_v=_r((function(t){var e=t.length,n=e?t[0]:0,r=this.__wrapped__,i=function(e){return fr(e,t)};return!(e>1||this.__actions__.length)&&r instanceof xt&&ae(n)?((r=r.slice(n,+n+(e?1:0))).__actions__.push({func:wd,args:[i],thisArg:void 0}),new Mt(r,this.__chain__).thru((function(t){return e&&!t.length&&t.push(void 0),t}))):this.thru(i)}));var xv=function(){return Wi(this)};var bv=function(){var t=this.__wrapped__;if(t instanceof xt){var e=t;return this.__actions__.length&&(e=new xt(this)),(e=e.reverse()).__actions__.push({func:wd,args:[sf],thisArg:void 0}),new Mt(e,this.__chain__)}return this.thru(sf)};var wv=function(t,e,n){var r=t.length;if(r<2)return r?Kd(t[0]):[];for(var i=-1,o=Array(r);++i<r;)for(var a=t[i],s=-1;++s<r;)s!=i&&(o[i]=Us(o[i]||a,t[s],e,n));return Kd(yr(o,1),e,n)},Sv=Me((function(t){return wv(ho(t,As))})),Ev=Me((function(t){var e=Hs(t);return As(e)&&(e=void 0),wv(ho(t,As),Ya(e,2))})),Cv=Ev,Tv=Me((function(t){var e=Hs(t);return e="function"==typeof e?e:void 0,wv(ho(t,As),void 0,e)})),Av=Me(uv);var Mv=function(t,e,n){for(var r=-1,i=t.length,o=e.length,a={};++r<i;){var s=r<o?e[r]:void 0;n(a,t[r],s)}return a};var kv=function(t,e){return Mv(t||[],e||[],Ee)};var Pv=function(t,e){return Mv(t||[],e||[],Sp)},Ov=Me((function(t){var e=t.length,n=e>1?t[e-1]:void 0;return n="function"==typeof n?(t.pop(),n):void 0,lv(t,n)})),Lv=Ov,Iv={chunk:Yi,compact:va,concat:ma,difference:Gs,differenceBy:qs,differenceWith:Ys,drop:Qs,dropRight:Js,dropRightWhile:tu,dropWhile:eu,fill:Au,findIndex:Lu,findLastIndex:zu,first:ju,flatten:gr,flattenDeep:qu,flattenDepth:Xu,fromPairs:il,head:ju,indexOf:Ml,initial:kl,intersection:Il,intersectionBy:Dl,intersectionWith:Nl,join:Oc,last:Hs,lastIndexOf:Fc,nth:yp,pull:Ah,pullAll:Th,pullAllBy:Mh,pullAllWith:kh,pullAt:Ih,remove:tf,reverse:sf,slice:wf,sortedIndex:Lf,sortedIndexBy:If,sortedIndexOf:Rf,sortedLastIndex:Df,sortedLastIndexBy:Nf,sortedLastIndexOf:Zf,sortedUniq:Ff,sortedUniqBy:Bf,tail:$f,take:td,takeRight:ed,takeRightWhile:nd,takeWhile:rd,union:Qd,unionBy:$d,unionWith:tv,uniq:ev,uniqBy:nv,uniqWith:rv,unzip:uv,unzipWith:lv,without:yv,xor:Sv,xorBy:Cv,xorWith:Tv,zip:Av,zipObject:kv,zipObjectDeep:Pv,zipWith:Lv},Rv={countBy:ps,each:ru,eachRight:uu,every:Eu,filter:ku,find:Iu,findLast:Fu,flatMap:Gu,flatMapDeep:Hu,flatMapDepth:Wu,forEach:ru,forEachRight:uu,groupBy:cl,includes:Tl,invokeMap:Ql,keyBy:Dc,map:Vu,orderBy:Lp,partition:gh,reduce:Kh,reduceRight:Jh,reject:$h,sample:pf,sampleSize:vf,shuffle:xf,size:bf,some:Tf,sortBy:Af},Dv={now:ys},Nv={after:F,ary:xe,before:Or,bind:Ir,bindKey:Nr,curry:ds,curryRight:ms,debounce:xs,defer:zs,delay:Bs,flip:Yu,memoize:nr,negate:pp,once:Ap,overArgs:zp,partial:dh,partialRight:mh,rearg:Xh,rest:rf,spread:Vf,throttle:bd,unary:Vd,wrap:gv},Zv={castArray:ji,clone:ca,cloneDeep:pa,cloneDeepWith:ha,cloneWith:fa,conformsTo:ts,eq:we,gt:fl,gte:dl,isArguments:je,isArray:x,isArrayBuffer:tc,isArrayLike:Pe,isArrayLikeObject:As,isBoolean:ec,isBuffer:We,isDate:ic,isElement:oc,isEmpty:sc,isEqual:uc,isEqualWith:lc,isError:Mr,isFinite:pc,isFunction:U,isInteger:hc,isLength:ke,isMap:ea,isMatch:fc,isMatchWith:dc,isNaN:mc,isNative:gc,isNil:_c,isNull:xc,isNumber:vc,isObject:P,isObjectLike:m,isPlainObject:Ar,isRegExp:Sc,isSafeInteger:Cc,isSet:ia,isString:wl,isSymbol:y,isTypedArray:en,isUndefined:Tc,isWeakMap:Ac,isWeakSet:Mc,lt:Gc,lte:Hc,toArray:dp,toFinite:Z,toInteger:z,toLength:Cu,toNumber:D,toPlainObject:ks,toSafeInteger:Ld,toString:ur},zv={add:C,ceil:Hi,divide:Ks,floor:Ku,max:Qc,maxBy:Jc,mean:ep,meanBy:np,min:sp,minBy:up,multiply:cp,round:uf,subtract:Kf,sum:Qf,sumBy:Jf},Fv={clamp:Qi,inRange:bl,random:Bh},Bv={assign:hn,assignIn:gn,assignInWith:xn,assignWith:wn,at:xr,create:hs,defaults:Cs,defaultsDeep:Ds,entries:fu,entriesIn:du,extend:gn,extendWith:xn,findKey:Du,findLastKey:Bu,forIn:tl,forInRight:el,forOwn:nl,forOwnRight:rl,functions:al,functionsIn:sl,get:hr,has:yl,hasIn:Ga,invert:jl,invertBy:Wl,invoke:Yl,keys:ln,keysIn:mn,mapKeys:Wc,mapValues:qc,merge:ip,mergeWith:Rs,omit:wp,omitBy:Tp,pick:xh,pickBy:Cp,result:of,set:mf,setWith:yf,toPairs:fu,toPairsIn:du,transform:Rd,unset:av,update:pv,updateWith:hv,values:El,valuesIn:vv},jv={at:_v,chain:Wi,commit:da,lodash:It,next:vp,plant:bh,reverse:bv,tap:id,thru:wd,toIterator:Td,toJSON:Md,value:Md,valueOf:Md,wrapperChain:xv},Uv={camelCase:Bi,capitalize:ri,deburr:li,endsWith:lu,escape:gu,escapeRegExp:bu,kebabCase:Ic,lowerCase:jc,lowerFirst:Uc,pad:sh,padEnd:uh,padStart:lh,parseInt:hh,repeat:ef,replace:nf,snakeCase:Ef,split:jf,startCase:Hf,startsWith:Wf,template:xd,templateSettings:pd,toLower:kd,toUpper:Id,trim:Zd,trimEnd:zd,trimStart:Bd,truncate:Ud,unescape:qd,upperCase:dv,upperFirst:ni,words:Ni},Vv={attempt:Pr,bindAll:Rr,cond:Ka,conforms:$a,constant:Vt,defaultTo:bs,flow:Ju,flowRight:$u,identity:B,iteratee:kc,matches:Xc,matchesProperty:Yc,method:op,methodOf:ap,mixin:lp,noop:bt,nthArg:gp,over:Rp,overEvery:Fp,overSome:Bp,property:Xa,propertyOf:wh,range:Hh,rangeRight:Wh,stubArray:fo,stubFalse:Ue,stubObject:qf,stubString:Xf,stubTrue:Yf,times:Cd,toPath:Pd,uniqueId:ov};var Gv=function(){var t=new xt(this.__wrapped__);return t.__actions__=kt(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=kt(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=kt(this.__views__),t};var Hv=function(){if(this.__filtered__){var t=new xt(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},Wv=Math.max,qv=Math.min;var Xv=function(t,e,n){for(var r=-1,i=n.length;++r<i;){var o=n[r],a=o.size;switch(o.type){case"drop":t+=a;break;case"dropRight":e-=a;break;case"take":e=qv(e,t+a);break;case"takeRight":t=Wv(t,e-a)}}return{start:t,end:e}},Yv=Math.min;var Kv,Qv,Jv=function(){var t=this.__wrapped__.value(),e=this.__dir__,n=x(t),r=e<0,i=n?t.length:0,o=Xv(0,i,this.__views__),a=o.start,s=o.end,u=s-a,l=r?s:a-1,c=this.__iteratees__,p=c.length,h=0,f=Yv(u,this.__takeCount__);if(!n||!r&&i==u&&f==u)return Ad(t,this.__actions__);var d=[];t:for(;u--&&h<f;){for(var v=-1,m=t[l+=e];++v<p;){var y=c[v],g=y.iteratee,_=y.type,b=g(m);if(2==_)m=b;else if(!b){if(1==_)continue t;break t}}d[h++]=m}return d},$v=4294967295,tm=Array.prototype,em=Object.prototype.hasOwnProperty,nm=a?a.iterator:void 0,rm=Math.max,im=Math.min,om=(Kv=lp,function(t,e,n){if(null==n){var r=P(e),i=r&&ln(e),o=i&&i.length&&ol(e,i);(o?o.length:r)||(n=e,e=t,t=this)}return Kv(t,e,n)});It.after=Nv.after,It.ary=Nv.ary,It.assign=Bv.assign,It.assignIn=Bv.assignIn,It.assignInWith=Bv.assignInWith,It.assignWith=Bv.assignWith,It.at=Bv.at,It.before=Nv.before,It.bind=Nv.bind,It.bindAll=Vv.bindAll,It.bindKey=Nv.bindKey,It.castArray=Zv.castArray,It.chain=jv.chain,It.chunk=Iv.chunk,It.compact=Iv.compact,It.concat=Iv.concat,It.cond=Vv.cond,It.conforms=Vv.conforms,It.constant=Vv.constant,It.countBy=Rv.countBy,It.create=Bv.create,It.curry=Nv.curry,It.curryRight=Nv.curryRight,It.debounce=Nv.debounce,It.defaults=Bv.defaults,It.defaultsDeep=Bv.defaultsDeep,It.defer=Nv.defer,It.delay=Nv.delay,It.difference=Iv.difference,It.differenceBy=Iv.differenceBy,It.differenceWith=Iv.differenceWith,It.drop=Iv.drop,It.dropRight=Iv.dropRight,It.dropRightWhile=Iv.dropRightWhile,It.dropWhile=Iv.dropWhile,It.fill=Iv.fill,It.filter=Rv.filter,It.flatMap=Rv.flatMap,It.flatMapDeep=Rv.flatMapDeep,It.flatMapDepth=Rv.flatMapDepth,It.flatten=Iv.flatten,It.flattenDeep=Iv.flattenDeep,It.flattenDepth=Iv.flattenDepth,It.flip=Nv.flip,It.flow=Vv.flow,It.flowRight=Vv.flowRight,It.fromPairs=Iv.fromPairs,It.functions=Bv.functions,It.functionsIn=Bv.functionsIn,It.groupBy=Rv.groupBy,It.initial=Iv.initial,It.intersection=Iv.intersection,It.intersectionBy=Iv.intersectionBy,It.intersectionWith=Iv.intersectionWith,It.invert=Bv.invert,It.invertBy=Bv.invertBy,It.invokeMap=Rv.invokeMap,It.iteratee=Vv.iteratee,It.keyBy=Rv.keyBy,It.keys=ln,It.keysIn=Bv.keysIn,It.map=Rv.map,It.mapKeys=Bv.mapKeys,It.mapValues=Bv.mapValues,It.matches=Vv.matches,It.matchesProperty=Vv.matchesProperty,It.memoize=Nv.memoize,It.merge=Bv.merge,It.mergeWith=Bv.mergeWith,It.method=Vv.method,It.methodOf=Vv.methodOf,It.mixin=om,It.negate=pp,It.nthArg=Vv.nthArg,It.omit=Bv.omit,It.omitBy=Bv.omitBy,It.once=Nv.once,It.orderBy=Rv.orderBy,It.over=Vv.over,It.overArgs=Nv.overArgs,It.overEvery=Vv.overEvery,It.overSome=Vv.overSome,It.partial=Nv.partial,It.partialRight=Nv.partialRight,It.partition=Rv.partition,It.pick=Bv.pick,It.pickBy=Bv.pickBy,It.property=Vv.property,It.propertyOf=Vv.propertyOf,It.pull=Iv.pull,It.pullAll=Iv.pullAll,It.pullAllBy=Iv.pullAllBy,It.pullAllWith=Iv.pullAllWith,It.pullAt=Iv.pullAt,It.range=Vv.range,It.rangeRight=Vv.rangeRight,It.rearg=Nv.rearg,It.reject=Rv.reject,It.remove=Iv.remove,It.rest=Nv.rest,It.reverse=Iv.reverse,It.sampleSize=Rv.sampleSize,It.set=Bv.set,It.setWith=Bv.setWith,It.shuffle=Rv.shuffle,It.slice=Iv.slice,It.sortBy=Rv.sortBy,It.sortedUniq=Iv.sortedUniq,It.sortedUniqBy=Iv.sortedUniqBy,It.split=Uv.split,It.spread=Nv.spread,It.tail=Iv.tail,It.take=Iv.take,It.takeRight=Iv.takeRight,It.takeRightWhile=Iv.takeRightWhile,It.takeWhile=Iv.takeWhile,It.tap=jv.tap,It.throttle=Nv.throttle,It.thru=wd,It.toArray=Zv.toArray,It.toPairs=Bv.toPairs,It.toPairsIn=Bv.toPairsIn,It.toPath=Vv.toPath,It.toPlainObject=Zv.toPlainObject,It.transform=Bv.transform,It.unary=Nv.unary,It.union=Iv.union,It.unionBy=Iv.unionBy,It.unionWith=Iv.unionWith,It.uniq=Iv.uniq,It.uniqBy=Iv.uniqBy,It.uniqWith=Iv.uniqWith,It.unset=Bv.unset,It.unzip=Iv.unzip,It.unzipWith=Iv.unzipWith,It.update=Bv.update,It.updateWith=Bv.updateWith,It.values=Bv.values,It.valuesIn=Bv.valuesIn,It.without=Iv.without,It.words=Uv.words,It.wrap=Nv.wrap,It.xor=Iv.xor,It.xorBy=Iv.xorBy,It.xorWith=Iv.xorWith,It.zip=Iv.zip,It.zipObject=Iv.zipObject,It.zipObjectDeep=Iv.zipObjectDeep,It.zipWith=Iv.zipWith,It.entries=Bv.toPairs,It.entriesIn=Bv.toPairsIn,It.extend=Bv.assignIn,It.extendWith=Bv.assignInWith,om(It,It),It.add=zv.add,It.attempt=Vv.attempt,It.camelCase=Uv.camelCase,It.capitalize=Uv.capitalize,It.ceil=zv.ceil,It.clamp=Fv.clamp,It.clone=Zv.clone,It.cloneDeep=Zv.cloneDeep,It.cloneDeepWith=Zv.cloneDeepWith,It.cloneWith=Zv.cloneWith,It.conformsTo=Zv.conformsTo,It.deburr=Uv.deburr,It.defaultTo=Vv.defaultTo,It.divide=zv.divide,It.endsWith=Uv.endsWith,It.eq=Zv.eq,It.escape=Uv.escape,It.escapeRegExp=Uv.escapeRegExp,It.every=Rv.every,It.find=Rv.find,It.findIndex=Iv.findIndex,It.findKey=Bv.findKey,It.findLast=Rv.findLast,It.findLastIndex=Iv.findLastIndex,It.findLastKey=Bv.findLastKey,It.floor=zv.floor,It.forEach=Rv.forEach,It.forEachRight=Rv.forEachRight,It.forIn=Bv.forIn,It.forInRight=Bv.forInRight,It.forOwn=Bv.forOwn,It.forOwnRight=Bv.forOwnRight,It.get=Bv.get,It.gt=Zv.gt,It.gte=Zv.gte,It.has=Bv.has,It.hasIn=Bv.hasIn,It.head=Iv.head,It.identity=B,It.includes=Rv.includes,It.indexOf=Iv.indexOf,It.inRange=Fv.inRange,It.invoke=Bv.invoke,It.isArguments=Zv.isArguments,It.isArray=x,It.isArrayBuffer=Zv.isArrayBuffer,It.isArrayLike=Zv.isArrayLike,It.isArrayLikeObject=Zv.isArrayLikeObject,It.isBoolean=Zv.isBoolean,It.isBuffer=Zv.isBuffer,It.isDate=Zv.isDate,It.isElement=Zv.isElement,It.isEmpty=Zv.isEmpty,It.isEqual=Zv.isEqual,It.isEqualWith=Zv.isEqualWith,It.isError=Zv.isError,It.isFinite=Zv.isFinite,It.isFunction=Zv.isFunction,It.isInteger=Zv.isInteger,It.isLength=Zv.isLength,It.isMap=Zv.isMap,It.isMatch=Zv.isMatch,It.isMatchWith=Zv.isMatchWith,It.isNaN=Zv.isNaN,It.isNative=Zv.isNative,It.isNil=Zv.isNil,It.isNull=Zv.isNull,It.isNumber=Zv.isNumber,It.isObject=P,It.isObjectLike=Zv.isObjectLike,It.isPlainObject=Zv.isPlainObject,It.isRegExp=Zv.isRegExp,It.isSafeInteger=Zv.isSafeInteger,It.isSet=Zv.isSet,It.isString=Zv.isString,It.isSymbol=Zv.isSymbol,It.isTypedArray=Zv.isTypedArray,It.isUndefined=Zv.isUndefined,It.isWeakMap=Zv.isWeakMap,It.isWeakSet=Zv.isWeakSet,It.join=Iv.join,It.kebabCase=Uv.kebabCase,It.last=Hs,It.lastIndexOf=Iv.lastIndexOf,It.lowerCase=Uv.lowerCase,It.lowerFirst=Uv.lowerFirst,It.lt=Zv.lt,It.lte=Zv.lte,It.max=zv.max,It.maxBy=zv.maxBy,It.mean=zv.mean,It.meanBy=zv.meanBy,It.min=zv.min,It.minBy=zv.minBy,It.stubArray=Vv.stubArray,It.stubFalse=Vv.stubFalse,It.stubObject=Vv.stubObject,It.stubString=Vv.stubString,It.stubTrue=Vv.stubTrue,It.multiply=zv.multiply,It.nth=Iv.nth,It.noop=Vv.noop,It.now=Dv.now,It.pad=Uv.pad,It.padEnd=Uv.padEnd,It.padStart=Uv.padStart,It.parseInt=Uv.parseInt,It.random=Fv.random,It.reduce=Rv.reduce,It.reduceRight=Rv.reduceRight,It.repeat=Uv.repeat,It.replace=Uv.replace,It.result=Bv.result,It.round=zv.round,It.sample=Rv.sample,It.size=Rv.size,It.snakeCase=Uv.snakeCase,It.some=Rv.some,It.sortedIndex=Iv.sortedIndex,It.sortedIndexBy=Iv.sortedIndexBy,It.sortedIndexOf=Iv.sortedIndexOf,It.sortedLastIndex=Iv.sortedLastIndex,It.sortedLastIndexBy=Iv.sortedLastIndexBy,It.sortedLastIndexOf=Iv.sortedLastIndexOf,It.startCase=Uv.startCase,It.startsWith=Uv.startsWith,It.subtract=zv.subtract,It.sum=zv.sum,It.sumBy=zv.sumBy,It.template=Uv.template,It.times=Vv.times,It.toFinite=Zv.toFinite,It.toInteger=z,It.toLength=Zv.toLength,It.toLower=Uv.toLower,It.toNumber=Zv.toNumber,It.toSafeInteger=Zv.toSafeInteger,It.toString=Zv.toString,It.toUpper=Uv.toUpper,It.trim=Uv.trim,It.trimEnd=Uv.trimEnd,It.trimStart=Uv.trimStart,It.truncate=Uv.truncate,It.unescape=Uv.unescape,It.uniqueId=Vv.uniqueId,It.upperCase=Uv.upperCase,It.upperFirst=Uv.upperFirst,It.each=Rv.forEach,It.eachRight=Rv.forEachRight,It.first=Iv.head,om(It,(Qv={},is(It,(function(t,e){em.call(It.prototype,e)||(Qv[e]=t)})),Qv),{chain:!1}),It.VERSION="4.17.21",(It.templateSettings=Uv.templateSettings).imports._=It,Xt(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(t){It[t].placeholder=It})),Xt(["drop","take"],(function(t,e){xt.prototype[t]=function(n){n=void 0===n?1:rm(z(n),0);var r=this.__filtered__&&!e?new xt(this):this.clone();return r.__filtered__?r.__takeCount__=im(n,r.__takeCount__):r.__views__.push({size:im(n,$v),type:t+(r.__dir__<0?"Right":"")}),r},xt.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}})),Xt(["filter","map","takeWhile"],(function(t,e){var n=e+1,r=1==n||3==n;xt.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:Ya(t,3),type:n}),e.__filtered__=e.__filtered__||r,e}})),Xt(["head","last"],(function(t,e){var n="take"+(e?"Right":"");xt.prototype[t]=function(){return this[n](1).value()[0]}})),Xt(["initial","tail"],(function(t,e){var n="drop"+(e?"":"Right");xt.prototype[t]=function(){return this.__filtered__?new xt(this):this[n](1)}})),xt.prototype.compact=function(){return this.filter(B)},xt.prototype.find=function(t){return this.filter(t).head()},xt.prototype.findLast=function(t){return this.reverse().find(t)},xt.prototype.invokeMap=Me((function(t,e){return"function"==typeof t?new xt(this):this.map((function(n){return Xl(n,t,e)}))})),xt.prototype.reject=function(t){return this.filter(pp(Ya(t)))},xt.prototype.slice=function(t,e){t=z(t);var n=this;return n.__filtered__&&(t>0||e<0)?new xt(n):(t<0?n=n.takeRight(-t):t&&(n=n.drop(t)),void 0!==e&&(n=(e=z(e))<0?n.dropRight(-e):n.take(e-t)),n)},xt.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},xt.prototype.toArray=function(){return this.take($v)},is(xt.prototype,(function(t,e){var n=/^(?:filter|find|map|reject)|While$/.test(e),r=/^(?:head|last)$/.test(e),i=It[r?"take"+("last"==e?"Right":""):e],o=r||/^find/.test(e);i&&(It.prototype[e]=function(){var e=this.__wrapped__,a=r?[1]:arguments,s=e instanceof xt,u=a[0],l=s||x(e),c=function(t){var e=i.apply(It,dr([t],a));return r&&p?e[0]:e};l&&n&&"function"==typeof u&&1!=u.length&&(s=l=!1);var p=this.__chain__,h=!!this.__actions__.length,f=o&&!p,d=s&&!h;if(!o&&l){e=d?e:new xt(this);var v=t.apply(e,a);return v.__actions__.push({func:wd,args:[c],thisArg:void 0}),new Mt(v,p)}return f&&d?t.apply(this,a):(v=this.thru(c),f?r?v.value()[0]:v.value():v)})})),Xt(["pop","push","shift","sort","splice","unshift"],(function(t){var e=tm[t],n=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",r=/^(?:pop|shift)$/.test(t);It.prototype[t]=function(){var t=arguments;if(r&&!this.__chain__){var i=this.value();return e.apply(x(i)?i:[],t)}return this[n]((function(n){return e.apply(x(n)?n:[],t)}))}})),is(xt.prototype,(function(t,e){var n=It[e];if(n){var r=n.name+"";em.call(Et,r)||(Et[r]=[]),Et[r].push({name:e,func:n})}})),Et[pe(void 0,2).name]=[{name:"wrapper",func:void 0}],xt.prototype.clone=Gv,xt.prototype.reverse=Hv,xt.prototype.value=Jv,It.prototype.at=jv.at,It.prototype.chain=jv.wrapperChain,It.prototype.commit=jv.commit,It.prototype.next=jv.next,It.prototype.plant=jv.plant,It.prototype.reverse=jv.reverse,It.prototype.toJSON=It.prototype.valueOf=It.prototype.value=jv.value,It.prototype.first=It.prototype.head,nm&&(It.prototype[nm]=jv.toIterator);var am=It}}]);
//# sourceMappingURL=322.af8d66dcb9f5d32fd300.js.map